var iA=Object.defineProperty;var lA=(e,t,n)=>t in e?iA(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Xe=(e,t,n)=>lA(e,typeof t!="symbol"?t+"":t,n);import{r as oA,g as ks,c as Qe,u as Vu,a as h,j as r,m as de,R as le,b as Qr,d as SC,L as Ct,B as H,C as bt,e as We,f as ir,h as cr,i as it,k as Pl,s as ti,l as _C,A as rb,n as ar,o as gc,V as mt,p as EC,q as tr,t as cA,v as dA,w as uA,x as mA,y as hA,z as pA,D as fA,E as mn,F as DC,G as xt,H as Ql,I as tx,J as Zl,K as gA,M as xA,N as yA,O as xc,P as bA,Q as vA}from"./index-DxDjdAZm.js";import{u as qd,l as nb,B as Ol,U as _t,L as wA,M as Gu,T as Cr,a as fr,A as Wi,N as jA,b as NA}from"./AnimatedBackground-D5BGCIvK.js";import{X as Ze,A as ht,M as Dt,C as Xt,S as ys,R as Be,I as gs}from"./input-CHc0xvdJ.js";import{B as Yi,C as yt,Z as Ml,E as bs,a as Da,M as Kr,b as CA,V as sb}from"./zap-DUhrQxyo.js";import{U as kt,C as dt,P as Wt,S as zn}from"./users-DHITAXSj.js";import{T as Er,C as jt,S as on,a as $n,P as nl,b as Ot,c as La,B as Ko,d as sn,M as vn,F as Ut,e as zr,G as kA,A as Vi}from"./GoalSettingSection-BMwg2o7Z.js";import{U as SA,C as Xr,a as yc,E as rx,B as _n,F as da,A as Dn,b as ri,c as TC,d as di,e as _A}from"./UserOnboardingPage-HRDeQys1.js";import{C as Ta,U as vs,D as ra,a as qn,S as AC}from"./upload-CQcd5SIf.js";var eo=oA();const EA=ks(eo);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DA=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Bn=Qe("activity",DA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TA=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],Gr=Qe("arrow-down",TA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AA=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],rn=Qe("arrow-up-down",AA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PA=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Ar=Qe("arrow-up",PA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OA=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],ab=Qe("book",OA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MA=[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]],Br=Qe("brain",MA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IA=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]],qt=Qe("building",IA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LA=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],ib=Qe("calendar-days",LA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RA=[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]],$A=Qe("chart-no-axes-column-increasing",RA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FA=[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]],bl=Qe("chart-no-axes-column",FA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zA=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],PC=Qe("chart-pie",zA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],na=Qe("circle-check",BA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Cf=Qe("circle-help",UA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qA=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Gi=Qe("circle",qA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HA=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],OC=Qe("coffee",HA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WA=[["path",{d:"M16 2v2",key:"scm5qe"}],["path",{d:"M7 22v-2a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2",key:"1waht3"}],["path",{d:"M8 2v2",key:"pbkmx"}],["circle",{cx:"12",cy:"11",r:"3",key:"itu57m"}],["rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",key:"12vinp"}]],YA=Qe("contact",WA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VA=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],Ur=Qe("dollar-sign",VA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GA=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],nx=Qe("ellipsis-vertical",GA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KA=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],sa=Qe("external-link",KA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XA=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Ku=Qe("eye-off",XA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JA=[["path",{d:"M12 16h.01",key:"1drbdi"}],["path",{d:"M16 16h.01",key:"1f9h7w"}],["path",{d:"M3 19a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8.5a.5.5 0 0 0-.769-.422l-4.462 2.844A.5.5 0 0 1 15 10.5v-2a.5.5 0 0 0-.769-.422L9.77 10.922A.5.5 0 0 1 9 10.5V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2z",key:"1iv0i2"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],kf=Qe("factory",JA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QA=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],ZA=Qe("file-check",QA);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e4=[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]],MC=Qe("flag",e4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t4=[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]],r4=Qe("git-branch",t4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n4=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],ni=Qe("globe",n4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s4=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],a4=Qe("grid-3x3",s4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i4=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],l4=Qe("hash",i4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o4=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]],Xo=Qe("heart",o4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c4=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],d4=Qe("history",c4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u4=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],sx=Qe("house",u4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m4=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],lb=Qe("inbox",m4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h4=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Za=Qe("info",h4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p4=[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]],f4=Qe("keyboard",p4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g4=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],x4=Qe("layout-dashboard",g4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y4=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],bc=Qe("lightbulb",y4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b4=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],IC=Qe("link",b4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v4=[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]],w4=Qe("list",v4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j4=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],Il=Qe("loader",j4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N4=[["path",{d:"M21.2 8.4c.5.38.8.97.8 1.6v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V10a2 2 0 0 1 .8-1.6l8-6a2 2 0 0 1 2.4 0l8 6Z",key:"1jhwl8"}],["path",{d:"m22 10-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 10",key:"1qfld7"}]],ob=Qe("mail-open",N4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C4=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],k4=Qe("maximize-2",C4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S4=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],_4=Qe("minimize-2",S4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E4=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],D4=Qe("move",E4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T4=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],Sf=Qe("navigation",T4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A4=[["path",{d:"M15 18h-5",key:"95g1m2"}],["path",{d:"M18 14h-8",key:"sponae"}],["path",{d:"M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-4 0v-9a2 2 0 0 1 2-2h2",key:"39pd36"}],["rect",{width:"8",height:"4",x:"10",y:"6",rx:"1",key:"aywv1n"}]],Zm=Qe("newspaper",A4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P4=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],_f=Qe("network",P4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O4=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],LC=Qe("package",O4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M4=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]],I4=Qe("panel-left-close",M4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L4=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],R4=Qe("pause",L4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $4=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Ms=Qe("pen",$4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F4=[["path",{d:"M13 2a9 9 0 0 1 9 9",key:"1itnx2"}],["path",{d:"M13 6a5 5 0 0 1 5 5",key:"11nki7"}],["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],si=Qe("phone-call",F4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z4=[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]],RC=Qe("plane",z4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B4=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],ax=Qe("play",B4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U4=[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]],q4=Qe("rocket",U4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H4=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],_d=Qe("rotate-ccw",H4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W4=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],to=Qe("send",W4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y4=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],V4=Qe("shopping-cart",Y4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G4=[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]],cb=Qe("sliders-horizontal",G4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K4=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],Mr=Qe("sparkles",K4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X4=[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Hd=Qe("square-check-big",X4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J4=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Q4=Qe("square-pen",J4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z4=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],$C=Qe("square",Z4);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eP=[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]],tP=Qe("table",eP);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rP=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],FC=Qe("tag",rP);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nP=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],sP=Qe("timer",nP);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aP=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],iP=Qe("trending-down",aP);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lP=[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]],oP=Qe("unlink",lP);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cP=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],zC=Qe("user-check",cP);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dP=[["circle",{cx:"10",cy:"7",r:"4",key:"e45bow"}],["path",{d:"M10.3 15H7a4 4 0 0 0-4 4v2",key:"3bnktk"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["path",{d:"m21 21-1.9-1.9",key:"1g2n9r"}]],Ro=Qe("user-search",dP);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uP=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],db=Qe("volume-2",uP);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mP=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],hP=Qe("wand-sparkles",mP);function pP(e){const n=new Date-new Date(e),s=Math.floor(n/1e3),a=Math.floor(s/60),i=Math.floor(a/60),l=Math.floor(i/24);return s<60?"Just now":a<60?`${a} ${a===1?"minute":"minutes"} ago`:i<24?`${i} ${i===1?"hour":"hours"} ago`:l<7?`${l} ${l===1?"day":"days"} ago`:new Date(e).toLocaleDateString()}function fP({notification:e,onRemove:t,onMarkAsRead:n}){const{id:s,type:a,message:i,timestamp:l,read:o}=e,c=()=>{switch(a){case"lead-reply":return r.jsx(Dt,{className:"w-4 h-4 text-blue-600"});default:return r.jsx(Yi,{className:"w-4 h-4 text-gray-600"})}},d=()=>{o||n(s)};return r.jsxs(de.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.2},onClick:d,className:`
        group relative p-4 border-b border-gray-100 cursor-pointer
        transition-colors duration-150
        ${o?"bg-white":"bg-blue-50 border-l-4 border-l-blue-500"}
        hover:bg-gray-50
      `,children:[r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"flex-shrink-0 mt-1",children:c()}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm text-gray-700 font-medium leading-relaxed",children:i}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:pP(l)})]}),r.jsx("button",{onClick:u=>{u.stopPropagation(),t(s)},className:"flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-gray-200 rounded","aria-label":"Remove notification",children:r.jsx(Ze,{className:"w-4 h-4 text-gray-500"})})]}),!o&&r.jsx("div",{className:"absolute top-4 right-4 w-2 h-2 bg-blue-600 rounded-full"})]})}function ub({isCollapsed:e=!1}){const{notifications:t,closePopup:n,removeNotification:s,clearAll:a,markAsRead:i}=Vu(),l=h.useRef(null);h.useEffect(()=>{const d=u=>{l.current&&!l.current.contains(u.target)&&(u.target.closest('button[aria-label="Notifications"]')||n())};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[n]);const c=e?{left:"5rem",top:"8rem"}:{left:"14.5rem",top:"8rem"};return r.jsxs(de.div,{ref:l,initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.15},className:"fixed z-50 w-[360px] max-h-[480px] bg-white rounded-lg shadow-2xl border border-gray-200 flex flex-col",style:c,role:"dialog","aria-labelledby":"notification-header",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[r.jsx("h2",{id:"notification-header",className:"text-lg font-semibold text-gray-900",children:"Notifications"}),r.jsx("button",{onClick:n,className:"p-1 hover:bg-gray-100 rounded transition-colors","aria-label":"Close notifications",children:r.jsx(Ze,{className:"w-5 h-5 text-gray-500"})})]}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:t.length===0?r.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[r.jsx(Yi,{className:"w-12 h-12 text-gray-300 mb-3"}),r.jsx("p",{className:"text-sm text-gray-500 text-center",children:"No notifications yet"})]}):r.jsx(ht,{children:t.map(d=>r.jsx(fP,{notification:d,onRemove:s,onMarkAsRead:i},d.id))})}),t.length>0&&r.jsx("div",{className:"p-4 border-t border-gray-200",children:r.jsx("button",{onClick:a,className:"w-full px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Clear All"})})]})}function gP({isCollapsed:e=!1}){const{unreadCount:t,togglePopup:n,isOpen:s}=Vu(),[a,i]=h.useState(!1),[l,o]=h.useState(0),c=t>0;h.useEffect(()=>{if(t>l&&t>0){i(!0);const u=setTimeout(()=>i(!1),600);return()=>clearTimeout(u)}o(t)},[t,l]);const d=()=>{n()};return e?r.jsxs(r.Fragment,{children:[r.jsxs("button",{onClick:d,"aria-label":"Notifications","aria-expanded":s,className:`
            relative p-2 rounded-lg transition-all duration-200
            ${c?"text-pink-600 opacity-100 hover:bg-pink-50":"text-gray-400 opacity-40 hover:bg-gray-100"}
            ${s?"bg-pink-50":""}
          `,children:[r.jsx(de.div,{animate:a?{scale:[1,1.2,1]}:{},transition:{duration:.3,repeat:a?2:0},children:r.jsx(Yi,{className:"w-5 h-5"})}),r.jsx(ht,{children:c&&r.jsx(de.div,{initial:{scale:0},animate:{scale:1},exit:{scale:0},className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 bg-pink-600 rounded-full flex items-center justify-center","aria-label":`${t} unread notifications`,children:r.jsx("span",{className:"text-white text-[10px] font-bold leading-none",children:t>99?"99+":t})})})]}),s&&r.jsx(ub,{isCollapsed:e})]}):r.jsxs(r.Fragment,{children:[r.jsxs("button",{onClick:d,"aria-label":"Notifications","aria-expanded":s,className:`
          flex items-center justify-between w-full px-4 py-3 rounded-lg
          transition-all duration-200
          ${c?"text-pink-600 opacity-100 hover:bg-pink-50":"text-gray-400 opacity-40 hover:bg-gray-100"}
          ${s?"bg-pink-50":""}
        `,children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(de.div,{animate:a?{scale:[1,1.2,1]}:{},transition:{duration:.3,repeat:a?2:0},children:r.jsx(Yi,{className:"w-5 h-5"})}),r.jsx("span",{className:"text-sm font-medium",children:"Notifications"})]}),r.jsx(ht,{children:c&&r.jsx(de.div,{initial:{scale:0},animate:{scale:1},exit:{scale:0},className:"px-2 py-0.5 min-w-[24px] bg-pink-600 rounded-full flex items-center justify-center","aria-label":`${t} unread notifications`,children:r.jsx("span",{className:"text-white text-xs font-bold leading-none",children:t>99?"99+":t})})})]}),s&&r.jsx(ub,{isCollapsed:e})]})}const pa={dashboard:{label:"Dashboard",color:"blue",gradient:"from-blue-600 via-blue-700 to-blue-800",shadow:"shadow-blue-600/40",hoverShadow:"hover:shadow-blue-700/60",hoverBg:"hover:bg-gradient-to-r hover:from-blue-100 hover:to-blue-200",description:"Overview of metrics, tasks & AI agents"},leads:{label:"Lead Generation",color:"blue",gradient:"from-blue-500 to-cyan-500",shadow:"shadow-blue-500/25",hoverShadow:"hover:shadow-blue-500/40",description:"Manage and generate new leads"},"sales-center":{label:"Sales Center",color:"purple",gradient:"from-purple-500 to-pink-500",shadow:"shadow-purple-500/25",hoverShadow:"hover:shadow-purple-500/40",description:"Sales training, CRM & analytics hub"},crm:{label:"Customer Relations",color:"pink",gradient:"from-pink-500 to-rose-500",shadow:"shadow-pink-500/25",hoverShadow:"hover:shadow-pink-500/40",description:"Customer relationship management"},deals:{label:"Deals",color:"indigo",gradient:"from-indigo-500 to-purple-500",shadow:"shadow-indigo-500/25",hoverShadow:"hover:shadow-indigo-500/40",description:"Deal pipeline & management"},employees:{label:"Team Management",color:"green",gradient:"from-green-500 to-emerald-500",shadow:"shadow-green-500/25",hoverShadow:"hover:shadow-green-500/40",description:"Employee profiles & assignment"},calendar:{label:"Calendar & Scheduling",color:"orange",gradient:"from-orange-500 to-red-500",shadow:"shadow-orange-500/25",hoverShadow:"hover:shadow-orange-500/40",description:"Calendar integration & scheduling"},"user-onboarding":{label:"User Onboarding",color:"teal",gradient:"from-teal-500 to-cyan-500",shadow:"shadow-teal-500/25",hoverShadow:"hover:shadow-teal-500/40",description:"Manage team organization and personal onboarding"},"usage-analytics":{label:"Usage Analytics",color:"indigo",gradient:"from-indigo-500 to-violet-500",shadow:"shadow-indigo-500/25",hoverShadow:"hover:shadow-indigo-500/40",description:"Track and analyze platform usage"}},BC=[{group:"Overview",items:[{id:"dashboard",icon:x4,config:pa.dashboard}]},{group:"",items:[{id:"leads",icon:kt,config:pa.leads},{id:"crm",icon:Xo,config:pa.crm},{id:"deals",icon:Ur,config:pa.deals},{id:"sales-center",icon:Er,config:pa["sales-center"]}]},{group:"Team & Calendar",items:[{id:"employees",icon:zC,config:pa.employees},{id:"calendar",icon:yt,config:pa.calendar},{id:"user-onboarding",icon:SA,config:pa["user-onboarding"]},{id:"usage-analytics",icon:Er,config:pa["usage-analytics"]}]}],UC=le.memo(({item:e,currentView:t,isCollapsed:n,setCurrentView:s,onTabClick:a})=>{const{hasPermission:i,isLoading:l}=qd(),{id:o,icon:c,config:d}=e,u=t===o,m=h.useCallback(()=>{s(o),a==null||a(o)},[o,s,a]);return l||!i(o)?null:r.jsx(de.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:BC.flatMap(p=>p.items).findIndex(p=>p.id===o)*.1,ease:"easeOut"},whileHover:{scale:1.02,transition:{duration:.2}},whileTap:{scale:.98,transition:{duration:.1}},children:r.jsx("div",{onClick:m,"data-view":o,title:n?d.label:"",className:`
                    group cursor-pointer rounded-lg transition-all duration-300
                    ${u?`bg-gradient-to-r ${d.gradient} text-white ${d.shadow} shadow-xl transform scale-105`:d.hoverBg||"hover:bg-blue-200"}
                    ${d.hoverShadow} hover:shadow-lg
                    p-3
                `,style:u?{}:{backgroundColor:"rgb(217, 239, 243)"},children:r.jsxs("div",{className:"relative z-10 flex items-center w-full",children:[r.jsx(c,{className:`h-5 w-5 flex-shrink-0 ${u?"text-white drop-shadow-sm":"text-gray-600"}`}),!n&&r.jsx("div",{className:"ml-3 flex-1 overflow-hidden transition-opacity duration-200 delay-150",children:r.jsx("div",{className:"flex items-center justify-between whitespace-nowrap",children:r.jsx("div",{className:"min-w-0",children:r.jsx("div",{className:`font-semibold text-xs leading-tight ${u?"text-white drop-shadow-sm":"text-gray-900"}`,children:d.label})})})})]})})},o)});UC.displayName="NavigationItem";const qC=le.memo(({currentView:e,setCurrentView:t,onTabClick:n})=>{var j,S,_,C;const{hasPermission:s,isLoading:a}=qd(),{user:i,logout:l,isAuthenticated:o}=Qr(),{userRole:c}=qd(),d=SC(),[u,m]=h.useState(!1),[p,f]=h.useState(!1),[y,g]=h.useState(!1),x=h.useRef(null);h.useEffect(()=>{const D=A=>{x.current&&!x.current.contains(A.target)&&m(!1)};return document.addEventListener("mousedown",D),()=>{document.removeEventListener("mousedown",D)}},[]);const b=h.useCallback(()=>{l(),m(!1)},[l]),v=h.useCallback(()=>{d("/settings"),m(!1)},[d]),w=h.useCallback(()=>{d("/profiles"),m(!1)},[d]),N=h.useCallback(()=>{g(!0),f(D=>!D),setTimeout(()=>{g(!1)},300)},[]),k=h.useMemo(()=>BC.map(D=>({...D,items:D.items.filter(A=>s(A.id))})).filter(D=>D.items.length>0),[s]);return r.jsxs("div",{className:`sidebar-menu h-full flex flex-col overflow-hidden relative z-20 transition-all duration-300 ${p?"w-20":"w-56"}`,children:[!p&&r.jsx("button",{onClick:N,className:`absolute top-4 right-4 z-30 p-2 rounded-lg bg-white hover:bg-gray-100 transition-all duration-200 shadow-md border border-gray-200 ${y?"opacity-0 pointer-events-none":"opacity-100"}`,title:"Collapse sidebar",children:r.jsx(I4,{className:"h-4 w-4 text-gray-600"})}),r.jsxs("div",{className:`flex-1 overflow-y-auto space-y-2 ${p?"px-2 py-5":"p-5"}`,children:[p?r.jsx("div",{className:"-mt-4 mb-0 flex items-center justify-center h-16 transition-opacity duration-200 delay-100",children:r.jsx("button",{onClick:N,className:"flex items-center justify-center transition-all duration-200 hover:bg-gray-100 rounded-lg p-2",title:"Expand sidebar",children:r.jsx("img",{src:nb,alt:"Prelude Logo",className:"h-10 w-10 object-contain"})})}):r.jsx("div",{className:"-mt-4 mb-0 flex items-center justify-start h-16 transition-opacity duration-200 delay-100",children:r.jsx("img",{src:nb,alt:"Prelude Logo",className:"h-12 w-12 object-contain"})}),r.jsx("div",{className:p?"flex justify-center mb-4":"mb-4",children:r.jsx(gP,{isCollapsed:p})}),a&&r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx("div",{className:"animate-pulse text-gray-400",children:r.jsxs("div",{className:"space-y-3",children:[r.jsx("div",{className:`h-10 bg-gray-200 rounded-lg ${p?"w-10":"w-full"}`}),r.jsx("div",{className:`h-10 bg-gray-200 rounded-lg ${p?"w-10":"w-full"}`}),r.jsx("div",{className:`h-10 bg-gray-200 rounded-lg ${p?"w-10":"w-full"}`})]})})}),!a&&k.map(D=>r.jsx("div",{children:r.jsx("div",{className:"space-y-2",children:D.items.map(A=>r.jsx(UC,{item:A,currentView:e,isCollapsed:p,setCurrentView:t,onTabClick:n},A.id))})},D.group))]}),r.jsxs("div",{className:`border-t border-gray-200 space-y-3 bg-white/50 ${p?"px-2 py-4":"p-4"}`,children:[r.jsxs("div",{className:`flex items-center ${p?"justify-center":"space-x-3"} px-3 py-2 rounded-lg bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200`,title:p?"AI Assistant Online":"",children:[r.jsx(Ol,{className:"h-5 w-5 text-green-600 flex-shrink-0"}),!p&&r.jsxs("div",{className:"flex flex-col flex-1 min-w-0 transition-opacity duration-200 delay-150",children:[r.jsx("span",{className:"text-sm font-semibold text-gray-900 whitespace-nowrap",children:"AI Assistant"}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full animate-pulse"}),r.jsx("span",{className:"text-xs text-green-600 whitespace-nowrap",children:"Online & Ready"})]})]})]}),o&&r.jsxs("div",{className:"relative",ref:x,children:[r.jsxs("button",{onClick:()=>m(!u),className:`w-full flex items-center ${p?"justify-center":"justify-between"} px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors`,title:p?((j=i==null?void 0:i.email)==null?void 0:j.split("@")[0])||"User":"",children:[r.jsxs("div",{className:`flex items-center ${p?"":"space-x-3"}`,children:[r.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold transition-all",children:((_=(S=i==null?void 0:i.email)==null?void 0:S[0])==null?void 0:_.toUpperCase())||"U"}),!p&&r.jsxs("div",{className:"flex flex-col items-start transition-opacity duration-200 delay-150",children:[r.jsx("span",{className:"text-sm font-medium text-gray-900 whitespace-nowrap",children:((C=i==null?void 0:i.email)==null?void 0:C.split("@")[0])||"User"}),r.jsx("span",{className:"text-xs text-gray-500 capitalize whitespace-nowrap",children:c||"User"})]})]}),!p&&r.jsx(Xt,{className:`h-4 w-4 text-gray-500 transition-all duration-200 delay-150 ${u?"rotate-180":""}`})]}),r.jsx(ht,{children:u&&r.jsxs(de.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:`absolute bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden z-50 ${p?"bottom-0 left-full ml-2 w-48":"bottom-full left-0 right-0 mb-2"}`,children:[r.jsxs("button",{onClick:w,className:"w-full flex items-center px-4 py-3 hover:bg-gray-50 transition-colors text-left",children:[r.jsx(_t,{className:"h-4 w-4 mr-3 text-gray-600"}),r.jsx("span",{className:"text-sm text-gray-700",children:"Profile"})]}),r.jsxs("button",{onClick:v,className:"w-full flex items-center px-4 py-3 hover:bg-gray-50 transition-colors text-left",children:[r.jsx(ys,{className:"h-4 w-4 mr-3 text-gray-600"}),r.jsx("span",{className:"text-sm text-gray-700",children:"Settings"})]}),r.jsx("div",{className:"border-t border-gray-200"}),r.jsxs("button",{onClick:b,className:"w-full flex items-center px-4 py-3 hover:bg-red-50 transition-colors text-left",children:[r.jsx(wA,{className:"h-4 w-4 mr-3 text-red-600"}),r.jsx("span",{className:"text-sm text-red-600",children:"Logout"})]})]})})]})]})]})});qC.displayName="SidebarMenu";function xP(e,t){const n={};return(e[e.length-1]===""?[...e,""]:e).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const yP=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,bP=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,vP={};function mb(e,t){return(vP.jsx?bP:yP).test(e)}const wP=/[ \t\n\f\r]/g;function jP(e){return typeof e=="object"?e.type==="text"?hb(e.value):!1:hb(e)}function hb(e){return e.replace(wP,"")===""}class vc{constructor(t,n,s){this.normal=n,this.property=t,s&&(this.space=s)}}vc.prototype.normal={};vc.prototype.property={};vc.prototype.space=void 0;function HC(e,t){const n={},s={};for(const a of e)Object.assign(n,a.property),Object.assign(s,a.normal);return new vc(n,s,t)}function Ef(e){return e.toLowerCase()}class Hn{constructor(t,n){this.attribute=n,this.property=t}}Hn.prototype.attribute="";Hn.prototype.booleanish=!1;Hn.prototype.boolean=!1;Hn.prototype.commaOrSpaceSeparated=!1;Hn.prototype.commaSeparated=!1;Hn.prototype.defined=!1;Hn.prototype.mustUseProperty=!1;Hn.prototype.number=!1;Hn.prototype.overloadedBoolean=!1;Hn.prototype.property="";Hn.prototype.spaceSeparated=!1;Hn.prototype.space=void 0;let NP=0;const Et=sl(),$r=sl(),Df=sl(),Re=sl(),hr=sl(),Cl=sl(),Yn=sl();function sl(){return 2**++NP}const Tf=Object.freeze(Object.defineProperty({__proto__:null,boolean:Et,booleanish:$r,commaOrSpaceSeparated:Yn,commaSeparated:Cl,number:Re,overloadedBoolean:Df,spaceSeparated:hr},Symbol.toStringTag,{value:"Module"})),eh=Object.keys(Tf);class ix extends Hn{constructor(t,n,s,a){let i=-1;if(super(t,n),pb(this,"space",a),typeof s=="number")for(;++i<eh.length;){const l=eh[i];pb(this,eh[i],(s&Tf[l])===Tf[l])}}}ix.prototype.defined=!0;function pb(e,t,n){n&&(e[t]=n)}function ro(e){const t={},n={};for(const[s,a]of Object.entries(e.properties)){const i=new ix(s,e.transform(e.attributes||{},s),a,e.space);e.mustUseProperty&&e.mustUseProperty.includes(s)&&(i.mustUseProperty=!0),t[s]=i,n[Ef(s)]=s,n[Ef(i.attribute)]=s}return new vc(t,n,e.space)}const WC=ro({properties:{ariaActiveDescendant:null,ariaAtomic:$r,ariaAutoComplete:null,ariaBusy:$r,ariaChecked:$r,ariaColCount:Re,ariaColIndex:Re,ariaColSpan:Re,ariaControls:hr,ariaCurrent:null,ariaDescribedBy:hr,ariaDetails:null,ariaDisabled:$r,ariaDropEffect:hr,ariaErrorMessage:null,ariaExpanded:$r,ariaFlowTo:hr,ariaGrabbed:$r,ariaHasPopup:null,ariaHidden:$r,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:hr,ariaLevel:Re,ariaLive:null,ariaModal:$r,ariaMultiLine:$r,ariaMultiSelectable:$r,ariaOrientation:null,ariaOwns:hr,ariaPlaceholder:null,ariaPosInSet:Re,ariaPressed:$r,ariaReadOnly:$r,ariaRelevant:null,ariaRequired:$r,ariaRoleDescription:hr,ariaRowCount:Re,ariaRowIndex:Re,ariaRowSpan:Re,ariaSelected:$r,ariaSetSize:Re,ariaSort:null,ariaValueMax:Re,ariaValueMin:Re,ariaValueNow:Re,ariaValueText:null,role:null},transform(e,t){return t==="role"?t:"aria-"+t.slice(4).toLowerCase()}});function YC(e,t){return t in e?e[t]:t}function VC(e,t){return YC(e,t.toLowerCase())}const CP=ro({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Cl,acceptCharset:hr,accessKey:hr,action:null,allow:null,allowFullScreen:Et,allowPaymentRequest:Et,allowUserMedia:Et,alt:null,as:null,async:Et,autoCapitalize:null,autoComplete:hr,autoFocus:Et,autoPlay:Et,blocking:hr,capture:null,charSet:null,checked:Et,cite:null,className:hr,cols:Re,colSpan:null,content:null,contentEditable:$r,controls:Et,controlsList:hr,coords:Re|Cl,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Et,defer:Et,dir:null,dirName:null,disabled:Et,download:Df,draggable:$r,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Et,formTarget:null,headers:hr,height:Re,hidden:Df,high:Re,href:null,hrefLang:null,htmlFor:hr,httpEquiv:hr,id:null,imageSizes:null,imageSrcSet:null,inert:Et,inputMode:null,integrity:null,is:null,isMap:Et,itemId:null,itemProp:hr,itemRef:hr,itemScope:Et,itemType:hr,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Et,low:Re,manifest:null,max:null,maxLength:Re,media:null,method:null,min:null,minLength:Re,multiple:Et,muted:Et,name:null,nonce:null,noModule:Et,noValidate:Et,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Et,optimum:Re,pattern:null,ping:hr,placeholder:null,playsInline:Et,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Et,referrerPolicy:null,rel:hr,required:Et,reversed:Et,rows:Re,rowSpan:Re,sandbox:hr,scope:null,scoped:Et,seamless:Et,selected:Et,shadowRootClonable:Et,shadowRootDelegatesFocus:Et,shadowRootMode:null,shape:null,size:Re,sizes:null,slot:null,span:Re,spellCheck:$r,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Re,step:null,style:null,tabIndex:Re,target:null,title:null,translate:null,type:null,typeMustMatch:Et,useMap:null,value:$r,width:Re,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:hr,axis:null,background:null,bgColor:null,border:Re,borderColor:null,bottomMargin:Re,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Et,declare:Et,event:null,face:null,frame:null,frameBorder:null,hSpace:Re,leftMargin:Re,link:null,longDesc:null,lowSrc:null,marginHeight:Re,marginWidth:Re,noResize:Et,noHref:Et,noShade:Et,noWrap:Et,object:null,profile:null,prompt:null,rev:null,rightMargin:Re,rules:null,scheme:null,scrolling:$r,standby:null,summary:null,text:null,topMargin:Re,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Re,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Et,disableRemotePlayback:Et,prefix:null,property:null,results:Re,security:null,unselectable:null},space:"html",transform:VC}),kP=ro({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:Yn,accentHeight:Re,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Re,amplitude:Re,arabicForm:null,ascent:Re,attributeName:null,attributeType:null,azimuth:Re,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Re,by:null,calcMode:null,capHeight:Re,className:hr,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Re,diffuseConstant:Re,direction:null,display:null,dur:null,divisor:Re,dominantBaseline:null,download:Et,dx:null,dy:null,edgeMode:null,editable:null,elevation:Re,enableBackground:null,end:null,event:null,exponent:Re,externalResourcesRequired:null,fill:null,fillOpacity:Re,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Cl,g2:Cl,glyphName:Cl,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Re,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Re,horizOriginX:Re,horizOriginY:Re,id:null,ideographic:Re,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Re,k:Re,k1:Re,k2:Re,k3:Re,k4:Re,kernelMatrix:Yn,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Re,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Re,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Re,overlineThickness:Re,paintOrder:null,panose1:null,path:null,pathLength:Re,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:hr,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Re,pointsAtY:Re,pointsAtZ:Re,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Yn,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Yn,rev:Yn,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Yn,requiredFeatures:Yn,requiredFonts:Yn,requiredFormats:Yn,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Re,specularExponent:Re,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Re,strikethroughThickness:Re,string:null,stroke:null,strokeDashArray:Yn,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Re,strokeOpacity:Re,strokeWidth:null,style:null,surfaceScale:Re,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Yn,tabIndex:Re,tableValues:null,target:null,targetX:Re,targetY:Re,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Yn,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Re,underlineThickness:Re,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Re,values:null,vAlphabetic:Re,vMathematical:Re,vectorEffect:null,vHanging:Re,vIdeographic:Re,version:null,vertAdvY:Re,vertOriginX:Re,vertOriginY:Re,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Re,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:YC}),GC=ro({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,t){return"xlink:"+t.slice(5).toLowerCase()}}),KC=ro({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:VC}),XC=ro({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,t){return"xml:"+t.slice(3).toLowerCase()}}),SP={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},_P=/[A-Z]/g,fb=/-[a-z]/g,EP=/^data[-\w.:]+$/i;function DP(e,t){const n=Ef(t);let s=t,a=Hn;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&EP.test(t)){if(t.charAt(4)==="-"){const i=t.slice(5).replace(fb,AP);s="data"+i.charAt(0).toUpperCase()+i.slice(1)}else{const i=t.slice(4);if(!fb.test(i)){let l=i.replace(_P,TP);l.charAt(0)!=="-"&&(l="-"+l),t="data"+l}}a=ix}return new a(s,t)}function TP(e){return"-"+e.toLowerCase()}function AP(e){return e.charAt(1).toUpperCase()}const PP=HC([WC,CP,GC,KC,XC],"html"),lx=HC([WC,kP,GC,KC,XC],"svg");function OP(e){return e.join(" ").trim()}var ml={},th,gb;function MP(){if(gb)return th;gb=1;var e=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,t=/\n/g,n=/^\s*/,s=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,a=/^:\s*/,i=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,l=/^[;\s]*/,o=/^\s+|\s+$/g,c=`
`,d="/",u="*",m="",p="comment",f="declaration";th=function(g,x){if(typeof g!="string")throw new TypeError("First argument must be a string");if(!g)return[];x=x||{};var b=1,v=1;function w(T){var M=T.match(t);M&&(b+=M.length);var L=T.lastIndexOf(c);v=~L?T.length-L:v+T.length}function N(){var T={line:b,column:v};return function(M){return M.position=new k(T),_(),M}}function k(T){this.start=T,this.end={line:b,column:v},this.source=x.source}k.prototype.content=g;function j(T){var M=new Error(x.source+":"+b+":"+v+": "+T);if(M.reason=T,M.filename=x.source,M.line=b,M.column=v,M.source=g,!x.silent)throw M}function S(T){var M=T.exec(g);if(M){var L=M[0];return w(L),g=g.slice(L.length),M}}function _(){S(n)}function C(T){var M;for(T=T||[];M=D();)M!==!1&&T.push(M);return T}function D(){var T=N();if(!(d!=g.charAt(0)||u!=g.charAt(1))){for(var M=2;m!=g.charAt(M)&&(u!=g.charAt(M)||d!=g.charAt(M+1));)++M;if(M+=2,m===g.charAt(M-1))return j("End of comment missing");var L=g.slice(2,M-2);return v+=2,w(L),g=g.slice(M),v+=2,T({type:p,comment:L})}}function A(){var T=N(),M=S(s);if(M){if(D(),!S(a))return j("property missing ':'");var L=S(i),P=T({type:f,property:y(M[0].replace(e,m)),value:L?y(L[0].replace(e,m)):m});return S(l),P}}function E(){var T=[];C(T);for(var M;M=A();)M!==!1&&(T.push(M),C(T));return T}return _(),E()};function y(g){return g?g.replace(o,m):m}return th}var xb;function IP(){if(xb)return ml;xb=1;var e=ml&&ml.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(ml,"__esModule",{value:!0}),ml.default=n;var t=e(MP());function n(s,a){var i=null;if(!s||typeof s!="string")return i;var l=(0,t.default)(s),o=typeof a=="function";return l.forEach(function(c){if(c.type==="declaration"){var d=c.property,u=c.value;o?a(d,u,c):u&&(i=i||{},i[d]=u)}}),i}return ml}var go={},yb;function LP(){if(yb)return go;yb=1,Object.defineProperty(go,"__esModule",{value:!0}),go.camelCase=void 0;var e=/^--[a-zA-Z0-9_-]+$/,t=/-([a-z])/g,n=/^[^-]+$/,s=/^-(webkit|moz|ms|o|khtml)-/,a=/^-(ms)-/,i=function(d){return!d||n.test(d)||e.test(d)},l=function(d,u){return u.toUpperCase()},o=function(d,u){return"".concat(u,"-")},c=function(d,u){return u===void 0&&(u={}),i(d)?d:(d=d.toLowerCase(),u.reactCompat?d=d.replace(a,o):d=d.replace(s,o),d.replace(t,l))};return go.camelCase=c,go}var xo,bb;function RP(){if(bb)return xo;bb=1;var e=xo&&xo.__importDefault||function(a){return a&&a.__esModule?a:{default:a}},t=e(IP()),n=LP();function s(a,i){var l={};return!a||typeof a!="string"||(0,t.default)(a,function(o,c){o&&c&&(l[(0,n.camelCase)(o,i)]=c)}),l}return s.default=s,xo=s,xo}var $P=RP();const FP=ks($P),JC=QC("end"),ox=QC("start");function QC(e){return t;function t(n){const s=n&&n.position&&n.position[e]||{};if(typeof s.line=="number"&&s.line>0&&typeof s.column=="number"&&s.column>0)return{line:s.line,column:s.column,offset:typeof s.offset=="number"&&s.offset>-1?s.offset:void 0}}}function ZC(e){const t=ox(e),n=JC(e);if(t&&n)return{start:t,end:n}}function Ho(e){return!e||typeof e!="object"?"":"position"in e||"type"in e?vb(e.position):"start"in e||"end"in e?vb(e):"line"in e||"column"in e?Af(e):""}function Af(e){return wb(e&&e.line)+":"+wb(e&&e.column)}function vb(e){return Af(e&&e.start)+"-"+Af(e&&e.end)}function wb(e){return e&&typeof e=="number"?e:1}class wn extends Error{constructor(t,n,s){super(),typeof n=="string"&&(s=n,n=void 0);let a="",i={},l=!1;if(n&&("line"in n&&"column"in n?i={place:n}:"start"in n&&"end"in n?i={place:n}:"type"in n?i={ancestors:[n],place:n.position}:i={...n}),typeof t=="string"?a=t:!i.cause&&t&&(l=!0,a=t.message,i.cause=t),!i.ruleId&&!i.source&&typeof s=="string"){const c=s.indexOf(":");c===-1?i.ruleId=s:(i.source=s.slice(0,c),i.ruleId=s.slice(c+1))}if(!i.place&&i.ancestors&&i.ancestors){const c=i.ancestors[i.ancestors.length-1];c&&(i.place=c.position)}const o=i.place&&"start"in i.place?i.place.start:i.place;this.ancestors=i.ancestors||void 0,this.cause=i.cause||void 0,this.column=o?o.column:void 0,this.fatal=void 0,this.file,this.message=a,this.line=o?o.line:void 0,this.name=Ho(i.place)||"1:1",this.place=i.place||void 0,this.reason=this.message,this.ruleId=i.ruleId||void 0,this.source=i.source||void 0,this.stack=l&&i.cause&&typeof i.cause.stack=="string"?i.cause.stack:"",this.actual,this.expected,this.note,this.url}}wn.prototype.file="";wn.prototype.name="";wn.prototype.reason="";wn.prototype.message="";wn.prototype.stack="";wn.prototype.column=void 0;wn.prototype.line=void 0;wn.prototype.ancestors=void 0;wn.prototype.cause=void 0;wn.prototype.fatal=void 0;wn.prototype.place=void 0;wn.prototype.ruleId=void 0;wn.prototype.source=void 0;const cx={}.hasOwnProperty,zP=new Map,BP=/[A-Z]/g,UP=new Set(["table","tbody","thead","tfoot","tr"]),qP=new Set(["td","th"]),ek="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function HP(e,t){if(!t||t.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=t.filePath||void 0;let s;if(t.development){if(typeof t.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");s=QP(n,t.jsxDEV)}else{if(typeof t.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof t.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");s=JP(n,t.jsx,t.jsxs)}const a={Fragment:t.Fragment,ancestors:[],components:t.components||{},create:s,elementAttributeNameCase:t.elementAttributeNameCase||"react",evaluater:t.createEvaluater?t.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:t.ignoreInvalidStyle||!1,passKeys:t.passKeys!==!1,passNode:t.passNode||!1,schema:t.space==="svg"?lx:PP,stylePropertyNameCase:t.stylePropertyNameCase||"dom",tableCellAlignToStyle:t.tableCellAlignToStyle!==!1},i=tk(a,e,void 0);return i&&typeof i!="string"?i:a.create(e,a.Fragment,{children:i||void 0},void 0)}function tk(e,t,n){if(t.type==="element")return WP(e,t,n);if(t.type==="mdxFlowExpression"||t.type==="mdxTextExpression")return YP(e,t);if(t.type==="mdxJsxFlowElement"||t.type==="mdxJsxTextElement")return GP(e,t,n);if(t.type==="mdxjsEsm")return VP(e,t);if(t.type==="root")return KP(e,t,n);if(t.type==="text")return XP(e,t)}function WP(e,t,n){const s=e.schema;let a=s;t.tagName.toLowerCase()==="svg"&&s.space==="html"&&(a=lx,e.schema=a),e.ancestors.push(t);const i=nk(e,t.tagName,!1),l=ZP(e,t);let o=ux(e,t);return UP.has(t.tagName)&&(o=o.filter(function(c){return typeof c=="string"?!jP(c):!0})),rk(e,l,i,t),dx(l,o),e.ancestors.pop(),e.schema=s,e.create(t,i,l,n)}function YP(e,t){if(t.data&&t.data.estree&&e.evaluater){const s=t.data.estree.body[0];return s.type,e.evaluater.evaluateExpression(s.expression)}Jo(e,t.position)}function VP(e,t){if(t.data&&t.data.estree&&e.evaluater)return e.evaluater.evaluateProgram(t.data.estree);Jo(e,t.position)}function GP(e,t,n){const s=e.schema;let a=s;t.name==="svg"&&s.space==="html"&&(a=lx,e.schema=a),e.ancestors.push(t);const i=t.name===null?e.Fragment:nk(e,t.name,!0),l=e5(e,t),o=ux(e,t);return rk(e,l,i,t),dx(l,o),e.ancestors.pop(),e.schema=s,e.create(t,i,l,n)}function KP(e,t,n){const s={};return dx(s,ux(e,t)),e.create(t,e.Fragment,s,n)}function XP(e,t){return t.value}function rk(e,t,n,s){typeof n!="string"&&n!==e.Fragment&&e.passNode&&(t.node=s)}function dx(e,t){if(t.length>0){const n=t.length>1?t:t[0];n&&(e.children=n)}}function JP(e,t,n){return s;function s(a,i,l,o){const d=Array.isArray(l.children)?n:t;return o?d(i,l,o):d(i,l)}}function QP(e,t){return n;function n(s,a,i,l){const o=Array.isArray(i.children),c=ox(s);return t(a,i,l,o,{columnNumber:c?c.column-1:void 0,fileName:e,lineNumber:c?c.line:void 0},void 0)}}function ZP(e,t){const n={};let s,a;for(a in t.properties)if(a!=="children"&&cx.call(t.properties,a)){const i=t5(e,a,t.properties[a]);if(i){const[l,o]=i;e.tableCellAlignToStyle&&l==="align"&&typeof o=="string"&&qP.has(t.tagName)?s=o:n[l]=o}}if(s){const i=n.style||(n.style={});i[e.stylePropertyNameCase==="css"?"text-align":"textAlign"]=s}return n}function e5(e,t){const n={};for(const s of t.attributes)if(s.type==="mdxJsxExpressionAttribute")if(s.data&&s.data.estree&&e.evaluater){const i=s.data.estree.body[0];i.type;const l=i.expression;l.type;const o=l.properties[0];o.type,Object.assign(n,e.evaluater.evaluateExpression(o.argument))}else Jo(e,t.position);else{const a=s.name;let i;if(s.value&&typeof s.value=="object")if(s.value.data&&s.value.data.estree&&e.evaluater){const o=s.value.data.estree.body[0];o.type,i=e.evaluater.evaluateExpression(o.expression)}else Jo(e,t.position);else i=s.value===null?!0:s.value;n[a]=i}return n}function ux(e,t){const n=[];let s=-1;const a=e.passKeys?new Map:zP;for(;++s<t.children.length;){const i=t.children[s];let l;if(e.passKeys){const c=i.type==="element"?i.tagName:i.type==="mdxJsxFlowElement"||i.type==="mdxJsxTextElement"?i.name:void 0;if(c){const d=a.get(c)||0;l=c+"-"+d,a.set(c,d+1)}}const o=tk(e,i,l);o!==void 0&&n.push(o)}return n}function t5(e,t,n){const s=DP(e.schema,t);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=s.commaSeparated?xP(n):OP(n)),s.property==="style"){let a=typeof n=="object"?n:r5(e,String(n));return e.stylePropertyNameCase==="css"&&(a=n5(a)),["style",a]}return[e.elementAttributeNameCase==="react"&&s.space?SP[s.property]||s.property:s.attribute,n]}}function r5(e,t){try{return FP(t,{reactCompat:!0})}catch(n){if(e.ignoreInvalidStyle)return{};const s=n,a=new wn("Cannot parse `style` attribute",{ancestors:e.ancestors,cause:s,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw a.file=e.filePath||void 0,a.url=ek+"#cannot-parse-style-attribute",a}}function nk(e,t,n){let s;if(!n)s={type:"Literal",value:t};else if(t.includes(".")){const a=t.split(".");let i=-1,l;for(;++i<a.length;){const o=mb(a[i])?{type:"Identifier",name:a[i]}:{type:"Literal",value:a[i]};l=l?{type:"MemberExpression",object:l,property:o,computed:!!(i&&o.type==="Literal"),optional:!1}:o}s=l}else s=mb(t)&&!/^[a-z]/.test(t)?{type:"Identifier",name:t}:{type:"Literal",value:t};if(s.type==="Literal"){const a=s.value;return cx.call(e.components,a)?e.components[a]:a}if(e.evaluater)return e.evaluater.evaluateExpression(s);Jo(e)}function Jo(e,t){const n=new wn("Cannot handle MDX estrees without `createEvaluater`",{ancestors:e.ancestors,place:t,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=e.filePath||void 0,n.url=ek+"#cannot-handle-mdx-estrees-without-createevaluater",n}function n5(e){const t={};let n;for(n in e)cx.call(e,n)&&(t[s5(n)]=e[n]);return t}function s5(e){let t=e.replace(BP,a5);return t.slice(0,3)==="ms-"&&(t="-"+t),t}function a5(e){return"-"+e.toLowerCase()}const rh={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},i5={};function l5(e,t){const n=i5,s=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,a=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return sk(e,s,a)}function sk(e,t,n){if(o5(e)){if("value"in e)return e.type==="html"&&!n?"":e.value;if(t&&"alt"in e&&e.alt)return e.alt;if("children"in e)return jb(e.children,t,n)}return Array.isArray(e)?jb(e,t,n):""}function jb(e,t,n){const s=[];let a=-1;for(;++a<e.length;)s[a]=sk(e[a],t,n);return s.join("")}function o5(e){return!!(e&&typeof e=="object")}const Nb=document.createElement("i");function mx(e){const t="&"+e+";";Nb.innerHTML=t;const n=Nb.textContent;return n.charCodeAt(n.length-1)===59&&e!=="semi"||n===t?!1:n}function aa(e,t,n,s){const a=e.length;let i=0,l;if(t<0?t=-t>a?0:a+t:t=t>a?a:t,n=n>0?n:0,s.length<1e4)l=Array.from(s),l.unshift(t,n),e.splice(...l);else for(n&&e.splice(t,n);i<s.length;)l=s.slice(i,i+1e4),l.unshift(t,0),e.splice(...l),i+=1e4,t+=1e4}function ds(e,t){return e.length>0?(aa(e,e.length,0,t),e):t}const Cb={}.hasOwnProperty;function c5(e){const t={};let n=-1;for(;++n<e.length;)d5(t,e[n]);return t}function d5(e,t){let n;for(n in t){const a=(Cb.call(e,n)?e[n]:void 0)||(e[n]={}),i=t[n];let l;if(i)for(l in i){Cb.call(a,l)||(a[l]=[]);const o=i[l];u5(a[l],Array.isArray(o)?o:o?[o]:[])}}}function u5(e,t){let n=-1;const s=[];for(;++n<t.length;)(t[n].add==="after"?e:s).push(t[n]);aa(e,0,0,s)}function ak(e,t){const n=Number.parseInt(e,t);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function kl(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const Ys=yi(/[A-Za-z]/),Zn=yi(/[\dA-Za-z]/),m5=yi(/[#-'*+\--9=?A-Z^-~]/);function Pf(e){return e!==null&&(e<32||e===127)}const Of=yi(/\d/),h5=yi(/[\dA-Fa-f]/),p5=yi(/[!-/:-@[-`{-~]/);function vt(e){return e!==null&&e<-2}function Un(e){return e!==null&&(e<0||e===32)}function Kt(e){return e===-2||e===-1||e===32}const f5=yi(new RegExp("\\p{P}|\\p{S}","u")),g5=yi(/\s/);function yi(e){return t;function t(n){return n!==null&&n>-1&&e.test(String.fromCharCode(n))}}function no(e){const t=[];let n=-1,s=0,a=0;for(;++n<e.length;){const i=e.charCodeAt(n);let l="";if(i===37&&Zn(e.charCodeAt(n+1))&&Zn(e.charCodeAt(n+2)))a=2;else if(i<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(i))||(l=String.fromCharCode(i));else if(i>55295&&i<57344){const o=e.charCodeAt(n+1);i<56320&&o>56319&&o<57344?(l=String.fromCharCode(i,o),a=1):l=""}else l=String.fromCharCode(i);l&&(t.push(e.slice(s,n),encodeURIComponent(l)),s=n+a+1,l=""),a&&(n+=a,a=0)}return t.join("")+e.slice(s)}function gr(e,t,n,s){const a=s?s-1:Number.POSITIVE_INFINITY;let i=0;return l;function l(c){return Kt(c)?(e.enter(n),o(c)):t(c)}function o(c){return Kt(c)&&i++<a?(e.consume(c),o):(e.exit(n),t(c))}}const x5={tokenize:y5};function y5(e){const t=e.attempt(this.parser.constructs.contentInitial,s,a);let n;return t;function s(o){if(o===null){e.consume(o);return}return e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),gr(e,t,"linePrefix")}function a(o){return e.enter("paragraph"),i(o)}function i(o){const c=e.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=c),n=c,l(o)}function l(o){if(o===null){e.exit("chunkText"),e.exit("paragraph"),e.consume(o);return}return vt(o)?(e.consume(o),e.exit("chunkText"),i):(e.consume(o),l)}}const b5={tokenize:v5},kb={tokenize:w5};function v5(e){const t=this,n=[];let s=0,a,i,l;return o;function o(w){if(s<n.length){const N=n[s];return t.containerState=N[1],e.attempt(N[0].continuation,c,d)(w)}return d(w)}function c(w){if(s++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,a&&v();const N=t.events.length;let k=N,j;for(;k--;)if(t.events[k][0]==="exit"&&t.events[k][1].type==="chunkFlow"){j=t.events[k][1].end;break}b(s);let S=N;for(;S<t.events.length;)t.events[S][1].end={...j},S++;return aa(t.events,k+1,0,t.events.slice(N)),t.events.length=S,d(w)}return o(w)}function d(w){if(s===n.length){if(!a)return p(w);if(a.currentConstruct&&a.currentConstruct.concrete)return y(w);t.interrupt=!!(a.currentConstruct&&!a._gfmTableDynamicInterruptHack)}return t.containerState={},e.check(kb,u,m)(w)}function u(w){return a&&v(),b(s),p(w)}function m(w){return t.parser.lazy[t.now().line]=s!==n.length,l=t.now().offset,y(w)}function p(w){return t.containerState={},e.attempt(kb,f,y)(w)}function f(w){return s++,n.push([t.currentConstruct,t.containerState]),p(w)}function y(w){if(w===null){a&&v(),b(0),e.consume(w);return}return a=a||t.parser.flow(t.now()),e.enter("chunkFlow",{_tokenizer:a,contentType:"flow",previous:i}),g(w)}function g(w){if(w===null){x(e.exit("chunkFlow"),!0),b(0),e.consume(w);return}return vt(w)?(e.consume(w),x(e.exit("chunkFlow")),s=0,t.interrupt=void 0,o):(e.consume(w),g)}function x(w,N){const k=t.sliceStream(w);if(N&&k.push(null),w.previous=i,i&&(i.next=w),i=w,a.defineSkip(w.start),a.write(k),t.parser.lazy[w.start.line]){let j=a.events.length;for(;j--;)if(a.events[j][1].start.offset<l&&(!a.events[j][1].end||a.events[j][1].end.offset>l))return;const S=t.events.length;let _=S,C,D;for(;_--;)if(t.events[_][0]==="exit"&&t.events[_][1].type==="chunkFlow"){if(C){D=t.events[_][1].end;break}C=!0}for(b(s),j=S;j<t.events.length;)t.events[j][1].end={...D},j++;aa(t.events,_+1,0,t.events.slice(S)),t.events.length=j}}function b(w){let N=n.length;for(;N-- >w;){const k=n[N];t.containerState=k[1],k[0].exit.call(t,e)}n.length=w}function v(){a.write([null]),i=void 0,a=void 0,t.containerState._closeFlow=void 0}}function w5(e,t,n){return gr(e,e.attempt(this.parser.constructs.document,t,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function Sb(e){if(e===null||Un(e)||g5(e))return 1;if(f5(e))return 2}function hx(e,t,n){const s=[];let a=-1;for(;++a<e.length;){const i=e[a].resolveAll;i&&!s.includes(i)&&(t=i(t,n),s.push(i))}return t}const Mf={name:"attention",resolveAll:j5,tokenize:N5};function j5(e,t){let n=-1,s,a,i,l,o,c,d,u;for(;++n<e.length;)if(e[n][0]==="enter"&&e[n][1].type==="attentionSequence"&&e[n][1]._close){for(s=n;s--;)if(e[s][0]==="exit"&&e[s][1].type==="attentionSequence"&&e[s][1]._open&&t.sliceSerialize(e[s][1]).charCodeAt(0)===t.sliceSerialize(e[n][1]).charCodeAt(0)){if((e[s][1]._close||e[n][1]._open)&&(e[n][1].end.offset-e[n][1].start.offset)%3&&!((e[s][1].end.offset-e[s][1].start.offset+e[n][1].end.offset-e[n][1].start.offset)%3))continue;c=e[s][1].end.offset-e[s][1].start.offset>1&&e[n][1].end.offset-e[n][1].start.offset>1?2:1;const m={...e[s][1].end},p={...e[n][1].start};_b(m,-c),_b(p,c),l={type:c>1?"strongSequence":"emphasisSequence",start:m,end:{...e[s][1].end}},o={type:c>1?"strongSequence":"emphasisSequence",start:{...e[n][1].start},end:p},i={type:c>1?"strongText":"emphasisText",start:{...e[s][1].end},end:{...e[n][1].start}},a={type:c>1?"strong":"emphasis",start:{...l.start},end:{...o.end}},e[s][1].end={...l.start},e[n][1].start={...o.end},d=[],e[s][1].end.offset-e[s][1].start.offset&&(d=ds(d,[["enter",e[s][1],t],["exit",e[s][1],t]])),d=ds(d,[["enter",a,t],["enter",l,t],["exit",l,t],["enter",i,t]]),d=ds(d,hx(t.parser.constructs.insideSpan.null,e.slice(s+1,n),t)),d=ds(d,[["exit",i,t],["enter",o,t],["exit",o,t],["exit",a,t]]),e[n][1].end.offset-e[n][1].start.offset?(u=2,d=ds(d,[["enter",e[n][1],t],["exit",e[n][1],t]])):u=0,aa(e,s-1,n-s+3,d),n=s+d.length-u-2;break}}for(n=-1;++n<e.length;)e[n][1].type==="attentionSequence"&&(e[n][1].type="data");return e}function N5(e,t){const n=this.parser.constructs.attentionMarkers.null,s=this.previous,a=Sb(s);let i;return l;function l(c){return i=c,e.enter("attentionSequence"),o(c)}function o(c){if(c===i)return e.consume(c),o;const d=e.exit("attentionSequence"),u=Sb(c),m=!u||u===2&&a||n.includes(c),p=!a||a===2&&u||n.includes(s);return d._open=!!(i===42?m:m&&(a||!p)),d._close=!!(i===42?p:p&&(u||!m)),t(c)}}function _b(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}const C5={name:"autolink",tokenize:k5};function k5(e,t,n){let s=0;return a;function a(f){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(f),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),i}function i(f){return Ys(f)?(e.consume(f),l):f===64?n(f):d(f)}function l(f){return f===43||f===45||f===46||Zn(f)?(s=1,o(f)):d(f)}function o(f){return f===58?(e.consume(f),s=0,c):(f===43||f===45||f===46||Zn(f))&&s++<32?(e.consume(f),o):(s=0,d(f))}function c(f){return f===62?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(f),e.exit("autolinkMarker"),e.exit("autolink"),t):f===null||f===32||f===60||Pf(f)?n(f):(e.consume(f),c)}function d(f){return f===64?(e.consume(f),u):m5(f)?(e.consume(f),d):n(f)}function u(f){return Zn(f)?m(f):n(f)}function m(f){return f===46?(e.consume(f),s=0,u):f===62?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(f),e.exit("autolinkMarker"),e.exit("autolink"),t):p(f)}function p(f){if((f===45||Zn(f))&&s++<63){const y=f===45?p:m;return e.consume(f),y}return n(f)}}const Xu={partial:!0,tokenize:S5};function S5(e,t,n){return s;function s(i){return Kt(i)?gr(e,a,"linePrefix")(i):a(i)}function a(i){return i===null||vt(i)?t(i):n(i)}}const ik={continuation:{tokenize:E5},exit:D5,name:"blockQuote",tokenize:_5};function _5(e,t,n){const s=this;return a;function a(l){if(l===62){const o=s.containerState;return o.open||(e.enter("blockQuote",{_container:!0}),o.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(l),e.exit("blockQuoteMarker"),i}return n(l)}function i(l){return Kt(l)?(e.enter("blockQuotePrefixWhitespace"),e.consume(l),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),t):(e.exit("blockQuotePrefix"),t(l))}}function E5(e,t,n){const s=this;return a;function a(l){return Kt(l)?gr(e,i,"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(l):i(l)}function i(l){return e.attempt(ik,t,n)(l)}}function D5(e){e.exit("blockQuote")}const lk={name:"characterEscape",tokenize:T5};function T5(e,t,n){return s;function s(i){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(i),e.exit("escapeMarker"),a}function a(i){return p5(i)?(e.enter("characterEscapeValue"),e.consume(i),e.exit("characterEscapeValue"),e.exit("characterEscape"),t):n(i)}}const ok={name:"characterReference",tokenize:A5};function A5(e,t,n){const s=this;let a=0,i,l;return o;function o(m){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(m),e.exit("characterReferenceMarker"),c}function c(m){return m===35?(e.enter("characterReferenceMarkerNumeric"),e.consume(m),e.exit("characterReferenceMarkerNumeric"),d):(e.enter("characterReferenceValue"),i=31,l=Zn,u(m))}function d(m){return m===88||m===120?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(m),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),i=6,l=h5,u):(e.enter("characterReferenceValue"),i=7,l=Of,u(m))}function u(m){if(m===59&&a){const p=e.exit("characterReferenceValue");return l===Zn&&!mx(s.sliceSerialize(p))?n(m):(e.enter("characterReferenceMarker"),e.consume(m),e.exit("characterReferenceMarker"),e.exit("characterReference"),t)}return l(m)&&a++<i?(e.consume(m),u):n(m)}}const Eb={partial:!0,tokenize:O5},Db={concrete:!0,name:"codeFenced",tokenize:P5};function P5(e,t,n){const s=this,a={partial:!0,tokenize:k};let i=0,l=0,o;return c;function c(j){return d(j)}function d(j){const S=s.events[s.events.length-1];return i=S&&S[1].type==="linePrefix"?S[2].sliceSerialize(S[1],!0).length:0,o=j,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),u(j)}function u(j){return j===o?(l++,e.consume(j),u):l<3?n(j):(e.exit("codeFencedFenceSequence"),Kt(j)?gr(e,m,"whitespace")(j):m(j))}function m(j){return j===null||vt(j)?(e.exit("codeFencedFence"),s.interrupt?t(j):e.check(Eb,g,N)(j)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),p(j))}function p(j){return j===null||vt(j)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),m(j)):Kt(j)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),gr(e,f,"whitespace")(j)):j===96&&j===o?n(j):(e.consume(j),p)}function f(j){return j===null||vt(j)?m(j):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),y(j))}function y(j){return j===null||vt(j)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),m(j)):j===96&&j===o?n(j):(e.consume(j),y)}function g(j){return e.attempt(a,N,x)(j)}function x(j){return e.enter("lineEnding"),e.consume(j),e.exit("lineEnding"),b}function b(j){return i>0&&Kt(j)?gr(e,v,"linePrefix",i+1)(j):v(j)}function v(j){return j===null||vt(j)?e.check(Eb,g,N)(j):(e.enter("codeFlowValue"),w(j))}function w(j){return j===null||vt(j)?(e.exit("codeFlowValue"),v(j)):(e.consume(j),w)}function N(j){return e.exit("codeFenced"),t(j)}function k(j,S,_){let C=0;return D;function D(L){return j.enter("lineEnding"),j.consume(L),j.exit("lineEnding"),A}function A(L){return j.enter("codeFencedFence"),Kt(L)?gr(j,E,"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(L):E(L)}function E(L){return L===o?(j.enter("codeFencedFenceSequence"),T(L)):_(L)}function T(L){return L===o?(C++,j.consume(L),T):C>=l?(j.exit("codeFencedFenceSequence"),Kt(L)?gr(j,M,"whitespace")(L):M(L)):_(L)}function M(L){return L===null||vt(L)?(j.exit("codeFencedFence"),S(L)):_(L)}}}function O5(e,t,n){const s=this;return a;function a(l){return l===null?n(l):(e.enter("lineEnding"),e.consume(l),e.exit("lineEnding"),i)}function i(l){return s.parser.lazy[s.now().line]?n(l):t(l)}}const nh={name:"codeIndented",tokenize:I5},M5={partial:!0,tokenize:L5};function I5(e,t,n){const s=this;return a;function a(d){return e.enter("codeIndented"),gr(e,i,"linePrefix",5)(d)}function i(d){const u=s.events[s.events.length-1];return u&&u[1].type==="linePrefix"&&u[2].sliceSerialize(u[1],!0).length>=4?l(d):n(d)}function l(d){return d===null?c(d):vt(d)?e.attempt(M5,l,c)(d):(e.enter("codeFlowValue"),o(d))}function o(d){return d===null||vt(d)?(e.exit("codeFlowValue"),l(d)):(e.consume(d),o)}function c(d){return e.exit("codeIndented"),t(d)}}function L5(e,t,n){const s=this;return a;function a(l){return s.parser.lazy[s.now().line]?n(l):vt(l)?(e.enter("lineEnding"),e.consume(l),e.exit("lineEnding"),a):gr(e,i,"linePrefix",5)(l)}function i(l){const o=s.events[s.events.length-1];return o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?t(l):vt(l)?a(l):n(l)}}const R5={name:"codeText",previous:F5,resolve:$5,tokenize:z5};function $5(e){let t=e.length-4,n=3,s,a;if((e[n][1].type==="lineEnding"||e[n][1].type==="space")&&(e[t][1].type==="lineEnding"||e[t][1].type==="space")){for(s=n;++s<t;)if(e[s][1].type==="codeTextData"){e[n][1].type="codeTextPadding",e[t][1].type="codeTextPadding",n+=2,t-=2;break}}for(s=n-1,t++;++s<=t;)a===void 0?s!==t&&e[s][1].type!=="lineEnding"&&(a=s):(s===t||e[s][1].type==="lineEnding")&&(e[a][1].type="codeTextData",s!==a+2&&(e[a][1].end=e[s-1][1].end,e.splice(a+2,s-a-2),t-=s-a-2,s=a+2),a=void 0);return e}function F5(e){return e!==96||this.events[this.events.length-1][1].type==="characterEscape"}function z5(e,t,n){let s=0,a,i;return l;function l(m){return e.enter("codeText"),e.enter("codeTextSequence"),o(m)}function o(m){return m===96?(e.consume(m),s++,o):(e.exit("codeTextSequence"),c(m))}function c(m){return m===null?n(m):m===32?(e.enter("space"),e.consume(m),e.exit("space"),c):m===96?(i=e.enter("codeTextSequence"),a=0,u(m)):vt(m)?(e.enter("lineEnding"),e.consume(m),e.exit("lineEnding"),c):(e.enter("codeTextData"),d(m))}function d(m){return m===null||m===32||m===96||vt(m)?(e.exit("codeTextData"),c(m)):(e.consume(m),d)}function u(m){return m===96?(e.consume(m),a++,u):a===s?(e.exit("codeTextSequence"),e.exit("codeText"),t(m)):(i.type="codeTextData",d(m))}}class B5{constructor(t){this.left=t?[...t]:[],this.right=[]}get(t){if(t<0||t>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+t+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return t<this.left.length?this.left[t]:this.right[this.right.length-t+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(t,n){const s=n??Number.POSITIVE_INFINITY;return s<this.left.length?this.left.slice(t,s):t>this.left.length?this.right.slice(this.right.length-s+this.left.length,this.right.length-t+this.left.length).reverse():this.left.slice(t).concat(this.right.slice(this.right.length-s+this.left.length).reverse())}splice(t,n,s){const a=n||0;this.setCursor(Math.trunc(t));const i=this.right.splice(this.right.length-a,Number.POSITIVE_INFINITY);return s&&yo(this.left,s),i.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(t){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(t)}pushMany(t){this.setCursor(Number.POSITIVE_INFINITY),yo(this.left,t)}unshift(t){this.setCursor(0),this.right.push(t)}unshiftMany(t){this.setCursor(0),yo(this.right,t.reverse())}setCursor(t){if(!(t===this.left.length||t>this.left.length&&this.right.length===0||t<0&&this.left.length===0))if(t<this.left.length){const n=this.left.splice(t,Number.POSITIVE_INFINITY);yo(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-t,Number.POSITIVE_INFINITY);yo(this.left,n.reverse())}}}function yo(e,t){let n=0;if(t.length<1e4)e.push(...t);else for(;n<t.length;)e.push(...t.slice(n,n+1e4)),n+=1e4}function ck(e){const t={};let n=-1,s,a,i,l,o,c,d;const u=new B5(e);for(;++n<u.length;){for(;n in t;)n=t[n];if(s=u.get(n),n&&s[1].type==="chunkFlow"&&u.get(n-1)[1].type==="listItemPrefix"&&(c=s[1]._tokenizer.events,i=0,i<c.length&&c[i][1].type==="lineEndingBlank"&&(i+=2),i<c.length&&c[i][1].type==="content"))for(;++i<c.length&&c[i][1].type!=="content";)c[i][1].type==="chunkText"&&(c[i][1]._isInFirstContentOfListItem=!0,i++);if(s[0]==="enter")s[1].contentType&&(Object.assign(t,U5(u,n)),n=t[n],d=!0);else if(s[1]._container){for(i=n,a=void 0;i--;)if(l=u.get(i),l[1].type==="lineEnding"||l[1].type==="lineEndingBlank")l[0]==="enter"&&(a&&(u.get(a)[1].type="lineEndingBlank"),l[1].type="lineEnding",a=i);else if(!(l[1].type==="linePrefix"||l[1].type==="listItemIndent"))break;a&&(s[1].end={...u.get(a)[1].start},o=u.slice(a,n),o.unshift(s),u.splice(a,n-a+1,o))}}return aa(e,0,Number.POSITIVE_INFINITY,u.slice(0)),!d}function U5(e,t){const n=e.get(t)[1],s=e.get(t)[2];let a=t-1;const i=[];let l=n._tokenizer;l||(l=s.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(l._contentTypeTextTrailing=!0));const o=l.events,c=[],d={};let u,m,p=-1,f=n,y=0,g=0;const x=[g];for(;f;){for(;e.get(++a)[1]!==f;);i.push(a),f._tokenizer||(u=s.sliceStream(f),f.next||u.push(null),m&&l.defineSkip(f.start),f._isInFirstContentOfListItem&&(l._gfmTasklistFirstContentOfListItem=!0),l.write(u),f._isInFirstContentOfListItem&&(l._gfmTasklistFirstContentOfListItem=void 0)),m=f,f=f.next}for(f=n;++p<o.length;)o[p][0]==="exit"&&o[p-1][0]==="enter"&&o[p][1].type===o[p-1][1].type&&o[p][1].start.line!==o[p][1].end.line&&(g=p+1,x.push(g),f._tokenizer=void 0,f.previous=void 0,f=f.next);for(l.events=[],f?(f._tokenizer=void 0,f.previous=void 0):x.pop(),p=x.length;p--;){const b=o.slice(x[p],x[p+1]),v=i.pop();c.push([v,v+b.length-1]),e.splice(v,2,b)}for(c.reverse(),p=-1;++p<c.length;)d[y+c[p][0]]=y+c[p][1],y+=c[p][1]-c[p][0]-1;return d}const q5={resolve:W5,tokenize:Y5},H5={partial:!0,tokenize:V5};function W5(e){return ck(e),e}function Y5(e,t){let n;return s;function s(o){return e.enter("content"),n=e.enter("chunkContent",{contentType:"content"}),a(o)}function a(o){return o===null?i(o):vt(o)?e.check(H5,l,i)(o):(e.consume(o),a)}function i(o){return e.exit("chunkContent"),e.exit("content"),t(o)}function l(o){return e.consume(o),e.exit("chunkContent"),n.next=e.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,a}}function V5(e,t,n){const s=this;return a;function a(l){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(l),e.exit("lineEnding"),gr(e,i,"linePrefix")}function i(l){if(l===null||vt(l))return n(l);const o=s.events[s.events.length-1];return!s.parser.constructs.disable.null.includes("codeIndented")&&o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?t(l):e.interrupt(s.parser.constructs.flow,n,t)(l)}}function dk(e,t,n,s,a,i,l,o,c){const d=c||Number.POSITIVE_INFINITY;let u=0;return m;function m(b){return b===60?(e.enter(s),e.enter(a),e.enter(i),e.consume(b),e.exit(i),p):b===null||b===32||b===41||Pf(b)?n(b):(e.enter(s),e.enter(l),e.enter(o),e.enter("chunkString",{contentType:"string"}),g(b))}function p(b){return b===62?(e.enter(i),e.consume(b),e.exit(i),e.exit(a),e.exit(s),t):(e.enter(o),e.enter("chunkString",{contentType:"string"}),f(b))}function f(b){return b===62?(e.exit("chunkString"),e.exit(o),p(b)):b===null||b===60||vt(b)?n(b):(e.consume(b),b===92?y:f)}function y(b){return b===60||b===62||b===92?(e.consume(b),f):f(b)}function g(b){return!u&&(b===null||b===41||Un(b))?(e.exit("chunkString"),e.exit(o),e.exit(l),e.exit(s),t(b)):u<d&&b===40?(e.consume(b),u++,g):b===41?(e.consume(b),u--,g):b===null||b===32||b===40||Pf(b)?n(b):(e.consume(b),b===92?x:g)}function x(b){return b===40||b===41||b===92?(e.consume(b),g):g(b)}}function uk(e,t,n,s,a,i){const l=this;let o=0,c;return d;function d(f){return e.enter(s),e.enter(a),e.consume(f),e.exit(a),e.enter(i),u}function u(f){return o>999||f===null||f===91||f===93&&!c||f===94&&!o&&"_hiddenFootnoteSupport"in l.parser.constructs?n(f):f===93?(e.exit(i),e.enter(a),e.consume(f),e.exit(a),e.exit(s),t):vt(f)?(e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),u):(e.enter("chunkString",{contentType:"string"}),m(f))}function m(f){return f===null||f===91||f===93||vt(f)||o++>999?(e.exit("chunkString"),u(f)):(e.consume(f),c||(c=!Kt(f)),f===92?p:m)}function p(f){return f===91||f===92||f===93?(e.consume(f),o++,m):m(f)}}function mk(e,t,n,s,a,i){let l;return o;function o(p){return p===34||p===39||p===40?(e.enter(s),e.enter(a),e.consume(p),e.exit(a),l=p===40?41:p,c):n(p)}function c(p){return p===l?(e.enter(a),e.consume(p),e.exit(a),e.exit(s),t):(e.enter(i),d(p))}function d(p){return p===l?(e.exit(i),c(l)):p===null?n(p):vt(p)?(e.enter("lineEnding"),e.consume(p),e.exit("lineEnding"),gr(e,d,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),u(p))}function u(p){return p===l||p===null||vt(p)?(e.exit("chunkString"),d(p)):(e.consume(p),p===92?m:u)}function m(p){return p===l||p===92?(e.consume(p),u):u(p)}}function Wo(e,t){let n;return s;function s(a){return vt(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),n=!0,s):Kt(a)?gr(e,s,n?"linePrefix":"lineSuffix")(a):t(a)}}const G5={name:"definition",tokenize:X5},K5={partial:!0,tokenize:J5};function X5(e,t,n){const s=this;let a;return i;function i(f){return e.enter("definition"),l(f)}function l(f){return uk.call(s,e,o,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(f)}function o(f){return a=kl(s.sliceSerialize(s.events[s.events.length-1][1]).slice(1,-1)),f===58?(e.enter("definitionMarker"),e.consume(f),e.exit("definitionMarker"),c):n(f)}function c(f){return Un(f)?Wo(e,d)(f):d(f)}function d(f){return dk(e,u,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(f)}function u(f){return e.attempt(K5,m,m)(f)}function m(f){return Kt(f)?gr(e,p,"whitespace")(f):p(f)}function p(f){return f===null||vt(f)?(e.exit("definition"),s.parser.defined.push(a),t(f)):n(f)}}function J5(e,t,n){return s;function s(o){return Un(o)?Wo(e,a)(o):n(o)}function a(o){return mk(e,i,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(o)}function i(o){return Kt(o)?gr(e,l,"whitespace")(o):l(o)}function l(o){return o===null||vt(o)?t(o):n(o)}}const Q5={name:"hardBreakEscape",tokenize:Z5};function Z5(e,t,n){return s;function s(i){return e.enter("hardBreakEscape"),e.consume(i),a}function a(i){return vt(i)?(e.exit("hardBreakEscape"),t(i)):n(i)}}const eO={name:"headingAtx",resolve:tO,tokenize:rO};function tO(e,t){let n=e.length-2,s=3,a,i;return e[s][1].type==="whitespace"&&(s+=2),n-2>s&&e[n][1].type==="whitespace"&&(n-=2),e[n][1].type==="atxHeadingSequence"&&(s===n-1||n-4>s&&e[n-2][1].type==="whitespace")&&(n-=s+1===n?2:4),n>s&&(a={type:"atxHeadingText",start:e[s][1].start,end:e[n][1].end},i={type:"chunkText",start:e[s][1].start,end:e[n][1].end,contentType:"text"},aa(e,s,n-s+1,[["enter",a,t],["enter",i,t],["exit",i,t],["exit",a,t]])),e}function rO(e,t,n){let s=0;return a;function a(u){return e.enter("atxHeading"),i(u)}function i(u){return e.enter("atxHeadingSequence"),l(u)}function l(u){return u===35&&s++<6?(e.consume(u),l):u===null||Un(u)?(e.exit("atxHeadingSequence"),o(u)):n(u)}function o(u){return u===35?(e.enter("atxHeadingSequence"),c(u)):u===null||vt(u)?(e.exit("atxHeading"),t(u)):Kt(u)?gr(e,o,"whitespace")(u):(e.enter("atxHeadingText"),d(u))}function c(u){return u===35?(e.consume(u),c):(e.exit("atxHeadingSequence"),o(u))}function d(u){return u===null||u===35||Un(u)?(e.exit("atxHeadingText"),o(u)):(e.consume(u),d)}}const nO=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],Tb=["pre","script","style","textarea"],sO={concrete:!0,name:"htmlFlow",resolveTo:lO,tokenize:oO},aO={partial:!0,tokenize:dO},iO={partial:!0,tokenize:cO};function lO(e){let t=e.length;for(;t--&&!(e[t][0]==="enter"&&e[t][1].type==="htmlFlow"););return t>1&&e[t-2][1].type==="linePrefix"&&(e[t][1].start=e[t-2][1].start,e[t+1][1].start=e[t-2][1].start,e.splice(t-2,2)),e}function oO(e,t,n){const s=this;let a,i,l,o,c;return d;function d(O){return u(O)}function u(O){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(O),m}function m(O){return O===33?(e.consume(O),p):O===47?(e.consume(O),i=!0,g):O===63?(e.consume(O),a=3,s.interrupt?t:I):Ys(O)?(e.consume(O),l=String.fromCharCode(O),x):n(O)}function p(O){return O===45?(e.consume(O),a=2,f):O===91?(e.consume(O),a=5,o=0,y):Ys(O)?(e.consume(O),a=4,s.interrupt?t:I):n(O)}function f(O){return O===45?(e.consume(O),s.interrupt?t:I):n(O)}function y(O){const K="CDATA[";return O===K.charCodeAt(o++)?(e.consume(O),o===K.length?s.interrupt?t:E:y):n(O)}function g(O){return Ys(O)?(e.consume(O),l=String.fromCharCode(O),x):n(O)}function x(O){if(O===null||O===47||O===62||Un(O)){const K=O===47,J=l.toLowerCase();return!K&&!i&&Tb.includes(J)?(a=1,s.interrupt?t(O):E(O)):nO.includes(l.toLowerCase())?(a=6,K?(e.consume(O),b):s.interrupt?t(O):E(O)):(a=7,s.interrupt&&!s.parser.lazy[s.now().line]?n(O):i?v(O):w(O))}return O===45||Zn(O)?(e.consume(O),l+=String.fromCharCode(O),x):n(O)}function b(O){return O===62?(e.consume(O),s.interrupt?t:E):n(O)}function v(O){return Kt(O)?(e.consume(O),v):D(O)}function w(O){return O===47?(e.consume(O),D):O===58||O===95||Ys(O)?(e.consume(O),N):Kt(O)?(e.consume(O),w):D(O)}function N(O){return O===45||O===46||O===58||O===95||Zn(O)?(e.consume(O),N):k(O)}function k(O){return O===61?(e.consume(O),j):Kt(O)?(e.consume(O),k):w(O)}function j(O){return O===null||O===60||O===61||O===62||O===96?n(O):O===34||O===39?(e.consume(O),c=O,S):Kt(O)?(e.consume(O),j):_(O)}function S(O){return O===c?(e.consume(O),c=null,C):O===null||vt(O)?n(O):(e.consume(O),S)}function _(O){return O===null||O===34||O===39||O===47||O===60||O===61||O===62||O===96||Un(O)?k(O):(e.consume(O),_)}function C(O){return O===47||O===62||Kt(O)?w(O):n(O)}function D(O){return O===62?(e.consume(O),A):n(O)}function A(O){return O===null||vt(O)?E(O):Kt(O)?(e.consume(O),A):n(O)}function E(O){return O===45&&a===2?(e.consume(O),P):O===60&&a===1?(e.consume(O),$):O===62&&a===4?(e.consume(O),z):O===63&&a===3?(e.consume(O),I):O===93&&a===5?(e.consume(O),U):vt(O)&&(a===6||a===7)?(e.exit("htmlFlowData"),e.check(aO,F,T)(O)):O===null||vt(O)?(e.exit("htmlFlowData"),T(O)):(e.consume(O),E)}function T(O){return e.check(iO,M,F)(O)}function M(O){return e.enter("lineEnding"),e.consume(O),e.exit("lineEnding"),L}function L(O){return O===null||vt(O)?T(O):(e.enter("htmlFlowData"),E(O))}function P(O){return O===45?(e.consume(O),I):E(O)}function $(O){return O===47?(e.consume(O),l="",R):E(O)}function R(O){if(O===62){const K=l.toLowerCase();return Tb.includes(K)?(e.consume(O),z):E(O)}return Ys(O)&&l.length<8?(e.consume(O),l+=String.fromCharCode(O),R):E(O)}function U(O){return O===93?(e.consume(O),I):E(O)}function I(O){return O===62?(e.consume(O),z):O===45&&a===2?(e.consume(O),I):E(O)}function z(O){return O===null||vt(O)?(e.exit("htmlFlowData"),F(O)):(e.consume(O),z)}function F(O){return e.exit("htmlFlow"),t(O)}}function cO(e,t,n){const s=this;return a;function a(l){return vt(l)?(e.enter("lineEnding"),e.consume(l),e.exit("lineEnding"),i):n(l)}function i(l){return s.parser.lazy[s.now().line]?n(l):t(l)}}function dO(e,t,n){return s;function s(a){return e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),e.attempt(Xu,t,n)}}const uO={name:"htmlText",tokenize:mO};function mO(e,t,n){const s=this;let a,i,l;return o;function o(I){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(I),c}function c(I){return I===33?(e.consume(I),d):I===47?(e.consume(I),k):I===63?(e.consume(I),w):Ys(I)?(e.consume(I),_):n(I)}function d(I){return I===45?(e.consume(I),u):I===91?(e.consume(I),i=0,y):Ys(I)?(e.consume(I),v):n(I)}function u(I){return I===45?(e.consume(I),f):n(I)}function m(I){return I===null?n(I):I===45?(e.consume(I),p):vt(I)?(l=m,$(I)):(e.consume(I),m)}function p(I){return I===45?(e.consume(I),f):m(I)}function f(I){return I===62?P(I):I===45?p(I):m(I)}function y(I){const z="CDATA[";return I===z.charCodeAt(i++)?(e.consume(I),i===z.length?g:y):n(I)}function g(I){return I===null?n(I):I===93?(e.consume(I),x):vt(I)?(l=g,$(I)):(e.consume(I),g)}function x(I){return I===93?(e.consume(I),b):g(I)}function b(I){return I===62?P(I):I===93?(e.consume(I),b):g(I)}function v(I){return I===null||I===62?P(I):vt(I)?(l=v,$(I)):(e.consume(I),v)}function w(I){return I===null?n(I):I===63?(e.consume(I),N):vt(I)?(l=w,$(I)):(e.consume(I),w)}function N(I){return I===62?P(I):w(I)}function k(I){return Ys(I)?(e.consume(I),j):n(I)}function j(I){return I===45||Zn(I)?(e.consume(I),j):S(I)}function S(I){return vt(I)?(l=S,$(I)):Kt(I)?(e.consume(I),S):P(I)}function _(I){return I===45||Zn(I)?(e.consume(I),_):I===47||I===62||Un(I)?C(I):n(I)}function C(I){return I===47?(e.consume(I),P):I===58||I===95||Ys(I)?(e.consume(I),D):vt(I)?(l=C,$(I)):Kt(I)?(e.consume(I),C):P(I)}function D(I){return I===45||I===46||I===58||I===95||Zn(I)?(e.consume(I),D):A(I)}function A(I){return I===61?(e.consume(I),E):vt(I)?(l=A,$(I)):Kt(I)?(e.consume(I),A):C(I)}function E(I){return I===null||I===60||I===61||I===62||I===96?n(I):I===34||I===39?(e.consume(I),a=I,T):vt(I)?(l=E,$(I)):Kt(I)?(e.consume(I),E):(e.consume(I),M)}function T(I){return I===a?(e.consume(I),a=void 0,L):I===null?n(I):vt(I)?(l=T,$(I)):(e.consume(I),T)}function M(I){return I===null||I===34||I===39||I===60||I===61||I===96?n(I):I===47||I===62||Un(I)?C(I):(e.consume(I),M)}function L(I){return I===47||I===62||Un(I)?C(I):n(I)}function P(I){return I===62?(e.consume(I),e.exit("htmlTextData"),e.exit("htmlText"),t):n(I)}function $(I){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(I),e.exit("lineEnding"),R}function R(I){return Kt(I)?gr(e,U,"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(I):U(I)}function U(I){return e.enter("htmlTextData"),l(I)}}const px={name:"labelEnd",resolveAll:gO,resolveTo:xO,tokenize:yO},hO={tokenize:bO},pO={tokenize:vO},fO={tokenize:wO};function gO(e){let t=-1;const n=[];for(;++t<e.length;){const s=e[t][1];if(n.push(e[t]),s.type==="labelImage"||s.type==="labelLink"||s.type==="labelEnd"){const a=s.type==="labelImage"?4:2;s.type="data",t+=a}}return e.length!==n.length&&aa(e,0,e.length,n),e}function xO(e,t){let n=e.length,s=0,a,i,l,o;for(;n--;)if(a=e[n][1],i){if(a.type==="link"||a.type==="labelLink"&&a._inactive)break;e[n][0]==="enter"&&a.type==="labelLink"&&(a._inactive=!0)}else if(l){if(e[n][0]==="enter"&&(a.type==="labelImage"||a.type==="labelLink")&&!a._balanced&&(i=n,a.type!=="labelLink")){s=2;break}}else a.type==="labelEnd"&&(l=n);const c={type:e[i][1].type==="labelLink"?"link":"image",start:{...e[i][1].start},end:{...e[e.length-1][1].end}},d={type:"label",start:{...e[i][1].start},end:{...e[l][1].end}},u={type:"labelText",start:{...e[i+s+2][1].end},end:{...e[l-2][1].start}};return o=[["enter",c,t],["enter",d,t]],o=ds(o,e.slice(i+1,i+s+3)),o=ds(o,[["enter",u,t]]),o=ds(o,hx(t.parser.constructs.insideSpan.null,e.slice(i+s+4,l-3),t)),o=ds(o,[["exit",u,t],e[l-2],e[l-1],["exit",d,t]]),o=ds(o,e.slice(l+1)),o=ds(o,[["exit",c,t]]),aa(e,i,e.length,o),e}function yO(e,t,n){const s=this;let a=s.events.length,i,l;for(;a--;)if((s.events[a][1].type==="labelImage"||s.events[a][1].type==="labelLink")&&!s.events[a][1]._balanced){i=s.events[a][1];break}return o;function o(p){return i?i._inactive?m(p):(l=s.parser.defined.includes(kl(s.sliceSerialize({start:i.end,end:s.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(p),e.exit("labelMarker"),e.exit("labelEnd"),c):n(p)}function c(p){return p===40?e.attempt(hO,u,l?u:m)(p):p===91?e.attempt(pO,u,l?d:m)(p):l?u(p):m(p)}function d(p){return e.attempt(fO,u,m)(p)}function u(p){return t(p)}function m(p){return i._balanced=!0,n(p)}}function bO(e,t,n){return s;function s(m){return e.enter("resource"),e.enter("resourceMarker"),e.consume(m),e.exit("resourceMarker"),a}function a(m){return Un(m)?Wo(e,i)(m):i(m)}function i(m){return m===41?u(m):dk(e,l,o,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(m)}function l(m){return Un(m)?Wo(e,c)(m):u(m)}function o(m){return n(m)}function c(m){return m===34||m===39||m===40?mk(e,d,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(m):u(m)}function d(m){return Un(m)?Wo(e,u)(m):u(m)}function u(m){return m===41?(e.enter("resourceMarker"),e.consume(m),e.exit("resourceMarker"),e.exit("resource"),t):n(m)}}function vO(e,t,n){const s=this;return a;function a(o){return uk.call(s,e,i,l,"reference","referenceMarker","referenceString")(o)}function i(o){return s.parser.defined.includes(kl(s.sliceSerialize(s.events[s.events.length-1][1]).slice(1,-1)))?t(o):n(o)}function l(o){return n(o)}}function wO(e,t,n){return s;function s(i){return e.enter("reference"),e.enter("referenceMarker"),e.consume(i),e.exit("referenceMarker"),a}function a(i){return i===93?(e.enter("referenceMarker"),e.consume(i),e.exit("referenceMarker"),e.exit("reference"),t):n(i)}}const jO={name:"labelStartImage",resolveAll:px.resolveAll,tokenize:NO};function NO(e,t,n){const s=this;return a;function a(o){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(o),e.exit("labelImageMarker"),i}function i(o){return o===91?(e.enter("labelMarker"),e.consume(o),e.exit("labelMarker"),e.exit("labelImage"),l):n(o)}function l(o){return o===94&&"_hiddenFootnoteSupport"in s.parser.constructs?n(o):t(o)}}const CO={name:"labelStartLink",resolveAll:px.resolveAll,tokenize:kO};function kO(e,t,n){const s=this;return a;function a(l){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(l),e.exit("labelMarker"),e.exit("labelLink"),i}function i(l){return l===94&&"_hiddenFootnoteSupport"in s.parser.constructs?n(l):t(l)}}const sh={name:"lineEnding",tokenize:SO};function SO(e,t){return n;function n(s){return e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),gr(e,t,"linePrefix")}}const Ed={name:"thematicBreak",tokenize:_O};function _O(e,t,n){let s=0,a;return i;function i(d){return e.enter("thematicBreak"),l(d)}function l(d){return a=d,o(d)}function o(d){return d===a?(e.enter("thematicBreakSequence"),c(d)):s>=3&&(d===null||vt(d))?(e.exit("thematicBreak"),t(d)):n(d)}function c(d){return d===a?(e.consume(d),s++,c):(e.exit("thematicBreakSequence"),Kt(d)?gr(e,o,"whitespace")(d):o(d))}}const In={continuation:{tokenize:AO},exit:OO,name:"list",tokenize:TO},EO={partial:!0,tokenize:MO},DO={partial:!0,tokenize:PO};function TO(e,t,n){const s=this,a=s.events[s.events.length-1];let i=a&&a[1].type==="linePrefix"?a[2].sliceSerialize(a[1],!0).length:0,l=0;return o;function o(f){const y=s.containerState.type||(f===42||f===43||f===45?"listUnordered":"listOrdered");if(y==="listUnordered"?!s.containerState.marker||f===s.containerState.marker:Of(f)){if(s.containerState.type||(s.containerState.type=y,e.enter(y,{_container:!0})),y==="listUnordered")return e.enter("listItemPrefix"),f===42||f===45?e.check(Ed,n,d)(f):d(f);if(!s.interrupt||f===49)return e.enter("listItemPrefix"),e.enter("listItemValue"),c(f)}return n(f)}function c(f){return Of(f)&&++l<10?(e.consume(f),c):(!s.interrupt||l<2)&&(s.containerState.marker?f===s.containerState.marker:f===41||f===46)?(e.exit("listItemValue"),d(f)):n(f)}function d(f){return e.enter("listItemMarker"),e.consume(f),e.exit("listItemMarker"),s.containerState.marker=s.containerState.marker||f,e.check(Xu,s.interrupt?n:u,e.attempt(EO,p,m))}function u(f){return s.containerState.initialBlankLine=!0,i++,p(f)}function m(f){return Kt(f)?(e.enter("listItemPrefixWhitespace"),e.consume(f),e.exit("listItemPrefixWhitespace"),p):n(f)}function p(f){return s.containerState.size=i+s.sliceSerialize(e.exit("listItemPrefix"),!0).length,t(f)}}function AO(e,t,n){const s=this;return s.containerState._closeFlow=void 0,e.check(Xu,a,i);function a(o){return s.containerState.furtherBlankLines=s.containerState.furtherBlankLines||s.containerState.initialBlankLine,gr(e,t,"listItemIndent",s.containerState.size+1)(o)}function i(o){return s.containerState.furtherBlankLines||!Kt(o)?(s.containerState.furtherBlankLines=void 0,s.containerState.initialBlankLine=void 0,l(o)):(s.containerState.furtherBlankLines=void 0,s.containerState.initialBlankLine=void 0,e.attempt(DO,t,l)(o))}function l(o){return s.containerState._closeFlow=!0,s.interrupt=void 0,gr(e,e.attempt(In,t,n),"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o)}}function PO(e,t,n){const s=this;return gr(e,a,"listItemIndent",s.containerState.size+1);function a(i){const l=s.events[s.events.length-1];return l&&l[1].type==="listItemIndent"&&l[2].sliceSerialize(l[1],!0).length===s.containerState.size?t(i):n(i)}}function OO(e){e.exit(this.containerState.type)}function MO(e,t,n){const s=this;return gr(e,a,"listItemPrefixWhitespace",s.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function a(i){const l=s.events[s.events.length-1];return!Kt(i)&&l&&l[1].type==="listItemPrefixWhitespace"?t(i):n(i)}}const Ab={name:"setextUnderline",resolveTo:IO,tokenize:LO};function IO(e,t){let n=e.length,s,a,i;for(;n--;)if(e[n][0]==="enter"){if(e[n][1].type==="content"){s=n;break}e[n][1].type==="paragraph"&&(a=n)}else e[n][1].type==="content"&&e.splice(n,1),!i&&e[n][1].type==="definition"&&(i=n);const l={type:"setextHeading",start:{...e[s][1].start},end:{...e[e.length-1][1].end}};return e[a][1].type="setextHeadingText",i?(e.splice(a,0,["enter",l,t]),e.splice(i+1,0,["exit",e[s][1],t]),e[s][1].end={...e[i][1].end}):e[s][1]=l,e.push(["exit",l,t]),e}function LO(e,t,n){const s=this;let a;return i;function i(d){let u=s.events.length,m;for(;u--;)if(s.events[u][1].type!=="lineEnding"&&s.events[u][1].type!=="linePrefix"&&s.events[u][1].type!=="content"){m=s.events[u][1].type==="paragraph";break}return!s.parser.lazy[s.now().line]&&(s.interrupt||m)?(e.enter("setextHeadingLine"),a=d,l(d)):n(d)}function l(d){return e.enter("setextHeadingLineSequence"),o(d)}function o(d){return d===a?(e.consume(d),o):(e.exit("setextHeadingLineSequence"),Kt(d)?gr(e,c,"lineSuffix")(d):c(d))}function c(d){return d===null||vt(d)?(e.exit("setextHeadingLine"),t(d)):n(d)}}const RO={tokenize:$O};function $O(e){const t=this,n=e.attempt(Xu,s,e.attempt(this.parser.constructs.flowInitial,a,gr(e,e.attempt(this.parser.constructs.flow,a,e.attempt(q5,a)),"linePrefix")));return n;function s(i){if(i===null){e.consume(i);return}return e.enter("lineEndingBlank"),e.consume(i),e.exit("lineEndingBlank"),t.currentConstruct=void 0,n}function a(i){if(i===null){e.consume(i);return}return e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),t.currentConstruct=void 0,n}}const FO={resolveAll:pk()},zO=hk("string"),BO=hk("text");function hk(e){return{resolveAll:pk(e==="text"?UO:void 0),tokenize:t};function t(n){const s=this,a=this.parser.constructs[e],i=n.attempt(a,l,o);return l;function l(u){return d(u)?i(u):o(u)}function o(u){if(u===null){n.consume(u);return}return n.enter("data"),n.consume(u),c}function c(u){return d(u)?(n.exit("data"),i(u)):(n.consume(u),c)}function d(u){if(u===null)return!0;const m=a[u];let p=-1;if(m)for(;++p<m.length;){const f=m[p];if(!f.previous||f.previous.call(s,s.previous))return!0}return!1}}}function pk(e){return t;function t(n,s){let a=-1,i;for(;++a<=n.length;)i===void 0?n[a]&&n[a][1].type==="data"&&(i=a,a++):(!n[a]||n[a][1].type!=="data")&&(a!==i+2&&(n[i][1].end=n[a-1][1].end,n.splice(i+2,a-i-2),a=i+2),i=void 0);return e?e(n,s):n}}function UO(e,t){let n=0;for(;++n<=e.length;)if((n===e.length||e[n][1].type==="lineEnding")&&e[n-1][1].type==="data"){const s=e[n-1][1],a=t.sliceStream(s);let i=a.length,l=-1,o=0,c;for(;i--;){const d=a[i];if(typeof d=="string"){for(l=d.length;d.charCodeAt(l-1)===32;)o++,l--;if(l)break;l=-1}else if(d===-2)c=!0,o++;else if(d!==-1){i++;break}}if(t._contentTypeTextTrailing&&n===e.length&&(o=0),o){const d={type:n===e.length||c||o<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:i?l:s.start._bufferIndex+l,_index:s.start._index+i,line:s.end.line,column:s.end.column-o,offset:s.end.offset-o},end:{...s.end}};s.end={...d.start},s.start.offset===s.end.offset?Object.assign(s,d):(e.splice(n,0,["enter",d,t],["exit",d,t]),n+=2)}n++}return e}const qO={42:In,43:In,45:In,48:In,49:In,50:In,51:In,52:In,53:In,54:In,55:In,56:In,57:In,62:ik},HO={91:G5},WO={[-2]:nh,[-1]:nh,32:nh},YO={35:eO,42:Ed,45:[Ab,Ed],60:sO,61:Ab,95:Ed,96:Db,126:Db},VO={38:ok,92:lk},GO={[-5]:sh,[-4]:sh,[-3]:sh,33:jO,38:ok,42:Mf,60:[C5,uO],91:CO,92:[Q5,lk],93:px,95:Mf,96:R5},KO={null:[Mf,FO]},XO={null:[42,95]},JO={null:[]},QO=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:XO,contentInitial:HO,disable:JO,document:qO,flow:YO,flowInitial:WO,insideSpan:KO,string:VO,text:GO},Symbol.toStringTag,{value:"Module"}));function ZO(e,t,n){let s={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const a={},i=[];let l=[],o=[];const c={attempt:S(k),check:S(j),consume:v,enter:w,exit:N,interrupt:S(j,{interrupt:!0})},d={code:null,containerState:{},defineSkip:g,events:[],now:y,parser:e,previous:null,sliceSerialize:p,sliceStream:f,write:m};let u=t.tokenize.call(d,c);return t.resolveAll&&i.push(t),d;function m(A){return l=ds(l,A),x(),l[l.length-1]!==null?[]:(_(t,0),d.events=hx(i,d.events,d),d.events)}function p(A,E){return tM(f(A),E)}function f(A){return eM(l,A)}function y(){const{_bufferIndex:A,_index:E,line:T,column:M,offset:L}=s;return{_bufferIndex:A,_index:E,line:T,column:M,offset:L}}function g(A){a[A.line]=A.column,D()}function x(){let A;for(;s._index<l.length;){const E=l[s._index];if(typeof E=="string")for(A=s._index,s._bufferIndex<0&&(s._bufferIndex=0);s._index===A&&s._bufferIndex<E.length;)b(E.charCodeAt(s._bufferIndex));else b(E)}}function b(A){u=u(A)}function v(A){vt(A)?(s.line++,s.column=1,s.offset+=A===-3?2:1,D()):A!==-1&&(s.column++,s.offset++),s._bufferIndex<0?s._index++:(s._bufferIndex++,s._bufferIndex===l[s._index].length&&(s._bufferIndex=-1,s._index++)),d.previous=A}function w(A,E){const T=E||{};return T.type=A,T.start=y(),d.events.push(["enter",T,d]),o.push(T),T}function N(A){const E=o.pop();return E.end=y(),d.events.push(["exit",E,d]),E}function k(A,E){_(A,E.from)}function j(A,E){E.restore()}function S(A,E){return T;function T(M,L,P){let $,R,U,I;return Array.isArray(M)?F(M):"tokenize"in M?F([M]):z(M);function z(se){return Z;function Z(oe){const W=oe!==null&&se[oe],B=oe!==null&&se.null,V=[...Array.isArray(W)?W:W?[W]:[],...Array.isArray(B)?B:B?[B]:[]];return F(V)(oe)}}function F(se){return $=se,R=0,se.length===0?P:O(se[R])}function O(se){return Z;function Z(oe){return I=C(),U=se,se.partial||(d.currentConstruct=se),se.name&&d.parser.constructs.disable.null.includes(se.name)?J():se.tokenize.call(E?Object.assign(Object.create(d),E):d,c,K,J)(oe)}}function K(se){return A(U,I),L}function J(se){return I.restore(),++R<$.length?O($[R]):P}}}function _(A,E){A.resolveAll&&!i.includes(A)&&i.push(A),A.resolve&&aa(d.events,E,d.events.length-E,A.resolve(d.events.slice(E),d)),A.resolveTo&&(d.events=A.resolveTo(d.events,d))}function C(){const A=y(),E=d.previous,T=d.currentConstruct,M=d.events.length,L=Array.from(o);return{from:M,restore:P};function P(){s=A,d.previous=E,d.currentConstruct=T,d.events.length=M,o=L,D()}}function D(){s.line in a&&s.column<2&&(s.column=a[s.line],s.offset+=a[s.line]-1)}}function eM(e,t){const n=t.start._index,s=t.start._bufferIndex,a=t.end._index,i=t.end._bufferIndex;let l;if(n===a)l=[e[n].slice(s,i)];else{if(l=e.slice(n,a),s>-1){const o=l[0];typeof o=="string"?l[0]=o.slice(s):l.shift()}i>0&&l.push(e[a].slice(0,i))}return l}function tM(e,t){let n=-1;const s=[];let a;for(;++n<e.length;){const i=e[n];let l;if(typeof i=="string")l=i;else switch(i){case-5:{l="\r";break}case-4:{l=`
`;break}case-3:{l=`\r
`;break}case-2:{l=t?" ":"	";break}case-1:{if(!t&&a)continue;l=" ";break}default:l=String.fromCharCode(i)}a=i===-2,s.push(l)}return s.join("")}function rM(e){const s={constructs:c5([QO,...(e||{}).extensions||[]]),content:a(x5),defined:[],document:a(b5),flow:a(RO),lazy:{},string:a(zO),text:a(BO)};return s;function a(i){return l;function l(o){return ZO(s,i,o)}}}function nM(e){for(;!ck(e););return e}const Pb=/[\0\t\n\r]/g;function sM(){let e=1,t="",n=!0,s;return a;function a(i,l,o){const c=[];let d,u,m,p,f;for(i=t+(typeof i=="string"?i.toString():new TextDecoder(l||void 0).decode(i)),m=0,t="",n&&(i.charCodeAt(0)===65279&&m++,n=void 0);m<i.length;){if(Pb.lastIndex=m,d=Pb.exec(i),p=d&&d.index!==void 0?d.index:i.length,f=i.charCodeAt(p),!d){t=i.slice(m);break}if(f===10&&m===p&&s)c.push(-3),s=void 0;else switch(s&&(c.push(-5),s=void 0),m<p&&(c.push(i.slice(m,p)),e+=p-m),f){case 0:{c.push(65533),e++;break}case 9:{for(u=Math.ceil(e/4)*4,c.push(-2);e++<u;)c.push(-1);break}case 10:{c.push(-4),e=1;break}default:s=!0,e=1}m=p+1}return o&&(s&&c.push(-5),t&&c.push(t),c.push(null)),c}}const aM=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function iM(e){return e.replace(aM,lM)}function lM(e,t,n){if(t)return t;if(n.charCodeAt(0)===35){const a=n.charCodeAt(1),i=a===120||a===88;return ak(n.slice(i?2:1),i?16:10)}return mx(n)||e}const fk={}.hasOwnProperty;function oM(e,t,n){return typeof t!="string"&&(n=t,t=void 0),cM(n)(nM(rM(n).document().write(sM()(e,t,!0))))}function cM(e){const t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:i(Le),autolinkProtocol:C,autolinkEmail:C,atxHeading:i(G),blockQuote:i(B),characterEscape:C,characterReference:C,codeFenced:i(V),codeFencedFenceInfo:l,codeFencedFenceMeta:l,codeIndented:i(V,l),codeText:i(re,l),codeTextData:C,data:C,codeFlowValue:C,definition:i(Me),definitionDestinationString:l,definitionLabelString:l,definitionTitleString:l,emphasis:i(he),hardBreakEscape:i(q),hardBreakTrailing:i(q),htmlFlow:i(Q,l),htmlFlowData:C,htmlText:i(Q,l),htmlTextData:C,image:i(ue),label:l,link:i(Le),listItem:i(Se),listItemValue:p,listOrdered:i(ge,m),listUnordered:i(ge),paragraph:i(ce),reference:O,referenceString:l,resourceDestinationString:l,resourceTitleString:l,setextHeading:i(G),strong:i(ke),thematicBreak:i(qe)},exit:{atxHeading:c(),atxHeadingSequence:k,autolink:c(),autolinkEmail:W,autolinkProtocol:oe,blockQuote:c(),characterEscapeValue:D,characterReferenceMarkerHexadecimal:J,characterReferenceMarkerNumeric:J,characterReferenceValue:se,characterReference:Z,codeFenced:c(x),codeFencedFence:g,codeFencedFenceInfo:f,codeFencedFenceMeta:y,codeFlowValue:D,codeIndented:c(b),codeText:c(L),codeTextData:D,data:D,definition:c(),definitionDestinationString:N,definitionLabelString:v,definitionTitleString:w,emphasis:c(),hardBreakEscape:c(E),hardBreakTrailing:c(E),htmlFlow:c(T),htmlFlowData:D,htmlText:c(M),htmlTextData:D,image:c($),label:U,labelText:R,lineEnding:A,link:c(P),listItem:c(),listOrdered:c(),listUnordered:c(),paragraph:c(),referenceString:K,resourceDestinationString:I,resourceTitleString:z,resource:F,setextHeading:c(_),setextHeadingLineSequence:S,setextHeadingText:j,strong:c(),thematicBreak:c()}};gk(t,(e||{}).mdastExtensions||[]);const n={};return s;function s(ne){let ye={type:"root",children:[]};const Ee={stack:[ye],tokenStack:[],config:t,enter:o,exit:d,buffer:l,resume:u,data:n},st=[];let Ke=-1;for(;++Ke<ne.length;)if(ne[Ke][1].type==="listOrdered"||ne[Ke][1].type==="listUnordered")if(ne[Ke][0]==="enter")st.push(Ke);else{const At=st.pop();Ke=a(ne,At,Ke)}for(Ke=-1;++Ke<ne.length;){const At=t[ne[Ke][0]];fk.call(At,ne[Ke][1].type)&&At[ne[Ke][1].type].call(Object.assign({sliceSerialize:ne[Ke][2].sliceSerialize},Ee),ne[Ke][1])}if(Ee.tokenStack.length>0){const At=Ee.tokenStack[Ee.tokenStack.length-1];(At[1]||Ob).call(Ee,void 0,At[0])}for(ye.position={start:qa(ne.length>0?ne[0][1].start:{line:1,column:1,offset:0}),end:qa(ne.length>0?ne[ne.length-2][1].end:{line:1,column:1,offset:0})},Ke=-1;++Ke<t.transforms.length;)ye=t.transforms[Ke](ye)||ye;return ye}function a(ne,ye,Ee){let st=ye-1,Ke=-1,At=!1,lt,Ht,pt,be;for(;++st<=Ee;){const ze=ne[st];switch(ze[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{ze[0]==="enter"?Ke++:Ke--,be=void 0;break}case"lineEndingBlank":{ze[0]==="enter"&&(lt&&!be&&!Ke&&!pt&&(pt=st),be=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:be=void 0}if(!Ke&&ze[0]==="enter"&&ze[1].type==="listItemPrefix"||Ke===-1&&ze[0]==="exit"&&(ze[1].type==="listUnordered"||ze[1].type==="listOrdered")){if(lt){let ee=st;for(Ht=void 0;ee--;){const X=ne[ee];if(X[1].type==="lineEnding"||X[1].type==="lineEndingBlank"){if(X[0]==="exit")continue;Ht&&(ne[Ht][1].type="lineEndingBlank",At=!0),X[1].type="lineEnding",Ht=ee}else if(!(X[1].type==="linePrefix"||X[1].type==="blockQuotePrefix"||X[1].type==="blockQuotePrefixWhitespace"||X[1].type==="blockQuoteMarker"||X[1].type==="listItemIndent"))break}pt&&(!Ht||pt<Ht)&&(lt._spread=!0),lt.end=Object.assign({},Ht?ne[Ht][1].start:ze[1].end),ne.splice(Ht||st,0,["exit",lt,ze[2]]),st++,Ee++}if(ze[1].type==="listItemPrefix"){const ee={type:"listItem",_spread:!1,start:Object.assign({},ze[1].start),end:void 0};lt=ee,ne.splice(st,0,["enter",ee,ze[2]]),st++,Ee++,pt=void 0,be=!0}}}return ne[ye][1]._spread=At,Ee}function i(ne,ye){return Ee;function Ee(st){o.call(this,ne(st),st),ye&&ye.call(this,st)}}function l(){this.stack.push({type:"fragment",children:[]})}function o(ne,ye,Ee){this.stack[this.stack.length-1].children.push(ne),this.stack.push(ne),this.tokenStack.push([ye,Ee||void 0]),ne.position={start:qa(ye.start),end:void 0}}function c(ne){return ye;function ye(Ee){ne&&ne.call(this,Ee),d.call(this,Ee)}}function d(ne,ye){const Ee=this.stack.pop(),st=this.tokenStack.pop();if(st)st[0].type!==ne.type&&(ye?ye.call(this,ne,st[0]):(st[1]||Ob).call(this,ne,st[0]));else throw new Error("Cannot close `"+ne.type+"` ("+Ho({start:ne.start,end:ne.end})+"): its not open");Ee.position.end=qa(ne.end)}function u(){return l5(this.stack.pop())}function m(){this.data.expectingFirstListItemValue=!0}function p(ne){if(this.data.expectingFirstListItemValue){const ye=this.stack[this.stack.length-2];ye.start=Number.parseInt(this.sliceSerialize(ne),10),this.data.expectingFirstListItemValue=void 0}}function f(){const ne=this.resume(),ye=this.stack[this.stack.length-1];ye.lang=ne}function y(){const ne=this.resume(),ye=this.stack[this.stack.length-1];ye.meta=ne}function g(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function x(){const ne=this.resume(),ye=this.stack[this.stack.length-1];ye.value=ne.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function b(){const ne=this.resume(),ye=this.stack[this.stack.length-1];ye.value=ne.replace(/(\r?\n|\r)$/g,"")}function v(ne){const ye=this.resume(),Ee=this.stack[this.stack.length-1];Ee.label=ye,Ee.identifier=kl(this.sliceSerialize(ne)).toLowerCase()}function w(){const ne=this.resume(),ye=this.stack[this.stack.length-1];ye.title=ne}function N(){const ne=this.resume(),ye=this.stack[this.stack.length-1];ye.url=ne}function k(ne){const ye=this.stack[this.stack.length-1];if(!ye.depth){const Ee=this.sliceSerialize(ne).length;ye.depth=Ee}}function j(){this.data.setextHeadingSlurpLineEnding=!0}function S(ne){const ye=this.stack[this.stack.length-1];ye.depth=this.sliceSerialize(ne).codePointAt(0)===61?1:2}function _(){this.data.setextHeadingSlurpLineEnding=void 0}function C(ne){const Ee=this.stack[this.stack.length-1].children;let st=Ee[Ee.length-1];(!st||st.type!=="text")&&(st=Pe(),st.position={start:qa(ne.start),end:void 0},Ee.push(st)),this.stack.push(st)}function D(ne){const ye=this.stack.pop();ye.value+=this.sliceSerialize(ne),ye.position.end=qa(ne.end)}function A(ne){const ye=this.stack[this.stack.length-1];if(this.data.atHardBreak){const Ee=ye.children[ye.children.length-1];Ee.position.end=qa(ne.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(ye.type)&&(C.call(this,ne),D.call(this,ne))}function E(){this.data.atHardBreak=!0}function T(){const ne=this.resume(),ye=this.stack[this.stack.length-1];ye.value=ne}function M(){const ne=this.resume(),ye=this.stack[this.stack.length-1];ye.value=ne}function L(){const ne=this.resume(),ye=this.stack[this.stack.length-1];ye.value=ne}function P(){const ne=this.stack[this.stack.length-1];if(this.data.inReference){const ye=this.data.referenceType||"shortcut";ne.type+="Reference",ne.referenceType=ye,delete ne.url,delete ne.title}else delete ne.identifier,delete ne.label;this.data.referenceType=void 0}function $(){const ne=this.stack[this.stack.length-1];if(this.data.inReference){const ye=this.data.referenceType||"shortcut";ne.type+="Reference",ne.referenceType=ye,delete ne.url,delete ne.title}else delete ne.identifier,delete ne.label;this.data.referenceType=void 0}function R(ne){const ye=this.sliceSerialize(ne),Ee=this.stack[this.stack.length-2];Ee.label=iM(ye),Ee.identifier=kl(ye).toLowerCase()}function U(){const ne=this.stack[this.stack.length-1],ye=this.resume(),Ee=this.stack[this.stack.length-1];if(this.data.inReference=!0,Ee.type==="link"){const st=ne.children;Ee.children=st}else Ee.alt=ye}function I(){const ne=this.resume(),ye=this.stack[this.stack.length-1];ye.url=ne}function z(){const ne=this.resume(),ye=this.stack[this.stack.length-1];ye.title=ne}function F(){this.data.inReference=void 0}function O(){this.data.referenceType="collapsed"}function K(ne){const ye=this.resume(),Ee=this.stack[this.stack.length-1];Ee.label=ye,Ee.identifier=kl(this.sliceSerialize(ne)).toLowerCase(),this.data.referenceType="full"}function J(ne){this.data.characterReferenceType=ne.type}function se(ne){const ye=this.sliceSerialize(ne),Ee=this.data.characterReferenceType;let st;Ee?(st=ak(ye,Ee==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):st=mx(ye);const Ke=this.stack[this.stack.length-1];Ke.value+=st}function Z(ne){const ye=this.stack.pop();ye.position.end=qa(ne.end)}function oe(ne){D.call(this,ne);const ye=this.stack[this.stack.length-1];ye.url=this.sliceSerialize(ne)}function W(ne){D.call(this,ne);const ye=this.stack[this.stack.length-1];ye.url="mailto:"+this.sliceSerialize(ne)}function B(){return{type:"blockquote",children:[]}}function V(){return{type:"code",lang:null,meta:null,value:""}}function re(){return{type:"inlineCode",value:""}}function Me(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function he(){return{type:"emphasis",children:[]}}function G(){return{type:"heading",depth:0,children:[]}}function q(){return{type:"break"}}function Q(){return{type:"html",value:""}}function ue(){return{type:"image",title:null,url:"",alt:null}}function Le(){return{type:"link",title:null,url:"",children:[]}}function ge(ne){return{type:"list",ordered:ne.type==="listOrdered",start:null,spread:ne._spread,children:[]}}function Se(ne){return{type:"listItem",spread:ne._spread,checked:null,children:[]}}function ce(){return{type:"paragraph",children:[]}}function ke(){return{type:"strong",children:[]}}function Pe(){return{type:"text",value:""}}function qe(){return{type:"thematicBreak"}}}function qa(e){return{line:e.line,column:e.column,offset:e.offset}}function gk(e,t){let n=-1;for(;++n<t.length;){const s=t[n];Array.isArray(s)?gk(e,s):dM(e,s)}}function dM(e,t){let n;for(n in t)if(fk.call(t,n))switch(n){case"canContainEols":{const s=t[n];s&&e[n].push(...s);break}case"transforms":{const s=t[n];s&&e[n].push(...s);break}case"enter":case"exit":{const s=t[n];s&&Object.assign(e[n],s);break}}}function Ob(e,t){throw e?new Error("Cannot close `"+e.type+"` ("+Ho({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+Ho({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+Ho({start:t.start,end:t.end})+") is still open")}function uM(e){const t=this;t.parser=n;function n(s){return oM(s,{...t.data("settings"),...e,extensions:t.data("micromarkExtensions")||[],mdastExtensions:t.data("fromMarkdownExtensions")||[]})}}function mM(e,t){const n={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(t),!0)};return e.patch(t,n),e.applyData(t,n)}function hM(e,t){const n={type:"element",tagName:"br",properties:{},children:[]};return e.patch(t,n),[e.applyData(t,n),{type:"text",value:`
`}]}function pM(e,t){const n=t.value?t.value+`
`:"",s={};t.lang&&(s.className=["language-"+t.lang]);let a={type:"element",tagName:"code",properties:s,children:[{type:"text",value:n}]};return t.meta&&(a.data={meta:t.meta}),e.patch(t,a),a=e.applyData(t,a),a={type:"element",tagName:"pre",properties:{},children:[a]},e.patch(t,a),a}function fM(e,t){const n={type:"element",tagName:"del",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function gM(e,t){const n={type:"element",tagName:"em",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function xM(e,t){const n=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",s=String(t.identifier).toUpperCase(),a=no(s.toLowerCase()),i=e.footnoteOrder.indexOf(s);let l,o=e.footnoteCounts.get(s);o===void 0?(o=0,e.footnoteOrder.push(s),l=e.footnoteOrder.length):l=i+1,o+=1,e.footnoteCounts.set(s,o);const c={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+a,id:n+"fnref-"+a+(o>1?"-"+o:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(l)}]};e.patch(t,c);const d={type:"element",tagName:"sup",properties:{},children:[c]};return e.patch(t,d),e.applyData(t,d)}function yM(e,t){const n={type:"element",tagName:"h"+t.depth,properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function bM(e,t){if(e.options.allowDangerousHtml){const n={type:"raw",value:t.value};return e.patch(t,n),e.applyData(t,n)}}function xk(e,t){const n=t.referenceType;let s="]";if(n==="collapsed"?s+="[]":n==="full"&&(s+="["+(t.label||t.identifier)+"]"),t.type==="imageReference")return[{type:"text",value:"!["+t.alt+s}];const a=e.all(t),i=a[0];i&&i.type==="text"?i.value="["+i.value:a.unshift({type:"text",value:"["});const l=a[a.length-1];return l&&l.type==="text"?l.value+=s:a.push({type:"text",value:s}),a}function vM(e,t){const n=String(t.identifier).toUpperCase(),s=e.definitionById.get(n);if(!s)return xk(e,t);const a={src:no(s.url||""),alt:t.alt};s.title!==null&&s.title!==void 0&&(a.title=s.title);const i={type:"element",tagName:"img",properties:a,children:[]};return e.patch(t,i),e.applyData(t,i)}function wM(e,t){const n={src:no(t.url)};t.alt!==null&&t.alt!==void 0&&(n.alt=t.alt),t.title!==null&&t.title!==void 0&&(n.title=t.title);const s={type:"element",tagName:"img",properties:n,children:[]};return e.patch(t,s),e.applyData(t,s)}function jM(e,t){const n={type:"text",value:t.value.replace(/\r?\n|\r/g," ")};e.patch(t,n);const s={type:"element",tagName:"code",properties:{},children:[n]};return e.patch(t,s),e.applyData(t,s)}function NM(e,t){const n=String(t.identifier).toUpperCase(),s=e.definitionById.get(n);if(!s)return xk(e,t);const a={href:no(s.url||"")};s.title!==null&&s.title!==void 0&&(a.title=s.title);const i={type:"element",tagName:"a",properties:a,children:e.all(t)};return e.patch(t,i),e.applyData(t,i)}function CM(e,t){const n={href:no(t.url)};t.title!==null&&t.title!==void 0&&(n.title=t.title);const s={type:"element",tagName:"a",properties:n,children:e.all(t)};return e.patch(t,s),e.applyData(t,s)}function kM(e,t,n){const s=e.all(t),a=n?SM(n):yk(t),i={},l=[];if(typeof t.checked=="boolean"){const u=s[0];let m;u&&u.type==="element"&&u.tagName==="p"?m=u:(m={type:"element",tagName:"p",properties:{},children:[]},s.unshift(m)),m.children.length>0&&m.children.unshift({type:"text",value:" "}),m.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:t.checked,disabled:!0},children:[]}),i.className=["task-list-item"]}let o=-1;for(;++o<s.length;){const u=s[o];(a||o!==0||u.type!=="element"||u.tagName!=="p")&&l.push({type:"text",value:`
`}),u.type==="element"&&u.tagName==="p"&&!a?l.push(...u.children):l.push(u)}const c=s[s.length-1];c&&(a||c.type!=="element"||c.tagName!=="p")&&l.push({type:"text",value:`
`});const d={type:"element",tagName:"li",properties:i,children:l};return e.patch(t,d),e.applyData(t,d)}function SM(e){let t=!1;if(e.type==="list"){t=e.spread||!1;const n=e.children;let s=-1;for(;!t&&++s<n.length;)t=yk(n[s])}return t}function yk(e){const t=e.spread;return t??e.children.length>1}function _M(e,t){const n={},s=e.all(t);let a=-1;for(typeof t.start=="number"&&t.start!==1&&(n.start=t.start);++a<s.length;){const l=s[a];if(l.type==="element"&&l.tagName==="li"&&l.properties&&Array.isArray(l.properties.className)&&l.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const i={type:"element",tagName:t.ordered?"ol":"ul",properties:n,children:e.wrap(s,!0)};return e.patch(t,i),e.applyData(t,i)}function EM(e,t){const n={type:"element",tagName:"p",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function DM(e,t){const n={type:"root",children:e.wrap(e.all(t))};return e.patch(t,n),e.applyData(t,n)}function TM(e,t){const n={type:"element",tagName:"strong",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function AM(e,t){const n=e.all(t),s=n.shift(),a=[];if(s){const l={type:"element",tagName:"thead",properties:{},children:e.wrap([s],!0)};e.patch(t.children[0],l),a.push(l)}if(n.length>0){const l={type:"element",tagName:"tbody",properties:{},children:e.wrap(n,!0)},o=ox(t.children[1]),c=JC(t.children[t.children.length-1]);o&&c&&(l.position={start:o,end:c}),a.push(l)}const i={type:"element",tagName:"table",properties:{},children:e.wrap(a,!0)};return e.patch(t,i),e.applyData(t,i)}function PM(e,t,n){const s=n?n.children:void 0,i=(s?s.indexOf(t):1)===0?"th":"td",l=n&&n.type==="table"?n.align:void 0,o=l?l.length:t.children.length;let c=-1;const d=[];for(;++c<o;){const m=t.children[c],p={},f=l?l[c]:void 0;f&&(p.align=f);let y={type:"element",tagName:i,properties:p,children:[]};m&&(y.children=e.all(m),e.patch(m,y),y=e.applyData(m,y)),d.push(y)}const u={type:"element",tagName:"tr",properties:{},children:e.wrap(d,!0)};return e.patch(t,u),e.applyData(t,u)}function OM(e,t){const n={type:"element",tagName:"td",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}const Mb=9,Ib=32;function MM(e){const t=String(e),n=/\r?\n|\r/g;let s=n.exec(t),a=0;const i=[];for(;s;)i.push(Lb(t.slice(a,s.index),a>0,!0),s[0]),a=s.index+s[0].length,s=n.exec(t);return i.push(Lb(t.slice(a),a>0,!1)),i.join("")}function Lb(e,t,n){let s=0,a=e.length;if(t){let i=e.codePointAt(s);for(;i===Mb||i===Ib;)s++,i=e.codePointAt(s)}if(n){let i=e.codePointAt(a-1);for(;i===Mb||i===Ib;)a--,i=e.codePointAt(a-1)}return a>s?e.slice(s,a):""}function IM(e,t){const n={type:"text",value:MM(String(t.value))};return e.patch(t,n),e.applyData(t,n)}function LM(e,t){const n={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(t,n),e.applyData(t,n)}const RM={blockquote:mM,break:hM,code:pM,delete:fM,emphasis:gM,footnoteReference:xM,heading:yM,html:bM,imageReference:vM,image:wM,inlineCode:jM,linkReference:NM,link:CM,listItem:kM,list:_M,paragraph:EM,root:DM,strong:TM,table:AM,tableCell:OM,tableRow:PM,text:IM,thematicBreak:LM,toml:qc,yaml:qc,definition:qc,footnoteDefinition:qc};function qc(){}const bk=-1,Ju=0,Yo=1,Wd=2,fx=3,gx=4,xx=5,yx=6,vk=7,wk=8,Rb=typeof self=="object"?self:globalThis,$M=(e,t)=>{const n=(a,i)=>(e.set(i,a),a),s=a=>{if(e.has(a))return e.get(a);const[i,l]=t[a];switch(i){case Ju:case bk:return n(l,a);case Yo:{const o=n([],a);for(const c of l)o.push(s(c));return o}case Wd:{const o=n({},a);for(const[c,d]of l)o[s(c)]=s(d);return o}case fx:return n(new Date(l),a);case gx:{const{source:o,flags:c}=l;return n(new RegExp(o,c),a)}case xx:{const o=n(new Map,a);for(const[c,d]of l)o.set(s(c),s(d));return o}case yx:{const o=n(new Set,a);for(const c of l)o.add(s(c));return o}case vk:{const{name:o,message:c}=l;return n(new Rb[o](c),a)}case wk:return n(BigInt(l),a);case"BigInt":return n(Object(BigInt(l)),a);case"ArrayBuffer":return n(new Uint8Array(l).buffer,l);case"DataView":{const{buffer:o}=new Uint8Array(l);return n(new DataView(o),l)}}return n(new Rb[i](l),a)};return s},$b=e=>$M(new Map,e)(0),hl="",{toString:FM}={},{keys:zM}=Object,bo=e=>{const t=typeof e;if(t!=="object"||!e)return[Ju,t];const n=FM.call(e).slice(8,-1);switch(n){case"Array":return[Yo,hl];case"Object":return[Wd,hl];case"Date":return[fx,hl];case"RegExp":return[gx,hl];case"Map":return[xx,hl];case"Set":return[yx,hl];case"DataView":return[Yo,n]}return n.includes("Array")?[Yo,n]:n.includes("Error")?[vk,n]:[Wd,n]},Hc=([e,t])=>e===Ju&&(t==="function"||t==="symbol"),BM=(e,t,n,s)=>{const a=(l,o)=>{const c=s.push(l)-1;return n.set(o,c),c},i=l=>{if(n.has(l))return n.get(l);let[o,c]=bo(l);switch(o){case Ju:{let u=l;switch(c){case"bigint":o=wk,u=l.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+c);u=null;break;case"undefined":return a([bk],l)}return a([o,u],l)}case Yo:{if(c){let p=l;return c==="DataView"?p=new Uint8Array(l.buffer):c==="ArrayBuffer"&&(p=new Uint8Array(l)),a([c,[...p]],l)}const u=[],m=a([o,u],l);for(const p of l)u.push(i(p));return m}case Wd:{if(c)switch(c){case"BigInt":return a([c,l.toString()],l);case"Boolean":case"Number":case"String":return a([c,l.valueOf()],l)}if(t&&"toJSON"in l)return i(l.toJSON());const u=[],m=a([o,u],l);for(const p of zM(l))(e||!Hc(bo(l[p])))&&u.push([i(p),i(l[p])]);return m}case fx:return a([o,l.toISOString()],l);case gx:{const{source:u,flags:m}=l;return a([o,{source:u,flags:m}],l)}case xx:{const u=[],m=a([o,u],l);for(const[p,f]of l)(e||!(Hc(bo(p))||Hc(bo(f))))&&u.push([i(p),i(f)]);return m}case yx:{const u=[],m=a([o,u],l);for(const p of l)(e||!Hc(bo(p)))&&u.push(i(p));return m}}const{message:d}=l;return a([o,{name:c,message:d}],l)};return i},Fb=(e,{json:t,lossy:n}={})=>{const s=[];return BM(!(t||n),!!t,new Map,s)(e),s},Qo=typeof structuredClone=="function"?(e,t)=>t&&("json"in t||"lossy"in t)?$b(Fb(e,t)):structuredClone(e):(e,t)=>$b(Fb(e,t));function UM(e,t){const n=[{type:"text",value:""}];return t>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(t)}]}),n}function qM(e,t){return"Back to reference "+(e+1)+(t>1?"-"+t:"")}function HM(e){const t=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",n=e.options.footnoteBackContent||UM,s=e.options.footnoteBackLabel||qM,a=e.options.footnoteLabel||"Footnotes",i=e.options.footnoteLabelTagName||"h2",l=e.options.footnoteLabelProperties||{className:["sr-only"]},o=[];let c=-1;for(;++c<e.footnoteOrder.length;){const d=e.footnoteById.get(e.footnoteOrder[c]);if(!d)continue;const u=e.all(d),m=String(d.identifier).toUpperCase(),p=no(m.toLowerCase());let f=0;const y=[],g=e.footnoteCounts.get(m);for(;g!==void 0&&++f<=g;){y.length>0&&y.push({type:"text",value:" "});let v=typeof n=="string"?n:n(c,f);typeof v=="string"&&(v={type:"text",value:v}),y.push({type:"element",tagName:"a",properties:{href:"#"+t+"fnref-"+p+(f>1?"-"+f:""),dataFootnoteBackref:"",ariaLabel:typeof s=="string"?s:s(c,f),className:["data-footnote-backref"]},children:Array.isArray(v)?v:[v]})}const x=u[u.length-1];if(x&&x.type==="element"&&x.tagName==="p"){const v=x.children[x.children.length-1];v&&v.type==="text"?v.value+=" ":x.children.push({type:"text",value:" "}),x.children.push(...y)}else u.push(...y);const b={type:"element",tagName:"li",properties:{id:t+"fn-"+p},children:e.wrap(u,!0)};e.patch(d,b),o.push(b)}if(o.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:i,properties:{...Qo(l),id:"footnote-label"},children:[{type:"text",value:a}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:e.wrap(o,!0)},{type:"text",value:`
`}]}}const jk=function(e){if(e==null)return GM;if(typeof e=="function")return Qu(e);if(typeof e=="object")return Array.isArray(e)?WM(e):YM(e);if(typeof e=="string")return VM(e);throw new Error("Expected function, string, or object as test")};function WM(e){const t=[];let n=-1;for(;++n<e.length;)t[n]=jk(e[n]);return Qu(s);function s(...a){let i=-1;for(;++i<t.length;)if(t[i].apply(this,a))return!0;return!1}}function YM(e){const t=e;return Qu(n);function n(s){const a=s;let i;for(i in e)if(a[i]!==t[i])return!1;return!0}}function VM(e){return Qu(t);function t(n){return n&&n.type===e}}function Qu(e){return t;function t(n,s,a){return!!(KM(n)&&e.call(this,n,typeof s=="number"?s:void 0,a||void 0))}}function GM(){return!0}function KM(e){return e!==null&&typeof e=="object"&&"type"in e}const Nk=[],XM=!0,zb=!1,JM="skip";function QM(e,t,n,s){let a;typeof t=="function"&&typeof n!="function"?(s=n,n=t):a=t;const i=jk(a),l=s?-1:1;o(e,void 0,[])();function o(c,d,u){const m=c&&typeof c=="object"?c:{};if(typeof m.type=="string"){const f=typeof m.tagName=="string"?m.tagName:typeof m.name=="string"?m.name:void 0;Object.defineProperty(p,"name",{value:"node ("+(c.type+(f?"<"+f+">":""))+")"})}return p;function p(){let f=Nk,y,g,x;if((!t||i(c,d,u[u.length-1]||void 0))&&(f=ZM(n(c,u)),f[0]===zb))return f;if("children"in c&&c.children){const b=c;if(b.children&&f[0]!==JM)for(g=(s?b.children.length:-1)+l,x=u.concat(b);g>-1&&g<b.children.length;){const v=b.children[g];if(y=o(v,g,x)(),y[0]===zb)return y;g=typeof y[1]=="number"?y[1]:g+l}}return f}}}function ZM(e){return Array.isArray(e)?e:typeof e=="number"?[XM,e]:e==null?Nk:[e]}function Ck(e,t,n,s){let a,i,l;typeof t=="function"?(i=void 0,l=t,a=n):(i=t,l=n,a=s),QM(e,i,o,a);function o(c,d){const u=d[d.length-1],m=u?u.children.indexOf(c):void 0;return l(c,m,u)}}const If={}.hasOwnProperty,eI={};function tI(e,t){const n=t||eI,s=new Map,a=new Map,i=new Map,l={...RM,...n.handlers},o={all:d,applyData:nI,definitionById:s,footnoteById:a,footnoteCounts:i,footnoteOrder:[],handlers:l,one:c,options:n,patch:rI,wrap:aI};return Ck(e,function(u){if(u.type==="definition"||u.type==="footnoteDefinition"){const m=u.type==="definition"?s:a,p=String(u.identifier).toUpperCase();m.has(p)||m.set(p,u)}}),o;function c(u,m){const p=u.type,f=o.handlers[p];if(If.call(o.handlers,p)&&f)return f(o,u,m);if(o.options.passThrough&&o.options.passThrough.includes(p)){if("children"in u){const{children:g,...x}=u,b=Qo(x);return b.children=o.all(u),b}return Qo(u)}return(o.options.unknownHandler||sI)(o,u,m)}function d(u){const m=[];if("children"in u){const p=u.children;let f=-1;for(;++f<p.length;){const y=o.one(p[f],u);if(y){if(f&&p[f-1].type==="break"&&(!Array.isArray(y)&&y.type==="text"&&(y.value=Bb(y.value)),!Array.isArray(y)&&y.type==="element")){const g=y.children[0];g&&g.type==="text"&&(g.value=Bb(g.value))}Array.isArray(y)?m.push(...y):m.push(y)}}}return m}}function rI(e,t){e.position&&(t.position=ZC(e))}function nI(e,t){let n=t;if(e&&e.data){const s=e.data.hName,a=e.data.hChildren,i=e.data.hProperties;if(typeof s=="string")if(n.type==="element")n.tagName=s;else{const l="children"in n?n.children:[n];n={type:"element",tagName:s,properties:{},children:l}}n.type==="element"&&i&&Object.assign(n.properties,Qo(i)),"children"in n&&n.children&&a!==null&&a!==void 0&&(n.children=a)}return n}function sI(e,t){const n=t.data||{},s="value"in t&&!(If.call(n,"hProperties")||If.call(n,"hChildren"))?{type:"text",value:t.value}:{type:"element",tagName:"div",properties:{},children:e.all(t)};return e.patch(t,s),e.applyData(t,s)}function aI(e,t){const n=[];let s=-1;for(t&&n.push({type:"text",value:`
`});++s<e.length;)s&&n.push({type:"text",value:`
`}),n.push(e[s]);return t&&e.length>0&&n.push({type:"text",value:`
`}),n}function Bb(e){let t=0,n=e.charCodeAt(t);for(;n===9||n===32;)t++,n=e.charCodeAt(t);return e.slice(t)}function Ub(e,t){const n=tI(e,t),s=n.one(e,void 0),a=HM(n),i=Array.isArray(s)?{type:"root",children:s}:s||{type:"root",children:[]};return a&&i.children.push({type:"text",value:`
`},a),i}function iI(e,t){return e&&"run"in e?async function(n,s){const a=Ub(n,{file:s,...t});await e.run(a,s)}:function(n,s){return Ub(n,{file:s,...e||t})}}function qb(e){if(e)throw e}var ah,Hb;function lI(){if(Hb)return ah;Hb=1;var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,n=Object.defineProperty,s=Object.getOwnPropertyDescriptor,a=function(d){return typeof Array.isArray=="function"?Array.isArray(d):t.call(d)==="[object Array]"},i=function(d){if(!d||t.call(d)!=="[object Object]")return!1;var u=e.call(d,"constructor"),m=d.constructor&&d.constructor.prototype&&e.call(d.constructor.prototype,"isPrototypeOf");if(d.constructor&&!u&&!m)return!1;var p;for(p in d);return typeof p>"u"||e.call(d,p)},l=function(d,u){n&&u.name==="__proto__"?n(d,u.name,{enumerable:!0,configurable:!0,value:u.newValue,writable:!0}):d[u.name]=u.newValue},o=function(d,u){if(u==="__proto__")if(e.call(d,u)){if(s)return s(d,u).value}else return;return d[u]};return ah=function c(){var d,u,m,p,f,y,g=arguments[0],x=1,b=arguments.length,v=!1;for(typeof g=="boolean"&&(v=g,g=arguments[1]||{},x=2),(g==null||typeof g!="object"&&typeof g!="function")&&(g={});x<b;++x)if(d=arguments[x],d!=null)for(u in d)m=o(g,u),p=o(d,u),g!==p&&(v&&p&&(i(p)||(f=a(p)))?(f?(f=!1,y=m&&a(m)?m:[]):y=m&&i(m)?m:{},l(g,{name:u,newValue:c(v,y,p)})):typeof p<"u"&&l(g,{name:u,newValue:p}));return g},ah}var oI=lI();const ih=ks(oI);function Lf(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function cI(){const e=[],t={run:n,use:s};return t;function n(...a){let i=-1;const l=a.pop();if(typeof l!="function")throw new TypeError("Expected function as last argument, not "+l);o(null,...a);function o(c,...d){const u=e[++i];let m=-1;if(c){l(c);return}for(;++m<a.length;)(d[m]===null||d[m]===void 0)&&(d[m]=a[m]);a=d,u?dI(u,o)(...d):l(null,...d)}}function s(a){if(typeof a!="function")throw new TypeError("Expected `middelware` to be a function, not "+a);return e.push(a),t}}function dI(e,t){let n;return s;function s(...l){const o=e.length>l.length;let c;o&&l.push(a);try{c=e.apply(this,l)}catch(d){const u=d;if(o&&n)throw u;return a(u)}o||(c&&c.then&&typeof c.then=="function"?c.then(i,a):c instanceof Error?a(c):i(c))}function a(l,...o){n||(n=!0,t(l,...o))}function i(l){a(null,l)}}const Us={basename:uI,dirname:mI,extname:hI,join:pI,sep:"/"};function uI(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');wc(e);let n=0,s=-1,a=e.length,i;if(t===void 0||t.length===0||t.length>e.length){for(;a--;)if(e.codePointAt(a)===47){if(i){n=a+1;break}}else s<0&&(i=!0,s=a+1);return s<0?"":e.slice(n,s)}if(t===e)return"";let l=-1,o=t.length-1;for(;a--;)if(e.codePointAt(a)===47){if(i){n=a+1;break}}else l<0&&(i=!0,l=a+1),o>-1&&(e.codePointAt(a)===t.codePointAt(o--)?o<0&&(s=a):(o=-1,s=l));return n===s?s=l:s<0&&(s=e.length),e.slice(n,s)}function mI(e){if(wc(e),e.length===0)return".";let t=-1,n=e.length,s;for(;--n;)if(e.codePointAt(n)===47){if(s){t=n;break}}else s||(s=!0);return t<0?e.codePointAt(0)===47?"/":".":t===1&&e.codePointAt(0)===47?"//":e.slice(0,t)}function hI(e){wc(e);let t=e.length,n=-1,s=0,a=-1,i=0,l;for(;t--;){const o=e.codePointAt(t);if(o===47){if(l){s=t+1;break}continue}n<0&&(l=!0,n=t+1),o===46?a<0?a=t:i!==1&&(i=1):a>-1&&(i=-1)}return a<0||n<0||i===0||i===1&&a===n-1&&a===s+1?"":e.slice(a,n)}function pI(...e){let t=-1,n;for(;++t<e.length;)wc(e[t]),e[t]&&(n=n===void 0?e[t]:n+"/"+e[t]);return n===void 0?".":fI(n)}function fI(e){wc(e);const t=e.codePointAt(0)===47;let n=gI(e,!t);return n.length===0&&!t&&(n="."),n.length>0&&e.codePointAt(e.length-1)===47&&(n+="/"),t?"/"+n:n}function gI(e,t){let n="",s=0,a=-1,i=0,l=-1,o,c;for(;++l<=e.length;){if(l<e.length)o=e.codePointAt(l);else{if(o===47)break;o=47}if(o===47){if(!(a===l-1||i===1))if(a!==l-1&&i===2){if(n.length<2||s!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(c=n.lastIndexOf("/"),c!==n.length-1){c<0?(n="",s=0):(n=n.slice(0,c),s=n.length-1-n.lastIndexOf("/")),a=l,i=0;continue}}else if(n.length>0){n="",s=0,a=l,i=0;continue}}t&&(n=n.length>0?n+"/..":"..",s=2)}else n.length>0?n+="/"+e.slice(a+1,l):n=e.slice(a+1,l),s=l-a-1;a=l,i=0}else o===46&&i>-1?i++:i=-1}return n}function wc(e){if(typeof e!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}const xI={cwd:yI};function yI(){return"/"}function Rf(e){return!!(e!==null&&typeof e=="object"&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&e.auth===void 0)}function bI(e){if(typeof e=="string")e=new URL(e);else if(!Rf(e)){const t=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw t.code="ERR_INVALID_ARG_TYPE",t}if(e.protocol!=="file:"){const t=new TypeError("The URL must be of scheme file");throw t.code="ERR_INVALID_URL_SCHEME",t}return vI(e)}function vI(e){if(e.hostname!==""){const s=new TypeError('File URL host must be "localhost" or empty on darwin');throw s.code="ERR_INVALID_FILE_URL_HOST",s}const t=e.pathname;let n=-1;for(;++n<t.length;)if(t.codePointAt(n)===37&&t.codePointAt(n+1)===50){const s=t.codePointAt(n+2);if(s===70||s===102){const a=new TypeError("File URL path must not include encoded / characters");throw a.code="ERR_INVALID_FILE_URL_PATH",a}}return decodeURIComponent(t)}const lh=["history","path","basename","stem","extname","dirname"];class kk{constructor(t){let n;t?Rf(t)?n={path:t}:typeof t=="string"||wI(t)?n={value:t}:n=t:n={},this.cwd="cwd"in n?"":xI.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let s=-1;for(;++s<lh.length;){const i=lh[s];i in n&&n[i]!==void 0&&n[i]!==null&&(this[i]=i==="history"?[...n[i]]:n[i])}let a;for(a in n)lh.includes(a)||(this[a]=n[a])}get basename(){return typeof this.path=="string"?Us.basename(this.path):void 0}set basename(t){ch(t,"basename"),oh(t,"basename"),this.path=Us.join(this.dirname||"",t)}get dirname(){return typeof this.path=="string"?Us.dirname(this.path):void 0}set dirname(t){Wb(this.basename,"dirname"),this.path=Us.join(t||"",this.basename)}get extname(){return typeof this.path=="string"?Us.extname(this.path):void 0}set extname(t){if(oh(t,"extname"),Wb(this.dirname,"extname"),t){if(t.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(t.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Us.join(this.dirname,this.stem+(t||""))}get path(){return this.history[this.history.length-1]}set path(t){Rf(t)&&(t=bI(t)),ch(t,"path"),this.path!==t&&this.history.push(t)}get stem(){return typeof this.path=="string"?Us.basename(this.path,this.extname):void 0}set stem(t){ch(t,"stem"),oh(t,"stem"),this.path=Us.join(this.dirname||"",t+(this.extname||""))}fail(t,n,s){const a=this.message(t,n,s);throw a.fatal=!0,a}info(t,n,s){const a=this.message(t,n,s);return a.fatal=void 0,a}message(t,n,s){const a=new wn(t,n,s);return this.path&&(a.name=this.path+":"+a.name,a.file=this.path),a.fatal=!1,this.messages.push(a),a}toString(t){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(t||void 0).decode(this.value)}}function oh(e,t){if(e&&e.includes(Us.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+Us.sep+"`")}function ch(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function Wb(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}function wI(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const jI=function(e){const s=this.constructor.prototype,a=s[e],i=function(){return a.apply(i,arguments)};return Object.setPrototypeOf(i,s),i},NI={}.hasOwnProperty;class bx extends jI{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=cI()}copy(){const t=new bx;let n=-1;for(;++n<this.attachers.length;){const s=this.attachers[n];t.use(...s)}return t.data(ih(!0,{},this.namespace)),t}data(t,n){return typeof t=="string"?arguments.length===2?(mh("data",this.frozen),this.namespace[t]=n,this):NI.call(this.namespace,t)&&this.namespace[t]||void 0:t?(mh("data",this.frozen),this.namespace=t,this):this.namespace}freeze(){if(this.frozen)return this;const t=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...s]=this.attachers[this.freezeIndex];if(s[0]===!1)continue;s[0]===!0&&(s[0]=void 0);const a=n.call(t,...s);typeof a=="function"&&this.transformers.use(a)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(t){this.freeze();const n=Wc(t),s=this.parser||this.Parser;return dh("parse",s),s(String(n),n)}process(t,n){const s=this;return this.freeze(),dh("process",this.parser||this.Parser),uh("process",this.compiler||this.Compiler),n?a(void 0,n):new Promise(a);function a(i,l){const o=Wc(t),c=s.parse(o);s.run(c,o,function(u,m,p){if(u||!m||!p)return d(u);const f=m,y=s.stringify(f,p);SI(y)?p.value=y:p.result=y,d(u,p)});function d(u,m){u||!m?l(u):i?i(m):n(void 0,m)}}}processSync(t){let n=!1,s;return this.freeze(),dh("processSync",this.parser||this.Parser),uh("processSync",this.compiler||this.Compiler),this.process(t,a),Vb("processSync","process",n),s;function a(i,l){n=!0,qb(i),s=l}}run(t,n,s){Yb(t),this.freeze();const a=this.transformers;return!s&&typeof n=="function"&&(s=n,n=void 0),s?i(void 0,s):new Promise(i);function i(l,o){const c=Wc(n);a.run(t,c,d);function d(u,m,p){const f=m||t;u?o(u):l?l(f):s(void 0,f,p)}}}runSync(t,n){let s=!1,a;return this.run(t,n,i),Vb("runSync","run",s),a;function i(l,o){qb(l),a=o,s=!0}}stringify(t,n){this.freeze();const s=Wc(n),a=this.compiler||this.Compiler;return uh("stringify",a),Yb(t),a(t,s)}use(t,...n){const s=this.attachers,a=this.namespace;if(mh("use",this.frozen),t!=null)if(typeof t=="function")c(t,n);else if(typeof t=="object")Array.isArray(t)?o(t):l(t);else throw new TypeError("Expected usable value, not `"+t+"`");return this;function i(d){if(typeof d=="function")c(d,[]);else if(typeof d=="object")if(Array.isArray(d)){const[u,...m]=d;c(u,m)}else l(d);else throw new TypeError("Expected usable value, not `"+d+"`")}function l(d){if(!("plugins"in d)&&!("settings"in d))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");o(d.plugins),d.settings&&(a.settings=ih(!0,a.settings,d.settings))}function o(d){let u=-1;if(d!=null)if(Array.isArray(d))for(;++u<d.length;){const m=d[u];i(m)}else throw new TypeError("Expected a list of plugins, not `"+d+"`")}function c(d,u){let m=-1,p=-1;for(;++m<s.length;)if(s[m][0]===d){p=m;break}if(p===-1)s.push([d,...u]);else if(u.length>0){let[f,...y]=u;const g=s[p][1];Lf(g)&&Lf(f)&&(f=ih(!0,g,f)),s[p]=[d,f,...y]}}}}const CI=new bx().freeze();function dh(e,t){if(typeof t!="function")throw new TypeError("Cannot `"+e+"` without `parser`")}function uh(e,t){if(typeof t!="function")throw new TypeError("Cannot `"+e+"` without `compiler`")}function mh(e,t){if(t)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function Yb(e){if(!Lf(e)||typeof e.type!="string")throw new TypeError("Expected node, got `"+e+"`")}function Vb(e,t,n){if(!n)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}function Wc(e){return kI(e)?e:new kk(e)}function kI(e){return!!(e&&typeof e=="object"&&"message"in e&&"messages"in e)}function SI(e){return typeof e=="string"||_I(e)}function _I(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const EI="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",Gb=[],Kb={allowDangerousHtml:!0},DI=/^(https?|ircs?|mailto|xmpp)$/i,TI=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function Sk(e){const t=AI(e),n=PI(e);return OI(t.runSync(t.parse(n),n),e)}function AI(e){const t=e.rehypePlugins||Gb,n=e.remarkPlugins||Gb,s=e.remarkRehypeOptions?{...e.remarkRehypeOptions,...Kb}:Kb;return CI().use(uM).use(n).use(iI,s).use(t)}function PI(e){const t=e.children||"",n=new kk;return typeof t=="string"&&(n.value=t),n}function OI(e,t){const n=t.allowedElements,s=t.allowElement,a=t.components,i=t.disallowedElements,l=t.skipHtml,o=t.unwrapDisallowed,c=t.urlTransform||MI;for(const u of TI)Object.hasOwn(t,u.from)&&(""+u.from+(u.to?"use `"+u.to+"` instead":"remove it")+EI+u.id,void 0);return Ck(e,d),HP(e,{Fragment:r.Fragment,components:a,ignoreInvalidStyle:!0,jsx:r.jsx,jsxs:r.jsxs,passKeys:!0,passNode:!0});function d(u,m,p){if(u.type==="raw"&&p&&typeof m=="number")return l?p.children.splice(m,1):p.children[m]={type:"text",value:u.value},m;if(u.type==="element"){let f;for(f in rh)if(Object.hasOwn(rh,f)&&Object.hasOwn(u.properties,f)){const y=u.properties[f],g=rh[f];(g===null||g.includes(u.tagName))&&(u.properties[f]=c(String(y||""),f,u))}}if(u.type==="element"){let f=n?!n.includes(u.tagName):i?i.includes(u.tagName):!1;if(!f&&s&&typeof m=="number"&&(f=!s(u,m,p)),f&&p&&typeof m=="number")return o&&u.children?p.children.splice(m,1,...u.children):p.children.splice(m,1),m}}}function MI(e){const t=e.indexOf(":"),n=e.indexOf("?"),s=e.indexOf("#"),a=e.indexOf("/");return t===-1||a!==-1&&t>a||n!==-1&&t>n||s!==-1&&t>s||DI.test(e.slice(0,t))?e:""}const Si=["ariaDescribedBy","ariaLabel","ariaLabelledBy"],Xb={ancestors:{tbody:["table"],td:["table"],th:["table"],thead:["table"],tfoot:["table"],tr:["table"]},attributes:{a:[...Si,"dataFootnoteBackref","dataFootnoteRef",["className","data-footnote-backref"],"href"],blockquote:["cite"],code:[["className",/^language-./]],del:["cite"],div:["itemScope","itemType"],dl:[...Si],h2:[["className","sr-only"]],img:[...Si,"longDesc","src"],input:[["disabled",!0],["type","checkbox"]],ins:["cite"],li:[["className","task-list-item"]],ol:[...Si,["className","contains-task-list"]],q:["cite"],section:["dataFootnotes",["className","footnotes"]],source:["srcSet"],summary:[...Si],table:[...Si],ul:[...Si,["className","contains-task-list"]],"*":["abbr","accept","acceptCharset","accessKey","action","align","alt","axis","border","cellPadding","cellSpacing","char","charOff","charSet","checked","clear","colSpan","color","cols","compact","coords","dateTime","dir","encType","frame","hSpace","headers","height","hrefLang","htmlFor","id","isMap","itemProp","label","lang","maxLength","media","method","multiple","name","noHref","noShade","noWrap","open","prompt","readOnly","rev","rowSpan","rows","rules","scope","selected","shape","size","span","start","summary","tabIndex","title","useMap","vAlign","value","width"]},clobber:["ariaDescribedBy","ariaLabelledBy","id","name"],clobberPrefix:"user-content-",protocols:{cite:["http","https"],href:["http","https","irc","ircs","mailto","xmpp"],longDesc:["http","https"],src:["http","https"]},required:{input:{disabled:!0,type:"checkbox"}},strip:["script"],tagNames:["a","b","blockquote","br","code","dd","del","details","div","dl","dt","em","h1","h2","h3","h4","h5","h6","hr","i","img","input","ins","kbd","li","ol","p","picture","pre","q","rp","rt","ruby","s","samp","section","source","span","strike","strong","sub","summary","sup","table","tbody","td","tfoot","th","thead","tr","tt","ul","var"]},Xa={}.hasOwnProperty;function II(e,t){let n={type:"root",children:[]};const s={schema:t?{...Xb,...t}:Xb,stack:[]},a=_k(s,e);return a&&(Array.isArray(a)?a.length===1?n=a[0]:n.children=a:n=a),n}function _k(e,t){if(t&&typeof t=="object"){const n=t;switch(typeof n.type=="string"?n.type:""){case"comment":return LI(e,n);case"doctype":return RI(e,n);case"element":return $I(e,n);case"root":return FI(e,n);case"text":return zI(e,n)}}}function LI(e,t){if(e.schema.allowComments){const n=typeof t.value=="string"?t.value:"",s=n.indexOf("-->"),i={type:"comment",value:s<0?n:n.slice(0,s)};return jc(i,t),i}}function RI(e,t){if(e.schema.allowDoctypes){const n={type:"doctype"};return jc(n,t),n}}function $I(e,t){const n=typeof t.tagName=="string"?t.tagName:"";e.stack.push(n);const s=Ek(e,t.children),a=BI(e,t.properties);e.stack.pop();let i=!1;if(n&&n!=="*"&&(!e.schema.tagNames||e.schema.tagNames.includes(n))&&(i=!0,e.schema.ancestors&&Xa.call(e.schema.ancestors,n))){const o=e.schema.ancestors[n];let c=-1;for(i=!1;++c<o.length;)e.stack.includes(o[c])&&(i=!0)}if(!i)return e.schema.strip&&!e.schema.strip.includes(n)?s:void 0;const l={type:"element",tagName:n,properties:a,children:s};return jc(l,t),l}function FI(e,t){const s={type:"root",children:Ek(e,t.children)};return jc(s,t),s}function zI(e,t){const s={type:"text",value:typeof t.value=="string"?t.value:""};return jc(s,t),s}function Ek(e,t){const n=[];if(Array.isArray(t)){const s=t;let a=-1;for(;++a<s.length;){const i=_k(e,s[a]);i&&(Array.isArray(i)?n.push(...i):n.push(i))}}return n}function BI(e,t){const n=e.stack[e.stack.length-1],s=e.schema.attributes,a=e.schema.required,i=s&&Xa.call(s,n)?s[n]:void 0,l=s&&Xa.call(s,"*")?s["*"]:void 0,o=t&&typeof t=="object"?t:{},c={};let d;for(d in o)if(Xa.call(o,d)){const u=o[d];let m=Jb(e,Qb(i,d),d,u);m==null&&(m=Jb(e,Qb(l,d),d,u)),m!=null&&(c[d]=m)}if(a&&Xa.call(a,n)){const u=a[n];for(d in u)Xa.call(u,d)&&!Xa.call(c,d)&&(c[d]=u[d])}return c}function Jb(e,t,n,s){return t?Array.isArray(s)?UI(e,t,n,s):Dk(e,t,n,s):void 0}function UI(e,t,n,s){let a=-1;const i=[];for(;++a<s.length;){const l=Dk(e,t,n,s[a]);(typeof l=="number"||typeof l=="string")&&i.push(l)}return i}function Dk(e,t,n,s){if(!(typeof s!="boolean"&&typeof s!="number"&&typeof s!="string")&&qI(e,n,s)){if(typeof t=="object"&&t.length>1){let a=!1,i=0;for(;++i<t.length;){const l=t[i];if(l&&typeof l=="object"&&"flags"in l){if(l.test(String(s))){a=!0;break}}else if(l===s){a=!0;break}}if(!a)return}return e.schema.clobber&&e.schema.clobberPrefix&&e.schema.clobber.includes(n)?e.schema.clobberPrefix+s:s}}function qI(e,t,n){const s=e.schema.protocols&&Xa.call(e.schema.protocols,t)?e.schema.protocols[t]:void 0;if(!s||s.length===0)return!0;const a=String(n),i=a.indexOf(":"),l=a.indexOf("?"),o=a.indexOf("#"),c=a.indexOf("/");if(i<0||c>-1&&i>c||l>-1&&i>l||o>-1&&i>o)return!0;let d=-1;for(;++d<s.length;){const u=s[d];if(i===u.length&&a.slice(0,u.length)===u)return!0}return!1}function jc(e,t){const n=ZC(t);t.data&&(e.data=Qo(t.data)),n&&(e.position=n)}function Qb(e,t){let n,s=-1;if(e)for(;++s<e.length;){const a=e[s],i=typeof a=="string"?a:a[0];if(i===t)return a;i==="data*"&&(n=a)}if(t.length>4&&t.slice(0,4).toLowerCase()==="data")return n}function Tk(e){return function(t){return II(t,e)}}const Ak=h.memo(({message:e,isLast:t})=>{const[n,s]=h.useState(!1),[a,i]=h.useState(!1),[l,o]=h.useState(!1),c=e.from==="user",d=e.from==="tool",u=async()=>{try{await navigator.clipboard.writeText(e.text),i(!0),setTimeout(()=>i(!1),2e3)}catch(p){console.error("Failed to copy text:",p)}},m=p=>{if(!p)return"";const f=new Date(p),y=new Date;return f.toDateString()===y.toDateString()?f.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):f.toLocaleDateString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};return d?r.jsx(de.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex justify-center my-2",children:r.jsx("div",{className:"w-full max-w-md",children:r.jsxs("div",{className:`text-xs bg-prelude-50 border border-prelude-200 rounded-lg p-3 ${e.expandable?"cursor-pointer hover:bg-prelude-100 transition-colors":""}`,onClick:e.expandable?()=>s(!n):void 0,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(ys,{className:"w-3 h-3 text-prelude-600"}),r.jsx("span",{className:"text-prelude-800 font-medium",children:e.text})]}),e.expandable&&r.jsx("div",{className:"text-prelude-600",children:n?r.jsx(Xt,{className:"w-3 h-3"}):r.jsx(Ta,{className:"w-3 h-3"})})]}),r.jsx(ht,{children:n&&e.details&&r.jsx(de.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-3 pt-3 border-t border-prelude-200",children:r.jsxs("div",{className:"text-prelude-700 space-y-2",children:[e.details.type==="call"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("strong",{children:"Function:"}),r.jsx("span",{"aria-label":`Function name: ${e.details.function_name}`,children:e.details.function_name})]}),r.jsxs("div",{children:[r.jsx("strong",{children:"ID:"})," ",e.details.invocation_id]}),e.details.args&&r.jsxs("div",{children:[r.jsx("strong",{children:"Arguments:"}),r.jsx("pre",{className:"mt-1 text-xs bg-prelude-100 p-2 rounded overflow-x-auto",children:JSON.stringify(e.details.args,null,2)})]})]}),e.details.type==="response"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("strong",{children:"Function:"})," ",e.details.function_name]}),r.jsxs("div",{children:[r.jsx("strong",{children:"ID:"})," ",e.details.invocation_id]}),e.details.response&&r.jsxs("div",{children:[r.jsx("strong",{children:"Response:"}),r.jsx("pre",{className:"mt-1 text-xs bg-prelude-100 p-2 rounded overflow-x-auto",children:JSON.stringify(e.details.response,null,2)})]})]})]})})})]})})}):r.jsxs(de.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex gap-3 ${c?"flex-row-reverse":"flex-row"} mb-4`,children:[r.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${c?"bg-prelude-800":"bg-prelude-600"}`,children:c?r.jsx(_t,{className:"w-4 h-4 text-white"}):r.jsx(Ol,{className:"w-4 h-4 text-white"})}),r.jsxs("div",{className:`max-w-[70%] ${c?"items-end":"items-start"} flex flex-col`,children:[r.jsxs("div",{className:`group relative px-4 py-2 rounded-2xl ${c?"bg-prelude-800 text-white":"bg-prelude-50 text-prelude-900 border border-prelude-200"}`,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[r.jsx("button",{onClick:u,className:`absolute top-1 ${c?"left-1":"right-1"} opacity-0 group-hover:opacity-100 transition-opacity duration-200 p-1 rounded ${c?"hover:bg-prelude-700 text-prelude-200":"hover:bg-prelude-100 text-prelude-600"}`,title:"Copy message",children:a?r.jsx(Xr,{className:"w-3 h-3"}):r.jsx(yc,{className:"w-3 h-3"})}),r.jsx("div",{className:`prose prose-sm max-w-none ${c?"prose-invert":""}`,children:r.jsx(Sk,{rehypePlugins:[Tk],components:{p:({children:p})=>r.jsx("p",{className:"my-0",children:p}),a:({children:p,href:f})=>r.jsx("a",{href:f,target:"_blank",rel:"noopener noreferrer",className:c?"text-prelude-200 underline hover:text-white":"text-prelude-700 underline hover:text-prelude-900",children:p}),code:({children:p})=>r.jsx("code",{className:`px-1 py-0.5 rounded text-sm ${c?"bg-prelude-700":"bg-prelude-100"}`,children:p}),pre:({children:p})=>r.jsx("pre",{className:`p-2 rounded-lg overflow-x-auto text-sm my-2 ${c?"bg-prelude-700":"bg-prelude-100"}`,children:p})},children:e.text})})]}),r.jsxs("div",{className:`flex items-center gap-1 mt-1 text-xs text-gray-500 ${c?"flex-row-reverse":"flex-row"} ${l||t?"opacity-100":"opacity-0"} transition-opacity duration-200`,children:[e.timestamp&&r.jsxs(r.Fragment,{children:[r.jsx(jt,{className:"w-3 h-3"}),r.jsx("span",{children:m(e.timestamp)})]}),e.status&&r.jsx("span",{className:`text-xs px-1 py-0.5 rounded ${e.status==="sent"?"text-blue-600":e.status==="received"?"text-green-600":"text-gray-500"}`,children:e.status})]})]})]})});Ak.displayName="Message";const Pk=h.memo(({onSuggestionClick:e,context:t="calendar"})=>{const s=(a=>{const i={leads:["How can I generate new leads?","What lead sources are available?","Show me lead conversion metrics","Help me qualify prospects"],"sales-center":["What sales tools are available?","Show me sales performance metrics","How do I track deal pipeline?","Help me with sales training"],crm:["How do I manage customer relationships?","Show me customer analytics","Help me track customer interactions","What CRM features are available?"],employees:["How do I manage team assignments?","Show me employee performance data","Help me match skills to customers","What team management tools exist?"],calendar:["Help me schedule meetings","Show me calendar integrations","How do I manage appointments?","What scheduling features are available?"],"usage-analytics":["Show me platform usage statistics","What analytics are available?","Help me track user engagement","Generate usage reports"]},l=["What tools do you have?","Give me a summary of the program"];return[...(i[a]||i.calendar).slice(0,2),...l]})(t);return r.jsxs(de.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{delay:.3,duration:.4},className:"mt-6 space-y-2",children:[r.jsx("p",{className:"text-xs text-gray-500 text-center mb-3",children:t!=="calendar"?`${t.charAt(0).toUpperCase()+t.slice(1)} suggestions:`:"Suggested questions:"}),r.jsx("div",{className:"flex flex-col gap-2",children:s.map((a,i)=>r.jsx(de.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4+i*.1,duration:.3},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>e(a),className:"px-4 py-2 text-sm text-prelude-700 bg-prelude-50 border border-prelude-200 rounded-lg hover:bg-prelude-100 hover:border-prelude-300 transition-all duration-200 text-left",children:a},a))})]})});Pk.displayName="QuickSuggestions";const HI=({sessionId:e,messages:t=[],isConnected:n,error:s,send:a,isAgentThinking:i=!1,isLoading:l=!1,context:o="calendar"})=>{const[c,d]=h.useState(""),[u,m]=h.useState(!0),p=h.useRef(null),f=h.useRef(null);h.useEffect(()=>{if(t.length>0){const b=setTimeout(()=>{p.current&&p.current.scrollIntoView({behavior:"instant"})},10);return()=>clearTimeout(b)}},[t.length]),h.useEffect(()=>{f.current&&(f.current.style.height="auto",f.current.style.height=`${Math.min(f.current.scrollHeight,120)}px`)},[c]),h.useEffect(()=>{t.length>0||i?m(!1):t.length===0&&!i&&!l&&m(!0)},[t.length,i,l]);const y=(b=null)=>{const v=b||c.trim();!v||!n||i||(d(""),m(!1),a&&a(v))},g=b=>{y(b)},x=b=>{b.key==="Enter"&&!b.shiftKey&&(b.preventDefault(),y())};return r.jsxs("div",{className:"flex flex-col h-full bg-white",children:[r.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-6",children:[l&&r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Ct,{className:"w-8 h-8 text-prelude-400 mx-auto mb-3 animate-spin"}),r.jsx("p",{className:"text-sm text-prelude-500",children:"Loading conversation..."})]})}),!l&&t.length===0&&!i&&r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center max-w-md",children:[r.jsx(Ol,{className:"w-12 h-12 text-prelude-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-prelude-900 mb-2",children:"Start a conversation"}),r.jsx("p",{className:"text-sm text-prelude-500 mb-6",children:"Ask me anything and I'll do my best to help"}),u&&r.jsx(Pk,{onSuggestionClick:g,context:o})]})}),!l&&r.jsxs("div",{className:"space-y-3",children:[t.map((b,v)=>r.jsx(Ak,{message:b,isLast:v===t.length-1},`${e}-msg-${v}-${b.from||"unknown"}`)),i&&r.jsxs(de.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex gap-3",children:[r.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-prelude-600 flex items-center justify-center shadow-sm",children:r.jsx(Ol,{className:"w-4 h-4 text-white"})}),r.jsx("div",{className:"bg-prelude-50 border border-prelude-200 px-4 py-2 rounded-2xl",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ct,{className:"w-3 h-3 animate-spin text-prelude-600"}),r.jsx("span",{className:"text-sm text-prelude-700 font-medium",children:"Processing..."})]})})]},"thinking-indicator")]},"messages-container"),r.jsx("div",{ref:p})]}),s&&r.jsx("div",{className:"px-4 py-2 bg-red-50 border-t border-red-200",children:r.jsx("p",{className:"text-sm text-red-600",children:s.message||String(s)})}),r.jsx("div",{className:"border-t px-4 py-4",children:r.jsxs("div",{className:"relative",children:[r.jsxs("div",{className:"flex items-end gap-2",children:[r.jsxs("div",{className:"flex-1 relative",children:[r.jsx("textarea",{ref:f,value:c,onChange:b=>d(b.target.value),onKeyDown:x,placeholder:n?i?"Agent is responding...":"Type a message...":"Connecting...",disabled:!n,className:`w-full resize-none rounded-lg border px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-prelude-500 focus:border-transparent disabled:bg-gray-50 disabled:text-gray-500 min-h-[40px] max-h-[120px] pr-12 ${c.length>1e3?"border-red-300 focus:ring-red-500":c.length>800?"border-yellow-300 focus:ring-yellow-500":"border-prelude-300"}`,rows:1}),r.jsx("div",{className:`absolute bottom-1 right-1 text-xs px-1 rounded ${c.length>1e3?"text-red-600 bg-red-50":c.length>800?"text-yellow-600 bg-yellow-50":"text-gray-400"}`,children:c.length})]}),r.jsx(H,{onClick:y,disabled:!n||!c.trim()||i||c.length>1e3,size:"sm",className:`rounded-lg px-4 h-[40px] transition-all duration-200 ${c.trim()&&n&&!i&&c.length<=1e3?"bg-prelude-800 hover:bg-prelude-900 text-white scale-100":"bg-gray-300 text-gray-500 scale-95"}`,children:r.jsx(to,{className:"h-4 w-4"})})]}),r.jsxs("div",{className:"flex justify-between items-center mt-2",children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Press Enter to send  Shift + Enter for new line"}),c.length>800&&r.jsx("p",{className:`text-xs ${c.length>1e3?"text-red-600":"text-yellow-600"}`,children:c.length>1e3?"Message too long":"Approaching limit"})]})]})})]})},WI=h.memo(HI),YI=({isVisible:e,onToggleVisibility:t,sessionId:n,isConnected:s,messages:a,error:i,send:l,isAgentThinking:o,isLoading:c,context:d="calendar"})=>{const[u,m]=h.useState(!1),[p,f]=h.useState({width:500,height:1e3}),[y,g]=h.useState(()=>({x:Math.max(0,((window==null?void 0:window.innerWidth)||1200)-520),y:Math.max(0,((window==null?void 0:window.innerHeight)||1200)-1020)})),[x,b]=h.useState(!1),[v,w]=h.useState(!1),[N,k]=h.useState(null),[j,S]=h.useState({x:0,y:0}),_=h.useRef(null),C={width:320,height:400},D={width:800,height:1200};h.useEffect(()=>{const P=()=>{const $=window.innerWidth,R=window.innerHeight,U=u?320:p.width,I=u?60:p.height;g(z=>({x:Math.min(Math.max(0,z.x),$-U),y:Math.min(Math.max(0,z.y),R-I)}))};return window.addEventListener("resize",P),()=>window.removeEventListener("resize",P)},[u,p]),h.useEffect(()=>{const P=$=>{$.key==="Escape"&&e&&t()};return document.addEventListener("keydown",P),()=>document.removeEventListener("keydown",P)},[e,t]);const A=h.useCallback(P=>{if(P.target.closest(".chat-content")||P.target.closest(".no-drag")||P.target.closest(".resize-handle"))return;P.preventDefault(),b(!0);const $=P.touches?P.touches[0].clientX:P.clientX,R=P.touches?P.touches[0].clientY:P.clientY;S({x:$-y.x,y:R-y.y})},[y]),E=h.useCallback((P,$)=>{P.stopPropagation(),P.preventDefault(),w(!0),k($);const R=P.touches?P.touches[0].clientX:P.clientX,U=P.touches?P.touches[0].clientY:P.clientY;S({x:R,y:U})},[]),T=h.useCallback(P=>{if(!x&&!v)return;P.preventDefault();const $=P.touches?P.touches[0].clientX:P.clientX,R=P.touches?P.touches[0].clientY:P.clientY;if(x){const U=window.innerWidth,I=window.innerHeight,z=u?320:p.width,F=u?60:p.height,O=Math.min(Math.max(0,$-j.x),U-z),K=Math.min(Math.max(0,R-j.y),I-F);g({x:O,y:K})}else if(v){const U=$-j.x,I=R-j.y;f(z=>{let F=z.width,O=z.height;return N.includes("right")&&(F=Math.min(Math.max(C.width,z.width+U),D.width)),N.includes("left")&&(F=Math.min(Math.max(C.width,z.width-U),D.width)),N.includes("bottom")&&(O=Math.min(Math.max(C.height,z.height+I),D.height)),N.includes("top")&&(O=Math.min(Math.max(C.height,z.height-I),D.height)),{width:F,height:O}}),S({x:$,y:R})}},[x,v,j,N,u,p,C,D]),M=h.useCallback(()=>{b(!1),w(!1),k(null)},[]);h.useEffect(()=>{if(x||v)return document.addEventListener("mousemove",T),document.addEventListener("mouseup",M),document.addEventListener("touchmove",T,{passive:!1}),document.addEventListener("touchend",M),document.body.style.userSelect="none",document.body.style.cursor=x?"grabbing":v?`${N}-resize`:"default",()=>{document.removeEventListener("mousemove",T),document.removeEventListener("mouseup",M),document.removeEventListener("touchmove",T),document.removeEventListener("touchend",M),document.body.style.userSelect="",document.body.style.cursor="default"}},[x,v,T,M,N]);const L=()=>{m(!u)};return e?r.jsxs(de.div,{ref:_,initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},style:{position:"fixed",left:y.x,top:y.y,zIndex:1e3,width:u?320:p.width,height:u?60:p.height},className:"bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-prelude-200/50 overflow-hidden ring-1 ring-white/10",onMouseDown:A,onTouchStart:A,children:[r.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-prelude-800 to-prelude-900 border-b border-white/10 cursor-move",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"p-1.5 rounded-lg bg-white/10",children:r.jsx(D4,{className:"h-4 w-4 text-white/80"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm font-sans font-semibold text-white",children:"AI Assistant"}),r.jsxs("div",{className:"flex items-center space-x-2 mt-0.5",children:[r.jsx("div",{className:`w-2 h-2 rounded-full transition-colors duration-300 ${s?"bg-emerald-400 shadow-emerald-400/50 shadow-sm":"bg-red-400 animate-pulse shadow-red-400/50 shadow-sm"}`}),r.jsx("span",{className:"text-xs font-sans text-white/70",children:s?"Connected":"Connecting..."})]})]})]}),r.jsxs("div",{className:"flex items-center space-x-1 no-drag",children:[r.jsx(H,{variant:"ghost",size:"icon",onClick:L,className:"h-8 w-8 hover:bg-white/10 text-white/80 hover:text-white transition-all duration-200","aria-label":u?"Maximize":"Minimize",children:u?r.jsx(k4,{className:"h-4 w-4"}):r.jsx(_4,{className:"h-4 w-4"})}),r.jsx(H,{variant:"ghost",size:"icon",onClick:t,className:"h-8 w-8 hover:bg-red-500/20 text-white/80 hover:text-red-300 transition-all duration-200","aria-label":"Close Chat",children:r.jsx(Ze,{className:"h-4 w-4"})})]})]}),r.jsx(ht,{children:!u&&r.jsxs(de.div,{initial:{height:0,opacity:0},animate:{height:p.height-77,opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"chat-content overflow-hidden relative",children:[n?r.jsx(WI,{sessionId:n,isConnected:s,messages:a,error:i,send:l,isAgentThinking:o,isLoading:c,context:d}):r.jsx("div",{className:"flex items-center justify-center h-full p-6",children:r.jsxs("div",{className:"text-center space-y-3",children:[r.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-prelude-700 to-prelude-900 rounded-2xl flex items-center justify-center mx-auto mb-4",children:r.jsx(Gu,{className:"h-8 w-8 text-white"})}),r.jsx("h4",{className:"text-base font-sans font-semibold text-prelude-900",children:"No Session Active"}),r.jsx("p",{className:"text-sm font-sans text-prelude-600",children:"Create a new chat session to start"})]})}),!u&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"absolute top-0 left-0 w-3 h-3 cursor-nw-resize resize-handle hover:bg-prelude-300/30 transition-colors",onMouseDown:P=>E(P,"nw"),onTouchStart:P=>E(P,"nw")}),r.jsx("div",{className:"absolute top-0 right-0 w-3 h-3 cursor-ne-resize resize-handle hover:bg-prelude-300/30 transition-colors",onMouseDown:P=>E(P,"ne"),onTouchStart:P=>E(P,"ne")}),r.jsx("div",{className:"absolute bottom-0 left-0 w-3 h-3 cursor-sw-resize resize-handle hover:bg-prelude-300/30 transition-colors",onMouseDown:P=>E(P,"sw"),onTouchStart:P=>E(P,"sw")}),r.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 cursor-se-resize resize-handle hover:bg-prelude-300/30 transition-colors",onMouseDown:P=>E(P,"se"),onTouchStart:P=>E(P,"se")}),r.jsx("div",{className:"absolute top-0 left-3 right-3 h-1 cursor-n-resize resize-handle hover:bg-prelude-300/30 transition-colors",onMouseDown:P=>E(P,"n"),onTouchStart:P=>E(P,"n")}),r.jsx("div",{className:"absolute bottom-0 left-3 right-3 h-1 cursor-s-resize resize-handle hover:bg-prelude-300/30 transition-colors",onMouseDown:P=>E(P,"s"),onTouchStart:P=>E(P,"s")}),r.jsx("div",{className:"absolute left-0 top-3 bottom-3 w-1 cursor-w-resize resize-handle hover:bg-prelude-300/30 transition-colors",onMouseDown:P=>E(P,"w"),onTouchStart:P=>E(P,"w")}),r.jsx("div",{className:"absolute right-0 top-3 bottom-3 w-1 cursor-e-resize resize-handle hover:bg-prelude-300/30 transition-colors",onMouseDown:P=>E(P,"e"),onTouchStart:P=>E(P,"e")}),r.jsx("div",{className:"absolute bottom-2 right-2 opacity-30 hover:opacity-60 transition-opacity pointer-events-none",children:r.jsx(rx,{className:"h-3 w-3 text-prelude-400 transform rotate-45"})})]})]})})]}):null},VI=({isLoading:e,targetView:t,isContentReady:n,onComplete:s})=>{const[a,i]=h.useState(0),[l,o]=h.useState(0),[c,d]=h.useState(!0),[u,m]=h.useState(!1),p=h.useRef(null),f=h.useRef(null),y=h.useRef(null),g=[" Preparing your workspace..."," Loading awesome content..."," Almost there..."," Finalizing details..."," Ready to rock!"],x={dashboard:"Dashboard",leads:"Lead Generation","sales-center":"Sales Center",crm:"Customer Relations",employees:"Team Management",calendar:"Calendar & Scheduling",invitations:"Team Invitations","usage-analytics":"Usage Analytics"};if(h.useEffect(()=>{if(e){m(!0),i(0),o(0),d(!0);let w=0;p.current=setInterval(()=>{w+=Math.random()*3+1,w>=95&&(w=95,p.current&&(clearInterval(p.current),p.current=null)),i(w)},100),f.current=setInterval(()=>{o(N=>N<g.length-2?N+1:N)},800),y.current=setInterval(()=>{d(N=>!N)},800)}else!e&&u&&(p.current&&(clearInterval(p.current),p.current=null),f.current&&(clearInterval(f.current),f.current=null),y.current&&(clearInterval(y.current),y.current=null));return()=>{p.current&&clearInterval(p.current),f.current&&clearInterval(f.current),y.current&&clearInterval(y.current)}},[e]),h.useEffect(()=>{n&&a>=95&&u&&(p.current&&clearInterval(p.current),f.current&&clearInterval(f.current),i(100),o(g.length-1),setTimeout(()=>{m(!1),setTimeout(()=>{s==null||s()},300)},500))},[n,a,u,s]),!u)return null;const b=[RC,q4,Ml,on,Mr,Xo],v=b[l%b.length];return r.jsx(ht,{children:r.jsxs(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-white flex flex-col items-center justify-center z-10",style:{background:"linear-gradient(135deg, rgb(240, 248, 255) 0%, rgb(219, 234, 254) 100%)"},children:[r.jsx(de.div,{className:"mb-8",animate:{x:[0,30,-30,0],y:[0,-15,-15,0],rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:r.jsx(ht,{mode:"wait",children:c&&r.jsx(de.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},exit:{scale:0,rotate:180},transition:{duration:.5},children:r.jsx(v,{className:"w-16 h-16 text-blue-500"})},l)})}),r.jsxs(de.h2,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},className:"text-2xl font-bold text-gray-800 mb-4",children:["Loading ",x[t]||t]}),r.jsxs("div",{className:"w-80 mb-6",children:[r.jsx("div",{className:"bg-gray-200 rounded-full h-3 overflow-hidden",children:r.jsx(de.div,{className:"h-full bg-gradient-to-r from-blue-400 via-cyan-400 to-teal-400 rounded-full",initial:{width:"0%"},animate:{width:`${a}%`},transition:{duration:.2,ease:"linear"},style:{boxShadow:"0 0 10px rgba(59, 130, 246, 0.5)"}})}),r.jsxs("div",{className:"text-center mt-2 flex justify-between items-center",children:[r.jsxs("span",{className:"text-sm text-gray-600",children:[Math.round(a),"%"]}),a>=95&&!n&&r.jsx("span",{className:"text-xs text-gray-500 animate-pulse",children:"Waiting for content..."})]})]}),r.jsx(de.div,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},exit:{y:-10,opacity:0},transition:{duration:.4},className:"text-lg text-gray-700 mb-8 text-center",children:g[l]},l),[...Array(6)].map((w,N)=>r.jsx(de.div,{className:"absolute w-2 h-2 bg-blue-300 rounded-full",style:{left:`${20+N*12}%`,top:`${30+N%2*40}%`},animate:{y:[0,-20,0],opacity:[.3,.8,.3],scale:[1,1.5,1]},transition:{duration:2+N*.5,repeat:1/0,delay:N*.3}},N)),r.jsx("div",{className:"flex space-x-2",children:[0,1,2].map(w=>r.jsx(de.div,{className:"w-3 h-3 bg-blue-400 rounded-full",animate:{y:[0,-10,0]},transition:{duration:.6,repeat:1/0,delay:w*.2}},w))})]})})},GI=({isInitializing:e,isInitialized:t,initError:n,authProvider:s,isAuthenticated:a,userEmail:i,googleConnected:l,outlookConnected:o,googleEmail:c,outlookEmail:d,initializeGapi:u})=>r.jsxs(r.Fragment,{children:[a&&s&&(l||o)&&r.jsx("div",{className:"mb-4",children:r.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:r.jsxs("div",{className:"flex items-center space-x-2",children:[s==="google"?r.jsx(Dt,{className:"h-4 w-4 text-green-600"}):r.jsx(_n,{className:"h-4 w-4 text-blue-600"}),r.jsxs("div",{children:[r.jsx("span",{className:"text-sm text-green-800 font-medium",children:"Connected via App Login"}),r.jsxs("div",{className:"text-xs text-green-600",children:[s==="google"?"Gmail":"Outlook",": ",i]})]}),r.jsx(bt,{className:"h-4 w-4 text-green-500 ml-auto"})]})})}),e&&r.jsx(de.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(de.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"rounded-full h-4 w-4 border-b-2 border-blue-600 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-blue-900",children:"Setting Up Calendar"}),r.jsx("p",{className:"text-sm text-blue-700",children:"Connecting to your personal Google Calendar..."})]})]})}),n&&r.jsx(de.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:r.jsxs("div",{className:"flex items-start space-x-2",children:[r.jsx(dt,{className:"h-5 w-5 text-red-600 mt-0.5 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-red-900",children:"Setup Required"}),r.jsx("p",{className:"text-sm text-red-700 mt-1",children:n}),n.includes("update your .env file")&&r.jsxs("div",{className:"mt-2 text-xs text-red-600",children:[r.jsx("p",{className:"font-medium",children:"Quick Setup Steps:"}),r.jsxs("ol",{className:"list-decimal list-inside mt-1 space-y-1",children:[r.jsxs("li",{children:["Go to ",r.jsx("a",{href:"https://console.cloud.google.com/",target:"_blank",rel:"noopener noreferrer",className:"underline",children:"Google Cloud Console"})]}),r.jsx("li",{children:"Create a new project"}),r.jsx("li",{children:"Enable Google Calendar API"}),r.jsx("li",{children:"Create API Key and OAuth Client ID"}),r.jsx("li",{children:"Update your .env file with the credentials"})]})]}),r.jsx(H,{variant:"outline",size:"sm",onClick:u,className:"mt-2 text-xs",children:"Retry Setup"})]})]})}),!a&&r.jsxs(de.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"p-4",children:[r.jsx(yt,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),r.jsx("h3",{className:"font-display font-medium text-prelude-900 mb-2 text-center",children:"Calendar & Email Access"}),r.jsx("p",{className:"text-sm text-gray-600 font-inter mb-4 text-center",children:"Please log in to the app to access your calendar and email"}),r.jsx("div",{className:"text-center",children:r.jsx(H,{onClick:()=>window.location.href="/login",className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Go to Login"})})]})]}),Zu=e=>{var i,l,o,c,d;const t=((i=e.start)==null?void 0:i.dateTime)||((l=e.start)==null?void 0:l.date),n=((o=e.end)==null?void 0:o.dateTime)||((c=e.end)==null?void 0:c.date);if(!t)return"All day";const s=new Date(t),a=new Date(n);return(d=e.start)!=null&&d.date?"All day":`${s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})} - ${a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`},vx=e=>{var i,l;const t=((i=e.start)==null?void 0:i.dateTime)||((l=e.start)==null?void 0:l.date);if(!t)return"";const n=new Date(t),s=new Date,a=new Date(s);return a.setDate(a.getDate()+1),n.toDateString()===s.toDateString()?"Today":n.toDateString()===a.toDateString()?"Tomorrow":n.toLocaleDateString([],{month:"short",day:"numeric"})},Yd=e=>{if(!e)return null;const t=/(https?:\/\/[^\s]+)/g,n=/([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/g,s=e.split(/(\bhttps?:\/\/[^\s]+\b|[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/g);return r.jsx("span",{children:s.map((a,i)=>t.test(a)?r.jsx("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline",children:a},i):n.test(a)?r.jsx("a",{href:`mailto:${a}`,className:"text-blue-600 underline",children:a},i):a)})},KI=e=>new Date(e.getFullYear(),e.getMonth()+1,0).getDate(),XI=e=>new Date(e.getFullYear(),e.getMonth(),1).getDay(),JI=(e,t)=>{const n=new Date(t.getFullYear(),t.getMonth(),1),s=new Date(t.getFullYear(),t.getMonth()+1,0);return e.filter(a=>{var l,o;const i=new Date(((l=a.start)==null?void 0:l.dateTime)||((o=a.start)==null?void 0:o.date));return i>=n&&i<=s})},QI=(e,t,n)=>{const s=new Date(n.getFullYear(),n.getMonth(),t);return e.filter(a=>{var l,o;return new Date(((l=a.start)==null?void 0:l.dateTime)||((o=a.start)==null?void 0:o.date)).toDateString()===s.toDateString()})},Dd=e=>{const t=[],n=new Date(e),s=n.getDay(),a=n.getDate()-s;for(let i=0;i<7;i++){const l=new Date(n);l.setDate(a+i),t.push(l)}return t},ZI=(e,t)=>{const n=Dd(t),s=n[0],a=n[6];return e.filter(i=>{var o,c;const l=new Date(((o=i.start)==null?void 0:o.dateTime)||((c=i.start)==null?void 0:c.date));return l>=s&&l<=new Date(a.getTime()+24*60*60*1e3)})},e3=(e,t)=>e.filter(n=>{var a,i;return new Date(((a=n.start)==null?void 0:a.dateTime)||((i=n.start)==null?void 0:i.date)).toDateString()===t.toDateString()}),Ok=h.memo(({event:e,index:t,setSelectedEvent:n})=>{const s=(i,l,o)=>{i.stopPropagation(),o&&window.open(o,"_blank")},a=h.useMemo(()=>{var l,o,c;const i=(e.location||"")+" "+(e.description||"");return{zoom:(l=i.match(/https?:\/\/[^\s]*zoom\.us[^\s]*/i))==null?void 0:l[0],meet:(o=i.match(/https?:\/\/[^\s]*meet\.google\.com[^\s]*/i))==null?void 0:o[0],teams:(c=i.match(/https?:\/\/[^\s]*teams\.microsoft\.com[^\s]*/i))==null?void 0:c[0]}},[e.location,e.description]);return r.jsx(de.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:t*.05,duration:.2},children:r.jsx(We,{className:"border border-gray-200 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>n(e),children:r.jsx(it,{className:"p-3",children:r.jsxs("div",{className:"flex items-start space-x-3",children:[r.jsx("div",{className:"flex-shrink-0 w-2 h-2 bg-blue-500 rounded-full mt-2"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h4",{className:"font-inter font-medium text-prelude-900 text-sm truncate",children:e.summary||"Untitled Event"}),r.jsxs("div",{className:"flex items-center space-x-2 mt-1 text-xs text-gray-600",children:[r.jsx(jt,{className:"h-3 w-3"}),r.jsxs("span",{className:"font-inter",children:[vx(e),"  ",Zu(e)]})]}),e.location&&r.jsxs("div",{className:"text-xs text-gray-500 font-inter mt-1",children:[" ",Yd(e.location)]}),e.description&&r.jsx("div",{className:"text-xs text-gray-500 font-inter mt-1 line-clamp-2",children:Yd(e.description)}),r.jsxs("div",{className:"flex space-x-2 mt-2",children:[a.zoom&&r.jsx("button",{onClick:i=>s(i,"zoom",a.zoom),className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200 transition-colors inline-flex items-center",children:" Join Zoom"}),a.meet&&r.jsx("button",{onClick:i=>s(i,"meet",a.meet),className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded hover:bg-green-200 transition-colors inline-flex items-center",children:" Join Meet"}),a.teams&&r.jsx("button",{onClick:i=>s(i,"teams",a.teams),className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded hover:bg-purple-200 transition-colors inline-flex items-center",children:" Join Teams"})]})]})]})})})})});Ok.displayName="EventCard";const $f=h.memo(({date:e,events:t,isToday:n,isCurrentMonth:s,setSelectedEvent:a,isWeekView:i=!1,dayNumber:l})=>{const o=`
    p-2 ${i?"h-32":"h-20"} border border-gray-200 rounded cursor-pointer 
    hover:bg-gray-50 transition-colors
    ${n?"bg-blue-50 border-blue-300":"bg-white"}
    ${!s&&!i?"opacity-60":""}
  `,c=d=>{const u=[],m=(d.location||"")+" "+(d.description||"");return m.includes("zoom.us")&&u.push(""),m.includes("meet.google.com")&&u.push(""),m.includes("teams.microsoft.com")&&u.push(""),u};return r.jsxs(de.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:(l||0)*.01,duration:.2},className:o,children:[r.jsx("div",{className:`text-xs font-medium mb-${i?"2":"1"} ${n?"text-blue-600":s?"text-gray-900":"text-gray-500"}`,children:i?r.jsxs(r.Fragment,{children:[e.getDate(),r.jsx("span",{className:"text-xs ml-1 font-normal",children:e.toLocaleDateString("en-US",{month:"short"})})]}):l||e.getDate()}),r.jsxs("div",{className:`space-y-1 ${i?"overflow-y-auto max-h-20":""}`,children:[t.slice(0,i?4:2).map((d,u)=>{var m;return r.jsxs("div",{className:"text-xs bg-blue-100 text-blue-800 px-1 py-0.5 rounded truncate cursor-pointer hover:bg-blue-200 transition-colors relative",title:`${d.summary} - ${Zu(d)}`,onClick:p=>{p.stopPropagation(),a(d)},children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"truncate flex-1",children:d.summary||"Event"}),r.jsx("div",{className:"flex space-x-0.5 ml-1",children:c(d).map((p,f)=>r.jsx("span",{className:"text-xs",children:p},f))})]}),i&&((m=d.start)==null?void 0:m.dateTime)&&r.jsx("div",{className:"text-xs text-blue-600 mt-0.5",children:new Date(d.start.dateTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},u)}),t.length>(i?4:2)&&r.jsxs("div",{className:"text-xs text-gray-500 cursor-pointer hover:text-gray-700",onClick:d=>{d.stopPropagation(),t[i?4:2]&&a(t[i?4:2])},children:["+",t.length-(i?4:2)," more"]})]})]})});$f.displayName="CalendarDay";const t3=({viewMode:e,events:t,loading:n,setSelectedEvent:s,calendarViewMode:a,currentDate:i,getWeekDates:l,getWeekEvents:o,getEventsForDate:c,getDaysInMonth:d,getFirstDayOfMonth:u,getMonthEvents:m,getEventsForDay:p,analytics:f,dashboardStats:y})=>{const g=h.useMemo(()=>!t||!Array.isArray(t)?[]:t.sort((x,b)=>{var N,k,j,S;const v=new Date(((N=x.start)==null?void 0:N.dateTime)||((k=x.start)==null?void 0:k.date)),w=new Date(((j=b.start)==null?void 0:j.dateTime)||((S=b.start)==null?void 0:S.date));return v-w}),[t]);return n?r.jsxs("div",{className:"text-center py-8",children:[r.jsx(de.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"rounded-full h-6 w-6 border-b-2 border-prelude-800 mx-auto mb-2"}),r.jsx("p",{className:"text-sm text-gray-600 font-inter",children:"Loading events..."})]}):e==="list"?r.jsx(Mk,{events:g,setSelectedEvent:s}):e==="calendar"?r.jsx(Ik,{events:g,calendarViewMode:a,currentDate:i,setSelectedEvent:s,getWeekDates:l,getWeekEvents:o,getEventsForDate:c,getDaysInMonth:d,getFirstDayOfMonth:u,getMonthEvents:m,getEventsForDay:p}):e==="intelligence"?r.jsx(Lk,{events:g,setSelectedEvent:s,analytics:f,dashboardStats:y}):null},Mk=h.memo(({events:e,setSelectedEvent:t})=>r.jsx("div",{className:"space-y-3",children:e.length>0?e.map((n,s)=>r.jsx(Ok,{event:n,index:s,setSelectedEvent:t},n.id||s)):r.jsxs("div",{className:"text-center py-8",children:[r.jsx(yt,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),r.jsx("p",{className:"text-sm text-gray-600 font-inter",children:"No upcoming events in your calendar"})]})}));Mk.displayName="ListView";const Ik=h.memo(({events:e,calendarViewMode:t,currentDate:n,setSelectedEvent:s,getWeekDates:a,getWeekEvents:i,getEventsForDate:l,getDaysInMonth:o,getFirstDayOfMonth:c,getMonthEvents:d,getEventsForDay:u})=>{const m=h.useMemo(()=>["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],[]),p=h.useMemo(()=>{try{if(t==="week"){const f=a(n),y=i(e,n);return f.map((g,x)=>{const b=l(y,g),v=new Date().toDateString()===g.toDateString(),w=g.getMonth()===n.getMonth();return r.jsx($f,{date:g,events:b,isToday:v,isCurrentMonth:w,setSelectedEvent:s,isWeekView:!0,dayNumber:x},`week-${x}`)})}else{const f=o(n),y=c(n),g=d(e,n),x=[];for(let b=0;b<y;b++)x.push(r.jsx("div",{className:"p-2 h-20 bg-gray-50 rounded"},`empty-${b}`));for(let b=1;b<=f;b++){const v=u(g,b,n),w=new Date().toDateString()===new Date(n.getFullYear(),n.getMonth(),b).toDateString();x.push(r.jsx($f,{date:new Date(n.getFullYear(),n.getMonth(),b),events:v,isToday:w,isCurrentMonth:!0,setSelectedEvent:s,isWeekView:!1,dayNumber:b},`day-${b}`))}return x}}catch(f){return console.error("Error rendering calendar days:",f),null}},[t,n,e,a,i,l,o,c,d,u,s]);return r.jsx("div",{className:"space-y-4",children:r.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[m.map(f=>r.jsx("div",{className:"p-2 text-center text-xs font-medium text-gray-500 bg-gray-50 rounded",children:f},f)),p]})})});Ik.displayName="CalendarGridView";const Lk=h.memo(({events:e,setSelectedEvent:t,analytics:n,dashboardStats:s})=>r.jsxs("div",{className:"space-y-6",children:[r.jsxs(We,{children:[r.jsx(ir,{children:r.jsxs(cr,{className:"flex items-center gap-2",children:[r.jsx(Br,{className:"w-5 h-5 text-purple-600"}),"Meeting Intelligence Dashboard"]})}),r.jsx(it,{children:r.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[r.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded",children:[r.jsx("p",{className:"text-2xl font-bold text-blue-600",children:e.length}),r.jsx("p",{className:"text-sm text-gray-600",children:"Total Meetings"})]}),r.jsxs("div",{className:"text-center p-4 bg-green-50 rounded",children:[r.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[(s==null?void 0:s.avgHealthScore)||87,"%"]}),r.jsx("p",{className:"text-sm text-gray-600",children:"Success Rate"})]}),r.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded",children:[r.jsx("p",{className:"text-2xl font-bold text-purple-600",children:"42m"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Avg Duration"})]}),r.jsxs("div",{className:"text-center p-4 bg-red-50 rounded",children:[r.jsx("p",{className:"text-2xl font-bold text-red-600",children:"2"}),r.jsx("p",{className:"text-sm text-gray-600",children:"High Risk"})]})]})})]}),e.length>0&&r.jsxs(We,{children:[r.jsx(ir,{children:r.jsx(cr,{className:"text-lg",children:"Select a Meeting for Detailed Analysis"})}),r.jsx(it,{children:r.jsx("div",{className:"space-y-2",children:e.slice(0,5).map(a=>r.jsxs("div",{onClick:()=>t(a),className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-blue-50 transition-colors",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-sm",children:a.summary||"Untitled Event"}),r.jsxs("p",{className:"text-xs text-gray-600",children:[vx(a),"  ",Zu(a)]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:"flex items-center gap-1 text-xs bg-green-100 text-green-700 px-2 py-1 rounded",children:[r.jsx(Er,{className:"w-3 h-3"}),Math.floor(Math.random()*30)+70,"%"]}),r.jsx(Br,{className:"w-4 h-4 text-purple-600"})]})]},a.id))})})]})]}));Lk.displayName="IntelligenceView";const r3=h.memo(t3),n3=({event:e,onClose:t})=>e?r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:t,children:r.jsxs(de.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-lg max-w-md w-full max-h-96 overflow-y-auto",onClick:n=>n.stopPropagation(),children:[r.jsxs("div",{className:"p-4 border-b border-gray-200",children:[r.jsx("h3",{className:"font-display font-semibold text-prelude-900",children:e.summary||"Untitled Event"}),r.jsxs("div",{className:"flex items-center space-x-2 mt-2 text-sm text-gray-600",children:[r.jsx(jt,{className:"h-4 w-4"}),r.jsxs("span",{children:[vx(e),"  ",Zu(e)]})]})]}),r.jsxs("div",{className:"p-4 space-y-4",children:[e.location&&r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Location"}),r.jsx("div",{className:"text-sm text-gray-600",children:Yd(e.location)})]}),e.description&&r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Description"}),r.jsx("div",{className:"text-sm text-gray-600 whitespace-pre-wrap",children:Yd(e.description)})]}),e.htmlLink&&r.jsx("div",{children:r.jsxs("a",{href:e.htmlLink,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-blue-600 hover:text-blue-800 text-sm",children:["View in Google Calendar",r.jsx(sa,{className:"h-3 w-3 ml-1"})]})})]}),r.jsx("div",{className:"p-4 border-t border-gray-200",children:r.jsx(H,{onClick:t,variant:"outline",className:"w-full",children:"Close"})})]})}):null,Zb={gapi:"https://apis.google.com/js/api.js",gsi:"https://accounts.google.com/gsi/client"};let Yc=!1,Vc=!1;function s3(){const[e,t]=h.useState(Yc),[n,s]=h.useState(Vc),[a,i]=h.useState(null);return h.useEffect(()=>{const l=(c,d)=>new Promise((u,m)=>{if(c==="gapi"&&Yc||c==="gsi"&&Vc){u();return}const p=document.createElement("script");p.src=d,p.async=!0,p.defer=!0,p.onload=()=>{c==="gapi"?(Yc=!0,t(!0)):c==="gsi"&&(Vc=!0,s(!0)),u()},p.onerror=()=>{i(`Failed to load ${c} script.`),m(new Error(`Failed to load ${c} script.`))},document.body.appendChild(p)});(!Yc||!Vc)&&(async()=>{try{await Promise.all([l("gapi",Zb.gapi),l("gsi",Zb.gsi)])}catch(c){console.error(c)}})()},[]),{isGapiLoaded:e,isGsiLoaded:n,error:a,areScriptsLoaded:e&&n}}const a3=()=>{const{areScriptsLoaded:e}=s3(),{user:t,authProvider:n,isAuthenticated:s}=Qr(),[a,i]=h.useState(null),[l,o]=h.useState(!1),[c,d]=h.useState(!1),[u,m]=h.useState([]),[p,f]=h.useState(!1),[y,g]=h.useState(!1),[x,b]=h.useState(null),[v,w]=h.useState(!0),[N,k]=h.useState(""),[j,S]=h.useState(""),[_,C]=h.useState(""),[D,A]=h.useState(null),[E,T]=h.useState(null),[M,L]=h.useState("list"),[P,$]=h.useState("month"),[R,U]=h.useState(new Date),[I,z]=h.useState(null),[F,O]=h.useState(!1),K=void 0,J=void 0,se="https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest";h.useEffect(()=>{if(console.log("Calendar: Checking app login tokens",{authProvider:n,isAuthenticated:s}),s&&n){if(n==="google"){const G=localStorage.getItem("google_access_token"),q=localStorage.getItem("google_user_email");G&&G!=="undefined"&&G!=="null"&&(A(G),S(q||(t==null?void 0:t.email)||""),o(!0),i("google"),k(q||(t==null?void 0:t.email)||""))}else if(n==="microsoft"){const G=localStorage.getItem("microsoft_access_token"),q=localStorage.getItem("microsoft_user_email");G&&G!=="undefined"&&G!=="null"&&(T(G),C(q||(t==null?void 0:t.email)||""),d(!0),i("outlook"),k(q||(t==null?void 0:t.email)||""))}}w(!1)},[n,s,t]);const Z=h.useCallback(async()=>{if(e)try{if(!K||!J||K==="YOUR_NEW_API_KEY_HERE"||J==="YOUR_NEW_CLIENT_ID_HERE.apps.googleusercontent.com")throw new Error("Please update your .env file with Google API credentials.");await new Promise((G,q)=>{window.gapi.load("client",{callback:G,onerror:q})}),await window.gapi.client.init({apiKey:K,discoveryDocs:[se]}),window.google.accounts.id.initialize({client_id:J,callback:()=>{}}),g(!0)}catch(G){console.error("Error initializing Google API:",G),b(G.message)}},[e,K,J]);h.useEffect(()=>{e&&Z()},[e,Z]);const oe=h.useCallback(async()=>{var G,q;if(a){f(!0);try{if(a==="google"&&D){if((q=(G=window.gapi)==null?void 0:G.client)!=null&&q.calendar){window.gapi.client.setToken({access_token:D});const Q=await window.gapi.client.calendar.events.list({calendarId:"primary",timeMin:new Date().toISOString(),showDeleted:!1,singleEvents:!0,maxResults:10,orderBy:"startTime"});m(Q.result.items||[])}}else if(a==="outlook"&&E){const Q=await fetch("https://graph.microsoft.com/v1.0/me/events?$top=10&$orderby=start/dateTime",{headers:{Authorization:`Bearer ${E}`}});if(Q.ok){const Le=(await Q.json()).value.map(ge=>{var Se;return{id:ge.id,summary:ge.subject,start:{dateTime:ge.start.dateTime,timeZone:ge.start.timeZone},end:{dateTime:ge.end.dateTime,timeZone:ge.end.timeZone},location:(Se=ge.location)==null?void 0:Se.displayName,description:ge.bodyPreview}});m(Le)}}}catch(Q){console.error("Error fetching events:",Q),b("Failed to fetch calendar events. Please check your permissions.")}finally{f(!1)}}},[a,D,E]);h.useEffect(()=>{(a==="google"&&D||a==="outlook"&&E)&&oe()},[a,D,E,oe]);const W=h.useCallback(async G=>{if(a)try{if(a==="google"&&D){window.gapi.client.setToken({access_token:D});const q=await window.gapi.client.calendar.events.quickAdd({calendarId:"primary",text:G});return oe(),q}else if(a==="outlook"&&E){const q={subject:G,start:{dateTime:new Date().toISOString(),timeZone:"UTC"},end:{dateTime:new Date(Date.now()+36e5).toISOString(),timeZone:"UTC"}},Q=await fetch("https://graph.microsoft.com/v1.0/me/events",{method:"POST",headers:{Authorization:`Bearer ${E}`,"Content-Type":"application/json"},body:JSON.stringify(q)});if(Q.ok)return oe(),Q.json()}}catch(q){throw console.error("Error creating event:",q),q}},[a,D,E,oe]),B=h.useCallback(G=>{U(q=>{const Q=new Date(q);return Q.setMonth(q.getMonth()+G),Q})},[]),V=h.useCallback(G=>{U(q=>{const Q=new Date(q);return Q.setDate(q.getDate()+G*7),Q})},[]),re=h.useMemo(()=>({healthScoreTrend:{data:Array.from({length:12},(G,q)=>({month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][q],avgScore:Math.max(0,Math.min(100,Math.floor(Math.random()*20)+70+q*2)),totalCustomers:Math.floor(Math.random()*50)+200}))}}),[]),Me=h.useMemo(()=>({avgHealthScore:85,healthScoreTrend:2.5}),[]),he=l||c;return r.jsxs("div",{className:"h-full flex flex-col bg-white",children:[r.jsxs("div",{className:"p-3 border-b border-gray-200",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(yt,{className:"h-5 w-5 text-prelude-900"}),r.jsx("h2",{className:"text-base font-display font-semibold text-prelude-900",children:"Calendar & Email Integration"}),y&&!x&&r.jsx(bt,{className:"h-4 w-4 text-green-500"})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[he&&l&&c&&r.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1 gap-1",children:[r.jsxs(H,{variant:a==="google"?"default":"ghost",size:"sm",onClick:()=>{i("google"),k(j)},className:"px-2 py-1.5 h-7",title:"Switch to Google",children:[r.jsx(Dt,{className:"h-3 w-3 mr-1"}),"Google"]}),r.jsxs(H,{variant:a==="outlook"?"default":"ghost",size:"sm",onClick:()=>{i("outlook"),k(_)},className:"px-2 py-1.5 h-7",title:"Switch to Outlook",children:[r.jsx(_n,{className:"h-3 w-3 mr-1"}),"Outlook"]})]}),he&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1 gap-1",children:[r.jsx(H,{variant:M==="list"?"default":"ghost",size:"sm",onClick:()=>L("list"),className:"px-2 py-1.5 h-7 min-w-[32px]",title:"List View",children:r.jsx(w4,{className:"h-3 w-3"})}),r.jsx(H,{variant:M==="calendar"?"default":"ghost",size:"sm",onClick:()=>L("calendar"),className:"px-2 py-1.5 h-7 min-w-[32px]",title:"Calendar View",children:r.jsx(a4,{className:"h-3 w-3"})}),r.jsx(H,{variant:M==="intelligence"?"default":"ghost",size:"sm",onClick:()=>L("intelligence"),className:"px-2 py-1.5 h-7 min-w-[32px]",title:"AI Intelligence View",children:r.jsx(Br,{className:"h-3 w-3"})})]}),r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>oe(),disabled:p,className:"p-2",title:"Refresh Calendar",children:r.jsx(Be,{className:`h-4 w-4 ${p?"animate-spin":""}`})})]}),r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>{},className:"p-2",disabled:v,children:r.jsx(ys,{className:"h-4 w-4"})})]})]}),r.jsx(GI,{isInitializing:v,isInitialized:y,initError:x,authProvider:n,isAuthenticated:s,userEmail:N,googleConnected:l,outlookConnected:c,googleEmail:j,outlookEmail:_,initializeGapi:Z})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-3",children:he&&!x&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h3",{className:"font-display font-medium text-prelude-900",children:M==="list"?"Upcoming Events":M==="intelligence"?"Meeting Intelligence & Predictions":P==="week"?`Week of ${Dd(R)[0].toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${Dd(R)[6].toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`:R.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),r.jsxs("div",{className:"flex items-center space-x-2",children:[M==="calendar"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[r.jsx(H,{variant:P==="week"?"default":"ghost",size:"sm",onClick:()=>$("week"),className:"px-2 py-1 h-7 text-xs",children:"Week"}),r.jsx(H,{variant:P==="month"?"default":"ghost",size:"sm",onClick:()=>$("month"),className:"px-2 py-1 h-7 text-xs",children:"Month"})]}),r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>P==="week"?V(-1):B(-1),className:"p-1",children:""}),r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>U(new Date),className:"px-2 py-1 text-xs",children:"Today"}),r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>P==="week"?V(1):B(1),className:"p-1",children:""})]})]}),r.jsxs(H,{variant:"ghost",size:"sm",onClick:()=>{const G=prompt('Enter event details (e.g., "Meeting tomorrow at 2pm"):');G&&W(G)},className:"text-xs",children:[r.jsx(Wt,{className:"h-4 w-4 mr-1"}),"Quick Add"]})]})]}),r.jsx(r3,{viewMode:M,events:u,loading:p,setSelectedEvent:z,calendarViewMode:P,currentDate:R,getWeekDates:Dd,getWeekEvents:ZI,getEventsForDate:e3,getDaysInMonth:KI,getFirstDayOfMonth:XI,getMonthEvents:JI,getEventsForDay:QI,analytics:re,dashboardStats:Me})]})}),he&&!x&&r.jsx("div",{className:"p-3 border-t border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsxs(H,{variant:"outline",size:"sm",onClick:()=>{const G=prompt("Enter event details:");G&&W(G)},className:"text-xs font-inter",children:[r.jsx(Wt,{className:"h-3 w-3 mr-1"}),"Add Event"]}),r.jsx(H,{variant:"outline",size:"sm",onClick:()=>{a==="google"?window.open("https://calendar.google.com","_blank"):a==="outlook"&&window.open("https://outlook.live.com/calendar","_blank")},className:"text-xs font-inter",children:"Open Calendar"})]})}),I&&r.jsx(n3,{event:I,onClose:()=>z(null)}),he&&!x&&M!=="intelligence"&&I&&r.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:r.jsx(H,{onClick:()=>O(!F),className:"bg-purple-600 hover:bg-purple-700 text-white rounded-full p-3 shadow-lg",title:"Toggle Meeting Intelligence",children:r.jsx(Br,{className:"w-5 h-5"})})}),F&&I&&M!=="intelligence"&&r.jsx("div",{className:"fixed bottom-20 right-6 z-40 w-80",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-2xl border p-1",children:[r.jsxs("div",{className:"flex items-center justify-between p-2 border-b",children:[r.jsx("span",{className:"text-sm font-medium",children:"Meeting Intelligence"}),r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>O(!1),className:"p-1 h-6 w-6",children:""})]}),r.jsx("div",{className:"p-2",children:r.jsxs("div",{className:"space-y-2",children:[r.jsx("div",{className:"text-center p-2 bg-green-50 rounded",children:r.jsx("p",{className:"text-sm font-bold text-green-600",children:"92% Success"})}),r.jsxs("div",{className:"text-xs text-gray-600",children:[r.jsx("p",{children:" High engagement expected"}),r.jsx("p",{children:" 3-4 action items likely"})]})]})})]})})]})},xs=(e,t,n={})=>{const{expires:s=365,syncAcrossTabs:a=!0}=n,[i,l]=h.useState(()=>{const m=Pl(e);return m!==null?m:t}),o=h.useRef(!0),c=h.useRef(i);h.useEffect(()=>{if(o.current){o.current=!1;return}JSON.stringify(i)!==JSON.stringify(c.current)&&(ti(e,i,{expires:s}),c.current=i)},[i,e,s]),h.useEffect(()=>{if(!a)return;const m=()=>{const y=Pl(e);y!==null&&JSON.stringify(y)!==JSON.stringify(i)&&(l(y),c.current=y)},p=()=>{m()},f=setInterval(m,2e3);return window.addEventListener("focus",p),()=>{window.removeEventListener("focus",p),clearInterval(f)}},[i,e,a]);const d=h.useCallback(m=>{l(p=>typeof m=="function"?m(p):m)},[]),u=h.useCallback(()=>{_C(e),l(t),c.current=t},[e,t]);return[i,d,u]},i3=(e,t)=>{const n=`prelude_column_${e}`;return xs(n,t,{expires:365})},l3=(e,t)=>{const n=`prelude_filter_${e}`;return xs(n,t,{expires:365})},Rk=(e,t={term:"",columns:{}})=>{const n=`prelude_search_${e}`,[s,a,i]=xs(n,t,{expires:30});return{searchTerm:s.term,searchColumns:s.columns,setSearchTerm:l=>a(o=>({...o,term:l})),setSearchColumns:l=>a(o=>({...o,columns:l})),clearSearch:i}},$k=({isOpen:e,onClose:t,onConfirm:n,title:s="Confirm Action",message:a="Are you sure you want to proceed?",confirmText:i="Confirm",cancelText:l="Cancel",type:o="warning",details:c=null,isLoading:d=!1})=>{const m=(()=>{switch(o){case"danger":return{iconColor:"text-red-600",icon:r.jsx(fr,{className:"w-6 h-6"}),confirmButtonClass:"bg-red-600 hover:bg-red-700 text-white",headerColor:"bg-red-50 border-red-200"};case"info":return{iconColor:"text-blue-600",icon:r.jsx($n,{className:"w-6 h-6"}),confirmButtonClass:"bg-blue-600 hover:bg-blue-700 text-white",headerColor:"bg-blue-50 border-blue-200"};default:return{iconColor:"text-amber-600",icon:r.jsx(Cr,{className:"w-6 h-6"}),confirmButtonClass:"bg-amber-600 hover:bg-amber-700 text-white",headerColor:"bg-amber-50 border-amber-200"}}})();if(!e)return null;const p=r.jsx(ht,{children:r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4",children:r.jsxs(de.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-lg shadow-xl max-w-md w-full overflow-hidden",children:[r.jsx("div",{className:`px-6 py-4 border-b ${m.headerColor}`,children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:m.iconColor,children:m.icon}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s})]})}),r.jsxs("div",{className:"px-6 py-4",children:[r.jsx("p",{className:"text-gray-700 mb-4 leading-relaxed",children:a}),c&&r.jsx("div",{className:"bg-gray-50 rounded-md p-3 mb-4 border",children:r.jsx("p",{className:"text-sm text-gray-600",children:c})})]}),r.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t flex gap-3 justify-end",children:[r.jsx(H,{variant:"outline",onClick:t,disabled:d,children:l}),r.jsx(H,{className:m.confirmButtonClass,onClick:n,disabled:d,children:d?r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Processing..."]}):i})]})]})})});return eo.createPortal(p,document.body)},o3=({lead:e,onClose:t,onEmailSent:n,embedded:s=!1})=>{const[a,i]=h.useState(""),[l,o]=h.useState(null),[c,d]=h.useState(!1),[u,m]=h.useState(!1),[p,f]=h.useState(""),[y,g]=h.useState(""),[x,b]=h.useState(""),[v,w]=h.useState(""),[N,k]=h.useState(""),[j,S]=h.useState([]),[_,C]=h.useState(null),[D,A]=h.useState("");h.useEffect(()=>{S([{id:"cold_outreach",name:"Cold Outreach",description:"First-time introduction to potential customer"},{id:"introduction",name:"Company Introduction",description:"Introduce your company and services"}])},[]);const E=$=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test($),T=async()=>{var $,R,U,I;try{d(!0),f("");let z="";const F=j.find(se=>se.id===_);F&&(z=F.description),D.trim()&&(z+=(z?". ":"")+D.trim());const O=e.lead_id;if(!O)throw new Error("No valid lead ID found. Cannot generate email without lead ID.");const K=await ar.generateEmail(O,z||a),J={subject:K.subject||(($=K.email_data)==null?void 0:$.subject)||((R=K.email)==null?void 0:R.subject),body:K.body||((U=K.email_data)==null?void 0:U.body)||((I=K.email)==null?void 0:I.body)};o(J),b(e.email),w(J.subject),k(J.body)}catch(z){console.error("Error generating email:",z),f(z.message||"Error connecting to server")}finally{d(!1)}},M=async()=>{if(l){if(!E(x)){f("Please enter a valid email address");return}if(!v.trim()){f("Please enter a subject line");return}if(!N.trim()){f("Please enter an email message");return}try{m(!0),f("");const $=e.lead_id;if(!$)throw new Error("No valid lead ID found. Cannot send email without lead ID.");const R=await ar.sendEmail(x,v,N,$);g(`Email sent successfully to ${R.sent_to}`),n&&n(R),setTimeout(()=>{t()},3e3)}catch($){console.error("Error sending email:",$),f($.message||"Error sending email")}finally{m(!1)}}},L=()=>{const $=`Subject: ${v}

${N}`;navigator.clipboard.writeText($),g("Copied to clipboard!"),setTimeout(()=>g(""),3e3)},P=r.jsxs("div",{className:s?"h-full flex flex-col":"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[!s&&r.jsx("div",{className:"flex items-center justify-end p-6 border-b",children:r.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:r.jsx(Ze,{className:"w-6 h-6"})})}),r.jsxs("div",{className:`flex flex-col lg:flex-row ${s?"flex-1 h-full":"max-h-[calc(90vh-80px)]"}`,children:[r.jsx("div",{className:`lg:w-1/3 p-6 border-r border-gray-200 ${s?"overflow-y-auto":""}`,children:r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Email Purpose (Optional)"}),r.jsxs("div",{className:"space-y-2",children:[j.map($=>r.jsxs("button",{onClick:()=>C($.id),className:`w-full text-left p-3 rounded-lg border transition-colors ${_===$.id?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"}`,children:[r.jsx("div",{className:"font-medium",children:$.name}),r.jsx("div",{className:"text-xs text-gray-500 mt-1",children:$.description})]},$.id)),r.jsx("button",{onClick:()=>C(null),className:`w-full text-left p-4 rounded-lg border-2 transition-all ${_===null?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:r.jsx(nl,{className:"w-5 h-5 text-blue-600"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium mb-1",children:"Custom Only"}),r.jsx("div",{className:"text-xs text-gray-500",children:"Generate based purely on your context"})]})]})})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Context"}),r.jsx("textarea",{value:D,onChange:$=>A($.target.value),placeholder:"Add any custom message or specific details...",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:4})]}),r.jsx(H,{onClick:T,disabled:c||!e.email||_===null&&!D.trim(),className:"w-full bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600",children:c?r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"w-4 h-4 mr-2 animate-spin"}),"Generating..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Mr,{className:"w-4 h-4 mr-2"}),"Generate Email"]})}),!e.email&&r.jsx("p",{className:"text-sm text-red-600 mt-2",children:"No email address found for this lead"})]})}),r.jsxs("div",{className:`lg:w-2/3 flex flex-col ${s?"flex-1":""}`,children:[r.jsxs("div",{className:`p-6 flex-1 ${s?"overflow-y-auto h-full":"overflow-y-auto"}`,children:[p&&r.jsxs(rb,{variant:"destructive",className:"mb-4",children:[r.jsx(dt,{className:"w-4 h-4"}),p]}),y&&r.jsxs(rb,{className:"mb-4 border-green-200 bg-green-50",children:[r.jsx(bt,{className:"w-4 h-4 text-green-600"}),r.jsx("span",{className:"text-green-800",children:y})]}),l?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Email Draft"}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs(H,{variant:"outline",size:"sm",onClick:L,children:[r.jsx(yc,{className:"w-4 h-4 mr-1"}),"Copy"]})})]}),r.jsxs(We,{children:[r.jsx(ir,{className:"pb-3",children:r.jsx("div",{className:"space-y-2",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(_t,{className:"w-4 h-4 text-gray-600"}),r.jsx("input",{type:"email",value:x,onChange:$=>b($.target.value),placeholder:"recipient@example.com",className:"flex-1 p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]})})}),r.jsx(it,{children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject"}),r.jsx("input",{type:"text",value:v,onChange:$=>w($.target.value),placeholder:"Email subject...",className:"w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Body"}),r.jsx("textarea",{value:N,onChange:$=>k($.target.value),placeholder:"Email content...",className:"w-full p-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:12})]})]})})]})]}):r.jsxs("div",{className:"text-center py-12",children:[r.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(Dt,{className:"w-8 h-8 text-gray-400"})}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Generate Your Email"}),r.jsx("p",{className:"text-gray-600",children:'Select an email type and click "Generate Email" to create a personalized message.'})]})]}),l&&e.email&&r.jsx("div",{className:`p-6 border-t bg-gray-50 ${s?"flex-shrink-0":""}`,children:r.jsxs("div",{className:"flex items-center justify-end gap-3",children:[r.jsx(H,{variant:"outline",onClick:t,children:"Cancel"}),r.jsx(H,{onClick:M,disabled:u,className:"bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600",children:u?r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):r.jsxs(r.Fragment,{children:[r.jsx(to,{className:"w-4 h-4 mr-2"}),"Send Email"]})})]})})]})]})]});return s?P:r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsx(de.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},children:P})})},Gc=10,c3=({selectedLead:e,onAddToCRM:t,onCheckReplies:n,isCheckingReplies:s})=>{const[a,i]=h.useState([]),[l,o]=h.useState(null),[c,d]=h.useState(!0),[u,m]=h.useState(null),[p,f]=h.useState("all"),[y,g]=h.useState(""),[x,b]=h.useState(!1);h.useEffect(()=>{if(!(e!=null&&e.lead_id)&&!(e!=null&&e.id))return;(async()=>{d(!0),m(null);try{const D=e.lead_id||e.id,[A,E]=await Promise.all([ar.getLeadEmailStats(D),ar.getLeadEmailTimeline(D,{limit:50,days_back:30,direction:"all"})]);o(A),i(E.timeline||[])}catch(D){console.error("Error loading email timeline:",D),m(D.message||"Failed to load email timeline")}finally{d(!1)}})()},[e]);const w=(()=>{let C=a;if(p!=="all"&&(C=C.filter(D=>D.direction===p)),y.trim()){const D=y.toLowerCase();C=C.filter(A=>{var E,T,M,L;return((E=A.subject)==null?void 0:E.toLowerCase().includes(D))||((T=A.body)==null?void 0:T.toLowerCase().includes(D))||((M=A.from_email)==null?void 0:M.toLowerCase().includes(D))||((L=A.to_email)==null?void 0:L.toLowerCase().includes(D))})}return C})(),N=x?w:w.slice(0,Gc),k=w.length>Gc,j=C=>C?new Date(C).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):"Unknown date",S=(C,D)=>{if(!C||C==="neutral")return null;const A={positive:"bg-green-100 text-green-800 border-green-200",negative:"bg-red-100 text-red-800 border-red-200"};return r.jsxs("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium border ${A[C]}`,title:`Confidence: ${D?(D*100).toFixed(0)+"%":"N/A"}`,children:[C==="positive"?"":""," ",C]})},_=C=>C==="sent"?{icon:Dt,bgColor:"bg-blue-100",textColor:"text-blue-600",borderColor:"border-blue-200",label:"Sent"}:{icon:ob,bgColor:"bg-green-100",textColor:"text-green-600",borderColor:"border-green-200",label:"Received"};return c?r.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6 h-[500px] flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Ct,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-3"}),r.jsx("p",{className:"text-gray-600",children:"Loading email timeline..."})]})}):u?r.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6 h-[500px] flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx(dt,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),r.jsx("p",{className:"text-red-700 font-medium",children:"Failed to load email timeline"}),r.jsx("p",{className:"text-sm text-red-600 mt-1",children:u})]})}):r.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 h-[500px] flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6 flex-shrink-0",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("h3",{className:"text-lg font-bold text-black font-[Inter] flex items-center gap-2",children:[r.jsx(Ot,{className:"w-5 h-5 text-pink-600"}),"Email Timeline"]}),l&&r.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[r.jsxs("span",{className:"bg-gray-100 px-2 py-1 rounded-full",children:[l.total_emails," total"]}),r.jsxs("span",{className:"bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:[l.total_sent," sent"]}),r.jsxs("span",{className:"bg-green-100 text-green-700 px-2 py-1 rounded-full",children:[l.total_received," received"]})]}),k&&!x&&r.jsxs("span",{className:"text-orange-600 bg-orange-50 px-2 py-1 rounded-full text-xs",children:[w.length-Gc," more"]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[t&&r.jsxs(H,{variant:"outline",size:"sm",className:"border-gray-300 text-gray-600 hover:bg-gray-50 gap-x-2",onClick:t,children:[r.jsx(qt,{className:"w-4 h-4"}),"Add to CRM"]}),n&&r.jsxs(H,{variant:"outline",size:"sm",className:"border-orange-300 text-orange-600 hover:bg-orange-50 gap-x-2",onClick:n,disabled:s,children:[s?r.jsx(Ct,{className:"w-4 h-4 animate-spin"}):r.jsx(Be,{className:"w-4 h-4"}),"Sync Replies"]})]})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6 flex-shrink-0",children:[r.jsx("div",{className:"flex gap-2",children:[{key:"all",label:"All",icon:da},{key:"sent",label:"Sent",icon:Dt},{key:"received",label:"Received",icon:ob}].map(({key:C,label:D,icon:A})=>r.jsxs("button",{onClick:()=>f(C),className:`px-3 py-1.5 text-xs font-medium rounded-full flex items-center gap-1.5 transition-colors ${p===C?"bg-pink-100 text-pink-700 border border-pink-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[r.jsx(A,{className:"w-3 h-3"}),D]},C))}),r.jsxs("div",{className:"relative flex-1 max-w-xs",children:[r.jsx(zn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search emails...",value:y,onChange:C=>g(C.target.value),className:"w-full pl-10 pr-4 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent"})]})]}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:r.jsxs("div",{className:"space-y-4 p-6",children:[N.length>0?r.jsx(ht,{mode:"wait",children:N.map((C,D)=>{const A=_(C.direction),E=A.icon;return new Date(C.email_timestamp),r.jsx(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3,delay:D*.05},className:`border rounded-lg p-4 hover:shadow-md hover:bg-gray-50 transition-all ${A.borderColor}`,children:r.jsxs("div",{className:"flex gap-4",children:[r.jsx("div",{className:"flex-none",children:r.jsx("div",{className:`w-10 h-10 rounded-full ${A.bgColor} flex items-center justify-center`,children:r.jsx(E,{className:`w-5 h-5 ${A.textColor}`})})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"flex items-start justify-between mb-2",children:r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("span",{className:`text-xs font-medium ${A.textColor}`,children:A.label}),r.jsx("span",{className:"text-xs text-gray-500",children:j(C.email_timestamp)}),C.direction==="received"&&S(C.sentiment,C.confidence)]}),r.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:C.subject||"(No Subject)"})]})}),r.jsxs("div",{className:"text-xs text-gray-600 mb-2 space-y-1",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"From:"})," ",C.from_email]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"To:"})," ",C.to_email]}),C.employee_name&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Employee:"})," ",C.employee_name]})]}),r.jsx("div",{className:"text-sm text-gray-700 bg-gray-50 rounded p-2 border border-gray-100",children:r.jsx("p",{className:"line-clamp-3",children:C.body_preview||C.body||"No content"})})]})]})},`email-${C.email_id}-${D}`)})}):r.jsx("div",{className:"flex items-center justify-center h-full py-12",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Dt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h4",{className:"text-lg font-medium text-gray-600 mb-2",children:"No emails found"}),r.jsx("p",{className:"text-sm text-gray-500",children:y?"Try adjusting your search":"No email history for this lead yet"})]})}),k&&r.jsx(de.div,{className:"mt-6 pt-4 border-t border-gray-100 px-6",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:r.jsxs("div",{className:"flex flex-col items-center gap-2",children:[r.jsxs("div",{className:"text-xs text-gray-500",children:["Showing ",x?w.length:Gc," of ",w.length," emails"]}),r.jsx(H,{variant:"ghost",onClick:()=>b(!x),className:"text-gray-600 hover:text-gray-800 hover:bg-gray-50 flex items-center gap-2 transition-all duration-200",children:x?r.jsxs(r.Fragment,{children:[r.jsx(La,{className:"w-4 h-4"}),"Show Less"]}):r.jsxs(r.Fragment,{children:[r.jsx(Xt,{className:"w-4 h-4"}),"Show More"]})})]})})]})})]})},d3=({isOpen:e,onClose:t,selectedLead:n,modalActiveTab:s,setModalActiveTab:a,aiSuggestions:i,isLoadingAiSuggestions:l,aiSuggestionsError:o,loadCachedAiSuggestions:c,regenerateAiSuggestions:d,handleAddToCRM:u,handleEmailSent:m})=>{const[p,f]=h.useState(!1);h.useEffect(()=>{e&&(n!=null&&n.id)&&c&&c(n.id)},[e,n==null?void 0:n.id,c]);const y=async()=>{if(!(n!=null&&n.lead_id)&&!(n!=null&&n.id))return;const g=n.lead_id||n.id;f(!0);try{const x=await ar.checkReplies(g,7);if(x.status_changed&&x.new_status&&m){const b={status_changed:!0,new_status:x.new_status,sent_to:n.email,positive_replies_count:x.positive_replies_count};await m(b)}}catch(x){console.error("Error checking replies:",x)}finally{f(!1)}};return!e||!n?null:r.jsx(ht,{children:r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex justify-center pt-8 px-8",onClick:t,children:r.jsxs(de.div,{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},className:"w-full bg-white rounded-lg shadow-2xl relative h-full flex flex-col",onClick:g=>g.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between pt-5 pb-3 px-6 border-b border-gray-200 flex-shrink-0",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:r.jsx(qt,{className:"w-5 h-5 text-white"})}),r.jsx("h1",{className:"text-2xl font-bold text-gray-900 leading-none self-center -mb-1",children:n.company})]}),r.jsx(H,{variant:"ghost",size:"icon",onClick:t,children:r.jsx(Ze,{className:"w-5 h-5 text-gray-500"})})]}),r.jsx("div",{className:"border-b border-gray-200 flex-shrink-0 px-6",children:r.jsxs("div",{className:"flex",children:[r.jsxs(H,{variant:"ghost",onClick:()=>a("information"),className:`flex items-center gap-2 p-4 text-sm font-medium border-b-2 rounded-none ${s==="information"?"border-blue-600 text-blue-600 hover:text-blue-700":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(_t,{className:"w-4 h-4"}),"Overview"]}),r.jsxs(H,{variant:"ghost",onClick:()=>a("email"),className:`flex items-center gap-2 p-4 text-sm font-medium border-b-2 rounded-none ${s==="email"?"border-blue-600 text-blue-600 hover:text-blue-700":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(Dt,{className:"w-4 h-4"}),"Send Email"]})]})}),r.jsxs("div",{className:"flex-1 overflow-y-auto py-4 px-5 bg-gray-50",children:[s==="information"&&r.jsx(r.Fragment,{children:r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-4",children:[r.jsxs("div",{className:"lg:col-span-7 lg:order-1 space-y-4",children:[r.jsx(c3,{selectedLead:n,onAddToCRM:()=>u(n),onCheckReplies:y,isCheckingReplies:p}),r.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 flex flex-col",style:{height:"calc(1000px + 1rem - 500px - 1rem)"},children:[r.jsxs("div",{className:"flex items-center justify-between px-6 pt-6 pb-4 flex-shrink-0",children:[r.jsxs("h3",{className:"text-lg font-bold text-black font-[Inter] flex items-center gap-2",children:[r.jsx(Br,{className:"w-5 h-5 text-blue-600"}),"Company Intelligence & Analysis by AI"]}),r.jsx(H,{variant:"outline",className:"border-gray-300 text-gray-600 hover:bg-gray-50 gap-x-2",onClick:()=>d(n==null?void 0:n.id),disabled:l,children:l?r.jsxs(r.Fragment,{children:[r.jsx(Ct,{className:"w-4 h-4 animate-spin"}),"Regenerating..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Br,{className:"w-4 h-4"}),"Generate Report"]})})]}),r.jsxs("div",{className:"flex-1 bg-gray-50 border-t border-gray-200 overflow-y-auto",children:[l&&r.jsx("div",{className:"flex items-center justify-center h-full",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Ct,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-3"}),r.jsx("p",{className:"text-gray-600",children:"AI is analyzing this lead..."}),r.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"This may take a few moments"})]})}),o&&r.jsx("div",{className:"flex items-center justify-center h-full",children:r.jsxs("div",{className:"text-center",children:[r.jsx(dt,{className:"w-8 h-8 text-red-500 mx-auto mb-3"}),r.jsx("p",{className:"text-red-700 font-medium",children:"Failed to generate AI suggestions"}),r.jsx("p",{className:"text-sm text-red-600 mt-1",children:o})]})}),!l&&!o&&!i&&r.jsx("div",{className:"flex items-center justify-center h-full",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Ot,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h4",{className:"text-lg font-medium text-gray-600 mb-2",children:"No Analysis Available"}),r.jsx("p",{className:"text-sm text-gray-500",children:'Click "Regenerate Report" to generate company intelligence'})]})}),i&&!l&&r.jsxs("div",{className:"bg-white p-8",children:[i.insights&&i.insights.length>0&&r.jsx("div",{className:"space-y-4 mb-6",children:i.insights.map((g,x)=>r.jsxs("div",{className:"flex gap-3",children:[r.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-blue-700 text-xs font-semibold mt-0.5",children:x+1}),r.jsx("p",{className:"text-sm text-gray-700 leading-relaxed flex-1",children:g})]},x))}),r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 pt-4 border-t border-gray-200",children:[r.jsx(bt,{className:"w-4 h-4 text-green-600"}),"Generated on ",new Date(i.generated_at).toLocaleString(),r.jsx("span",{className:"ml-2 px-2 py-1 bg-blue-600 text-white rounded-full text-xs font-medium",children:"Prelude AI"})]})]})]})]})]}),r.jsx("div",{className:"lg:col-span-3 lg:order-2",children:r.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 flex flex-col",style:{height:"calc(1000px + 1rem)"},children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center gap-2 flex-shrink-0",children:[r.jsx(qt,{className:"w-4 h-4 text-blue-600"}),"Lead Information"]}),r.jsxs("div",{className:"space-y-4 flex-1 overflow-y-auto",children:[r.jsx("div",{children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Company"}),r.jsx("p",{className:"text-gray-900",children:n.company})]}),n.contact_name&&r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Contact Name"}),r.jsx("p",{className:"text-gray-900",children:n.contact_name})]}),n.industry&&r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Industry"}),r.jsx("p",{className:"text-gray-900",children:n.industry})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Source"}),r.jsx("p",{className:"text-gray-900",children:n.source||"Web Scraping"})]}),n.email&&r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Email"}),r.jsx("p",{className:"text-gray-900",children:n.email})]}),n.phone&&r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Phone"}),r.jsx("p",{className:"text-gray-900",children:n.phone})]}),(n.address||n.location)&&r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Location"}),r.jsx("p",{className:"text-gray-900",children:n.address||n.location})]}),n.website&&r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Website"}),r.jsx("a",{href:(()=>{let g=n.website;return g.startsWith("https//")?g=g.replace("https//","https://"):g.startsWith("http//")?g=g.replace("http//","http://"):g.startsWith("http")||(g=`https://${g}`),g})(),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 hover:underline",children:n.website})]})]})}),n.personnel&&n.personnel.length>0&&r.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[r.jsxs("h4",{className:"text-md font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(kt,{className:"w-4 h-4 text-blue-600"}),"Personnel (",n.personnel.length,")"]}),r.jsx("div",{className:"space-y-4",children:n.personnel.slice(0,10).map((g,x)=>r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:g.full_name||g.name||"Unknown"}),r.jsx("p",{className:"text-gray-900",children:g.position||"N/A"}),g.email&&r.jsx("p",{className:"text-gray-900 text-sm",children:g.email}),g.phone&&r.jsx("p",{className:"text-gray-600 text-sm",children:g.phone}),g.linkedin_url&&r.jsx("a",{href:g.linkedin_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 hover:underline text-sm",children:"LinkedIn Profile"})]},x))})]})]})]})})]})}),s==="email"&&r.jsx("div",{className:"p-6 h-full",children:n&&r.jsx(o3,{lead:n,onClose:()=>a("information"),onEmailSent:g=>{m(g),a("information")},embedded:!0})})]})]})})})},u3=({isOpen:e,onClose:t})=>{const[n,s]=h.useState({company:"",name:"",contact_name:"",position:"",location:"",industry:"",company_size:"",revenue:"",employees_count:"",email:"",phone:"",website:"",linkedin_url:"",status:"new_lead",source:"manual_entry",tags:[],notes:"",assigned_to:""}),[a,i]=h.useState({}),[l,o]=h.useState(!1),[c,d]=h.useState(""),{loadLeads:u}=gc(),m=["Technology","Healthcare","Finance","Retail","Manufacturing","Education","Real Estate","Hospitality","Transportation","Energy","Agriculture","Media","Legal","Consulting","Other"],p=[{value:"1-10",label:"1-10 employees"},{value:"11-50",label:"11-50 employees"},{value:"51-200",label:"51-200 employees"},{value:"201-500",label:"201-500 employees"},{value:"500+",label:"500+ employees"}],f=[{value:"<1M",label:"Less than $1M"},{value:"1-10M",label:"$1M - $10M"},{value:"10-50M",label:"$10M - $50M"},{value:"50-100M",label:"$50M - $100M"},{value:"100M+",label:"$100M+"}],y=[{value:"new",label:"New Lead",color:"bg-blue-100 text-blue-800"},{value:"cold",label:"Cold",color:"bg-gray-100 text-gray-800"},{value:"warm",label:"Warm",color:"bg-yellow-100 text-yellow-800"},{value:"hot",label:"Hot Lead",color:"bg-orange-100 text-orange-800"},{value:"qualified",label:"Qualified",color:"bg-green-100 text-green-800"},{value:"contacted",label:"Contacted",color:"bg-purple-100 text-purple-800"},{value:"converted",label:"Converted",color:"bg-emerald-100 text-emerald-800"},{value:"lost",label:"Lost",color:"bg-red-100 text-red-800"}],g=[{value:"manual_entry",label:"Manual Entry"},{value:"csv_upload",label:"CSV Upload"},{value:"web_scraping",label:"Web Scraping"},{value:"api_import",label:"API Import"},{value:"linkedin",label:"LinkedIn"},{value:"yellowpages",label:"Yellow Pages"}];h.useEffect(()=>{if(!e){const j=setTimeout(()=>{s({company:"",name:"",contact_name:"",position:"",location:"",industry:"",company_size:"",revenue:"",employees_count:"",email:"",phone:"",website:"",linkedin_url:"",status:"new_lead",source:"manual_entry",tags:[],notes:"",assigned_to:""}),i({}),d("")},300);return()=>clearTimeout(j)}},[e]);const x=j=>{const{name:S,value:_}=j.target;s(C=>({...C,[S]:_})),a[S]&&i(C=>({...C,[S]:""}))},b=()=>{c.trim()&&!n.tags.includes(c.trim())&&(s(j=>({...j,tags:[...j.tags,c.trim()]})),d(""))},v=j=>{s(S=>({...S,tags:S.tags.filter(_=>_!==j)}))},w=j=>{j.key==="Enter"&&(j.preventDefault(),b())},N=()=>{const j={};return n.company.trim()?n.company.trim().length<2&&(j.company="Company name must be at least 2 characters"):j.company="Company name is required",n.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.email)&&(j.email="Please enter a valid email address"),n.phone&&!/^[\d\s\-\+\(\)]+$/.test(n.phone)&&(j.phone="Please enter a valid phone number"),n.website&&!n.website.match(/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/)&&(j.website="Please enter a valid website URL"),n.linkedin_url&&!n.linkedin_url.includes("linkedin.com")&&(j.linkedin_url="Please enter a valid LinkedIn URL"),n.employees_count&&n.employees_count<0&&(j.employees_count="Employee count must be a positive number"),i(j),Object.keys(j).length===0},k=async j=>{if(j.preventDefault(),!N()){mt.error("Please fix the errors in the form");return}o(!0);try{const S={company:n.company.trim(),name:n.name.trim()||null,contact_name:n.contact_name.trim()||n.name.trim()||null,position:n.position.trim()||null,location:n.location.trim()||null,industry:n.industry||null,company_size:n.company_size||null,revenue:n.revenue||null,employees_count:n.employees_count?parseInt(n.employees_count):null,email:n.email.trim()||null,phone:n.phone.trim()||null,website:n.website.trim()||null,linkedin_url:n.linkedin_url.trim()||null,status:n.status||"new_lead",source:n.source||"manual_entry",tags:n.tags,notes:n.notes.trim()||null,assigned_to:n.assigned_to.trim()||null},_=await ar.createLead(S);await u(!0),mt.success(`Lead "${n.company}" added successfully!`),t()}catch(S){console.error("Error creating lead:",S),mt.error(S.message||"Failed to create lead. Please try again.")}finally{o(!1)}};return h.useEffect(()=>{const j=S=>{S.key==="Escape"&&e&&!l&&t()};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[e,l,t]),r.jsx(ht,{children:e&&r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:t,children:r.jsxs(de.div,{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},className:"bg-white rounded-2xl shadow-xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col",onClick:j=>j.stopPropagation(),children:[r.jsx("div",{className:"px-6 py-4 border-b bg-gradient-to-r from-blue-50 to-purple-50",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[r.jsx(qt,{className:"w-6 h-6 text-blue-600"}),"Add New Lead"]}),r.jsx(H,{variant:"ghost",size:"sm",onClick:t,disabled:l,className:"text-gray-400 hover:text-gray-600",children:r.jsx(Ze,{className:"w-5 h-5"})})]})}),r.jsxs("form",{onSubmit:k,className:"flex-1 overflow-y-auto p-6",children:[r.jsxs("div",{className:"mb-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(dt,{className:"w-5 h-5 text-red-500"}),"Required Information"]}),r.jsx("div",{className:"grid grid-cols-1 gap-4",children:r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Company Name ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx(qt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",name:"company",value:n.company,onChange:x,className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${a.company?"border-red-500":"border-gray-300"}`,placeholder:"Enter company name"})]}),a.company&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.company})]})})]}),r.jsxs("div",{className:"mb-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(_t,{className:"w-5 h-5 text-blue-600"}),"Contact Information"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Name"}),r.jsxs("div",{className:"relative",children:[r.jsx(_t,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",name:"name",value:n.name,onChange:x,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"John Doe"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Position/Title"}),r.jsxs("div",{className:"relative",children:[r.jsx(Ko,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",name:"position",value:n.position,onChange:x,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"CEO, Manager, etc."})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),r.jsxs("div",{className:"relative",children:[r.jsx(Dt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"email",name:"email",value:n.email,onChange:x,className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${a.email?"border-red-500":"border-gray-300"}`,placeholder:"contact@company.com"})]}),a.email&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.email})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),r.jsxs("div",{className:"relative",children:[r.jsx(sn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"tel",name:"phone",value:n.phone,onChange:x,className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${a.phone?"border-red-500":"border-gray-300"}`,placeholder:"+1 (555) 123-4567"})]}),a.phone&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.phone})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Website"}),r.jsxs("div",{className:"relative",children:[r.jsx(ni,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"url",name:"website",value:n.website,onChange:x,className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${a.website?"border-red-500":"border-gray-300"}`,placeholder:"https://example.com"})]}),a.website&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.website})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"LinkedIn URL"}),r.jsxs("div",{className:"relative",children:[r.jsx(ni,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"url",name:"linkedin_url",value:n.linkedin_url,onChange:x,className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${a.linkedin_url?"border-red-500":"border-gray-300"}`,placeholder:"https://linkedin.com/company/..."})]}),a.linkedin_url&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.linkedin_url})]})]})]}),r.jsxs("div",{className:"mb-6 clear-both",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(qt,{className:"w-5 h-5 text-purple-600"}),"Company Details"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 auto-rows-auto",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Location/Address"}),r.jsxs("div",{className:"relative",children:[r.jsx(vn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",name:"location",value:n.location,onChange:x,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"City, State, Country"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Industry"}),r.jsxs("select",{name:"industry",value:n.industry,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"Select Industry"}),m.map(j=>r.jsx("option",{value:j,children:j},j))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Size"}),r.jsxs("select",{name:"company_size",value:n.company_size,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"Select Size"}),p.map(j=>r.jsx("option",{value:j.value,children:j.label},j.value))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Revenue Range"}),r.jsxs("select",{name:"revenue",value:n.revenue,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"Select Revenue"}),f.map(j=>r.jsx("option",{value:j.value,children:j.label},j.value))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee Count"}),r.jsx("input",{type:"number",name:"employees_count",value:n.employees_count,onChange:x,min:"0",className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${a.employees_count?"border-red-500":"border-gray-300"}`,placeholder:"Number of employees"}),a.employees_count&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.employees_count})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assigned To"}),r.jsx("input",{type:"text",name:"assigned_to",value:n.assigned_to,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Assign to team member"})]})]})]}),r.jsxs("div",{className:"mb-6 clear-both",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(l4,{className:"w-5 h-5 text-green-600"}),"Lead Management"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 auto-rows-auto",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Lead Status"}),r.jsx("select",{name:"status",value:n.status,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:y.map(j=>r.jsx("option",{value:j.value,children:j.label},j.value))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Lead Source"}),r.jsx("select",{name:"source",value:n.source,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:g.map(j=>r.jsx("option",{value:j.value,children:j.label},j.value))})]})]}),r.jsxs("div",{className:"mt-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tags"}),r.jsxs("div",{className:"flex gap-2 mb-2",children:[r.jsx("input",{type:"text",value:c,onChange:j=>d(j.target.value),onKeyPress:w,className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Add tags (press Enter)"}),r.jsx(H,{type:"button",onClick:b,variant:"outline",size:"sm",children:r.jsx(FC,{className:"w-4 h-4"})})]}),n.tags.length>0&&r.jsx("div",{className:"flex flex-wrap gap-2",children:n.tags.map((j,S)=>r.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800",children:[j,r.jsx("button",{type:"button",onClick:()=>v(j),className:"ml-2 hover:text-blue-600",children:r.jsx(Ze,{className:"w-3 h-3"})})]},S))})]}),r.jsxs("div",{className:"mt-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),r.jsx("textarea",{name:"notes",value:n.notes,onChange:x,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Additional notes about this lead..."})]})]})]}),r.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t flex justify-end gap-3",children:[r.jsx(H,{variant:"outline",onClick:t,disabled:l,children:"Cancel"}),r.jsx(H,{onClick:k,disabled:l,className:"bg-blue-600 hover:bg-blue-700",children:l?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Creating..."]}):"Add Lead"})]})]})})})},m3=({analysisResult:e,onMappingComplete:t,onBack:n})=>{const[s,a]=h.useState({}),i={company:"Company name (Required)",contact_name:"Primary contact person name",email:"Contact email address",phone:"Phone number",website:"Company website URL",industry:"Industry sector",location:"Geographic location",company_size:"Company size category",revenue:"Revenue range",employees_count:"Number of employees",rating:"Company rating (0-5)",status:"Lead status",source:"Lead source",score:"Lead score (0-100)",notes:"Additional notes",assigned_to:"Assigned team member",position:"Contact person position",linkedin_url:"LinkedIn company URL",tags:"Tags (comma-separated)"},l=["company"];h.useEffect(()=>{a(e.suggested_mappings||{})},[e]);const o=(p,f)=>{a(y=>({...y,[p]:f==="none"?void 0:f}))},c=()=>Object.values(s).filter(Boolean),d=()=>{const p=c();return l.filter(f=>!p.includes(f))},u=()=>{const p=c();return l.every(y=>p.includes(y))},m=()=>{u()&&t(s)};return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Map Your Columns"}),r.jsx("p",{className:"text-gray-600",children:"Match your CSV columns to the appropriate lead fields. Only company name is required."})]}),r.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:r.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"font-medium text-gray-900",children:e.source_columns.length}),r.jsx("div",{className:"text-gray-600",children:"Source Columns"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"font-medium text-gray-900",children:Object.keys(s).length}),r.jsx("div",{className:"text-gray-600",children:"Mapped Columns"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"font-medium text-gray-900",children:e.crm_fields.length}),r.jsx("div",{className:"text-gray-600",children:"Available Fields"})]})]})}),!u()&&r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(dt,{className:"h-5 w-5 text-red-500 mt-0.5 mr-3"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-red-800",children:"Required Fields Missing"}),r.jsxs("p",{className:"text-red-700 text-sm mt-1",children:["Please map the following required fields: ",d().join(", ")]})]})]})}),u()&&r.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(bt,{className:"h-5 w-5 text-green-500 mt-0.5 mr-3"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-green-800",children:"Ready to Import"}),r.jsx("p",{className:"text-green-700 text-sm mt-1",children:"All required fields are mapped. You can proceed to preview your data."})]})]})}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Your CSV Columns"}),r.jsx("div",{className:"space-y-3",children:e.source_columns.map((p,f)=>{const y=s[p];return r.jsxs("div",{className:"flex items-center p-3 bg-gray-50 rounded-lg",children:[r.jsx("div",{className:"flex-1",children:r.jsx("div",{className:"font-medium text-gray-900",children:p})}),r.jsx(Dn,{className:"h-4 w-4 text-gray-400 mx-3"}),r.jsx("div",{className:"flex-1",children:r.jsxs("select",{value:y||"none",onChange:g=>o(p,g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"none",children:"Don't import"}),e.crm_fields.map(g=>r.jsxs("option",{value:g,children:[g," ",l.includes(g)?"(Required)":""]},g))]})})]},f)})})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"Lead Fields"}),r.jsx("div",{className:"space-y-2",children:e.crm_fields.map((p,f)=>{const y=l.includes(p),g=c().includes(p);return r.jsxs("div",{className:`p-3 rounded-lg border ${y?g?"bg-green-50 border-green-200":"bg-red-50 border-red-200":g?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200"}`,children:[r.jsxs("div",{className:"font-medium text-gray-900",children:[p," ",y&&r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("div",{className:"text-sm text-gray-600",children:i[p]||"Additional field"}),g&&r.jsx("div",{className:"text-xs text-green-600 mt-1",children:" Mapped"})]},f)})})]})]}),Object.keys(e.suggested_mappings||{}).length>0&&r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(bt,{className:"h-5 w-5 text-blue-500 mt-0.5 mr-3"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-blue-800",children:"Smart Mapping Applied"}),r.jsxs("p",{className:"text-blue-700 text-sm mt-1",children:["We've automatically suggested ",Object.keys(e.suggested_mappings).length," column mappings based on your field names."]})]})]})}),r.jsxs("div",{className:"flex justify-between pt-6",children:[r.jsxs(H,{variant:"outline",onClick:n,className:"flex items-center gap-2",children:[r.jsx(Wi,{className:"h-4 w-4"}),"Back"]}),r.jsxs(H,{onClick:m,disabled:!u(),className:"flex items-center gap-2",children:["Continue to Preview",r.jsx(Dn,{className:"h-4 w-4"})]})]})]})},h3=({file:e,columnMapping:t,onPreviewComplete:n,onBack:s})=>{const[a,i]=h.useState(null),[l,o]=h.useState(!1),[c,d]=h.useState(null);h.useEffect(()=>{u()},[]);const u=async()=>{o(!0),d(null);try{const g=(await e.text()).split(`
`).map(S=>S.trim()).filter(S=>S);if(g.length===0)throw new Error("File is empty");const x=g[0],b=[];let v="",w=!1;for(let S=0;S<x.length;S++){const _=x[S];_==='"'?w=!w:_===","&&!w?(b.push(v.trim()),v=""):v+=_}b.push(v.trim());const N=b.map(S=>S.replace(/^"(.*)"$/,"$1")),k=g.slice(1),j=k.slice(0,10).map(S=>{const _=[];let C="",D=!1;for(let E=0;E<S.length;E++){const T=S[E];T==='"'?D=!D:T===","&&!D?(_.push(C.trim().replace(/^"(.*)"$/,"$1")),C=""):C+=T}_.push(C.trim().replace(/^"(.*)"$/,"$1"));const A={};return N.forEach((E,T)=>{const M=t[E];M&&_[T]!==void 0&&(A[M]=_[T])}),A});i({preview_data:j,total_rows:k.length,ready_for_import:!0})}catch(y){d(y.message)}finally{o(!1)}},m=()=>{a&&n(a)},p=()=>{if(!a||!a.preview_data.length)return r.jsx("div",{className:"text-center py-8 text-gray-500",children:"No preview data available"});const y=Object.keys(a.preview_data[0]),g=["company"];return r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full border border-gray-200 rounded-lg",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsx("tr",{children:y.map((x,b)=>{const v=g.includes(x);return r.jsx("th",{className:`px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b ${v?"bg-blue-50":""}`,children:r.jsxs("div",{className:"flex items-center",children:[x,v&&r.jsx("span",{className:"ml-1 text-xs bg-blue-100 text-blue-800 px-1 py-0.5 rounded",children:"Required"})]})},b)})})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.preview_data.map((x,b)=>r.jsx("tr",{className:"hover:bg-gray-50",children:y.map((v,w)=>{const N=x[v],k=!N||N.trim()==="",j=g.includes(v);return r.jsx("td",{className:`px-4 py-3 text-sm border-b ${k&&j?"bg-red-50 text-red-700":"text-gray-900"}`,children:k?r.jsx("span",{className:"text-gray-400 italic",children:j?"Missing required data":"Empty"}):r.jsx("span",{className:"truncate block max-w-xs",title:N,children:N})},w)})},b))})]})})},f=()=>{if(!a)return null;const y=a.ready_for_import,g=["company"];let x=0;return a.preview_data.forEach(b=>{g.some(w=>!b[w]||b[w].trim()==="")&&x++}),r.jsx("div",{className:`rounded-lg p-4 ${y?"bg-green-50 border border-green-200":"bg-orange-50 border border-orange-200"}`,children:r.jsxs("div",{className:"flex items-start",children:[y?r.jsx(bt,{className:"h-5 w-5 text-green-500 mt-0.5 mr-3"}):r.jsx(dt,{className:"h-5 w-5 text-orange-500 mt-0.5 mr-3"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:`font-medium ${y?"text-green-800":"text-orange-800"}`,children:y?"Data Validation Passed":"Data Validation Issues"}),r.jsx("div",{className:`text-sm mt-1 ${y?"text-green-700":"text-orange-700"}`,children:y?r.jsx("p",{children:"All required fields are properly mapped and your data looks good for import."}):r.jsxs("div",{children:[r.jsx("p",{children:"Some issues were found with your data:"}),x>0&&r.jsxs("p",{className:"mt-1",children:[" ",x," rows have missing required data"]}),r.jsx("p",{className:"mt-1",children:"These rows will be skipped during import."})]})})]})]})})};return l?r.jsxs("div",{className:"text-center space-y-6",children:[r.jsx("div",{className:"flex justify-center",children:r.jsx(Be,{className:"h-12 w-12 text-blue-500 animate-spin"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Generating Preview..."}),r.jsx("p",{className:"text-gray-600",children:"Please wait while we process your data and generate a preview."})]})]}):c?r.jsxs("div",{className:"text-center space-y-6",children:[r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(dt,{className:"h-5 w-5 text-red-500 mt-0.5 mr-3"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-red-800",children:"Preview Error"}),r.jsx("p",{className:"text-red-700 text-sm mt-1",children:c})]})]})}),r.jsxs("div",{className:"flex justify-between",children:[r.jsxs(H,{variant:"outline",onClick:s,children:[r.jsx(Wi,{className:"h-4 w-4 mr-2"}),"Back to Mapping"]}),r.jsxs(H,{onClick:u,children:[r.jsx(Be,{className:"h-4 w-4 mr-2"}),"Retry Preview"]})]})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx(bs,{className:"h-12 w-12 text-blue-500 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Preview Your Lead Data"}),r.jsx("p",{className:"text-gray-600",children:"Review how your lead data will be imported. Check that everything looks correct before proceeding."})]}),a&&r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[r.jsx(Ut,{className:"h-6 w-6 text-gray-400 mx-auto mb-2"}),r.jsx("div",{className:"text-sm text-gray-600",children:"File"}),r.jsx("div",{className:"font-medium text-gray-900",children:e.name})]}),r.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:[r.jsx(kt,{className:"h-6 w-6 text-blue-400 mx-auto mb-2"}),r.jsx("div",{className:"text-sm text-blue-600",children:"Total Rows"}),r.jsx("div",{className:"font-medium text-blue-900",children:a.total_rows})]}),r.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[r.jsx(bt,{className:"h-6 w-6 text-green-400 mx-auto mb-2"}),r.jsx("div",{className:"text-sm text-green-600",children:"Preview Rows"}),r.jsx("div",{className:"font-medium text-green-900",children:a.preview_data.length})]}),r.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 text-center",children:[r.jsx(bs,{className:"h-6 w-6 text-purple-400 mx-auto mb-2"}),r.jsx("div",{className:"text-sm text-purple-600",children:"Mapped Fields"}),r.jsx("div",{className:"font-medium text-purple-900",children:Object.keys(t).length})]})]}),f(),Object.keys(t).length>0&&r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Column Mappings"}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:Object.entries(t).map(([y,g])=>r.jsxs("div",{className:"flex items-center justify-between bg-white rounded px-3 py-2",children:[r.jsx("span",{className:"text-gray-600",children:y}),r.jsx(Dn,{className:"h-4 w-4 text-gray-400 mx-2"}),r.jsx("span",{className:"font-medium text-gray-900",children:g})]},y))})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Lead Data Preview (First 10 Rows)"}),r.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:p()})]}),r.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[r.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Import Settings"}),r.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[r.jsx("div",{children:" Duplicate companies will be handled according to your settings"}),r.jsx("div",{children:" Rows with missing company name will be skipped"}),r.jsx("div",{children:" Invalid data will be cleaned or set to defaults"})]})]}),r.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[r.jsxs(H,{variant:"outline",onClick:s,children:[r.jsx(Wi,{className:"h-4 w-4 mr-2"}),"Back to Mapping"]}),r.jsxs(H,{onClick:m,disabled:!a,className:"bg-green-600 hover:bg-green-700",children:["Start Import",r.jsx(Dn,{className:"h-4 w-4 ml-2"})]})]})]})},p3=({isOpen:e,onClose:t})=>{const{authFetch:n}=Qr(),{loadLeads:s}=gc(),[a,i]=h.useState("upload"),[l,o]=h.useState(null),[c,d]=h.useState(null),[u,m]=h.useState({}),[p,f]=h.useState(null),[y,g]=h.useState(null),[x,b]=h.useState(!1),[v,w]=h.useState(null),[N,k]=h.useState(!1),j="http://localhost:9000",S=()=>[{company:"Example Corp",contact_name:"John Smith",email:"john.smith@example.com",phone:"+1 (555) 123-4567",website:"https://example.com",industry:"Technology",location:"San Francisco, CA",company_size:"11-50",revenue:"1-10M",employees_count:"50",rating:"4.5",status:"warm",source:"csv_upload",score:"85",notes:"Imported lead from CSV",assigned_to:"",position:"CEO",linkedin_url:"https://linkedin.com/company/example",tags:"technology,b2b,saas"},{company:"Sample Inc",contact_name:"Jane Doe",email:"jane.doe@sample.com",phone:"+1 (555) 987-6543",website:"https://sample.com",industry:"Finance",location:"New York, NY",company_size:"51-200",revenue:"10-50M",employees_count:"100",rating:"4.0",status:"cold",source:"csv_upload",score:"75",notes:"Another imported lead from CSV",assigned_to:"",position:"CFO",linkedin_url:"https://linkedin.com/company/sample",tags:"finance,enterprise,b2b"}],_=()=>{const F=S(),O=Object.keys(F[0]),K=[O.join(","),...F.map(oe=>O.map(W=>{const B=oe[W]||"";return B.includes(",")||B.includes('"')?`"${B.replace(/"/g,'""')}"`:B}).join(","))].join(`
`),J=new Blob([K],{type:"text/csv;charset=utf-8;"}),se=document.createElement("a"),Z=URL.createObjectURL(J);se.setAttribute("href",Z),se.setAttribute("download","leads_import_template.csv"),se.style.visibility="hidden",document.body.appendChild(se),se.click(),document.body.removeChild(se)},C=async F=>{if(!F)return;if(!["text/csv","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(F.type)){w("Please upload a CSV or Excel file (.csv, .xlsx, .xls)");return}b(!0),w(null);try{const J=(await F.text()).split(`
`).map(he=>he.trim()).filter(he=>he);if(J.length===0)throw new Error("File is empty");const se=J[0],Z=[];let oe="",W=!1;for(let he=0;he<se.length;he++){const G=se[he];G==='"'?W=!W:G===","&&!W?(Z.push(oe.trim()),oe=""):oe+=G}Z.push(oe.trim());const B=Z.map(he=>he.replace(/^"(.*)"$/,"$1")),V=J.slice(1),re=["company","contact_name","email","phone","website","industry","location","company_size","revenue","employees_count","rating","status","source","score","notes","assigned_to","position","linkedin_url","tags"];o(F),d({source_columns:B,crm_fields:re,suggested_mappings:B.reduce((he,G)=>{const q=G.toLowerCase().replace(/[^a-z0-9]/g,"_");return q.includes("company")||q.includes("business")?he[G]="company":q.includes("contact")||q.includes("name")?he[G]="contact_name":q.includes("email")||q.includes("mail")?he[G]="email":q.includes("phone")||q.includes("tel")?he[G]="phone":q.includes("website")||q.includes("url")?he[G]="website":q.includes("industry")||q.includes("sector")?he[G]="industry":q.includes("location")||q.includes("address")?he[G]="location":q.includes("score")?he[G]="score":q.includes("status")?he[G]="status":q.includes("rating")?he[G]="rating":q.includes("size")?he[G]="company_size":q.includes("revenue")?he[G]="revenue":q.includes("employee")?he[G]="employees_count":q.includes("note")?he[G]="notes":q.includes("position")||q.includes("title")?he[G]="position":q.includes("linkedin")?he[G]="linkedin_url":q.includes("tag")?he[G]="tags":q.includes("assign")?he[G]="assigned_to":q.includes("source")?he[G]="source":re.includes(G)&&(he[G]=G),he},{}),row_count:V.length,sample_data:V.slice(0,3),headers:B});const Me=B.reduce((he,G)=>{const q=G.toLowerCase().replace(/[^a-z0-9]/g,"_");return q.includes("company")||q.includes("business")?he[G]="company":q.includes("contact")||q.includes("name")?he[G]="contact_name":q.includes("email")||q.includes("mail")?he[G]="email":q.includes("phone")||q.includes("tel")?he[G]="phone":q.includes("website")||q.includes("url")?he[G]="website":q.includes("industry")||q.includes("sector")?he[G]="industry":q.includes("location")||q.includes("address")?he[G]="location":q.includes("score")?he[G]="score":q.includes("status")?he[G]="status":q.includes("rating")?he[G]="rating":q.includes("size")?he[G]="company_size":q.includes("revenue")?he[G]="revenue":q.includes("employee")?he[G]="employees_count":q.includes("note")?he[G]="notes":q.includes("position")||q.includes("title")?he[G]="position":q.includes("linkedin")?he[G]="linkedin_url":q.includes("tag")?he[G]="tags":q.includes("assign")?he[G]="assigned_to":q.includes("source")?he[G]="source":re.includes(G)&&(he[G]=G),he},{});m(Me),i("mapping")}catch(K){w(K.message),mt.error(K.message)}finally{b(!1)}},D=F=>{const O=F.target.files[0];C(O)},A=h.useCallback(F=>{F.preventDefault(),k(!1);const O=F.dataTransfer.files[0];C(O)},[]),E=h.useCallback(F=>{F.preventDefault(),k(!0)},[]),T=h.useCallback(F=>{F.preventDefault(),k(!1)},[]),M=F=>{m(F),i("preview")},L=F=>{f(F),P()},P=async()=>{i("importing"),b(!0),w(null);try{const F=new FormData;F.append("file",l),F.append("column_mapping",JSON.stringify(u)),F.append("skip_duplicates","true");const O=await n(`${j}/api/leads/upload-csv`,{method:"POST",body:F});if(!O.ok){const J=await O.json();throw new Error(J.detail||"Failed to import leads")}const K=await O.json();if(K.status==="error")throw new Error(K.message||"Import failed");g(K),i("complete"),await s(!0),mt.success(` Successfully imported ${K.successful||0} of ${K.total_processed||0} leads!`,{duration:5e3})}catch(F){w(F.message),i("preview"),mt.error(F.message)}finally{b(!1)}},$=()=>{i("upload"),o(null),d(null),m({}),f(null),g(null),w(null)},R=()=>r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx(kt,{className:"h-12 w-12 text-blue-500 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Import Leads from CSV/Excel"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Upload a CSV or Excel file to bulk import lead data into your system"}),r.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:[r.jsxs("div",{className:"flex items-center justify-center gap-3 mb-2",children:[r.jsx(ra,{className:"h-5 w-5 text-green-600"}),r.jsx("span",{className:"font-medium text-green-800",children:"Need a template?"})]}),r.jsx("p",{className:"text-sm text-green-700 mb-3",children:"Download our template with sample data and proper column headers"}),r.jsxs(H,{onClick:_,variant:"outline",size:"sm",className:"bg-white border-green-300 text-green-700 hover:bg-green-50",children:[r.jsx(ra,{className:"h-4 w-4 mr-2"}),"Download Template"]})]})]}),r.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${N?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDrop:A,onDragOver:E,onDragLeave:T,children:[r.jsx(vs,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("p",{className:"text-lg font-medium text-gray-900",children:["Drop your file here, or"," ",r.jsxs("label",{className:"text-blue-600 hover:text-blue-700 cursor-pointer",children:["browse",r.jsx("input",{type:"file",className:"hidden",accept:".csv,.xlsx,.xls",onChange:D,disabled:x})]})]}),r.jsx("p",{className:"text-sm text-gray-500",children:"Supports CSV, XLSX, and XLS files up to 10MB"})]})]}),r.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[r.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"File Requirements:"}),r.jsxs("div",{className:"text-sm text-blue-800 space-y-2",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Required Fields:"}),r.jsx("ul",{className:"mt-1 space-y-1 ml-4",children:r.jsx("li",{children:" company (Company name)"})})]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Optional Fields:"}),r.jsx("p",{className:"mt-1",children:"contact_name, email, phone, website, industry, location, company_size, revenue, employees_count, rating, status, source, score, notes, assigned_to, position, linkedin_url, tags"})]})]}),r.jsxs("p",{className:"text-sm text-blue-700 mt-3",children:[" ",r.jsx("strong",{children:"Tip:"})," Download the template above to see all available fields with proper column names and formatting examples."]})]})]}),U=()=>{const F=[{id:"upload",label:"Upload File",icon:vs},{id:"mapping",label:"Map Columns",icon:ys},{id:"preview",label:"Preview Data",icon:bs},{id:"importing",label:"Import",icon:Be},{id:"complete",label:"Complete",icon:bt}],O=F.findIndex(K=>K.id===a);return r.jsx("div",{className:"flex items-center justify-center space-x-4 mb-6",children:F.map((K,J)=>{const se=K.icon,Z=J===O,oe=J<O;return r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full border-2 ${Z?"border-blue-500 bg-blue-500 text-white":oe?"border-green-500 bg-green-500 text-white":"border-gray-300 text-gray-400"}`,children:r.jsx(se,{className:"h-5 w-5"})}),r.jsx("span",{className:`ml-2 text-sm font-medium ${Z||oe?"text-gray-900":"text-gray-400"}`,children:K.label}),J<F.length-1&&r.jsx(Dn,{className:"h-4 w-4 text-gray-300 ml-4"})]},K.id)})})},I=()=>r.jsxs("div",{className:"text-center space-y-6",children:[r.jsx("div",{className:"flex justify-center",children:r.jsx(Be,{className:"h-16 w-16 text-blue-500 animate-spin"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Importing Leads..."}),r.jsx("p",{className:"text-gray-600",children:"Please wait while we process your data and import leads into your system."})]})]}),z=()=>r.jsxs("div",{className:"text-center space-y-6",children:[r.jsx("div",{className:"flex justify-center",children:r.jsx(bt,{className:"h-16 w-16 text-green-500"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Import Completed Successfully!"}),y&&r.jsxs("div",{className:"bg-green-50 rounded-lg p-4 mb-4",children:[y.message&&r.jsx("div",{className:"mb-3 text-sm text-green-800 font-medium",children:y.message}),r.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-green-800",children:"Total Processed:"}),r.jsx("span",{className:"text-green-700 ml-2",children:y.total_processed})]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-green-800",children:"Successful:"}),r.jsx("span",{className:"text-green-700 ml-2",children:y.successful})]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-green-800",children:"Failed:"}),r.jsx("span",{className:"text-green-700 ml-2",children:y.failed})]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-green-800",children:"Status:"}),r.jsx("span",{className:"text-green-700 ml-2 capitalize",children:y.status})]})]}),y.errors&&y.errors.length>0&&r.jsxs("div",{className:"mt-3 text-sm text-green-800",children:[r.jsx("span",{className:"font-medium",children:"Sample Errors:"}),r.jsx("ul",{className:"mt-1 space-y-1",children:y.errors.slice(0,3).map((F,O)=>r.jsxs("li",{className:"text-xs",children:[" ",F]},O))})]})]})]}),r.jsxs("div",{className:"space-x-3",children:[r.jsx(H,{onClick:$,variant:"outline",children:"Import Another File"}),r.jsx(H,{onClick:t,children:"Close"})]})]});return e?r.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black bg-opacity-50",children:r.jsxs(de.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[95vh] flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsx("div",{className:"flex items-center gap-4",children:r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Import Leads"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Upload CSV or Excel files to bulk import lead data"})]})}),r.jsx(H,{variant:"ghost",size:"sm",onClick:t,children:r.jsx(Ze,{className:"h-4 w-4"})})]}),a!=="upload"&&r.jsx("div",{className:"px-6 py-3 border-b border-gray-100 bg-gray-50",children:U()}),r.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[r.jsx(ht,{mode:"wait",children:v&&r.jsx(de.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(dt,{className:"h-5 w-5 text-red-500 mt-0.5 mr-3"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-red-800",children:"Error"}),r.jsx("p",{className:"text-red-700 text-sm mt-1",children:v})]})]})},"error")}),r.jsxs(ht,{mode:"wait",children:[a==="upload"&&r.jsx(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:R()},"upload"),a==="mapping"&&c&&r.jsx(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:r.jsx(m3,{analysisResult:c,onMappingComplete:M,onBack:()=>i("upload")})},"mapping"),a==="preview"&&r.jsx(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:r.jsx(h3,{file:l,columnMapping:u,onPreviewComplete:L,onBack:()=>i("mapping")})},"preview"),a==="importing"&&r.jsx(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:I()},"importing"),a==="complete"&&r.jsx(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:z()},"complete")]}),x&&a!=="importing"&&r.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center",children:r.jsx(Be,{className:"h-8 w-8 text-blue-500 animate-spin"})})]})]})}):null},wx=({columns:e,onApplyFilters:t,activeFilters:n={},className:s=""})=>{const[a,i]=h.useState(!1),[l,o]=h.useState(()=>{const b=[];return Object.keys(n).forEach((v,w)=>{var N;(N=n[v])!=null&&N.condition&&b.push({id:`filter-${w}`,column:v,condition:n[v].condition,value:n[v].value||""})}),b.length>0?b:[{id:`filter-${Date.now()}`,column:"",condition:"",value:""}]}),c=h.useRef(null);h.useEffect(()=>{const b=w=>{c.current&&!c.current.contains(w.target)&&i(!1)},v=w=>{w.key==="Escape"&&i(!1)};if(a)return document.addEventListener("mousedown",b),document.addEventListener("keydown",v),()=>{document.removeEventListener("mousedown",b),document.removeEventListener("keydown",v)}},[a]);const d=()=>{o(b=>[...b,{id:`filter-${Date.now()}`,column:"",condition:"",value:""}])},u=b=>{o(v=>{const w=v.filter(N=>N.id!==b);return w.length>0?w:[{id:`filter-${Date.now()}`,column:"",condition:"",value:""}]})},m=(b,v,w)=>{o(N=>N.map(k=>{if(k.id===b){const j={...k,[v]:w};return v==="condition"&&["is_empty","not_empty"].includes(w)&&(j.value=""),v==="column"&&(j.condition="",j.value=""),j}return k}))},p=()=>{const b={};l.forEach(v=>{v.column&&v.condition&&(b[v.column]||(b[v.column]=[]),b[v.column].push({condition:v.condition,value:v.value}))}),t(b),i(!1)},f=()=>{o([{id:`filter-${Date.now()}`,column:"",condition:"",value:""}]),t({})},y=l.filter(b=>b.column&&b.condition).length,g=b=>{switch(b){case"text":return[{value:"contains",label:"Contains"},{value:"not_contains",label:"Does not contain"},{value:"equals",label:"Equals"},{value:"not_equals",label:"Not equals"},{value:"starts_with",label:"Starts with"},{value:"ends_with",label:"Ends with"},{value:"is_empty",label:"Is empty"},{value:"not_empty",label:"Is not empty"}];case"email":return[{value:"contains",label:"Contains"},{value:"not_contains",label:"Does not contain"},{value:"equals",label:"Equals"},{value:"not_equals",label:"Not equals"},{value:"starts_with",label:"Starts with"},{value:"ends_with",label:"Ends with"},{value:"is_empty",label:"Is empty"},{value:"not_empty",label:"Is not empty"}];case"tel":return[{value:"contains",label:"Contains"},{value:"not_contains",label:"Does not contain"},{value:"equals",label:"Equals"},{value:"not_equals",label:"Not equals"},{value:"starts_with",label:"Starts with"},{value:"is_empty",label:"Is empty"},{value:"not_empty",label:"Is not empty"}];case"number":return[{value:"equals",label:"Equals"},{value:"not_equals",label:"Not equals"},{value:"greater_than",label:"Greater than"},{value:"less_than",label:"Less than"},{value:"greater_equal",label:"Greater or equal"},{value:"less_equal",label:"Less or equal"},{value:"between",label:"Between"},{value:"is_empty",label:"Is empty"},{value:"not_empty",label:"Is not empty"}];case"currency":return[{value:"equals",label:"Equals"},{value:"not_equals",label:"Not equals"},{value:"greater_than",label:"Greater than"},{value:"less_than",label:"Less than"},{value:"greater_equal",label:"Greater or equal"},{value:"less_equal",label:"Less or equal"},{value:"between",label:"Between"},{value:"is_empty",label:"Is empty"},{value:"not_empty",label:"Is not empty"}];case"date":case"datetime":return[{value:"equals",label:"On"},{value:"not_equals",label:"Not on"},{value:"before",label:"Before"},{value:"after",label:"After"},{value:"between",label:"Between"},{value:"last_days",label:"In the last X days"},{value:"next_days",label:"In the next X days"},{value:"is_empty",label:"Is empty"},{value:"not_empty",label:"Is not empty"}];case"select":case"dropdown":return[{value:"equals",label:"Is"},{value:"not_equals",label:"Is not"},{value:"in",label:"Is one of"},{value:"not_in",label:"Is not one of"},{value:"is_empty",label:"Is empty"},{value:"not_empty",label:"Is not empty"}];case"boolean":return[{value:"equals",label:"Is"},{value:"not_equals",label:"Is not"}];case"percentage":return[{value:"equals",label:"Equals"},{value:"not_equals",label:"Not equals"},{value:"greater_than",label:"Greater than"},{value:"less_than",label:"Less than"},{value:"greater_equal",label:"Greater or equal"},{value:"less_equal",label:"Less or equal"},{value:"between",label:"Between"},{value:"is_empty",label:"Is empty"},{value:"not_empty",label:"Is not empty"}];default:return[{value:"contains",label:"Contains"},{value:"equals",label:"Equals"},{value:"is_empty",label:"Is empty"},{value:"not_empty",label:"Is not empty"}]}},x=b=>{var C,D;const v=e.find(A=>A.id===b.column);if(!v||!b.condition||!!["is_empty","not_empty"].includes(b.condition))return null;if(v.type==="boolean")return r.jsxs("select",{value:b.value||"",onChange:A=>m(b.id,"value",A.target.value),className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"Select..."}),r.jsx("option",{value:"true",children:"Yes"}),r.jsx("option",{value:"false",children:"No"})]});if(b.condition==="between"){const[A,E]=(b.value||"").split(",");let T="text",M,L,P;return v.type==="currency"||v.type==="number"||v.type==="percentage"?(T="number",v.type==="currency"?M="0.01":v.type==="percentage"&&(M="1",L="0",P="100")):(v.type==="date"||v.type==="datetime")&&(T=v.type==="datetime"?"datetime-local":"date"),r.jsxs("div",{className:"flex gap-2 flex-1",children:[r.jsx("input",{type:T,placeholder:v.type==="percentage"?"Min %":v.type==="currency"?"Min $":"Min",value:A||"",onChange:$=>{const R=`${$.target.value},${E||""}`;m(b.id,"value",R)},className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",step:M,min:L,max:P}),r.jsx("input",{type:T,placeholder:v.type==="percentage"?"Max %":v.type==="currency"?"Max $":"Max",value:E||"",onChange:$=>{const R=`${A||""},${$.target.value}`;m(b.id,"value",R)},className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",step:M,min:L,max:P})]})}if(v.type==="select"&&["in","not_in"].includes(b.condition)){const A=(b.value||"").split(",").filter(E=>E);return r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"relative",children:[r.jsx("select",{multiple:!0,value:A,onChange:E=>{const T=Array.from(E.target.selectedOptions,M=>M.value);m(b.id,"value",T.join(","))},className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",size:"3",children:(C=v.options)==null?void 0:C.map(E=>r.jsx("option",{value:E.value,children:E.label},E.value))}),r.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-white to-transparent h-4 pointer-events-none"})]}),A.length>0&&r.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:[A.length," selected"]})]})}if(v.type==="select"&&["equals","not_equals"].includes(b.condition))return r.jsxs("select",{value:b.value||"",onChange:A=>m(b.id,"value",A.target.value),className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"Select..."}),(D=v.options)==null?void 0:D.map(A=>r.jsx("option",{value:A.value,children:A.label},A.value))]});if(["last_days","next_days"].includes(b.condition))return r.jsx("input",{type:"number",placeholder:"Number of days",value:b.value||"",onChange:A=>m(b.id,"value",A.target.value),className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1"});let N="text",k,j="Enter value...",S,_;return v.type==="date"||v.type==="datetime"?N=v.type==="datetime"?"datetime-local":"date":v.type==="currency"||v.type==="number"||v.type==="percentage"?(N="number",v.type==="currency"?(k="0.01",j="Enter amount..."):v.type==="percentage"&&(k="1",S="0",_="100",j="Enter percentage (0-100)...")):v.type==="email"?(N="email",j="Enter email..."):v.type==="tel"&&(N="tel",j="Enter phone number..."),r.jsx("input",{type:N,placeholder:j,value:b.value||"",onChange:A=>m(b.id,"value",A.target.value),className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",step:k,min:S,max:_})};return r.jsxs("div",{className:`relative ${s}`,children:[r.jsxs("button",{onClick:()=>i(!a),className:`inline-flex items-center justify-center font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none active:scale-95 hover:text-accent-foreground font-inter text-sm h-10 px-3 gap-2 rounded-lg transition-colors duration-200 border ${y>0?"bg-blue-50 text-blue-700 hover:bg-blue-100 border-blue-300 shadow-sm":"text-gray-700 hover:bg-gray-100 border-gray-300"}`,children:[r.jsx(da,{className:"w-4 h-4"}),r.jsx("span",{children:"Filters"}),y>0&&r.jsx("span",{className:"bg-blue-600 text-white text-xs px-2 py-0.5 rounded-full",children:y}),r.jsx(Xt,{className:`w-4 h-4 transition-transform ${a?"rotate-180":""}`})]}),a&&r.jsxs("div",{ref:c,className:"absolute top-full mt-2 w-[720px] max-w-[90vw] bg-white rounded-lg shadow-2xl border border-gray-200 z-50 max-h-96 overflow-y-auto",style:{right:"-20px"},children:[r.jsx("div",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 rounded-t-lg",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Filter Builder"}),r.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Add conditions to filter your data"})]}),r.jsx("button",{onClick:()=>i(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:r.jsx(Ze,{className:"w-5 h-5"})})]})}),r.jsxs("div",{className:"p-4",children:[r.jsx("div",{className:"space-y-3",children:l.map((b,v)=>{const w=e.find(N=>N.id===b.column);return r.jsx("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("select",{value:b.column,onChange:N=>m(b.id,"column",N.target.value),className:"w-48 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"Select column..."}),e.map(N=>r.jsx("option",{value:N.id,children:N.label},N.id))]}),b.column&&r.jsxs("select",{value:b.condition,onChange:N=>m(b.id,"condition",N.target.value),className:"w-40 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"Condition..."}),g(w==null?void 0:w.type).map(N=>r.jsx("option",{value:N.value,children:N.label},N.value))]}),b.column&&b.condition&&!["is_empty","not_empty"].includes(b.condition)&&r.jsx("div",{className:"flex-1",children:x(b)}),r.jsx("div",{className:"flex-1"}),l.length>1&&r.jsx("button",{onClick:()=>u(b.id),className:"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded transition-colors",title:"Remove filter",children:r.jsx(fr,{className:"w-4 h-4"})})]})},b.id)})}),r.jsxs("button",{onClick:d,className:"mt-3 w-full flex items-center justify-center gap-2 px-4 py-2 text-sm text-blue-600 hover:text-blue-700 hover:bg-blue-50 border border-dashed border-blue-300 rounded-lg transition-colors",children:[r.jsx(Wt,{className:"w-4 h-4"}),"Add Filter Condition"]})]}),r.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 flex items-center justify-between bg-gray-50 rounded-b-lg",children:[r.jsx("button",{onClick:f,className:"text-sm text-gray-600 hover:text-gray-800 transition-colors",children:"Clear all"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>i(!1),className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-md transition-colors",children:"Cancel"}),r.jsx("button",{onClick:p,className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors shadow-sm",children:"Apply Filters"})]})]})]})]})},jx=({value:e,onChange:t,onClear:n,searchColumns:s,onColumnChange:a,availableColumns:i,placeholder:l="Search customers...",className:o=""})=>{const[c,d]=h.useState(!1),u=h.useRef(null),m=h.useRef(null),p=h.useRef(null),y=i||[{key:"company",label:"Company",icon:""},{key:"primaryContact",label:"Contact",icon:""},{key:"email",label:"Email",icon:""},{key:"phone",label:"Phone",icon:""},{key:"industry",label:"Industry",icon:""},{key:"status",label:"Status",icon:""},{key:"notes",label:"Notes",icon:""}],g=Object.values(s||{}).filter(N=>N).length;h.useEffect(()=>{const N=k=>{u.current&&!u.current.contains(k.target)&&d(!1)};return document.addEventListener("mousedown",N),()=>document.removeEventListener("mousedown",N)},[]);const x=()=>{n==null||n()},b=N=>{const k={...s};k[N]=!k[N],a==null||a(k)},v=()=>{const N={};y.forEach(k=>{N[k.key]=!0}),a==null||a(N)},w=()=>{const N={};y.forEach(k=>{N[k.key]=!1}),a==null||a(N)};return r.jsx("div",{className:`relative ${o}`,ref:u,children:r.jsxs("div",{className:"flex items-center gap-2 bg-white border border-gray-300 rounded-lg px-3 py-2 shadow-sm",style:{minWidth:"400px"},children:[r.jsx(zn,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}),r.jsx("input",{ref:p,type:"text",value:e,onChange:N=>t==null?void 0:t(N.target.value),placeholder:l,className:"flex-1 outline-none text-sm bg-transparent"}),r.jsxs("div",{className:"relative",children:[r.jsxs("button",{onClick:()=>d(!c),className:"flex items-center gap-1 px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded transition-colors",title:"Select searchable columns",children:[r.jsxs("span",{className:"font-medium",children:[g," columns"]}),r.jsx(Xt,{className:`w-3 h-3 transition-transform ${c?"rotate-180":""}`})]}),r.jsx(ht,{children:c&&r.jsxs(de.div,{ref:m,initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.15},className:"absolute right-0 top-full mt-2 w-56 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:[r.jsxs("div",{className:"p-3 border-b border-gray-200",children:[r.jsx("div",{className:"flex items-center justify-between mb-2",children:r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Search in columns:"})}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:v,className:"text-xs text-blue-600 hover:text-blue-800 transition-colors",children:"Select all"}),r.jsx("span",{className:"text-gray-300",children:"|"}),r.jsx("button",{onClick:w,className:"text-xs text-blue-600 hover:text-blue-800 transition-colors",children:"Clear all"})]})]}),r.jsx("div",{className:"p-2 max-h-64 overflow-y-auto",children:y.map(N=>r.jsxs("label",{className:"flex items-center gap-3 px-2 py-2 hover:bg-gray-50 rounded cursor-pointer transition-colors",children:[r.jsx("input",{type:"checkbox",checked:(s==null?void 0:s[N.key])||!1,onChange:()=>b(N.key),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),r.jsxs("span",{className:"flex items-center gap-2 flex-1",children:[r.jsx("span",{className:"text-base",children:typeof N.icon=="string"?N.icon:N.icon?r.jsx(N.icon,{className:"w-4 h-4"}):null}),r.jsx("span",{className:"text-sm text-gray-700",children:N.label})]}),(s==null?void 0:s[N.key])&&r.jsx(Xr,{className:"w-4 h-4 text-blue-600"})]},N.key))}),r.jsx("div",{className:"p-3 border-t border-gray-200 bg-gray-50",children:r.jsx("button",{onClick:()=>d(!1),className:"w-full px-3 py-1.5 text-sm text-white bg-blue-600 hover:bg-blue-700 rounded transition-colors",children:"Done"})})]})})]}),e&&r.jsx("button",{onClick:x,className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"Clear search",children:r.jsx(Ze,{className:"w-4 h-4 text-gray-500"})})]})})},f3=()=>{const{leads:e,workflowLeads:t,isLoading:n,authLoading:s,hasInitialLoad:a,loadLeads:i,updateLeadStatus:l,deleteLead:o,removeLeadFromState:c,isCacheValid:d}=gc(),{isSyncing:u,lastSyncTime:m,registerSyncCallback:p}=EC(),{addNotification:f}=Vu(),[y,g]=xs("lead_filter_status","all"),{searchTerm:x,searchColumns:b,setSearchTerm:v,setSearchColumns:w}=Rk("lead",{term:"",columns:{company:!0,location:!0,industry:!0,email:!0,phone:!0,website:!0}}),[N,k]=xs("lead_sort",{sortBy:"company",sortOrder:"asc"}),j=N.sortBy,S=N.sortOrder,_=ae=>k(Te=>({...Te,sortBy:ae})),C=ae=>k(Te=>({...Te,sortOrder:ae})),[D,A]=h.useState(null),[E,T]=h.useState(!1),[M,L]=h.useState(!1),[P,$]=h.useState(!1),[R,U]=h.useState(!1),[I,z]=h.useState(null),[F,O]=xs("lead_modal_tab","information"),[K,J]=h.useState(!1),[se,Z]=h.useState(null),[oe,W]=h.useState(!1),[B,V]=h.useState({}),[re,Me]=h.useState(!1),[he,G]=h.useState({}),[q,Q]=h.useState(!1),[ue,Le]=h.useState(null),[ge,Se]=h.useState(null),[ce,ke]=h.useState(!1),[Pe,qe]=h.useState(null),[ne,ye]=h.useState({}),[Ee,st]=h.useState({company:!0,location:!1,industry:!0,email:!0,phone:!1,website:!0,status:!0}),[Ke,At]=h.useState(!1),[lt,Ht]=h.useState({company:"",location:"",industry:"",email:"",phone:"",website:"",status:"new"}),[pt,be]=h.useState(!1),[ze,ee]=h.useState(!1),X=h.useRef(null),te=h.useRef(null),we=h.useRef(null);h.useEffect(()=>{const ae=Te=>{te.current&&!te.current.contains(Te.target)&&be(!1),we.current&&!we.current.contains(Te.target)&&ee(!1)};return document.addEventListener("mousedown",ae),()=>document.removeEventListener("mousedown",ae)},[]);const Ne=ae=>{try{if(!ae)return;let Te="asc";j===ae&&S==="asc"&&(Te="desc"),_(ae),C(Te)}catch(Te){console.error("Error in handleSort:",Te)}},nt=(ae,Te)=>{st(Ve=>({...Ve,[ae]:Te}))},ie=(ae,Te)=>{if(!Te||!Te.condition)return!0;const{condition:Ve,value:gt}=Te,zt=String(ae||"").toLowerCase(),Mt=String(gt||"").toLowerCase();switch(Ve){case"contains":return zt.includes(Mt);case"not_contains":return!zt.includes(Mt);case"equals":return zt===Mt;case"not_equals":return zt!==Mt;case"starts_with":return zt.startsWith(Mt);case"ends_with":return zt.endsWith(Mt);case"is_empty":return!ae||ae==="";case"not_empty":return ae&&ae!=="";case"greater_than":return parseFloat(ae)>parseFloat(gt);case"less_than":return parseFloat(ae)<parseFloat(gt);case"greater_equal":return parseFloat(ae)>=parseFloat(gt);case"less_equal":return parseFloat(ae)<=parseFloat(gt);case"between":{const[An,De]=gt.split(",").map(wt=>parseFloat(wt)),at=parseFloat(ae);return at>=An&&at<=De}case"in":return gt.split(",").includes(String(ae));case"not_in":return!gt.split(",").includes(String(ae));default:return!0}},xe=()=>{At(!0),Ht({company:"",location:"",industry:"",email:"",phone:"",website:"",status:"new"})},Ie=async()=>{try{if(!lt.company.trim()){mt.error("Company name is required");return}const ae={company:lt.company.trim(),location:lt.location.trim()||null,industry:lt.industry.trim()||null,email:lt.email.trim()||null,phone:lt.phone.trim()||null,website:lt.website.trim()||null,status:lt.status||"new",source:"manual_entry"},Te=await ar.createLead(ae);if(Te&&Te.success!==!1)mt.success("Lead added successfully"),At(!1),await i(!0);else throw new Error((Te==null?void 0:Te.error)||(Te==null?void 0:Te.message)||"Failed to add lead")}catch(ae){console.error("Error saving new lead:",ae),mt.error(`Failed to add lead: ${ae.message}`)}},Oe=()=>{At(!1),Ht({company:"",location:"",industry:"",email:"",phone:"",website:"",status:"new"})},Ue=(ae,Te)=>{Ht(Ve=>({...Ve,[ae]:Te}))},$e=()=>Ke?r.jsxs("tr",{className:"bg-blue-50 border-2 border-blue-200",children:[Ee.company&&r.jsx("td",{className:"px-6 py-3 whitespace-nowrap",children:r.jsx("input",{type:"text",value:lt.company,onChange:ae=>Ue("company",ae.target.value),placeholder:"Company name *",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",autoFocus:!0})}),Ee.location&&r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:r.jsx("input",{type:"text",value:lt.location,onChange:ae=>Ue("location",ae.target.value),placeholder:"Location",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})}),Ee.industry&&r.jsx("td",{className:"px-6 py-3 whitespace-nowrap",children:r.jsx("input",{type:"text",value:lt.industry,onChange:ae=>Ue("industry",ae.target.value),placeholder:"Industry",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})}),Ee.email&&r.jsx("td",{className:"px-6 py-3 whitespace-nowrap",children:r.jsx("input",{type:"email",value:lt.email,onChange:ae=>Ue("email",ae.target.value),placeholder:"Email",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})}),Ee.phone&&r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:r.jsx("input",{type:"tel",value:lt.phone,onChange:ae=>Ue("phone",ae.target.value),placeholder:"Phone",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})}),Ee.website&&r.jsx("td",{className:"px-6 py-3 whitespace-nowrap",children:r.jsx("input",{type:"url",value:lt.website,onChange:ae=>Ue("website",ae.target.value),placeholder:"Website",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})}),Ee.status&&r.jsx("td",{className:"px-2 py-3 whitespace-nowrap",children:r.jsx("select",{value:lt.status,onChange:ae=>Ue("status",ae.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",children:ot.map(ae=>r.jsx("option",{value:ae.value,children:ae.label},ae.value))})}),r.jsx("td",{className:"px-4 py-2 text-right",children:r.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[r.jsx("button",{onClick:Ie,className:"text-green-600 hover:text-green-800 hover:bg-green-50 p-1 rounded transition-colors",title:"Save Lead",children:r.jsx(Xr,{className:"w-4 h-4"})}),r.jsx("button",{onClick:Oe,className:"text-red-500 hover:text-red-700 hover:bg-red-50 p-1 rounded transition-colors",title:"Cancel",children:r.jsx(Ze,{className:"w-4 h-4"})})]})})]}):null,ot=[{value:"new",label:"New",color:"bg-blue-100 text-blue-800"},{value:"contacted",label:"Contacted",color:"bg-purple-100 text-purple-800"},{value:"qualified",label:"Qualified",color:"bg-green-100 text-green-800"},{value:"lost",label:"Lost",color:"bg-red-100 text-red-800"}],fe=ae=>ot.find(Te=>Te.value===ae)||ot[0],pe={company:{id:"company",type:"text",label:"Company",icon:qt,required:!0,sortable:!0,disabled:!0,validation:ae=>(ae==null?void 0:ae.length)>=2?null:"Company name must be at least 2 characters"},location:{id:"location",type:"text",label:"Location",icon:vn,sortable:!0},industry:{id:"industry",type:"text",label:"Industry",icon:qt,sortable:!0},email:{id:"email",type:"email",label:"Email",icon:Dt,sortable:!0,validation:ae=>ae?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(ae)?null:"Invalid email format":null},phone:{id:"phone",type:"tel",label:"Phone",icon:sn,sortable:!0,validation:ae=>!ae||ae.length>=10?null:"Phone number must be at least 10 digits"},website:{id:"website",type:"url",label:"Website",icon:ni,sortable:!0,validation:ae=>{if(!ae)return null;try{return new URL(ae),null}catch{return"Invalid website URL"}}},status:{id:"status",type:"select",label:"Status",sortable:!0,options:ot}},je=h.useCallback(ae=>[...ae].sort((Te,Ve)=>{let gt=Te[j],zt=Ve[j];if(j==="created_at")gt=new Date(gt||0),zt=new Date(zt||0);else if(j==="status"){const Mt={converted:7,qualified:6,hot:5,warm:4,contacted:3,new_lead:2,cold:1,lost:0};gt=Mt[gt]||0,zt=Mt[zt]||0}else gt=String(gt||"").toLowerCase(),zt=String(zt||"").toLowerCase();return gt<zt?S==="asc"?-1:1:gt>zt?S==="asc"?1:-1:0}),[j,S]);h.useEffect(()=>{(!a||!d)&&i()},[a,d,i]),h.useEffect(()=>{const ae=setTimeout(()=>{a&&e.length===0&&t.length===0&&!n&&(console.log("Failsafe: No leads found despite cache - forcing reload"),i(!0))},500);return()=>clearTimeout(ae)},[]),h.useEffect(()=>p(async Ve=>{console.log("[LeadManagement] Background sync complete, processing result:",Ve),Le(Ve),Se(new Date().toISOString()),Ve.leads_status_updated>0&&(console.log(`[LeadManagement] ${Ve.leads_status_updated} leads qualified - refreshing list`),await i(!0))}),[p,i]);const Fe=async()=>{try{const ae=localStorage.getItem("auth_provider");if(console.log(" Auth provider:",ae),!ae||ae!=="google"&&ae!=="microsoft"){mt.error("Please log in with Google or Microsoft to check email replies");return}const Te=localStorage.getItem(`${ae}_access_token`);if(console.log(` ${ae}_access_token exists:`,!!Te),!Te||Te==="undefined"||Te==="null"){const De=ae==="google"?"Gmail":"Outlook";mt.error(`${De} access token not available. Please log in with ${ae==="google"?"Google":"Microsoft"}.`);return}ke(!0),Q(!0),Le(null);const Ve=ae==="google"?"Gmail":"Outlook";qe(Ve),console.log(`Starting manual check of lead email replies from ${Ve}...`);const gt=await ar.checkAllReplies({access_token:Te,provider:ae==="google"?"gmail":"outlook",days_back:7,max_leads:100});Le(gt),Se(new Date().toISOString()),localStorage.setItem("leads_last_reply_sync",Date.now().toString()),console.log("Manual check complete:",gt);const zt=gt.new_replies_processed||0,Mt=gt.leads_status_updated||0,An=gt.qualified_companies||[];if(zt>0){let De=`Synced ${zt} new ${zt===1?"reply":"replies"} from ${Ve}`;if(Mt>0&&(De+=`. ${Mt} ${Mt===1?"lead":"leads"} qualified`,An.length>0)){const at=An.join(", ");De+=`: ${at}`}f("lead-reply",De,{newReplies:zt,leadsQualified:Mt,qualifiedCompanies:An,provider:Ve,manualSync:!0}),mt.success(`Loaded ${zt} new ${zt===1?"reply":"replies"}!`)}else mt.success("No new replies found");gt.leads_status_updated>0&&(console.log(`${gt.leads_status_updated} leads qualified - refreshing list`),await i(!0))}catch(ae){console.error("Manual check failed:",ae),mt.error(`Failed to check replies: ${ae.message}`)}finally{ke(!1),Q(!1)}},Y=h.useMemo(()=>{const ae=t.map((Te,Ve)=>({...Te,id:Te.id||`workflow-${Ve}`,status:Te.status||"new"})).filter(Te=>{const Ve=x.length===0||(()=>{const zt=x.toLowerCase(),Mt=[];return b.company&&Mt.push(Te.company),b.name&&Mt.push(Te.name),b.email&&Mt.push(Te.email),b.phone&&Mt.push(Te.phone),b.location&&Mt.push(Te.address),Mt.some(An=>An&&An.toLowerCase().includes(zt))})(),gt=y==="all"||Te.status===y;for(const[zt,Mt]of Object.entries(ne))if(!ie(Te[zt],Mt))return!1;return Ve&&gt});return je(ae)},[t,y,x,b,ne,je]),me=h.useMemo(()=>{const ae=e.map((Te,Ve)=>({...Te,id:Te.id||`manual-${Ve}`,status:Te.status||"new"})).filter(Te=>{const Ve=x.length===0||(()=>{const zt=x.toLowerCase(),Mt=[];return b.company&&Mt.push(Te.company),b.name&&Mt.push(Te.name),b.email&&Mt.push(Te.email),b.phone&&Mt.push(Te.phone),b.location&&Mt.push(Te.address),Mt.some(An=>An&&An.toLowerCase().includes(zt))})(),gt=y==="all"||Te.status===y;for(const[zt,Mt]of Object.entries(ne))if(!ie(Te[zt],Mt))return!1;return Ve&&gt});return je(ae)},[e,y,x,b,ne,je]),_e=h.useCallback(async(ae,Te)=>{try{await l(ae,Te);const Ve=fe(Te).label;mt.success(`Lead status updated to ${Ve}`),z(null)}catch(Ve){mt.error("Failed to update lead status"),console.error("Status update error:",Ve)}},[l,fe]),Nt=h.useCallback(ae=>{Z(ae),J(!0)},[]),Ft=h.useCallback(async()=>{if(se)try{W(!0),await o(se.id),mt.success(`Lead "${se.company}" deleted successfully`)}catch(ae){mt.error("Failed to delete lead"),console.error("Delete error:",ae)}finally{W(!1),J(!1),Z(null)}},[se,o]),rr=h.useCallback(()=>{J(!1),Z(null)},[]),Yt=h.useCallback((ae,Te)=>{Te.target.closest(".editable-cell")||Te.target.closest("button")||Te.target.closest("select")||Te.target.closest("input")||(A(ae),L(!0),O("information"),Me(!1))},[]),ft=h.useCallback(async ae=>{if(ae)try{const Te=await ar.getCachedAISuggestions(ae);Te&&V(Ve=>({...Ve,[ae]:Te}))}catch(Te){console.error(" Failed to load cached AI analysis:",Te)}},[]),Ds=h.useCallback(async ae=>{if(ae){Me(!0),G(Te=>({...Te,[ae]:null}));try{const Te=await ar.regenerateAISuggestions(ae);V(Ve=>({...Ve,[ae]:Te}))}catch(Te){console.error(" Failed to regenerate AI analysis:",Te),G(Ve=>({...Ve,[ae]:Te.message||"Failed to regenerate AI analysis"}))}finally{Me(!1)}}},[]),Ni=h.useCallback(async ae=>{if(mt.success("Email sent successfully!"),ae&&ae.status_changed===!0&&ae.new_status)try{const Te=[...e,...t].find(Ve=>Ve.email===ae.sent_to);Te&&(await l(Te.lead_id,ae.new_status),mt.success(`Lead status updated to ${ae.new_status}`))}catch(Te){console.error(" Failed to update lead status:",Te),mt.error("Email sent, but failed to update lead status")}},[e,t,l]),fo=h.useCallback(async(ae,Te=null)=>{try{T(!0);const Ve=mt.loading(`Adding ${ae.company}${Te?` (${Te.first_name||Te.name})`:""} to CRM...`),gt=await ar.addLeadToCRM(ae.id,(Te==null?void 0:Te.personnel_id)||null);mt.dismiss(Ve),gt.success?(gt.already_exists?mt.success(` ${ae.company} already exists in CRM (Customer ID: ${gt.crm_customer_id})`,{duration:4e3}):mt.success(` Successfully added ${ae.company} to CRM! (Customer ID: ${gt.crm_customer_id})`,{duration:4e3}),c(ae.id),(D==null?void 0:D.id)===ae.id&&(A(null),L(!1))):mt.error(` Failed to add to CRM: ${gt.message}`,{duration:6e3})}catch(Ve){mt.error(` Error adding to CRM: ${Ve.message}`,{duration:6e3})}finally{T(!1)}},[c,D]);return r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("div",{className:"px-4 pt-4 pb-2 bg-white",children:r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("div",{className:"flex items-center gap-3",children:r.jsxs("div",{className:"relative",ref:te,children:[r.jsxs("button",{onClick:()=>be(!pt),disabled:n||E,className:"inline-flex items-center justify-center focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none active:scale-95 font-manrope h-10 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Add Leads",tabIndex:"0",children:[r.jsx(Wt,{className:"w-4 h-4 mr-2"}),"Add Leads",r.jsx(Xt,{className:`w-4 h-4 ml-1 transition-transform ${pt?"rotate-180":""}`})]}),pt&&r.jsx("div",{className:"absolute top-full left-0 mt-2 w-56 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:r.jsxs("div",{className:"py-1",children:[r.jsxs("button",{onClick:()=>{xe(),be(!1)},disabled:Ke,className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(kt,{className:"w-4 h-4"}),r.jsx("span",{className:"font-medium",children:"Add Lead"})]}),r.jsxs("button",{onClick:()=>{U(!0),be(!1)},className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors",children:[r.jsx(vs,{className:"w-4 h-4"}),r.jsx("span",{className:"font-medium",children:"Import CSV"})]})]})})]})}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(jx,{value:x,onChange:v,onClear:()=>v(""),searchColumns:b,onColumnChange:w,availableColumns:[{key:"company",label:"Company",icon:qt},{key:"name",label:"Name",icon:_t},{key:"email",label:"Email",icon:Dt},{key:"phone",label:"Phone",icon:sn},{key:"location",label:"Location",icon:vn}],placeholder:"Search leads..."}),r.jsx(wx,{columns:[{id:"company",label:"Company",type:"text"},{id:"location",label:"Location",type:"text"},{id:"industry",label:"Industry",type:"text"},{id:"email",label:"Email",type:"email"},{id:"phone",label:"Phone",type:"tel"},{id:"website",label:"Website",type:"text"},{id:"status",label:"Status",type:"select",options:ot.map(ae=>({value:ae.value,label:ae.label}))}],onApplyFilters:ye,activeFilters:ne}),r.jsxs("div",{className:"relative",ref:we,children:[r.jsx("button",{onClick:()=>ee(!ze),className:"inline-flex items-center justify-center font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none active:scale-95 font-inter text-xs h-8 w-8 p-0 rounded-lg transition-all duration-200 text-gray-500 hover:bg-blue-50 hover:text-blue-600 active:bg-blue-100",title:"More options","aria-label":"More Options",tabIndex:"0",children:r.jsx(nx,{className:"w-5 h-5"})}),ze&&r.jsx("div",{className:"absolute top-full right-0 mt-2 w-64 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-[500px] overflow-y-auto",children:r.jsxs("div",{className:"py-1",children:[r.jsxs("button",{onClick:()=>{Fe(),ee(!1)},disabled:ce||q,className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-pink-50 hover:text-pink-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(Dt,{className:"w-4 h-4"}),r.jsx("span",{className:"font-medium",children:ce?"Checking Replies...":"Check All Replies"})]}),r.jsxs("button",{onClick:()=>{i(!0),ee(!1)},disabled:n||E,className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(Be,{className:`w-4 h-4 ${n?"animate-spin":""}`}),r.jsx("span",{className:"font-medium",children:n?"Refreshing...":"Refresh Data"})]}),r.jsx("div",{className:"border-t border-gray-200 my-1"}),r.jsxs("div",{className:"px-4 py-2",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-xs font-semibold text-gray-500 uppercase",children:"Select Columns"}),r.jsxs("span",{className:"text-xs text-gray-500",children:[Object.values(Ee).filter(Boolean).length,"/",Object.values(pe).length]})]}),r.jsx("div",{className:"space-y-1",children:Object.values(pe).map(ae=>{const Te=ae.icon;return r.jsxs("label",{className:`flex items-center gap-2 px-2 py-1.5 rounded transition-colors ${ae.disabled?"cursor-not-allowed opacity-60":"hover:bg-blue-50 cursor-pointer"}`,children:[r.jsx("input",{type:"checkbox",checked:Ee[ae.id]!==!1,onChange:()=>{ae.disabled||nt(ae.id,!Ee[ae.id])},disabled:ae.disabled,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),Te&&r.jsx(Te,{className:"w-4 h-4 text-gray-500"}),r.jsxs("span",{className:"text-sm text-gray-700 flex-1",children:[ae.label,ae.disabled&&r.jsx("span",{className:"text-xs text-gray-400 ml-1",children:"(Required)"})]})]},ae.id)})})]})]})})]})]})]})}),(q||u)&&r.jsxs("div",{className:"mx-2 mt-2 bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-center gap-3",children:[r.jsx(Ct,{className:"w-4 h-4 animate-spin text-blue-600 flex-shrink-0"}),r.jsx("span",{className:"text-sm text-blue-700",children:u?"Background sync: Checking email replies...":`Syncing email replies from ${Pe||"email"}...`})]}),ue&&ue.new_replies_processed>0&&r.jsx("div",{className:"mx-2 mt-2 bg-green-50 border border-green-200 rounded-lg p-3",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Xr,{className:"w-4 h-4 text-green-600 flex-shrink-0"}),r.jsxs("span",{className:"text-sm text-green-700",children:[r.jsx("strong",{children:"Sync complete!"})," Loaded ",ue.new_replies_processed," new ",ue.new_replies_processed===1?"reply":"replies"," from ",ue.leads_processed," ",ue.leads_processed===1?"lead":"leads",ue.leads_status_updated>0&&r.jsxs(r.Fragment,{children:["  ",r.jsxs("strong",{className:"text-green-800",children:[ue.leads_status_updated," ",ue.leads_status_updated===1?"lead":"leads"," qualified!"]})]})]})]})}),r.jsx("div",{ref:X,className:"flex-1 min-h-0 overflow-auto px-2 pt-0 pb-2",children:s||n&&!a?r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Ct,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600",children:s?"Authenticating...":"Loading leads..."})]})}):r.jsxs("div",{className:"space-y-4",children:[Y.length>0&&r.jsx("div",{className:"bg-white rounded-lg shadow-sm border mb-6 overflow-hidden",children:r.jsx("div",{className:"h-full min-w-max overflow-auto",children:r.jsxs("table",{className:"w-full min-w-max",style:{tableLayout:"fixed"},children:[r.jsx("thead",{className:"bg-gray-50 border-b",children:r.jsxs("tr",{children:[Ee.company&&r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/5",children:r.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-gray-700",onClick:()=>Ne("company"),children:[r.jsx(qt,{className:"w-4 h-4"}),r.jsx("span",{children:"Company"}),j==="company"?S==="asc"?r.jsx(Ar,{className:"w-3 h-3 text-blue-600"}):r.jsx(Gr,{className:"w-3 h-3 text-blue-600"}):r.jsx(rn,{className:"w-3 h-3 text-gray-400"})]})}),Ee.location&&r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-gray-700",onClick:()=>Ne("location"),children:[r.jsx(vn,{className:"w-4 h-4"}),r.jsx("span",{children:"Location"}),j==="location"?S==="asc"?r.jsx(Ar,{className:"w-3 h-3 text-blue-600"}):r.jsx(Gr,{className:"w-3 h-3 text-blue-600"}):r.jsx(rn,{className:"w-3 h-3 text-gray-400"})]})}),Ee.industry&&r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/6",children:r.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-gray-700",onClick:()=>Ne("industry"),children:[r.jsx(_n,{className:"w-4 h-4"}),r.jsx("span",{children:"Industry"}),j==="industry"?S==="asc"?r.jsx(Ar,{className:"w-3 h-3 text-blue-600"}):r.jsx(Gr,{className:"w-3 h-3 text-blue-600"}):r.jsx(rn,{className:"w-3 h-3 text-gray-400"})]})}),Ee.email&&r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/5",children:r.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-gray-700",onClick:()=>Ne("email"),children:[r.jsx(Dt,{className:"w-4 h-4"}),r.jsx("span",{children:"Email"}),j==="email"?S==="asc"?r.jsx(Ar,{className:"w-3 h-3 text-blue-600"}):r.jsx(Gr,{className:"w-3 h-3 text-blue-600"}):r.jsx(rn,{className:"w-3 h-3 text-gray-400"})]})}),Ee.phone&&r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-gray-700",onClick:()=>Ne("phone"),children:[r.jsx(sn,{className:"w-4 h-4"}),r.jsx("span",{children:"Phone"}),j==="phone"?S==="asc"?r.jsx(Ar,{className:"w-3 h-3 text-blue-600"}):r.jsx(Gr,{className:"w-3 h-3 text-blue-600"}):r.jsx(rn,{className:"w-3 h-3 text-gray-400"})]})}),Ee.website&&r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/6",children:r.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-gray-700",onClick:()=>Ne("website"),children:[r.jsx(ni,{className:"w-4 h-4"}),r.jsx("span",{children:"Website"}),j==="website"?S==="asc"?r.jsx(Ar,{className:"w-3 h-3 text-blue-600"}):r.jsx(Gr,{className:"w-3 h-3 text-blue-600"}):r.jsx(rn,{className:"w-3 h-3 text-gray-400"})]})}),Ee.status&&r.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:r.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-gray-700",onClick:()=>Ne("status"),children:[r.jsx(Bn,{className:"w-4 h-4"}),r.jsx("span",{children:"Status"}),j==="status"?S==="asc"?r.jsx(Ar,{className:"w-3 h-3 text-blue-600"}):r.jsx(Gr,{className:"w-3 h-3 text-blue-600"}):r.jsx(rn,{className:"w-3 h-3 text-gray-400"})]})}),r.jsx("th",{className:"px-2 py-3 text-right w-24 text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsxs("div",{className:"flex items-center justify-end gap-2",children:[r.jsx(ys,{className:"w-4 h-4"}),r.jsx("span",{children:"Actions"})]})})]})}),r.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[$e(),Y.map((ae,Te)=>r.jsxs("tr",{className:`${Te%2===0?"bg-white":"bg-gray-50"} hover:bg-blue-50 transition-colors cursor-pointer`,onClick:Ve=>Yt(ae,Ve),children:[Ee.company&&r.jsx("td",{className:"px-6 py-3",style:{maxWidth:"380px"},children:r.jsx("div",{className:"flex items-center min-w-0",children:r.jsx("div",{className:"min-w-0 flex-1 overflow-hidden",children:r.jsx("div",{className:"truncate",title:ae.company,children:r.jsx("span",{className:"text-gray-900",children:ae.company})})})})}),Ee.location&&r.jsx("td",{className:"px-4 py-3",style:{maxWidth:"200px"},children:r.jsx("div",{className:"truncate",title:ae.location,children:r.jsx("span",{className:"text-gray-900",children:ae.location||"-"})})}),Ee.industry&&r.jsx("td",{className:"px-4 py-3",style:{maxWidth:"150px"},children:r.jsx("div",{className:"truncate",title:ae.industry,children:r.jsx("span",{className:"text-gray-900",children:ae.industry||"-"})})}),Ee.email&&r.jsx("td",{className:"px-6 py-3",style:{maxWidth:"250px"},children:r.jsx("div",{className:"truncate",title:ae.email,children:r.jsx("span",{className:"text-gray-900",children:ae.email||"-"})})}),Ee.phone&&r.jsx("td",{className:"px-6 py-3",style:{maxWidth:"150px"},children:r.jsx("div",{className:"truncate",title:ae.phone,children:r.jsx("span",{className:"text-gray-900",children:ae.phone||"-"})})}),Ee.website&&r.jsx("td",{className:"px-6 py-3",style:{maxWidth:"200px"},children:r.jsx("div",{className:"truncate",title:ae.website,children:ae.website?r.jsx("a",{href:ae.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 hover:underline",onClick:Ve=>Ve.stopPropagation(),children:ae.website}):r.jsx("span",{className:"text-gray-900",children:"-"})})}),Ee.status&&r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",style:{maxWidth:"120px"},children:r.jsxs("div",{className:"relative",children:[r.jsxs("button",{onClick:Ve=>{Ve.stopPropagation(),z(I===ae.id?null:ae.id)},className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${fe(ae.status).color} hover:opacity-80 transition-opacity`,children:[fe(ae.status).label,r.jsx(Xt,{className:"w-3 h-3 ml-1"})]}),I===ae.id&&r.jsx("div",{className:"absolute top-full left-0 mt-1 w-36 bg-white border border-gray-200 rounded-md shadow-lg z-50 max-h-48 overflow-y-auto",children:ot.map(Ve=>r.jsx("button",{onClick:gt=>{gt.stopPropagation(),_e(ae.id,Ve.value)},className:"w-full text-left px-3 py-2 text-xs hover:bg-gray-50 border-b border-gray-100 last:border-b-0 block",children:r.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${Ve.color}`,children:Ve.label})},Ve.value))})]})}),r.jsx("td",{className:"px-2 py-3 text-right",children:r.jsx("button",{onClick:Ve=>{Ve.stopPropagation(),Nt(ae)},className:"text-red-500 hover:text-red-700 hover:bg-red-50 p-1 rounded transition-colors",title:`Delete ${ae.company}`,children:r.jsx(fr,{className:"w-4 h-4"})})})]},ae.id))]})]})})}),me.length>0&&r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:[r.jsx("div",{className:"px-4 pt-2 bg-purple-50 border-b border-purple-200 rounded-t-lg",children:r.jsxs("h3",{className:"text-sm font-semibold text-purple-800 flex items-center gap-2",children:[r.jsx(vs,{className:"w-4 h-4"}),"Manual/Uploaded (",me.length,")"]})}),r.jsx("div",{className:"h-full min-w-max overflow-auto",children:r.jsxs("table",{className:"w-full min-w-max",style:{tableLayout:"fixed"},children:[r.jsx("thead",{className:"bg-gray-50 border-b",children:r.jsxs("tr",{children:[Ee.company&&r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/5",children:r.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-gray-700",onClick:()=>Ne("company"),children:[r.jsx(qt,{className:"w-4 h-4"}),r.jsx("span",{children:"Company"}),j==="company"?S==="asc"?r.jsx(Ar,{className:"w-3 h-3 text-blue-600"}):r.jsx(Gr,{className:"w-3 h-3 text-blue-600"}):r.jsx(rn,{className:"w-3 h-3 text-gray-400"})]})}),Ee.location&&r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-gray-700",onClick:()=>Ne("location"),children:[r.jsx(vn,{className:"w-4 h-4"}),r.jsx("span",{children:"Location"}),j==="location"?S==="asc"?r.jsx(Ar,{className:"w-3 h-3 text-blue-600"}):r.jsx(Gr,{className:"w-3 h-3 text-blue-600"}):r.jsx(rn,{className:"w-3 h-3 text-gray-400"})]})}),Ee.industry&&r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/6",children:r.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-gray-700",onClick:()=>Ne("industry"),children:[r.jsx(_n,{className:"w-4 h-4"}),r.jsx("span",{children:"Industry"}),j==="industry"?S==="asc"?r.jsx(Ar,{className:"w-3 h-3 text-blue-600"}):r.jsx(Gr,{className:"w-3 h-3 text-blue-600"}):r.jsx(rn,{className:"w-3 h-3 text-gray-400"})]})}),Ee.email&&r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/5",children:r.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-gray-700",onClick:()=>Ne("email"),children:[r.jsx(Dt,{className:"w-4 h-4"}),r.jsx("span",{children:"Email"}),j==="email"?S==="asc"?r.jsx(Ar,{className:"w-3 h-3 text-blue-600"}):r.jsx(Gr,{className:"w-3 h-3 text-blue-600"}):r.jsx(rn,{className:"w-3 h-3 text-gray-400"})]})}),Ee.phone&&r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-gray-700",onClick:()=>Ne("phone"),children:[r.jsx(sn,{className:"w-4 h-4"}),r.jsx("span",{children:"Phone"}),j==="phone"?S==="asc"?r.jsx(Ar,{className:"w-3 h-3 text-blue-600"}):r.jsx(Gr,{className:"w-3 h-3 text-blue-600"}):r.jsx(rn,{className:"w-3 h-3 text-gray-400"})]})}),Ee.website&&r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/6",children:r.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-gray-700",onClick:()=>Ne("website"),children:[r.jsx(ni,{className:"w-4 h-4"}),r.jsx("span",{children:"Website"}),j==="website"?S==="asc"?r.jsx(Ar,{className:"w-3 h-3 text-blue-600"}):r.jsx(Gr,{className:"w-3 h-3 text-blue-600"}):r.jsx(rn,{className:"w-3 h-3 text-gray-400"})]})}),Ee.status&&r.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:r.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-gray-700",onClick:()=>Ne("status"),children:[r.jsx(Bn,{className:"w-4 h-4"}),r.jsx("span",{children:"Status"}),j==="status"?S==="asc"?r.jsx(Ar,{className:"w-3 h-3 text-blue-600"}):r.jsx(Gr,{className:"w-3 h-3 text-blue-600"}):r.jsx(rn,{className:"w-3 h-3 text-gray-400"})]})}),r.jsx("th",{className:"px-2 py-3 text-right w-24 text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsxs("div",{className:"flex items-center justify-end gap-2",children:[r.jsx(ys,{className:"w-4 h-4"}),r.jsx("span",{children:"Actions"})]})})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:me.map((ae,Te)=>r.jsxs("tr",{className:`${Te%2===0?"bg-white":"bg-gray-50"} hover:bg-blue-50 transition-colors cursor-pointer`,onClick:Ve=>Yt(ae,Ve),children:[Ee.company&&r.jsx("td",{className:"px-6 py-3",style:{maxWidth:"380px"},children:r.jsx("div",{className:"flex items-center min-w-0",children:r.jsx("div",{className:"min-w-0 flex-1 overflow-hidden",children:r.jsx("div",{className:"truncate",title:ae.company,children:r.jsx("span",{className:"text-gray-900",children:ae.company})})})})}),Ee.location&&r.jsx("td",{className:"px-4 py-3",style:{maxWidth:"200px"},children:r.jsx("div",{className:"truncate",title:ae.location,children:r.jsx("span",{className:"text-gray-900",children:ae.location||"-"})})}),Ee.industry&&r.jsx("td",{className:"px-6 py-3",style:{maxWidth:"150px"},children:r.jsx("div",{className:"truncate",title:ae.industry,children:r.jsx("span",{className:"text-gray-900",children:ae.industry||"-"})})}),Ee.email&&r.jsx("td",{className:"px-6 py-3",style:{maxWidth:"250px"},children:r.jsx("div",{className:"truncate",title:ae.email,children:r.jsx("span",{className:"text-gray-900",children:ae.email||"-"})})}),Ee.phone&&r.jsx("td",{className:"px-4 py-3",style:{maxWidth:"150px"},children:r.jsx("div",{className:"truncate",title:ae.phone,children:r.jsx("span",{className:"text-gray-900",children:ae.phone||"-"})})}),Ee.website&&r.jsx("td",{className:"px-6 py-3",style:{maxWidth:"200px"},children:r.jsx("div",{className:"truncate",title:ae.website,children:ae.website?r.jsx("a",{href:ae.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 hover:underline",onClick:Ve=>Ve.stopPropagation(),children:ae.website}):r.jsx("span",{className:"text-gray-900",children:"-"})})}),Ee.status&&r.jsx("td",{className:"px-2 py-3 whitespace-nowrap",style:{maxWidth:"120px"},children:r.jsxs("div",{className:"relative",children:[r.jsxs("button",{onClick:Ve=>{Ve.stopPropagation(),z(I===ae.id?null:ae.id)},className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${fe(ae.status).color} hover:opacity-80 transition-opacity`,children:[fe(ae.status).label,r.jsx(Xt,{className:"w-3 h-3 ml-1"})]}),I===ae.id&&r.jsx("div",{className:"absolute top-full left-0 mt-1 w-36 bg-white border border-gray-200 rounded-md shadow-lg z-50 max-h-48 overflow-y-auto",children:ot.map(Ve=>r.jsx("button",{onClick:gt=>{gt.stopPropagation(),_e(ae.id,Ve.value)},className:"w-full text-left px-3 py-2 text-xs hover:bg-gray-50 border-b border-gray-100 last:border-b-0 block",children:r.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${Ve.color}`,children:Ve.label})},Ve.value))})]})}),r.jsx("td",{className:"px-2 py-3 text-right",children:r.jsx("button",{onClick:Ve=>{Ve.stopPropagation(),Nt(ae)},className:"text-red-500 hover:text-red-700 hover:bg-red-50 p-1 rounded transition-colors",title:`Delete ${ae.company}`,children:r.jsx(fr,{className:"w-4 h-4"})})})]},ae.id))})]})})]}),Y.length===0&&me.length===0&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(kt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No leads found"}),r.jsx("p",{className:"text-gray-600 mb-4",children:x||y!=="all"||j!=="company"||S!=="asc"?"No leads match your current filters and sorting.":'No leads available. Use the "Generating New Leads" tab to get started.'}),(x||y!=="all"||j!=="company"||S!=="asc")&&r.jsx(H,{variant:"outline",onClick:()=>{v(""),g("all"),_("company"),C("asc")},children:"Clear Filters & Reset Sorting"})]})]})}),r.jsx(d3,{isOpen:M,onClose:()=>L(!1),selectedLead:D,modalActiveTab:F,setModalActiveTab:O,aiSuggestions:D?B[D.id]:null,isLoadingAiSuggestions:re,aiSuggestionsError:D?he[D.id]:null,loadCachedAiSuggestions:ft,regenerateAiSuggestions:Ds,handleAddToCRM:fo,handleEmailSent:Ni}),I&&r.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>z(null)}),r.jsx($k,{isOpen:K,onClose:rr,onConfirm:Ft,title:"Delete Lead",message:`Are you sure you want to delete "${(se==null?void 0:se.company)||"this lead"}"?`,details:se?`Location: ${se.location||"Unknown"} | Industry: ${se.industry||"Unknown"}`:"",confirmText:"Delete Lead",cancelText:"Cancel",type:"danger",isLoading:oe}),r.jsx(u3,{isOpen:P,onClose:()=>$(!1)}),r.jsx(p3,{isOpen:R,onClose:()=>U(!1)})]})},Ki=h.forwardRef(({className:e,...t},n)=>r.jsx("textarea",{className:tr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...t}));Ki.displayName="Textarea";const g3=cA("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function an({className:e,variant:t,...n}){return r.jsx("div",{className:tr(g3({variant:t}),e),...n})}const ps=h.forwardRef(({className:e,...t},n)=>r.jsx("label",{ref:n,className:tr("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e),...t}));ps.displayName="Label";const x3=({onComplete:e,initialQuery:t=""})=>{const[n,s]=h.useState(t),[a,i]=h.useState(!1);h.useEffect(()=>{try{const d=sessionStorage.getItem("leadgen_workflow_cache"),u=d?JSON.parse(d):{},m={query:n,parsedIntent:u.parsedIntent||null,numberOfLeads:u.numberOfLeads||10,previewResults:u.previewResults||[],selectedCompanies:u.selectedCompanies||[],enrichedResults:u.enrichedResults||null,selectedLeads:u.selectedLeads||[]};sessionStorage.setItem("leadgen_workflow_cache",JSON.stringify(m))}catch(d){console.error("Error saving query to cache:",d)}},[n]);const l=["Forklift dealers in Cleveland, Ohio","Solar panels in California","Commercial HVAC in Texas"],o=h.useCallback(d=>{s(d)},[]),c=h.useCallback(async d=>{if(d.preventDefault(),!n.trim()){mt.error("Please enter a description of your ideal leads");return}i(!0);try{const u=await ar.aiParsePrompt(n.trim());u.status==="success"&&u.intent?(mt.success("Query understood! Proceeding to next step..."),e(n,u.intent)):mt.error(u.error||"Failed to understand query. Please try rephrasing.")}catch(u){console.error("Error parsing query:",u),mt.error("Failed to process query. Please try again.")}finally{i(!1)}},[n,e]);return r.jsxs("div",{className:"max-w-2xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-indigo-100 rounded-full mb-4",children:r.jsx(Mr,{className:"text-indigo-600",size:32})}),r.jsx("h2",{className:"text-2xl font-bold text-indigo-900 mb-2",children:"What leads do you want?"}),r.jsx("p",{className:"text-gray-600",children:"Describe the type of leads you're looking for, including location and industry"})]}),r.jsxs("form",{onSubmit:c,className:"space-y-6",children:[r.jsx("div",{className:"space-y-2",children:r.jsxs("div",{className:"relative",children:[r.jsx(Ki,{id:"query",value:n,onChange:d=>s(d.target.value),placeholder:"e.g., Forklift dealers in Cleveland, Ohio",className:"min-h-[120px] pr-16 resize-none text-base bg-gray-100 border-2 border-transparent focus:border-gray-300 transition-colors placeholder:text-gray-500",disabled:a}),r.jsx(H,{type:"submit",size:"icon",disabled:!n.trim()||a,className:"absolute bottom-3 right-3 bg-black hover:bg-gray-800 text-white",children:a?r.jsx(Be,{className:"w-4 h-4 animate-spin"}):r.jsx(to,{size:18})})]})}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-2",children:[r.jsx(bc,{className:"w-4 h-4"}),"Try these examples:"]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:l.map((d,u)=>r.jsx("button",{type:"button",onClick:()=>o(d),disabled:a,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm text-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d},u))})]})]})]})},y3=({query:e,parsedIntent:t,initialNumberOfLeads:n=10,onComplete:s,onBack:a})=>{const[i,l]=h.useState(()=>{try{const g=sessionStorage.getItem("leadgen_workflow_cache");if(g)return!JSON.parse(g).parsedIntent}catch(g){console.error("Error checking cache:",g)}return!0}),[o,c]=h.useState(n),[d,u]=h.useState(new Set),[m,p]=h.useState([]);h.useEffect(()=>{if(t!=null&&t.keywords){try{const g=sessionStorage.getItem("leadgen_workflow_cache");if(g){const x=JSON.parse(g);if(x.originalKeywords&&x.selectedKeywords){p(x.originalKeywords),u(new Set(x.selectedKeywords));return}}}catch(g){console.error("Error reading keyword cache:",g)}p(t.keywords),u(new Set(t.keywords))}},[t]),h.useEffect(()=>{try{const g=sessionStorage.getItem("leadgen_workflow_cache"),x=g?JSON.parse(g):{},b={query:x.query||"",parsedIntent:x.parsedIntent||null,numberOfLeads:o,previewResults:x.previewResults||[],selectedCompanies:x.selectedCompanies||[],enrichedResults:x.enrichedResults||null,selectedLeads:x.selectedLeads||[]};sessionStorage.setItem("leadgen_workflow_cache",JSON.stringify(b))}catch(g){console.error("Error saving numberOfLeads to cache:",g)}},[o]),h.useEffect(()=>{if(i){const g=setTimeout(()=>{l(!1)},800);return()=>clearTimeout(g)}},[]);const f=g=>{const x=new Set(d);x.has(g)?x.delete(g):x.add(g),u(x);try{const b=sessionStorage.getItem("leadgen_workflow_cache"),v=b?JSON.parse(b):{};v.originalKeywords=m,v.selectedKeywords=Array.from(x),sessionStorage.setItem("leadgen_workflow_cache",JSON.stringify(v))}catch(b){console.error("Error saving keyword selection:",b)}},y=()=>{const g={...t,keywords:Array.from(d)};try{const x=sessionStorage.getItem("leadgen_workflow_cache"),b=x?JSON.parse(x):{};b.parsedIntent=g,b.numberOfLeads=o,b.originalKeywords=m,b.selectedKeywords=Array.from(d),sessionStorage.setItem("leadgen_workflow_cache",JSON.stringify(b))}catch(x){console.error("Error saving to cache:",x)}s(o,g)};return r.jsxs("div",{className:"max-w-3xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-indigo-100 rounded-full mb-4",children:r.jsx(Er,{className:"text-indigo-600",size:32})}),r.jsx("h2",{className:"text-2xl font-bold text-indigo-900 mb-2",children:"Refine Search"}),r.jsxs("p",{className:"text-gray-600",children:['Based on your search for "',r.jsx("span",{className:"text-indigo-600 font-medium",children:e}),'"']})]}),i?r.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[r.jsx(Ct,{className:"animate-spin text-indigo-600 mb-4",size:48}),r.jsx("p",{className:"text-gray-600",children:"AI is analyzing your query..."})]}):r.jsxs("div",{className:"space-y-8",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsx(ps,{children:"Select industries that would use this lead:"}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:m&&m.length>0?m.map((g,x)=>{const b=d.has(g);return r.jsx("button",{onClick:()=>f(g),className:`p-4 rounded-lg border-2 transition-all ${b?"border-indigo-600 bg-indigo-50":"border-gray-300 bg-gray-50"}`,children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-gray-900",children:g}),b&&r.jsx(Xr,{className:"text-indigo-600",size:20})]})},x)}):r.jsx("div",{className:"col-span-3 text-center text-gray-400 py-8",children:"No keywords extracted"})})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(ps,{htmlFor:"numberOfLeads",className:"text-sm font-medium text-gray-700",children:"Number of leads to generate:"}),r.jsx(gs,{id:"numberOfLeads",type:"number",min:"1",max:"300",value:o,onChange:g=>c(Number(g.target.value)),className:"max-w-xs"})]}),r.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t",children:[r.jsx(H,{variant:"outline",onClick:a,className:"border-gray-300",children:"Back"}),r.jsx(H,{onClick:y,className:"bg-black hover:bg-gray-800 text-white",children:"Continue"})]})]})]})},Vd=h.forwardRef(({className:e,checked:t,onCheckedChange:n,...s},a)=>r.jsxs("div",{className:"relative",children:[r.jsx("input",{ref:a,type:"checkbox",checked:t,onChange:i=>n==null?void 0:n(i.target.checked),className:"sr-only",...s}),r.jsx("div",{className:tr("peer h-4 w-4 shrink-0 rounded-sm border border-gray-300 bg-white cursor-pointer transition-colors","hover:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50",t&&"bg-blue-600 border-blue-600 text-white",e),onClick:()=>n==null?void 0:n(!t),children:t&&r.jsx("div",{className:"flex items-center justify-center text-current",children:r.jsx(Xr,{className:"h-3 w-3"})})})]}));Vd.displayName="Checkbox";const b3=({query:e,parsedIntent:t,numberOfLeads:n,onComplete:s,onBack:a})=>{const[i,l]=h.useState(!0),[o,c]=h.useState([]),[d,u]=h.useState(new Set),[m,p]=h.useState(null),[f,y]=h.useState(!1);h.useEffect(()=>{if(f){console.log(" Skipping fetch - data already loaded");return}(async()=>{var w;await new Promise(N=>setTimeout(N,10));try{const N=sessionStorage.getItem("leadgen_workflow_cache");if(console.log(" Checking cache for preview results..."),N){const k=JSON.parse(N);if(console.log(" Cache check:",{hasPreviewResults:!!k.previewResults,previewResultsLength:((w=k.previewResults)==null?void 0:w.length)||0,clearTimestamp:k._clearTimestamp,isArray:Array.isArray(k.previewResults),rawValue:k.previewResults}),k.previewResults&&k.previewResults.length>0){console.log(" Using cached preview results:",k.previewResults.length,"companies"),c(k.previewResults),k.selectedCompanies&&Array.isArray(k.selectedCompanies)&&u(new Set(k.selectedCompanies)),l(!1),y(!0);return}else console.log(" Cache exists but preview results empty or missing")}else console.log(" No cache found")}catch(N){console.error("Error reading cache:",N)}console.log(" Fetching fresh data from API..."),l(!0),p(null);try{console.log(" Fetching preview leads:",{industry:t==null?void 0:t.industry,location:t==null?void 0:t.location,maxResults:n,companySize:t==null?void 0:t.company_size,keywords:t==null?void 0:t.keywords});const N=await ar.previewLeads({industry:t==null?void 0:t.industry,location:t==null?void 0:t.location,maxResults:n,companySize:t==null?void 0:t.company_size,keywords:t==null?void 0:t.keywords});console.log(" Preview results received:",N);const k=N.companies||N.leads||[];c(k),y(!0);try{const j=sessionStorage.getItem("leadgen_workflow_cache"),S=j?JSON.parse(j):{};S.previewResults=k,sessionStorage.setItem("leadgen_workflow_cache",JSON.stringify(S)),console.log(" Saved preview results to cache:",k.length,"companies")}catch(j){console.error("Error saving to cache:",j)}k.length===0?mt("No new companies found matching your criteria",{icon:""}):mt.success(`Found ${k.length} companies`)}catch(N){console.error(" Preview failed:",N),p(N.message||"Failed to fetch companies"),mt.error(N.message||"Preview search failed")}finally{l(!1)}})()},[t,n,f]);const g=h.useCallback(()=>{const v=o.map(N=>N.place_id||N.id||N.company_name),w=new Set(v);u(w);try{const N=sessionStorage.getItem("leadgen_workflow_cache"),k=N?JSON.parse(N):{};k.selectedCompanies=Array.from(w),sessionStorage.setItem("leadgen_workflow_cache",JSON.stringify(k))}catch(N){console.error("Error saving selection to cache:",N)}},[o]),x=h.useCallback(()=>{u(new Set);try{const v=sessionStorage.getItem("leadgen_workflow_cache"),w=v?JSON.parse(v):{};w.selectedCompanies=[],sessionStorage.setItem("leadgen_workflow_cache",JSON.stringify(w))}catch(v){console.error("Error saving selection to cache:",v)}},[]),b=h.useCallback(()=>{if(d.size===0){mt.error("Please select at least one company to continue");return}s(o,d)},[o,d,s]);return r.jsxs("div",{className:"max-w-6xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-indigo-100 rounded-full mb-4",children:r.jsx(zn,{className:"text-indigo-600",size:32})}),r.jsx("h2",{className:"text-2xl font-bold text-indigo-900 mb-2",children:"Choose Companies"}),r.jsx("p",{className:"text-gray-600",children:"Select the companies you'd like to enrich with contact information"})]}),i&&r.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[r.jsx(Ct,{className:"animate-spin text-indigo-600 mb-4",size:48}),r.jsx("p",{className:"text-gray-600",children:"Searching for companies..."}),r.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"This may take a moment"})]}),!i&&m&&r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(dt,{className:"w-6 h-6 text-red-600 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-1",children:"Search Failed"}),r.jsx("p",{className:"text-red-800 mb-4",children:m}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(H,{onClick:a,variant:"outline",children:"Go Back"}),r.jsx(H,{onClick:()=>window.location.reload(),children:"Try Again"})]})]})]})}),!i&&!m&&r.jsxs("div",{className:"space-y-6",children:[o.length>0&&r.jsx("div",{className:"bg-indigo-50 rounded-lg pt-4 pb-1 px-4",children:r.jsxs("p",{className:"text-sm text-indigo-900",children:["Found ",r.jsx("strong",{children:o.length})," companies matching your criteria"]})}),o.length>0&&r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("p",{className:"text-sm text-gray-600",children:[d.size," of ",o.length," selected"]}),r.jsx("button",{onClick:d.size===o.length?x:g,className:"px-4 py-2 text-sm font-medium text-indigo-700 hover:text-indigo-900 hover:bg-indigo-50 rounded-md transition-colors",children:d.size===o.length?"Deselect All":"Select All"})]}),r.jsx("div",{className:"space-y-3 max-h-[500px] overflow-y-auto pr-2",children:o.map((v,w)=>{const N=v.place_id||v.id||w,k=d.has(N);return r.jsx("button",{onClick:()=>{const j=new Set(d);k?j.delete(N):j.add(N),u(j);try{const S=sessionStorage.getItem("leadgen_workflow_cache"),_=S?JSON.parse(S):{};_.selectedCompanies=Array.from(j),sessionStorage.setItem("leadgen_workflow_cache",JSON.stringify(_))}catch(S){console.error("Error saving selection to cache:",S)}},className:`w-full p-4 rounded-lg border-2 transition-all text-left ${k?"border-indigo-600 bg-indigo-50":"border-gray-200 hover:border-gray-300"}`,children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx(_n,{className:"text-indigo-600",size:20}),r.jsx("h3",{className:"text-gray-900 font-medium",children:v.name||v.company_name||"Unknown Company"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-2 ml-8 text-sm text-gray-600",children:[v.industry&&r.jsxs("div",{children:["Industry: ",v.industry]}),v.employee_count&&r.jsxs("div",{children:["Employees: ",v.employee_count]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(vn,{size:14}),v.location||v.address||"N/A"]}),v.website&&r.jsx("div",{children:v.website})]})]}),k&&r.jsx("div",{className:"ml-4",children:r.jsx("div",{className:"w-6 h-6 bg-indigo-600 rounded flex items-center justify-center",children:r.jsx(Xr,{className:"text-white",size:16})})})]})},N)})}),r.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[r.jsx(H,{variant:"outline",onClick:a,className:"border-gray-300",children:"Back"}),r.jsx(H,{onClick:b,disabled:d.size===0,className:"bg-black hover:bg-gray-800 text-white",children:"Continue"})]})]})]})},v3=({previewResults:e,selectedCompanies:t,onComplete:n,onBack:s,onReset:a})=>{const{loadLeads:i}=gc(),l=j=>j?j.toLowerCase().trim().replace(/[-\s]+/g,"").replace(/[^\w]/g,""):"",[o,c]=h.useState(!1),[d,u]=h.useState([]),[m,p]=h.useState(!1),[f,y]=h.useState(!1),[g,x]=h.useState(new Set),[b,v]=h.useState(!1),[w,N]=h.useState(!1);h.useEffect(()=>{if(f)return;(async()=>{try{const S=sessionStorage.getItem("leadgen_workflow_cache");if(S){const _=JSON.parse(S);if(_.enrichedResults&&_.enrichedResults.length>0){console.log(" Using cached enrichment results"),u(_.enrichedResults),_.selectedLeads&&Array.isArray(_.selectedLeads)&&x(new Set(_.selectedLeads)),p(!0),c(!1),y(!0);return}}}catch(S){console.error("Error reading cache:",S)}c(!0);try{console.log(" Enriching companies:",Array.from(t));const _=e.filter(E=>{const T=E.place_id||E.apollo_company_id||E.id;return t.has(T)}).map(E=>({...E,source:E.source||"google_maps",company_name:E.name||E.company_name,location:E.location||E.address})),C=await ar.enrichLeads({companyIds:Array.from(t),companies:_});console.log(" Enrichment results:",C),C.failed_count>0?mt.success(`Enriched ${C.total_enriched} companies. ${C.failed_count} failed (no Apollo match).`):mt.success(`Enriched ${C.total_enriched} companies with email contacts`);const D=new Map;C.leads.forEach(E=>{const T=l(E.company_name);if(T&&D.set(T,E),E.original_company_name){const M=l(E.original_company_name);M&&M!==T&&D.set(M,E)}});const A=_.map(E=>{const T=l(E.company_name),M=D.get(T);return M?M.contact_email&&M.contact_email.trim()!==""?{...E,...M,company_name:M.company_name,contact:M.contact_name||"N/A",emails:[M.contact_email],phone:E.phone||null,websites:M.website?[M.website]:E.website?[E.website]:[],final_score:M.final_score||50,is_enriched:!0,enrichment_status:"success"}:{...E,...M,company_name:M.company_name,contact:M.contact_name||"No contact found",emails:[],phone:E.phone||null,websites:M.website?[M.website]:E.website?[E.website]:[],final_score:M.final_score||0,is_enriched:!1,enrichment_status:"failed"}:{...E,contact:"No contact found",emails:[],phone:E.phone||null,websites:E.website?[E.website]:[],final_score:0,is_enriched:!1,enrichment_status:"failed"}});u(A),p(!0),y(!0);try{const E=sessionStorage.getItem("leadgen_workflow_cache"),T=E?JSON.parse(E):{};T.enrichedResults=A,sessionStorage.setItem("leadgen_workflow_cache",JSON.stringify(T)),console.log(" Saved enrichment results to cache:",A.length,"leads")}catch(E){console.error("Error saving enrichment to cache:",E)}n&&n(A)}catch(S){console.error(" Enrichment failed:",S),mt.error(S.message||"Enrichment failed")}finally{c(!1)}})()},[t,e,n,f]);const k=h.useCallback(async()=>{var j,S,_,C,D,A,E,T;if(g.size===0){mt.error("Please select leads to save");return}v(!0);try{const M=Array.from(g).map(R=>d[R]);console.log(" Leads to save:",M.length);let L=0,P=0;const $=[];for(const R of M)try{const U=R.contact_name||R.contact||"",I=U.trim().split(/\s+/),z=I[0]||"Unknown",F=I.slice(1).join(" ")||"",O={company:R.company_name,location:R.location||"",industry:R.industry||"",email:R.contact_email||((j=R.emails)==null?void 0:j[0])||"",phone:R.contact_phone||"",website:R.website||((S=R.websites)==null?void 0:S[0])||"",notes:`AI-generated lead from workflow (Contact: ${U||"Unknown"}) - Score: ${R.final_score}`,source:"api_import",status:"cold",personnel:U?[{first_name:z,last_name:F,company_name:R.company_name,email:R.contact_email||((_=R.emails)==null?void 0:_[0])||null,phone:R.contact_phone||null,position:R.contact_title||null,linkedin_url:R.contact_linkedin||null}]:[]};try{const K=await ar.createLead(O);L++,K&&K.lead_id&&$.push(K.lead_id)}catch(K){if((C=K.message)!=null&&C.includes("duplicate")||(D=K.message)!=null&&D.includes("already exists"))try{const J=await ar.findLeadsByCompany(R.company_name);if(J&&J.length>0&&U){const se=J[0],Z={first_name:z,last_name:F,company_name:R.company_name,email:R.contact_email||((A=R.emails)==null?void 0:A[0])||null,phone:R.contact_phone||null,position:R.contact_title||null,linkedin_url:R.contact_linkedin||null,lead_id:se.lead_id,source:"api_import"};await ar.createPersonnel(Z),L++,$.push(se.lead_id)}else P++}catch(J){(E=J.message)!=null&&E.includes("duplicate")||(T=J.message)!=null&&T.includes("unique_person_company")?L++:P++}else throw K}}catch(U){console.error(` Failed to save lead ${R.company_name}:`,U),P++}$.length>0&&(async()=>{for(const R of $)try{const U=await ar.getCachedAISuggestions(R);(!U||!U.suggestions)&&await ar.regenerateAISuggestions(R)}catch(U){console.error(` Failed to process AI analysis for lead ${R}:`,U)}})(),L>0?(mt.success(`Successfully saved ${L} lead${L>1?"s":""} to database${P>0?` (${P} failed)`:""}`),N(!0),await i(!0),n&&n(d)):mt.error("Failed to save any leads to database")}catch(M){console.error("Error saving leads:",M),mt.error("Failed to save leads to database")}finally{v(!1)}},[d,g,i]);return r.jsxs("div",{className:"max-w-6xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-indigo-100 rounded-full mb-4",children:r.jsx(qn,{className:"text-indigo-600",size:32})}),r.jsx("h2",{className:"text-2xl font-bold text-indigo-900 mb-2",children:w?"Leads Saved Successfully!":"Enrich & Save Leads"}),r.jsx("p",{className:"text-gray-600",children:w?"Your enriched leads have been saved to the database":o?"Gathering contact information and enriching leads":"Review enriched leads and save to database"})]}),w&&r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"bg-green-50 border-2 border-green-200 rounded-lg p-8 text-center",children:[r.jsx(na,{className:"text-green-600 mx-auto mb-4",size:64}),r.jsxs("h3",{className:"text-xl font-bold text-green-900 mb-2",children:[g.size," Lead",g.size!==1?"s":""," Saved"]}),r.jsx("p",{className:"text-green-700",children:"All selected leads have been enriched and saved to your database"})]}),r.jsx("div",{className:"flex justify-center gap-3",children:r.jsx(H,{onClick:a,className:"bg-black hover:bg-gray-800 text-white",children:"Start New Search"})})]}),!w&&o&&r.jsx("div",{className:"space-y-6",children:r.jsxs("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-6 text-center",children:[r.jsx(Ct,{className:"animate-spin text-indigo-600 mx-auto mb-4",size:48}),r.jsxs("p",{className:"text-indigo-900 font-medium",children:["Enriching ",t.size," companies with contact information..."]}),r.jsx("p",{className:"text-sm text-indigo-700 mt-2",children:"This may take a moment"})]})}),!w&&!o&&m&&r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg pt-4 pb-1 px-4",children:r.jsxs("p",{className:"text-sm text-indigo-900",children:["Enriched ",d.filter(j=>j.enrichment_status==="success").length," of ",d.length," companies"]})}),d.length>0&&r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("p",{className:"text-sm text-gray-600",children:[g.size," of ",d.length," selected"]}),r.jsx("button",{onClick:()=>{g.size===d.length?x(new Set):x(new Set(d.map((j,S)=>S)))},className:"px-4 py-2 text-sm font-medium text-indigo-700 hover:text-indigo-900 hover:bg-indigo-50 rounded-md transition-colors",children:g.size===d.length?"Deselect All":"Select All"})]}),r.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto pr-2",children:d.map((j,S)=>({lead:j,originalIndex:S})).sort((j,S)=>{const _=j.lead.enrichment_status==="success",C=S.lead.enrichment_status==="success";return _&&!C?-1:!_&&C?1:0}).map(({lead:j,originalIndex:S})=>{var D,A,E;const _=j.enrichment_status==="success",C=g.has(S);return r.jsxs("button",{onClick:()=>{const T=new Set(g);C?T.delete(S):T.add(S),x(T)},className:`w-full p-4 rounded-lg border-2 transition-all text-left ${C?"border-indigo-600 bg-indigo-50":_?"border-green-200 bg-green-50 hover:border-green-300":"border-gray-200 bg-gray-50 hover:border-gray-300"}`,children:[r.jsxs("div",{className:"flex items-start justify-between mb-3",children:[r.jsx("h4",{className:"text-gray-900 font-medium",children:j.company_name}),C?r.jsx("div",{className:"w-6 h-6 bg-indigo-600 rounded flex items-center justify-center flex-shrink-0",children:r.jsx(Xr,{className:"text-white",size:16})}):_?r.jsx(na,{className:"text-green-600 flex-shrink-0",size:20}):r.jsx(Cr,{className:"text-yellow-600 flex-shrink-0",size:20})]}),_&&r.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[r.jsx(_t,{size:16,className:"text-gray-400"}),j.contact||"N/A"]}),r.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[r.jsx(Dt,{size:16,className:"text-gray-400"}),((D=j.emails)==null?void 0:D[0])||"N/A"]}),r.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[r.jsx(sn,{size:16,className:"text-gray-400"}),j.phone||"N/A"]}),r.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[r.jsx(ni,{size:16,className:"text-gray-400"}),j.website||((A=j.websites)==null?void 0:A[0])||"N/A"]})]}),!_&&r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"No contact information found. Showing company contact instead."}),r.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[r.jsx(_t,{size:16,className:"text-gray-400"}),"N/A"]}),r.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[r.jsx(Dt,{size:16,className:"text-gray-400"}),"N/A"]}),r.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[r.jsx(sn,{size:16,className:"text-gray-400"}),j.phone||"N/A"]}),r.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[r.jsx(ni,{size:16,className:"text-gray-400"}),((E=j.websites)==null?void 0:E[0])||"N/A"]})]})]})]},S)})}),r.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[r.jsx(H,{variant:"outline",onClick:s,disabled:b,className:"border-gray-300",children:"Back"}),r.jsx(H,{onClick:k,disabled:g.size===0||b,className:"bg-black hover:bg-gray-800 text-white",children:b?r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving to Database..."]}):"Save to Database"})]})]})]})},w3=({steps:e,currentStep:t})=>r.jsx("div",{className:"flex items-center justify-between max-w-4xl mx-auto",children:e.map((n,s)=>r.jsxs("div",{className:"flex items-center flex-1",children:[r.jsxs("div",{className:"flex flex-col items-center flex-1",children:[r.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 ${t>=n.number?"bg-indigo-600 text-white":"bg-gray-200 text-gray-500"}`,children:r.jsx("span",{className:"text-lg font-semibold",children:n.number})}),r.jsx("p",{className:`mt-2 text-sm font-medium ${t>=n.number?"text-indigo-900":"text-gray-500"}`,children:n.title})]}),s<e.length-1&&r.jsx(Dn,{className:`mx-4 flex-shrink-0 transition-colors ${t>n.number?"text-indigo-600":"text-gray-300"}`,size:24})]},n.number))}),j3=({open:e,onOpenChange:t,children:n})=>{const[s,a]=h.useState(!1),[i,l]=h.useState(!1);if(h.useEffect(()=>{if(e)a(!0),l(!1),document.body.style.overflow="hidden";else if(s){l(!0);const c=setTimeout(()=>{a(!1),l(!1)},300);return document.body.style.overflow="unset",()=>clearTimeout(c)}return()=>{document.body.style.overflow="unset"}},[e,s]),!s)return null;const o=()=>{i||t(!1)};return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:`fixed inset-0 z-50 bg-black/50 transition-opacity duration-300 ${i?"opacity-0":"opacity-100"}`,onClick:o}),h.Children.map(n,c=>h.cloneElement(c,{isClosing:i}))]})},Fk=h.forwardRef(({side:e="right",className:t,children:n,isClosing:s,...a},i)=>{const[l,o]=h.useState(!0);h.useEffect(()=>{const d=setTimeout(()=>{o(!1)},10);return()=>clearTimeout(d)},[]);const c=()=>e==="right"?s||l?"translate-x-full":"translate-x-0":e==="left"?s||l?"-translate-x-full":"translate-x-0":e==="top"?s||l?"-translate-y-full":"translate-y-0":e==="bottom"?s||l?"translate-y-full":"translate-y-0":"translate-x-0";return r.jsx("div",{ref:i,className:tr("fixed z-50 bg-white shadow-lg transition-transform duration-300 ease-in-out",e==="right"?"right-0 top-0 h-full border-l p-6":"",e==="left"?"left-0 top-0 h-full border-r p-6":"",e==="top"?"top-0 left-0 w-full border-b p-6":"",e==="bottom"?"bottom-0 left-0 w-full border-t p-6":"",c(),t),...a,children:n})});Fk.displayName="SheetContent";const zk=({className:e,...t})=>r.jsx("div",{className:tr("flex flex-col space-y-2 text-center sm:text-left mb-4",e),...t});zk.displayName="SheetHeader";const Bk=h.forwardRef(({className:e,...t},n)=>r.jsx("h2",{ref:n,className:tr("text-lg font-semibold text-gray-900",e),...t}));Bk.displayName="SheetTitle";const Uk=h.forwardRef(({className:e,...t},n)=>r.jsx("p",{ref:n,className:tr("text-sm text-gray-500",e),...t}));Uk.displayName="SheetDescription";const qk=h.forwardRef(({className:e,children:t,...n},s)=>r.jsx("div",{ref:s,className:tr("relative overflow-hidden",e),...n,children:r.jsx("div",{className:"h-full w-full rounded-[inherit] overflow-auto",children:t})}));qk.displayName="ScrollArea";const Hk=h.forwardRef(({className:e,orientation:t="horizontal",...n},s)=>r.jsx("div",{ref:s,className:tr("shrink-0 bg-gray-200",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...n}));Hk.displayName="Separator";const N3=({open:e,onOpenChange:t})=>{const{loadLeads:n}=gc(),[s,a]=h.useState([]),[i,l]=h.useState(!0),[o,c]=h.useState(new Set),[d,u]=h.useState(!1),[m,p]=h.useState(new Set),[f,y]=h.useState(!1),[g,x]=h.useState(!1),[b,v]=h.useState(0),w=async(_=!1)=>{var C;if(!_)try{const D=sessionStorage.getItem("leadgen_history_cache");if(D){const A=JSON.parse(D);console.log(" Using cached history data"),a(A.history||[]),p(new Set(A.existingCompanies||[])),y(A.hasMore||!1),v(A.currentOffset||0),l(!1);return}}catch(D){console.error("Error reading history cache:",D)}try{l(!0);const D=await ar.getEnrichmentHistory(20,0);a(D.history),y(D.hasMore),v(20);const A=new Set;if(D.history&&D.history.length>0)try{const E=D.history.map(M=>M.company_name),T=await ar.batchCheckCompaniesExist(E);for(const[M,L]of Object.entries(T))L&&A.add(M)}catch(E){console.error("Error batch checking companies:",E)}p(A);try{const E={history:D.history,existingCompanies:Array.from(A),hasMore:D.hasMore,currentOffset:20,timestamp:Date.now()};sessionStorage.setItem("leadgen_history_cache",JSON.stringify(E)),console.log(" Saved history to cache:",D.history.length,"records")}catch(E){console.error("Error saving history to cache:",E)}}catch(D){console.error("Error loading enrichment history:",D),(C=D.message)!=null&&C.includes("Employee not found")?a([]):mt.error("Failed to load enrichment history")}finally{l(!1)}},N=async()=>{if(!(g||!f))try{x(!0);const _=await ar.getEnrichmentHistory(20,b),C=[...s,..._.history];if(a(C),y(_.hasMore),v(b+20),_.history&&_.history.length>0)try{const D=_.history.map(T=>T.company_name),A=await ar.batchCheckCompaniesExist(D),E=new Set(m);for(const[T,M]of Object.entries(A))M&&E.add(T);p(E);try{const T={history:C,existingCompanies:Array.from(E),hasMore:_.hasMore,currentOffset:b+20,timestamp:Date.now()};sessionStorage.setItem("leadgen_history_cache",JSON.stringify(T))}catch(T){console.error("Error updating cache:",T)}}catch(D){console.error("Error batch checking companies:",D)}}catch(_){console.error("Error loading more history:",_),mt.error("Failed to load more records")}finally{x(!1)}};h.useEffect(()=>{e&&w();const _=A=>{A.key==="leadgen_history_refresh"&&e&&(sessionStorage.removeItem("leadgen_history_cache"),w())};window.addEventListener("storage",_);const D=setInterval(()=>{if(e)try{const A=sessionStorage.getItem("leadgen_history_refresh"),E=sessionStorage.getItem("leadgen_history_last_check");A&&A!==E&&(sessionStorage.setItem("leadgen_history_last_check",A),sessionStorage.removeItem("leadgen_history_cache"),w())}catch(A){console.error("Error checking history refresh:",A)}},2e3);return()=>{window.removeEventListener("storage",_),clearInterval(D)}},[e]);const k=_=>{c(C=>{const D=new Set(C);return D.has(_)?D.delete(_):D.add(_),D})},j=async()=>{var D,A,E,T;if(o.size===0){mt.error("Please select companies to save");return}const _=s.filter(M=>o.has(M.id)),C=_.map(M=>M.company_name);try{p($=>{const R=new Set($);return C.forEach(U=>R.add(U)),R}),c(new Set),mt.success(`Saving ${_.length} lead${_.length>1?"s":""} to database...`),u(!0);let M=0,L=0;const P=[];for(const $ of _)try{const U=($.contact_name||"").trim().split(/\s+/),I=U[0]||"Unknown",z=U.slice(1).join(" ")||"",F={company:$.company_name,location:$.location||null,industry:$.industry||null,email:$.contact_email||null,phone:$.contact_phone||null,website:$.website||null,notes:"Enriched lead from Apollo.io",source:"api_import",status:"cold",personnel:$.contact_name?[{first_name:I,last_name:z,company_name:$.company_name,email:$.contact_email||null,phone:$.contact_phone||null,position:$.contact_title||null,linkedin_url:$.contact_linkedin||null}]:[]};try{const O=await ar.createLead(F);M++,O&&O.lead_id&&P.push(O.lead_id)}catch(O){if((D=O.message)!=null&&D.includes("duplicate")||(A=O.message)!=null&&A.includes("already exists"))try{const K=await ar.findLeadsByCompany($.company_name);if(K&&K.length>0&&$.contact_name){const J=K[0],se={first_name:I,last_name:z,company_name:$.company_name,email:$.contact_email||null,phone:$.contact_phone||null,position:$.contact_title||null,linkedin_url:$.contact_linkedin||null,lead_id:J.lead_id,source:"api_import"};await ar.createPersonnel(se),M++,P.push(J.lead_id)}else L++}catch(K){(E=K.message)!=null&&E.includes("duplicate")||(T=K.message)!=null&&T.includes("unique_person_company")?M++:L++}else throw O}}catch(R){console.error(`Failed to save ${$.company_name}:`,R),L++}P.length>0&&((async()=>{for(const $ of P)try{const R=await ar.getCachedAISuggestions($);(!R||!R.suggestions)&&await ar.regenerateAISuggestions($)}catch(R){console.error(`Failed to process AI analysis for lead ${$}:`,R)}})(),n(!0));try{const $=sessionStorage.getItem("leadgen_history_cache");if($){const R=JSON.parse($);R.existingCompanies=Array.from(m),sessionStorage.setItem("leadgen_history_cache",JSON.stringify(R))}}catch($){console.error("Error updating cache:",$)}L>0&&M>0?mt(`Saved ${M}, ${L} failed`,{icon:""}):M===0&&(mt.error("Failed to save any leads"),p($=>{const R=new Set($);return C.forEach(U=>R.delete(U)),R}))}catch(M){console.error("Error saving leads:",M),mt.error("Failed to save leads"),p(L=>{const P=new Set(L);return C.forEach($=>P.delete($)),P})}finally{u(!1)}},S=_=>new Date(_).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"});return r.jsx(j3,{open:e,onOpenChange:t,children:r.jsxs(Fk,{className:"w-full sm:max-w-2xl",children:[r.jsxs(zk,{children:[r.jsx(Bk,{className:"text-2xl font-bold",children:"Search History"}),r.jsx(Uk,{children:"View and manage your previous lead generation searches"})]}),s.length>0&&r.jsxs("div",{className:"flex items-center justify-between mt-6 mb-4",children:[r.jsx("div",{className:"text-sm text-gray-600",children:o.size>0&&`${o.size} selected`}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(H,{variant:"outline",size:"sm",onClick:()=>{sessionStorage.removeItem("leadgen_history_cache"),w(!0)},disabled:i,className:"border-gray-300",children:[r.jsx(Be,{className:`w-4 h-4 mr-2 ${i?"animate-spin":""}`}),"Refresh"]}),r.jsx(H,{size:"sm",onClick:j,disabled:o.size===0||d,className:"bg-black hover:bg-gray-800 text-white",children:d?r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):`Save Selected (${o.size})`})]})]}),r.jsx(qk,{className:"h-[calc(100vh-180px)] mt-4 pr-4",children:i?r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsx(Be,{className:"w-8 h-8 animate-spin text-indigo-600"})}):s.length===0?r.jsxs("div",{className:"text-center py-12",children:[r.jsx(bt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-500",children:"No enrichment history yet"}),r.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Enriched companies will appear here"})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"space-y-3",children:s.map(_=>{const C=m.has(_.company_name),D=o.has(_.id);return r.jsx("div",{onClick:()=>k(_.id),className:`w-full border rounded-lg p-4 transition-colors cursor-pointer ${D?"border-indigo-300 bg-indigo-50":C?"border-gray-200 bg-gray-50":"border-gray-200 hover:border-indigo-200"}`,children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"pt-1",children:r.jsx(Vd,{checked:C?!0:D,onClick:A=>A.stopPropagation(),className:C&&!D?"bg-gray-400 border-gray-400":""})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-start justify-between mb-2",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[r.jsx(qt,{className:"w-4 h-4 text-indigo-600 flex-shrink-0"}),r.jsx("h4",{className:"font-medium text-gray-900 truncate",children:_.company_name})]}),r.jsx("div",{className:"flex items-center gap-2 ml-2 flex-shrink-0",children:C&&r.jsx(an,{variant:"secondary",className:"text-xs",children:"Saved"})})]}),r.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm text-gray-600 mb-3",children:[_.contact_name&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ko,{className:"w-3 h-3 text-gray-400"}),r.jsxs("span",{className:"truncate",children:[_.contact_name,_.contact_title&&`  ${_.contact_title}`]})]}),_.contact_email&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Dt,{className:"w-3 h-3 text-gray-400"}),r.jsx("span",{className:"truncate",children:_.contact_email})]}),_.location&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(vn,{className:"w-3 h-3 text-gray-400"}),r.jsx("span",{className:"truncate",children:_.location})]})]}),r.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[r.jsx(yt,{className:"w-3 h-3"}),S(_.created_at)]})]})]})},_.id)})}),f&&r.jsx("div",{className:"flex justify-center py-4",children:r.jsx(H,{onClick:N,disabled:g,variant:"outline",className:"border-gray-300",children:g?r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading..."]}):"Load More"})})]})})]})})},hh="leadgen_workflow_cache",C3="leadgen_workflow_step",k3=()=>{const[e,t]=xs("leadgen_workflow_step",1,{expires:7}),[n,s]=h.useState(!1),[a,i]=h.useState({tokens_used:0,tokens_limit:300,tokens_remaining:300}),[l,o]=h.useState(!0),[c,d]=h.useState(()=>{try{const w=Pl("leadgen_workflow_data");if(w)return w.selectedCompanies&&Array.isArray(w.selectedCompanies)&&(w.selectedCompanies=new Set(w.selectedCompanies)),{query:w.query||"",parsedIntent:w.parsedIntent||null,numberOfLeads:w.numberOfLeads||10,previewResults:w.previewResults||[],selectedCompanies:w.selectedCompanies||new Set,enrichedResults:w.enrichedResults||null};const N=sessionStorage.getItem(hh);if(N){const k=JSON.parse(N);k.selectedCompanies&&Array.isArray(k.selectedCompanies)&&(k.selectedCompanies=new Set(k.selectedCompanies));const j={...k,selectedCompanies:Array.from(k.selectedCompanies||[])};return ti("leadgen_workflow_data",j,{expires:7}),sessionStorage.removeItem(hh),{query:k.query||"",parsedIntent:k.parsedIntent||null,numberOfLeads:k.numberOfLeads||10,previewResults:k.previewResults||[],selectedCompanies:k.selectedCompanies||new Set,enrichedResults:k.enrichedResults||null}}}catch(w){console.error("Error loading workflow cache:",w)}return{query:"",parsedIntent:null,numberOfLeads:10,previewResults:[],selectedCompanies:new Set,enrichedResults:null}}),u=h.useCallback(async()=>{try{o(!0);const w=await ar.getMonthlyTokenUsage();i(w)}catch(w){console.error("Error loading token usage:",w)}finally{o(!1)}},[]);h.useEffect(()=>{u()},[u]),h.useEffect(()=>{try{const w={...c,selectedCompanies:Array.from(c.selectedCompanies||[])};ti("leadgen_workflow_data",w,{expires:7})}catch(w){console.error("Error saving workflow data to cookies:",w)}},[c]);const m=[{number:1,title:"Define Leads"},{number:2,title:"Refine Search"},{number:3,title:"Choose Companies"},{number:4,title:"Enrich & Save"}],p=h.useCallback((w,N)=>{try{const k=Pl("leadgen_workflow_data")||{};k.previewResults=[],k.selectedCompanies=[],k.enrichedResults=null,k.selectedLeads=[],ti("leadgen_workflow_data",k,{expires:7}),console.log(" Cleared future step cache (steps 3-4)"),sessionStorage.removeItem("leadgen_workflow_cache")}catch(k){console.error("Error clearing future cache:",k)}d(k=>({...k,query:w,parsedIntent:N})),t(2)},[]),f=h.useCallback((w,N)=>{try{const k=sessionStorage.getItem("leadgen_workflow_cache");if(k){const j=JSON.parse(k);j.previewResults=[],j.selectedCompanies=[],j.enrichedResults=null,j.selectedLeads=[],j._clearTimestamp=Date.now(),sessionStorage.setItem("leadgen_workflow_cache",JSON.stringify(j)),console.log(" Cleared future step cache (steps 3-4)",{previewResults:j.previewResults,timestamp:j._clearTimestamp})}}catch(k){console.error("Error clearing future cache:",k)}d(k=>({...k,numberOfLeads:w,parsedIntent:N||k.parsedIntent})),t(3)},[]),y=h.useCallback((w,N)=>{try{const k=sessionStorage.getItem("leadgen_workflow_cache");if(k){const j=JSON.parse(k);j.enrichedResults=null,j.selectedLeads=[],sessionStorage.setItem("leadgen_workflow_cache",JSON.stringify(j)),console.log(" Cleared future step cache (step 4)")}}catch(k){console.error("Error clearing future cache:",k)}d(k=>({...k,previewResults:w,selectedCompanies:N})),t(4);try{sessionStorage.setItem("leadgen_history_refresh",Date.now().toString())}catch(k){console.error("Error refreshing history cache:",k)}},[]),g=h.useCallback(w=>{d(N=>({...N,enrichedResults:w}));try{sessionStorage.setItem("leadgen_history_refresh",Date.now().toString())}catch(N){console.error("Error refreshing history cache:",N)}u()},[u]),x=h.useCallback(()=>{e>1&&t(e-1)},[e]),b=h.useCallback(()=>{t(1),d({query:"",parsedIntent:null,numberOfLeads:10,previewResults:[],selectedCompanies:new Set,enrichedResults:null});try{sessionStorage.removeItem(hh),sessionStorage.removeItem(C3)}catch(w){console.error("Error clearing workflow cache:",w)}},[]),v=()=>{const w=a.tokens_remaining;return w<=20?"bg-red-100 text-red-800 border border-red-300":w<=100?"bg-yellow-100 text-yellow-800 border border-yellow-300":"bg-green-100 text-green-800 border border-green-300"};return r.jsxs("div",{className:"min-h-screen flex flex-col bg-blue-50",children:[r.jsxs("div",{className:"flex items-center justify-start gap-3 px-6 py-2 bg-white border-b border-gray-200",children:[r.jsxs(H,{variant:"outline",onClick:()=>s(!0),className:"flex items-center gap-2 border-gray-300",children:[r.jsx(d4,{className:"w-4 h-4"}),"View History"]}),r.jsx("div",{className:`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${v()}`,title:"Tokens remaining for lead enrichments this month",children:l?r.jsxs("span",{className:"flex items-center gap-2",children:[r.jsx(Ct,{className:"w-3 h-3 animate-spin"}),"Loading..."]}):r.jsxs("span",{children:[a.tokens_remaining," / ",a.tokens_limit," tokens remaining"]})})]}),r.jsxs("div",{className:"px-8 pt-12 pb-4 bg-blue-50 text-center",children:[r.jsx("h2",{className:"text-2xl font-bold mb-3 text-indigo-900",children:"LeadGen Workflow"}),r.jsx("p",{className:"text-base text-gray-600",children:"Find and enrich your perfect leads in 4 simple steps"})]}),r.jsx("div",{className:"px-8 py-6 bg-blue-50",children:r.jsx(w3,{steps:m,currentStep:e})}),r.jsx("div",{className:"flex-1 overflow-y-auto px-8 py-6 bg-blue-50",children:r.jsx("div",{className:"max-w-6xl mx-auto",children:r.jsx("div",{className:"bg-white rounded-xl shadow-lg p-8",children:r.jsxs(ht,{mode:"wait",children:[e===1&&r.jsx(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:r.jsx(x3,{onComplete:p,initialQuery:c.query})},"step-1"),e===2&&r.jsx(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:r.jsx(y3,{query:c.query,parsedIntent:c.parsedIntent,initialNumberOfLeads:c.numberOfLeads,onComplete:f,onBack:x})},"step-2"),e===3&&r.jsx(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:r.jsx(b3,{query:c.query,parsedIntent:c.parsedIntent,numberOfLeads:c.numberOfLeads,onComplete:y,onBack:x})},`step-3-${c.numberOfLeads}-${c.query}`),e===4&&r.jsx(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:r.jsx(v3,{previewResults:c.previewResults,selectedCompanies:c.selectedCompanies,onComplete:g,onBack:x,onReset:b})},`step-4-${c.selectedCompanies.size}`)]})})})}),r.jsx(N3,{open:n,onOpenChange:s})]})},S3=()=>r.jsx(k3,{}),Wk=()=>{const[e,t]=h.useState(dA()),[n,s]=h.useState(uA());return h.useEffect(()=>mA((c,d)=>{t(c),s(d)}),[]),{currentTheme:e,theme:n,setTheme:o=>{fA(o)},getColor:o=>pA(o,n),getChartColorPalette:(o=8)=>hA(o,n)}},_3=()=>{const{getColor:e}=Wk();return{primary:e("primary.500"),primaryHover:e("interactive.hover.primary"),primaryActive:e("interactive.active.primary"),secondary:e("secondary.500"),secondaryHover:e("interactive.hover.secondary"),background:e("background.primary"),backgroundSecondary:e("background.secondary"),surface:e("surface.primary"),textPrimary:e("text.primary"),textSecondary:e("text.secondary"),textTertiary:e("text.tertiary"),border:e("border.primary"),borderSecondary:e("border.secondary"),success:e("status.success.500"),warning:e("status.warning.500"),error:e("status.error.500"),info:e("status.info.500"),chartColors:e("chart.primary")}},E3=()=>{const{getChartColorPalette:e,theme:t}=Wk(),[n,s]=h.useState(""),[a,i]=h.useState([]),[l,o]=h.useState(!1),[c,d]=h.useState(!1),[u,m]=h.useState(null),[p,f]=h.useState(null),[y,g]=h.useState(null),[x,b]=h.useState(!1),[v,w]=h.useState(null),[N,k]=h.useState(null),[j,S]=h.useState({}),[_,C]=h.useState(()=>()=>"#e5e7eb"),D=h.useRef(null),A=h.useRef(null),E=h.useRef([]);h.useEffect(()=>{const z=async()=>{try{const O=await fetch("/data/georef-canada-province@public.geojson");if(O.ok){const K=await O.json();k(K);const J={};K.features.forEach(Z=>{const oe=Z.properties.prov_name_en[0],W=Z.properties.prov_code[0];J[oe]=W}),S(J);const se=(Z,oe)=>{const W=(Z-1)/(oe-1);return W<=.25?"#ef4444":W<=.5?"#f97316":W<=.75?"#eab308":"#22c55e"};C(()=>se),console.log(" Loaded GeoJSON data from georef-canada-province@public.geojson:",K)}else console.warn(" Failed to load georef-canada-province@public.geojson, using fallback"),F()}catch(O){console.error(" Error loading GeoJSON data:",O),F()}},F=()=>{console.log(" Creating fallback province data...");const O={"British Columbia":"BC",Alberta:"AB",Saskatchewan:"SK",Manitoba:"MB",Ontario:"ON",Quebec:"QC","New Brunswick":"NB","Nova Scotia":"NS","Prince Edward Island":"PE","Newfoundland and Labrador":"NL",Yukon:"YT","Northwest Territories":"NT",Nunavut:"NU"},K=(se,Z)=>{const oe=(se-1)/(Z-1);return oe<=.25?"#ef4444":oe<=.5?"#f97316":oe<=.75?"#eab308":"#22c55e"};S(O),C(()=>K),k({type:"FeatureCollection",features:[{type:"Feature",properties:{prov_name_en:["Ontario"],prov_code:["ON"]},geometry:{type:"Polygon",coordinates:[[[-95.15,56.85],[-95.15,41.68],[-74.34,41.68],[-74.34,56.85],[-95.15,56.85]]]}}]})};z()},[]),h.useEffect(()=>{(()=>{if(window.google&&window.google.maps){console.log(" Google Maps API already loaded"),b(!0);return}if(document.querySelector('script[src*="maps.googleapis.com"]')){console.log(" Google Maps API script already loading...");const F=()=>b(!0);return window.addEventListener("google-maps-loaded",F),()=>window.removeEventListener("google-maps-loaded",F)}{console.error(" Google Maps API key not found in environment variables"),console.error("Please add VITE_GOOGLE_MAPS_API_KEY to your .env file");return}})()},[]),h.useEffect(()=>{if(!(!x||!N||!D.current||A.current))try{console.log(" Initializing Google Maps with React-safe container...");const z=document.createElement("div");z.style.width="100%",z.style.height="600px",z.style.position="relative",z.setAttribute("data-google-maps-container","true"),D.current.innerHTML="",D.current.appendChild(z);const F=new window.google.maps.Map(z,{center:{lat:56.1304,lng:-106.3468},zoom:4,mapTypeId:"roadmap",disableDefaultUI:!0,backgroundColor:t.background.secondary,clickableIcons:!1,keyboardShortcuts:!1,scrollwheel:!0,draggable:!0,zoomControl:!0});console.log(" Map initialized successfully"),A.current=F;const O=new window.google.maps.InfoWindow;w(O),F.addListener("error",J=>{console.error(" Google Maps Error:",J)});const K=()=>{E.current.length===0&&(console.log(" Map is ready, adding province overlays..."),M(F,O))};F.addListener("idle",K)}catch(z){console.error(" Error initializing map:",z),mt.error("Failed to initialize Google Maps. Please refresh the page.")}},[x,N]),h.useEffect(()=>{if(!A.current||!D.current)return;const F=setInterval(()=>{const O=D.current.querySelector(".gm-style"),K=D.current.querySelector("[data-google-maps-container]");if(!O&&!K){console.log(" Map content lost - attempting restoration...");const J=document.createElement("div");J.style.width="100%",J.style.height="600px",J.style.position="relative",J.setAttribute("data-google-maps-container","true"),D.current.innerHTML="",D.current.appendChild(J);try{const se=A.current.getDiv();se&&se.parentNode&&(J.appendChild(se),console.log(" Map content restored"))}catch(se){console.error(" Error restoring map:",se)}}},1e3);return()=>clearInterval(F)},[A.current,D.current]);const T=h.useCallback(()=>{A.current&&a.length>0&&(console.log(" Updating map data callback triggered"),L())},[a]);h.useEffect(()=>{T()},[T]);const M=(z,F)=>{var O;try{if(console.log(" Adding province overlays using Google Maps Data Layer..."),!N){console.warn(" No GeoJSON data available yet");return}E.current.forEach(J=>{J.setMap&&J.setMap(null)}),E.current=[];const K=new window.google.maps.Data;K.setMap(z),K.setStyle({fillColor:"#e5e7eb",fillOpacity:.5,strokeColor:"#ffffff",strokeOpacity:.8,strokeWeight:1,clickable:!0}),K.addGeoJson(N),K.addListener("mouseover",J=>{K.overrideStyle(J.feature,{strokeColor:"#3b82f6",strokeWeight:2,fillOpacity:.7})}),K.addListener("mouseout",J=>{K.revertStyle(J.feature)}),K.addListener("click",J=>{var B;const se=((B=J.feature.getProperty("prov_name_en"))==null?void 0:B[0])||J.feature.getProperty("name"),Z=P(se),oe=$(se,a);let W=`
          <div style="padding: 12px; min-width: 200px;">
            <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: bold; color: ${t.text.primary};">${se}</h3>
            <p style="margin: 0 0 8px 0; color: ${t.text.secondary}; font-size: 14px;">${Z.tooltip_text}</p>
        `;Z.density_score>0&&oe.rank>0&&(W+=`
            <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #e5e7eb;">
              <p style="margin: 0 0 4px 0; font-size: 14px; color: ${t.text.primary};">
                <strong>Density Score:</strong> ${Z.density_score}/10
              </p>
              <p style="margin: 0; font-size: 14px; color: ${t.status.warning[500]};">
                <strong>Rank:</strong> #${oe.rank} of ${oe.total}
              </p>
            </div>
          `),W+="</div>",F.setContent(W),F.setPosition(J.latLng),F.open(z)}),E.current.push(K),console.log(` Added Data Layer with ${((O=N.features)==null?void 0:O.length)||0} province boundaries`)}catch(K){console.error(" Error adding province overlays:",K)}},L=h.useCallback(()=>{if(!(!A.current||E.current.length===0||!a.length))try{console.log(" Updating map data with Data Layer..."),console.log(" Heatmap data:",a.map(K=>({name:K.display_name,score:K.density_score})));const F=[...a.filter(K=>K.density_score>0)].sort((K,J)=>J.density_score-K.density_score),O=E.current[0];if(O&&O.forEach){let K=0,J=0;O.forEach(se=>{var B;K++;const Z=((B=se.getProperty("prov_name_en"))==null?void 0:B[0])||se.getProperty("name"),oe=a.find(V=>V.display_name===Z);let W="#e5e7eb";if(oe&&oe.density_score>0){J++;const V=F.findIndex(re=>re.display_name===Z);if(V!==-1){const re=V+1;W=_(re,F.length),console.log(` ${Z}: score=${oe.density_score}, rank=${re}, color=${W}`)}}else console.log(` ${Z}: No data found or score is 0`);O.overrideStyle(se,{fillColor:W,fillOpacity:.7,strokeColor:"#ffffff",strokeOpacity:.8,strokeWeight:1})}),console.log(` Summary: ${J}/${K} provinces matched and colored`)}console.log(" Map data updated successfully with Data Layer")}catch(z){console.error(" Error updating map data:",z)}},[a,_]);h.useEffect(()=>{L()},[a,L]);const P=z=>a.find(F=>F.display_name===z)||{density_score:0,display_name:z,tooltip_text:`${z}: No data available`},$=(z,F)=>{if(!F||F.length===0)return{rank:0,total:0};const O=F.filter(se=>se.density_score>0);return O.length===0?{rank:0,total:0}:{rank:[...O].sort((se,Z)=>Z.density_score-se.density_score).findIndex(se=>se.display_name===z)+1||0,total:O.length}},R=async z=>{try{const F=await fetch(`http://localhost:9000/api/market-density/progress/${z}`);if(F.ok){const O=await F.json();return f(O),console.log(` MARKET DENSITY PROGRESS:
   Stage: ${O.stage}
   Province: ${O.current_province||"N/A"}
   City: ${O.current_city||"N/A"}
   Progress: ${O.provinces_completed}/${O.provinces_total} provinces
   Businesses Found: ${O.businesses_found} total, ${O.current_province_businesses} current province
   API Calls: ${O.api_calls_made}
   Status: ${O.message}
   ${O.estimated_time_remaining?`ETA: ${O.estimated_time_remaining}s`:""}`),O.stage==="completed"||O.stage==="error"}}catch(F){return console.error("Progress polling error:",F),!0}return!1},U=async()=>{if(!n.trim()){mt.error("Please enter an industry to search");return}o(!0),f(null),d(!1),i([]),m(null);try{const z=await fetch("http://localhost:9000/api/market-density/heatmap",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({industry:n.trim()})});if(!z.ok)throw new Error(`HTTP error! status: ${z.status}`);const F=await z.json(),O=F.heatmap_data||F,K=F.session_id;if(K){g(K);const oe=setInterval(async()=>{await R(K)&&clearInterval(oe)},1e3);setTimeout(()=>clearInterval(oe),3e5)}i(O),d(!0);const J=F.total_businesses||O.reduce((oe,W)=>oe+(W.businesses_count||0),0),se=O.length>0?(O.reduce((oe,W)=>oe+W.density_score,0)/O.length).toFixed(1):0,Z=O.reduce((oe,W)=>W.density_score>oe.density_score?W:oe,{density_score:0,display_name:"None"});m({totalBusinesses:J,avgScore:se,topProvince:Z.display_name,topScore:Z.density_score,apiCalls:F.api_calls_made||0}),mt.success(`Market analysis complete for "${n}"!`)}catch(z){console.error("Error fetching market density data:",z),mt.error("Failed to fetch market density data. Please try again.")}finally{o(!1)}},I=z=>{z.key==="Enter"&&U()};return r.jsxs("div",{className:"space-y-6",children:[r.jsx("style",{children:`
          #market-density-map {
            background-color: #f3f4f6 !important;
            border: 2px solid #e5e7eb !important;
          }
          #market-density-map canvas {
            opacity: 1 !important;
            visibility: visible !important;
            display: block !important;
            position: relative !important;
            z-index: 1 !important;
          }
          #market-density-map .gm-style {
            opacity: 1 !important;
            visibility: visible !important;
            position: relative !important;
            z-index: 1 !important;
          }
          #market-density-map .gm-style > div {
            opacity: 1 !important;
            visibility: visible !important;
          }
          #market-density-map .gm-style img {
            opacity: 1 !important;
            visibility: visible !important;
          }
        `}),r.jsxs(We,{children:[r.jsxs(ir,{children:[r.jsxs(cr,{className:"flex items-center gap-2",children:[r.jsx(vn,{className:"w-6 h-6 text-blue-600"}),"Market Density Heatmap - Canada"]}),r.jsx("p",{className:"text-gray-600",children:"Analyze industry density and market quality across Canadian provinces using Google Maps data"})]}),r.jsxs(it,{children:[r.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[r.jsx("div",{className:"flex-1 max-w-md",children:r.jsxs("div",{className:"relative",children:[r.jsx(zn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Enter industry (e.g., 'pet', 'technology', 'restaurant')",value:n,onChange:z=>s(z.target.value),onKeyPress:I,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),r.jsxs(H,{onClick:U,disabled:l||!n.trim(),className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg disabled:opacity-50",children:[l?r.jsx(Ct,{className:"w-4 h-4 animate-spin mr-2"}):r.jsx(zn,{className:"w-4 h-4 mr-2"}),"Analyze Market"]})]}),l?r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsxs("div",{className:"text-center max-w-md",children:[r.jsx(Ct,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),p?r.jsxs("div",{className:"space-y-3",children:[r.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:[p.stage==="initializing"&&" Initializing search...",p.stage==="searching_province"&&` Searching ${p.current_province}`,p.stage==="processing_results"&&" Processing results...",p.stage==="completed"&&" Search completed!",p.stage==="error"&&" Search failed!"]}),p.current_city&&r.jsxs("p",{className:"text-blue-600 font-medium",children:[" ",p.current_city,", ",p.current_province]}),r.jsx("div",{className:"bg-gray-200 rounded-full h-2 mb-2",children:r.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-500",style:{width:`${p.provinces_completed/p.provinces_total*100}%`}})}),r.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[r.jsxs("div",{className:"bg-blue-50 p-2 rounded",children:[r.jsx("p",{className:"text-blue-600 font-medium",children:"Progress"}),r.jsxs("p",{className:"text-blue-900",children:[p.provinces_completed,"/",p.provinces_total," provinces"]})]}),r.jsxs("div",{className:"bg-green-50 p-2 rounded",children:[r.jsx("p",{className:"text-green-600 font-medium",children:"Businesses Found"}),r.jsxs("p",{className:"text-green-900",children:[p.businesses_found," total"]})]}),r.jsxs("div",{className:"bg-purple-50 p-2 rounded",children:[r.jsx("p",{className:"text-purple-600 font-medium",children:"API Calls"}),r.jsx("p",{className:"text-purple-900",children:p.api_calls_made})]}),r.jsxs("div",{className:"bg-orange-50 p-2 rounded",children:[r.jsx("p",{className:"text-orange-600 font-medium",children:"ETA"}),r.jsx("p",{className:"text-orange-900",children:p.estimated_time_remaining?`${p.estimated_time_remaining}s`:"Calculating..."})]})]}),r.jsx("p",{className:"text-gray-600 text-sm mt-3",children:p.message||"Processing..."})]}):r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-600 mb-2",children:"Searching Canadian provinces..."}),r.jsx("p",{className:"text-sm text-gray-500",children:"This may take 1-2 minutes for comprehensive results"})]})]})}):r.jsxs(r.Fragment,{children:[u&&r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[r.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg text-center",children:[r.jsx(qt,{className:"w-5 h-5 text-blue-600 mx-auto mb-1"}),r.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Total Businesses"}),r.jsx("p",{className:"text-lg font-bold text-blue-900",children:u.totalBusinesses})]}),r.jsxs("div",{className:"bg-green-50 p-3 rounded-lg text-center",children:[r.jsx(Da,{className:"w-5 h-5 text-green-600 mx-auto mb-1"}),r.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Avg Score"}),r.jsxs("p",{className:"text-lg font-bold text-green-900",children:[u.avgScore,"/10"]})]}),r.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg text-center",children:[r.jsx(Ot,{className:"w-5 h-5 text-purple-600 mx-auto mb-1"}),r.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Top Province"}),r.jsx("p",{className:"text-lg font-bold text-purple-900",children:u.topProvince})]}),r.jsxs("div",{className:"bg-red-50 p-3 rounded-lg text-center",children:[r.jsx(on,{className:"w-5 h-5 text-red-600 mx-auto mb-1"}),r.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Top Score"}),r.jsxs("p",{className:"text-lg font-bold text-red-900",children:[u.topScore,"/10"]})]}),r.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg text-center",children:[r.jsx(ni,{className:"w-5 h-5 text-orange-600 mx-auto mb-1"}),r.jsx("p",{className:"text-sm text-orange-600 font-medium",children:"API Calls"}),r.jsx("p",{className:"text-lg font-bold text-orange-900",children:u.apiCalls})]})]}),r.jsxs("div",{className:"bg-gray-50 rounded-lg border p-6",children:[r.jsxs("div",{className:"text-center mb-4",children:[r.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:c?`Market Density Ranking: ${n}`:"Canadian Market Density Map"}),r.jsx("p",{className:"text-gray-600 mt-1",children:c?"Colors show relative ranking: Green = lowest, Red = highest density":"Search for an industry to see ranking-based density data"})]}),r.jsxs("div",{className:"bg-white rounded-lg overflow-hidden border",children:[r.jsx("div",{ref:D,id:"market-density-map",style:{width:"100%",height:"600px",minHeight:"500px",position:"relative",zIndex:1,backgroundColor:t.background.tertiary},className:"rounded-lg","data-google-maps-container":"true",suppressHydrationWarning:!0},"google-maps-container"),!x&&r.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Ct,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-2"}),r.jsx("p",{className:"text-gray-600",children:"Loading Google Maps..."})]})})]}),c&&r.jsx("div",{className:"mt-6 flex justify-center",children:r.jsxs("div",{className:"bg-white rounded-lg p-4 border",children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-800 mb-3 text-center",children:"Market Density Ranking"}),r.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[r.jsx("span",{className:"text-gray-600 font-medium",children:"Worst"}),r.jsx("div",{className:"flex",children:e(5).map((z,F)=>r.jsx("div",{className:"w-8 h-5 border border-gray-300",style:{backgroundColor:z}},F))}),r.jsx("span",{className:"text-gray-600 font-medium",children:"Best"}),r.jsx("div",{className:"ml-3 text-xs text-gray-500",children:"Based on relative ranking"})]})]})})]}),!c&&r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(Za,{className:"w-5 h-5 text-blue-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-blue-900",children:"How to Use"}),r.jsxs("ul",{className:"text-sm text-blue-700 mt-1 space-y-1",children:[r.jsx("li",{children:' Enter an industry keyword (e.g., "pet", "restaurant", "technology")'}),r.jsx("li",{children:' Click "Analyze Market" to search all Canadian provinces'}),r.jsx("li",{children:" View results on the interactive Google Maps with ranking-based colors"}),r.jsx("li",{children:" Green = lowest ranked provinces, Red = highest ranked provinces"}),r.jsx("li",{children:" Click on provinces to see detailed ranking and score information"}),r.jsx("li",{children:" Zoom and pan the map for detailed geographic exploration"})]})]})]})})]})]})]})]})},D3=({wsConnection:e})=>{const[t,n]=h.useState("lead-management"),s=[{id:"lead-management",label:"Lead Management",icon:kt},{id:"generating-new-leads",label:"Generating New Leads",icon:_f}];return r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx(ri,{title:"Lead Generation",themeColor:"blue",tabs:s.map(a=>({id:a.id,label:a.label,icon:a.icon,isActive:t===a.id,onClick:()=>n(a.id)}))}),r.jsxs("div",{className:"flex-1 overflow-hidden",children:[t==="lead-management"&&r.jsx(de.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:"h-full",children:r.jsx(f3,{})},"lead-management"),t==="generating-new-leads"&&r.jsx(de.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:"h-full",children:r.jsx(S3,{})},"generating-new-leads"),t==="market-density"&&r.jsx(de.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:"h-full",children:r.jsxs("div",{className:"h-full p-4 overflow-y-auto",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[r.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[r.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[r.jsx(Ot,{className:"w-5 h-5 text-green-600"}),r.jsx("h3",{className:"font-medium text-gray-900",children:"Market Opportunities"})]}),r.jsx("p",{className:"text-sm text-gray-600",children:"Identify high-potential regions for business expansion"})]}),r.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[r.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[r.jsx(_f,{className:"w-5 h-5 text-blue-600"}),r.jsx("h3",{className:"font-medium text-gray-900",children:"Competitive Analysis"})]}),r.jsx("p",{className:"text-sm text-gray-600",children:"Analyze competitor density and market saturation"})]}),r.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[r.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[r.jsx(vn,{className:"w-5 h-5 text-purple-600"}),r.jsx("h3",{className:"font-medium text-gray-900",children:"Geographic Insights"})]}),r.jsx("p",{className:"text-sm text-gray-600",children:"Interactive heatmaps with detailed regional data"})]})]}),r.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:r.jsx(E3,{className:"w-full"})})]})},"market-density")]})]})},ei=[{label:"Proposal Sent",done:!1},{label:"Proposal Review Call Scheduled",done:!1},{label:"Revision Requested",done:!1},{label:"Terms Alignment",done:!1},{label:"Final Offer Sent",done:!1},{label:"Waiting for Signature",done:!1},{label:"Closed  Won",done:!1},{label:"Closed  Lost",done:!1}],T3={1:{defaultLeads:[{id:1,name:"Fortune Tech Corp",lastContactDate:"2024-06-01",currentStage:"Negotiation",progress:75},{id:2,name:"Global Solutions Inc",lastContactDate:"2024-05-28",currentStage:"Proposal",progress:60},{id:3,name:"Enterprise Dynamics",lastContactDate:"2024-05-20",currentStage:"Discovery",progress:30},{id:4,name:"Strategic Partners LLC",lastContactDate:"2024-05-15",currentStage:"Closed",progress:100}],defaultCustomers:[{id:1,name:"MegaCorp Industries",lastContactDate:"2024-06-02",currentStage:"Expansion",progress:85},{id:2,name:"Innovation Holdings",lastContactDate:"2024-05-30",currentStage:"Renewal",progress:90},{id:3,name:"TechVision Enterprises",lastContactDate:"2024-05-25",currentStage:"Upsell",progress:70}]},2:{defaultLeads:[{id:1,name:"HealthTech Solutions",lastContactDate:"2024-06-01",currentStage:"Technical Review",progress:65},{id:2,name:"MedData Analytics",lastContactDate:"2024-05-28",currentStage:"Integration Planning",progress:55},{id:3,name:"Clinical Systems Inc",lastContactDate:"2024-05-20",currentStage:"Closed",progress:100},{id:4,name:"Healthcare Partners",lastContactDate:"2024-05-15",currentStage:"Contacted",progress:20}],defaultCustomers:[{id:1,name:"Regional Medical Center",lastContactDate:"2024-06-02",currentStage:"Support",progress:95},{id:2,name:"Digital Health Corp",lastContactDate:"2024-05-30",currentStage:"Implementation",progress:80},{id:3,name:"Healthcare Analytics Co",lastContactDate:"2024-05-25",currentStage:"Training",progress:60}]},3:{defaultLeads:[{id:1,name:"StartUp Innovations",lastContactDate:"2024-06-01",currentStage:"Qualification",progress:40},{id:2,name:"SMB Solutions Hub",lastContactDate:"2024-05-28",currentStage:"Demo Scheduled",progress:50},{id:3,name:"Growth Partners LLC",lastContactDate:"2024-05-20",currentStage:"Follow-up",progress:35},{id:4,name:"Digital Marketing Co",lastContactDate:"2024-05-15",currentStage:"Closed",progress:100}],defaultCustomers:[{id:1,name:"Small Business Central",lastContactDate:"2024-06-02",currentStage:"Onboarding",progress:70},{id:2,name:"Local Services Group",lastContactDate:"2024-05-30",currentStage:"Active",progress:90},{id:3,name:"Community Partners",lastContactDate:"2024-05-25",currentStage:"Referral",progress:45}]},4:{defaultLeads:[{id:1,name:"Enterprise Global Corp",lastContactDate:"2024-06-01",currentStage:"Executive Review",progress:80},{id:2,name:"Strategic Accounts Inc",lastContactDate:"2024-05-28",currentStage:"Expansion Discussion",progress:70},{id:3,name:"Fortune Partners",lastContactDate:"2024-05-20",currentStage:"Renewal Planning",progress:85},{id:4,name:"Global Success Ltd",lastContactDate:"2024-05-15",currentStage:"Closed",progress:100}],defaultCustomers:[{id:1,name:"Enterprise Solutions Co",lastContactDate:"2024-06-02",currentStage:"Strategic Review",progress:95},{id:2,name:"Success Partners Inc",lastContactDate:"2024-05-30",currentStage:"Expansion",progress:88},{id:3,name:"Corporate Excellence",lastContactDate:"2024-05-25",currentStage:"Renewal",progress:92}]},5:{defaultLeads:[{id:1,name:"API Integration Corp",lastContactDate:"2024-06-01",currentStage:"Technical Evaluation",progress:60},{id:2,name:"Cloud Solutions Inc",lastContactDate:"2024-05-28",currentStage:"Architecture Review",progress:55},{id:3,name:"DevOps Partners",lastContactDate:"2024-05-20",currentStage:"Implementation Planning",progress:45},{id:4,name:"Technical Systems Ltd",lastContactDate:"2024-05-15",currentStage:"Closed",progress:100}],defaultCustomers:[{id:1,name:"Integration Specialists",lastContactDate:"2024-06-02",currentStage:"Technical Support",progress:90},{id:2,name:"Cloud Native Corp",lastContactDate:"2024-05-30",currentStage:"Optimization",progress:85},{id:3,name:"API Development Co",lastContactDate:"2024-05-25",currentStage:"Monitoring",progress:95}]},6:{defaultLeads:[{id:1,name:"Implementation Partners",lastContactDate:"2024-06-01",currentStage:"Scoping",progress:50},{id:2,name:"Process Optimization Inc",lastContactDate:"2024-05-28",currentStage:"Planning",progress:45},{id:3,name:"Training Solutions Corp",lastContactDate:"2024-05-20",currentStage:"Proposal Review",progress:65},{id:4,name:"Change Management Co",lastContactDate:"2024-05-15",currentStage:"Closed",progress:100}],defaultCustomers:[{id:1,name:"Enterprise Implementation",lastContactDate:"2024-06-02",currentStage:"Go-Live",progress:95},{id:2,name:"Process Excellence Ltd",lastContactDate:"2024-05-30",currentStage:"Training",progress:80},{id:3,name:"Transformation Partners",lastContactDate:"2024-05-25",currentStage:"Optimization",progress:88}]}},A3={defaultLeads:[{id:1,name:"Acme Corp",lastContactDate:"2024-06-01",currentStage:"Contacted",progress:20},{id:2,name:"Beta LLC",lastContactDate:"2024-05-28",currentStage:"Negotiation",progress:60},{id:3,name:"Gamma Inc",lastContactDate:"2024-05-20",currentStage:"Closed",progress:100}],defaultCustomers:[{id:1,name:"Delta Partners",lastContactDate:"2024-06-02",currentStage:"Warm",progress:40},{id:2,name:"Epsilon Ventures",lastContactDate:"2024-05-30",currentStage:"Closed",progress:100}]},P3=e=>T3[e]||A3,Yk=h.createContext(),ua=()=>{const e=h.useContext(Yk);if(!e)throw new Error("useEmployeeProfile must be used within an EmployeeProfileProvider");return e},O3=({children:e,onEmployeeRefresh:t})=>{const[n,s]=h.useState(null),[a,i]=h.useState([]),[l,o]=h.useState([]),[c,d]=h.useState(!1),[u,m]=h.useState(null),[p,f]=h.useState(!1),[y,g]=h.useState(!1),[x,b]=h.useState(!1),[v,w]=h.useState(null),[N,k]=h.useState({name:"",lastContactDate:"",currentStage:"Contacted",progress:0}),[j,S]=h.useState({name:"",lastContactDate:"",currentStage:"Warm",progress:0}),[_,C]=h.useState({name:"",employee_id:"",start_date:"",department:"",job_title:"",manager:"",manager_notes:"",availability:"available",experience:0,completionRate:85,specialties:[]}),[D,A]=h.useState({}),[E,T]=h.useState({}),[M,L]=h.useState(null),P=(B,V,re)=>re[B.id]?re[B.id]:(V(Me=>({...Me,[B.id]:ei.map(he=>({...he}))})),ei.map(Me=>({...Me}))),$=(B,V,re)=>{re[B.id]||V(Me=>({...Me,[B.id]:ei.map(he=>({...he}))}))},R=(B,V)=>V[B.id]?V[B.id]:ei.map(re=>({...re})),U=B=>({email:B.email||"info@"+(B.name||"company").replace(/\s+/g,"").toLowerCase()+".com",phone:B.phone||"+1 (555) 123-4567",location:B.location||"New York, NY",dealValue:B.dealValue||"$50,000",notes:B.notes||"Key client in the fintech sector. Interested in long-term partnership."}),I=B=>({available:"bg-green-100 text-green-800",busy:"bg-red-100 text-red-800","partially-available":"bg-yellow-100 text-yellow-800","on-leave":"bg-gray-100 text-gray-800"})[B]||"bg-gray-100 text-gray-800",z=B=>({available:r.jsx(bt,{className:"w-4 h-4"}),busy:r.jsx(dt,{className:"w-4 h-4"}),"partially-available":r.jsx(jt,{className:"w-4 h-4"}),"on-leave":r.jsx(OC,{className:"w-4 h-4"})})[B]||r.jsx(jt,{className:"w-4 h-4"}),F=B=>({hot:"bg-red-100 text-red-800",warm:"bg-yellow-100 text-yellow-800",cold:"bg-blue-100 text-blue-800",qualified:"bg-green-100 text-green-800",contacted:"bg-purple-100 text-purple-800"})[B]||"bg-gray-100 text-gray-800",O=()=>new Date().toISOString().slice(0,10),W={selectedEmployee:n,setSelectedEmployee:s,employeeLeads:a,setEmployeeLeads:i,employeeCustomers:l,setEmployeeCustomers:o,showAddLead:p,setShowAddLead:f,showAddCustomer:y,setShowAddCustomer:g,showAddEmployee:x,setShowAddEmployee:b,selectedEntry:v,setSelectedEntry:w,newLead:N,setNewLead:k,newCustomer:j,setNewCustomer:S,newEmployee:_,setNewEmployee:C,leadNegotiationSteps:D,setLeadNegotiationSteps:A,customerNegotiationSteps:E,setCustomerNegotiationSteps:T,expandedNegotiation:M,setExpandedNegotiation:L,loading:c,error:u,getNegotiationSteps:P,initializeNegotiationSteps:$,getSafeNegotiationSteps:R,getCompanyInfo:U,getAvailabilityColor:I,getAvailabilityIcon:z,getStatusColor:F,todayStr:O,handleAddLead:B=>{B.preventDefault(),N.name.trim()&&(i(V=>[...V,{id:Date.now(),name:N.name,lastContactDate:N.lastContactDate||O(),currentStage:N.currentStage,progress:N.progress||0}]),f(!1),k({name:"",lastContactDate:"",currentStage:"Contacted",progress:0}))},handleAddCustomer:B=>{B.preventDefault(),j.name.trim()&&(o(V=>[...V,{id:Date.now(),name:j.name,lastContactDate:j.lastContactDate||O(),currentStage:j.currentStage,progress:j.progress||0}]),g(!1),S({name:"",lastContactDate:"",currentStage:"Warm",progress:0}))},handleAddEmployee:async()=>{try{d(!0);const B={..._,role:_.job_title,specialties:_.specialties||[]},V=await zr.createEmployee(B);return b(!1),C({name:"",employee_id:"",start_date:"",department:"",job_title:"",manager:"",manager_notes:"",availability:"available",experience:0,completionRate:85,specialties:[]}),V}catch(B){return console.error("Failed to create employee:",B),m("Failed to create employee. Please try again."),null}finally{d(!1)}},handleViewProfile:async B=>{s(B),d(!0),m(null);try{const[V,re]=await Promise.all([zr.getCustomersByEmployee(B.id),zr.getLeadsByEmployee(B.id)]),Me=V.map(G=>({id:G.id,name:G.customer_name,lastContactDate:G.last_purchase_date?new Date(G.last_purchase_date).toISOString().slice(0,10):O(),currentStage:"Active",progress:75})),he=re.map(G=>({id:G.id,name:G.customer_name,lastContactDate:G.last_purchase_date?new Date(G.last_purchase_date).toISOString().slice(0,10):O(),currentStage:"Contacted",progress:30}));o(Me),i(he)}catch(V){console.error("Error fetching customer data:",V),m("Failed to load customer data"),o([]),i([])}finally{d(!1)}},refreshEmployeeData:async()=>{if(n)try{const B=await zr.getEmployeeById(n.id);s(B),t&&await t()}catch(B){console.error("Failed to refresh employee data:",B),m("Failed to refresh employee data")}}};return r.jsx(Yk.Provider,{value:W,children:e})};class M3{constructor(){this.cache=new Map,this.cacheTimeout=15*60*1e3,this.maxCacheSize=50,this.cacheDurations={EMPLOYEE_BASIC:30*60*1e3,EMPLOYEE_PERFORMANCE:60*60*1e3,EMPLOYEE_FEEDBACK:15*60*1e3,CUSTOMER_DATA:10*60*1e3},this.metrics={hits:0,misses:0,totalRequests:0}}_generateCacheKey(t,n={}){const s=Object.keys(n).sort().map(a=>`${a}:${JSON.stringify(n[a])}`).join("|");return`${t}_${btoa(s).replace(/[^a-zA-Z0-9]/g,"")}`}_getCachedResult(t,n=null){const s=this.cache.get(t),a=n||this.cacheTimeout;return s&&Date.now()-s.timestamp<a?(this.metrics.hits++,console.log(` Cache hit for ${t}`),s.data):(s&&this.cache.delete(t),this.metrics.misses++,null)}_setCachedResult(t,n,s=null){if(this.cache.size>=this.maxCacheSize){const a=this.cache.keys().next().value;this.cache.delete(a)}this.cache.set(t,{data:n,timestamp:Date.now(),timeout:s||this.cacheTimeout}),console.log(` Cached result for ${t}`)}async getAllEmployeesWithFullData(t={},n=!1){this.metrics.totalRequests++;const s=this._generateCacheKey("employees_full_data",t);if(!n){const a=this._getCachedResult(s,this.cacheDurations.EMPLOYEE_BASIC);if(a)return a}try{const a=await fetch(`${zr.baseUrl}/api/employees/batch/full-data`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({employee_ids:t.employee_ids||null,department:t.department||null,search:t.search||null,include_performance:t.include_performance!==!1,include_feedback:t.include_feedback!==!1,include_customers:t.include_customers!==!1})});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const i=await a.json();return this._setCachedResult(s,i,this.cacheDurations.EMPLOYEE_BASIC),console.log(` Loaded ${i.employees.length} employees with full data (batch API)`),i}catch(a){return console.error("Batch API failed, falling back to individual calls:",a),this._fallbackToIndividualCalls(t)}}async _fallbackToIndividualCalls(t={}){try{const n=await zr.getAllEmployeesWithPerformanceAndFeedback(t);return{employees:n.map(a=>({employee:a,performance:a.performance||null,feedback_summary:a.feedback_summary||null,customer_count:a.customer_count||0,lead_count:a.lead_count||0})),total_count:n.length,performance_metrics:{},query_info:{query_type:"fallback_individual_calls",fallback_reason:"batch_api_unavailable"}}}catch(n){throw console.error("Fallback API calls also failed:",n),n}}async getEmployeeById(t,n=!1){this.metrics.totalRequests++;const s=this._generateCacheKey("employee_by_id",{id:t});if(!n){const a=this._getCachedResult(s,this.cacheDurations.EMPLOYEE_BASIC);if(a)return a}try{const a=await zr.getEmployeeById(t);return this._setCachedResult(s,a,this.cacheDurations.EMPLOYEE_BASIC),a}catch(a){throw console.error(`Error fetching employee ${t}:`,a),a}}async getEmployeePerformance(t,n=!1){this.metrics.totalRequests++;const s=this._generateCacheKey("employee_performance",{id:t});if(!n){const a=this._getCachedResult(s,this.cacheDurations.EMPLOYEE_PERFORMANCE);if(a)return a}try{const a=await zr.getEmployeePerformance(t);return this._setCachedResult(s,a,this.cacheDurations.EMPLOYEE_PERFORMANCE),a}catch(a){throw console.error(`Error fetching performance for employee ${t}:`,a),a}}async getEmployeeCustomersAndLeads(t,n=!1){this.metrics.totalRequests++;const s=this._generateCacheKey("employee_customers_leads",{id:t});if(!n){const a=this._getCachedResult(s,this.cacheDurations.CUSTOMER_DATA);if(a)return a}try{const[a,i]=await Promise.all([zr.getCustomersByEmployee(t),zr.getLeadsByEmployee(t)]),l={customers:a,leads:i};return this._setCachedResult(s,l,this.cacheDurations.CUSTOMER_DATA),l}catch(a){throw console.error(`Error fetching customers/leads for employee ${t}:`,a),a}}invalidateEmployeeCache(t){const n=[];for(const[s,a]of this.cache.entries())(s.includes(`id:${t}`)||s.includes("employees_full_data"))&&n.push(s);n.forEach(s=>{this.cache.delete(s),console.log(` Invalidated cache for ${s}`)})}clearCache(){this.cache.clear(),console.log(" Employee data cache cleared")}cleanupExpiredCache(){const t=Date.now(),n=[];for(const[s,a]of this.cache.entries()){const i=a.timeout||this.cacheTimeout;t-a.timestamp>i&&n.push(s)}n.forEach(s=>this.cache.delete(s)),n.length>0&&console.log(` Cleaned up ${n.length} expired cache entries`)}getCacheStats(){const t=this.metrics.totalRequests>0?(this.metrics.hits/this.metrics.totalRequests*100).toFixed(1):0;return{cacheSize:this.cache.size,maxSize:this.maxCacheSize,totalRequests:this.metrics.totalRequests,cacheHits:this.metrics.hits,cacheMisses:this.metrics.misses,hitRate:`${t}%`,memoryUsage:this._estimateCacheMemoryUsage()}}_estimateCacheMemoryUsage(){let t=0;for(const[n,s]of this.cache.entries())t+=n.length+JSON.stringify(s.data).length;return`${Math.round(t/1024)}KB`}startCacheCleanup(t=30){this.cleanupInterval=setInterval(()=>{this.cleanupExpiredCache()},t*60*1e3),console.log(` Cache cleanup scheduled every ${t} minutes`)}stopCacheCleanup(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null,console.log(" Cache cleanup stopped"))}}const Vn=new M3;Vn.startCacheCleanup(30);const Vk=h.createContext(),Gk=()=>{const e=h.useContext(Vk);if(!e)throw new Error("useEmployeeData must be used within an EmployeeDataProvider");return e},I3=({children:e})=>{const[t,n]=h.useState(new Map),[s,a]=h.useState([]),[i,l]=h.useState(!1),[o,c]=h.useState(null),[d,u]=h.useState({}),[m,p]=h.useState(null),[f,y]=h.useState({department:"all",availability:"all",search:""}),g=h.useCallback(async(M=!1)=>{l(!0),c(null);const L=Date.now();try{console.log(" Loading all employees with batch API...");const P={include_performance:!0,include_feedback:!0,include_customers:!0};f.department!=="all"&&(P.department=f.department),f.search&&(P.search=f.search);const $=await Vn.getAllEmployeesWithFullData(P,M);a($.employees||[]);const R=new Map;$.employees.forEach(I=>{R.set(I.employee.id,I)}),n(R);const U=Date.now()-L;return p(U),u(Vn.getCacheStats()),console.log(` Loaded ${$.employees.length} employees in ${U}ms`),console.log(" Cache stats:",Vn.getCacheStats()),$}catch(P){throw console.error("Failed to load employee data:",P),c(`Failed to load employee data: ${P.message}`),P}finally{l(!1)}},[f]),x=h.useCallback(async(M,L=!1)=>{var P,$;if(!L&&t.has(M))return t.get(M);try{console.log(` Loading data for employee ${M}...`);const[R,U,I]=await Promise.all([Vn.getEmployeeById(M,L),Vn.getEmployeePerformance(M,L),Vn.getEmployeeCustomersAndLeads(M,L)]),z={employee:R,performance:U,feedback_summary:R.feedback_summary||null,customer_count:((P=I.customers)==null?void 0:P.length)||0,lead_count:(($=I.leads)==null?void 0:$.length)||0,customers:I.customers||[],leads:I.leads||[]};return n(F=>{const O=new Map(F);return O.set(M,z),O}),a(F=>{const O=F.findIndex(K=>K.employee.id===M);if(O>=0){const K=[...F];return K[O]=z,K}else return[...F,z]}),console.log(` Loaded individual data for employee ${M}`),z}catch(R){throw console.error(`Failed to load employee ${M}:`,R),R}},[t]),b=h.useCallback((M,L)=>{Vn.invalidateEmployeeCache(M),n(P=>{const $=new Map(P),R=$.get(M)||{};return $.set(M,{...R,...L}),$}),a(P=>P.map($=>$.employee.id===M?{...$,...L}:$)),console.log(` Updated data for employee ${M}`)},[]),v=h.useCallback(()=>({peer_evaluations:{averageScore:4,count:0},goal_progress:[],performance_score:80}),[]),w=h.useCallback(M=>({employee:M,performance:v(),feedback_summary:null,customer_count:0,lead_count:0,customers:[],leads:[]}),[v]),N=h.useCallback(M=>{const L=w(M);n(P=>{const $=new Map(P);return $.set(M.id,L),$}),a(P=>[...P,L]),u(Vn.getCacheStats()),console.log(` Added employee ${M.id} to state optimistically`)},[w]),k=h.useCallback(M=>{n(L=>{const P=new Map(L);return P.delete(M),P}),a(L=>L.filter(P=>P.employee.id!==M)),console.log(` Rolled back employee ${M} addition`)},[]),j=h.useCallback(M=>{Vn.invalidateEmployeeCache(M),n(L=>{const P=new Map(L);return P.delete(M),P}),a(L=>L.filter(P=>P.employee.id!==M)),console.log(` Removed employee ${M} from state`)},[]),S=h.useCallback(M=>{y(L=>({...L,...M}))},[]),_=h.useCallback(()=>s.filter(M=>{var P;const L=M.employee;if(f.department!=="all"&&L.department!==f.department||f.availability!=="all"&&L.availability!==f.availability)return!1;if(f.search){const $=f.search.toLowerCase(),R=L.name.toLowerCase().includes($),U=L.role.toLowerCase().includes($),I=(P=L.specialties)==null?void 0:P.some(z=>z.toLowerCase().includes($));if(!R&&!U&&!I)return!1}return!0}),[s,f]),C=h.useCallback(async()=>{await g(!0)},[g]),D=h.useCallback(()=>{Vn.clearCache(),u(Vn.getCacheStats()),console.log(" Cache cleared")},[]),A=h.useCallback(M=>t.get(M),[t]),E=h.useCallback(M=>t.has(M),[t]);h.useEffect(()=>{g()},[]),h.useEffect(()=>{const M=setInterval(()=>{u(Vn.getCacheStats())},3e4);return()=>clearInterval(M)},[]);const T={allEmployees:s,employeesData:t,loading:i,error:o,filteredEmployees:_(),filters:f,cacheStats:d,lastLoadTime:m,loadAllEmployees:g,loadEmployeeData:x,updateEmployeeData:b,addEmployeeToState:N,rollbackEmployeeAdd:k,removeEmployeeFromState:j,updateFilters:S,refreshData:C,clearCache:D,getEmployeeById:A,isEmployeeLoaded:E,getFilteredEmployees:_};return r.jsx(Vk.Provider,{value:T,children:e})};class vo extends le.Component{constructor(n){super(n);Xe(this,"handleRetry",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(n){return{hasError:!0}}componentDidCatch(n,s){this.setState({error:n,errorInfo:s}),console.error("Employee Profile Tab Error:",n,s)}render(){var n;if(this.state.hasError){const{tabName:s="Tab"}=this.props;return r.jsx("div",{className:"space-y-6",children:r.jsxs("div",{className:"bg-white rounded-lg border border-red-200 p-6 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:r.jsx(dt,{className:"w-5 h-5 text-red-600"})}),r.jsxs("div",{children:[r.jsxs("h3",{className:"font-semibold text-gray-900",children:["Error Loading ",s]}),r.jsxs("p",{className:"text-sm text-gray-600",children:["There was an issue loading the ",s.toLowerCase()," data for this employee."]})]})]}),r.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:[r.jsx("p",{className:"text-sm text-red-700 font-medium mb-1",children:"Error Details:"}),r.jsx("p",{className:"text-sm text-red-600",children:((n=this.state.error)==null?void 0:n.message)||"An unexpected error occurred"})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsxs(H,{variant:"outline",onClick:this.handleRetry,className:"flex items-center gap-2",children:[r.jsx(Be,{className:"w-4 h-4"}),"Try Again"]}),r.jsx(H,{variant:"ghost",onClick:()=>console.log("Error Details:",this.state.error,this.state.errorInfo),className:"text-sm",children:"View Technical Details"})]}),r.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:r.jsxs("p",{className:"text-sm text-blue-700",children:[r.jsx("strong",{children:"Troubleshooting:"})," This error is isolated to this tab only. You can still access other tabs and employee information. If the problem persists, the employee may have incomplete data that needs to be updated."]})})]})})}return this.props.children}}const L3=()=>{var S,_,C,D,A,E,T,M;const{selectedEmployee:e,refreshEmployeeData:t}=ua(),[n,s]=h.useState(!1),[a,i]=h.useState({}),[l,o]=h.useState(!1),[c,d]=h.useState(null);h.useEffect(()=>{e&&(s(!1),i({}),d(null),o(!1))},[e==null?void 0:e.id]);const u=()=>{i({email:e.email||"",phone:e.phone||"",location:v(),mainOffice:e.mainOffice||v(),timezone:e.timezone||"EST",department:e.department||""}),s(!0),d(null)},m=()=>{s(!1),i({}),d(null)},p=async()=>{o(!0),d(null);try{const L={...e,email:a.email,phone:a.phone,location:a.location,mainOffice:a.mainOffice,timezone:a.timezone,department:a.department},P=await fetch(`http://localhost:7001/api/employees/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(L)});if(!P.ok)throw new Error(`Failed to update employee: ${P.statusText}`);await P.json(),t&&await t(),s(!1),i({})}catch(L){console.error("Error updating contact information:",L),d("Failed to update contact information. Please try again.")}finally{o(!1)}},f=(L,P)=>{i($=>({...$,[L]:P}))};if(!e)return r.jsx("div",{className:"space-y-6",children:r.jsx("div",{className:"bg-white rounded-lg border border-yellow-200 p-6 shadow-sm",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(dt,{className:"w-5 h-5 text-yellow-600"}),r.jsx("p",{className:"text-gray-600",children:"No employee data available."})]})})});const y=()=>{try{return e!=null&&e.skills&&typeof e.skills=="object"?e.skills:{technical:[],domain:[],methodologies:[],certifications:[]}}catch(L){return console.warn("Error parsing skills:",L),{technical:[],domain:[],methodologies:[],certifications:[]}}},g=()=>{try{return e!=null&&e.languages&&Array.isArray(e.languages)?e.languages:[]}catch(L){return console.warn("Error parsing languages:",L),[]}},x=()=>{try{return e!=null&&e.experiences&&Array.isArray(e.experiences)?e.experiences:[]}catch(L){return console.warn("Error parsing experiences:",L),[]}},b=()=>{try{return e!=null&&e.mbti_profile&&typeof e.mbti_profile=="object"?e.mbti_profile:{type:"",nickname:"",percentages:{extravert:50,intuitive:50,thinking:50,judging:50},workingStyle:[],communicationPreferences:[],idealCollaboration:""}}catch(L){return console.warn("Error parsing MBTI profile:",L),{type:"",nickname:"",percentages:{extravert:50,intuitive:50,thinking:50,judging:50},workingStyle:[],communicationPreferences:[],idealCollaboration:""}}},v=()=>{var L;try{return typeof e.location=="object"&&((L=e.location)!=null&&L.city)?e.location.city:typeof e.location=="string"?e.location:"Not specified"}catch(P){return console.warn("Error parsing location:",P),"Not specified"}},w=y(),N=g(),k=x(),j=b();return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"bg-white rounded-lg border p-5 shadow-sm",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[r.jsx(Dt,{className:"w-5 h-5 text-purple-600"}),"Contact Information"]}),!n&&r.jsxs("button",{onClick:u,className:"flex items-center gap-2 px-3 py-1 text-sm text-gray-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",children:[r.jsx(Ms,{className:"w-4 h-4"}),"Edit"]})]}),c&&r.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:r.jsxs("div",{className:"flex items-center gap-2 text-red-800 text-sm",children:[r.jsx(dt,{className:"w-4 h-4"}),c]})}),n?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),r.jsx("input",{type:"email",value:a.email||"",onChange:L=>f("email",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm",placeholder:"Enter email address"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),r.jsx("input",{type:"tel",value:a.phone||"",onChange:L=>f("phone",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm",placeholder:"Enter phone number"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Main Office"}),r.jsx("input",{type:"text",value:a.mainOffice||"",onChange:L=>f("mainOffice",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm",placeholder:"Enter main office location"})]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Location"}),r.jsx("input",{type:"text",value:a.location||"",onChange:L=>f("location",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm",placeholder:"Enter current location"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Timezone"}),r.jsxs("select",{value:a.timezone||"EST",onChange:L=>f("timezone",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm",children:[r.jsx("option",{value:"EST",children:"Eastern (EST)"}),r.jsx("option",{value:"CST",children:"Central (CST)"}),r.jsx("option",{value:"MST",children:"Mountain (MST)"}),r.jsx("option",{value:"PST",children:"Pacific (PST)"}),r.jsx("option",{value:"GMT",children:"GMT"}),r.jsx("option",{value:"CET",children:"Central European (CET)"}),r.jsx("option",{value:"JST",children:"Japan (JST)"}),r.jsx("option",{value:"AEST",children:"Australian Eastern (AEST)"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),r.jsx("input",{type:"text",value:a.department||"",onChange:L=>f("department",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm",placeholder:"Enter department"})]})]})]}),r.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[r.jsxs("button",{onClick:p,disabled:l,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium transition-colors",children:[r.jsx($n,{className:"w-4 h-4"}),l?"Saving...":"Save Changes"]}),r.jsxs("button",{onClick:m,disabled:l,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 disabled:opacity-50 text-sm font-medium transition-colors",children:[r.jsx(Ze,{className:"w-4 h-4"}),"Cancel"]})]})]}):r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-3 text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Dt,{className:"w-4 h-4 text-gray-400"}),r.jsx("span",{children:e.email||"Email not provided"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(sn,{className:"w-4 h-4 text-gray-400"}),r.jsx("span",{children:e.phone||"+1 (555) 123-4567"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(qt,{className:"w-4 h-4 text-gray-400"}),r.jsxs("span",{children:["Main Office: ",e.mainOffice||v()]})]})]}),r.jsxs("div",{className:"space-y-3 text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(vn,{className:"w-4 h-4 text-gray-400"}),r.jsxs("span",{children:["Location: ",v()]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(jt,{className:"w-4 h-4 text-gray-400"}),r.jsxs("span",{children:["Timezone: ",e.timezone||"EST"]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ko,{className:"w-4 h-4 text-gray-400"}),r.jsxs("span",{children:["Department: ",e.department||"Not specified"]})]})]})]})]}),r.jsxs("div",{className:"bg-white rounded-lg border p-5 shadow-sm",children:[r.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(Ml,{className:"w-5 h-5 text-purple-600"}),"Skills"]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Technical Skills"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:w.technical&&w.technical.length>0?w.technical.map((L,P)=>r.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium",children:L},P)):r.jsx("span",{className:"text-gray-500 text-sm",children:"No technical skills data available"})})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Domain Expertise"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:w.domain&&w.domain.length>0?w.domain.map((L,P)=>r.jsx("span",{className:"px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium",children:L},P)):r.jsx("span",{className:"text-gray-500 text-sm",children:"No domain expertise data available"})})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Methodologies"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:w.methodologies&&w.methodologies.length>0?w.methodologies.map((L,P)=>r.jsx("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-medium",children:L},P)):r.jsx("span",{className:"text-gray-500 text-sm",children:"No methodologies data available"})})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Certifications"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:w.certifications&&w.certifications.length>0?w.certifications.map((L,P)=>r.jsx("span",{className:"px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs font-medium",children:L},P)):r.jsx("span",{className:"text-gray-500 text-sm",children:"No certifications data available"})})]})]})]}),r.jsxs("div",{className:"bg-white rounded-lg border p-5 shadow-sm",children:[r.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(Kr,{className:"w-5 h-5 text-purple-600"}),"Languages"]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:N.length>0?N.map((L,P)=>r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm font-medium",children:L.name||"Unknown Language"}),r.jsx("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded-full",children:L.level||"Unknown"})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:r.jsx("div",{className:"bg-gradient-to-r from-green-500 to-blue-500 h-1.5 rounded-full",style:{width:`${L.percentage||50}%`}})})]},P)):r.jsx("div",{className:"col-span-4 text-center text-gray-500 text-sm py-4",children:"No languages data available"})})]}),r.jsxs("div",{className:"bg-white rounded-lg border p-5 shadow-sm",children:[r.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(Ko,{className:"w-5 h-5 text-purple-600"}),"Past Experience"]}),r.jsx("div",{className:"space-y-6",children:k.length>0?k.map((L,P)=>r.jsxs("div",{className:"relative pl-8 pb-6 border-l-2 border-gray-200 last:border-0 last:pb-0",children:[r.jsx("div",{className:"absolute left-[-8px] top-0 w-4 h-4 bg-purple-100 border-2 border-purple-500 rounded-full"}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("h4",{className:"font-medium text-gray-900",children:L.company||"Unknown Company"}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm text-gray-700",children:L.role||"Unknown Role"}),r.jsx("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded-full",children:L.period||"Unknown Period"})]}),r.jsx("p",{className:"text-sm text-gray-500",children:L.description||"No description available"})]})]},P)):r.jsx("div",{className:"text-center text-gray-500 text-sm py-4",children:"No past experience data available"})})]}),r.jsxs("div",{className:"bg-white rounded-lg border p-5 shadow-sm",children:[r.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(Br,{className:"w-5 h-5 text-purple-600"}),"MBTI Personality"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{className:"flex flex-col items-center justify-center p-4 bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg",children:[r.jsx("div",{className:"text-4xl font-bold text-purple-700 mb-2",children:j.type||"N/A"}),r.jsxs("p",{className:"text-sm text-center text-gray-600",children:['"',j.nickname||"No nickname available",'"']}),j.percentages&&r.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 w-full",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-xs text-gray-500",children:(S=j.type)!=null&&S.includes("E")?"Extravert":"Introvert"}),r.jsxs("div",{className:"font-medium",children:[(_=j.type)!=null&&_.includes("E")?j.percentages.extravert:j.percentages.introvert||50,"%"]})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-xs text-gray-500",children:(C=j.type)!=null&&C.includes("N")?"Intuitive":"Sensing"}),r.jsxs("div",{className:"font-medium",children:[(D=j.type)!=null&&D.includes("N")?j.percentages.intuitive:j.percentages.sensing||50,"%"]})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-xs text-gray-500",children:(A=j.type)!=null&&A.includes("T")?"Thinking":"Feeling"}),r.jsxs("div",{className:"font-medium",children:[(E=j.type)!=null&&E.includes("T")?j.percentages.thinking:j.percentages.feeling||50,"%"]})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-xs text-gray-500",children:(T=j.type)!=null&&T.includes("J")?"Judging":"Perceiving"}),r.jsxs("div",{className:"font-medium",children:[(M=j.type)!=null&&M.includes("J")?j.percentages.judging:j.percentages.perceiving||50,"%"]})]})]})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900",children:"Working Style"}),j.workingStyle&&j.workingStyle.length>0?r.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-gray-600",children:j.workingStyle.map((L,P)=>r.jsx("li",{children:L},P))}):r.jsx("p",{className:"text-sm text-gray-500",children:"No working style data available"})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mt-3",children:"Communication Preferences"}),j.communicationPreferences&&j.communicationPreferences.length>0?r.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-gray-600",children:j.communicationPreferences.map((L,P)=>r.jsx("li",{children:L},P))}):r.jsx("p",{className:"text-sm text-gray-500",children:"No communication preferences data available"})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mt-3",children:"Ideal Collaboration Environment"}),r.jsx("p",{className:"text-sm text-gray-600",children:j.idealCollaboration||"No ideal collaboration data available"})]})]})]})]})]})},R3=()=>{var B,V,re,Me,he,G;const{selectedEmployee:e,refreshEmployeeData:t}=ua(),[n,s]=h.useState(null),[a,i]=h.useState(!0),[l,o]=h.useState(null),[c,d]=h.useState(null),[u,m]=h.useState(""),[p,f]=h.useState(""),[y,g]=h.useState([]),[x,b]=h.useState(!1),[v,w]=h.useState([]),[N,k]=h.useState(!1),[j,S]=h.useState({date:"",highlights:[]}),[_,C]=h.useState(!1),[D,A]=h.useState([]);h.useEffect(()=>{(async()=>{if(e!=null&&e.id){i(!0),o(null);try{const[Q,ue]=await Promise.all([zr.getEmployeePerformance(e.id),zr.getEmployeeGoals(e.id).catch(()=>[])]);s(Q),g(ue||[])}catch(Q){console.error("Error fetching employee performance:",Q),o("Failed to load performance data")}finally{i(!1)}}})()},[e==null?void 0:e.id]);const E=()=>{const Q=((n==null?void 0:n.projects)||[]).map(ue=>({id:ue.id||Date.now()+Math.random(),name:ue.name||"",description:ue.description||"",year:ue.year||new Date().getFullYear(),status:ue.status||"In Progress",revenue:ue.revenue||0}));w(Q),b(!0)},T=()=>{b(!1),w([])},M=()=>{const q={id:Date.now()+Math.random(),name:"",description:"",year:new Date().getFullYear(),status:"In Progress",revenue:0};w([...v,q])},L=q=>{w(v.filter((Q,ue)=>ue!==q))},P=(q,Q,ue)=>{w(Le=>Le.map((ge,Se)=>Se===q?{...ge,[Q]:ue}:ge))},$=async()=>{i(!0),o(null);try{const q=v.filter(ge=>ge.name.trim()!==""||ge.description.trim()!==""),Q={...n,projects:q,employee_id:e.id},ue=await fetch(`http://localhost:7001/api/employees/${e.id}/performance`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Q)});if(!ue.ok)throw new Error(`Failed to update projects: ${ue.statusText}`);await t();const Le=await zr.getEmployeePerformance(e.id);s(Le),b(!1),w([])}catch(q){console.error("Error updating projects:",q),o("Failed to update projects. Please try again.")}finally{i(!1)}},R=()=>{const q=(n==null?void 0:n.self_assessments)||{};S({date:q.date||new Date().toISOString().split("T")[0],highlights:Array.isArray(q.highlights)?[...q.highlights]:[]}),k(!0)},U=()=>{k(!1),S({date:"",highlights:[]})},I=()=>{S(q=>({...q,highlights:[...q.highlights,""]}))},z=q=>{S(Q=>({...Q,highlights:Q.highlights.filter((ue,Le)=>Le!==q)}))},F=(q,Q)=>{S(ue=>({...ue,highlights:ue.highlights.map((Le,ge)=>ge===q?Q:Le)}))},O=async()=>{i(!0),o(null);try{const q=j.highlights.filter(ge=>ge.trim()!==""),Q={...n,self_assessments:{date:j.date,highlights:q},employee_id:e.id},ue=await fetch(`http://localhost:7001/api/employees/${e.id}/performance`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Q)});if(!ue.ok)throw new Error(`Failed to update self-assessment: ${ue.statusText}`);await t();const Le=await zr.getEmployeePerformance(e.id);s(Le),k(!1),S({date:"",highlights:[]})}catch(q){console.error("Error updating self-assessment:",q),o("Failed to update self-assessment. Please try again.")}finally{i(!1)}},K=()=>{const Q=((n==null?void 0:n.milestones)||[]).map(ue=>({id:ue.id||Date.now()+Math.random(),label:ue.label||"",year:ue.year||new Date().getFullYear(),icon:"Star",iconColor:"text-yellow-600"}));A(Q),C(!0)},J=()=>{C(!1),A([])},se=()=>{const q={id:Date.now()+Math.random(),label:"",year:new Date().getFullYear(),icon:"Star",iconColor:"text-yellow-600"};A([...D,q])},Z=q=>{A(Q=>Q.filter((ue,Le)=>Le!==q))},oe=(q,Q,ue)=>{A(Le=>Le.map((ge,Se)=>Se===q?{...ge,[Q]:ue}:ge))},W=async()=>{i(!0),o(null);try{const q=D.filter(ge=>ge.label.trim()!==""),Q={...n,milestones:q,employee_id:e.id},ue=await fetch(`http://localhost:7001/api/employees/${e.id}/performance`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Q)});if(!ue.ok)throw new Error(`Failed to update milestones: ${ue.statusText}`);await t();const Le=await zr.getEmployeePerformance(e.id);s(Le),C(!1),A([])}catch(q){console.error("Error updating milestones:",q),o("Failed to update milestones. Please try again.")}finally{i(!1)}};return e?a?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"bg-white rounded-lg border p-5 shadow-sm",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded-full animate-pulse"}),r.jsx("div",{className:"h-5 w-32 bg-gray-200 rounded animate-pulse"})]}),r.jsx("div",{className:"h-9 w-40 bg-gray-200 rounded-lg animate-pulse"})]}),[...Array(2)].map((q,Q)=>r.jsx("div",{className:`py-3 ${Q===0?"border-b":""}`,children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"h-4 w-64 bg-gray-200 rounded animate-pulse mb-2"}),r.jsx("div",{className:"h-3 w-40 bg-gray-100 rounded animate-pulse mb-2"}),r.jsx("div",{className:"w-full bg-gray-200 rounded h-1.5",children:r.jsx("div",{className:"h-1.5 bg-gray-300 rounded animate-pulse",style:{width:"60%"}})})]}),r.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[r.jsx("div",{className:"h-9 w-36 bg-gray-200 rounded-lg animate-pulse"}),r.jsx("div",{className:"h-9 w-20 bg-gray-200 rounded-lg animate-pulse"}),r.jsx("div",{className:"h-9 w-24 bg-gray-200 rounded-lg animate-pulse"})]})]})},Q))]}),r.jsxs("div",{className:"bg-white rounded-lg border p-5 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded-full animate-pulse"}),r.jsx("div",{className:"h-5 w-32 bg-gray-200 rounded animate-pulse"})]}),r.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx("div",{className:"h-8 w-24 bg-gray-200 rounded animate-pulse"}),r.jsx("div",{className:"h-8 w-48 bg-gray-200 rounded animate-pulse"})]}),r.jsx("div",{className:"space-y-3",children:[...Array(3)].map((q,Q)=>r.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[r.jsxs("div",{children:[r.jsx("div",{className:"h-4 w-48 bg-gray-200 rounded animate-pulse mb-1"}),r.jsx("div",{className:"h-3 w-32 bg-gray-100 rounded animate-pulse"})]}),r.jsx("div",{className:"h-6 w-16 bg-gray-200 rounded animate-pulse"})]},Q))})]}),r.jsxs("div",{className:"bg-white rounded-lg border p-5 shadow-sm",children:[r.jsx("div",{className:"h-5 w-40 bg-gray-200 rounded animate-pulse mb-4"}),r.jsx("div",{className:"flex flex-wrap gap-3",children:[...Array(5)].map((q,Q)=>r.jsx("div",{className:"h-7 w-32 bg-gray-200 rounded-full animate-pulse"},Q))})]}),r.jsxs("div",{className:"bg-white rounded-lg border p-5 shadow-sm",children:[r.jsx("div",{className:"h-5 w-44 bg-gray-200 rounded animate-pulse mb-4"}),r.jsxs("div",{className:"flex items-center gap-8 mb-2",children:[r.jsx("div",{className:"h-7 w-12 bg-gray-200 rounded animate-pulse"}),r.jsx("div",{className:"h-6 w-10 bg-gray-200 rounded animate-pulse"})]}),r.jsx("div",{className:"h-4 w-28 bg-gray-200 rounded animate-pulse mb-2"}),r.jsx("div",{className:"space-y-2",children:[...Array(3)].map((q,Q)=>r.jsx("div",{className:"h-3 w-64 bg-gray-100 rounded animate-pulse"},Q))})]}),r.jsxs("div",{className:"bg-white rounded-lg border p-5 shadow-sm",children:[r.jsx("div",{className:"h-5 w-40 bg-gray-200 rounded animate-pulse mb-4"}),r.jsx("div",{className:"h-3 w-48 bg-gray-100 rounded animate-pulse mb-3"}),r.jsx("div",{className:"h-4 w-28 bg-gray-200 rounded animate-pulse mb-2"}),r.jsx("div",{className:"space-y-2",children:[...Array(3)].map((q,Q)=>r.jsx("div",{className:"h-3 w-64 bg-gray-100 rounded animate-pulse"},Q))})]})]}):l||!n?r.jsx("div",{className:"space-y-6",children:r.jsx("div",{className:"bg-white rounded-lg border p-5 shadow-sm",children:r.jsx("p",{className:"text-gray-500",children:l||"No performance data available for this employee."})})}):r.jsx("div",{className:"bg-gray-50 min-h-[600px]",children:r.jsx("div",{className:"py-4 px-5",children:r.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-10 gap-4",children:[r.jsxs("div",{className:"xl:col-span-7 space-y-4",children:[r.jsx("div",{className:"bg-white border border-gray-200 rounded-lg",children:r.jsx(kA,{employeeId:e.id,goals:y,setGoals:g,skipInitialLoad:!0,renderHeader:(q,Q)=>r.jsxs("div",{className:"flex items-center justify-between px-6 pt-6 pb-4 border-b border-gray-200",children:[r.jsxs("h3",{className:"text-lg font-bold text-black font-[Inter] flex items-center gap-2",children:[r.jsx(Er,{className:"w-5 h-5 text-green-600"}),"Goal Setting"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[q&&r.jsxs("button",{onClick:q,className:"flex items-center gap-2 px-3 py-1 text-sm text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",children:[r.jsx(Ms,{className:"w-4 h-4"}),"Edit"]}),r.jsxs(H,{size:"xs",onClick:Q,className:"flex items-center gap-2 px-3 py-1.5 text-xs bg-indigo-950 text-white hover:bg-indigo-950/90",children:[r.jsx(Wt,{className:"w-3 h-3"}),"Add Goal"]})]})]})})}),r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center justify-between px-6 pt-6 pb-4 border-b border-gray-200",children:[r.jsxs("h3",{className:"text-lg font-bold text-black font-[Inter] flex items-center gap-2",children:[r.jsx(Ot,{className:"w-5 h-5 text-green-600"}),"Past Projects"]}),!x&&r.jsxs("button",{onClick:E,className:"flex items-center gap-2 px-3 py-1 text-sm text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",children:[r.jsx(Ms,{className:"w-4 h-4"}),"Edit"]})]}),r.jsx("div",{className:"p-6",children:x?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h4",{className:"text-base font-medium text-gray-900",children:"Projects"}),r.jsxs(H,{variant:"ghost",size:"sm",onClick:M,className:"flex items-center gap-1 text-green-600 hover:text-green-700 hover:bg-green-50 text-sm",children:[r.jsx(Wt,{className:"w-3 h-3"}),"Add"]})]}),r.jsxs("div",{className:"space-y-4",children:[v.map((q,Q)=>r.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("h5",{className:"text-sm font-medium text-gray-700",children:["Project #",Q+1]}),r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>L(Q),className:"text-red-600 hover:text-red-700 hover:bg-red-50 p-1",children:r.jsx(fr,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Project Name *"}),r.jsx("input",{type:"text",value:q.name,onChange:ue=>P(Q,"name",ue.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",placeholder:"Enter project name"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Year"}),r.jsx("input",{type:"number",value:q.year,onChange:ue=>P(Q,"year",parseInt(ue.target.value)||new Date().getFullYear()),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",min:"2000",max:"2030"})]}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),r.jsx("textarea",{value:q.description,onChange:ue=>P(Q,"description",ue.target.value),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",placeholder:"Enter project description"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),r.jsxs("select",{value:q.status,onChange:ue=>P(Q,"status",ue.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",children:[r.jsx("option",{value:"In Progress",children:"In Progress"}),r.jsx("option",{value:"Completed",children:"Completed"}),r.jsx("option",{value:"On Hold",children:"On Hold"}),r.jsx("option",{value:"Cancelled",children:"Cancelled"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Revenue ($)"}),r.jsx("input",{type:"number",value:q.revenue,onChange:ue=>P(Q,"revenue",parseFloat(ue.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",min:"0",step:"1000",placeholder:"0"})]})]})]},Q)),v.length===0&&r.jsx("p",{className:"text-gray-500 text-sm italic text-center py-4",children:'No projects added yet. Click "Add" to create your first project.'})]}),r.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t",children:[r.jsxs(H,{onClick:$,disabled:a,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white disabled:opacity-50",children:[r.jsx($n,{className:"w-4 h-4"}),a?"Saving...":"Save Changes"]}),r.jsxs(H,{variant:"outline",onClick:T,disabled:a,className:"flex items-center gap-2",children:[r.jsx(Ze,{className:"w-4 h-4"}),"Cancel"]})]})]}):r.jsx(r.Fragment,{children:(()=>{const q=n.projects||[],Q=Array.from(new Set(q.map(Le=>Le.year))).sort((Le,ge)=>ge-Le);u||m("all");const ue=q.filter(Le=>(u==="all"||Le.year.toString()===u)&&(!p||Le.name.toLowerCase().includes(p.toLowerCase())||Le.description.toLowerCase().includes(p.toLowerCase())));return r.jsxs(r.Fragment,{children:[q.length>0&&r.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[r.jsxs("select",{className:"border rounded px-2 py-1 text-sm",value:u,onChange:Le=>m(Le.target.value),children:[r.jsx("option",{value:"all",children:"All"}),Q.map(Le=>r.jsx("option",{value:Le,children:Le},Le))]}),r.jsx("input",{type:"text",placeholder:"Search projects...",className:"border rounded px-3 py-1 text-sm flex-1",value:p,onChange:Le=>f(Le.target.value)})]}),ue.length>0?r.jsx("div",{className:"space-y-3",children:ue.map((Le,ge)=>{var Se;return r.jsx("div",{className:"border rounded-lg p-3 hover:bg-gray-50 cursor-pointer",onClick:()=>d(Le),children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900",children:Le.name}),r.jsx("p",{className:"text-sm text-gray-600",children:Le.description}),r.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[r.jsxs("span",{className:"text-xs text-gray-500",children:[Le.year,"  ",Le.status]}),r.jsxs("span",{className:"text-xs text-green-600",children:["$",(Se=Le.revenue)==null?void 0:Se.toLocaleString()]})]})]}),r.jsx("button",{className:"text-blue-600 text-sm hover:underline",children:"View"})]})},ge)})}):r.jsx("div",{className:"text-center py-8 text-gray-500",children:q.length===0?'No projects added yet. Click "Edit" to add your first project!':p?"No projects match your search.":"No projects found."})]})})()})})]}),r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[r.jsx("div",{className:"flex items-center justify-between px-6 pt-6 pb-4 border-b border-gray-200",children:r.jsxs("h3",{className:"text-lg font-bold text-black font-[Inter] flex items-center gap-2",children:[r.jsx(kt,{className:"w-5 h-5 text-green-600"}),"Peer Evaluations"]})}),r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"flex items-center gap-8 mb-2",children:[r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx("span",{className:"text-2xl font-bold text-green-700",children:((B=n.peer_evaluations)==null?void 0:B.averageScore)||"N/A"}),r.jsx("span",{className:"text-xs text-gray-500",children:"Avg Score"})]}),r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsx("span",{className:"text-lg font-bold text-purple-700",children:((V=n.peer_evaluations)==null?void 0:V.totalReviews)||"N/A"}),r.jsx("span",{className:"text-xs text-gray-500",children:"Reviews"})]})]}),r.jsx("div",{className:"text-sm font-medium text-gray-800 mb-2",children:"Top Feedback"}),r.jsx("ul",{className:"space-y-1 text-sm text-gray-600",children:(((re=n.peer_evaluations)==null?void 0:re.feedback)||[]).length>0?n.peer_evaluations.feedback.map((q,Q)=>r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-green-600 mt-0.5",children:""}),r.jsxs("span",{children:['"',q,'"']})]},Q)):r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-gray-400 mt-0.5",children:""}),r.jsx("span",{className:"text-gray-500",children:"No feedback available yet"})]})})]})]}),r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center justify-between px-6 pt-6 pb-4 border-b border-gray-200",children:[r.jsxs("h3",{className:"text-lg font-bold text-black font-[Inter] flex items-center gap-2",children:[r.jsx(_t,{className:"w-5 h-5 text-green-600"}),"Self-Assessments"]}),!N&&r.jsxs("button",{onClick:R,className:"flex items-center gap-2 px-3 py-1 text-sm text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",children:[r.jsx(Ms,{className:"w-4 h-4"}),"Edit"]})]}),r.jsx("div",{className:"p-6",children:N?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assessment Date"}),r.jsx("input",{type:"date",value:j.date,onChange:q=>S(Q=>({...Q,date:q.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm"})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Highlights & Strengths"}),r.jsxs(H,{variant:"ghost",size:"sm",onClick:I,className:"flex items-center gap-1 text-green-600 hover:text-green-700 hover:bg-green-50 text-sm",children:[r.jsx(Wt,{className:"w-3 h-3"}),"Add"]})]}),r.jsxs("div",{className:"space-y-3",children:[j.highlights.map((q,Q)=>r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"flex-1",children:r.jsx("textarea",{value:q,onChange:ue=>F(Q,ue.target.value),placeholder:"Describe a key strength or achievement...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",rows:2})}),r.jsx(H,{type:"button",size:"xs",variant:"outline",onClick:()=>z(Q),className:"mt-1 text-red-600 hover:bg-red-50 border-red-300",children:r.jsx(fr,{className:"w-3 h-3"})})]},Q)),j.highlights.length===0&&r.jsx("p",{className:"text-gray-500 text-sm italic text-center py-4",children:'No highlights added yet. Click "Add" to create your first highlight.'})]})]}),r.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t",children:[r.jsxs(H,{onClick:O,disabled:a,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white disabled:opacity-50",children:[r.jsx($n,{className:"w-4 h-4"}),a?"Saving...":"Save Changes"]}),r.jsxs(H,{variant:"outline",onClick:U,disabled:a,className:"flex items-center gap-2",children:[r.jsx(Ze,{className:"w-4 h-4"}),"Cancel"]})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"text-sm text-gray-500 mb-3",children:["Most Recent: ",((Me=n.self_assessments)==null?void 0:Me.date)||"No assessment date available"]}),r.jsx("div",{className:"text-sm font-medium text-gray-800 mb-2",children:"Highlights"}),r.jsx("ul",{className:"space-y-1 text-sm text-gray-600",children:(((he=n.self_assessments)==null?void 0:he.highlights)||[]).length>0?n.self_assessments.highlights.map((q,Q)=>r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-green-600 mt-0.5",children:""}),r.jsxs("span",{children:['Strength: "',q,'"']})]},Q)):r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-gray-400 mt-0.5",children:""}),r.jsx("span",{className:"text-gray-500",children:"No self-assessment data available yet"})]})})]})})]})]}),r.jsxs("div",{className:"col-span-3 space-y-4",children:[r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[r.jsx(Ot,{className:"w-5 h-5 text-green-600"}),"Performance Overview"]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Total Revenue"}),r.jsxs("p",{className:"text-2xl font-bold text-blue-700",children:["$",((G=n.total_revenue)==null?void 0:G.toLocaleString())||"0"]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Total Projects"}),r.jsx("p",{className:"text-2xl font-bold text-purple-700",children:(n.projects||[]).length})]}),r.jsxs("div",{className:"mt-4",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-3",children:"Projects"}),r.jsx("div",{className:"space-y-2",children:(n.top_projects||[]).map((q,Q)=>{var ue;return r.jsxs("div",{className:"flex justify-between items-center text-sm",children:[r.jsx("span",{className:"text-gray-900 font-medium",children:q.name}),r.jsxs("span",{className:"text-gray-600",children:["$",(ue=q.revenue)==null?void 0:ue.toLocaleString()]})]},Q)})})]})]})]}),r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center justify-between px-6 pt-6 pb-4 border-b border-gray-200",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[r.jsx(Vi,{className:"w-5 h-5 text-green-600"}),"Milestones Achieved"]}),!_&&r.jsxs("button",{onClick:K,className:"flex items-center gap-2 px-3 py-1 text-sm text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",children:[r.jsx(Ms,{className:"w-4 h-4"}),"Edit"]})]}),r.jsx("div",{className:"p-6",children:_?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h4",{className:"text-base font-medium text-gray-900",children:"Milestones"}),r.jsxs(H,{variant:"ghost",size:"sm",onClick:se,className:"flex items-center gap-1 text-green-600 hover:text-green-700 hover:bg-green-50 text-sm",children:[r.jsx(Wt,{className:"w-3 h-3"}),"Add"]})]}),r.jsxs("div",{className:"space-y-4",children:[D.map((q,Q)=>r.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"w-6 h-6 bg-yellow-100 rounded-full flex items-center justify-center flex-shrink-0 mt-1",children:r.jsx(on,{className:"w-3 h-3 text-yellow-600"})}),r.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Milestone Achievement"}),r.jsx("input",{type:"text",value:q.label,onChange:ue=>oe(Q,"label",ue.target.value),placeholder:"e.g., Technical Excellence Award",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Year"}),r.jsx("input",{type:"number",value:q.year,onChange:ue=>oe(Q,"year",parseInt(ue.target.value)||new Date().getFullYear()),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",min:"2000",max:"2030"})]})]}),r.jsx(H,{type:"button",size:"xs",variant:"outline",onClick:()=>Z(Q),className:"text-red-600 hover:bg-red-50 border-red-300 mt-6",children:r.jsx(fr,{className:"w-3 h-3"})})]})},q.id)),D.length===0&&r.jsx("p",{className:"text-gray-500 text-sm italic text-center py-4",children:'No milestones added yet. Click "Add" to create your first milestone.'})]}),r.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t",children:[r.jsxs(H,{onClick:W,disabled:a,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white disabled:opacity-50",children:[r.jsx($n,{className:"w-4 h-4"}),a?"Saving...":"Save Changes"]}),r.jsxs(H,{variant:"outline",onClick:J,disabled:a,className:"flex items-center gap-2",children:[r.jsx(Ze,{className:"w-4 h-4"}),"Cancel"]})]})]}):r.jsxs("div",{className:"space-y-3",children:[(n.milestones||[]).map((q,Q)=>r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-6 h-6 bg-yellow-100 rounded-full flex items-center justify-center",children:r.jsx(on,{className:"w-3 h-3 text-yellow-600"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:q==null?void 0:q.label}),r.jsxs("div",{className:"text-xs text-gray-500",children:["(",q==null?void 0:q.year,")"]})]})]},Q)),(n.milestones||[]).length===0&&r.jsx("div",{className:"text-center py-4",children:r.jsx("span",{className:"text-gray-500 text-sm",children:"No milestones recorded yet."})})]})})]})]})]})})}):r.jsx("div",{className:"space-y-6",children:r.jsx("div",{className:"bg-white rounded-lg border p-5 shadow-sm",children:r.jsx("p",{className:"text-gray-500",children:"No employee selected."})})})},qs=le.forwardRef(({icon:e,variant:t="ghost",size:n="icon",className:s,children:a,...i},l)=>r.jsxs(H,{ref:l,variant:t,size:n,className:tr("flex items-center justify-center",s),...i,children:[e&&r.jsx(e,{className:a?"mr-2":"",size:16}),a]}));qs.displayName="IconButton";const $3=le.forwardRef(({variant:e="default",size:t="default",color:n="primary",fullWidth:s=!1,className:a,children:i,...l},o)=>{const c={primary:"default",secondary:"secondary",success:"default",warning:"outline",danger:"destructive",info:"outline"};return r.jsx(H,{ref:o,variant:c[n]||e,size:t,className:tr({"w-full":s,"bg-green-600 hover:bg-green-700":n==="success"&&e==="default","bg-yellow-600 hover:bg-yellow-700":n==="warning"&&e==="default","bg-blue-600 hover:bg-blue-700":n==="info"&&e==="default"},a),...l,children:i})});$3.displayName="ActionButton";const F3=le.forwardRef(({className:e,children:t,striped:n=!1,bordered:s=!0,hover:a=!0,...i},l)=>r.jsx("div",{className:"relative w-full overflow-auto",children:r.jsx("table",{ref:l,className:tr("w-full caption-bottom text-sm",{"border-collapse border border-gray-200":s,"[&_tbody_tr:nth-child(even)]:bg-gray-50":n,"[&_tbody_tr:hover]:bg-gray-100":a},e),...i,children:t})}));F3.displayName="Table";const z3=le.forwardRef(({className:e,children:t,...n},s)=>r.jsx("thead",{ref:s,className:tr("bg-gray-50 border-b border-gray-200",e),...n,children:t}));z3.displayName="TableHeader";const B3=le.forwardRef(({className:e,children:t,variant:n="default",...s},a)=>r.jsx("tr",{ref:a,className:tr("border-b transition-colors",{"hover:bg-muted/50 data-[state=selected]:bg-muted":n==="default","bg-red-50 border-red-200":n==="danger","bg-green-50 border-green-200":n==="success","bg-yellow-50 border-yellow-200":n==="warning"},e),...s,children:t}));B3.displayName="TableRow";const U3=le.forwardRef(({className:e,children:t,header:n=!1,align:s="left",...a},i)=>{const l=n?"th":"td";return r.jsx(l,{ref:i,className:tr("px-4 py-3",{"text-left text-xs font-medium text-gray-500 uppercase tracking-wider":n,"text-sm text-gray-900":!n,"text-left":s==="left","text-center":s==="center","text-right":s==="right"},e),...a,children:t})});U3.displayName="TableCell";const $o=le.forwardRef(({label:e,id:t,error:n,required:s=!1,className:a,labelClassName:i,inputClassName:l,children:o,...c},d)=>{const u=t||(e==null?void 0:e.toLowerCase().replace(/\s+/g,"-"));return r.jsxs("div",{className:tr("space-y-2",a),children:[e&&r.jsx(ps,{htmlFor:u,className:tr("text-sm font-medium text-gray-700",{'after:content-["*"] after:ml-1 after:text-red-500':s},i),children:e}),o||r.jsx(gs,{ref:d,id:u,className:tr({"border-red-300 focus:border-red-500 focus:ring-red-500":n},l),...c}),n&&r.jsx("p",{className:"text-sm text-red-600",children:n})]})});$o.displayName="FormField";const Kk=le.forwardRef(({className:e,children:t,inline:n=!1,...s},a)=>r.jsx("div",{ref:a,className:tr("space-y-4",{"flex flex-wrap gap-4 space-y-0":n},e),...s,children:t}));Kk.displayName="FormGroup";const q3=le.forwardRef(({title:e,description:t,className:n,titleClassName:s,descriptionClassName:a,children:i,...l},o)=>r.jsxs("div",{ref:o,className:tr("space-y-6",n),...l,children:[e&&r.jsxs("div",{className:"space-y-1",children:[r.jsx("h3",{className:tr("text-lg font-semibold text-gray-900",s),children:e}),t&&r.jsx("p",{className:tr("text-sm text-gray-600",a),children:t})]}),r.jsx("div",{className:"space-y-4",children:i})]}));q3.displayName="FormSection";const H3=le.forwardRef(({className:e,children:t,size:n="default",...s},a)=>{const i={sm:"max-w-2xl",default:"max-w-7xl",lg:"max-w-full",full:"w-full"};return r.jsx("div",{ref:a,className:tr("mx-auto px-4 sm:px-6 lg:px-8",i[n],e),...s,children:t})});H3.displayName="Container";const W3=le.forwardRef(({className:e,children:t,padding:n="default",shadow:s="default",border:a=!0,...i},l)=>{const o={none:"p-0",sm:"p-4",default:"p-6",lg:"p-8"},c={none:"shadow-none",sm:"shadow-sm",default:"shadow-md",lg:"shadow-lg"};return r.jsx("div",{ref:l,className:tr("bg-white rounded-lg",o[n],c[s],{"border border-gray-200":a},e),...i,children:t})});W3.displayName="Card";const Y3=le.forwardRef(({className:e,children:t,padding:n="default",background:s="default",...a},i)=>{const l={none:"p-0",sm:"py-4",default:"py-8",lg:"py-16"},o={default:"bg-white",gray:"bg-gray-50",primary:"bg-primary",transparent:"bg-transparent"};return r.jsx("section",{ref:i,className:tr(l[n],o[s],e),...a,children:t})});Y3.displayName="Section";const V3=le.forwardRef(({level:e=1,className:t,children:n,variant:s="default",...a},i)=>{const l=`h${e}`,o={default:"text-gray-900 font-semibold",secondary:"text-gray-600 font-medium",accent:"text-primary font-bold"},c={1:"text-3xl lg:text-4xl",2:"text-2xl lg:text-3xl",3:"text-xl lg:text-2xl",4:"text-lg lg:text-xl",5:"text-base lg:text-lg",6:"text-sm lg:text-base"};return r.jsx(l,{ref:i,className:tr(o[s],c[e],"leading-tight",t),...a,children:n})});V3.displayName="Heading";const G3=le.forwardRef(({className:e,children:t,variant:n="default",size:s="base",weight:a="normal",...i},l)=>{const o={default:"text-gray-900",secondary:"text-gray-600",muted:"text-gray-500",success:"text-green-600",warning:"text-yellow-600",danger:"text-red-600"},c={xs:"text-xs",sm:"text-sm",base:"text-base",lg:"text-lg",xl:"text-xl"},d={light:"font-light",normal:"font-normal",medium:"font-medium",semibold:"font-semibold",bold:"font-bold"};return r.jsx("p",{ref:l,className:tr(o[n],c[s],d[a],e),...i,children:t})});G3.displayName="Text";const Ff=({entry:e,steps:t,setSteps:n})=>{const[s,a]=h.useState(null),[i,l]=h.useState(""),o=y=>n(g=>g.map((x,b)=>b===y?{...x,done:!x.done}:x)),c=()=>n(y=>[...y,{label:"New Step",done:!1}]),d=y=>n(g=>g.filter((x,b)=>b!==y)),u=y=>{a(y),l(t[y].label)},m=y=>{n(g=>g.map((x,b)=>b===y?{...x,label:i}:x)),a(null),l("")},p=()=>{a(null),l("")},f=(y,g)=>{n(x=>{const b=[...x],[v]=b.splice(y,1);return b.splice(y+g,0,v),b})};return r.jsxs("div",{className:"mt-2 bg-white rounded-lg shadow border p-3",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-xs font-bold text-gray-700 uppercase tracking-wide",children:"Negotiation Steps"}),r.jsx(qs,{icon:Wt,variant:"ghost",size:"sm",onClick:c,className:"text-blue-600 hover:text-blue-800",children:"Add Step"})]}),r.jsx("ul",{className:"space-y-1",children:t.map((y,g)=>r.jsxs("li",{className:`flex items-center gap-2 px-2 py-1 rounded group ${y.done?"bg-green-50":"hover:bg-gray-50"}`,children:[r.jsx(qs,{variant:"ghost",size:"sm",onClick:()=>o(g),className:"h-6 w-6 p-0",children:y.done?r.jsx(bt,{className:"w-4 h-4 text-green-600"}):r.jsx("span",{className:"inline-block w-4 h-4 border border-gray-300 rounded-full"})}),s===g?r.jsxs(r.Fragment,{children:[r.jsx("input",{type:"text",value:i,onChange:x=>l(x.target.value),className:"text-xs border rounded px-1 py-0.5 flex-1",autoFocus:!0,onBlur:()=>m(g),onKeyDown:x=>{x.key==="Enter"&&m(g),x.key==="Escape"&&p()}}),r.jsx(qs,{icon:Xr,variant:"ghost",size:"sm",onClick:()=>m(g),title:"Save",className:"h-6 w-6 p-0 ml-1 text-gray-400 hover:text-gray-700"}),r.jsx(qs,{icon:Ze,variant:"ghost",size:"sm",onClick:p,title:"Cancel",className:"h-6 w-6 p-0 ml-1 text-gray-400 hover:text-gray-700"})]}):r.jsx("span",{className:`flex-1 text-xs ${y.done?"line-through text-green-700":"text-gray-800"}`,children:y.label}),r.jsxs("div",{className:"flex items-center gap-1 opacity-70 group-hover:opacity-100",children:[r.jsx(qs,{icon:Q4,variant:"ghost",size:"sm",onClick:()=>u(g),title:"Edit",className:"h-6 w-6 p-0 text-gray-400 hover:text-blue-600"}),r.jsx(qs,{icon:fr,variant:"ghost",size:"sm",onClick:()=>d(g),title:"Delete",className:"h-6 w-6 p-0 text-gray-400 hover:text-red-600"}),r.jsx(qs,{icon:Ar,variant:"ghost",size:"sm",disabled:g===0,onClick:()=>f(g,-1),title:"Move Up",className:"h-6 w-6 p-0 text-gray-400 hover:text-gray-700"}),r.jsx(qs,{icon:Gr,variant:"ghost",size:"sm",disabled:g===t.length-1,onClick:()=>f(g,1),title:"Move Down",className:"h-6 w-6 p-0 text-gray-400 hover:text-gray-700"})]})]},g))})]})},K3=()=>{const{selectedEmployee:e,employeeLeads:t,setEmployeeLeads:n,employeeCustomers:s,setEmployeeCustomers:a,setShowAddLead:i,setShowAddCustomer:l,setSelectedEntry:o,leadNegotiationSteps:c,setLeadNegotiationSteps:d,customerNegotiationSteps:u,setCustomerNegotiationSteps:m,expandedNegotiation:p,setExpandedNegotiation:f,getNegotiationSteps:y,initializeNegotiationSteps:g,getSafeNegotiationSteps:x,loading:b,error:v}=ua();if(P3(e==null?void 0:e.id),h.useEffect(()=>{t.length>0&&t.forEach(N=>{N.currentStage==="Negotiation"&&g(N,d,c)}),s.length>0&&s.forEach(N=>{N.currentStage==="Negotiation"&&g(N,m,u)})},[t,s,c,u,g,d,m]),b)return r.jsxs("div",{className:"py-8 px-2 md:px-8 flex flex-col items-center justify-center",children:[r.jsx(Il,{className:"w-8 h-8 text-purple-600 animate-spin mb-4"}),r.jsx("p",{className:"text-gray-600",children:"load clients data..."})]});if(v)return r.jsx("div",{className:"py-8 px-2 md:px-8",children:r.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[r.jsx("p",{className:"text-red-700",children:v}),r.jsx("p",{className:"text-sm text-red-600 mt-1",children:"Failed to load data"})]})});const w=({icon:N,message:k,submessage:j})=>r.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-gray-500",children:[N,r.jsx("p",{className:"mt-2 font-medium",children:k}),j&&r.jsx("p",{className:"text-sm mt-1",children:j})]});return r.jsx("div",{className:"bg-gray-50 min-h-[600px]",children:r.jsx("div",{className:"py-4 px-5",children:r.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-10 gap-4",children:[r.jsxs("div",{className:"xl:col-span-7 space-y-4",children:[r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[r.jsx("div",{className:"flex items-center justify-between px-6 pt-6 pb-4 border-b border-gray-200",children:r.jsxs("h3",{className:"text-lg font-bold text-black font-[Inter] flex items-center gap-2",children:[r.jsx(kt,{className:"w-5 h-5 text-green-600"}),"Leads"]})}),t.length>0?r.jsx("ul",{className:"divide-y",children:t.map(N=>{const k=N.currentStage==="Negotiation",j=x(N,c),S=j.filter(C=>C.done).length,_=Math.round(S/j.length*100);return r.jsxs("li",{className:"py-3 flex flex-col hover:bg-blue-50 rounded transition cursor-pointer group p-6",onClick:C=>{C.target.closest(".negotiation-steps-editor")||o({type:"lead",data:N})},children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-gray-900 group-hover:text-blue-700",children:N.name}),r.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[r.jsx(yt,{className:"w-3 h-3"})," Last Contact: ",N.lastContactDate]}),r.jsx("div",{className:"text-xs mt-1",children:r.jsx("span",{className:`px-2 py-0.5 rounded-full font-medium ${N.currentStage==="Closed"?"bg-green-100 text-green-700":N.currentStage==="Negotiation"?"bg-yellow-100 text-yellow-700":"bg-blue-100 text-blue-700"}`,children:N.currentStage})})]}),k&&r.jsx("button",{className:"text-xs text-blue-600 hover:underline ml-2",onClick:()=>f(p===N.id?null:N.id),children:p===N.id?"Hide Steps":"Show Steps"})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5 mt-2",children:r.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-green-500 h-1.5 rounded-full",style:{width:`${N.progress}%`}})}),k&&r.jsxs("div",{className:"mt-2",children:[r.jsx("div",{className:"w-full bg-gray-100 rounded-full h-1 mb-1",children:r.jsx("div",{className:"bg-blue-400 h-1 rounded-full",style:{width:`${_}%`}})}),p===N.id&&r.jsx("div",{className:"negotiation-steps-editor",children:r.jsx(Ff,{entry:N,steps:j,setSteps:C=>d(D=>({...D,[N.id]:typeof C=="function"?C(D[N.id]||j):C}))})})]})]},N.id)})}):r.jsx(w,{icon:r.jsx(lb,{className:"w-12 h-12 text-gray-300"}),message:"No leads available",submessage:"No lead data found for this employee"})]}),r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[r.jsx("div",{className:"flex items-center justify-between px-6 pt-6 pb-4 border-b border-gray-200",children:r.jsxs("h3",{className:"text-lg font-bold text-black font-[Inter] flex items-center gap-2",children:[r.jsx(_t,{className:"w-5 h-5 text-green-600"}),"Customers"]})}),s.length>0?r.jsx("ul",{className:"divide-y",children:s.map(N=>{const k=N.currentStage==="Negotiation",j=x(N,u),S=j.filter(C=>C.done).length,_=Math.round(S/j.length*100);return r.jsxs("li",{className:"py-3 flex flex-col hover:bg-purple-50 rounded transition cursor-pointer group p-6",onClick:C=>{C.target.closest(".negotiation-steps-editor")||o({type:"customer",data:N})},children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-gray-900 group-hover:text-purple-700",children:N.name}),r.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[r.jsx(yt,{className:"w-3 h-3"})," Last Contact: ",N.lastContactDate]}),r.jsx("div",{className:"text-xs mt-1",children:r.jsx("span",{className:`px-2 py-0.5 rounded-full font-medium ${N.currentStage==="Closed"?"bg-green-100 text-green-700":N.currentStage==="Negotiation"?"bg-yellow-100 text-yellow-700":"bg-purple-100 text-purple-700"}`,children:N.currentStage})})]}),k&&r.jsx("button",{className:"text-xs text-purple-600 hover:underline ml-2",onClick:()=>f(p===N.id?null:N.id),children:p===N.id?"Hide Steps":"Show Steps"})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5 mt-2",children:r.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-green-500 h-1.5 rounded-full",style:{width:`${N.progress}%`}})}),k&&r.jsxs("div",{className:"mt-2",children:[r.jsx("div",{className:"w-full bg-gray-100 rounded-full h-1 mb-1",children:r.jsx("div",{className:"bg-purple-400 h-1 rounded-full",style:{width:`${_}%`}})}),p===N.id&&r.jsx("div",{className:"negotiation-steps-editor",children:r.jsx(Ff,{entry:N,steps:j,setSteps:C=>m(D=>({...D,[N.id]:typeof C=="function"?C(D[N.id]||j):C}))})})]})]},N.id)})}):r.jsx(w,{icon:r.jsx(lb,{className:"w-12 h-12 text-gray-300"}),message:"No customers available",submessage:"No customer data found for this employee"})]}),r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[r.jsx("div",{className:"flex items-center justify-between px-6 pt-6 pb-4 border-b border-gray-200",children:r.jsxs("h3",{className:"text-lg font-bold text-black font-[Inter] flex items-center gap-2",children:[r.jsx(on,{className:"w-5 h-5 text-green-600"}),"Customer Feedback",(e==null?void 0:e.feedback_rating)&&r.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:["(",e.feedback_rating.toFixed(1),"  from ",e.feedback_count||0," reviews)"]})]})}),r.jsx("div",{className:"p-6",children:e!=null&&e.feedback_rating?r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 rounded-lg",children:r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center mb-2",children:[r.jsx("span",{className:"text-2xl font-bold text-gray-900 mr-2",children:e.feedback_rating.toFixed(1)}),r.jsx("div",{className:"flex items-center",children:[1,2,3,4,5].map(N=>r.jsx(on,{className:`h-5 w-5 ${N<=Math.round(e.feedback_rating)?"text-yellow-400 fill-current":"text-gray-300"}`},N))})]}),r.jsxs("p",{className:"text-sm text-gray-600",children:["Based on ",e.feedback_count||0," customer reviews"]})]})}),e.feedback_comment&&r.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400",children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Latest Customer Comment"}),r.jsxs("p",{className:"text-gray-700 italic",children:['"',e.feedback_comment,'"']})]})]}):r.jsx(w,{icon:r.jsx(on,{className:"w-12 h-12 text-gray-300"}),message:"No customer feedback yet",submessage:"Feedback will appear here once customers provide ratings"})})]})]}),r.jsxs("div",{className:"xl:col-span-3 space-y-4",children:[r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[r.jsx(yt,{className:"w-5 h-5 text-green-600"}),"Upcoming Follow-ups"]}),r.jsx("ul",{className:"text-sm text-gray-900 font-medium space-y-3",children:(()=>{const N=[...t,...s].filter(j=>j.lastContactDate).sort((j,S)=>new Date(j.lastContactDate)-new Date(S.lastContactDate));return N.length===0?r.jsxs("li",{className:"text-center text-gray-500 py-2",children:[r.jsx(yt,{className:"w-4 h-4 mx-auto mb-1"}),r.jsx("span",{className:"text-xs",children:"No upcoming follow-ups"})]}):N.slice(0,3).map((j,S)=>r.jsxs("li",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(_t,{className:"w-4 h-4 text-blue-400"}),r.jsx("span",{children:j.name})]}),r.jsx("span",{className:"text-xs text-gray-500",children:j.lastContactDate})]},S))})()})]}),r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[r.jsx(jt,{className:"w-5 h-5 text-green-600"}),"Avg Response Time"]}),r.jsx("div",{className:"text-center",children:r.jsx("div",{className:"text-2xl font-bold text-green-800 mb-2",children:(()=>{const N=[...t,...s].filter(S=>S.lastContactDate).sort((S,_)=>new Date(S.lastContactDate)-new Date(_.lastContactDate));if(N.length<2)return"139.0 days";let k=0;for(let S=1;S<N.length;S++){const _=new Date(N[S-1].lastContactDate),C=new Date(N[S].lastContactDate);k+=(C-_)/(1e3*60*60*24)}return(k/(N.length-1)).toFixed(1)+" days"})()})})]}),r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[r.jsx(bt,{className:"w-5 h-5 text-green-600"}),"Success/Close Rate"]}),r.jsx("div",{className:"text-center",children:r.jsx("div",{className:"text-2xl font-bold text-purple-800 mb-2",children:(()=>{const N=[...t,...s];return N.length===0?"0%":(N.filter(j=>j.currentStage==="Closed").length/N.length*100).toFixed(0)+"%"})()})})]})]})]})})})},X3={Sales:75,"Customer Success":82,"Professional Services":78,Engineering:82,Marketing:76,Operations:79},ph={experienceAdvantage:e=>{const t=e.experience||2;let n=`With ${t} years of experience, this employee shows`;return t>=5?n+=" exceptional leadership and mentoring capabilities":t>=3?n+=" strong problem-solving skills and client relationship management":n+=" rapid learning and adaptability in new situations",n},strengthUtilization:e=>{var a;const t=((a=e.strengths)==null?void 0:a.slice(0,2).join(" and "))||"communication and problem-solving",n=e.department||"Sales";let s="";switch(n){case"Sales":s="client acquisition and retention";break;case"Engineering":s="technical innovation and team collaboration";break;case"Customer Success":s="customer satisfaction and account expansion";break;case"Professional Services":s="project delivery and client success";break;default:s="operational efficiency and team coordination"}return`Key strengths in ${t} directly contribute to ${s}`},departmentAlignment:e=>{var s;const t=e.department||"Sales",n=((s=e.specialties)==null?void 0:s.slice(0,2).join(" and "))||"core competencies";return`Perfect fit for ${t} role - specialties in ${n} align with department objectives and contribute to overall team success`}},fh={leverageStrengths:e=>{var n;return`Continue developing ${((n=e.strengths)==null?void 0:n[0])||"communication"} skills through advanced training and mentoring opportunities`},addressChallenges:e=>{const t=e.department||"Sales";let n="";switch(t){case"Sales":n="Focus on advanced negotiation techniques and strategic account management";break;case"Customer Success":n="Enhance data analysis skills for better customer health monitoring";break;case"Professional Services":n="Develop project management and stakeholder communication skills";break;case"Engineering":n="Strengthen technical leadership and architecture design capabilities";break;default:n="Focus on leadership development and cross-functional collaboration"}return n},careerGrowth:e=>{const t=e.experience||2,n=e.department||"Sales";let s="";return t>=5?s=`Consider leadership opportunities within ${n} or cross-functional management roles`:t>=3?s="Explore senior-level responsibilities and mentoring junior team members":s=`Focus on skill development and building expertise in ${n} fundamentals`,s}},gh={getDepartmentAverage:e=>X3[e]||78,getPerformanceRating:e=>e>=85?"Excellent":e>=70?"Good":"Needs Improvement",getDealsWonRating:e=>e>=5?"High Closer":e>=2?"Moderate":"Growing",getResponseTimeRating:e=>e!=null&&e.includes("hour")?"Excellent":"Good",getVsAverageScore:(e,t)=>{const n=(e||80)-t;return{difference:Math.abs(n),sign:n>=0?"+":"-",isAbove:n>=0}}},Xk=(e,t)=>85+t*5,Jk=e=>{var s,a,i;const t=gh.getDepartmentAverage(e.department),n=((s=e.performance)==null?void 0:s.score)||80;return{departmentAverage:t,performanceInsights:{score:n,rating:gh.getPerformanceRating(n),dealsWon:((a=e.performance)==null?void 0:a.dealsWon)||0,responseTime:((i=e.performance)==null?void 0:i.responseTime)||"2 hours"},successPatterns:{experienceAdvantage:ph.experienceAdvantage(e),strengthUtilization:ph.strengthUtilization(e),departmentAlignment:ph.departmentAlignment(e)},growthRecommendations:{leverageStrengths:fh.leverageStrengths(e),addressChallenges:fh.addressChallenges(e),careerGrowth:fh.careerGrowth(e)},vsAverage:gh.getVsAverageScore(n,t)}},J3=()=>{var n,s;const{selectedEmployee:e}=ua(),t=Jk(e);return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"bg-white rounded-lg border p-6 shadow-sm",children:[r.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(Br,{className:"w-5 h-5 text-purple-600"}),"Success Factors Analysis"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"font-medium text-gray-900",children:"Performance Insights"}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ot,{className:"w-4 h-4 text-green-600"}),r.jsx("span",{className:"text-sm font-medium",children:"Performance Score"})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("div",{className:"text-lg font-bold text-green-700",children:[t.performanceInsights.score,"/100"]}),r.jsx("div",{className:"text-xs text-green-600",children:t.performanceInsights.rating})]})]}),r.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Er,{className:"w-4 h-4 text-blue-600"}),r.jsx("span",{className:"text-sm font-medium",children:"Deals Won"})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("div",{className:"text-lg font-bold text-blue-700",children:t.performanceInsights.dealsWon}),r.jsx("div",{className:"text-xs text-blue-600",children:t.performanceInsights.dealsWon>=5?"High Closer":t.performanceInsights.dealsWon>=2?"Moderate":"Growing"})]})]}),r.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(jt,{className:"w-4 h-4 text-purple-600"}),r.jsx("span",{className:"text-sm font-medium",children:"Response Time"})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("div",{className:"text-lg font-bold text-purple-700",children:t.performanceInsights.responseTime}),r.jsx("div",{className:"text-xs text-purple-600",children:(n=t.performanceInsights.responseTime)!=null&&n.includes("hour")?"Excellent":"Good"})]})]})]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"font-medium text-gray-900",children:"Specialization Strength"}),r.jsx("div",{className:"space-y-3",children:((s=e.specialties)==null?void 0:s.slice(0,3).map((a,i)=>r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Vi,{className:"w-4 h-4 text-gray-600"}),r.jsx("span",{className:"text-sm font-medium",children:a})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("div",{className:"text-sm font-bold text-gray-700",children:[Xk(e.specialties,i),"%"]}),r.jsx("div",{className:"text-xs text-gray-500",children:"Proficiency"})]})]},i)))||r.jsx("div",{className:"text-sm text-gray-500",children:"No specialties defined"})})]})]})]}),r.jsxs("div",{className:"bg-white rounded-lg border p-6 shadow-sm",children:[r.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(Bn,{className:"w-5 h-5 text-blue-600"}),"Department Benchmarking"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[r.jsx("div",{className:"text-2xl font-bold text-blue-700",children:t.performanceInsights.score}),r.jsx("div",{className:"text-sm text-blue-600",children:"Your Score"})]}),r.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[r.jsx("div",{className:"text-2xl font-bold text-gray-700",children:t.departmentAverage}),r.jsx("div",{className:"text-sm text-gray-600",children:"Dept Average"})]}),r.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[r.jsxs("div",{className:"text-2xl font-bold text-green-700",children:[t.vsAverage.sign,t.vsAverage.difference]}),r.jsx("div",{className:"text-sm text-green-600",children:"vs Average"})]})]})]}),r.jsxs("div",{className:"bg-white rounded-lg border p-6 shadow-sm",children:[r.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(Ml,{className:"w-5 h-5 text-yellow-600"}),"Key Success Patterns"]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-start gap-3 p-4 bg-yellow-50 rounded-lg",children:[r.jsx(bt,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900",children:"Experience Advantage"}),r.jsx("p",{className:"text-sm text-gray-600",children:t.successPatterns.experienceAdvantage})]})]}),r.jsxs("div",{className:"flex items-start gap-3 p-4 bg-green-50 rounded-lg",children:[r.jsx(bt,{className:"w-5 h-5 text-green-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900",children:"Strength Utilization"}),r.jsx("p",{className:"text-sm text-gray-600",children:t.successPatterns.strengthUtilization})]})]}),r.jsxs("div",{className:"flex items-start gap-3 p-4 bg-purple-50 rounded-lg",children:[r.jsx(bt,{className:"w-5 h-5 text-purple-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900",children:"Department Alignment"}),r.jsx("p",{className:"text-sm text-gray-600",children:t.successPatterns.departmentAlignment})]})]})]})]}),r.jsxs("div",{className:"bg-white rounded-lg border p-6 shadow-sm",children:[r.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(Br,{className:"w-5 h-5 text-indigo-600"}),"Growth Recommendations"]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-start gap-3 p-4 bg-indigo-50 rounded-lg",children:[r.jsx(Ar,{className:"w-5 h-5 text-indigo-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900",children:"Leverage Strengths"}),r.jsx("p",{className:"text-sm text-gray-600",children:t.growthRecommendations.leverageStrengths})]})]}),r.jsxs("div",{className:"flex items-start gap-3 p-4 bg-blue-50 rounded-lg",children:[r.jsx(Er,{className:"w-5 h-5 text-blue-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900",children:"Address Challenges"}),r.jsx("p",{className:"text-sm text-gray-600",children:t.growthRecommendations.addressChallenges})]})]}),r.jsxs("div",{className:"flex items-start gap-3 p-4 bg-green-50 rounded-lg",children:[r.jsx(Vi,{className:"w-5 h-5 text-green-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900",children:"Career Growth"}),r.jsx("p",{className:"text-sm text-gray-600",children:t.growthRecommendations.careerGrowth})]})]})]})]})]})},On="http://localhost:7001";class Kc extends Error{constructor(t,n=null,s=null){super(t),this.name="CustomerApiError",this.status=n,this.data=s}}async function Mn(e){if(!e.ok){let t=`HTTP ${e.status}: ${e.statusText}`;try{const n=await e.json();throw n.detail&&(t=n.detail),new Kc(t,e.status,n)}catch(n){throw n instanceof Kc?n:new Kc(t,e.status)}}try{return await e.json()}catch{throw new Kc("Failed to parse response JSON",e.status)}}function Ha(e){return{...e,id:e.id,customerCode:e.customer_code,customerName:e.customer_name,company:e.company||e.customer_name,primaryContact:e.primarycontact||`Contact at ${e.customer_name}`,title:e.title||null,email:e.cleaned_email||e.email,phone:e.phone||null,country:e.country,provinceState:e.province_state,city:e.city,address:e.address,postalCode:e.postal_code,industry:e.industry,category:e.category,tier:e.tier,status:e.status,totalSales:e.total_sales,totalProfit:e.total_profit,avgSalesAmount:e.avg_sales_amount,contractValue:e.contractvalue||e.total_sales,monthlyValue:e.monthlyvalue,totalTransactions:e.total_transactions,firstPurchaseDate:e.first_purchase_date,lastPurchaseDate:e.last_purchase_date,currentMtdSales:e.current_mtd_sales,current12MonthAvg:e.current_12_month_avg,healthScore:e.healthscore,renewalDate:e.renewaldate,lastInteraction:e.lastinteraction,totalInteractions:e.totalinteractions,supportTickets:e.supporttickets,productUsage:e.productusage,expansionPotential:e.expansionpotential,assignedEmployeeId:e.assignedemployeeid,churnRisk:e.churnrisk,satisfactionScore:e.satisfactionscore,onboardingComplete:e.onboardingcomplete,tags:e.tags,recentActivities:e.recentactivities,predictiveInsights:e.predictiveinsights,timeline:e.timeline,createdAt:e.created_at,updatedAt:e.updated_at}}function ev(e){return{customer_code:e.customerCode||e.customer_code,customer_name:e.customerName||e.customer_name||e.company,email:e.email,country:e.country,province_state:e.provinceState||e.province_state,city:e.city,address:e.address,postal_code:e.postalCode||e.postal_code,industry:e.industry,category:e.category,total_sales:e.totalSales||e.total_sales||e.contractValue,total_profit:e.totalProfit||e.total_profit,avg_sales_amount:e.avgSalesAmount||e.avg_sales_amount,total_transactions:e.totalTransactions||e.total_transactions,first_purchase_date:e.firstPurchaseDate||e.first_purchase_date,last_purchase_date:e.lastPurchaseDate||e.last_purchase_date,current_mtd_sales:e.currentMtdSales||e.current_mtd_sales,current_12_month_avg:e.current12MonthAvg||e.current_12_month_avg}}class Q3{constructor(){this.cache=new Map,this.cacheTimeout=5*60*1e3}async getCachedData(t,n){const s=this.cache.get(t),a=Date.now();if(s&&a-s.timestamp<this.cacheTimeout)return console.log(` Using cached CRM data for: ${t}`),s.data;try{const i=await n();return this.cache.set(t,{data:i,timestamp:a}),console.log(` Cached fresh CRM data for: ${t}`),i}catch(i){if(s)return console.warn(` API failed, using stale CRM cache for: ${t}`),s.data;throw i}}clearCache(){this.cache.clear(),console.log(" CRM cache cleared")}clearCacheEntry(t){this.cache.delete(t),console.log(` Cleared CRM cache entry: ${t}`)}invalidateCustomerCache(t=null){const n=[];for(const s of this.cache.keys())(s.startsWith("customers_")||s==="all_customers")&&n.push(s),t&&s===`customer_${t}`&&n.push(s),(s==="customer_metrics"||s==="industry_statistics")&&n.push(s);n.forEach(s=>this.clearCacheEntry(s))}async getAllCustomers(t={}){const n=Object.keys(t).length>0?`customers_${JSON.stringify(t)}`:"all_customers";return this.getCachedData(n,async()=>{const s=new URLSearchParams;t.company&&s.append("company",t.company),t.industry&&s.append("industry",t.industry),t.tier&&s.append("tier",t.tier),t.status&&s.append("status",t.status),t.search&&s.append("search",t.search),t.assignedEmployeeId&&s.append("assigned_employee",t.assignedEmployeeId),t.churnRisk&&s.append("churn_risk",t.churnRisk),t.excludeAssigned&&s.append("exclude_assigned","true");const a=s.toString(),i=`${On}/api/customers${a?`?${a}`:""}`,l=await fetch(i,{method:"GET",headers:{"Content-Type":"application/json"}});return(await Mn(l)).map(Ha)})}async getCustomerById(t){const n=`customer_${t}`;return this.getCachedData(n,async()=>{const s=await fetch(`${On}/api/customers/${t}`,{method:"GET",headers:{"Content-Type":"application/json"}}),a=await Mn(s);return Ha(a)})}async createCustomer(t){const n=ev(t),s=await fetch(`${On}/api/customers`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),a=await Mn(s),i=Ha(a);return this.invalidateCustomerCache(),i}async updateCustomer(t,n){const s=ev(n),a=await fetch(`${On}/api/customers/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),i=await Mn(a),l=Ha(i);return this.invalidateCustomerCache(t),l}async deleteCustomer(t){const n=await fetch(`${On}/api/customers/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}}),s=await Mn(n);return this.invalidateCustomerCache(t),s}async getCustomerMetrics(){return this.getCachedData("customer_metrics",async()=>{const n=await fetch(`${On}/api/customers/metrics/summary`,{method:"GET",headers:{"Content-Type":"application/json"}});return await Mn(n)})}async getCustomersByEmployee(t){const n=`customers_employee_${t}`;return this.getCachedData(n,async()=>{const s=await fetch(`${On}/api/customers/by-employee/${t}`,{method:"GET",headers:{"Content-Type":"application/json"}});return(await Mn(s)).map(Ha)})}async getLeadsByEmployee(t){const n=`leads_employee_${t}`;return this.getCachedData(n,async()=>{const s=await fetch(`${On}/api/customers/leads/by-employee/${t}`,{method:"GET",headers:{"Content-Type":"application/json"}});return(await Mn(s)).map(Ha)})}async searchCustomers(t){return this.getAllCustomers({search:t})}async getCustomersByFilter(t){return this.getAllCustomers(t)}async getCustomersByIndustry(t){return this.getAllCustomers({industry:t})}async getIndustries(){const t=await fetch(`${On}/api/customers/industries`,{method:"GET",headers:{"Content-Type":"application/json"}});return await Mn(t)}async getIndustryStatistics(){return this.getCachedData("industry_statistics",async()=>{const n=await fetch(`${On}/api/customers/industries/statistics`,{method:"GET",headers:{"Content-Type":"application/json"}});return await Mn(n)})}async getCustomersByIndustries(t){const n=new URLSearchParams;t.forEach(l=>n.append("industry",l));const s=`${On}/api/customers?${n.toString()}`,a=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json"}});return(await Mn(a)).map(Ha)}async updateCustomerIndustry(t,n){const s=await fetch(`${On}/api/customers/${t}/industry`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({industry:n})}),a=await Mn(s);return Ha(a)}async assignCustomerToEmployee(t,n,s,a=null,i="customer"){const l=await fetch(`${On}/api/customers/assign`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer_name:t,employee_name:n,matched_score:s,notes:a,client_type:i})}),o=await Mn(l);return this.invalidateCustomerCache(),o}async assignCustomerToEmployeeByIds(t,n,s,a=null,i="customer"){const l=await fetch(`${On}/api/customers/assign-by-ids`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer_id:t,employee_id:n,matched_score:s,notes:a,client_type:i})}),o=await Mn(l);return this.invalidateCustomerCache(t),this.clearCacheEntry(`customers_employee_${n}`),this.clearCacheEntry(`leads_employee_${n}`),o}}const Gd=new Q3,Z3=()=>{const{selectedEmployee:e}=ua(),[t,n]=h.useState([]),[s,a]=h.useState([]),[i,l]=h.useState(!1),[o,c]=h.useState(!1),[d,u]=h.useState(null),[m,p]=h.useState(!1),[f,y]=h.useState(null),[g,x]=h.useState("customers"),[b,v]=h.useState(new Set),[w,N]=h.useState(new Set),k=(C,D)=>{var E,T;const A=((E=C.customer)==null?void 0:E.id)||((T=C.customer)==null?void 0:T.customer_id);if(A)if(D==="customer"){const M=new Set(b);M.has(A)?M.delete(A):M.add(A),v(M)}else{const M=new Set(w);M.has(A)?M.delete(A):M.add(A),N(M)}},j=C=>{if(g==="customers")if(C){const D=t.map(A=>{var E,T;return((E=A.customer)==null?void 0:E.id)||((T=A.customer)==null?void 0:T.customer_id)}).filter(Boolean);v(new Set(D))}else v(new Set);else if(C){const D=s.map(A=>{var E,T;return((E=A.customer)==null?void 0:E.id)||((T=A.customer)==null?void 0:T.customer_id)}).filter(Boolean);N(new Set(D))}else N(new Set)},S=async()=>{var M,L,P;const C=g==="customers"?t:s,D=g==="customers"?b:w;if(D.size===0){y({type:"error",message:"No matches selected for assignment"}),setTimeout(()=>y(null),3e3);return}p(!0);const A=C.filter($=>{var U,I;const R=((U=$.customer)==null?void 0:U.id)||((I=$.customer)==null?void 0:I.customer_id);return D.has(R)});let E=0,T=0;for(const $ of A)try{const R=((M=$.customer)==null?void 0:M.customer_name)||((L=$.customer)==null?void 0:L.name),U=$.matchScore,I="Assigned via AI matching system",z=g==="customers"?"customer":"lead";await Gd.assignCustomerToEmployee(R,e.name,U,I,z),E++,console.log(` Successfully assigned "${R}" to employee "${e.name}"`)}catch(R){T++,console.error("Failed to assign:",(P=$.customer)==null?void 0:P.customer_name,R)}g==="customers"?v(new Set):N(new Set),E>0?y({type:"success",message:`Successfully assigned ${E} ${g}${E>1,""} to ${e.name}`+(T>0?`. ${T} failed.`:"")}):y({type:"error",message:`Failed to assign all selected ${g}`}),setTimeout(()=>y(null),5e3),p(!1)},_=async()=>{if(e!=null&&e.id){l(!0),u(null);try{const[C,D]=await Promise.all([Gd.getAllCustomers({excludeAssigned:!0}),zr.getAllEmployees()]),A=C.filter(M=>M.client_type==="customer"||!M.client_type),E=C.filter(M=>M.client_type==="lead");let T=await mn.checkServiceHealth();if(!T){console.log(" MatchTab: Semantic matching service not ready, checking if already preloading..."),c(!0);try{await fetch("http://localhost:7002/semantic-similarity",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text1:"test",text2:"test"})})}catch(M){console.log("MatchTab: Failed to trigger model loading:",M)}console.log(" MatchTab: Waiting 2 seconds for model (should be preloaded)..."),await new Promise(M=>setTimeout(M,2e3)),T=await mn.checkServiceHealth(),T||(console.log(" MatchTab: Final retry in 2 seconds..."),await new Promise(M=>setTimeout(M,2e3)),T=await mn.checkServiceHealth()),c(!1)}if(console.log(` MatchTab: Semantic matching service: ${T?"Available":"Unavailable - using fallback"}`),T){console.log(" MatchTab: Using semantic matching for customer-employee assignments..."),console.log(" Calculating global customer-employee assignment matrix...");const M=[];for(const Z of A)for(const oe of D)try{const W=await mn.matchCustomerToEmployees(Z,[oe]);if(W.matches&&W.matches.length>0){const B=W.matches[0];M.push({customer:Z,employee:oe,matchScore:B.total_score*100,industryAlignment:B.industry_similarity*100,skillsMatch:B.skills_similarity*100,overallSimilarity:B.overall_similarity*100,confidence:B.overall_confidence,reasons:[`Semantic score: ${(B.semantic_score*100).toFixed(1)}%`,`Profile match: ${(B.overall_similarity*100).toFixed(1)}%`,`Industry alignment: ${(B.industry_similarity*100).toFixed(1)}%`,`Skills compatibility: ${(B.skills_similarity*100).toFixed(1)}%`,...B.rule_based_reasons||[]]})}}catch(W){console.warn(`Failed to match customer ${Z.customer_name||Z.name} to employee ${oe.name}:`,W)}M.sort((Z,oe)=>oe.matchScore-Z.matchScore),console.log(" Calculating global customer-employee assignment matrix...");const L=[],P=[];for(const Z of A)for(const oe of D)try{const W=await mn.matchCustomerToEmployees(Z,[oe]);if(W.matches&&W.matches.length>0){const B=W.matches[0];L.push({customer:Z,employee:oe,matchScore:B.total_score*100,industryAlignment:B.industry_similarity*100,skillsMatch:B.skills_similarity*100,overallSimilarity:B.overall_similarity*100,confidence:B.overall_confidence,reasons:[`Semantic score: ${(B.semantic_score*100).toFixed(1)}%`,`Profile match: ${(B.overall_similarity*100).toFixed(1)}%`,`Industry alignment: ${(B.industry_similarity*100).toFixed(1)}%`,`Skills compatibility: ${(B.skills_similarity*100).toFixed(1)}%`,...B.rule_based_reasons||[]]})}}catch(W){console.warn(`Failed to match customer ${Z.customer_name||Z.name} to employee ${oe.name}:`,W)}for(const Z of E)for(const oe of D)try{const W=await mn.matchCustomerToEmployees(Z,[oe]);if(W.matches&&W.matches.length>0){const B=W.matches[0];P.push({customer:Z,employee:oe,matchScore:B.total_score*100,industryAlignment:B.industry_similarity*100,skillsMatch:B.skills_similarity*100,overallSimilarity:B.overall_similarity*100,confidence:B.overall_confidence,reasons:[`Semantic score: ${(B.semantic_score*100).toFixed(1)}%`,`Profile match: ${(B.overall_similarity*100).toFixed(1)}%`,`Industry alignment: ${(B.industry_similarity*100).toFixed(1)}%`,`Skills compatibility: ${(B.skills_similarity*100).toFixed(1)}%`,...B.rule_based_reasons||[]]})}}catch(W){console.warn(`Failed to match lead ${Z.customer_name||Z.name} to employee ${oe.name}:`,W)}L.sort((Z,oe)=>oe.matchScore-Z.matchScore),P.sort((Z,oe)=>oe.matchScore-Z.matchScore);const $=new Set,R=new Map;D.forEach(Z=>{R.set(Z.id,[])});const U=Math.ceil(A.length/D.length);console.log(` Target customers per employee: ${U} (${A.length} customers / ${D.length} employees)`);for(const Z of L){const{customer:oe,employee:W,matchScore:B,industryAlignment:V,skillsMatch:re,overallSimilarity:Me,confidence:he,reasons:G}=Z;if($.has(oe.id||oe.customer_code))continue;const q=R.get(W.id)||[];if(q.length>=U)continue;const Q={customer:oe,matchScore:Number(B.toFixed(1)),industryAlignment:Number(V.toFixed(1)),skillsMatch:Number(re.toFixed(1)),overallSimilarity:Number(Me.toFixed(1)),confidence:he,reasons:G};q.push(Q),R.set(W.id,q),$.add(oe.id||oe.customer_code)}const I=A.filter(Z=>!$.has(Z.id||Z.customer_code));console.log(` Unassigned customers: ${I.length}`);for(const Z of I){let oe=1/0,W=null;for(const[B,V]of R.entries())V.length<oe&&(oe=V.length,W=B);W&&R.get(W).push({customer:Z,matchScore:50,industryAlignment:50,skillsMatch:50,overallSimilarity:50,confidence:.5,reasons:["Assigned for balanced distribution"]})}const z=new Set,F=new Map;D.forEach(Z=>{F.set(Z.id,[])});const O=Math.ceil(E.length/D.length);console.log(` Target leads per employee: ${O} (${E.length} leads / ${D.length} employees)`);for(const Z of P){const{customer:oe,employee:W,matchScore:B,industryAlignment:V,skillsMatch:re,overallSimilarity:Me,confidence:he,reasons:G}=Z;if(z.has(oe.id||oe.customer_code))continue;const q=F.get(W.id)||[];if(q.length>=O)continue;const Q={customer:oe,matchScore:Number(B.toFixed(1)),industryAlignment:Number(V.toFixed(1)),skillsMatch:Number(re.toFixed(1)),overallSimilarity:Number(Me.toFixed(1)),confidence:he,reasons:G};q.push(Q),F.set(W.id,q),z.add(oe.id||oe.customer_code)}const K=E.filter(Z=>!z.has(Z.id||Z.customer_code));console.log(` Unassigned leads: ${K.length}`);for(const Z of K){let oe=1/0,W=null;for(const[B,V]of F.entries())V.length<oe&&(oe=V.length,W=B);W&&F.get(W).push({customer:Z,matchScore:50,industryAlignment:50,skillsMatch:50,overallSimilarity:50,confidence:.5,reasons:["Assigned for balanced distribution"]})}const J=(R.get(e.id)||[]).sort((Z,oe)=>oe.matchScore-Z.matchScore),se=(F.get(e.id)||[]).sort((Z,oe)=>oe.matchScore-Z.matchScore);console.log(` Employee ${e.name} assigned:`),console.log(`   - ${J.length} customers`),console.log(`   - ${se.length} leads`),console.log(`
 Overall Assignment Distribution:`);for(const[Z,oe]of R.entries()){const W=D.find(B=>B.id===Z);console.log(`   ${(W==null?void 0:W.name)||"Unknown"}: ${oe.length} customers`)}n(J),a(se)}else{console.log(" MatchTab: Using fallback matching (no semantic service)...");const M=Math.ceil(A.length/D.length),L=Math.ceil(E.length/D.length),P=D.findIndex(J=>J.id===e.id),$=P*M,R=Math.min($+M,A.length),U=A.slice($,R),I=P*L,z=Math.min(I+L,E.length),F=E.slice(I,z),O=U.map(J=>({customer:J,matchScore:Math.floor(Math.random()*40)+60,industryAlignment:Math.floor(Math.random()*30)+70,skillsMatch:Math.floor(Math.random()*30)+70,overallSimilarity:Math.floor(Math.random()*30)+70,confidence:.5,reasons:["Fallback assignment - semantic matching unavailable"]})),K=F.map(J=>({customer:J,matchScore:Math.floor(Math.random()*40)+60,industryAlignment:Math.floor(Math.random()*30)+70,skillsMatch:Math.floor(Math.random()*30)+70,overallSimilarity:Math.floor(Math.random()*30)+70,confidence:.5,reasons:["Fallback assignment - semantic matching unavailable"]}));n(O),a(K)}}catch(C){console.error("Error fetching matches:",C),u(`Failed to load customer matches: ${C.message||"Unknown error"}`),n([]),a([])}finally{l(!1)}}};return h.useEffect(()=>{e!=null&&e.id&&_()},[e==null?void 0:e.id]),e?i?r.jsx("div",{className:"space-y-6",children:r.jsxs("div",{className:"bg-white rounded-lg border p-5 shadow-sm",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"h-5 w-40 bg-gray-200 rounded animate-pulse"}),r.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1 gap-2",children:[r.jsx("div",{className:"h-7 w-20 bg-gray-200 rounded-md animate-pulse"}),r.jsx("div",{className:"h-7 w-20 bg-gray-200 rounded-md animate-pulse"})]})]}),r.jsx("div",{className:"h-8 w-24 bg-gray-200 rounded-lg animate-pulse"})]}),r.jsxs("div",{className:"flex items-center justify-between mb-4 p-3 bg-gray-50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-4 h-4 bg-gray-200 rounded border animate-pulse"}),r.jsx("div",{className:"h-4 w-24 bg-gray-200 rounded animate-pulse"}),r.jsx("div",{className:"h-4 w-40 bg-gray-100 rounded animate-pulse"})]}),r.jsx("div",{className:"h-8 w-40 bg-gray-200 rounded-lg animate-pulse"})]}),r.jsx("div",{className:"space-y-4",children:[...Array(3)].map((C,D)=>r.jsx("div",{className:"border rounded-lg p-4 bg-white",children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[r.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full animate-pulse"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"h-4 w-64 bg-gray-200 rounded animate-pulse mb-2"}),r.jsx("div",{className:"h-3 w-48 bg-gray-100 rounded animate-pulse mb-2"}),r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("div",{className:"h-5 w-24 bg-gray-200 rounded-full animate-pulse"}),r.jsx("div",{className:"h-5 w-24 bg-gray-200 rounded-full animate-pulse"}),r.jsx("div",{className:"h-5 w-24 bg-gray-200 rounded-full animate-pulse"})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded h-1.5",children:r.jsx("div",{className:"h-1.5 bg-gray-300 rounded animate-pulse",style:{width:"60%"}})})]})]}),r.jsxs("div",{className:"flex flex-col gap-2 ml-4",children:[r.jsx("div",{className:"h-8 w-32 bg-gray-200 rounded-lg animate-pulse"}),r.jsx("div",{className:"h-8 w-24 bg-gray-200 rounded-lg animate-pulse"})]})]})},D))})]})}):o?r.jsx("div",{className:"space-y-6",children:r.jsxs("div",{className:"bg-white rounded-lg border p-5 shadow-sm",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"h-5 w-40 bg-gray-200 rounded animate-pulse"}),r.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1 gap-2",children:[r.jsx("div",{className:"h-7 w-20 bg-gray-200 rounded-md animate-pulse"}),r.jsx("div",{className:"h-7 w-20 bg-gray-200 rounded-md animate-pulse"})]})]}),r.jsx("div",{className:"h-8 w-32 bg-gray-200 rounded-lg animate-pulse"})]}),r.jsxs("div",{className:"flex items-center justify-between mb-4 p-3 bg-gray-50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-4 h-4 bg-gray-200 rounded border animate-pulse"}),r.jsx("div",{className:"h-4 w-24 bg-gray-200 rounded animate-pulse"}),r.jsx("div",{className:"h-4 w-40 bg-gray-100 rounded animate-pulse"})]}),r.jsx("div",{className:"h-8 w-40 bg-gray-200 rounded-lg animate-pulse"})]}),r.jsx("div",{className:"space-y-4",children:[...Array(2)].map((C,D)=>r.jsx("div",{className:"border rounded-lg p-4 bg-white",children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[r.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full animate-pulse"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"h-4 w-56 bg-gray-200 rounded animate-pulse mb-2"}),r.jsx("div",{className:"h-3 w-40 bg-gray-100 rounded animate-pulse mb-2"}),r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("div",{className:"h-5 w-24 bg-gray-200 rounded-full animate-pulse"}),r.jsx("div",{className:"h-5 w-24 bg-gray-200 rounded-full animate-pulse"}),r.jsx("div",{className:"h-5 w-24 bg-gray-200 rounded-full animate-pulse"})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded h-1.5",children:r.jsx("div",{className:"h-1.5 bg-gray-300 rounded animate-pulse",style:{width:"45%"}})})]})]}),r.jsxs("div",{className:"flex flex-col gap-2 ml-4",children:[r.jsx("div",{className:"h-8 w-28 bg-gray-200 rounded-lg animate-pulse"}),r.jsx("div",{className:"h-8 w-20 bg-gray-200 rounded-lg animate-pulse"})]})]})},D))})]})}):d?r.jsx("div",{className:"space-y-6",children:r.jsxs("div",{className:"bg-white rounded-lg border border-red-200 p-6 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[r.jsx(dt,{className:"w-5 h-5 text-red-600"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900",children:"Customer Matching Unavailable"}),r.jsx("p",{className:"text-sm text-gray-600",children:d})]})]}),r.jsx("div",{className:"flex gap-3",children:r.jsxs("button",{onClick:_,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[r.jsx(Be,{className:"w-4 h-4"}),"Retry Matching"]})}),r.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:r.jsx("p",{className:"text-sm text-blue-700",children:"Customer matching requires the semantic matching service to be running. Please ensure all services are started and try again."})})]})}):r.jsxs("div",{className:"space-y-6 py-4 px-5",children:[f&&r.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md ${f.type==="success"?"bg-green-100 border border-green-400 text-green-700":"bg-red-100 border border-red-400 text-red-700"}`,children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:`w-2 h-2 rounded-full ${f.type==="success"?"bg-green-600":"bg-red-600"}`}),r.jsx("p",{className:"text-sm font-medium",children:f.message}),r.jsx("button",{onClick:()=>y(null),className:"ml-auto text-lg leading-none hover:opacity-70",children:""})]})}),r.jsxs("div",{className:"bg-white rounded-lg border p-5 shadow-sm p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[r.jsx(kt,{className:"w-5 h-5 text-green-600"}),"Matches for ",e.name]}),r.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[r.jsxs("button",{onClick:()=>x("customers"),className:`px-3 py-1 rounded-md text-sm transition-colors ${g==="customers"?"bg-white shadow-sm text-gray-900 font-medium":"text-gray-600 hover:text-gray-900"}`,children:["Customers (",t.length,")"]}),r.jsxs("button",{onClick:()=>x("leads"),className:`px-3 py-1 rounded-md text-sm transition-colors ${g==="leads"?"bg-white shadow-sm text-gray-900 font-medium":"text-gray-600 hover:text-gray-900"}`,children:["Leads (",s.length,")"]})]})]}),r.jsxs("button",{onClick:async()=>{try{l(!0);try{await mn.clearCache()}catch(C){console.warn("Backend cache clear failed, falling back to local clear",C),mn.clearLocalCache()}await _()}finally{l(!1)}},className:"flex items-center gap-2 px-3 py-1 text-sm bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors",children:[r.jsx(Be,{className:"w-4 h-4"}),"Refresh"]})]}),r.jsxs("div",{className:"flex items-center justify-between mb-4 p-3 bg-gray-50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:"select-all",checked:g==="customers"?b.size===t.length&&t.length>0:w.size===s.length&&s.length>0,onChange:C=>j(C.target.checked),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),r.jsx("label",{htmlFor:"select-all",className:"text-sm text-gray-700",children:"Select All"})]}),r.jsx("span",{className:"text-sm text-gray-500",children:g==="customers"?`${b.size} of ${t.length} customers selected`:`${w.size} of ${s.length} leads selected`})]}),r.jsx("button",{onClick:S,disabled:m||(g==="customers"?b.size===0:w.size===0),className:`flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg transition-colors ${m||(g==="customers"?b.size===0:w.size===0)?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:m?"Assigning...":`Assign Selected (${g==="customers"?b.size:w.size})`})]}),g==="customers"&&r.jsx("div",{children:t.length>0?r.jsx("div",{className:"space-y-4",children:t.map((C,D)=>{var T,M,L,P,$,R,U;const A=((T=C.customer)==null?void 0:T.id)||((M=C.customer)==null?void 0:M.customer_id),E=b.has(A);return r.jsx("div",{className:`border rounded-lg p-4 transition-colors ${E?"border-green-200 bg-green-50":"border-gray-200 hover:bg-gray-50"}`,children:r.jsx("div",{className:"flex items-start justify-between",children:r.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[r.jsx("input",{type:"checkbox",checked:E,onChange:()=>k(C,"customer"),className:"mt-1 rounded border-gray-300 text-green-600 focus:ring-green-500"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("h4",{className:"font-medium text-gray-900",children:((L=C.customer)==null?void 0:L.customer_name)||((P=C.customer)==null?void 0:P.name)||"Unknown Customer"}),r.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700",children:"Customer"}),r.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${C.matchScore>=80?"bg-green-100 text-green-700":C.matchScore>=60?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[C.matchScore,"%"]})]}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600 mb-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(kt,{className:"w-4 h-4"}),r.jsxs("span",{children:["Profile: ",C.overallSimilarity,"%"]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(qt,{className:"w-4 h-4"}),r.jsxs("span",{children:["Industry: ",C.industryAlignment,"%"]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ot,{className:"w-4 h-4"}),r.jsxs("span",{children:["Skills: ",C.skillsMatch,"%"]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ur,{className:"w-4 h-4"}),r.jsxs("span",{children:["Value: $",((($=C.customer)==null?void 0:$.total_sales)||((R=C.customer)==null?void 0:R.contractValue)||0).toLocaleString()]})]})]}),r.jsxs("div",{className:"text-xs text-gray-500",children:[r.jsx("strong",{children:"Reasons:"})," ",((U=C.reasons)==null?void 0:U.join(", "))||"No specific reasons available"]})]})]})})},D)})}):r.jsxs("div",{className:"text-center text-gray-500 text-sm py-8",children:[r.jsx(kt,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),r.jsx("p",{children:"No customer matches found for this employee."}),r.jsx("p",{className:"text-xs mt-1",children:"Try refreshing or check if customers are available in the system."})]})}),g==="leads"&&r.jsx("div",{children:s.length>0?r.jsx("div",{className:"space-y-4",children:s.map((C,D)=>{var T,M,L,P,$,R,U;const A=((T=C.customer)==null?void 0:T.id)||((M=C.customer)==null?void 0:M.customer_id),E=w.has(A);return r.jsx("div",{className:`border rounded-lg p-4 transition-colors ${E?"border-green-200 bg-green-50":"border-gray-200 hover:bg-gray-50"}`,children:r.jsx("div",{className:"flex items-start justify-between",children:r.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[r.jsx("input",{type:"checkbox",checked:E,onChange:()=>k(C,"lead"),className:"mt-1 rounded border-gray-300 text-green-600 focus:ring-green-500"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("h4",{className:"font-medium text-gray-900",children:((L=C.customer)==null?void 0:L.customer_name)||((P=C.customer)==null?void 0:P.name)||"Unknown Lead"}),r.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-700",children:"Lead"}),r.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${C.matchScore>=80?"bg-green-100 text-green-700":C.matchScore>=60?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[C.matchScore,"%"]})]}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600 mb-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(kt,{className:"w-4 h-4"}),r.jsxs("span",{children:["Profile: ",C.overallSimilarity,"%"]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(qt,{className:"w-4 h-4"}),r.jsxs("span",{children:["Industry: ",C.industryAlignment,"%"]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ot,{className:"w-4 h-4"}),r.jsxs("span",{children:["Skills: ",C.skillsMatch,"%"]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ur,{className:"w-4 h-4"}),r.jsxs("span",{children:["Value: $",((($=C.customer)==null?void 0:$.total_sales)||((R=C.customer)==null?void 0:R.contractValue)||0).toLocaleString()]})]})]}),r.jsxs("div",{className:"text-xs text-gray-500",children:[r.jsx("strong",{children:"Reasons:"})," ",((U=C.reasons)==null?void 0:U.join(", "))||"No specific reasons available"]})]})]})})},D)})}):r.jsxs("div",{className:"text-center text-gray-500 text-sm py-8",children:[r.jsx(kt,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),r.jsx("p",{children:"No lead matches found for this employee."}),r.jsx("p",{className:"text-xs mt-1",children:"Try refreshing or check if leads are available in the system."})]})})]})]}):r.jsx("div",{className:"space-y-6",children:r.jsx("div",{className:"bg-white rounded-lg border border-yellow-200 p-6 shadow-sm",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(dt,{className:"w-5 h-5 text-yellow-600"}),r.jsx("p",{className:"text-gray-600",children:"No employee selected for customer matching."})]})})})},e6=()=>{const{selectedEmployee:e,setSelectedEmployee:t,refreshEmployeeData:n}=ua(),[s,a]=h.useState("overview"),[i,l]=h.useState(!1),[o,c]=h.useState(null),[d,u]=h.useState(!1),[m,p]=h.useState({}),[f,y]=h.useState(!1),[g,x]=h.useState([]),[b,v]=h.useState(!1),[w,N]=h.useState({}),[k,j]=h.useState(!1),[S,_]=h.useState({}),[C,D]=h.useState(!1),[A,E]=h.useState([]),[T,M]=h.useState(!1),[L,P]=h.useState(null);h.useEffect(()=>{e&&(a("overview"),u(!1),y(!1),v(!1),j(!1),D(!1),p({}),x([]),N({}),_({}),E([]),P(null),M(!1),l(!1),c(null))},[e==null?void 0:e.id]);const $=()=>{a("overview"),u(!1),y(!1),v(!1),j(!1),D(!1),p({}),x([]),N({}),_({}),E([]),P(null),M(!1),l(!1),c(null),t(null)},R=()=>{const ee=Jk(e);c(ee),l(!0)},U=()=>{var te;const ee=At(),X=((te=e.location)==null?void 0:te.office)||ee;p({email:e.email||"",phone:e.phone||"",location:ee,mainOffice:X,timezone:e.timezone||"EST",department:e.department||""}),u(!0),P(null)},I=()=>{u(!1),p({}),P(null)},z=async()=>{M(!0),P(null);try{let ee=m.location;typeof ee=="string"&&(ee={city:ee});const X={...e,email:m.email||null,phone:m.phone||null,location:ee||{},timezone:m.timezone||"EST",department:m.department||null,...m.mainOffice&&{location:{...ee,office:m.mainOffice}}},te=await fetch(`http://localhost:7001/api/employees/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(X)});if(!te.ok){const Ne=await te.json().catch(()=>({}));throw new Error(`Failed to update employee: ${te.statusText}. ${Ne.detail||""}`)}const we=await te.json();t(we),n&&await n(),u(!1),p({})}catch(ee){console.error("Error updating contact information:",ee),P("Failed to update contact information. Please try again.")}finally{M(!1)}},F=(ee,X)=>{p(te=>({...te,[ee]:X}))},O=()=>{const ee=Ee(),X=ee.length>0?ee.map(te=>{const we=te.level||"Beginner";let Ne;switch(we){case"Beginner":Ne=25;break;case"Intermediate":Ne=50;break;case"Fluent":Ne=75;break;case"Native":Ne=100;break;default:Ne=te.percentage||50}return{name:te.name||"",level:we,percentage:Ne}}):[{name:"",level:"Beginner",percentage:25}];x(X),y(!0),P(null)},K=()=>{y(!1),x([]),P(null)},J=()=>{x(ee=>[...ee,{name:"",level:"Beginner",percentage:25}])},se=ee=>{x(X=>X.filter((te,we)=>we!==ee))},Z=ee=>({INTJ:{nickname:"The Architect",workingStyle:["Strategic and analytical thinking","Independent problem solver","Systems-oriented approach","Long-term planning focus"],communicationPreferences:["Precise and logical communication","Values intellectual discussions","Prefers written over verbal communication","Appreciates detailed explanations"],idealCollaboration:"Thrives in environments where they can work independently on complex problems and contribute strategic insights to team projects."},INTP:{nickname:"The Thinker",workingStyle:["Enjoys theoretical and conceptual work","Prefers flexible schedules and autonomy","Excels at analysis and problem-solving","Motivated by intellectual challenges"],communicationPreferences:["Appreciates logical and precise communication","Prefers discussing ideas over small talk","Values intellectual debate and exploration","Needs time to process complex information"],idealCollaboration:"Thrives in intellectually stimulating environments with freedom to explore ideas. Works well with other analytical thinkers who respect independent thinking."},ENTJ:{nickname:"The Commander",workingStyle:["Natural leader who takes charge of projects","Enjoys organizing systems and people","Focuses on efficiency and results","Thrives on challenges and competition"],communicationPreferences:["Direct, confident, and assertive communication","Appreciates structured meetings and clear agendas","Values quick decision-making and action","Enjoys strategic discussions and planning"],idealCollaboration:"Excels in leadership roles with authority to make decisions. Works best with motivated team members who can execute plans efficiently."},ENTP:{nickname:"The Debater",workingStyle:["Enjoys brainstorming and generating new ideas","Prefers variety and changing priorities","Excels at seeing possibilities and connections","Motivated by innovation and creativity"],communicationPreferences:["Enthusiastic and energetic communication style","Enjoys debating ideas and exploring options","Values creativity and out-of-the-box thinking","Prefers dynamic and interactive discussions"],idealCollaboration:"Thrives in creative, fast-paced environments with opportunities to explore new ideas. Works well with diverse teams that encourage innovation."},INFJ:{nickname:"The Advocate",workingStyle:["Values meaningful work aligned with personal values","Prefers quiet, focused work environment","Excels at understanding people and motivations","Focuses on long-term impact and vision"],communicationPreferences:["Thoughtful and empathetic communication style","Prefers one-on-one or small group discussions","Values deep, meaningful conversations","Needs time to formulate thoughtful responses"],idealCollaboration:"Works best in supportive environments focused on helping others. Thrives with like-minded individuals who share similar values and vision."},INFP:{nickname:"The Mediator",workingStyle:["Motivated by personal values and authenticity","Prefers flexible work arrangements","Excels at creative and expressive work","Values harmony and individual expression"],communicationPreferences:["Gentle and considerate communication style","Values empathy and emotional connection","Prefers supportive and encouraging feedback","Appreciates recognition of individual contributions"],idealCollaboration:"Thrives in harmonious, values-driven environments. Works well with supportive colleagues who respect individual creativity and authenticity."},ENFJ:{nickname:"The Protagonist",workingStyle:["Focuses on developing and motivating others","Enjoys collaborative and team-oriented work","Excels at communication and relationship building","Values personal growth and positive impact"],communicationPreferences:["Warm, encouraging, and inspiring communication","Enjoys facilitating group discussions","Values emotional connection and understanding","Provides supportive and developmental feedback"],idealCollaboration:"Excels in team environments where they can mentor and inspire others. Works best with collaborative, growth-oriented colleagues."},ENFP:{nickname:"The Campaigner",workingStyle:["Enjoys variety and new challenges","Thrives on inspiration and possibilities","Excels at motivating and energizing others","Values creativity and personal expression"],communicationPreferences:["Enthusiastic and expressive communication style","Enjoys brainstorming and collaborative discussions","Values emotional connection and authenticity","Appreciates positive and encouraging interactions"],idealCollaboration:"Thrives in energetic, creative environments with opportunities for innovation. Works well with diverse, enthusiastic team members."},ISTJ:{nickname:"The Logistician",workingStyle:["Prefers structured and organized work environment","Excels at detailed and systematic tasks","Values reliability and consistency","Focuses on proven methods and best practices"],communicationPreferences:["Clear, factual, and organized communication","Prefers structured meetings with defined outcomes","Values detailed information and documentation","Appreciates direct and honest feedback"],idealCollaboration:"Works best in stable, well-organized environments with clear expectations. Thrives with dependable colleagues who value quality and accuracy."},ISFJ:{nickname:"The Protector",workingStyle:["Focuses on supporting and helping others","Prefers stable and harmonious work environment","Excels at detailed, service-oriented tasks","Values tradition and established procedures"],communicationPreferences:["Considerate and supportive communication style","Prefers face-to-face or personal interactions","Values harmony and avoids conflict","Appreciates recognition and appreciation"],idealCollaboration:"Thrives in supportive, people-focused environments. Works well with caring colleagues who value teamwork and mutual support."},ESTJ:{nickname:"The Executive",workingStyle:["Natural organizer who enjoys managing projects","Prefers structured and efficient work processes","Excels at coordination and implementation","Values results and productivity"],communicationPreferences:["Direct, organized, and results-focused communication","Enjoys leading meetings and making decisions","Values clear expectations and accountability","Appreciates efficient and timely communication"],idealCollaboration:"Excels in leadership roles with clear authority and structure. Works best with organized, goal-oriented team members."},ESFJ:{nickname:"The Consul",workingStyle:["Focuses on creating harmony and supporting others","Enjoys collaborative and people-centered work","Excels at organizing and coordinating team activities","Values service and helping others succeed"],communicationPreferences:["Warm, friendly, and supportive communication","Enjoys group discussions and team meetings","Values personal connection and rapport","Prefers encouraging and positive feedback"],idealCollaboration:"Thrives in people-focused, harmonious environments. Works best with collaborative colleagues who value relationship-building."},ISTP:{nickname:"The Virtuoso",workingStyle:["Prefers hands-on, practical work","Enjoys troubleshooting and problem-solving","Values independence and flexibility","Excels at working with tools and systems"],communicationPreferences:["Direct and practical communication style","Prefers minimal meetings and bureaucracy","Values efficiency and getting to the point","Appreciates technical and factual discussions"],idealCollaboration:"Works best independently with minimal supervision. Thrives with practical, results-oriented colleagues who respect autonomy."},ISFP:{nickname:"The Adventurer",workingStyle:["Values authentic and meaningful work","Prefers flexible and adaptable work environment","Excels at creative and artistic tasks","Motivated by personal values and harmony"],communicationPreferences:["Gentle, considerate, and personal communication","Prefers one-on-one interactions over group settings","Values empathy and emotional understanding","Appreciates patient and supportive feedback"],idealCollaboration:"Thrives in supportive, values-driven environments that encourage creativity. Works well with understanding colleagues who respect individual expression."},ESTP:{nickname:"The Entrepreneur",workingStyle:["Enjoys action-oriented and dynamic work","Prefers immediate results and quick decisions","Excels at adapting to changing situations","Values practical and hands-on experience"],communicationPreferences:["Energetic, direct, and engaging communication","Prefers face-to-face interactions and active discussions","Values practical information and real-world examples","Appreciates immediate and actionable feedback"],idealCollaboration:"Thrives in fast-paced, dynamic environments with immediate challenges. Works well with energetic colleagues who enjoy action and results."},ESFP:{nickname:"The Entertainer",workingStyle:["Enjoys people-centered and collaborative work","Prefers variety and spontaneous activities","Excels at motivating and energizing others","Values fun and positive work environment"],communicationPreferences:["Enthusiastic, friendly, and expressive communication","Enjoys group interactions and team activities","Values emotional connection and personal relationships","Appreciates positive recognition and celebration"],idealCollaboration:"Thrives in energetic, people-focused environments with opportunities for interaction. Works best with enthusiastic colleagues who enjoy collaboration."}})[ee]||null,oe=ee=>{if(!ee)return"";const X=(ee.extravert||0)>50?"E":"I",te=(ee.sensing||0)>50?"S":"N",we=(ee.thinking||0)>50?"T":"F",Ne=(ee.judging||0)>50?"J":"P";return X+te+we+Ne},W=()=>{var Ne,nt,ie,xe,Ie,Oe;const ee=Ke(),X={extravert:((Ne=ee.percentages)==null?void 0:Ne.extravert)||100-(((nt=ee.percentages)==null?void 0:nt.introvert)||50),sensing:((ie=ee.percentages)==null?void 0:ie.sensing)||100-(((xe=ee.percentages)==null?void 0:xe.intuitive)||50),thinking:((Ie=ee.percentages)==null?void 0:Ie.thinking)||50,judging:((Oe=ee.percentages)==null?void 0:Oe.judging)||50},te=oe(X),we=Z(te);N({percentages:X,type:te,nickname:(we==null?void 0:we.nickname)||""}),v(!0),P(null)},B=()=>{v(!1),N({}),P(null)},V=(ee,X)=>{if(ee.startsWith("percentages.")){const te=ee.split(".")[1],we={...w.percentages,[te]:parseInt(X)},Ne=oe(we),nt=Z(Ne);N(ie=>({...ie,percentages:we,type:Ne,nickname:(nt==null?void 0:nt.nickname)||""}))}},re=async()=>{M(!0),P(null);try{const ee=Z(w.type),X={extravert:w.percentages.extravert,introvert:100-w.percentages.extravert,sensing:w.percentages.sensing,intuitive:100-w.percentages.sensing,thinking:w.percentages.thinking,feeling:100-w.percentages.thinking,judging:w.percentages.judging,perceiving:100-w.percentages.judging},te={...e,mbti_profile:{...e.mbti_profile,type:w.type,nickname:w.nickname,percentages:X,workingStyle:ee?ee.workingStyle:[],communicationPreferences:ee?ee.communicationPreferences:[],idealCollaboration:ee?ee.idealCollaboration:""}},we=await fetch(`http://localhost:7001/api/employees/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(te)});if(!we.ok)throw new Error(`Failed to update MBTI: ${we.statusText}`);await we.json(),n&&await n(),v(!1),N({})}catch(ee){console.error("Error updating MBTI:",ee),P("Failed to update MBTI personality. Please try again.")}finally{M(!1)}},Me=()=>{const ee=ye();_({technical:[...ee.technical||[]],domain:[...ee.domain||[]],methodologies:[...ee.methodologies||[]],certifications:[...ee.certifications||[]]}),j(!0),P(null)},he=()=>{j(!1),_({}),P(null)},G=ee=>{_(X=>({...X,[ee]:[...X[ee]||[],""]}))},q=(ee,X)=>{_(te=>({...te,[ee]:te[ee].filter((we,Ne)=>Ne!==X)}))},Q=(ee,X,te)=>{_(we=>({...we,[ee]:we[ee].map((Ne,nt)=>nt===X?te:Ne)}))},ue=async()=>{M(!0),P(null);try{const ee={technical:(S.technical||[]).filter(we=>we.trim()!==""),domain:(S.domain||[]).filter(we=>we.trim()!==""),methodologies:(S.methodologies||[]).filter(we=>we.trim()!==""),certifications:(S.certifications||[]).filter(we=>we.trim()!=="")},X={...e,skills:ee},te=await fetch(`http://localhost:7001/api/employees/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(X)});if(!te.ok)throw new Error(`Failed to update skills: ${te.statusText}`);await te.json(),n&&await n(),j(!1),_({})}catch(ee){console.error("Error updating skills:",ee),P("Failed to update skills. Please try again.")}finally{M(!1)}},Le=()=>{const ee=st(),X=ee.length>0?ee.map(te=>({company:te.company||"",role:te.role||te.position||"",period:te.period||"",description:te.description||""})):[];E(X),D(!0),P(null)},ge=()=>{D(!1),E([]),P(null)},Se=()=>{E(ee=>[...ee,{company:"",role:"",period:"",description:""}])},ce=ee=>{E(X=>X.filter((te,we)=>we!==ee))},ke=(ee,X,te)=>{E(we=>we.map((Ne,nt)=>nt===ee?{...Ne,[X]:te}:Ne))},Pe=async()=>{M(!0),P(null);try{const ee=A.filter(we=>we.company.trim()!==""||we.role.trim()!==""||we.period.trim()!==""||we.description.trim()!==""),X={...e,experiences:ee},te=await fetch(`http://localhost:7001/api/employees/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(X)});if(!te.ok)throw new Error(`Failed to update experience: ${te.statusText}`);await te.json(),n&&await n(),D(!1),E([])}catch(ee){console.error("Error updating experience:",ee),P("Failed to update work experience. Please try again.")}finally{M(!1)}},qe=(ee,X,te)=>{x(we=>we.map((Ne,nt)=>{if(nt===ee){const ie={...Ne,[X]:te};if(X==="level")switch(te){case"Beginner":ie.percentage=25;break;case"Intermediate":ie.percentage=50;break;case"Fluent":ie.percentage=75;break;case"Native":ie.percentage=100;break;default:ie.percentage=50}return ie}return Ne}))},ne=async()=>{M(!0),P(null);try{const ee=g.filter(Ne=>Ne.name.trim()!==""),X={...e,languages:ee},te=await fetch(`http://localhost:7001/api/employees/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(X)});if(!te.ok){const Ne=await te.json().catch(()=>({}));throw new Error(`Failed to update language skills: ${te.statusText}. ${Ne.detail||""}`)}const we=await te.json();t(we),n&&await n(),y(!1),x([])}catch(ee){console.error("Error updating language skills:",ee),P("Failed to update language skills. Please try again.")}finally{M(!1)}},ye=()=>{try{return e!=null&&e.skills&&typeof e.skills=="object"?e.skills:{technical:[],domain:[],methodologies:[],certifications:[]}}catch(ee){return console.warn("Error parsing skills:",ee),{technical:[],domain:[],methodologies:[],certifications:[]}}},Ee=()=>{try{return e!=null&&e.languages&&Array.isArray(e.languages)?e.languages:[]}catch(ee){return console.warn("Error parsing languages:",ee),[]}},st=()=>{try{return e!=null&&e.experiences&&Array.isArray(e.experiences)?e.experiences:[]}catch(ee){return console.warn("Error parsing experiences:",ee),[]}},Ke=()=>{try{return e!=null&&e.mbti_profile&&typeof e.mbti_profile=="object"?e.mbti_profile:{type:"",nickname:"",percentages:{extravert:50,intuitive:50,thinking:50,judging:50},workingStyle:[],communicationPreferences:[],idealCollaboration:""}}catch(ee){return console.warn("Error parsing MBTI profile:",ee),{type:"",nickname:"",percentages:{extravert:50,intuitive:50,thinking:50,judging:50},workingStyle:[],communicationPreferences:[],idealCollaboration:""}}},At=()=>{var ee;try{return typeof e.location=="object"&&((ee=e.location)!=null&&ee.city)?e.location.city:typeof e.location=="string"?e.location:"Not specified"}catch(X){return console.warn("Error parsing location:",X),"Not specified"}},lt=ye(),Ht=Ee(),pt=st(),be=Ke(),ze=()=>{var ee,X,te,we,Ne,nt,ie,xe,Ie,Oe,Ue,$e,ot,fe,pe,je,Fe;switch(s){case"overview":return r.jsx("div",{className:"bg-gray-50 min-h-[600px]",children:r.jsx("div",{className:"py-4 px-5",children:r.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-10 gap-4",children:[r.jsxs("div",{className:"xl:col-span-7 space-y-4",children:[r.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6 py-4 px-6",children:r.jsxs(H,{className:"bg-green-600 hover:bg-green-700 text-white",children:[r.jsx(yt,{className:"w-4 h-4 mr-2"}),"View Calendar"]})}),r.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("h3",{className:"text-lg font-bold text-black font-[Inter] flex items-center gap-2",children:[r.jsx(Ot,{className:"w-5 h-5 text-green-600"}),"Employee Intelligence & Analysis"]}),r.jsxs(H,{variant:"outline",className:"border-gray-300 text-gray-600 hover:bg-gray-50 gap-x-2",onClick:R,children:[r.jsx(Br,{className:"w-4 h-4"}),i?"Regenerate Report":"Generate Report"]})]}),r.jsx("div",{className:`h-96 bg-gray-50 border ${i&&o?"border-gray-400":"border-gray-200"} overflow-y-auto p-6`,children:i&&o?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"bg-white rounded-lg border p-4 shadow-sm",children:[r.jsxs("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[r.jsx(Br,{className:"w-4 h-4 text-purple-600"}),"Success Factors Analysis"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsx("h5",{className:"font-medium text-gray-900 text-sm",children:"Performance Insights"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ot,{className:"w-3 h-3 text-green-600"}),r.jsx("span",{className:"text-xs font-medium",children:"Performance Score"})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("div",{className:"text-sm font-bold text-green-700",children:[o.performanceInsights.score,"/100"]}),r.jsx("div",{className:"text-xs text-green-600",children:o.performanceInsights.rating})]})]}),r.jsxs("div",{className:"flex items-center justify-between p-2 bg-blue-50 rounded",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Er,{className:"w-3 h-3 text-blue-600"}),r.jsx("span",{className:"text-xs font-medium",children:"Deals Won"})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("div",{className:"text-sm font-bold text-blue-700",children:o.performanceInsights.dealsWon}),r.jsx("div",{className:"text-xs text-blue-600",children:o.performanceInsights.dealsWon>=5?"High Closer":o.performanceInsights.dealsWon>=2?"Moderate":"Growing"})]})]}),r.jsxs("div",{className:"flex items-center justify-between p-2 bg-purple-50 rounded",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(jt,{className:"w-3 h-3 text-purple-600"}),r.jsx("span",{className:"text-xs font-medium",children:"Response Time"})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("div",{className:"text-sm font-bold text-purple-700",children:o.performanceInsights.responseTime}),r.jsx("div",{className:"text-xs text-purple-600",children:(ee=o.performanceInsights.responseTime)!=null&&ee.includes("hour")?"Excellent":"Good"})]})]})]})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("h5",{className:"font-medium text-gray-900 text-sm",children:"Specialization Strength"}),r.jsx("div",{className:"space-y-2",children:((X=e.specialties)==null?void 0:X.slice(0,3).map((Y,me)=>r.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Vi,{className:"w-3 h-3 text-gray-600"}),r.jsx("span",{className:"text-xs font-medium",children:Y})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("div",{className:"text-xs font-bold text-gray-700",children:[Xk(e.specialties,me),"%"]}),r.jsx("div",{className:"text-xs text-gray-500",children:"Proficiency"})]})]},me)))||r.jsx("div",{className:"text-xs text-gray-500",children:"No specialties defined"})})]})]})]}),r.jsxs("div",{className:"bg-white rounded-lg border p-4 shadow-sm",children:[r.jsxs("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[r.jsx(Bn,{className:"w-4 h-4 text-blue-600"}),"Department Benchmarking"]}),r.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[r.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded",children:[r.jsx("div",{className:"text-lg font-bold text-blue-700",children:o.performanceInsights.score}),r.jsx("div",{className:"text-xs text-blue-600",children:"Your Score"})]}),r.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded",children:[r.jsx("div",{className:"text-lg font-bold text-gray-700",children:o.departmentAverage}),r.jsx("div",{className:"text-xs text-gray-600",children:"Dept Average"})]}),r.jsxs("div",{className:"text-center p-3 bg-green-50 rounded",children:[r.jsxs("div",{className:"text-lg font-bold text-green-700",children:[o.vsAverage.sign,o.vsAverage.difference]}),r.jsx("div",{className:"text-xs text-green-600",children:"vs Average"})]})]})]}),r.jsxs("div",{className:"bg-white rounded-lg border p-4 shadow-sm",children:[r.jsxs("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[r.jsx(Ml,{className:"w-4 h-4 text-yellow-600"}),"Key Success Patterns"]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-start gap-2 p-3 bg-yellow-50 rounded",children:[r.jsx(bt,{className:"w-4 h-4 text-yellow-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h5",{className:"font-medium text-gray-900 text-sm",children:"Experience Advantage"}),r.jsx("p",{className:"text-xs text-gray-600",children:o.successPatterns.experienceAdvantage})]})]}),r.jsxs("div",{className:"flex items-start gap-2 p-3 bg-green-50 rounded",children:[r.jsx(bt,{className:"w-4 h-4 text-green-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h5",{className:"font-medium text-gray-900 text-sm",children:"Strength Utilization"}),r.jsx("p",{className:"text-xs text-gray-600",children:o.successPatterns.strengthUtilization})]})]}),r.jsxs("div",{className:"flex items-start gap-2 p-3 bg-purple-50 rounded",children:[r.jsx(bt,{className:"w-4 h-4 text-purple-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h5",{className:"font-medium text-gray-900 text-sm",children:"Department Alignment"}),r.jsx("p",{className:"text-xs text-gray-600",children:o.successPatterns.departmentAlignment})]})]})]})]}),r.jsxs("div",{className:"bg-white rounded-lg border p-4 shadow-sm",children:[r.jsxs("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[r.jsx(Br,{className:"w-4 h-4 text-indigo-600"}),"Growth Recommendations"]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-start gap-2 p-3 bg-indigo-50 rounded",children:[r.jsx(Ar,{className:"w-4 h-4 text-indigo-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h5",{className:"font-medium text-gray-900 text-sm",children:"Leverage Strengths"}),r.jsx("p",{className:"text-xs text-gray-600",children:o.growthRecommendations.leverageStrengths})]})]}),r.jsxs("div",{className:"flex items-start gap-2 p-3 bg-blue-50 rounded",children:[r.jsx(Er,{className:"w-4 h-4 text-blue-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h5",{className:"font-medium text-gray-900 text-sm",children:"Address Challenges"}),r.jsx("p",{className:"text-xs text-gray-600",children:o.growthRecommendations.addressChallenges})]})]}),r.jsxs("div",{className:"flex items-start gap-2 p-3 bg-green-50 rounded",children:[r.jsx(Vi,{className:"w-4 h-4 text-green-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h5",{className:"font-medium text-gray-900 text-sm",children:"Career Growth"}),r.jsx("p",{className:"text-xs text-gray-600",children:o.growthRecommendations.careerGrowth})]})]})]})]})]}):r.jsx("div",{className:"flex items-center justify-center h-full",children:r.jsx("span",{className:"text-gray-500",children:'Click "Generate Report" to analyze employee performance'})})})]}),r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center justify-between px-6 pt-6 pb-4 border-b border-gray-200",children:[r.jsxs("h3",{className:"text-lg font-bold text-black font-[Inter] flex items-center gap-2",children:[r.jsx(Ml,{className:"w-5 h-5 text-green-600"}),"Skills"]}),!k&&r.jsxs(H,{variant:"ghost",size:"sm",onClick:Me,className:"flex items-center gap-2 text-gray-600 hover:text-green-600 hover:bg-green-50",children:[r.jsx(Ms,{className:"w-4 h-4"}),"Edit"]})]}),r.jsx("div",{className:"p-6",children:k?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("h4",{className:"text-base font-medium text-gray-900",children:"Technical Skills"}),r.jsxs(H,{variant:"ghost",size:"sm",onClick:()=>G("technical"),className:"flex items-center gap-1 text-green-600 hover:text-green-700 hover:bg-green-50 text-sm",children:[r.jsx(Wt,{className:"w-3 h-3"}),"Add"]})]}),r.jsxs("div",{className:"space-y-2",children:[(S.technical||[]).map((Y,me)=>r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"text",value:Y,onChange:_e=>Q("technical",me,_e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",placeholder:"Enter technical skill"}),r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>q("technical",me),className:"text-red-600 hover:text-red-700 hover:bg-red-50 p-1",children:r.jsx(fr,{className:"w-4 h-4"})})]},me)),(!S.technical||S.technical.length===0)&&r.jsx("p",{className:"text-gray-500 text-sm italic",children:"No technical skills added yet"})]})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("h4",{className:"text-base font-medium text-gray-900",children:"Domain Expertise"}),r.jsxs(H,{variant:"ghost",size:"sm",onClick:()=>G("domain"),className:"flex items-center gap-1 text-green-600 hover:text-green-700 hover:bg-green-50 text-sm",children:[r.jsx(Wt,{className:"w-3 h-3"}),"Add"]})]}),r.jsxs("div",{className:"space-y-2",children:[(S.domain||[]).map((Y,me)=>r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"text",value:Y,onChange:_e=>Q("domain",me,_e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",placeholder:"Enter domain expertise"}),r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>q("domain",me),className:"text-red-600 hover:text-red-700 hover:bg-red-50 p-1",children:r.jsx(fr,{className:"w-4 h-4"})})]},me)),(!S.domain||S.domain.length===0)&&r.jsx("p",{className:"text-gray-500 text-sm italic",children:"No domain expertise added yet"})]})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("h4",{className:"text-base font-medium text-gray-900",children:"Methodologies"}),r.jsxs(H,{variant:"ghost",size:"sm",onClick:()=>G("methodologies"),className:"flex items-center gap-1 text-green-600 hover:text-green-700 hover:bg-green-50 text-sm",children:[r.jsx(Wt,{className:"w-3 h-3"}),"Add"]})]}),r.jsxs("div",{className:"space-y-2",children:[(S.methodologies||[]).map((Y,me)=>r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"text",value:Y,onChange:_e=>Q("methodologies",me,_e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",placeholder:"Enter methodology"}),r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>q("methodologies",me),className:"text-red-600 hover:text-red-700 hover:bg-red-50 p-1",children:r.jsx(fr,{className:"w-4 h-4"})})]},me)),(!S.methodologies||S.methodologies.length===0)&&r.jsx("p",{className:"text-gray-500 text-sm italic",children:"No methodologies added yet"})]})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("h4",{className:"text-base font-medium text-gray-900",children:"Certifications"}),r.jsxs(H,{variant:"ghost",size:"sm",onClick:()=>G("certifications"),className:"flex items-center gap-1 text-green-600 hover:text-green-700 hover:bg-green-50 text-sm",children:[r.jsx(Wt,{className:"w-3 h-3"}),"Add"]})]}),r.jsxs("div",{className:"space-y-2",children:[(S.certifications||[]).map((Y,me)=>r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"text",value:Y,onChange:_e=>Q("certifications",me,_e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",placeholder:"Enter certification"}),r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>q("certifications",me),className:"text-red-600 hover:text-red-700 hover:bg-red-50 p-1",children:r.jsx(fr,{className:"w-4 h-4"})})]},me)),(!S.certifications||S.certifications.length===0)&&r.jsx("p",{className:"text-gray-500 text-sm italic",children:"No certifications added yet"})]})]}),r.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t",children:[r.jsxs(H,{onClick:ue,disabled:T,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white disabled:opacity-50",children:[r.jsx($n,{className:"w-4 h-4"}),T?"Saving...":"Save Changes"]}),r.jsxs(H,{variant:"outline",onClick:he,disabled:T,className:"flex items-center gap-2",children:[r.jsx(Ze,{className:"w-4 h-4"}),"Cancel"]})]})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"text-base font-medium text-gray-900 mb-3",children:"Technical Skills"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:lt.technical&&lt.technical.length>0?lt.technical.map((Y,me)=>r.jsx("span",{className:"px-3 py-1 bg-blue-50 text-blue-700 text-sm font-medium rounded-full",children:Y},me)):r.jsx("span",{className:"text-gray-500 text-sm",children:"No technical skills data available"})})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-base font-medium text-gray-900 mb-3",children:"Domain Expertise"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:lt.domain&&lt.domain.length>0?lt.domain.map((Y,me)=>r.jsx("span",{className:"px-3 py-1 bg-green-50 text-green-700 text-sm font-medium rounded-full",children:Y},me)):r.jsx("span",{className:"text-gray-500 text-sm",children:"No domain expertise data available"})})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-base font-medium text-gray-900 mb-3",children:"Methodologies"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:lt.methodologies&&lt.methodologies.length>0?lt.methodologies.map((Y,me)=>r.jsx("span",{className:"px-3 py-1 bg-purple-50 text-purple-700 text-sm font-medium rounded-full",children:Y},me)):r.jsx("span",{className:"text-gray-500 text-sm",children:"No methodologies data available"})})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-base font-medium text-gray-900 mb-3",children:"Certifications"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:lt.certifications&&lt.certifications.length>0?lt.certifications.map((Y,me)=>r.jsx("span",{className:"px-3 py-1 bg-yellow-50 text-yellow-700 text-sm font-medium rounded-full",children:Y},me)):r.jsx("span",{className:"text-gray-500 text-sm",children:"No certifications data available"})})]})]})})]}),r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center justify-between px-6 pt-6 pb-4 border-b border-gray-200",children:[r.jsxs("h3",{className:"text-lg font-bold text-black font-[Inter] flex items-center gap-2",children:[r.jsx(Ko,{className:"w-5 h-5 text-green-600"}),"Past Experience"]}),!C&&r.jsxs(H,{variant:"ghost",size:"sm",onClick:Le,className:"flex items-center gap-2 text-gray-600 hover:text-green-600 hover:bg-green-50",children:[r.jsx(Ms,{className:"w-4 h-4"}),"Edit"]})]}),r.jsx("div",{className:"p-6",children:C?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h4",{className:"text-base font-medium text-gray-900",children:"Work Experience"}),r.jsxs(H,{variant:"ghost",size:"sm",onClick:Se,className:"flex items-center gap-1 text-green-600 hover:text-green-700 hover:bg-green-50 text-sm",children:[r.jsx(Wt,{className:"w-3 h-3"}),"Add Experience"]})]}),r.jsx("div",{className:"space-y-6",children:A.map((Y,me)=>r.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Experience ",me+1]}),A.length>1&&r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>ce(me),className:"text-red-600 hover:text-red-700 hover:bg-red-50 p-1",children:r.jsx(fr,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Company"}),r.jsx("input",{type:"text",value:Y.company,onChange:_e=>ke(me,"company",_e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",placeholder:"Enter company name"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Period"}),r.jsx("input",{type:"text",value:Y.period,onChange:_e=>ke(me,"period",_e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",placeholder:"e.g., 2020 - 2023"})]})]}),r.jsxs("div",{className:"mt-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Role/Position"}),r.jsx("input",{type:"text",value:Y.role,onChange:_e=>ke(me,"role",_e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",placeholder:"Enter job title/role"})]}),r.jsxs("div",{className:"mt-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Description"}),r.jsx("textarea",{value:Y.description,onChange:_e=>ke(me,"description",_e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",placeholder:"Describe your role, responsibilities, and achievements"})]})]},me))}),A.length===0&&r.jsxs("div",{className:"text-center py-8",children:[r.jsx("p",{className:"text-gray-500 text-sm italic mb-4",children:"No work experience added yet"}),r.jsxs(H,{onClick:Se,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white",children:[r.jsx(Wt,{className:"w-4 h-4"}),"Add Your First Experience"]})]}),r.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t",children:[r.jsxs(H,{onClick:Pe,disabled:T,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white disabled:opacity-50",children:[r.jsx($n,{className:"w-4 h-4"}),T?"Saving...":"Save Changes"]}),r.jsxs(H,{variant:"outline",onClick:ge,disabled:T,className:"flex items-center gap-2",children:[r.jsx(Ze,{className:"w-4 h-4"}),"Cancel"]})]})]}):r.jsx("div",{children:pt&&pt.length>0?r.jsx("div",{className:"space-y-6",children:pt.map((Y,me)=>r.jsxs("div",{className:"relative",children:[r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsx("div",{className:"w-4 h-4 bg-green-600 rounded-full border-4 border-green-100 mt-2 relative z-10"}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("h4",{className:"text-base font-semibold text-gray-900",children:Y.company}),r.jsx("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded-full",children:Y.period})]}),r.jsx("p",{className:"text-sm text-gray-600 mb-2",children:Y.position||Y.role}),r.jsx("p",{className:"text-sm text-gray-600",children:Y.description})]})]}),me<pt.length-1&&r.jsx("div",{className:"absolute left-2 top-6 bottom-0 w-0.5 bg-gray-200"})]},me))}):r.jsx("div",{className:"text-center py-8",children:r.jsx("span",{className:"text-gray-500 text-sm",children:"No work experience data available"})})})})]})]}),r.jsxs("div",{className:"xl:col-span-3 space-y-6",children:[r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[r.jsx(YA,{className:"w-5 h-5 text-green-600"}),"Contact Information"]}),!d&&r.jsxs(H,{variant:"ghost",size:"sm",onClick:U,className:"flex items-center gap-2 text-gray-600 hover:text-green-600 hover:bg-green-50",children:[r.jsx(Ms,{className:"w-4 h-4"}),"Edit"]})]}),L&&r.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:r.jsxs("div",{className:"flex items-center gap-2 text-red-800 text-sm",children:[r.jsx(dt,{className:"w-4 h-4"}),L]})}),d?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Email"}),r.jsx("input",{type:"email",value:m.email||"",onChange:Y=>F("email",Y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",placeholder:"Enter email address"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Phone"}),r.jsx("input",{type:"tel",value:m.phone||"",onChange:Y=>F("phone",Y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",placeholder:"Enter phone number"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Location"}),r.jsx("input",{type:"text",value:m.location||"",onChange:Y=>F("location",Y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",placeholder:"Enter current location"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Main Office"}),r.jsx("input",{type:"text",value:m.mainOffice||"",onChange:Y=>F("mainOffice",Y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",placeholder:"Enter main office location"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Timezone"}),r.jsxs("select",{value:m.timezone||"EST",onChange:Y=>F("timezone",Y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",children:[r.jsx("option",{value:"EST",children:"Eastern (EST)"}),r.jsx("option",{value:"CST",children:"Central (CST)"}),r.jsx("option",{value:"MST",children:"Mountain (MST)"}),r.jsx("option",{value:"PST",children:"Pacific (PST)"}),r.jsx("option",{value:"GMT",children:"GMT"}),r.jsx("option",{value:"CET",children:"Central European (CET)"}),r.jsx("option",{value:"JST",children:"Japan (JST)"}),r.jsx("option",{value:"AEST",children:"Australian Eastern (AEST)"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Department"}),r.jsx("input",{type:"text",value:m.department||"",onChange:Y=>F("department",Y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",placeholder:"Enter department"})]}),r.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[r.jsxs(H,{onClick:z,disabled:T,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white disabled:opacity-50",children:[r.jsx($n,{className:"w-4 h-4"}),T?"Saving...":"Save Changes"]}),r.jsxs(H,{variant:"outline",onClick:I,disabled:T,className:"flex items-center gap-2",children:[r.jsx(Ze,{className:"w-4 h-4"}),"Cancel"]})]})]}):r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Email"}),r.jsx("p",{className:"text-base text-gray-900",children:e.email||"Email not provided"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Phone"}),r.jsx("p",{className:"text-base text-gray-900",children:e.phone||"Phone not provided"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Location"}),r.jsx("p",{className:"text-base text-gray-900",children:At()})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Main Office"}),r.jsx("p",{className:"text-sm text-gray-900",children:((te=e.location)==null?void 0:te.office)||At()})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Timezone"}),r.jsx("p",{className:"text-sm text-gray-900",children:e.timezone||"EST"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Department"}),r.jsx("p",{className:"text-sm text-gray-900",children:e.department||"Not specified"})]})]})]}),r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[r.jsx(Gu,{className:"w-5 h-5 text-green-600"}),"Language Skills"]}),!f&&r.jsxs(H,{variant:"ghost",size:"sm",onClick:O,className:"flex items-center gap-2 text-gray-600 hover:text-green-600 hover:bg-green-50",children:[r.jsx(Ms,{className:"w-4 h-4"}),"Edit"]})]}),f?r.jsxs("div",{className:"space-y-4",children:[g.map((Y,me)=>r.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("h4",{className:"text-sm font-medium text-gray-700",children:["Language ",me+1]}),g.length>1&&r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>se(me),className:"text-red-600 hover:text-red-700 hover:bg-red-50 p-1",children:r.jsx(fr,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Language Name"}),r.jsx("input",{type:"text",value:Y.name,onChange:_e=>qe(me,"name",_e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",placeholder:"e.g., English, Spanish, Mandarin"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:"Proficiency Level"}),r.jsxs("select",{value:Y.level,onChange:_e=>qe(me,"level",_e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm",children:[r.jsx("option",{value:"Beginner",children:"Beginner"}),r.jsx("option",{value:"Intermediate",children:"Intermediate"}),r.jsx("option",{value:"Fluent",children:"Fluent"}),r.jsx("option",{value:"Native",children:"Native"})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-500 mb-1",children:["Proficiency Level: ",Y.percentage,"%"]}),r.jsxs("div",{className:"flex items-center gap-6",children:[r.jsx("div",{className:"w-52 bg-gray-200 rounded-full h-2 flex-shrink-0",children:r.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${Y.percentage}%`}})}),r.jsx("span",{className:"text-sm font-semibold text-gray-900",children:Y.level})]})]})]})]},me)),r.jsxs(H,{variant:"outline",onClick:J,className:"w-full flex items-center gap-2 border-dashed border-gray-300 text-gray-600 hover:bg-gray-50",children:[r.jsx(Wt,{className:"w-4 h-4"}),"Add Another Language"]}),r.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[r.jsxs(H,{onClick:ne,disabled:T,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white disabled:opacity-50",children:[r.jsx($n,{className:"w-4 h-4"}),T?"Saving...":"Save Changes"]}),r.jsxs(H,{variant:"outline",onClick:K,disabled:T,className:"flex items-center gap-2",children:[r.jsx(Ze,{className:"w-4 h-4"}),"Cancel"]})]})]}):r.jsx("div",{className:"space-y-4",children:Ht&&Ht.length>0?Ht.map((Y,me)=>r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-500",children:Y.name}),r.jsxs("div",{className:"flex items-center gap-6 mt-1",children:[r.jsx("div",{className:"w-52 bg-gray-200 rounded-full h-2 flex-shrink-0",children:r.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${Y.percentage}%`}})}),r.jsx("span",{className:"text-sm font-semibold text-gray-900",children:Y.level})]})]},me)):r.jsx("div",{className:"text-center py-4",children:r.jsx("span",{className:"text-gray-500 text-sm",children:"No language skills data available"})})})]}),r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[r.jsx(Br,{className:"w-5 h-5 text-green-600"}),"MBTI Personality"]}),!b&&r.jsxs(H,{variant:"ghost",size:"sm",onClick:W,className:"flex items-center gap-2 text-gray-600 hover:text-green-600 hover:bg-green-50",children:[r.jsx(Ms,{className:"w-4 h-4"}),"Edit"]})]}),b?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center",children:[r.jsx("div",{className:"text-2xl font-black text-gray-900 mb-1",children:w.type||"XXXX"}),r.jsxs("p",{className:"text-base text-gray-600",children:['"',w.nickname||"Adjust sliders to see personality type",'"']})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Introvert"}),r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Extravert"})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:"text-xs text-gray-500 w-8",children:"I"}),r.jsx("input",{type:"range",min:"0",max:"100",value:((we=w.percentages)==null?void 0:we.extravert)||50,onChange:Y=>V("percentages.extravert",Y.target.value),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"}),r.jsx("span",{className:"text-xs text-gray-500 w-8",children:"E"})]}),r.jsx("div",{className:"text-center mt-1",children:r.jsxs("span",{className:"text-xs text-gray-600",children:[((Ne=w.percentages)==null?void 0:Ne.extravert)>50?"Extravert":"Introvert"," (",((nt=w.percentages)==null?void 0:nt.extravert)||50,"%)"]})})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Sensing"}),r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Intuitive"})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:"text-xs text-gray-500 w-8",children:"S"}),r.jsx("input",{type:"range",min:"0",max:"100",value:100-(((ie=w.percentages)==null?void 0:ie.sensing)||50),onChange:Y=>V("percentages.sensing",100-parseInt(Y.target.value)),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"}),r.jsx("span",{className:"text-xs text-gray-500 w-8",children:"N"})]}),r.jsx("div",{className:"text-center mt-1",children:r.jsxs("span",{className:"text-xs text-gray-600",children:[((xe=w.percentages)==null?void 0:xe.sensing)>50?"Sensing":"Intuitive"," (",((Ie=w.percentages)==null?void 0:Ie.sensing)>50?(Oe=w.percentages)==null?void 0:Oe.sensing:100-((Ue=w.percentages)==null?void 0:Ue.sensing)||50,"%)"]})})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Feeling"}),r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Thinking"})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:"text-xs text-gray-500 w-8",children:"F"}),r.jsx("input",{type:"range",min:"0",max:"100",value:(($e=w.percentages)==null?void 0:$e.thinking)||50,onChange:Y=>V("percentages.thinking",Y.target.value),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"}),r.jsx("span",{className:"text-xs text-gray-500 w-8",children:"T"})]}),r.jsx("div",{className:"text-center mt-1",children:r.jsxs("span",{className:"text-xs text-gray-600",children:[((ot=w.percentages)==null?void 0:ot.thinking)>50?"Thinking":"Feeling"," (",((fe=w.percentages)==null?void 0:fe.thinking)||50,"%)"]})})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Perceiving"}),r.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Judging"})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:"text-xs text-gray-500 w-8",children:"P"}),r.jsx("input",{type:"range",min:"0",max:"100",value:((pe=w.percentages)==null?void 0:pe.judging)||50,onChange:Y=>V("percentages.judging",Y.target.value),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"}),r.jsx("span",{className:"text-xs text-gray-500 w-8",children:"J"})]}),r.jsx("div",{className:"text-center mt-1",children:r.jsxs("span",{className:"text-xs text-gray-600",children:[((je=w.percentages)==null?void 0:je.judging)>50?"Judging":"Perceiving"," (",((Fe=w.percentages)==null?void 0:Fe.judging)||50,"%)"]})})]})]}),w.type&&Z(w.type)&&r.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[r.jsxs("div",{className:"text-sm text-blue-800 font-medium mb-2",children:[" Personality details will be automatically updated for ",w.type,":"]}),r.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[r.jsxs("div",{children:[" ",r.jsx("strong",{children:"Working Style:"})," ",Z(w.type).workingStyle.length," characteristics"]}),r.jsxs("div",{children:[" ",r.jsx("strong",{children:"Communication Preferences:"})," ",Z(w.type).communicationPreferences.length," preferences"]}),r.jsxs("div",{children:[" ",r.jsx("strong",{children:"Ideal Collaboration:"})," Detailed description"]})]})]}),r.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[r.jsxs(H,{onClick:re,disabled:T,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white disabled:opacity-50",children:[r.jsx($n,{className:"w-4 h-4"}),T?"Saving...":"Save Changes"]}),r.jsxs(H,{variant:"outline",onClick:B,disabled:T,className:"flex items-center gap-2",children:[r.jsx(Ze,{className:"w-4 h-4"}),"Cancel"]})]})]}):be.type?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("h4",{className:"text-2xl font-black text-gray-900 mb-1",children:be.type}),r.jsxs("p",{className:"text-base text-gray-600",children:['"',be.nickname,'"']})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Introvert"}),r.jsxs("p",{className:"text-base text-gray-900",children:[be.percentages.introvert||be.percentages.extravert,"%"]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Intuitive"}),r.jsxs("p",{className:"text-base text-gray-900",children:[be.percentages.intuitive,"%"]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Thinking"}),r.jsxs("p",{className:"text-base text-gray-900",children:[be.percentages.thinking,"%"]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Judging"}),r.jsxs("p",{className:"text-sm text-gray-900",children:[be.percentages.judging,"%"]})]})]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-500 mb-2 block",children:"Working Style"}),r.jsx("div",{className:"text-sm text-gray-600 leading-relaxed",children:be.workingStyle&&be.workingStyle.length>0?be.workingStyle.map((Y,me)=>r.jsx("div",{children:Y},me)):r.jsx("span",{className:"text-gray-500",children:"No working style data available"})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-500 mb-2 block",children:"Communication Preferences"}),r.jsx("div",{className:"text-sm text-gray-600 leading-relaxed",children:be.communicationPreferences&&be.communicationPreferences.length>0?be.communicationPreferences.map((Y,me)=>r.jsx("div",{children:Y},me)):r.jsx("span",{className:"text-gray-500",children:"No communication preferences data available"})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-500 mb-2 block",children:"Ideal Collaboration Environment"}),r.jsx("div",{className:"text-sm text-gray-600 leading-relaxed",children:be.idealCollaboration||r.jsx("span",{className:"text-gray-500",children:"No collaboration data available"})})]})]})]}):r.jsx("div",{className:"text-center py-8",children:r.jsx("span",{className:"text-gray-500 text-sm",children:"No MBTI personality data available"})})]})]})]})})});case"performance-metrics":return r.jsx(vo,{tabName:"Performance Metrics",children:r.jsx(R3,{})});case"customers-leads":return r.jsx(vo,{tabName:"Customer Interaction",children:r.jsx(K3,{})});case"match":return r.jsx(vo,{tabName:"Match",children:r.jsx(Z3,{})});case"insights":return r.jsx(vo,{tabName:"Insights",children:r.jsx(J3,{})});default:return r.jsx(vo,{tabName:"Basic Info",children:r.jsx(L3,{})})}};return r.jsx(ht,{mode:"wait",children:e&&r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black/50 z-50 flex justify-center pt-8 px-8",onClick:$,children:r.jsxs(de.div,{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},transition:{duration:.2,ease:"easeOut"},className:"w-full bg-white rounded-lg shadow-2xl relative h-full flex flex-col",onClick:ee=>ee.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between pt-5 pb-3 px-6 border-b border-gray-200 flex-shrink-0",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center",children:r.jsx(_n,{className:"w-5 h-5 text-white"})}),r.jsx("h1",{className:"text-2xl font-bold text-gray-900 leading-none self-center -mb-1",children:e.name||"Unknown Employee"})]}),r.jsx(H,{variant:"ghost",size:"icon",className:"text-gray-400 hover:text-gray-600",onClick:$,children:r.jsx(Ze,{className:"w-4 h-4"})})]}),r.jsx("div",{className:"border-b border-gray-200 flex-shrink-0 px-6",children:r.jsxs("div",{className:"flex",children:[r.jsxs(H,{variant:"ghost",onClick:()=>a("overview"),className:`flex items-center gap-2 p-4 text-sm font-medium border-b-2 rounded-none ${s==="overview"?"border-green-600 text-green-600 hover:text-green-700":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(sx,{className:"w-4 h-4"}),"Overview"]}),r.jsxs(H,{variant:"ghost",onClick:()=>a("performance-metrics"),className:`flex items-center gap-2 p-4 text-sm font-medium border-b-2 rounded-none ${s==="performance-metrics"?"border-green-600 text-green-600 hover:text-green-700":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(Da,{className:"w-4 h-4"}),"Performance Metrics"]}),r.jsxs(H,{variant:"ghost",onClick:()=>a("customers-leads"),className:`flex items-center gap-2 p-4 text-sm font-medium border-b-2 rounded-none ${s==="customers-leads"?"border-green-600 text-green-600 hover:text-green-700":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(kt,{className:"w-4 h-4"}),"Customers & Leads"]}),r.jsxs(H,{variant:"ghost",onClick:()=>a("match"),className:`flex items-center gap-2 p-4 text-sm font-medium border-b-2 rounded-none ${s==="match"?"border-green-600 text-green-600 hover:text-green-700":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(zn,{className:"w-4 h-4"}),"Match"]}),r.jsxs(H,{variant:"ghost",onClick:()=>a("insights"),className:`flex items-center gap-2 p-4 text-sm font-medium border-b-2 rounded-none ${s==="insights"?"border-green-600 text-green-600 hover:text-green-700":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(Br,{className:"w-4 h-4"}),"Insights"]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:ze()})]})})})},t6=()=>{const{selectedEntry:e,setSelectedEntry:t,getCompanyInfo:n,leadNegotiationSteps:s,setLeadNegotiationSteps:a,customerNegotiationSteps:i,setCustomerNegotiationSteps:l}=ua();if(!e)return null;const{type:o,data:c}=e,d=n(c),u=c.currentStage==="Negotiation",m=o==="lead"?s[c.id]||ei:i[c.id]||ei,p=o==="lead"?f=>a(y=>({...y,[c.id]:typeof f=="function"?f(y[c.id]||ei):f})):f=>l(y=>({...y,[c.id]:typeof f=="function"?f(y[c.id]||ei):f}));return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-auto relative border border-gray-100",children:[r.jsx("button",{className:"absolute top-3 right-4 text-gray-400 hover:text-gray-600 text-2xl",onClick:()=>t(null),children:""}),r.jsxs("div",{className:"p-8 space-y-6",children:[r.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[r.jsxs("div",{className:"flex-1 bg-gradient-to-br from-blue-50 to-purple-50 border border-blue-100 rounded-xl shadow p-5 mb-2",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o==="lead"?r.jsx(_t,{className:"w-5 h-5 text-blue-500"}):r.jsx(kt,{className:"w-5 h-5 text-purple-600"}),r.jsx("h2",{className:"text-lg font-bold text-gray-900",children:c.name}),r.jsx("span",{className:"text-xs text-gray-500 ml-2",children:o==="lead"?"Lead":"Customer"})]}),r.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[r.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-700",children:[r.jsx(Dt,{className:"w-4 h-4 text-blue-400"})," ",d.email]}),r.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-700",children:[r.jsx(sn,{className:"w-4 h-4 text-green-400"})," ",d.phone]}),r.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-700",children:[r.jsx(vn,{className:"w-4 h-4 text-purple-400"})," ",d.location]}),r.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-700",children:[r.jsx(Ur,{className:"w-4 h-4 text-yellow-500"})," ",d.dealValue]})]})]}),r.jsxs("div",{className:"flex-1 bg-gradient-to-br from-green-50 to-yellow-50 border border-green-100 rounded-xl shadow p-5 mb-2 flex flex-col gap-2 justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("span",{className:`inline-block text-xs px-2 py-0.5 rounded font-medium ${c.currentStage==="Closed"?"bg-green-100 text-green-700":c.currentStage==="Negotiation"?"bg-yellow-100 text-yellow-700":o==="lead"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"}`,children:c.currentStage}),r.jsxs("span",{className:"inline-block text-xs bg-gray-100 text-gray-700 px-2 py-0.5 rounded",children:["Last Contact: ",c.lastContactDate]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-xs text-gray-500",children:"Progress:"}),r.jsxs("span",{className:"font-medium text-gray-900",children:[c.progress,"%"]}),r.jsx("div",{className:"flex-1 w-32 bg-gray-200 rounded-full h-1.5",children:r.jsx("div",{className:`h-1.5 rounded-full ${o==="lead"?"bg-gradient-to-r from-blue-500 to-green-500":"bg-gradient-to-r from-purple-500 to-green-500"}`,style:{width:`${c.progress}%`}})})]})]})]}),r.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-xl p-4 flex items-start gap-2",children:[r.jsx(Ut,{className:"w-4 h-4 text-gray-400 mt-0.5"}),r.jsx("span",{className:"text-xs text-gray-700",children:d.notes})]}),u&&r.jsxs("div",{className:"mt-4",children:[r.jsx("div",{className:"text-xs font-bold text-gray-700 mb-2 uppercase tracking-wide",children:"Negotiation Steps"}),r.jsx("div",{className:"negotiation-steps-editor",children:r.jsx(Ff,{entry:c,steps:m,setSteps:p})})]})]})]})})},r6=()=>{const{showAddLead:e,setShowAddLead:t,newLead:n,setNewLead:s,handleAddLead:a}=ua();return e?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("form",{onSubmit:a,className:"bg-white rounded-xl shadow-lg max-w-md w-full p-6 flex flex-col gap-4 border",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h2",{className:"text-lg font-bold text-purple-700",children:"Add New Lead"}),r.jsx("button",{type:"button",className:"text-gray-400 hover:text-gray-600 text-2xl",onClick:()=>t(!1),children:""})]}),r.jsxs("label",{className:"text-sm font-medium text-gray-700",children:["Name",r.jsx("input",{type:"text",className:"mt-1 border rounded px-3 py-2 w-full",value:n.name,onChange:i=>s(l=>({...l,name:i.target.value})),required:!0})]}),r.jsxs("label",{className:"text-sm font-medium text-gray-700",children:["Last Contact Date",r.jsx("input",{type:"date",className:"mt-1 border rounded px-3 py-2 w-full",value:n.lastContactDate,onChange:i=>s(l=>({...l,lastContactDate:i.target.value}))})]}),r.jsxs("label",{className:"text-sm font-medium text-gray-700",children:["Current Stage",r.jsxs("select",{className:"mt-1 border rounded px-3 py-2 w-full",value:n.currentStage,onChange:i=>s(l=>({...l,currentStage:i.target.value})),children:[r.jsx("option",{value:"Contacted",children:"Contacted"}),r.jsx("option",{value:"Negotiation",children:"Negotiation"}),r.jsx("option",{value:"Closed",children:"Closed"})]})]}),r.jsxs("label",{className:"text-sm font-medium text-gray-700",children:["Progress (%)",r.jsx("input",{type:"number",min:"0",max:"100",className:"mt-1 border rounded px-3 py-2 w-full",value:n.progress,onChange:i=>s(l=>({...l,progress:Number(i.target.value)}))})]}),r.jsxs("div",{className:"flex gap-2 mt-4",children:[r.jsx(H,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),r.jsx(H,{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Add Lead"})]})]})}):null},n6=()=>{const{showAddCustomer:e,setShowAddCustomer:t,newCustomer:n,setNewCustomer:s,handleAddCustomer:a}=ua();return e?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("form",{onSubmit:a,className:"bg-white rounded-xl shadow-lg max-w-md w-full flex flex-col gap-4 border",style:{padding:"32px"},children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h2",{className:"text-lg font-bold text-purple-700",children:"Add New Customer"}),r.jsx(qs,{icon:Ze,variant:"ghost",onClick:()=>t(!1)})]}),r.jsxs(Kk,{children:[r.jsx($o,{label:"Name",type:"text",value:n.name,onChange:i=>s(l=>({...l,name:i.target.value})),required:!0}),r.jsx($o,{label:"Last Contact Date",type:"date",value:n.lastContactDate,onChange:i=>s(l=>({...l,lastContactDate:i.target.value}))}),r.jsx($o,{label:"Current Stage",value:n.currentStage,onChange:i=>s(l=>({...l,currentStage:i.target.value})),children:r.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:n.currentStage,onChange:i=>s(l=>({...l,currentStage:i.target.value})),children:[r.jsx("option",{value:"Warm",children:"Warm"}),r.jsx("option",{value:"Negotiation",children:"Negotiation"}),r.jsx("option",{value:"Closed",children:"Closed"})]})}),r.jsx($o,{label:"Progress (%)",type:"number",min:"0",max:"100",value:n.progress,onChange:i=>s(l=>({...l,progress:Number(i.target.value)}))})]}),r.jsxs("div",{className:"flex gap-2 mt-4",children:[r.jsx(H,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),r.jsx(H,{type:"submit",className:"bg-purple-600 hover:bg-purple-700 text-white",children:"Add Customer"})]})]})}):null},Qk=(e,t)=>{var n,s,a;switch(t){case"revenue":return{title:"Revenue Contribution",value:`$${(((n=e.performance)==null?void 0:n.total_revenue)||0).toLocaleString()}`,subtitle:"Total Revenue",icon:"DollarSign",bgColor:"bg-green-50"};case"experience":return{title:"Experience",value:`${e.working_year||e.experience||0} years`,subtitle:"Professional Experience",icon:"Award",bgColor:"bg-blue-50"};case"performance":return{title:"Performance Score",value:`${e.performance_score||80}%`,subtitle:"Recent Performance",icon:"TrendingUp",bgColor:"bg-purple-50"};case"feedback":return{title:"Feedback Rating",value:`${(e.feedback_rating||((a=(s=e.performance)==null?void 0:s.peer_evaluations)==null?void 0:a.averageScore)||0).toFixed(1)} `,subtitle:"Average Rating",icon:"Heart",bgColor:"bg-pink-50"};default:return Qk(e,"revenue")}},tv=(e,t)=>{var n,s,a,i;switch(t){case"revenue":return((n=e.performance)==null?void 0:n.total_revenue)||0;case"experience":return e.working_year||e.experience||0;case"performance":return e.performance_score||80;case"feedback":return e.feedback_rating||((a=(s=e.performance)==null?void 0:s.peer_evaluations)==null?void 0:a.averageScore)||0;default:return((i=e.performance)==null?void 0:i.total_revenue)||0}},s6=({isOpen:e,onClose:t,onSubmit:n,loading:s=!1})=>{const[a,i]=h.useState({name:"",email:"",role:"",department:"",phone:"",hire_date:"",availability:"available",location:"",city:"",country:"",timezone:"EST",experience:0}),[l,o]=h.useState({}),c=["Sales","Marketing","Engineering","HR","Finance","Operations","Customer Success","Product","Design","Legal"],d=[{value:"available",label:"Available"},{value:"busy",label:"Busy"},{value:"partially-available",label:"Partially Available"},{value:"on-leave",label:"On Leave"}];if(!e)return null;const u=()=>{const f={};a.name.trim()||(f.name="Name is required"),a.email.trim()||(f.email="Email is required"),a.role.trim()||(f.role="Role is required"),a.department||(f.department="Department is required"),a.hire_date||(f.hire_date="Hire date is required");const y=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return a.email&&!y.test(a.email)&&(f.email="Please enter a valid email address"),o(f),Object.keys(f).length===0},m=(f,y)=>{i(g=>({...g,[f]:y})),l[f]&&o(g=>({...g,[f]:""}))},p=async f=>{if(f.preventDefault(),!!u())try{const y={name:a.name,email:a.email,role:a.role,department:a.department,hire_date:a.hire_date,availability:a.availability,phone:a.phone||null,experience:a.experience||0,timezone:a.timezone||"EST"};await n(y),i({name:"",email:"",role:"",department:"",phone:"",hire_date:"",availability:"available",location:"",city:"",country:"",timezone:"EST",experience:0}),o({})}catch(y){console.error("Error submitting form:",y)}};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[r.jsx("div",{className:"p-6 border-b bg-gradient-to-r from-purple-50 to-blue-50",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-full flex items-center justify-center",children:r.jsx(_t,{className:"w-6 h-6 text-white"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Add New Employee"}),r.jsx("p",{className:"text-gray-600",children:"Create a new employee profile"})]})]}),r.jsx(H,{variant:"ghost",onClick:t,className:"text-gray-400 hover:text-gray-600",children:r.jsx(Ze,{className:"w-6 h-6"})})]})}),r.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-200px)]",children:r.jsx("form",{onSubmit:p,className:"p-6 space-y-6",children:r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),r.jsxs("div",{className:"relative",children:[r.jsx(_t,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",value:a.name,onChange:f=>m("name",f.target.value),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent ${l.name?"border-red-500":"border-gray-300"}`,placeholder:"John Doe"})]}),l.name&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.name})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),r.jsxs("div",{className:"relative",children:[r.jsx(Dt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"email",value:a.email,onChange:f=>m("email",f.target.value),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent ${l.email?"border-red-500":"border-gray-300"}`,placeholder:"john.doe@company.com"})]}),l.email&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.email})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role/Position *"}),r.jsx("input",{type:"text",value:a.role,onChange:f=>m("role",f.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent ${l.role?"border-red-500":"border-gray-300"}`,placeholder:"Senior Sales Manager"}),l.role&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.role})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department *"}),r.jsxs("div",{className:"relative",children:[r.jsx(qt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsxs("select",{value:a.department,onChange:f=>m("department",f.target.value),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent ${l.department?"border-red-500":"border-gray-300"}`,children:[r.jsx("option",{value:"",children:"Select Department"}),c.map(f=>r.jsx("option",{value:f,children:f},f))]})]}),l.department&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.department})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),r.jsxs("div",{className:"relative",children:[r.jsx(sn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"tel",value:a.phone,onChange:f=>m("phone",f.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"+1 (555) 123-4567"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hire Date *"}),r.jsxs("div",{className:"relative",children:[r.jsx(yt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"date",value:a.hire_date,onChange:f=>m("hire_date",f.target.value),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent ${l.hire_date?"border-red-500":"border-gray-300"}`})]}),l.hire_date&&r.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.hire_date})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City"}),r.jsxs("div",{className:"relative",children:[r.jsx(vn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",value:a.city,onChange:f=>m("city",f.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"New York"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Country"}),r.jsx("input",{type:"text",value:a.country,onChange:f=>m("country",f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"United States"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Availability Status"}),r.jsx("select",{value:a.availability,onChange:f=>m("availability",f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:d.map(f=>r.jsx("option",{value:f.value,children:f.label},f.value))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Years of Experience"}),r.jsx("input",{type:"number",min:"0",max:"50",value:a.experience,onChange:f=>m("experience",parseInt(f.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]})})}),r.jsxs("div",{className:"p-6 border-t bg-gray-50 flex justify-end gap-4",children:[r.jsx(H,{type:"button",variant:"outline",onClick:t,disabled:s,children:"Cancel"}),r.jsx(H,{onClick:p,disabled:s,className:"bg-purple-600 hover:bg-purple-700 text-white",children:s?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Creating..."]}):r.jsxs(r.Fragment,{children:[r.jsx(_t,{className:"w-4 h-4 mr-2"}),"Create Employee"]})})]})]})})},a6=()=>{var oe;const{filteredEmployees:e,loading:t,error:n,filters:s,updateFilters:a,refreshData:i,addEmployeeToState:l,rollbackEmployeeAdd:o,removeEmployeeFromState:c}=Gk(),[d]=h.useState([]),[u,m]=h.useState(!1),[p,f]=h.useState(!1),[y,g]=h.useState(!1),[x,b]=h.useState(null),[v,w]=h.useState(!1),[N,k]=h.useState(!1),[j,S]=h.useState(""),[_,C]=h.useState(!1),[D,A]=h.useState(""),{handleViewProfile:E}=ua(),T=[{id:"revenue",name:"Revenue",icon:Ur},{id:"experience",name:"Experience",icon:Vi},{id:"performance",name:"Performance",icon:Ot},{id:"feedback",name:"Feedback",icon:Xo}],[M,L]=h.useState("revenue"),P=(W,B)=>{a({[W]:B})},$=W=>({available:"bg-green-100 text-green-800",busy:"bg-red-100 text-red-800","partially-available":"bg-yellow-100 text-yellow-800","on-leave":"bg-gray-100 text-gray-800"})[W]||"bg-gray-100 text-gray-800",R=W=>({available:r.jsx(bt,{className:"w-4 h-4"}),busy:r.jsx(dt,{className:"w-4 h-4"}),"partially-available":r.jsx(jt,{className:"w-4 h-4"}),"on-leave":r.jsx(OC,{className:"w-4 h-4"})})[W]||r.jsx(jt,{className:"w-4 h-4"}),U=(W,B)=>{const V=Qk(W,B),re={DollarSign:r.jsx(Ur,{className:"w-4 h-4 text-green-500"}),Award:r.jsx(Vi,{className:"w-4 h-4 text-blue-500"}),TrendingUp:r.jsx(Ot,{className:"w-4 h-4 text-purple-500"}),Heart:r.jsx(Xo,{className:"w-4 h-4 text-pink-500"})};return{...V,icon:re[V.icon]||re.DollarSign}},I=W=>{var re,Me,he,G;const V={...W.employee||W};if(W.performance&&(V.performance=W.performance),W.feedback_summary&&(V.feedback_rating=W.feedback_summary.average_rating||0,V.feedback_comment=W.feedback_summary.recent_comment||"",V.feedback_count=W.feedback_summary.total_feedback||0),V.customer_count=W.customer_count||0,V.lead_count=W.lead_count||0,!V.specialties&&V.skills){const q=[];V.skills.domain&&q.push(...V.skills.domain.slice(0,3)),q.length<3&&V.skills.technical&&q.push(...V.skills.technical.slice(0,3-q.length)),V.specialties=q}else V.specialties||(V.specialties=[]);return V.current_projects||(V.current_projects=0),V.completion_rate||(V.completion_rate=85),V.recent_achievements||(V.recent_achievements=[]),((re=W.performance)==null?void 0:re.performance_score)!==void 0&&((Me=W.performance)==null?void 0:Me.performance_score)!==null?V.performance_score=W.performance.performance_score:(G=(he=V.performance)==null?void 0:he.peer_evaluations)!=null&&G.averageScore?V.performance_score=Math.round(V.performance.peer_evaluations.averageScore*20):V.performance_score=80,V.deals_won||(V.deals_won=0),V.response_time||(V.response_time="2 hours"),V},z=e.map(W=>I(W)).sort((W,B)=>{const V=tv(W,M);return tv(B,M)-V}),F=async W=>{let B=null;try{f(!0);const V=await zr.createEmployee(W);B=V.id,l(V),A(V.name||"New Employee"),m(!1),C(!0),console.log("Employee created successfully:",V)}catch(V){throw console.error("Failed to create employee:",V),B&&o(B),V}finally{f(!1)}},O=W=>{b(W),g(!0)},K=async()=>{if(x)try{w(!0),await zr.deleteEmployee(x.id),c(x.id),S(x.name),g(!1),b(null),k(!0)}catch(W){console.error("Failed to delete employee:",W),mt.error(` Failed to delete employee: ${W.message}`,{duration:6e3})}finally{w(!1)}},J=()=>{g(!1),b(null)},se=()=>{k(!1),S("")},Z=()=>{C(!1),A("")};return t?r.jsx("div",{className:"p-3",children:r.jsxs("div",{className:"animate-pulse space-y-4",children:[r.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),r.jsx("div",{className:"grid grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(W=>r.jsx("div",{className:"h-64 bg-gray-200 rounded"},W))})]})}):n?r.jsx("div",{className:"p-3",children:r.jsx(We,{className:"border-red-200 bg-red-50",children:r.jsx(it,{className:"p-6",children:r.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[r.jsx(dt,{className:"w-6 h-6"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold",children:"Connection Error"}),r.jsx("p",{className:"text-sm mt-1",children:n}),r.jsxs(H,{onClick:()=>i(),className:"mt-3 bg-red-600 hover:bg-red-700",size:"sm",children:[r.jsx(Be,{className:"w-4 h-4 mr-2"}),"Retry"]})]})]})})})}):r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("div",{className:"p-2 border-b",children:r.jsx(TC,{config:{primaryAction:{primaryLabel:"Add Employee",onPrimaryAction:()=>m(!0),actionIcons:[{icon:Da,label:"Performance Review",tooltip:"View team performance analytics",onClick:()=>console.log("Performance Review clicked"),disabled:!1},{icon:Ut,label:"Export Data",tooltip:"Export employee data to CSV",onClick:()=>console.log("Export Data clicked"),disabled:!1}],disabled:p,loading:p},search:{placeholder:"Search employees, roles, skills...",value:s.search,onChange:W=>P("search",W),onClear:()=>P("search","")},filters:[{id:"employee-filters",icon:"filter",label:"Filters",title:"Filter & Sort Employees",hasActiveFilters:M!=="revenue"||s.department!=="all"||s.availability!=="all",content:({onClose:W})=>r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"View By"}),r.jsx("div",{className:"grid grid-cols-2 gap-2",children:T.map(B=>r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-2 rounded hover:bg-gray-50",children:[r.jsx("input",{type:"radio",name:"view-by-filter",value:B.id,checked:M===B.id,onChange:()=>L(B.id),className:"text-green-600"}),r.jsx(B.icon,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:"text-sm text-gray-700",children:B.name})]},B.id))})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Filter by Department"}),r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-2 rounded hover:bg-gray-50",children:[r.jsx("input",{type:"radio",name:"department-filter",value:"all",checked:s.department==="all",onChange:()=>P("department","all"),className:"text-green-600"}),r.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"All Departments"})]}),Array.from(new Set(z.map(B=>B.department))).map(B=>r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-2 rounded hover:bg-gray-50",children:[r.jsx("input",{type:"radio",name:"department-filter",value:B,checked:s.department===B,onChange:()=>P("department",B),className:"text-green-600"}),r.jsx("span",{className:"text-sm text-gray-700",children:B})]},B))]})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Filter by Availability"}),r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-2 rounded hover:bg-gray-50",children:[r.jsx("input",{type:"radio",name:"availability-filter",value:"all",checked:s.availability==="all",onChange:()=>P("availability","all"),className:"text-green-600"}),r.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"All Availability"})]}),[{value:"available",label:"Available"},{value:"partially-available",label:"Partially Available"},{value:"busy",label:"Busy"},{value:"on-leave",label:"On Leave"}].map(B=>r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-2 rounded hover:bg-gray-50",children:[r.jsx("input",{type:"radio",name:"availability-filter",value:B.value,checked:s.availability===B.value,onChange:()=>P("availability",B.value),className:"text-green-600"}),r.jsx("span",{className:"text-sm text-gray-700",children:B.label})]},B.value))]})]}),r.jsxs("div",{className:"pt-3 border-t border-gray-200 flex justify-between items-center",children:[r.jsxs("div",{className:"text-xs text-gray-500",children:[z.length," employee",z.length!==1?"s":""," found"]}),r.jsx("button",{onClick:()=>{L("revenue"),P("department","all"),P("availability","all"),W()},className:"text-sm text-green-600 hover:text-green-800 font-medium",children:"Reset filters"})]})]})}],themeColor:"green"}})}),r.jsx("div",{className:"px-4 py-2 bg-gray-50 border-t",children:r.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[r.jsxs("span",{children:[z.length," employee",z.length!==1?"s":""," found"]}),s.search&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{children:""}),r.jsxs("span",{children:['Searching: "',s.search,'"']})]}),s.department!=="all"&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{children:""}),r.jsxs("span",{children:["Department: ",s.department]})]}),s.availability!=="all"&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{children:""}),r.jsxs("span",{children:["Status: ",s.availability.replace("-"," ")]})]})]})}),r.jsx("div",{className:"flex-1 overflow-auto p-2",children:r.jsx("div",{className:"bg-white rounded-lg shadow-sm border",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 border-b",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Availability"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:((oe=T.find(W=>W.id===M))==null?void 0:oe.name)||"Metric"}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Skills"}),r.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:z.map(W=>{const B=U(W,M);return r.jsxs("tr",{className:"hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>E(W),children:[r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:r.jsx(_t,{className:"w-4 h-4 text-green-600"})}),r.jsx("div",{className:"ml-3",children:r.jsxs("div",{className:"text-left group",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:W.name||"Unknown Employee"}),r.jsx("div",{className:"text-sm text-gray-500",children:W.role||"No Role"})]})})]})}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:r.jsx("span",{className:"text-sm text-green-600 font-medium",children:W.department||"No Department"})}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:r.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${$(W.availability)}`,children:[R(W.availability),r.jsx("span",{children:(W.availability||"available").replace("-"," ")})]})}),r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center gap-2",children:[B.icon,r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-bold text-gray-900",children:B.value}),r.jsx("div",{className:"text-xs text-gray-500",children:B.subtitle})]})]})}),r.jsx("td",{className:"px-4 py-3",children:r.jsx("div",{className:"flex flex-wrap gap-1 max-w-xs",children:(()=>{let V=[];if(W.skills&&typeof W.skills=="object"){const{technical:re=[],domain:Me=[],methodologies:he=[],certifications:G=[]}=W.skills;V=[...re,...Me,...he,...G]}return V.length>0?r.jsxs(r.Fragment,{children:[V.slice(0,3).map((re,Me)=>r.jsx("span",{className:"inline-flex bg-gray-100 text-gray-700 px-2 py-0.5 rounded text-xs",children:re},`${re}-${Me}`)),V.length>3&&r.jsxs("span",{className:"text-xs text-gray-500",children:["+",V.length-3]})]}):r.jsx("span",{className:"text-xs text-gray-400",children:"No skills listed"})})()})}),r.jsx("td",{className:"px-4 py-3 text-right",children:r.jsx("button",{onClick:V=>{V.stopPropagation(),O(W)},className:"text-red-500 hover:text-red-700 hover:bg-red-50 p-1 rounded transition-colors",title:`Delete ${W.name||"Employee"}`,children:r.jsx(fr,{className:"w-4 h-4"})})})]},W.id)})})]})})}),d.length>0&&r.jsx("div",{className:"border-t bg-gray-50 p-4",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[d.length," employee",d.length>1?"s":""," selected"]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(H,{size:"sm",variant:"outline",children:[r.jsx(yt,{className:"w-4 h-4 mr-2"}),"Schedule Meeting"]}),r.jsxs(H,{size:"sm",className:"bg-green-600 hover:bg-green-700",children:[r.jsx(RC,{className:"w-4 h-4 mr-2"}),"Plan Travel"]})]})]})}),r.jsx(s6,{isOpen:u,onClose:()=>m(!1),onSubmit:F,loading:p}),r.jsx($k,{isOpen:y,onClose:J,onConfirm:K,title:"Delete Employee",message:`Are you sure you want to delete ${(x==null?void 0:x.name)||"this employee"}?`,details:x?`Department: ${x.department} | Role: ${x.role}`:"",confirmText:"Delete Employee",cancelText:"Cancel",type:"danger",isLoading:v}),N&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full overflow-hidden",children:[r.jsx("div",{className:"px-6 py-4 border-b bg-green-50 border-green-200",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"text-green-600",children:r.jsx(bt,{className:"w-6 h-6"})}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Employee Deleted Successfully"})]})}),r.jsxs("div",{className:"px-6 py-4",children:[r.jsxs("p",{className:"text-gray-700 mb-4 leading-relaxed",children:[r.jsx("span",{className:"font-medium",children:j})," has been successfully removed from the system."]}),r.jsx("div",{className:"bg-gray-50 rounded-md p-3 border",children:r.jsx("p",{className:"text-sm text-gray-600",children:"The employee and all associated data have been permanently deleted from both employee and performance records."})})]}),r.jsx("div",{className:"px-6 py-4 bg-gray-50 border-t flex justify-end",children:r.jsx(H,{className:"bg-green-600 hover:bg-green-700 text-white",onClick:se,children:"Close"})})]})}),_&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full overflow-hidden",children:[r.jsx("div",{className:"px-6 py-4 border-b bg-green-50 border-green-200",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"text-green-600",children:r.jsx(bt,{className:"w-6 h-6"})}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Employee Created Successfully"})]})}),r.jsxs("div",{className:"px-6 py-4",children:[r.jsxs("p",{className:"text-gray-700 mb-4 leading-relaxed",children:[r.jsx("span",{className:"font-medium",children:D})," has been successfully added to the system."]}),r.jsx("div",{className:"bg-gray-50 rounded-md p-3 border",children:r.jsx("p",{className:"text-sm text-gray-600",children:"The new employee has been created with default performance metrics and is now visible in the employee list."})})]}),r.jsx("div",{className:"px-6 py-4 bg-gray-50 border-t flex justify-end",children:r.jsx(H,{className:"bg-green-600 hover:bg-green-700 text-white",onClick:Z,children:"Close"})})]})})]})},xh="http://localhost:7002";class i6{async getIndustryTier(t){if(!t||typeof t!="string"||t.trim()==="")return"Standard";const n=["Technology","Finance","Healthcare","Energy"],s=["Manufacturing","Automotive","Construction"];return n.includes(t)?"High-Value":s.includes(t)?"Medium-Value":"Standard"}async getIndustryRecommendations(t){return!t||typeof t!="string"||t.trim()===""?["Focus on industry-specific needs","Emphasize relevant experience"]:["Focus on industry-specific needs","Emphasize relevant experience"]}async getIndustryKeywords(t){if(!t||typeof t!="string"||t.trim()==="")return[];try{const n=await fetch(`${xh}/industry-keywords/${encodeURIComponent(t)}`);if(!n.ok)throw new Error(`HTTP ${n.status}`);return(await n.json()).keywords}catch(n){return console.warn("Failed to get industry keywords:",n),[t.toLowerCase()]}}async formatCurrency(t){try{const n=await fetch(`${xh}/format-currency/${t}`);if(!n.ok)throw new Error(`HTTP ${n.status}`);return(await n.json()).formatted}catch(n){return console.warn("Failed to format currency:",n),new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(t||0)}}async getRequiredExperienceForValue(t){try{const n=await fetch(`${xh}/required-experience/${t}`);if(!n.ok)throw new Error(`HTTP ${n.status}`);return(await n.json()).required_experience}catch(n){return console.warn("Failed to get required experience:",n),t>=1e6?8:t>=5e5?5:t>=1e5?3:t>=5e4?2:1}}}const rv=new i6,nv=async()=>{try{console.log(" Starting semantic customer matching process..."),console.log("Testing customer API connection...");const e=await Gd.getAllCustomers({excludeAssigned:!0});console.log(`Successfully fetched ${e.length} customers`),console.log("Testing employee API connection...");const t=await zr.getAllEmployees();console.log(`Successfully fetched ${t.length} employees`);let n=await mn.checkServiceHealth();if(!n){console.log(" Semantic matching service not ready, checking if already preloading...");try{await fetch("http://localhost:7002/semantic-similarity",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text1:"test",text2:"test"})})}catch(a){console.log("Failed to trigger model loading:",a)}console.log(" Waiting 2 seconds for model (should be preloaded)..."),await new Promise(a=>setTimeout(a,2e3)),n=await mn.checkServiceHealth(),n||(console.log(" Final retry in 2 seconds..."),await new Promise(a=>setTimeout(a,2e3)),n=await mn.checkServiceHealth())}console.log(` Semantic matching service: ${n?"Available":"Unavailable - using fallback"}`),console.log("Processing customer matches...");const s=await Promise.all(e.map(async a=>{let i;if(n)try{i=(await mn.matchCustomerToEmployees(a,t)).matches.map(u=>({employee:u.employee,score:u.total_score*100,reasons:[`Semantic match: ${(u.semantic_score*100).toFixed(1)}% similarity`,`Industry alignment: ${(u.industry_similarity*100).toFixed(1)}%`,`Skills match: ${(u.skills_similarity*100).toFixed(1)}%`,...u.rule_based_reasons||[]],confidence:Math.min(95,Math.round(u.total_score*100)),customerValue:a.total_sales||0,riskLevel:"unknown",semanticScore:u.semantic_score,industryAlignment:u.industry_similarity,skillsMatch:u.skills_similarity}))}catch(d){return console.warn(` Semantic matching failed for ${a.customer_name||a.company}, skipping customer:`,d),null}else return console.warn(` Semantic matching service unavailable, skipping customer: ${a.customer_name||a.company}`),null;const l=i.sort((d,u)=>u.score-d.score).slice(0,5),o=await rv.getIndustryTier(a.industry),c=await rv.getIndustryRecommendations(a.industry);return{customer:a,matches:l,customerInsights:{totalValue:a.total_sales||0,profitMargin:a.total_profit&&a.total_sales&&a.total_sales>0?a.total_profit/a.total_sales:0,transactionCount:a.total_transactions||0,avgSalesAmount:a.avg_sales_amount||0,lastPurchaseDate:a.last_purchase_date||null,firstPurchaseDate:a.first_purchase_date||null,currentMtdSales:a.current_mtd_sales||0,industry:a.industry||"Unknown",industryTier:o,industryRecommendations:c}}})).then(a=>a.filter(i=>i!==null));return console.log(`Successfully generated ${s.length} customer matches with semantic matching`),s}catch(e){throw console.error("Detailed error in customer matching:",e),console.error("Error stack:",e.stack),console.error("Error message:",e.message),new Error(`Failed to generate customer matches: ${e.message}`)}},l6=()=>{const[e,t]=h.useState([]),[n,s]=h.useState(!1),[a,i]=h.useState(1),[l]=h.useState(10),[o,c]=h.useState([]),d=h.useRef(!1),u=async()=>{if(!d.current)try{if(mn.getLocalCacheSize()>0)return;d.current=!0,await mn.preloadModel();const[f,y]=await Promise.all([Gd.getAllCustomers({excludeAssigned:!0}).catch(()=>[]),zr.getAllEmployees().catch(()=>[])]);if(!Array.isArray(f)||!Array.isArray(y)||y.length===0)return;const g=f;for(const x of g)try{await mn.matchCustomerToEmployees(x,y)}catch{}}catch{}};h.useEffect(()=>{u()},[]);const m=async()=>{try{s(!0),console.log(" Starting customer matching process...");const f=await nv();t(f),console.log(` Successfully generated ${f.length} customer matches`)}catch(f){console.error("Failed to generate customer matches:",f),mt.error(` Failed to generate customer matches: ${f.message}`,{duration:6e3})}finally{s(!1)}},p=async()=>{try{s(!0);try{await mn.clearCache()}catch(y){console.warn("Backend cache clear failed, falling back to local clear",y),mn.clearLocalCache()}const f=await nv();t(f)}catch(f){console.error("Failed to refresh customer matches:",f),mt.error(` Failed to refresh customer matches: ${f.message}`)}finally{s(!1)}};return r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("div",{className:"p-6 border-b bg-gradient-to-r from-green-50 to-blue-50",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-full flex items-center justify-center",children:r.jsx(Ro,{className:"w-6 h-6 text-white"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Customer Matching"}),r.jsx("p",{className:"text-gray-600",children:"AI-powered customer-employee matching based on expertise, availability, and performance"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(H,{onClick:m,disabled:n,className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2",children:[r.jsx(Ro,{className:`w-4 h-4 ${n?"animate-pulse":""}`}),n?"Generating...":"Generate Matches"]}),r.jsxs(H,{variant:"outline",onClick:p,disabled:n,className:"flex items-center gap-2 px-3 py-1 text-sm bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors",children:[r.jsx(Be,{className:`w-4 h-4 ${n?"animate-spin":""}`}),"Refresh"]})]})]})}),r.jsx("div",{className:"flex-1 p-6 overflow-y-auto",children:n?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full animate-pulse"}),r.jsxs("div",{children:[r.jsx("div",{className:"h-5 w-48 bg-gray-200 rounded animate-pulse mb-2"}),r.jsx("div",{className:"h-4 w-72 bg-gray-100 rounded animate-pulse"})]})]}),r.jsx("div",{className:"space-y-6",children:[...Array(10)].map((f,y)=>r.jsxs("div",{className:"border-l-4 border-l-green-200 rounded-lg bg-white p-6",children:[r.jsx("div",{className:"flex items-start justify-between mb-4",children:r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full animate-pulse"}),r.jsxs("div",{children:[r.jsx("div",{className:"h-4 w-56 bg-gray-200 rounded animate-pulse mb-2"}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"h-3 w-48 bg-gray-100 rounded animate-pulse"}),r.jsx("div",{className:"h-5 w-28 bg-blue-100 rounded-full animate-pulse"})]})]})]})}),r.jsx("div",{className:"h-4 w-44 bg-gray-200 rounded animate-pulse mb-3"}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[...Array(5)].map((g,x)=>r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full animate-pulse"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"h-4 w-32 bg-gray-200 rounded animate-pulse mb-1"}),r.jsx("div",{className:"h-3 w-24 bg-gray-100 rounded animate-pulse"})]})]}),r.jsx("div",{className:"h-2 w-full bg-gray-200 rounded mb-2 animate-pulse"}),r.jsx("div",{className:"h-2 w-3/4 bg-gray-200 rounded animate-pulse"})]},x))})]},y))}),r.jsxs("div",{className:"flex items-center justify-center gap-4 mt-6",children:[r.jsx("div",{className:"h-8 w-20 bg-gray-200 rounded animate-pulse"}),r.jsx("div",{className:"flex items-center gap-2",children:[...Array(5)].map((f,y)=>r.jsx("div",{className:"h-8 w-8 bg-gray-200 rounded animate-pulse"},y))}),r.jsx("div",{className:"h-8 w-20 bg-gray-200 rounded animate-pulse"})]})]}):r.jsxs(r.Fragment,{children:[o.length>0&&r.jsxs("div",{className:"mb-8",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx(Mr,{className:"w-5 h-5 text-green-600"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"New Customer Matches"}),r.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium",children:"Latest"})]}),r.jsx("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-4 mb-4",children:r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:o.map((f,y)=>r.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:r.jsx("span",{className:"text-green-600 font-bold text-sm",children:(f.employee.name||"Unknown").split(" ").map(g=>g[0]).join("")})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"font-medium text-sm text-gray-900 truncate",children:f.employee.name||"Unknown Employee"}),r.jsx("div",{className:"text-xs text-gray-500 truncate",children:f.employee.department||"No Department"})]})]}),r.jsxs("div",{className:"mb-2",children:[r.jsxs("div",{className:"flex items-center justify-between text-xs",children:[r.jsx("span",{className:"text-gray-500",children:"Match Score"}),r.jsxs("span",{className:"font-bold text-green-600",children:[Math.round(f.score),"%"]})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-1",children:r.jsx("div",{className:"bg-gradient-to-r from-green-500 to-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(Math.round(f.score),100)}%`}})})]}),r.jsx("div",{className:"space-y-1",children:f.reasons.slice(0,2).map((g,x)=>r.jsx("div",{className:"text-xs text-gray-600 bg-gray-50 px-2 py-1 rounded",children:g},x))})]},y))})})]}),r.jsx("div",{className:"space-y-6",children:(()=>{Math.ceil(e.length/l);const f=(a-1)*l,y=f+l;return e.slice(f,y).map((x,b)=>r.jsx(We,{className:"border-l-4 border-l-green-500",children:r.jsxs("div",{className:"p-6",children:[r.jsx("div",{className:"flex items-start justify-between mb-4",children:r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:r.jsx(qt,{className:"w-6 h-6 text-blue-600"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:x.customer.customer_name}),r.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[r.jsx("span",{children:x.customer.email?`Contact: ${x.customer.email}`:"No contact info"}),r.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-700",children:x.customer.country||"Unknown Location"})]})]})]})}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Top Employee Matches"}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:x.matches.map((v,w)=>r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:r.jsx("span",{className:"text-green-600 font-bold text-sm",children:(v.employee.name||"Unknown").split(" ").map(N=>N[0]).join("")})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"font-medium text-sm text-gray-900 truncate",children:v.employee.name||"Unknown Employee"}),r.jsx("div",{className:"text-xs text-gray-500 truncate",children:v.employee.department||"No Department"})]})]}),r.jsxs("div",{className:"mb-2",children:[r.jsxs("div",{className:"flex items-center justify-between text-xs",children:[r.jsx("span",{className:"text-gray-500",children:"Match Score"}),r.jsxs("span",{className:"font-bold text-green-600",children:[Math.round(v.score),"%"]})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-1",children:r.jsx("div",{className:"bg-gradient-to-r from-green-500 to-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(Math.round(v.score),100)}%`}})})]}),r.jsx("div",{className:"space-y-1",children:v.reasons.slice(0,2).map((N,k)=>r.jsx("div",{className:"text-xs text-gray-600 bg-white px-2 py-1 rounded",children:N},k))})]},w))})]})]})},b))})()}),e.length===0&&!n&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(Ro,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Customer Matches"}),r.jsx("p",{className:"text-gray-500 mb-4",children:'Click "Generate Matches" to start AI-powered customer-employee matching'}),r.jsxs(H,{onClick:m,className:"bg-green-600 hover:bg-green-700 text-white",children:[r.jsx(Ro,{className:"w-4 h-4 mr-2"}),"Generate Matches"]})]}),e.length>0&&r.jsxs("div",{className:"flex items-center justify-center gap-4 mt-6",children:[r.jsxs(H,{variant:"outline",onClick:()=>i(f=>Math.max(1,f-1)),disabled:a===1,className:"flex items-center gap-2",children:[r.jsx(La,{className:"w-4 h-4 rotate-[-90deg]"}),"Previous"]}),r.jsx("div",{className:"flex items-center gap-2",children:(()=>{const f=Math.ceil(e.length/l),y=[];for(let g=1;g<=f;g++)g===1||g===f||g>=a-1&&g<=a+1?y.push(g):(g===a-2||g===a+2)&&y.push("...");return y.map((g,x)=>g==="..."?r.jsx("span",{className:"px-2 py-1 text-gray-500",children:"..."},x):r.jsx(H,{variant:a===g?"default":"outline",onClick:()=>i(g),className:`px-3 py-1 text-sm ${a===g?"bg-green-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:g},x))})()}),r.jsxs(H,{variant:"outline",onClick:()=>i(f=>Math.min(Math.ceil(e.length/l),f+1)),disabled:a===Math.ceil(e.length/l),className:"flex items-center gap-2",children:["Next",r.jsx(Xt,{className:"w-4 h-4 rotate-[-90deg]"})]})]})]})})]})},o6=({wsConnection:e})=>{const{refreshData:t}=Gk(),[n,s]=h.useState("employee-management"),a=[{id:"employee-management",label:"Employee Management",icon:kt,description:"Manage employees, track performance, and view team analytics"},{id:"customer-matching",label:"Customer Matching",icon:Ro,description:"AI-powered customer-employee matching and assignments"}];return r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx(ri,{title:"Team Management",description:"Manage employees, track performance, and optimize team assignments",icon:zC,themeColor:"green",tabs:a.map(i=>({id:i.id,label:i.label,icon:i.icon,isActive:n===i.id,onClick:()=>s(i.id)}))}),r.jsxs(O3,{onEmployeeRefresh:t,children:[r.jsxs("div",{className:"flex-1 overflow-hidden",children:[n==="employee-management"&&r.jsx(de.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:"h-full",children:r.jsx(a6,{})},"employee-management"),n==="customer-matching"&&r.jsx(de.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:"h-full",children:r.jsx(l6,{})},"customer-matching")]}),r.jsx(e6,{}),r.jsx(t6,{}),r.jsx(r6,{}),r.jsx(n6,{})]})]})},c6=({wsConnection:e})=>r.jsx(I3,{children:r.jsx(o6,{wsConnection:e})}),d6=({leftSection:e,rightSection:t,className:n="",...s})=>r.jsx(de.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.3,ease:"easeOut"},className:`px-6 py-3 bg-white ${n}`,role:"toolbar","aria-label":"Sales Center actions and filters",...s,children:r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"flex items-center gap-3 flex-shrink-0",children:e}),r.jsx("div",{className:"flex items-center gap-2",children:t})]})}),u6=({label:e="New Item",onClick:t,themeColor:n="purple",disabled:s=!1,loading:a=!1,...i})=>{const l=()=>{s||a||t==null||t()};return r.jsxs(H,{onClick:l,disabled:s||a,className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":e,...i,children:[r.jsx(Wt,{className:"w-4 h-4 mr-2"}),a?"Loading...":e]})},m6=({filters:e=[],className:t="",...n})=>{const[s,a]=h.useState(null),i=o=>{a(s===o?null:o)},l=()=>{a(null)};return r.jsx("div",{className:`flex items-center gap-2 ${t}`,...n,children:e.map(o=>{const c=s===o.id||o.isActive,d=o.badge!==null&&o.badge!==void 0&&o.badge>0;return r.jsxs("div",{className:"relative",children:[r.jsxs("button",{onClick:()=>i(o.id),disabled:o.disabled,className:`
                flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border relative
                ${c||o.hasActiveFilters?"bg-purple-50 text-purple-900 border-purple-300":"text-gray-700 hover:bg-gray-100 border-gray-300"}
                disabled:opacity-50 disabled:cursor-not-allowed
              `,"aria-label":o.label,"aria-expanded":s===o.id,"aria-haspopup":"dialog",children:[r.jsx(da,{className:"w-4 h-4","aria-hidden":"true"}),r.jsx("span",{children:o.label}),d&&r.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-purple-600 rounded-full",children:o.badge}),r.jsx(Xt,{className:`w-4 h-4 transition-transform ${c?"rotate-180":""}`,"aria-hidden":"true"})]}),r.jsx(ht,{children:s===o.id&&o.content&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-20",onClick:l,"aria-hidden":"true"}),r.jsx(de.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.15,ease:"easeOut"},className:"absolute top-full left-0 mt-2 z-30",role:"dialog","aria-labelledby":`${o.id}-title`,children:r.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200",children:[o.title&&r.jsx("div",{className:"px-4 py-3 border-b border-gray-100",children:r.jsx("h3",{id:`${o.id}-title`,className:"text-sm font-medium text-gray-900",children:o.title})}),r.jsx("div",{className:"p-4",children:typeof o.content=="function"?o.content({onClose:l}):o.content}),o.actions&&r.jsx("div",{className:"px-4 py-3 border-t border-gray-100 flex justify-end gap-2",children:o.actions.map((u,m)=>r.jsx(H,{variant:u.variant||"outline",size:"sm",onClick:()=>{var p;(p=u.onClick)==null||p.call(u),u.closeOnClick!==!1&&l()},disabled:u.disabled,children:u.label},m))})]})})]})})]},o.id)})})},Zk=6048e5,h6=864e5,em=6e4,tm=36e5,p6=1e3,sv=Symbol.for("constructDateFrom");function lr(e,t){return typeof e=="function"?e(t):e&&typeof e=="object"&&sv in e?e[sv](t):e instanceof Date?new e.constructor(t):new Date(t)}function ct(e,t){return lr(t||e,e)}function Rs(e,t,n){const s=ct(e,n==null?void 0:n.in);return isNaN(t)?lr((n==null?void 0:n.in)||e,NaN):(t&&s.setDate(s.getDate()+t),s)}function $s(e,t,n){const s=ct(e,n==null?void 0:n.in);if(isNaN(t))return lr(e,NaN);if(!t)return s;const a=s.getDate(),i=lr(e,s.getTime());i.setMonth(s.getMonth()+t+1,0);const l=i.getDate();return a>=l?i:(s.setFullYear(i.getFullYear(),i.getMonth(),a),s)}function eS(e,t,n){return lr(e,+ct(e)+t)}function f6(e,t,n){return eS(e,t*tm)}let g6={};function al(){return g6}function Aa(e,t){var o,c,d,u;const n=al(),s=(t==null?void 0:t.weekStartsOn)??((c=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:c.weekStartsOn)??n.weekStartsOn??((u=(d=n.locale)==null?void 0:d.options)==null?void 0:u.weekStartsOn)??0,a=ct(e,t==null?void 0:t.in),i=a.getDay(),l=(i<s?7:0)+i-s;return a.setDate(a.getDate()-l),a.setHours(0,0,0,0),a}function Ll(e,t){return Aa(e,{...t,weekStartsOn:1})}function tS(e,t){const n=ct(e,t==null?void 0:t.in),s=n.getFullYear(),a=lr(n,0);a.setFullYear(s+1,0,4),a.setHours(0,0,0,0);const i=Ll(a),l=lr(n,0);l.setFullYear(s,0,4),l.setHours(0,0,0,0);const o=Ll(l);return n.getTime()>=i.getTime()?s+1:n.getTime()>=o.getTime()?s:s-1}function Kd(e){const t=ct(e),n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return n.setUTCFullYear(t.getFullYear()),+e-+n}function Ra(e,...t){const n=lr.bind(null,t.find(s=>typeof s=="object"));return t.map(n)}function Qs(e,t){const n=ct(e,t==null?void 0:t.in);return n.setHours(0,0,0,0),n}function Rl(e,t,n){const[s,a]=Ra(n==null?void 0:n.in,e,t),i=Qs(s),l=Qs(a),o=+i-Kd(i),c=+l-Kd(l);return Math.round((o-c)/h6)}function x6(e,t){const n=tS(e,t),s=lr(e,0);return s.setFullYear(n,0,4),s.setHours(0,0,0,0),Ll(s)}function zf(e,t,n){const s=ct(e,n==null?void 0:n.in);return s.setTime(s.getTime()+t*em),s}function Nx(e,t,n){return $s(e,t*3,n)}function y6(e,t,n){return eS(e,t*1e3)}function Xd(e,t,n){return Rs(e,t*7,n)}function va(e,t,n){return $s(e,t*12,n)}function av(e,t){let n,s=t==null?void 0:t.in;return e.forEach(a=>{!s&&typeof a=="object"&&(s=lr.bind(null,a));const i=ct(a,s);(!n||n<i||isNaN(+i))&&(n=i)}),lr(s,n||NaN)}function iv(e,t){let n,s=t==null?void 0:t.in;return e.forEach(a=>{!s&&typeof a=="object"&&(s=lr.bind(null,a));const i=ct(a,s);(!n||n>i||isNaN(+i))&&(n=i)}),lr(s,n||NaN)}function b6(e,t,n){const[s,a]=Ra(n==null?void 0:n.in,e,t);return+Qs(s)==+Qs(a)}function wa(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function Jd(e){return!(!wa(e)&&typeof e!="number"||isNaN(+ct(e)))}function Qd(e,t,n){const[s,a]=Ra(n==null?void 0:n.in,e,t),i=s.getFullYear()-a.getFullYear(),l=s.getMonth()-a.getMonth();return i*12+l}function Fi(e,t){const n=ct(e,t==null?void 0:t.in);return Math.trunc(n.getMonth()/3)+1}function Zd(e,t,n){const[s,a]=Ra(n==null?void 0:n.in,e,t),i=s.getFullYear()-a.getFullYear(),l=Fi(s)-Fi(a);return i*4+l}function eu(e,t,n){const[s,a]=Ra(n==null?void 0:n.in,e,t);return s.getFullYear()-a.getFullYear()}function v6(e,t,n){const[s,a]=Ra(n==null?void 0:n.in,e,t),i=lv(s,a),l=Math.abs(Rl(s,a));s.setDate(s.getDate()-i*l);const o=+(lv(s,a)===-i),c=i*(l-o);return c===0?0:c}function lv(e,t){const n=e.getFullYear()-t.getFullYear()||e.getMonth()-t.getMonth()||e.getDate()-t.getDate()||e.getHours()-t.getHours()||e.getMinutes()-t.getMinutes()||e.getSeconds()-t.getSeconds()||e.getMilliseconds()-t.getMilliseconds();return n<0?-1:n>0?1:n}function Cx(e,t){const n=ct(e,t==null?void 0:t.in);return n.setHours(23,59,59,999),n}function rS(e,t){const n=ct(e,t==null?void 0:t.in),s=n.getMonth();return n.setFullYear(n.getFullYear(),s+1,0),n.setHours(23,59,59,999),n}function Bf(e,t){const n=ct(e,t==null?void 0:t.in),s=n.getMonth(),a=s-s%3;return n.setMonth(a,1),n.setHours(0,0,0,0),n}function nS(e,t){const n=ct(e,t==null?void 0:t.in);return n.setDate(1),n.setHours(0,0,0,0),n}function sS(e,t){const n=ct(e,t==null?void 0:t.in),s=n.getFullYear();return n.setFullYear(s+1,0,0),n.setHours(23,59,59,999),n}function rm(e,t){const n=ct(e,t==null?void 0:t.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}function w6(e,t){var o,c;const n=al(),s=n.weekStartsOn??((c=(o=n.locale)==null?void 0:o.options)==null?void 0:c.weekStartsOn)??0,a=ct(e,t==null?void 0:t.in),i=a.getDay(),l=(i<s?-7:0)+6-(i-s);return a.setDate(a.getDate()+l),a.setHours(23,59,59,999),a}const j6={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},N6=(e,t,n)=>{let s;const a=j6[e];return typeof a=="string"?s=a:t===1?s=a.one:s=a.other.replace("{{count}}",t.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+s:s+" ago":s};function yh(e){return(t={})=>{const n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}const C6={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},k6={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},S6={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},_6={date:yh({formats:C6,defaultWidth:"full"}),time:yh({formats:k6,defaultWidth:"full"}),dateTime:yh({formats:S6,defaultWidth:"full"})},E6={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},D6=(e,t,n,s)=>E6[e];function wo(e){return(t,n)=>{const s=n!=null&&n.context?String(n.context):"standalone";let a;if(s==="formatting"&&e.formattingValues){const l=e.defaultFormattingWidth||e.defaultWidth,o=n!=null&&n.width?String(n.width):l;a=e.formattingValues[o]||e.formattingValues[l]}else{const l=e.defaultWidth,o=n!=null&&n.width?String(n.width):e.defaultWidth;a=e.values[o]||e.values[l]}const i=e.argumentCallback?e.argumentCallback(t):t;return a[i]}}const T6={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},A6={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},P6={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},O6={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},M6={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},I6={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},L6=(e,t)=>{const n=Number(e),s=n%100;if(s>20||s<10)switch(s%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},R6={ordinalNumber:L6,era:wo({values:T6,defaultWidth:"wide"}),quarter:wo({values:A6,defaultWidth:"wide",argumentCallback:e=>e-1}),month:wo({values:P6,defaultWidth:"wide"}),day:wo({values:O6,defaultWidth:"wide"}),dayPeriod:wo({values:M6,defaultWidth:"wide",formattingValues:I6,defaultFormattingWidth:"wide"})};function jo(e){return(t,n={})=>{const s=n.width,a=s&&e.matchPatterns[s]||e.matchPatterns[e.defaultMatchWidth],i=t.match(a);if(!i)return null;const l=i[0],o=s&&e.parsePatterns[s]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(o)?F6(o,m=>m.test(l)):$6(o,m=>m.test(l));let d;d=e.valueCallback?e.valueCallback(c):c,d=n.valueCallback?n.valueCallback(d):d;const u=t.slice(l.length);return{value:d,rest:u}}}function $6(e,t){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t(e[n]))return n}function F6(e,t){for(let n=0;n<e.length;n++)if(t(e[n]))return n}function z6(e){return(t,n={})=>{const s=t.match(e.matchPattern);if(!s)return null;const a=s[0],i=t.match(e.parsePattern);if(!i)return null;let l=e.valueCallback?e.valueCallback(i[0]):i[0];l=n.valueCallback?n.valueCallback(l):l;const o=t.slice(a.length);return{value:l,rest:o}}}const B6=/^(\d+)(th|st|nd|rd)?/i,U6=/\d+/i,q6={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},H6={any:[/^b/i,/^(a|c)/i]},W6={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Y6={any:[/1/i,/2/i,/3/i,/4/i]},V6={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},G6={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},K6={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},X6={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},J6={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Q6={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Z6={ordinalNumber:z6({matchPattern:B6,parsePattern:U6,valueCallback:e=>parseInt(e,10)}),era:jo({matchPatterns:q6,defaultMatchWidth:"wide",parsePatterns:H6,defaultParseWidth:"any"}),quarter:jo({matchPatterns:W6,defaultMatchWidth:"wide",parsePatterns:Y6,defaultParseWidth:"any",valueCallback:e=>e+1}),month:jo({matchPatterns:V6,defaultMatchWidth:"wide",parsePatterns:G6,defaultParseWidth:"any"}),day:jo({matchPatterns:K6,defaultMatchWidth:"wide",parsePatterns:X6,defaultParseWidth:"any"}),dayPeriod:jo({matchPatterns:J6,defaultMatchWidth:"any",parsePatterns:Q6,defaultParseWidth:"any"})},aS={code:"en-US",formatDistance:N6,formatLong:_6,formatRelative:D6,localize:R6,match:Z6,options:{weekStartsOn:0,firstWeekContainsDate:1}};function eL(e,t){const n=ct(e,t==null?void 0:t.in);return Rl(n,rm(n))+1}function kx(e,t){const n=ct(e,t==null?void 0:t.in),s=+Ll(n)-+x6(n);return Math.round(s/Zk)+1}function Sx(e,t){var u,m,p,f;const n=ct(e,t==null?void 0:t.in),s=n.getFullYear(),a=al(),i=(t==null?void 0:t.firstWeekContainsDate)??((m=(u=t==null?void 0:t.locale)==null?void 0:u.options)==null?void 0:m.firstWeekContainsDate)??a.firstWeekContainsDate??((f=(p=a.locale)==null?void 0:p.options)==null?void 0:f.firstWeekContainsDate)??1,l=lr((t==null?void 0:t.in)||e,0);l.setFullYear(s+1,0,i),l.setHours(0,0,0,0);const o=Aa(l,t),c=lr((t==null?void 0:t.in)||e,0);c.setFullYear(s,0,i),c.setHours(0,0,0,0);const d=Aa(c,t);return+n>=+o?s+1:+n>=+d?s:s-1}function tL(e,t){var o,c,d,u;const n=al(),s=(t==null?void 0:t.firstWeekContainsDate)??((c=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:c.firstWeekContainsDate)??n.firstWeekContainsDate??((u=(d=n.locale)==null?void 0:d.options)==null?void 0:u.firstWeekContainsDate)??1,a=Sx(e,t),i=lr((t==null?void 0:t.in)||e,0);return i.setFullYear(a,0,s),i.setHours(0,0,0,0),Aa(i,t)}function iS(e,t){const n=ct(e,t==null?void 0:t.in),s=+Aa(n,t)-+tL(n,t);return Math.round(s/Zk)+1}function nr(e,t){const n=e<0?"-":"",s=Math.abs(e).toString().padStart(t,"0");return n+s}const Wa={y(e,t){const n=e.getFullYear(),s=n>0?n:1-n;return nr(t==="yy"?s%100:s,t.length)},M(e,t){const n=e.getMonth();return t==="M"?String(n+1):nr(n+1,2)},d(e,t){return nr(e.getDate(),t.length)},a(e,t){const n=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(e,t){return nr(e.getHours()%12||12,t.length)},H(e,t){return nr(e.getHours(),t.length)},m(e,t){return nr(e.getMinutes(),t.length)},s(e,t){return nr(e.getSeconds(),t.length)},S(e,t){const n=t.length,s=e.getMilliseconds(),a=Math.trunc(s*Math.pow(10,n-3));return nr(a,t.length)}},pl={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},ov={G:function(e,t,n){const s=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(s,{width:"abbreviated"});case"GGGGG":return n.era(s,{width:"narrow"});case"GGGG":default:return n.era(s,{width:"wide"})}},y:function(e,t,n){if(t==="yo"){const s=e.getFullYear(),a=s>0?s:1-s;return n.ordinalNumber(a,{unit:"year"})}return Wa.y(e,t)},Y:function(e,t,n,s){const a=Sx(e,s),i=a>0?a:1-a;if(t==="YY"){const l=i%100;return nr(l,2)}return t==="Yo"?n.ordinalNumber(i,{unit:"year"}):nr(i,t.length)},R:function(e,t){const n=tS(e);return nr(n,t.length)},u:function(e,t){const n=e.getFullYear();return nr(n,t.length)},Q:function(e,t,n){const s=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(s);case"QQ":return nr(s,2);case"Qo":return n.ordinalNumber(s,{unit:"quarter"});case"QQQ":return n.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(s,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(s,{width:"wide",context:"formatting"})}},q:function(e,t,n){const s=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(s);case"qq":return nr(s,2);case"qo":return n.ordinalNumber(s,{unit:"quarter"});case"qqq":return n.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(s,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(s,{width:"wide",context:"standalone"})}},M:function(e,t,n){const s=e.getMonth();switch(t){case"M":case"MM":return Wa.M(e,t);case"Mo":return n.ordinalNumber(s+1,{unit:"month"});case"MMM":return n.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(s,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(s,{width:"wide",context:"formatting"})}},L:function(e,t,n){const s=e.getMonth();switch(t){case"L":return String(s+1);case"LL":return nr(s+1,2);case"Lo":return n.ordinalNumber(s+1,{unit:"month"});case"LLL":return n.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(s,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(s,{width:"wide",context:"standalone"})}},w:function(e,t,n,s){const a=iS(e,s);return t==="wo"?n.ordinalNumber(a,{unit:"week"}):nr(a,t.length)},I:function(e,t,n){const s=kx(e);return t==="Io"?n.ordinalNumber(s,{unit:"week"}):nr(s,t.length)},d:function(e,t,n){return t==="do"?n.ordinalNumber(e.getDate(),{unit:"date"}):Wa.d(e,t)},D:function(e,t,n){const s=eL(e);return t==="Do"?n.ordinalNumber(s,{unit:"dayOfYear"}):nr(s,t.length)},E:function(e,t,n){const s=e.getDay();switch(t){case"E":case"EE":case"EEE":return n.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(s,{width:"short",context:"formatting"});case"EEEE":default:return n.day(s,{width:"wide",context:"formatting"})}},e:function(e,t,n,s){const a=e.getDay(),i=(a-s.weekStartsOn+8)%7||7;switch(t){case"e":return String(i);case"ee":return nr(i,2);case"eo":return n.ordinalNumber(i,{unit:"day"});case"eee":return n.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(a,{width:"short",context:"formatting"});case"eeee":default:return n.day(a,{width:"wide",context:"formatting"})}},c:function(e,t,n,s){const a=e.getDay(),i=(a-s.weekStartsOn+8)%7||7;switch(t){case"c":return String(i);case"cc":return nr(i,t.length);case"co":return n.ordinalNumber(i,{unit:"day"});case"ccc":return n.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(a,{width:"narrow",context:"standalone"});case"cccccc":return n.day(a,{width:"short",context:"standalone"});case"cccc":default:return n.day(a,{width:"wide",context:"standalone"})}},i:function(e,t,n){const s=e.getDay(),a=s===0?7:s;switch(t){case"i":return String(a);case"ii":return nr(a,t.length);case"io":return n.ordinalNumber(a,{unit:"day"});case"iii":return n.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(s,{width:"short",context:"formatting"});case"iiii":default:return n.day(s,{width:"wide",context:"formatting"})}},a:function(e,t,n){const a=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(e,t,n){const s=e.getHours();let a;switch(s===12?a=pl.noon:s===0?a=pl.midnight:a=s/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(e,t,n){const s=e.getHours();let a;switch(s>=17?a=pl.evening:s>=12?a=pl.afternoon:s>=4?a=pl.morning:a=pl.night,t){case"B":case"BB":case"BBB":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(e,t,n){if(t==="ho"){let s=e.getHours()%12;return s===0&&(s=12),n.ordinalNumber(s,{unit:"hour"})}return Wa.h(e,t)},H:function(e,t,n){return t==="Ho"?n.ordinalNumber(e.getHours(),{unit:"hour"}):Wa.H(e,t)},K:function(e,t,n){const s=e.getHours()%12;return t==="Ko"?n.ordinalNumber(s,{unit:"hour"}):nr(s,t.length)},k:function(e,t,n){let s=e.getHours();return s===0&&(s=24),t==="ko"?n.ordinalNumber(s,{unit:"hour"}):nr(s,t.length)},m:function(e,t,n){return t==="mo"?n.ordinalNumber(e.getMinutes(),{unit:"minute"}):Wa.m(e,t)},s:function(e,t,n){return t==="so"?n.ordinalNumber(e.getSeconds(),{unit:"second"}):Wa.s(e,t)},S:function(e,t){return Wa.S(e,t)},X:function(e,t,n){const s=e.getTimezoneOffset();if(s===0)return"Z";switch(t){case"X":return dv(s);case"XXXX":case"XX":return _i(s);case"XXXXX":case"XXX":default:return _i(s,":")}},x:function(e,t,n){const s=e.getTimezoneOffset();switch(t){case"x":return dv(s);case"xxxx":case"xx":return _i(s);case"xxxxx":case"xxx":default:return _i(s,":")}},O:function(e,t,n){const s=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+cv(s,":");case"OOOO":default:return"GMT"+_i(s,":")}},z:function(e,t,n){const s=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+cv(s,":");case"zzzz":default:return"GMT"+_i(s,":")}},t:function(e,t,n){const s=Math.trunc(+e/1e3);return nr(s,t.length)},T:function(e,t,n){return nr(+e,t.length)}};function cv(e,t=""){const n=e>0?"-":"+",s=Math.abs(e),a=Math.trunc(s/60),i=s%60;return i===0?n+String(a):n+String(a)+t+nr(i,2)}function dv(e,t){return e%60===0?(e>0?"-":"+")+nr(Math.abs(e)/60,2):_i(e,t)}function _i(e,t=""){const n=e>0?"-":"+",s=Math.abs(e),a=nr(Math.trunc(s/60),2),i=nr(s%60,2);return n+a+t+i}const uv=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},lS=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},rL=(e,t)=>{const n=e.match(/(P+)(p+)?/)||[],s=n[1],a=n[2];if(!a)return uv(e,t);let i;switch(s){case"P":i=t.dateTime({width:"short"});break;case"PP":i=t.dateTime({width:"medium"});break;case"PPP":i=t.dateTime({width:"long"});break;case"PPPP":default:i=t.dateTime({width:"full"});break}return i.replace("{{date}}",uv(s,t)).replace("{{time}}",lS(a,t))},Uf={p:lS,P:rL},nL=/^D+$/,sL=/^Y+$/,aL=["D","DD","YY","YYYY"];function iL(e){return nL.test(e)}function lL(e){return sL.test(e)}function oL(e,t,n){const s=cL(e,t,n);if(console.warn(s),aL.includes(e))throw new RangeError(s)}function cL(e,t,n){const s=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${s} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const dL=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,uL=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,mL=/^'([^]*?)'?$/,hL=/''/g,pL=/[a-zA-Z]/;function tu(e,t,n){var u,m,p,f,y,g,x,b;const s=al(),a=(n==null?void 0:n.locale)??s.locale??aS,i=(n==null?void 0:n.firstWeekContainsDate)??((m=(u=n==null?void 0:n.locale)==null?void 0:u.options)==null?void 0:m.firstWeekContainsDate)??s.firstWeekContainsDate??((f=(p=s.locale)==null?void 0:p.options)==null?void 0:f.firstWeekContainsDate)??1,l=(n==null?void 0:n.weekStartsOn)??((g=(y=n==null?void 0:n.locale)==null?void 0:y.options)==null?void 0:g.weekStartsOn)??s.weekStartsOn??((b=(x=s.locale)==null?void 0:x.options)==null?void 0:b.weekStartsOn)??0,o=ct(e,n==null?void 0:n.in);if(!Jd(o))throw new RangeError("Invalid time value");let c=t.match(uL).map(v=>{const w=v[0];if(w==="p"||w==="P"){const N=Uf[w];return N(v,a.formatLong)}return v}).join("").match(dL).map(v=>{if(v==="''")return{isToken:!1,value:"'"};const w=v[0];if(w==="'")return{isToken:!1,value:fL(v)};if(ov[w])return{isToken:!0,value:v};if(w.match(pL))throw new RangeError("Format string contains an unescaped latin alphabet character `"+w+"`");return{isToken:!1,value:v}});a.localize.preprocessor&&(c=a.localize.preprocessor(o,c));const d={firstWeekContainsDate:i,weekStartsOn:l,locale:a};return c.map(v=>{if(!v.isToken)return v.value;const w=v.value;(!(n!=null&&n.useAdditionalWeekYearTokens)&&lL(w)||!(n!=null&&n.useAdditionalDayOfYearTokens)&&iL(w))&&oL(w,t,String(e));const N=ov[w[0]];return N(o,w,a.localize,d)}).join("")}function fL(e){const t=e.match(mL);return t?t[1].replace(hL,"'"):e}function mv(e,t){return ct(e,t==null?void 0:t.in).getDate()}function gL(e,t){return ct(e,t==null?void 0:t.in).getDay()}function xL(e,t){const n=ct(e,t==null?void 0:t.in),s=n.getFullYear(),a=n.getMonth(),i=lr(n,0);return i.setFullYear(s,a+1,0),i.setHours(0,0,0,0),i.getDate()}function yL(){return Object.assign({},al())}function ja(e,t){return ct(e,t==null?void 0:t.in).getHours()}function bL(e,t){const n=ct(e,t==null?void 0:t.in).getDay();return n===0?7:n}function Na(e,t){return ct(e,t==null?void 0:t.in).getMinutes()}function bn(e,t){return ct(e,t==null?void 0:t.in).getMonth()}function ai(e){return ct(e).getSeconds()}function qf(e){return+ct(e)}function Tt(e,t){return ct(e,t==null?void 0:t.in).getFullYear()}function ui(e,t){return+ct(e)>+ct(t)}function Ks(e,t){return+ct(e)<+ct(t)}function vL(e,t){return+ct(e)==+ct(t)}function wL(e,t){const n=jL(t)?new t(0):lr(t,0);return n.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),n.setHours(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()),n}function jL(e){var t;return typeof e=="function"&&((t=e.prototype)==null?void 0:t.constructor)===e}const NL=10;class oS{constructor(){Xe(this,"subPriority",0)}validate(t,n){return!0}}class CL extends oS{constructor(t,n,s,a,i){super(),this.value=t,this.validateValue=n,this.setValue=s,this.priority=a,i&&(this.subPriority=i)}validate(t,n){return this.validateValue(t,this.value,n)}set(t,n,s){return this.setValue(t,n,this.value,s)}}class kL extends oS{constructor(n,s){super();Xe(this,"priority",NL);Xe(this,"subPriority",-1);this.context=n||(a=>lr(s,a))}set(n,s){return s.timestampIsSet?n:lr(n,wL(n,this.context))}}class Jt{run(t,n,s,a){const i=this.parse(t,n,s,a);return i?{setter:new CL(i.value,this.validate,this.set,this.priority,this.subPriority),rest:i.rest}:null}validate(t,n,s){return!0}}class SL extends Jt{constructor(){super(...arguments);Xe(this,"priority",140);Xe(this,"incompatibleTokens",["R","u","t","T"])}parse(n,s,a){switch(s){case"G":case"GG":case"GGG":return a.era(n,{width:"abbreviated"})||a.era(n,{width:"narrow"});case"GGGGG":return a.era(n,{width:"narrow"});case"GGGG":default:return a.era(n,{width:"wide"})||a.era(n,{width:"abbreviated"})||a.era(n,{width:"narrow"})}}set(n,s,a){return s.era=a,n.setFullYear(a,0,1),n.setHours(0,0,0,0),n}}const Pr={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},Vs={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function Or(e,t){return e&&{value:t(e.value),rest:e.rest}}function Nr(e,t){const n=t.match(e);return n?{value:parseInt(n[0],10),rest:t.slice(n[0].length)}:null}function Gs(e,t){const n=t.match(e);if(!n)return null;if(n[0]==="Z")return{value:0,rest:t.slice(1)};const s=n[1]==="+"?1:-1,a=n[2]?parseInt(n[2],10):0,i=n[3]?parseInt(n[3],10):0,l=n[5]?parseInt(n[5],10):0;return{value:s*(a*tm+i*em+l*p6),rest:t.slice(n[0].length)}}function cS(e){return Nr(Pr.anyDigitsSigned,e)}function Dr(e,t){switch(e){case 1:return Nr(Pr.singleDigit,t);case 2:return Nr(Pr.twoDigits,t);case 3:return Nr(Pr.threeDigits,t);case 4:return Nr(Pr.fourDigits,t);default:return Nr(new RegExp("^\\d{1,"+e+"}"),t)}}function ru(e,t){switch(e){case 1:return Nr(Pr.singleDigitSigned,t);case 2:return Nr(Pr.twoDigitsSigned,t);case 3:return Nr(Pr.threeDigitsSigned,t);case 4:return Nr(Pr.fourDigitsSigned,t);default:return Nr(new RegExp("^-?\\d{1,"+e+"}"),t)}}function _x(e){switch(e){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function dS(e,t){const n=t>0,s=n?t:1-t;let a;if(s<=50)a=e||100;else{const i=s+50,l=Math.trunc(i/100)*100,o=e>=i%100;a=e+l-(o?100:0)}return n?a:1-a}function uS(e){return e%400===0||e%4===0&&e%100!==0}class _L extends Jt{constructor(){super(...arguments);Xe(this,"priority",130);Xe(this,"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"])}parse(n,s,a){const i=l=>({year:l,isTwoDigitYear:s==="yy"});switch(s){case"y":return Or(Dr(4,n),i);case"yo":return Or(a.ordinalNumber(n,{unit:"year"}),i);default:return Or(Dr(s.length,n),i)}}validate(n,s){return s.isTwoDigitYear||s.year>0}set(n,s,a){const i=n.getFullYear();if(a.isTwoDigitYear){const o=dS(a.year,i);return n.setFullYear(o,0,1),n.setHours(0,0,0,0),n}const l=!("era"in s)||s.era===1?a.year:1-a.year;return n.setFullYear(l,0,1),n.setHours(0,0,0,0),n}}class EL extends Jt{constructor(){super(...arguments);Xe(this,"priority",130);Xe(this,"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"])}parse(n,s,a){const i=l=>({year:l,isTwoDigitYear:s==="YY"});switch(s){case"Y":return Or(Dr(4,n),i);case"Yo":return Or(a.ordinalNumber(n,{unit:"year"}),i);default:return Or(Dr(s.length,n),i)}}validate(n,s){return s.isTwoDigitYear||s.year>0}set(n,s,a,i){const l=Sx(n,i);if(a.isTwoDigitYear){const c=dS(a.year,l);return n.setFullYear(c,0,i.firstWeekContainsDate),n.setHours(0,0,0,0),Aa(n,i)}const o=!("era"in s)||s.era===1?a.year:1-a.year;return n.setFullYear(o,0,i.firstWeekContainsDate),n.setHours(0,0,0,0),Aa(n,i)}}class DL extends Jt{constructor(){super(...arguments);Xe(this,"priority",130);Xe(this,"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"])}parse(n,s){return ru(s==="R"?4:s.length,n)}set(n,s,a){const i=lr(n,0);return i.setFullYear(a,0,4),i.setHours(0,0,0,0),Ll(i)}}class TL extends Jt{constructor(){super(...arguments);Xe(this,"priority",130);Xe(this,"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"])}parse(n,s){return ru(s==="u"?4:s.length,n)}set(n,s,a){return n.setFullYear(a,0,1),n.setHours(0,0,0,0),n}}class AL extends Jt{constructor(){super(...arguments);Xe(this,"priority",120);Xe(this,"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"])}parse(n,s,a){switch(s){case"Q":case"QQ":return Dr(s.length,n);case"Qo":return a.ordinalNumber(n,{unit:"quarter"});case"QQQ":return a.quarter(n,{width:"abbreviated",context:"formatting"})||a.quarter(n,{width:"narrow",context:"formatting"});case"QQQQQ":return a.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(n,{width:"wide",context:"formatting"})||a.quarter(n,{width:"abbreviated",context:"formatting"})||a.quarter(n,{width:"narrow",context:"formatting"})}}validate(n,s){return s>=1&&s<=4}set(n,s,a){return n.setMonth((a-1)*3,1),n.setHours(0,0,0,0),n}}class PL extends Jt{constructor(){super(...arguments);Xe(this,"priority",120);Xe(this,"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"])}parse(n,s,a){switch(s){case"q":case"qq":return Dr(s.length,n);case"qo":return a.ordinalNumber(n,{unit:"quarter"});case"qqq":return a.quarter(n,{width:"abbreviated",context:"standalone"})||a.quarter(n,{width:"narrow",context:"standalone"});case"qqqqq":return a.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(n,{width:"wide",context:"standalone"})||a.quarter(n,{width:"abbreviated",context:"standalone"})||a.quarter(n,{width:"narrow",context:"standalone"})}}validate(n,s){return s>=1&&s<=4}set(n,s,a){return n.setMonth((a-1)*3,1),n.setHours(0,0,0,0),n}}class OL extends Jt{constructor(){super(...arguments);Xe(this,"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]);Xe(this,"priority",110)}parse(n,s,a){const i=l=>l-1;switch(s){case"M":return Or(Nr(Pr.month,n),i);case"MM":return Or(Dr(2,n),i);case"Mo":return Or(a.ordinalNumber(n,{unit:"month"}),i);case"MMM":return a.month(n,{width:"abbreviated",context:"formatting"})||a.month(n,{width:"narrow",context:"formatting"});case"MMMMM":return a.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(n,{width:"wide",context:"formatting"})||a.month(n,{width:"abbreviated",context:"formatting"})||a.month(n,{width:"narrow",context:"formatting"})}}validate(n,s){return s>=0&&s<=11}set(n,s,a){return n.setMonth(a,1),n.setHours(0,0,0,0),n}}class ML extends Jt{constructor(){super(...arguments);Xe(this,"priority",110);Xe(this,"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"])}parse(n,s,a){const i=l=>l-1;switch(s){case"L":return Or(Nr(Pr.month,n),i);case"LL":return Or(Dr(2,n),i);case"Lo":return Or(a.ordinalNumber(n,{unit:"month"}),i);case"LLL":return a.month(n,{width:"abbreviated",context:"standalone"})||a.month(n,{width:"narrow",context:"standalone"});case"LLLLL":return a.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(n,{width:"wide",context:"standalone"})||a.month(n,{width:"abbreviated",context:"standalone"})||a.month(n,{width:"narrow",context:"standalone"})}}validate(n,s){return s>=0&&s<=11}set(n,s,a){return n.setMonth(a,1),n.setHours(0,0,0,0),n}}function IL(e,t,n){const s=ct(e,n==null?void 0:n.in),a=iS(s,n)-t;return s.setDate(s.getDate()-a*7),ct(s,n==null?void 0:n.in)}class LL extends Jt{constructor(){super(...arguments);Xe(this,"priority",100);Xe(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"])}parse(n,s,a){switch(s){case"w":return Nr(Pr.week,n);case"wo":return a.ordinalNumber(n,{unit:"week"});default:return Dr(s.length,n)}}validate(n,s){return s>=1&&s<=53}set(n,s,a,i){return Aa(IL(n,a,i),i)}}function RL(e,t,n){const s=ct(e,n==null?void 0:n.in),a=kx(s,n)-t;return s.setDate(s.getDate()-a*7),s}class $L extends Jt{constructor(){super(...arguments);Xe(this,"priority",100);Xe(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"])}parse(n,s,a){switch(s){case"I":return Nr(Pr.week,n);case"Io":return a.ordinalNumber(n,{unit:"week"});default:return Dr(s.length,n)}}validate(n,s){return s>=1&&s<=53}set(n,s,a){return Ll(RL(n,a))}}const FL=[31,28,31,30,31,30,31,31,30,31,30,31],zL=[31,29,31,30,31,30,31,31,30,31,30,31];class BL extends Jt{constructor(){super(...arguments);Xe(this,"priority",90);Xe(this,"subPriority",1);Xe(this,"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"])}parse(n,s,a){switch(s){case"d":return Nr(Pr.date,n);case"do":return a.ordinalNumber(n,{unit:"date"});default:return Dr(s.length,n)}}validate(n,s){const a=n.getFullYear(),i=uS(a),l=n.getMonth();return i?s>=1&&s<=zL[l]:s>=1&&s<=FL[l]}set(n,s,a){return n.setDate(a),n.setHours(0,0,0,0),n}}class UL extends Jt{constructor(){super(...arguments);Xe(this,"priority",90);Xe(this,"subpriority",1);Xe(this,"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"])}parse(n,s,a){switch(s){case"D":case"DD":return Nr(Pr.dayOfYear,n);case"Do":return a.ordinalNumber(n,{unit:"date"});default:return Dr(s.length,n)}}validate(n,s){const a=n.getFullYear();return uS(a)?s>=1&&s<=366:s>=1&&s<=365}set(n,s,a){return n.setMonth(0,a),n.setHours(0,0,0,0),n}}function Ex(e,t,n){var m,p,f,y;const s=al(),a=(n==null?void 0:n.weekStartsOn)??((p=(m=n==null?void 0:n.locale)==null?void 0:m.options)==null?void 0:p.weekStartsOn)??s.weekStartsOn??((y=(f=s.locale)==null?void 0:f.options)==null?void 0:y.weekStartsOn)??0,i=ct(e,n==null?void 0:n.in),l=i.getDay(),c=(t%7+7)%7,d=7-a,u=t<0||t>6?t-(l+d)%7:(c+d)%7-(l+d)%7;return Rs(i,u,n)}class qL extends Jt{constructor(){super(...arguments);Xe(this,"priority",90);Xe(this,"incompatibleTokens",["D","i","e","c","t","T"])}parse(n,s,a){switch(s){case"E":case"EE":case"EEE":return a.day(n,{width:"abbreviated",context:"formatting"})||a.day(n,{width:"short",context:"formatting"})||a.day(n,{width:"narrow",context:"formatting"});case"EEEEE":return a.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(n,{width:"short",context:"formatting"})||a.day(n,{width:"narrow",context:"formatting"});case"EEEE":default:return a.day(n,{width:"wide",context:"formatting"})||a.day(n,{width:"abbreviated",context:"formatting"})||a.day(n,{width:"short",context:"formatting"})||a.day(n,{width:"narrow",context:"formatting"})}}validate(n,s){return s>=0&&s<=6}set(n,s,a,i){return n=Ex(n,a,i),n.setHours(0,0,0,0),n}}class HL extends Jt{constructor(){super(...arguments);Xe(this,"priority",90);Xe(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"])}parse(n,s,a,i){const l=o=>{const c=Math.floor((o-1)/7)*7;return(o+i.weekStartsOn+6)%7+c};switch(s){case"e":case"ee":return Or(Dr(s.length,n),l);case"eo":return Or(a.ordinalNumber(n,{unit:"day"}),l);case"eee":return a.day(n,{width:"abbreviated",context:"formatting"})||a.day(n,{width:"short",context:"formatting"})||a.day(n,{width:"narrow",context:"formatting"});case"eeeee":return a.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(n,{width:"short",context:"formatting"})||a.day(n,{width:"narrow",context:"formatting"});case"eeee":default:return a.day(n,{width:"wide",context:"formatting"})||a.day(n,{width:"abbreviated",context:"formatting"})||a.day(n,{width:"short",context:"formatting"})||a.day(n,{width:"narrow",context:"formatting"})}}validate(n,s){return s>=0&&s<=6}set(n,s,a,i){return n=Ex(n,a,i),n.setHours(0,0,0,0),n}}class WL extends Jt{constructor(){super(...arguments);Xe(this,"priority",90);Xe(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"])}parse(n,s,a,i){const l=o=>{const c=Math.floor((o-1)/7)*7;return(o+i.weekStartsOn+6)%7+c};switch(s){case"c":case"cc":return Or(Dr(s.length,n),l);case"co":return Or(a.ordinalNumber(n,{unit:"day"}),l);case"ccc":return a.day(n,{width:"abbreviated",context:"standalone"})||a.day(n,{width:"short",context:"standalone"})||a.day(n,{width:"narrow",context:"standalone"});case"ccccc":return a.day(n,{width:"narrow",context:"standalone"});case"cccccc":return a.day(n,{width:"short",context:"standalone"})||a.day(n,{width:"narrow",context:"standalone"});case"cccc":default:return a.day(n,{width:"wide",context:"standalone"})||a.day(n,{width:"abbreviated",context:"standalone"})||a.day(n,{width:"short",context:"standalone"})||a.day(n,{width:"narrow",context:"standalone"})}}validate(n,s){return s>=0&&s<=6}set(n,s,a,i){return n=Ex(n,a,i),n.setHours(0,0,0,0),n}}function YL(e,t,n){const s=ct(e,n==null?void 0:n.in),a=bL(s,n),i=t-a;return Rs(s,i,n)}class VL extends Jt{constructor(){super(...arguments);Xe(this,"priority",90);Xe(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"])}parse(n,s,a){const i=l=>l===0?7:l;switch(s){case"i":case"ii":return Dr(s.length,n);case"io":return a.ordinalNumber(n,{unit:"day"});case"iii":return Or(a.day(n,{width:"abbreviated",context:"formatting"})||a.day(n,{width:"short",context:"formatting"})||a.day(n,{width:"narrow",context:"formatting"}),i);case"iiiii":return Or(a.day(n,{width:"narrow",context:"formatting"}),i);case"iiiiii":return Or(a.day(n,{width:"short",context:"formatting"})||a.day(n,{width:"narrow",context:"formatting"}),i);case"iiii":default:return Or(a.day(n,{width:"wide",context:"formatting"})||a.day(n,{width:"abbreviated",context:"formatting"})||a.day(n,{width:"short",context:"formatting"})||a.day(n,{width:"narrow",context:"formatting"}),i)}}validate(n,s){return s>=1&&s<=7}set(n,s,a){return n=YL(n,a),n.setHours(0,0,0,0),n}}class GL extends Jt{constructor(){super(...arguments);Xe(this,"priority",80);Xe(this,"incompatibleTokens",["b","B","H","k","t","T"])}parse(n,s,a){switch(s){case"a":case"aa":case"aaa":return a.dayPeriod(n,{width:"abbreviated",context:"formatting"})||a.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaaa":return a.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(n,{width:"wide",context:"formatting"})||a.dayPeriod(n,{width:"abbreviated",context:"formatting"})||a.dayPeriod(n,{width:"narrow",context:"formatting"})}}set(n,s,a){return n.setHours(_x(a),0,0,0),n}}class KL extends Jt{constructor(){super(...arguments);Xe(this,"priority",80);Xe(this,"incompatibleTokens",["a","B","H","k","t","T"])}parse(n,s,a){switch(s){case"b":case"bb":case"bbb":return a.dayPeriod(n,{width:"abbreviated",context:"formatting"})||a.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbbb":return a.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(n,{width:"wide",context:"formatting"})||a.dayPeriod(n,{width:"abbreviated",context:"formatting"})||a.dayPeriod(n,{width:"narrow",context:"formatting"})}}set(n,s,a){return n.setHours(_x(a),0,0,0),n}}class XL extends Jt{constructor(){super(...arguments);Xe(this,"priority",80);Xe(this,"incompatibleTokens",["a","b","t","T"])}parse(n,s,a){switch(s){case"B":case"BB":case"BBB":return a.dayPeriod(n,{width:"abbreviated",context:"formatting"})||a.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBBB":return a.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(n,{width:"wide",context:"formatting"})||a.dayPeriod(n,{width:"abbreviated",context:"formatting"})||a.dayPeriod(n,{width:"narrow",context:"formatting"})}}set(n,s,a){return n.setHours(_x(a),0,0,0),n}}class JL extends Jt{constructor(){super(...arguments);Xe(this,"priority",70);Xe(this,"incompatibleTokens",["H","K","k","t","T"])}parse(n,s,a){switch(s){case"h":return Nr(Pr.hour12h,n);case"ho":return a.ordinalNumber(n,{unit:"hour"});default:return Dr(s.length,n)}}validate(n,s){return s>=1&&s<=12}set(n,s,a){const i=n.getHours()>=12;return i&&a<12?n.setHours(a+12,0,0,0):!i&&a===12?n.setHours(0,0,0,0):n.setHours(a,0,0,0),n}}class QL extends Jt{constructor(){super(...arguments);Xe(this,"priority",70);Xe(this,"incompatibleTokens",["a","b","h","K","k","t","T"])}parse(n,s,a){switch(s){case"H":return Nr(Pr.hour23h,n);case"Ho":return a.ordinalNumber(n,{unit:"hour"});default:return Dr(s.length,n)}}validate(n,s){return s>=0&&s<=23}set(n,s,a){return n.setHours(a,0,0,0),n}}class ZL extends Jt{constructor(){super(...arguments);Xe(this,"priority",70);Xe(this,"incompatibleTokens",["h","H","k","t","T"])}parse(n,s,a){switch(s){case"K":return Nr(Pr.hour11h,n);case"Ko":return a.ordinalNumber(n,{unit:"hour"});default:return Dr(s.length,n)}}validate(n,s){return s>=0&&s<=11}set(n,s,a){return n.getHours()>=12&&a<12?n.setHours(a+12,0,0,0):n.setHours(a,0,0,0),n}}class eR extends Jt{constructor(){super(...arguments);Xe(this,"priority",70);Xe(this,"incompatibleTokens",["a","b","h","H","K","t","T"])}parse(n,s,a){switch(s){case"k":return Nr(Pr.hour24h,n);case"ko":return a.ordinalNumber(n,{unit:"hour"});default:return Dr(s.length,n)}}validate(n,s){return s>=1&&s<=24}set(n,s,a){const i=a<=24?a%24:a;return n.setHours(i,0,0,0),n}}class tR extends Jt{constructor(){super(...arguments);Xe(this,"priority",60);Xe(this,"incompatibleTokens",["t","T"])}parse(n,s,a){switch(s){case"m":return Nr(Pr.minute,n);case"mo":return a.ordinalNumber(n,{unit:"minute"});default:return Dr(s.length,n)}}validate(n,s){return s>=0&&s<=59}set(n,s,a){return n.setMinutes(a,0,0),n}}class rR extends Jt{constructor(){super(...arguments);Xe(this,"priority",50);Xe(this,"incompatibleTokens",["t","T"])}parse(n,s,a){switch(s){case"s":return Nr(Pr.second,n);case"so":return a.ordinalNumber(n,{unit:"second"});default:return Dr(s.length,n)}}validate(n,s){return s>=0&&s<=59}set(n,s,a){return n.setSeconds(a,0),n}}class nR extends Jt{constructor(){super(...arguments);Xe(this,"priority",30);Xe(this,"incompatibleTokens",["t","T"])}parse(n,s){const a=i=>Math.trunc(i*Math.pow(10,-s.length+3));return Or(Dr(s.length,n),a)}set(n,s,a){return n.setMilliseconds(a),n}}class sR extends Jt{constructor(){super(...arguments);Xe(this,"priority",10);Xe(this,"incompatibleTokens",["t","T","x"])}parse(n,s){switch(s){case"X":return Gs(Vs.basicOptionalMinutes,n);case"XX":return Gs(Vs.basic,n);case"XXXX":return Gs(Vs.basicOptionalSeconds,n);case"XXXXX":return Gs(Vs.extendedOptionalSeconds,n);case"XXX":default:return Gs(Vs.extended,n)}}set(n,s,a){return s.timestampIsSet?n:lr(n,n.getTime()-Kd(n)-a)}}class aR extends Jt{constructor(){super(...arguments);Xe(this,"priority",10);Xe(this,"incompatibleTokens",["t","T","X"])}parse(n,s){switch(s){case"x":return Gs(Vs.basicOptionalMinutes,n);case"xx":return Gs(Vs.basic,n);case"xxxx":return Gs(Vs.basicOptionalSeconds,n);case"xxxxx":return Gs(Vs.extendedOptionalSeconds,n);case"xxx":default:return Gs(Vs.extended,n)}}set(n,s,a){return s.timestampIsSet?n:lr(n,n.getTime()-Kd(n)-a)}}class iR extends Jt{constructor(){super(...arguments);Xe(this,"priority",40);Xe(this,"incompatibleTokens","*")}parse(n){return cS(n)}set(n,s,a){return[lr(n,a*1e3),{timestampIsSet:!0}]}}class lR extends Jt{constructor(){super(...arguments);Xe(this,"priority",20);Xe(this,"incompatibleTokens","*")}parse(n){return cS(n)}set(n,s,a){return[lr(n,a),{timestampIsSet:!0}]}}const oR={G:new SL,y:new _L,Y:new EL,R:new DL,u:new TL,Q:new AL,q:new PL,M:new OL,L:new ML,w:new LL,I:new $L,d:new BL,D:new UL,E:new qL,e:new HL,c:new WL,i:new VL,a:new GL,b:new KL,B:new XL,h:new JL,H:new QL,K:new ZL,k:new eR,m:new tR,s:new rR,S:new nR,X:new sR,x:new aR,t:new iR,T:new lR},cR=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,dR=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,uR=/^'([^]*?)'?$/,mR=/''/g,hR=/\S/,pR=/[a-zA-Z]/;function fR(e,t,n,s){var x,b,v,w,N,k,j,S;const a=()=>lr((s==null?void 0:s.in)||n,NaN),i=yL(),l=(s==null?void 0:s.locale)??i.locale??aS,o=(s==null?void 0:s.firstWeekContainsDate)??((b=(x=s==null?void 0:s.locale)==null?void 0:x.options)==null?void 0:b.firstWeekContainsDate)??i.firstWeekContainsDate??((w=(v=i.locale)==null?void 0:v.options)==null?void 0:w.firstWeekContainsDate)??1,c=(s==null?void 0:s.weekStartsOn)??((k=(N=s==null?void 0:s.locale)==null?void 0:N.options)==null?void 0:k.weekStartsOn)??i.weekStartsOn??((S=(j=i.locale)==null?void 0:j.options)==null?void 0:S.weekStartsOn)??0;if(!t)return e?a():ct(n,s==null?void 0:s.in);const d={firstWeekContainsDate:o,weekStartsOn:c,locale:l},u=[new kL(s==null?void 0:s.in,n)],m=t.match(dR).map(_=>{const C=_[0];if(C in Uf){const D=Uf[C];return D(_,l.formatLong)}return _}).join("").match(cR),p=[];for(let _ of m){const C=_[0],D=oR[C];if(D){const{incompatibleTokens:A}=D;if(Array.isArray(A)){const T=p.find(M=>A.includes(M.token)||M.token===C);if(T)throw new RangeError(`The format string mustn't contain \`${T.fullToken}\` and \`${_}\` at the same time`)}else if(D.incompatibleTokens==="*"&&p.length>0)throw new RangeError(`The format string mustn't contain \`${_}\` and any other token at the same time`);p.push({token:C,fullToken:_});const E=D.run(e,_,l.match,d);if(!E)return a();u.push(E.setter),e=E.rest}else{if(C.match(pR))throw new RangeError("Format string contains an unescaped latin alphabet character `"+C+"`");if(_==="''"?_="'":C==="'"&&(_=gR(_)),e.indexOf(_)===0)e=e.slice(_.length);else return a()}}if(e.length>0&&hR.test(e))return a();const f=u.map(_=>_.priority).sort((_,C)=>C-_).filter((_,C,D)=>D.indexOf(_)===C).map(_=>u.filter(C=>C.priority===_).sort((C,D)=>D.subPriority-C.subPriority)).map(_=>_[0]);let y=ct(n,s==null?void 0:s.in);if(isNaN(+y))return a();const g={};for(const _ of f){if(!_.validate(y,d))return a();const C=_.set(y,g,d);Array.isArray(C)?(y=C[0],Object.assign(g,C[1])):y=C}return y}function gR(e){return e.match(uR)[1].replace(mR,"'")}function xR(e,t,n){const[s,a]=Ra(n==null?void 0:n.in,e,t);return s.getFullYear()===a.getFullYear()&&s.getMonth()===a.getMonth()}function yR(e,t,n){const[s,a]=Ra(n==null?void 0:n.in,e,t);return+Bf(s)==+Bf(a)}function bR(e,t,n){const[s,a]=Ra(n==null?void 0:n.in,e,t);return s.getFullYear()===a.getFullYear()}function Zo(e,t,n){const s=+ct(e,n==null?void 0:n.in),[a,i]=[+ct(t.start,n==null?void 0:n.in),+ct(t.end,n==null?void 0:n.in)].sort((l,o)=>l-o);return s>=a&&s<=i}function vR(e,t,n){return Rs(e,-1,n)}function wR(e,t){const n=()=>lr(t==null?void 0:t.in,NaN),a=kR(e);let i;if(a.date){const d=SR(a.date,2);i=_R(d.restDateString,d.year)}if(!i||isNaN(+i))return n();const l=+i;let o=0,c;if(a.time&&(o=ER(a.time),isNaN(o)))return n();if(a.timezone){if(c=DR(a.timezone),isNaN(c))return n()}else{const d=new Date(l+o),u=ct(0,t==null?void 0:t.in);return u.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),u.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),u}return ct(l+o+c,t==null?void 0:t.in)}const Xc={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},jR=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,NR=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,CR=/^([+-])(\d{2})(?::?(\d{2}))?$/;function kR(e){const t={},n=e.split(Xc.dateTimeDelimiter);let s;if(n.length>2)return t;if(/:/.test(n[0])?s=n[0]:(t.date=n[0],s=n[1],Xc.timeZoneDelimiter.test(t.date)&&(t.date=e.split(Xc.timeZoneDelimiter)[0],s=e.substr(t.date.length,e.length))),s){const a=Xc.timezone.exec(s);a?(t.time=s.replace(a[1],""),t.timezone=a[1]):t.time=s}return t}function SR(e,t){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),s=e.match(n);if(!s)return{year:NaN,restDateString:""};const a=s[1]?parseInt(s[1]):null,i=s[2]?parseInt(s[2]):null;return{year:i===null?a:i*100,restDateString:e.slice((s[1]||s[2]).length)}}function _R(e,t){if(t===null)return new Date(NaN);const n=e.match(jR);if(!n)return new Date(NaN);const s=!!n[4],a=No(n[1]),i=No(n[2])-1,l=No(n[3]),o=No(n[4]),c=No(n[5])-1;if(s)return MR(t,o,c)?TR(t,o,c):new Date(NaN);{const d=new Date(0);return!PR(t,i,l)||!OR(t,a)?new Date(NaN):(d.setUTCFullYear(t,i,Math.max(a,l)),d)}}function No(e){return e?parseInt(e):1}function ER(e){const t=e.match(NR);if(!t)return NaN;const n=bh(t[1]),s=bh(t[2]),a=bh(t[3]);return IR(n,s,a)?n*tm+s*em+a*1e3:NaN}function bh(e){return e&&parseFloat(e.replace(",","."))||0}function DR(e){if(e==="Z")return 0;const t=e.match(CR);if(!t)return 0;const n=t[1]==="+"?-1:1,s=parseInt(t[2]),a=t[3]&&parseInt(t[3])||0;return LR(s,a)?n*(s*tm+a*em):NaN}function TR(e,t,n){const s=new Date(0);s.setUTCFullYear(e,0,4);const a=s.getUTCDay()||7,i=(t-1)*7+n+1-a;return s.setUTCDate(s.getUTCDate()+i),s}const AR=[31,null,31,30,31,30,31,31,30,31,30,31];function mS(e){return e%400===0||e%4===0&&e%100!==0}function PR(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(AR[t]||(mS(e)?29:28))}function OR(e,t){return t>=1&&t<=(mS(e)?366:365)}function MR(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}function IR(e,t,n){return e===24?t===0&&n===0:n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}function LR(e,t){return t>=0&&t<=59}function cs(e,t,n){const s=ct(e,n==null?void 0:n.in),a=s.getFullYear(),i=s.getDate(),l=lr(e,0);l.setFullYear(a,t,15),l.setHours(0,0,0,0);const o=xL(l);return s.setMonth(t,Math.min(i,o)),s}function Td(e,t,n){const s=ct(e,n==null?void 0:n.in);return s.setHours(t),s}function Ad(e,t,n){const s=ct(e,n==null?void 0:n.in);return s.setMinutes(t),s}function vl(e,t,n){const s=ct(e,n==null?void 0:n.in),a=Math.trunc(s.getMonth()/3)+1,i=t-a;return cs(s,s.getMonth()+i*3)}function Pd(e,t,n){const s=ct(e,n==null?void 0:n.in);return s.setSeconds(t),s}function Hs(e,t,n){const s=ct(e,n==null?void 0:n.in);return isNaN(+s)?lr(e,NaN):(s.setFullYear(t),s)}function Ca(e,t,n){return $s(e,-t,n)}function hS(e,t,n){return Nx(e,-1,n)}function hv(e,t,n){return Xd(e,-1,n)}function Xi(e,t,n){return va(e,-t,n)}function nm(){return typeof window<"u"}function so(e){return pS(e)?(e.nodeName||"").toLowerCase():"#document"}function es(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function ma(e){var t;return(t=(pS(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function pS(e){return nm()?e instanceof Node||e instanceof es(e).Node:!1}function kn(e){return nm()?e instanceof Element||e instanceof es(e).Element:!1}function ia(e){return nm()?e instanceof HTMLElement||e instanceof es(e).HTMLElement:!1}function pv(e){return!nm()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof es(e).ShadowRoot}const RR=new Set(["inline","contents"]);function Nc(e){const{overflow:t,overflowX:n,overflowY:s,display:a}=ws(e);return/auto|scroll|overlay|hidden|clip/.test(t+s+n)&&!RR.has(a)}const $R=new Set(["table","td","th"]);function FR(e){return $R.has(so(e))}const zR=[":popover-open",":modal"];function sm(e){return zR.some(t=>{try{return e.matches(t)}catch{return!1}})}const BR=["transform","translate","scale","rotate","perspective"],UR=["transform","translate","scale","rotate","perspective","filter"],qR=["paint","layout","strict","content"];function Dx(e){const t=Tx(),n=kn(e)?ws(e):e;return BR.some(s=>n[s]?n[s]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||UR.some(s=>(n.willChange||"").includes(s))||qR.some(s=>(n.contain||"").includes(s))}function HR(e){let t=mi(e);for(;ia(t)&&!$l(t);){if(Dx(t))return t;if(sm(t))return null;t=mi(t)}return null}function Tx(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const WR=new Set(["html","body","#document"]);function $l(e){return WR.has(so(e))}function ws(e){return es(e).getComputedStyle(e)}function am(e){return kn(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function mi(e){if(so(e)==="html")return e;const t=e.assignedSlot||e.parentNode||pv(e)&&e.host||ma(e);return pv(t)?t.host:t}function fS(e){const t=mi(e);return $l(t)?e.ownerDocument?e.ownerDocument.body:e.body:ia(t)&&Nc(t)?t:fS(t)}function ec(e,t,n){var s;t===void 0&&(t=[]),n===void 0&&(n=!0);const a=fS(e),i=a===((s=e.ownerDocument)==null?void 0:s.body),l=es(a);if(i){const o=Hf(l);return t.concat(l,l.visualViewport||[],Nc(a)?a:[],o&&n?ec(o):[])}return t.concat(a,ec(a,[],n))}function Hf(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}const Fl=Math.min,zi=Math.max,nu=Math.round,Jc=Math.floor,Zs=e=>({x:e,y:e}),YR={left:"right",right:"left",bottom:"top",top:"bottom"},VR={start:"end",end:"start"};function GR(e,t,n){return zi(e,Fl(t,n))}function im(e,t){return typeof e=="function"?e(t):e}function zl(e){return e.split("-")[0]}function Cc(e){return e.split("-")[1]}function KR(e){return e==="x"?"y":"x"}function Ax(e){return e==="y"?"height":"width"}const XR=new Set(["top","bottom"]);function Pi(e){return XR.has(zl(e))?"y":"x"}function Px(e){return KR(Pi(e))}function JR(e,t,n){n===void 0&&(n=!1);const s=Cc(e),a=Px(e),i=Ax(a);let l=a==="x"?s===(n?"end":"start")?"right":"left":s==="start"?"bottom":"top";return t.reference[i]>t.floating[i]&&(l=su(l)),[l,su(l)]}function QR(e){const t=su(e);return[Wf(e),t,Wf(t)]}function Wf(e){return e.replace(/start|end/g,t=>VR[t])}const fv=["left","right"],gv=["right","left"],ZR=["top","bottom"],e$=["bottom","top"];function t$(e,t,n){switch(e){case"top":case"bottom":return n?t?gv:fv:t?fv:gv;case"left":case"right":return t?ZR:e$;default:return[]}}function r$(e,t,n,s){const a=Cc(e);let i=t$(zl(e),n==="start",s);return a&&(i=i.map(l=>l+"-"+a),t&&(i=i.concat(i.map(Wf)))),i}function su(e){return e.replace(/left|right|bottom|top/g,t=>YR[t])}function n$(e){return{top:0,right:0,bottom:0,left:0,...e}}function gS(e){return typeof e!="number"?n$(e):{top:e,right:e,bottom:e,left:e}}function au(e){const{x:t,y:n,width:s,height:a}=e;return{width:s,height:a,top:n,left:t,right:t+s,bottom:n+a,x:t,y:n}}var s$=typeof document<"u",a$=function(){},iu=s$?h.useLayoutEffect:a$;const i$={...DC},l$=i$.useInsertionEffect,o$=l$||(e=>e());function c$(e){const t=h.useRef(()=>{});return o$(()=>{t.current=e}),h.useCallback(function(){for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return t.current==null?void 0:t.current(...s)},[])}function xv(e,t,n){let{reference:s,floating:a}=e;const i=Pi(t),l=Px(t),o=Ax(l),c=zl(t),d=i==="y",u=s.x+s.width/2-a.width/2,m=s.y+s.height/2-a.height/2,p=s[o]/2-a[o]/2;let f;switch(c){case"top":f={x:u,y:s.y-a.height};break;case"bottom":f={x:u,y:s.y+s.height};break;case"right":f={x:s.x+s.width,y:m};break;case"left":f={x:s.x-a.width,y:m};break;default:f={x:s.x,y:s.y}}switch(Cc(t)){case"start":f[l]-=p*(n&&d?-1:1);break;case"end":f[l]+=p*(n&&d?-1:1);break}return f}const d$=async(e,t,n)=>{const{placement:s="bottom",strategy:a="absolute",middleware:i=[],platform:l}=n,o=i.filter(Boolean),c=await(l.isRTL==null?void 0:l.isRTL(t));let d=await l.getElementRects({reference:e,floating:t,strategy:a}),{x:u,y:m}=xv(d,s,c),p=s,f={},y=0;for(let g=0;g<o.length;g++){const{name:x,fn:b}=o[g],{x:v,y:w,data:N,reset:k}=await b({x:u,y:m,initialPlacement:s,placement:p,strategy:a,middlewareData:f,rects:d,platform:l,elements:{reference:e,floating:t}});u=v??u,m=w??m,f={...f,[x]:{...f[x],...N}},k&&y<=50&&(y++,typeof k=="object"&&(k.placement&&(p=k.placement),k.rects&&(d=k.rects===!0?await l.getElementRects({reference:e,floating:t,strategy:a}):k.rects),{x:u,y:m}=xv(d,p,c)),g=-1)}return{x:u,y:m,placement:p,strategy:a,middlewareData:f}};async function u$(e,t){var n;t===void 0&&(t={});const{x:s,y:a,platform:i,rects:l,elements:o,strategy:c}=e,{boundary:d="clippingAncestors",rootBoundary:u="viewport",elementContext:m="floating",altBoundary:p=!1,padding:f=0}=im(t,e),y=gS(f),x=o[p?m==="floating"?"reference":"floating":m],b=au(await i.getClippingRect({element:(n=await(i.isElement==null?void 0:i.isElement(x)))==null||n?x:x.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(o.floating)),boundary:d,rootBoundary:u,strategy:c})),v=m==="floating"?{x:s,y:a,width:l.floating.width,height:l.floating.height}:l.reference,w=await(i.getOffsetParent==null?void 0:i.getOffsetParent(o.floating)),N=await(i.isElement==null?void 0:i.isElement(w))?await(i.getScale==null?void 0:i.getScale(w))||{x:1,y:1}:{x:1,y:1},k=au(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:v,offsetParent:w,strategy:c}):v);return{top:(b.top-k.top+y.top)/N.y,bottom:(k.bottom-b.bottom+y.bottom)/N.y,left:(b.left-k.left+y.left)/N.x,right:(k.right-b.right+y.right)/N.x}}const m$=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:s,placement:a,rects:i,platform:l,elements:o,middlewareData:c}=t,{element:d,padding:u=0}=im(e,t)||{};if(d==null)return{};const m=gS(u),p={x:n,y:s},f=Px(a),y=Ax(f),g=await l.getDimensions(d),x=f==="y",b=x?"top":"left",v=x?"bottom":"right",w=x?"clientHeight":"clientWidth",N=i.reference[y]+i.reference[f]-p[f]-i.floating[y],k=p[f]-i.reference[f],j=await(l.getOffsetParent==null?void 0:l.getOffsetParent(d));let S=j?j[w]:0;(!S||!await(l.isElement==null?void 0:l.isElement(j)))&&(S=o.floating[w]||i.floating[y]);const _=N/2-k/2,C=S/2-g[y]/2-1,D=Fl(m[b],C),A=Fl(m[v],C),E=D,T=S-g[y]-A,M=S/2-g[y]/2+_,L=GR(E,M,T),P=!c.arrow&&Cc(a)!=null&&M!==L&&i.reference[y]/2-(M<E?D:A)-g[y]/2<0,$=P?M<E?M-E:M-T:0;return{[f]:p[f]+$,data:{[f]:L,centerOffset:M-L-$,...P&&{alignmentOffset:$}},reset:P}}}),h$=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n,s;const{placement:a,middlewareData:i,rects:l,initialPlacement:o,platform:c,elements:d}=t,{mainAxis:u=!0,crossAxis:m=!0,fallbackPlacements:p,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:g=!0,...x}=im(e,t);if((n=i.arrow)!=null&&n.alignmentOffset)return{};const b=zl(a),v=Pi(o),w=zl(o)===o,N=await(c.isRTL==null?void 0:c.isRTL(d.floating)),k=p||(w||!g?[su(o)]:QR(o)),j=y!=="none";!p&&j&&k.push(...r$(o,g,y,N));const S=[o,...k],_=await u$(t,x),C=[];let D=((s=i.flip)==null?void 0:s.overflows)||[];if(u&&C.push(_[b]),m){const M=JR(a,l,N);C.push(_[M[0]],_[M[1]])}if(D=[...D,{placement:a,overflows:C}],!C.every(M=>M<=0)){var A,E;const M=(((A=i.flip)==null?void 0:A.index)||0)+1,L=S[M];if(L&&(!(m==="alignment"?v!==Pi(L):!1)||D.every(R=>Pi(R.placement)===v?R.overflows[0]>0:!0)))return{data:{index:M,overflows:D},reset:{placement:L}};let P=(E=D.filter($=>$.overflows[0]<=0).sort(($,R)=>$.overflows[1]-R.overflows[1])[0])==null?void 0:E.placement;if(!P)switch(f){case"bestFit":{var T;const $=(T=D.filter(R=>{if(j){const U=Pi(R.placement);return U===v||U==="y"}return!0}).map(R=>[R.placement,R.overflows.filter(U=>U>0).reduce((U,I)=>U+I,0)]).sort((R,U)=>R[1]-U[1])[0])==null?void 0:T[0];$&&(P=$);break}case"initialPlacement":P=o;break}if(a!==P)return{reset:{placement:P}}}return{}}}},p$=new Set(["left","top"]);async function f$(e,t){const{placement:n,platform:s,elements:a}=e,i=await(s.isRTL==null?void 0:s.isRTL(a.floating)),l=zl(n),o=Cc(n),c=Pi(n)==="y",d=p$.has(l)?-1:1,u=i&&c?-1:1,m=im(t,e);let{mainAxis:p,crossAxis:f,alignmentAxis:y}=typeof m=="number"?{mainAxis:m,crossAxis:0,alignmentAxis:null}:{mainAxis:m.mainAxis||0,crossAxis:m.crossAxis||0,alignmentAxis:m.alignmentAxis};return o&&typeof y=="number"&&(f=o==="end"?y*-1:y),c?{x:f*u,y:p*d}:{x:p*d,y:f*u}}const g$=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var n,s;const{x:a,y:i,placement:l,middlewareData:o}=t,c=await f$(t,e);return l===((n=o.offset)==null?void 0:n.placement)&&(s=o.arrow)!=null&&s.alignmentOffset?{}:{x:a+c.x,y:i+c.y,data:{...c,placement:l}}}}};function xS(e){const t=ws(e);let n=parseFloat(t.width)||0,s=parseFloat(t.height)||0;const a=ia(e),i=a?e.offsetWidth:n,l=a?e.offsetHeight:s,o=nu(n)!==i||nu(s)!==l;return o&&(n=i,s=l),{width:n,height:s,$:o}}function Ox(e){return kn(e)?e:e.contextElement}function Sl(e){const t=Ox(e);if(!ia(t))return Zs(1);const n=t.getBoundingClientRect(),{width:s,height:a,$:i}=xS(t);let l=(i?nu(n.width):n.width)/s,o=(i?nu(n.height):n.height)/a;return(!l||!Number.isFinite(l))&&(l=1),(!o||!Number.isFinite(o))&&(o=1),{x:l,y:o}}const x$=Zs(0);function yS(e){const t=es(e);return!Tx()||!t.visualViewport?x$:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function y$(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==es(e)?!1:t}function Ji(e,t,n,s){t===void 0&&(t=!1),n===void 0&&(n=!1);const a=e.getBoundingClientRect(),i=Ox(e);let l=Zs(1);t&&(s?kn(s)&&(l=Sl(s)):l=Sl(e));const o=y$(i,n,s)?yS(i):Zs(0);let c=(a.left+o.x)/l.x,d=(a.top+o.y)/l.y,u=a.width/l.x,m=a.height/l.y;if(i){const p=es(i),f=s&&kn(s)?es(s):s;let y=p,g=Hf(y);for(;g&&s&&f!==y;){const x=Sl(g),b=g.getBoundingClientRect(),v=ws(g),w=b.left+(g.clientLeft+parseFloat(v.paddingLeft))*x.x,N=b.top+(g.clientTop+parseFloat(v.paddingTop))*x.y;c*=x.x,d*=x.y,u*=x.x,m*=x.y,c+=w,d+=N,y=es(g),g=Hf(y)}}return au({width:u,height:m,x:c,y:d})}function lm(e,t){const n=am(e).scrollLeft;return t?t.left+n:Ji(ma(e)).left+n}function bS(e,t){const n=e.getBoundingClientRect(),s=n.left+t.scrollLeft-lm(e,n),a=n.top+t.scrollTop;return{x:s,y:a}}function b$(e){let{elements:t,rect:n,offsetParent:s,strategy:a}=e;const i=a==="fixed",l=ma(s),o=t?sm(t.floating):!1;if(s===l||o&&i)return n;let c={scrollLeft:0,scrollTop:0},d=Zs(1);const u=Zs(0),m=ia(s);if((m||!m&&!i)&&((so(s)!=="body"||Nc(l))&&(c=am(s)),ia(s))){const f=Ji(s);d=Sl(s),u.x=f.x+s.clientLeft,u.y=f.y+s.clientTop}const p=l&&!m&&!i?bS(l,c):Zs(0);return{width:n.width*d.x,height:n.height*d.y,x:n.x*d.x-c.scrollLeft*d.x+u.x+p.x,y:n.y*d.y-c.scrollTop*d.y+u.y+p.y}}function v$(e){return Array.from(e.getClientRects())}function w$(e){const t=ma(e),n=am(e),s=e.ownerDocument.body,a=zi(t.scrollWidth,t.clientWidth,s.scrollWidth,s.clientWidth),i=zi(t.scrollHeight,t.clientHeight,s.scrollHeight,s.clientHeight);let l=-n.scrollLeft+lm(e);const o=-n.scrollTop;return ws(s).direction==="rtl"&&(l+=zi(t.clientWidth,s.clientWidth)-a),{width:a,height:i,x:l,y:o}}const yv=25;function j$(e,t){const n=es(e),s=ma(e),a=n.visualViewport;let i=s.clientWidth,l=s.clientHeight,o=0,c=0;if(a){i=a.width,l=a.height;const u=Tx();(!u||u&&t==="fixed")&&(o=a.offsetLeft,c=a.offsetTop)}const d=lm(s);if(d<=0){const u=s.ownerDocument,m=u.body,p=getComputedStyle(m),f=u.compatMode==="CSS1Compat"&&parseFloat(p.marginLeft)+parseFloat(p.marginRight)||0,y=Math.abs(s.clientWidth-m.clientWidth-f);y<=yv&&(i-=y)}else d<=yv&&(i+=d);return{width:i,height:l,x:o,y:c}}const N$=new Set(["absolute","fixed"]);function C$(e,t){const n=Ji(e,!0,t==="fixed"),s=n.top+e.clientTop,a=n.left+e.clientLeft,i=ia(e)?Sl(e):Zs(1),l=e.clientWidth*i.x,o=e.clientHeight*i.y,c=a*i.x,d=s*i.y;return{width:l,height:o,x:c,y:d}}function bv(e,t,n){let s;if(t==="viewport")s=j$(e,n);else if(t==="document")s=w$(ma(e));else if(kn(t))s=C$(t,n);else{const a=yS(e);s={x:t.x-a.x,y:t.y-a.y,width:t.width,height:t.height}}return au(s)}function vS(e,t){const n=mi(e);return n===t||!kn(n)||$l(n)?!1:ws(n).position==="fixed"||vS(n,t)}function k$(e,t){const n=t.get(e);if(n)return n;let s=ec(e,[],!1).filter(o=>kn(o)&&so(o)!=="body"),a=null;const i=ws(e).position==="fixed";let l=i?mi(e):e;for(;kn(l)&&!$l(l);){const o=ws(l),c=Dx(l);!c&&o.position==="fixed"&&(a=null),(i?!c&&!a:!c&&o.position==="static"&&!!a&&N$.has(a.position)||Nc(l)&&!c&&vS(e,l))?s=s.filter(u=>u!==l):a=o,l=mi(l)}return t.set(e,s),s}function S$(e){let{element:t,boundary:n,rootBoundary:s,strategy:a}=e;const l=[...n==="clippingAncestors"?sm(t)?[]:k$(t,this._c):[].concat(n),s],o=l[0],c=l.reduce((d,u)=>{const m=bv(t,u,a);return d.top=zi(m.top,d.top),d.right=Fl(m.right,d.right),d.bottom=Fl(m.bottom,d.bottom),d.left=zi(m.left,d.left),d},bv(t,o,a));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function _$(e){const{width:t,height:n}=xS(e);return{width:t,height:n}}function E$(e,t,n){const s=ia(t),a=ma(t),i=n==="fixed",l=Ji(e,!0,i,t);let o={scrollLeft:0,scrollTop:0};const c=Zs(0);function d(){c.x=lm(a)}if(s||!s&&!i)if((so(t)!=="body"||Nc(a))&&(o=am(t)),s){const f=Ji(t,!0,i,t);c.x=f.x+t.clientLeft,c.y=f.y+t.clientTop}else a&&d();i&&!s&&a&&d();const u=a&&!s&&!i?bS(a,o):Zs(0),m=l.left+o.scrollLeft-c.x-u.x,p=l.top+o.scrollTop-c.y-u.y;return{x:m,y:p,width:l.width,height:l.height}}function vh(e){return ws(e).position==="static"}function vv(e,t){if(!ia(e)||ws(e).position==="fixed")return null;if(t)return t(e);let n=e.offsetParent;return ma(e)===n&&(n=n.ownerDocument.body),n}function wS(e,t){const n=es(e);if(sm(e))return n;if(!ia(e)){let a=mi(e);for(;a&&!$l(a);){if(kn(a)&&!vh(a))return a;a=mi(a)}return n}let s=vv(e,t);for(;s&&FR(s)&&vh(s);)s=vv(s,t);return s&&$l(s)&&vh(s)&&!Dx(s)?n:s||HR(e)||n}const D$=async function(e){const t=this.getOffsetParent||wS,n=this.getDimensions,s=await n(e.floating);return{reference:E$(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function T$(e){return ws(e).direction==="rtl"}const A$={convertOffsetParentRelativeRectToViewportRelativeRect:b$,getDocumentElement:ma,getClippingRect:S$,getOffsetParent:wS,getElementRects:D$,getClientRects:v$,getDimensions:_$,getScale:Sl,isElement:kn,isRTL:T$};function jS(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function P$(e,t){let n=null,s;const a=ma(e);function i(){var o;clearTimeout(s),(o=n)==null||o.disconnect(),n=null}function l(o,c){o===void 0&&(o=!1),c===void 0&&(c=1),i();const d=e.getBoundingClientRect(),{left:u,top:m,width:p,height:f}=d;if(o||t(),!p||!f)return;const y=Jc(m),g=Jc(a.clientWidth-(u+p)),x=Jc(a.clientHeight-(m+f)),b=Jc(u),w={rootMargin:-y+"px "+-g+"px "+-x+"px "+-b+"px",threshold:zi(0,Fl(1,c))||1};let N=!0;function k(j){const S=j[0].intersectionRatio;if(S!==c){if(!N)return l();S?l(!1,S):s=setTimeout(()=>{l(!1,1e-7)},1e3)}S===1&&!jS(d,e.getBoundingClientRect())&&l(),N=!1}try{n=new IntersectionObserver(k,{...w,root:a.ownerDocument})}catch{n=new IntersectionObserver(k,w)}n.observe(e)}return l(!0),i}function O$(e,t,n,s){s===void 0&&(s={});const{ancestorScroll:a=!0,ancestorResize:i=!0,elementResize:l=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:c=!1}=s,d=Ox(e),u=a||i?[...d?ec(d):[],...ec(t)]:[];u.forEach(b=>{a&&b.addEventListener("scroll",n,{passive:!0}),i&&b.addEventListener("resize",n)});const m=d&&o?P$(d,n):null;let p=-1,f=null;l&&(f=new ResizeObserver(b=>{let[v]=b;v&&v.target===d&&f&&(f.unobserve(t),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{var w;(w=f)==null||w.observe(t)})),n()}),d&&!c&&f.observe(d),f.observe(t));let y,g=c?Ji(e):null;c&&x();function x(){const b=Ji(e);g&&!jS(g,b)&&n(),g=b,y=requestAnimationFrame(x)}return n(),()=>{var b;u.forEach(v=>{a&&v.removeEventListener("scroll",n),i&&v.removeEventListener("resize",n)}),m==null||m(),(b=f)==null||b.disconnect(),f=null,c&&cancelAnimationFrame(y)}}const M$=g$,I$=h$,wv=m$,L$=(e,t,n)=>{const s=new Map,a={platform:A$,...n},i={...a.platform,_c:s};return d$(e,t,{...a,platform:i})};var R$=typeof document<"u",$$=function(){},Od=R$?h.useLayoutEffect:$$;function lu(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,s,a;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(s=n;s--!==0;)if(!lu(e[s],t[s]))return!1;return!0}if(a=Object.keys(e),n=a.length,n!==Object.keys(t).length)return!1;for(s=n;s--!==0;)if(!{}.hasOwnProperty.call(t,a[s]))return!1;for(s=n;s--!==0;){const i=a[s];if(!(i==="_owner"&&e.$$typeof)&&!lu(e[i],t[i]))return!1}return!0}return e!==e&&t!==t}function NS(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function jv(e,t){const n=NS(e);return Math.round(t*n)/n}function wh(e){const t=h.useRef(e);return Od(()=>{t.current=e}),t}function F$(e){e===void 0&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:s=[],platform:a,elements:{reference:i,floating:l}={},transform:o=!0,whileElementsMounted:c,open:d}=e,[u,m]=h.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[p,f]=h.useState(s);lu(p,s)||f(s);const[y,g]=h.useState(null),[x,b]=h.useState(null),v=h.useCallback(R=>{R!==j.current&&(j.current=R,g(R))},[]),w=h.useCallback(R=>{R!==S.current&&(S.current=R,b(R))},[]),N=i||y,k=l||x,j=h.useRef(null),S=h.useRef(null),_=h.useRef(u),C=c!=null,D=wh(c),A=wh(a),E=wh(d),T=h.useCallback(()=>{if(!j.current||!S.current)return;const R={placement:t,strategy:n,middleware:p};A.current&&(R.platform=A.current),L$(j.current,S.current,R).then(U=>{const I={...U,isPositioned:E.current!==!1};M.current&&!lu(_.current,I)&&(_.current=I,eo.flushSync(()=>{m(I)}))})},[p,t,n,A,E]);Od(()=>{d===!1&&_.current.isPositioned&&(_.current.isPositioned=!1,m(R=>({...R,isPositioned:!1})))},[d]);const M=h.useRef(!1);Od(()=>(M.current=!0,()=>{M.current=!1}),[]),Od(()=>{if(N&&(j.current=N),k&&(S.current=k),N&&k){if(D.current)return D.current(N,k,T);T()}},[N,k,T,D,C]);const L=h.useMemo(()=>({reference:j,floating:S,setReference:v,setFloating:w}),[v,w]),P=h.useMemo(()=>({reference:N,floating:k}),[N,k]),$=h.useMemo(()=>{const R={position:n,left:0,top:0};if(!P.floating)return R;const U=jv(P.floating,u.x),I=jv(P.floating,u.y);return o?{...R,transform:"translate("+U+"px, "+I+"px)",...NS(P.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:U,top:I}},[n,o,P.floating,u.x,u.y]);return h.useMemo(()=>({...u,update:T,refs:L,elements:P,floatingStyles:$}),[u,T,L,P,$])}const z$=e=>{function t(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:e,fn(n){const{element:s,padding:a}=typeof e=="function"?e(n):e;return s&&t(s)?s.current!=null?wv({element:s.current,padding:a}).fn(n):{}:s?wv({element:s,padding:a}).fn(n):{}}}},B$=(e,t)=>({...M$(e),options:[e,t]}),U$=(e,t)=>({...I$(e),options:[e,t]}),q$=(e,t)=>({...z$(e),options:[e,t]}),H$={...DC};let Nv=!1,W$=0;const Cv=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+W$++;function Y$(){const[e,t]=h.useState(()=>Nv?Cv():void 0);return iu(()=>{e==null&&t(Cv())},[]),h.useEffect(()=>{Nv=!0},[]),e}const V$=H$.useId,CS=V$||Y$,G$=h.forwardRef(function(t,n){const{context:{placement:s,elements:{floating:a},middlewareData:{arrow:i,shift:l}},width:o=14,height:c=7,tipRadius:d=0,strokeWidth:u=0,staticOffset:m,stroke:p,d:f,style:{transform:y,...g}={},...x}=t,b=CS(),[v,w]=h.useState(!1);if(iu(()=>{if(!a)return;ws(a).direction==="rtl"&&w(!0)},[a]),!a)return null;const[N,k]=s.split("-"),j=N==="top"||N==="bottom";let S=m;(j&&l!=null&&l.x||!j&&l!=null&&l.y)&&(S=null);const _=u*2,C=_/2,D=o/2*(d/-8+1),A=c/2*d/4,E=!!f,T=S&&k==="end"?"bottom":"top";let M=S&&k==="end"?"right":"left";S&&v&&(M=k==="end"?"left":"right");const L=(i==null?void 0:i.x)!=null?S||i.x:"",P=(i==null?void 0:i.y)!=null?S||i.y:"",$=f||"M0,0"+(" H"+o)+(" L"+(o-D)+","+(c-A))+(" Q"+o/2+","+c+" "+D+","+(c-A))+" Z",R={top:E?"rotate(180deg)":"",left:E?"rotate(90deg)":"rotate(-90deg)",bottom:E?"":"rotate(180deg)",right:E?"rotate(-90deg)":"rotate(90deg)"}[N];return r.jsxs("svg",{...x,"aria-hidden":!0,ref:n,width:E?o:o+_,height:o,viewBox:"0 0 "+o+" "+(c>o?c:o),style:{position:"absolute",pointerEvents:"none",[M]:L,[T]:P,[N]:j||E?"100%":"calc(100% - "+_/2+"px)",transform:[R,y].filter(U=>!!U).join(" "),...g},children:[_>0&&r.jsx("path",{clipPath:"url(#"+b+")",fill:"none",stroke:p,strokeWidth:_+(f?0:1),d:$}),r.jsx("path",{stroke:_&&!f?x.fill:"none",d:$}),r.jsx("clipPath",{id:b,children:r.jsx("rect",{x:-C,y:C*(E?-1:1),width:o+_,height:o})})]})});function K$(){const e=new Map;return{emit(t,n){var s;(s=e.get(t))==null||s.forEach(a=>a(n))},on(t,n){e.has(t)||e.set(t,new Set),e.get(t).add(n)},off(t,n){var s;(s=e.get(t))==null||s.delete(n)}}}const X$=h.createContext(null),J$=h.createContext(null),Q$=()=>{var e;return((e=h.useContext(X$))==null?void 0:e.id)||null},Z$=()=>h.useContext(J$);function eF(e){const{open:t=!1,onOpenChange:n,elements:s}=e,a=CS(),i=h.useRef({}),[l]=h.useState(()=>K$()),o=Q$()!=null,[c,d]=h.useState(s.reference),u=c$((f,y,g)=>{i.current.openEvent=f?y:void 0,l.emit("openchange",{open:f,event:y,reason:g,nested:o}),n==null||n(f,y,g)}),m=h.useMemo(()=>({setPositionReference:d}),[]),p=h.useMemo(()=>({reference:c||s.reference||null,floating:s.floating||null,domReference:s.reference}),[c,s.reference,s.floating]);return h.useMemo(()=>({dataRef:i,open:t,onOpenChange:u,elements:p,events:l,floatingId:a,refs:m}),[t,u,p,l,a,m])}function tF(e){e===void 0&&(e={});const{nodeId:t}=e,n=eF({...e,elements:{reference:null,floating:null,...e.elements}}),s=e.rootContext||n,a=s.elements,[i,l]=h.useState(null),[o,c]=h.useState(null),u=(a==null?void 0:a.domReference)||i,m=h.useRef(null),p=Z$();iu(()=>{u&&(m.current=u)},[u]);const f=F$({...e,elements:{...a,...o&&{reference:o}}}),y=h.useCallback(w=>{const N=kn(w)?{getBoundingClientRect:()=>w.getBoundingClientRect(),getClientRects:()=>w.getClientRects(),contextElement:w}:w;c(N),f.refs.setReference(N)},[f.refs]),g=h.useCallback(w=>{(kn(w)||w===null)&&(m.current=w,l(w)),(kn(f.refs.reference.current)||f.refs.reference.current===null||w!==null&&!kn(w))&&f.refs.setReference(w)},[f.refs]),x=h.useMemo(()=>({...f.refs,setReference:g,setPositionReference:y,domReference:m}),[f.refs,g,y]),b=h.useMemo(()=>({...f.elements,domReference:u}),[f.elements,u]),v=h.useMemo(()=>({...f,...s,refs:x,elements:b,nodeId:t}),[f,x,b,t,s]);return iu(()=>{s.dataRef.current.floatingContext=v;const w=p==null?void 0:p.nodesRef.current.find(N=>N.id===t);w&&(w.context=v)}),h.useMemo(()=>({...f,context:v,refs:x,elements:b}),[f,x,b,v])}/*!
  react-datepicker v8.7.0
  https://github.com/Hacker0x01/react-datepicker
  Released under the MIT License.
*/var Yf=function(t,n){return Yf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,a){s.__proto__=a}||function(s,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(s[i]=a[i])},Yf(t,n)};function pn(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Yf(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var Rt=function(){return Rt=Object.assign||function(n){for(var s,a=1,i=arguments.length;a<i;a++){s=arguments[a];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(n[l]=s[l])}return n},Rt.apply(this,arguments)};function Xs(e,t,n){if(n||arguments.length===2)for(var s=0,a=t.length,i;s<a;s++)(i||!(s in t))&&(i||(i=Array.prototype.slice.call(t,0,s)),i[s]=t[s]);return e.concat(i||Array.prototype.slice.call(t))}var rF=function(e){var t=e.showTimeSelectOnly,n=t===void 0?!1:t,s=e.showTime,a=s===void 0?!1:s,i=e.className,l=e.children,o=n?"Choose Time":"Choose Date".concat(a?" and Time":"");return le.createElement("div",{className:i,role:"dialog","aria-label":o,"aria-modal":"true"},l)},nF=function(e,t){var n=h.useRef(null),s=h.useRef(e);s.current=e;var a=h.useCallback(function(i){var l,o=i.composed&&i.composedPath&&i.composedPath().find(function(c){return c instanceof Node})||i.target;n.current&&!n.current.contains(o)&&(t&&o instanceof HTMLElement&&o.classList.contains(t)||(l=s.current)===null||l===void 0||l.call(s,i))},[t]);return h.useEffect(function(){return document.addEventListener("mousedown",a),function(){document.removeEventListener("mousedown",a)}},[a]),n},om=function(e){var t=e.children,n=e.onClickOutside,s=e.className,a=e.containerRef,i=e.style,l=e.ignoreClass,o=nF(n,l);return le.createElement("div",{className:s,style:i,ref:function(c){o.current=c,a&&(a.current=c)}},t)},Ge;(function(e){e.ArrowUp="ArrowUp",e.ArrowDown="ArrowDown",e.ArrowLeft="ArrowLeft",e.ArrowRight="ArrowRight",e.PageUp="PageUp",e.PageDown="PageDown",e.Home="Home",e.End="End",e.Enter="Enter",e.Space=" ",e.Tab="Tab",e.Escape="Escape",e.Backspace="Backspace",e.X="x"})(Ge||(Ge={}));function kS(){var e=typeof window<"u"?window:globalThis;return e}var kc=12;function er(e){if(e==null)return new Date;var t=typeof e=="string"?wR(e):ct(e);return cm(t)?t:new Date}function jh(e,t,n,s,a){a===void 0&&(a=er());for(var i=Bl(n)||Bl(Mx()),l=Array.isArray(t)?t:[t],o=0,c=l;o<c.length;o++){var d=c[o],u=fR(e,d,a,{locale:i});if(cm(u)&&(!s||e===br(u,d,n)))return u}return null}function cm(e,t){return Jd(e)&&!Ks(e,new Date("1/1/1800"))}function br(e,t,n){if(n==="en")return tu(e,t,{useAdditionalWeekYearTokens:!0,useAdditionalDayOfYearTokens:!0});var s=n?Bl(n):void 0;return n&&!s&&console.warn('A locale object was not found for the provided string ["'.concat(n,'"].')),s=s||Bl(Mx()),tu(e,t,{locale:s,useAdditionalWeekYearTokens:!0,useAdditionalDayOfYearTokens:!0})}function os(e,t){var n=t.dateFormat,s=t.locale,a=Array.isArray(n)&&n.length>0?n[0]:n;return e&&br(e,a,s)||""}var SS=" - ";function sF(e,t,n){if(!e&&!t)return"";var s=e?os(e,n):"",a=t?os(t,n):"",i=n.rangeSeparator||SS;return"".concat(s).concat(i).concat(a)}function aF(e,t){if(!(e!=null&&e.length))return"";var n=e[0]?os(e[0],t):"";if(e.length===1)return n;if(e.length===2&&e[1]){var s=os(e[1],t);return"".concat(n,", ").concat(s)}var a=e.length-1;return"".concat(n," (+").concat(a,")")}function Nh(e,t){var n=t.hour,s=n===void 0?0:n,a=t.minute,i=a===void 0?0:a,l=t.second,o=l===void 0?0:l;return Td(Ad(Pd(e,o),i),s)}function iF(e){return kx(e)}function lF(e,t){return br(e,"ddd",t)}function Md(e){return Qs(e)}function ii(e,t,n){var s=Bl(t||Mx());return Aa(e,{locale:s,weekStartsOn:n})}function ka(e){return nS(e)}function Fo(e){return rm(e)}function kv(e){return Bf(e)}function Sv(){return Qs(er())}function _v(e){return Cx(e)}function oF(e){return w6(e)}function cF(e){return rS(e)}function Ws(e,t){return e&&t?bR(e,t):!e&&!t}function Cn(e,t){return e&&t?xR(e,t):!e&&!t}function ou(e,t){return e&&t?yR(e,t):!e&&!t}function Lt(e,t){return e&&t?b6(e,t):!e&&!t}function Oi(e,t){return e&&t?vL(e,t):!e&&!t}function Ei(e,t,n){var s,a=Qs(t),i=Cx(n);try{s=Zo(e,{start:a,end:i})}catch{s=!1}return s}function Mx(){var e=kS();return e.__localeId__}function Bl(e){if(typeof e=="string"){var t=kS();return t.__localeData__?t.__localeData__[e]:void 0}else return e}function dF(e,t,n){return t(br(e,"EEEE",n))}function uF(e,t){return br(e,"EEEEEE",t)}function mF(e,t){return br(e,"EEE",t)}function Ix(e,t){return br(cs(er(),e),"LLLL",t)}function _S(e,t){return br(cs(er(),e),"LLL",t)}function hF(e,t){return br(vl(er(),e),"QQQ",t)}function us(e,t){var n=t===void 0?{}:t,s=n.minDate,a=n.maxDate,i=n.excludeDates,l=n.excludeDateIntervals,o=n.includeDates,c=n.includeDateIntervals,d=n.filterDate;return Sc(e,{minDate:s,maxDate:a})||i&&i.some(function(u){return u instanceof Date?Lt(e,u):Lt(e,u.date)})||l&&l.some(function(u){var m=u.start,p=u.end;return Zo(e,{start:m,end:p})})||o&&!o.some(function(u){return Lt(e,u)})||c&&!c.some(function(u){var m=u.start,p=u.end;return Zo(e,{start:m,end:p})})||d&&!d(er(e))||!1}function Lx(e,t){var n=t===void 0?{}:t,s=n.excludeDates,a=n.excludeDateIntervals;return a&&a.length>0?a.some(function(i){var l=i.start,o=i.end;return Zo(e,{start:l,end:o})}):s&&s.some(function(i){var l;return i instanceof Date?Lt(e,i):Lt(e,(l=i.date)!==null&&l!==void 0?l:new Date)})||!1}function ES(e,t){var n=t===void 0?{}:t,s=n.minDate,a=n.maxDate,i=n.excludeDates,l=n.includeDates,o=n.filterDate;return Sc(e,{minDate:s?nS(s):void 0,maxDate:a?rS(a):void 0})||(i==null?void 0:i.some(function(c){return Cn(e,c instanceof Date?c:c.date)}))||l&&!l.some(function(c){return Cn(e,c)})||o&&!o(er(e))||!1}function Qc(e,t,n,s){var a=Tt(e),i=bn(e),l=Tt(t),o=bn(t),c=Tt(s);return a===l&&a===c?i<=n&&n<=o:a<l?c===a&&i<=n||c===l&&o>=n||c<l&&c>a:!1}function pF(e,t){var n=t===void 0?{}:t,s=n.minDate,a=n.maxDate,i=n.excludeDates,l=n.includeDates;return Sc(e,{minDate:s,maxDate:a})||i&&i.some(function(o){return Cn(o instanceof Date?o:o.date,e)})||l&&!l.some(function(o){return Cn(o,e)})||!1}function Zc(e,t){var n=t===void 0?{}:t,s=n.minDate,a=n.maxDate,i=n.excludeDates,l=n.includeDates,o=n.filterDate;return Sc(e,{minDate:s,maxDate:a})||(i==null?void 0:i.some(function(c){return ou(e,c instanceof Date?c:c.date)}))||l&&!l.some(function(c){return ou(e,c)})||o&&!o(er(e))||!1}function ed(e,t,n){if(!t||!n||!Jd(t)||!Jd(n))return!1;var s=Tt(t),a=Tt(n);return s<=e&&a>=e}function Id(e,t){var n=t===void 0?{}:t,s=n.minDate,a=n.maxDate,i=n.excludeDates,l=n.includeDates,o=n.filterDate,c=new Date(e,0,1);return Sc(c,{minDate:s?rm(s):void 0,maxDate:a?sS(a):void 0})||(i==null?void 0:i.some(function(d){return Ws(c,d instanceof Date?d:d.date)}))||l&&!l.some(function(d){return Ws(c,d)})||o&&!o(er(c))||!1}function td(e,t,n,s){var a=Tt(e),i=Fi(e),l=Tt(t),o=Fi(t),c=Tt(s);return a===l&&a===c?i<=n&&n<=o:a<l?c===a&&i<=n||c===l&&o>=n||c<l&&c>a:!1}function Sc(e,t){var n,s=t===void 0?{}:t,a=s.minDate,i=s.maxDate;return(n=a&&Rl(e,a)<0||i&&Rl(e,i)>0)!==null&&n!==void 0?n:!1}function Ev(e,t){return t.some(function(n){return ja(n)===ja(e)&&Na(n)===Na(e)&&ai(n)===ai(e)})}function Dv(e,t){var n=t===void 0?{}:t,s=n.excludeTimes,a=n.includeTimes,i=n.filterTime;return s&&Ev(e,s)||a&&!Ev(e,a)||i&&!i(e)||!1}function Tv(e,t){var n=t.minTime,s=t.maxTime;if(!n||!s)throw new Error("Both minTime and maxTime props required");var a=er();a=Td(a,ja(e)),a=Ad(a,Na(e)),a=Pd(a,ai(e));var i=er();i=Td(i,ja(n)),i=Ad(i,Na(n)),i=Pd(i,ai(n));var l=er();l=Td(l,ja(s)),l=Ad(l,Na(s)),l=Pd(l,ai(s));var o;try{o=!Zo(a,{start:i,end:l})}catch{o=!1}return o}function Av(e,t){var n=t===void 0?{}:t,s=n.minDate,a=n.includeDates,i=Ca(e,1);return s&&Qd(s,i)>0||a&&a.every(function(l){return Qd(l,i)>0})||!1}function Pv(e,t){var n=t===void 0?{}:t,s=n.maxDate,a=n.includeDates,i=$s(e,1);return s&&Qd(i,s)>0||a&&a.every(function(l){return Qd(i,l)>0})||!1}function fF(e,t){var n=t===void 0?{}:t,s=n.minDate,a=n.includeDates,i=rm(e),l=hS(i);return s&&Zd(s,l)>0||a&&a.every(function(o){return Zd(o,l)>0})||!1}function gF(e,t){var n=t===void 0?{}:t,s=n.maxDate,a=n.includeDates,i=sS(e),l=Nx(i,1);return s&&Zd(l,s)>0||a&&a.every(function(o){return Zd(l,o)>0})||!1}function Ov(e,t){var n=t===void 0?{}:t,s=n.minDate,a=n.includeDates,i=Xi(e,1);return s&&eu(s,i)>0||a&&a.every(function(l){return eu(l,i)>0})||!1}function xF(e,t){var n=t===void 0?{}:t,s=n.minDate,a=n.yearItemNumber,i=a===void 0?kc:a,l=Fo(Xi(e,i)),o=xa(l,i).endPeriod,c=s&&Tt(s);return c&&c>o||!1}function Mv(e,t){var n=t===void 0?{}:t,s=n.maxDate,a=n.includeDates,i=va(e,1);return s&&eu(i,s)>0||a&&a.every(function(l){return eu(i,l)>0})||!1}function yF(e,t){var n=t===void 0?{}:t,s=n.maxDate,a=n.yearItemNumber,i=a===void 0?kc:a,l=va(e,i),o=xa(l,i).startPeriod,c=s&&Tt(s);return c&&c<o||!1}function DS(e){var t=e.minDate,n=e.includeDates;if(n&&t){var s=n.filter(function(a){return Rl(a,t)>=0});return iv(s)}else return n?iv(n):t}function TS(e){var t=e.maxDate,n=e.includeDates;if(n&&t){var s=n.filter(function(a){return Rl(a,t)<=0});return av(s)}else return n?av(n):t}function Iv(e,t){var n;e===void 0&&(e=[]),t===void 0&&(t="react-datepicker__day--highlighted");for(var s=new Map,a=0,i=e.length;a<i;a++){var l=e[a];if(wa(l)){var o=br(l,"MM.dd.yyyy"),c=s.get(o)||[];c.includes(t)||(c.push(t),s.set(o,c))}else if(typeof l=="object"){var d=Object.keys(l),u=(n=d[0])!==null&&n!==void 0?n:"",m=l[u];if(typeof u=="string"&&Array.isArray(m))for(var p=0,f=m.length;p<f;p++){var y=m[p];if(y){var o=br(y,"MM.dd.yyyy"),c=s.get(o)||[];c.includes(u)||(c.push(u),s.set(o,c))}}}}return s}function bF(e,t){return e.length!==t.length?!1:e.every(function(n,s){return n===t[s]})}function vF(e,t){e===void 0&&(e=[]),t===void 0&&(t="react-datepicker__day--holidays");var n=new Map;return e.forEach(function(s){var a=s.date,i=s.holidayName;if(wa(a)){var l=br(a,"MM.dd.yyyy"),o=n.get(l)||{className:"",holidayNames:[]};if(!("className"in o&&o.className===t&&bF(o.holidayNames,[i]))){o.className=t;var c=o.holidayNames;o.holidayNames=c?Xs(Xs([],c,!0),[i],!1):[i],n.set(l,o)}}}),n}function wF(e,t,n,s,a){for(var i=a.length,l=[],o=0;o<i;o++){var c=e,d=a[o];d&&(c=f6(c,ja(d)),c=zf(c,Na(d)),c=y6(c,ai(d)));var u=zf(e,(n+1)*s);ui(c,t)&&Ks(c,u)&&d!=null&&l.push(d)}return l}function Lv(e){return e<10?"0".concat(e):"".concat(e)}function xa(e,t){t===void 0&&(t=kc);var n=Math.ceil(Tt(e)/t)*t,s=n-(t-1);return{startPeriod:s,endPeriod:n}}function jF(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),24);return Math.round((+n-+t)/36e5)}function Rv(e){var t=e.getSeconds(),n=e.getMilliseconds();return ct(e.getTime()-t*1e3-n)}function NF(e,t){return Rv(e).getTime()===Rv(t).getTime()}function $v(e){if(!wa(e))throw new Error("Invalid date");var t=new Date(e);return t.setHours(0,0,0,0),t}function Ch(e,t){if(!wa(e)||!wa(t))throw new Error("Invalid date received");var n=$v(e),s=$v(t);return Ks(n,s)}function AS(e){return e.key===Ge.Space}var CF=function(e){pn(t,e);function t(n){var s=e.call(this,n)||this;return s.inputRef=le.createRef(),s.onTimeChange=function(a){var i,l;s.setState({time:a});var o=s.props.date,c=o instanceof Date&&!isNaN(+o),d=c?o:new Date;if(a!=null&&a.includes(":")){var u=a.split(":"),m=u[0],p=u[1];d.setHours(Number(m)),d.setMinutes(Number(p))}(l=(i=s.props).onChange)===null||l===void 0||l.call(i,d)},s.renderTimeInput=function(){var a=s.state.time,i=s.props,l=i.date,o=i.timeString,c=i.customTimeInput;return c?h.cloneElement(c,{date:l,value:a,onChange:s.onTimeChange}):le.createElement("input",{type:"time",className:"react-datepicker-time__input",placeholder:"Time",name:"time-input",ref:s.inputRef,onClick:function(){var d;(d=s.inputRef.current)===null||d===void 0||d.focus()},required:!0,value:a,onChange:function(d){s.onTimeChange(d.target.value||o)}})},s.state={time:s.props.timeString},s}return t.getDerivedStateFromProps=function(n,s){return n.timeString!==s.time?{time:n.timeString}:null},t.prototype.render=function(){return le.createElement("div",{className:"react-datepicker__input-time-container"},le.createElement("div",{className:"react-datepicker-time__caption"},this.props.timeInputLabel),le.createElement("div",{className:"react-datepicker-time__input-container"},le.createElement("div",{className:"react-datepicker-time__input"},this.renderTimeInput())))},t}(h.Component),kF=function(e){pn(t,e);function t(){var n=e!==null&&e.apply(this,arguments)||this;return n.dayEl=h.createRef(),n.handleClick=function(s){!n.isDisabled()&&n.props.onClick&&n.props.onClick(s)},n.handleMouseEnter=function(s){!n.isDisabled()&&n.props.onMouseEnter&&n.props.onMouseEnter(s)},n.handleOnKeyDown=function(s){var a,i,l=s.key;l===Ge.Space&&(s.preventDefault(),s.key=Ge.Enter),(i=(a=n.props).handleOnKeyDown)===null||i===void 0||i.call(a,s)},n.isSameDay=function(s){return Lt(n.props.day,s)},n.isKeyboardSelected=function(){var s;if(n.props.disabledKeyboardNavigation)return!1;var a=n.props.selectsMultiple?(s=n.props.selectedDates)===null||s===void 0?void 0:s.some(function(l){return n.isSameDayOrWeek(l)}):n.isSameDayOrWeek(n.props.selected),i=n.props.preSelection&&n.isDisabled(n.props.preSelection);return!a&&n.isSameDayOrWeek(n.props.preSelection)&&!i},n.isDisabled=function(s){return s===void 0&&(s=n.props.day),us(s,{minDate:n.props.minDate,maxDate:n.props.maxDate,excludeDates:n.props.excludeDates,excludeDateIntervals:n.props.excludeDateIntervals,includeDateIntervals:n.props.includeDateIntervals,includeDates:n.props.includeDates,filterDate:n.props.filterDate})},n.isExcluded=function(){return Lx(n.props.day,{excludeDates:n.props.excludeDates,excludeDateIntervals:n.props.excludeDateIntervals})},n.isStartOfWeek=function(){return Lt(n.props.day,ii(n.props.day,n.props.locale,n.props.calendarStartDay))},n.isSameWeek=function(s){return n.props.showWeekPicker&&Lt(s,ii(n.props.day,n.props.locale,n.props.calendarStartDay))},n.isSameDayOrWeek=function(s){return n.isSameDay(s)||n.isSameWeek(s)},n.getHighLightedClass=function(){var s=n.props,a=s.day,i=s.highlightDates;if(!i)return!1;var l=br(a,"MM.dd.yyyy");return i.get(l)},n.getHolidaysClass=function(){var s,a=n.props,i=a.day,l=a.holidays;if(!l)return[void 0];var o=br(i,"MM.dd.yyyy");return l.has(o)?[(s=l.get(o))===null||s===void 0?void 0:s.className]:[void 0]},n.isInRange=function(){var s=n.props,a=s.day,i=s.startDate,l=s.endDate;return!i||!l?!1:Ei(a,i,l)},n.isInSelectingRange=function(){var s,a=n.props,i=a.day,l=a.selectsStart,o=a.selectsEnd,c=a.selectsRange,d=a.selectsDisabledDaysInRange,u=a.startDate,m=a.swapRange,p=a.endDate,f=(s=n.props.selectingDate)!==null&&s!==void 0?s:n.props.preSelection;if(!(l||o||c)||!f||!d&&n.isDisabled())return!1;if(l&&p&&(Ks(f,p)||Oi(f,p)))return Ei(i,f,p);if(o&&u&&(ui(f,u)||Oi(f,u)))return Ei(i,u,f);if(c&&u&&!p){if(Oi(f,u)||ui(f,u))return Ei(i,u,f);if(m&&Ks(f,u))return Ei(i,f,u)}return!1},n.isSelectingRangeStart=function(){var s;if(!n.isInSelectingRange())return!1;var a=n.props,i=a.day,l=a.startDate,o=a.selectsStart,c=a.swapRange,d=a.selectsRange,u=(s=n.props.selectingDate)!==null&&s!==void 0?s:n.props.preSelection;return o?Lt(i,u):d&&c&&l&&u?Lt(i,Ks(u,l)?u:l):Lt(i,l)},n.isSelectingRangeEnd=function(){var s;if(!n.isInSelectingRange())return!1;var a=n.props,i=a.day,l=a.endDate,o=a.selectsEnd,c=a.selectsRange,d=a.swapRange,u=a.startDate,m=(s=n.props.selectingDate)!==null&&s!==void 0?s:n.props.preSelection;return o?Lt(i,m):c&&d&&u&&m?Lt(i,Ks(m,u)?u:m):c?Lt(i,m):Lt(i,l)},n.isRangeStart=function(){var s=n.props,a=s.day,i=s.startDate,l=s.endDate;return!i||!l?!1:Lt(i,a)},n.isRangeEnd=function(){var s=n.props,a=s.day,i=s.startDate,l=s.endDate;return!i||!l?!1:Lt(l,a)},n.isWeekend=function(){var s=gL(n.props.day);return s===0||s===6},n.isAfterMonth=function(){return n.props.month!==void 0&&(n.props.month+1)%12===bn(n.props.day)},n.isBeforeMonth=function(){return n.props.month!==void 0&&(bn(n.props.day)+1)%12===n.props.month},n.isCurrentDay=function(){return n.isSameDay(er())},n.isSelected=function(){var s;return n.props.selectsMultiple?(s=n.props.selectedDates)===null||s===void 0?void 0:s.some(function(a){return n.isSameDayOrWeek(a)}):n.isSameDayOrWeek(n.props.selected)},n.getClassNames=function(s){var a=n.props.dayClassName?n.props.dayClassName(s):void 0;return xt("react-datepicker__day",a,"react-datepicker__day--"+lF(n.props.day),{"react-datepicker__day--disabled":n.isDisabled(),"react-datepicker__day--excluded":n.isExcluded(),"react-datepicker__day--selected":n.isSelected(),"react-datepicker__day--keyboard-selected":n.isKeyboardSelected(),"react-datepicker__day--range-start":n.isRangeStart(),"react-datepicker__day--range-end":n.isRangeEnd(),"react-datepicker__day--in-range":n.isInRange(),"react-datepicker__day--in-selecting-range":n.isInSelectingRange(),"react-datepicker__day--selecting-range-start":n.isSelectingRangeStart(),"react-datepicker__day--selecting-range-end":n.isSelectingRangeEnd(),"react-datepicker__day--today":n.isCurrentDay(),"react-datepicker__day--weekend":n.isWeekend(),"react-datepicker__day--outside-month":n.isAfterMonth()||n.isBeforeMonth()},n.getHighLightedClass(),n.getHolidaysClass())},n.getAriaLabel=function(){var s=n.props,a=s.day,i=s.ariaLabelPrefixWhenEnabled,l=i===void 0?"Choose":i,o=s.ariaLabelPrefixWhenDisabled,c=o===void 0?"Not available":o,d=n.isDisabled()||n.isExcluded()?c:l;return"".concat(d," ").concat(br(a,"PPPP",n.props.locale))},n.getTitle=function(){var s=n.props,a=s.day,i=s.holidays,l=i===void 0?new Map:i,o=s.excludeDates,c=br(a,"MM.dd.yyyy"),d=[];return l.has(c)&&d.push.apply(d,l.get(c).holidayNames),n.isExcluded()&&d.push(o==null?void 0:o.filter(function(u){return u instanceof Date?Lt(u,a):Lt(u==null?void 0:u.date,a)}).map(function(u){if(!(u instanceof Date))return u==null?void 0:u.message})),d.join(", ")},n.getTabIndex=function(){var s=n.props.selected,a=n.props.preSelection,i=!(n.props.showWeekPicker&&(n.props.showWeekNumber||!n.isStartOfWeek()))&&(n.isKeyboardSelected()||n.isSameDay(s)&&Lt(a,s))?0:-1;return i},n.handleFocusDay=function(){var s;n.shouldFocusDay()&&((s=n.dayEl.current)===null||s===void 0||s.focus({preventScroll:!0}))},n.renderDayContents=function(){return n.props.monthShowsDuplicateDaysEnd&&n.isAfterMonth()||n.props.monthShowsDuplicateDaysStart&&n.isBeforeMonth()?null:n.props.renderDayContents?n.props.renderDayContents(mv(n.props.day),n.props.day):mv(n.props.day)},n.render=function(){return le.createElement("div",{ref:n.dayEl,className:n.getClassNames(n.props.day),onKeyDown:n.handleOnKeyDown,onClick:n.handleClick,onMouseEnter:n.props.usePointerEvent?void 0:n.handleMouseEnter,onPointerEnter:n.props.usePointerEvent?n.handleMouseEnter:void 0,tabIndex:n.getTabIndex(),"aria-label":n.getAriaLabel(),role:"gridcell",title:n.getTitle(),"aria-disabled":n.isDisabled(),"aria-current":n.isCurrentDay()?"date":void 0,"aria-selected":n.isSelected()||n.isInRange()},n.renderDayContents(),n.getTitle()!==""&&le.createElement("span",{className:"overlay"},n.getTitle()))},n}return t.prototype.componentDidMount=function(){this.handleFocusDay()},t.prototype.componentDidUpdate=function(){this.handleFocusDay()},t.prototype.shouldFocusDay=function(){var n=!1;return this.getTabIndex()===0&&this.isSameDay(this.props.preSelection)&&((!document.activeElement||document.activeElement===document.body)&&(n=!0),this.props.inline&&!this.props.shouldFocusDayInline&&(n=!1),this.isDayActiveElement()&&(n=!0),this.isDuplicateDay()&&(n=!1)),n},t.prototype.isDayActiveElement=function(){var n,s,a;return((s=(n=this.props.containerRef)===null||n===void 0?void 0:n.current)===null||s===void 0?void 0:s.contains(document.activeElement))&&((a=document.activeElement)===null||a===void 0?void 0:a.classList.contains("react-datepicker__day"))},t.prototype.isDuplicateDay=function(){return this.props.monthShowsDuplicateDaysEnd&&this.isAfterMonth()||this.props.monthShowsDuplicateDaysStart&&this.isBeforeMonth()},t}(h.Component),SF=function(e){pn(t,e);function t(){var n=e!==null&&e.apply(this,arguments)||this;return n.weekNumberEl=h.createRef(),n.handleClick=function(s){n.props.onClick&&n.props.onClick(s)},n.handleOnKeyDown=function(s){var a,i,l=s.key;l===Ge.Space&&(s.preventDefault(),s.key=Ge.Enter),(i=(a=n.props).handleOnKeyDown)===null||i===void 0||i.call(a,s)},n.isKeyboardSelected=function(){return!n.props.disabledKeyboardNavigation&&!Lt(n.props.date,n.props.selected)&&Lt(n.props.date,n.props.preSelection)},n.getTabIndex=function(){return n.props.showWeekPicker&&n.props.showWeekNumber&&(n.isKeyboardSelected()||Lt(n.props.date,n.props.selected)&&Lt(n.props.preSelection,n.props.selected))?0:-1},n.handleFocusWeekNumber=function(s){var a=!1;n.getTabIndex()===0&&!(s!=null&&s.isInputFocused)&&Lt(n.props.date,n.props.preSelection)&&((!document.activeElement||document.activeElement===document.body)&&(a=!0),n.props.inline&&!n.props.shouldFocusDayInline&&(a=!1),n.props.containerRef&&n.props.containerRef.current&&n.props.containerRef.current.contains(document.activeElement)&&document.activeElement&&document.activeElement.classList.contains("react-datepicker__week-number")&&(a=!0)),a&&n.weekNumberEl.current&&n.weekNumberEl.current.focus({preventScroll:!0})},n}return Object.defineProperty(t,"defaultProps",{get:function(){return{ariaLabelPrefix:"week "}},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){this.handleFocusWeekNumber()},t.prototype.componentDidUpdate=function(n){this.handleFocusWeekNumber(n)},t.prototype.render=function(){var n=this.props,s=n.weekNumber,a=n.isWeekDisabled,i=n.ariaLabelPrefix,l=i===void 0?t.defaultProps.ariaLabelPrefix:i,o=n.onClick,c={"react-datepicker__week-number":!0,"react-datepicker__week-number--clickable":!!o&&!a,"react-datepicker__week-number--selected":!!o&&Lt(this.props.date,this.props.selected)};return le.createElement("div",{ref:this.weekNumberEl,className:xt(c),"aria-label":"".concat(l," ").concat(this.props.weekNumber),onClick:this.handleClick,onKeyDown:this.handleOnKeyDown,tabIndex:this.getTabIndex(),role:"gridcell"},s)},t}(h.Component),_F=function(e){pn(t,e);function t(){var n=e!==null&&e.apply(this,arguments)||this;return n.isDisabled=function(s){return us(s,{minDate:n.props.minDate,maxDate:n.props.maxDate,excludeDates:n.props.excludeDates,excludeDateIntervals:n.props.excludeDateIntervals,includeDateIntervals:n.props.includeDateIntervals,includeDates:n.props.includeDates,filterDate:n.props.filterDate})},n.handleDayClick=function(s,a){n.props.onDayClick&&n.props.onDayClick(s,a)},n.handleDayMouseEnter=function(s){n.props.onDayMouseEnter&&n.props.onDayMouseEnter(s)},n.handleWeekClick=function(s,a,i){for(var l,o,c,d=new Date(s),u=0;u<7;u++){var m=new Date(s);m.setDate(m.getDate()+u);var p=!n.isDisabled(m);if(p){d=m;break}}typeof n.props.onWeekSelect=="function"&&n.props.onWeekSelect(d,a,i),n.props.showWeekPicker&&n.handleDayClick(d,i),((l=n.props.shouldCloseOnSelect)!==null&&l!==void 0?l:t.defaultProps.shouldCloseOnSelect)&&((c=(o=n.props).setOpen)===null||c===void 0||c.call(o,!1))},n.formatWeekNumber=function(s){return n.props.formatWeekNumber?n.props.formatWeekNumber(s):iF(s)},n.isWeekDisabled=function(){for(var s=n.startOfWeek(),a=Rs(s,6),i=new Date(s);i<=a;){if(!n.isDisabled(i))return!1;i=Rs(i,1)}return!0},n.renderDays=function(){var s=n.startOfWeek(),a=[],i=n.formatWeekNumber(s);if(n.props.showWeekNumber){var l=n.props.onWeekSelect||n.props.showWeekPicker?n.handleWeekClick.bind(n,s,i):void 0;a.push(le.createElement(SF,Rt({key:"W"},t.defaultProps,n.props,{weekNumber:i,isWeekDisabled:n.isWeekDisabled(),date:s,onClick:l})))}return a.concat([0,1,2,3,4,5,6].map(function(o){var c=Rs(s,o);return le.createElement(kF,Rt({},t.defaultProps,n.props,{ariaLabelPrefixWhenEnabled:n.props.chooseDayAriaLabelPrefix,ariaLabelPrefixWhenDisabled:n.props.disabledDayAriaLabelPrefix,key:c.valueOf(),day:c,onClick:n.handleDayClick.bind(n,c),onMouseEnter:n.handleDayMouseEnter.bind(n,c)}))}))},n.startOfWeek=function(){return ii(n.props.day,n.props.locale,n.props.calendarStartDay)},n.isKeyboardSelected=function(){return!n.props.disabledKeyboardNavigation&&!Lt(n.startOfWeek(),n.props.selected)&&Lt(n.startOfWeek(),n.props.preSelection)},n}return Object.defineProperty(t,"defaultProps",{get:function(){return{shouldCloseOnSelect:!0}},enumerable:!1,configurable:!0}),t.prototype.render=function(){var n={"react-datepicker__week":!0,"react-datepicker__week--selected":Lt(this.startOfWeek(),this.props.selected),"react-datepicker__week--keyboard-selected":this.isKeyboardSelected()},s=this.props.weekClassName?this.props.weekClassName(this.startOfWeek()):void 0;return le.createElement("div",{className:xt(n,s),role:"row"},this.renderDays())},t}(h.Component),Co,EF=6,_l={TWO_COLUMNS:"two_columns",THREE_COLUMNS:"three_columns",FOUR_COLUMNS:"four_columns"},kh=(Co={},Co[_l.TWO_COLUMNS]={grid:[[0,1],[2,3],[4,5],[6,7],[8,9],[10,11]],verticalNavigationOffset:2},Co[_l.THREE_COLUMNS]={grid:[[0,1,2],[3,4,5],[6,7,8],[9,10,11]],verticalNavigationOffset:3},Co[_l.FOUR_COLUMNS]={grid:[[0,1,2,3],[4,5,6,7],[8,9,10,11]],verticalNavigationOffset:4},Co),rd=1;function Fv(e,t){return e?_l.FOUR_COLUMNS:t?_l.TWO_COLUMNS:_l.THREE_COLUMNS}var DF=function(e){pn(t,e);function t(){var n=e!==null&&e.apply(this,arguments)||this;return n.MONTH_REFS=Xs([],Array(12),!0).map(function(){return h.createRef()}),n.QUARTER_REFS=Xs([],Array(4),!0).map(function(){return h.createRef()}),n.isDisabled=function(s){return us(s,{minDate:n.props.minDate,maxDate:n.props.maxDate,excludeDates:n.props.excludeDates,excludeDateIntervals:n.props.excludeDateIntervals,includeDateIntervals:n.props.includeDateIntervals,includeDates:n.props.includeDates,filterDate:n.props.filterDate})},n.isExcluded=function(s){return Lx(s,{excludeDates:n.props.excludeDates,excludeDateIntervals:n.props.excludeDateIntervals})},n.handleDayClick=function(s,a){var i,l;(l=(i=n.props).onDayClick)===null||l===void 0||l.call(i,s,a,n.props.orderInDisplay)},n.handleDayMouseEnter=function(s){var a,i;(i=(a=n.props).onDayMouseEnter)===null||i===void 0||i.call(a,s)},n.handleMouseLeave=function(){var s,a;(a=(s=n.props).onMouseLeave)===null||a===void 0||a.call(s)},n.isRangeStartMonth=function(s){var a=n.props,i=a.day,l=a.startDate,o=a.endDate;return!l||!o?!1:Cn(cs(i,s),l)},n.isRangeStartQuarter=function(s){var a=n.props,i=a.day,l=a.startDate,o=a.endDate;return!l||!o?!1:ou(vl(i,s),l)},n.isRangeEndMonth=function(s){var a=n.props,i=a.day,l=a.startDate,o=a.endDate;return!l||!o?!1:Cn(cs(i,s),o)},n.isRangeEndQuarter=function(s){var a=n.props,i=a.day,l=a.startDate,o=a.endDate;return!l||!o?!1:ou(vl(i,s),o)},n.isInSelectingRangeMonth=function(s){var a,i=n.props,l=i.day,o=i.selectsStart,c=i.selectsEnd,d=i.selectsRange,u=i.startDate,m=i.endDate,p=(a=n.props.selectingDate)!==null&&a!==void 0?a:n.props.preSelection;return!(o||c||d)||!p?!1:o&&m?Qc(p,m,s,l):c&&u||d&&u&&!m?Qc(u,p,s,l):!1},n.isSelectingMonthRangeStart=function(s){var a;if(!n.isInSelectingRangeMonth(s))return!1;var i=n.props,l=i.day,o=i.startDate,c=i.selectsStart,d=cs(l,s),u=(a=n.props.selectingDate)!==null&&a!==void 0?a:n.props.preSelection;return c?Cn(d,u):Cn(d,o)},n.isSelectingMonthRangeEnd=function(s){var a;if(!n.isInSelectingRangeMonth(s))return!1;var i=n.props,l=i.day,o=i.endDate,c=i.selectsEnd,d=i.selectsRange,u=cs(l,s),m=(a=n.props.selectingDate)!==null&&a!==void 0?a:n.props.preSelection;return c||d?Cn(u,m):Cn(u,o)},n.isInSelectingRangeQuarter=function(s){var a,i=n.props,l=i.day,o=i.selectsStart,c=i.selectsEnd,d=i.selectsRange,u=i.startDate,m=i.endDate,p=(a=n.props.selectingDate)!==null&&a!==void 0?a:n.props.preSelection;return!(o||c||d)||!p?!1:o&&m?td(p,m,s,l):c&&u||d&&u&&!m?td(u,p,s,l):!1},n.isWeekInMonth=function(s){var a=n.props.day,i=Rs(s,6);return Cn(s,a)||Cn(i,a)},n.isCurrentMonth=function(s,a){return Tt(s)===Tt(er())&&a===bn(er())},n.isCurrentQuarter=function(s,a){return Tt(s)===Tt(er())&&a===Fi(er())},n.isSelectedMonth=function(s,a,i){return bn(i)===a&&Tt(s)===Tt(i)},n.isSelectMonthInList=function(s,a,i){return i.some(function(l){return n.isSelectedMonth(s,a,l)})},n.isSelectedQuarter=function(s,a,i){return Fi(s)===a&&Tt(s)===Tt(i)},n.isMonthSelected=function(){var s=n.props,a=s.day,i=s.selected,l=s.selectedDates,o=s.selectsMultiple,c=bn(a);return o?l==null?void 0:l.some(function(d){return n.isSelectedMonth(a,c,d)}):!!i&&n.isSelectedMonth(a,c,i)},n.renderWeeks=function(){for(var s=[],a=n.props.fixedHeight,i=0,l=!1,o=ii(ka(n.props.day),n.props.locale,n.props.calendarStartDay),c=function(y){return n.props.showWeekPicker?ii(y,n.props.locale,n.props.calendarStartDay):n.props.preSelection},d=function(y){return n.props.showWeekPicker?ii(y,n.props.locale,n.props.calendarStartDay):n.props.selected},u=n.props.selected?d(n.props.selected):void 0,m=n.props.preSelection?c(n.props.preSelection):void 0;s.push(le.createElement(_F,Rt({},n.props,{ariaLabelPrefix:n.props.weekAriaLabelPrefix,key:i,day:o,month:bn(n.props.day),onDayClick:n.handleDayClick,onDayMouseEnter:n.handleDayMouseEnter,selected:u,preSelection:m,showWeekNumber:n.props.showWeekNumbers}))),!l;){i++,o=Xd(o,1);var p=a&&i>=EF,f=!a&&!n.isWeekInMonth(o);if(p||f)if(n.props.peekNextMonth)l=!0;else break}return s},n.onMonthClick=function(s,a){var i=n.isMonthDisabledForLabelDate(a),l=i.isDisabled,o=i.labelDate;l||n.handleDayClick(ka(o),s)},n.onMonthMouseEnter=function(s){var a=n.isMonthDisabledForLabelDate(s),i=a.isDisabled,l=a.labelDate;i||n.handleDayMouseEnter(ka(l))},n.handleMonthNavigation=function(s,a){var i,l,o,c;(l=(i=n.props).setPreSelection)===null||l===void 0||l.call(i,a),(c=(o=n.MONTH_REFS[s])===null||o===void 0?void 0:o.current)===null||c===void 0||c.focus()},n.handleKeyboardNavigation=function(s,a,i){var l,o=n.props,c=o.selected,d=o.preSelection,u=o.setPreSelection,m=o.minDate,p=o.maxDate,f=o.showFourColumnMonthYearPicker,y=o.showTwoColumnMonthYearPicker;if(d){var g=Fv(f,y),x=n.getVerticalOffset(g),b=(l=kh[g])===null||l===void 0?void 0:l.grid,v=function(S,_,C){var D,A,E=_,T=C;switch(S){case Ge.ArrowRight:E=$s(_,rd),T=C===11?0:C+rd;break;case Ge.ArrowLeft:E=Ca(_,rd),T=C===0?11:C-rd;break;case Ge.ArrowUp:E=Ca(_,x),T=!((D=b==null?void 0:b[0])===null||D===void 0)&&D.includes(C)?C+12-x:C-x;break;case Ge.ArrowDown:E=$s(_,x),T=!((A=b==null?void 0:b[b.length-1])===null||A===void 0)&&A.includes(C)?C-12+x:C+x;break}return{newCalculatedDate:E,newCalculatedMonth:T}},w=function(S,_,C){for(var D=40,A=S,E=!1,T=0,M=v(A,_,C),L=M.newCalculatedDate,P=M.newCalculatedMonth;!E;){if(T>=D){L=_,P=C;break}if(m&&L<m){A=Ge.ArrowRight;var $=v(A,L,P);L=$.newCalculatedDate,P=$.newCalculatedMonth}if(p&&L>p){A=Ge.ArrowLeft;var $=v(A,L,P);L=$.newCalculatedDate,P=$.newCalculatedMonth}if(pF(L,n.props)){var $=v(A,L,P);L=$.newCalculatedDate,P=$.newCalculatedMonth}else E=!0;T++}return{newCalculatedDate:L,newCalculatedMonth:P}};if(a===Ge.Enter){n.isMonthDisabled(i)||(n.onMonthClick(s,i),u==null||u(c));return}var N=w(a,d,i),k=N.newCalculatedDate,j=N.newCalculatedMonth;switch(a){case Ge.ArrowRight:case Ge.ArrowLeft:case Ge.ArrowUp:case Ge.ArrowDown:n.handleMonthNavigation(j,k);break}}},n.getVerticalOffset=function(s){var a,i;return(i=(a=kh[s])===null||a===void 0?void 0:a.verticalNavigationOffset)!==null&&i!==void 0?i:0},n.onMonthKeyDown=function(s,a){var i=n.props,l=i.disabledKeyboardNavigation,o=i.handleOnMonthKeyDown,c=s.key;c!==Ge.Tab&&s.preventDefault(),l||n.handleKeyboardNavigation(s,c,a),o&&o(s)},n.onQuarterClick=function(s,a){var i=vl(n.props.day,a);Zc(i,n.props)||n.handleDayClick(kv(i),s)},n.onQuarterMouseEnter=function(s){var a=vl(n.props.day,s);Zc(a,n.props)||n.handleDayMouseEnter(kv(a))},n.handleQuarterNavigation=function(s,a){var i,l,o,c;n.isDisabled(a)||n.isExcluded(a)||((l=(i=n.props).setPreSelection)===null||l===void 0||l.call(i,a),(c=(o=n.QUARTER_REFS[s-1])===null||o===void 0?void 0:o.current)===null||c===void 0||c.focus())},n.onQuarterKeyDown=function(s,a){var i,l,o=s.key;if(!n.props.disabledKeyboardNavigation)switch(o){case Ge.Enter:n.onQuarterClick(s,a),(l=(i=n.props).setPreSelection)===null||l===void 0||l.call(i,n.props.selected);break;case Ge.ArrowRight:if(!n.props.preSelection)break;n.handleQuarterNavigation(a===4?1:a+1,Nx(n.props.preSelection,1));break;case Ge.ArrowLeft:if(!n.props.preSelection)break;n.handleQuarterNavigation(a===1?4:a-1,hS(n.props.preSelection));break}},n.isMonthDisabledForLabelDate=function(s){var a,i=n.props,l=i.day,o=i.minDate,c=i.maxDate,d=i.excludeDates,u=i.includeDates,m=cs(l,s);return{isDisabled:(a=(o||c||d||u)&&ES(m,n.props))!==null&&a!==void 0?a:!1,labelDate:m}},n.isMonthDisabled=function(s){var a=n.isMonthDisabledForLabelDate(s).isDisabled;return a},n.getMonthClassNames=function(s){var a=n.props,i=a.day,l=a.startDate,o=a.endDate,c=a.preSelection,d=a.monthClassName,u=d?d(cs(i,s)):void 0,m=n.getSelection();return xt("react-datepicker__month-text","react-datepicker__month-".concat(s),u,{"react-datepicker__month-text--disabled":n.isMonthDisabled(s),"react-datepicker__month-text--selected":m?n.isSelectMonthInList(i,s,m):void 0,"react-datepicker__month-text--keyboard-selected":!n.props.disabledKeyboardNavigation&&c&&n.isSelectedMonth(i,s,c)&&!n.isMonthSelected()&&!n.isMonthDisabled(s),"react-datepicker__month-text--in-selecting-range":n.isInSelectingRangeMonth(s),"react-datepicker__month-text--in-range":l&&o?Qc(l,o,s,i):void 0,"react-datepicker__month-text--range-start":n.isRangeStartMonth(s),"react-datepicker__month-text--range-end":n.isRangeEndMonth(s),"react-datepicker__month-text--selecting-range-start":n.isSelectingMonthRangeStart(s),"react-datepicker__month-text--selecting-range-end":n.isSelectingMonthRangeEnd(s),"react-datepicker__month-text--today":n.isCurrentMonth(i,s)})},n.getTabIndex=function(s){if(n.props.preSelection==null)return"-1";var a=bn(n.props.preSelection),i=n.isMonthDisabledForLabelDate(a).isDisabled,l=s===a&&!(i||n.props.disabledKeyboardNavigation)?"0":"-1";return l},n.getQuarterTabIndex=function(s){if(n.props.preSelection==null)return"-1";var a=Fi(n.props.preSelection),i=Zc(n.props.day,n.props),l=s===a&&!(i||n.props.disabledKeyboardNavigation)?"0":"-1";return l},n.getAriaLabel=function(s){var a=n.props,i=a.chooseDayAriaLabelPrefix,l=i===void 0?"Choose":i,o=a.disabledDayAriaLabelPrefix,c=o===void 0?"Not available":o,d=a.day,u=a.locale,m=cs(d,s),p=n.isDisabled(m)||n.isExcluded(m)?c:l;return"".concat(p," ").concat(br(m,"MMMM yyyy",u))},n.getQuarterClassNames=function(s){var a=n.props,i=a.day,l=a.startDate,o=a.endDate,c=a.selected,d=a.minDate,u=a.maxDate,m=a.excludeDates,p=a.includeDates,f=a.filterDate,y=a.preSelection,g=a.disabledKeyboardNavigation,x=(d||u||m||p||f)&&Zc(vl(i,s),n.props);return xt("react-datepicker__quarter-text","react-datepicker__quarter-".concat(s),{"react-datepicker__quarter-text--disabled":x,"react-datepicker__quarter-text--selected":c?n.isSelectedQuarter(i,s,c):void 0,"react-datepicker__quarter-text--keyboard-selected":!g&&y&&n.isSelectedQuarter(i,s,y)&&!x,"react-datepicker__quarter-text--in-selecting-range":n.isInSelectingRangeQuarter(s),"react-datepicker__quarter-text--in-range":l&&o?td(l,o,s,i):void 0,"react-datepicker__quarter-text--range-start":n.isRangeStartQuarter(s),"react-datepicker__quarter-text--range-end":n.isRangeEndQuarter(s),"react-datepicker__quarter-text--today":n.isCurrentQuarter(i,s)})},n.getMonthContent=function(s){var a=n.props,i=a.showFullMonthYearPicker,l=a.renderMonthContent,o=a.locale,c=a.day,d=_S(s,o),u=Ix(s,o);return l?l(s,d,u,c):i?u:d},n.getQuarterContent=function(s){var a,i=n.props,l=i.renderQuarterContent,o=i.locale,c=hF(s,o);return(a=l==null?void 0:l(s,c))!==null&&a!==void 0?a:c},n.renderMonths=function(){var s,a=n.props,i=a.showTwoColumnMonthYearPicker,l=a.showFourColumnMonthYearPicker,o=a.day,c=a.selected,d=(s=kh[Fv(l,i)])===null||s===void 0?void 0:s.grid;return d==null?void 0:d.map(function(u,m){return le.createElement("div",{className:"react-datepicker__month-wrapper",key:m},u.map(function(p,f){return le.createElement("div",{ref:n.MONTH_REFS[p],key:f,onClick:function(y){n.onMonthClick(y,p)},onKeyDown:function(y){AS(y)&&(y.preventDefault(),y.key=Ge.Enter),n.onMonthKeyDown(y,p)},onMouseEnter:n.props.usePointerEvent?void 0:function(){return n.onMonthMouseEnter(p)},onPointerEnter:n.props.usePointerEvent?function(){return n.onMonthMouseEnter(p)}:void 0,tabIndex:Number(n.getTabIndex(p)),className:n.getMonthClassNames(p),"aria-disabled":n.isMonthDisabled(p),role:"option","aria-label":n.getAriaLabel(p),"aria-current":n.isCurrentMonth(o,p)?"date":void 0,"aria-selected":c?n.isSelectedMonth(o,p,c):void 0},n.getMonthContent(p))}))})},n.renderQuarters=function(){var s=n.props,a=s.day,i=s.selected,l=[1,2,3,4];return le.createElement("div",{className:"react-datepicker__quarter-wrapper"},l.map(function(o,c){return le.createElement("div",{key:c,ref:n.QUARTER_REFS[c],role:"option",onClick:function(d){n.onQuarterClick(d,o)},onKeyDown:function(d){n.onQuarterKeyDown(d,o)},onMouseEnter:n.props.usePointerEvent?void 0:function(){return n.onQuarterMouseEnter(o)},onPointerEnter:n.props.usePointerEvent?function(){return n.onQuarterMouseEnter(o)}:void 0,className:n.getQuarterClassNames(o),"aria-selected":i?n.isSelectedQuarter(a,o,i):void 0,tabIndex:Number(n.getQuarterTabIndex(o)),"aria-current":n.isCurrentQuarter(a,o)?"date":void 0},n.getQuarterContent(o))}))},n.getClassNames=function(){var s=n.props,a=s.selectingDate,i=s.selectsStart,l=s.selectsEnd,o=s.showMonthYearPicker,c=s.showQuarterYearPicker,d=s.showWeekPicker;return xt("react-datepicker__month",{"react-datepicker__month--selecting-range":a&&(i||l)},{"react-datepicker__monthPicker":o},{"react-datepicker__quarterPicker":c},{"react-datepicker__weekPicker":d})},n}return t.prototype.getSelection=function(){var n=this.props,s=n.selected,a=n.selectedDates,i=n.selectsMultiple;if(i)return a;if(s)return[s]},t.prototype.render=function(){var n=this.props,s=n.showMonthYearPicker,a=n.showQuarterYearPicker,i=n.day,l=n.ariaLabelPrefix,o=l===void 0?"Month ":l,c=o?o.trim()+" ":"",d=s||a;return d?le.createElement("div",{className:this.getClassNames(),onMouseLeave:this.props.usePointerEvent?void 0:this.handleMouseLeave,onPointerLeave:this.props.usePointerEvent?this.handleMouseLeave:void 0,"aria-label":"".concat(c).concat(br(i,"MMMM, yyyy",this.props.locale)),role:"listbox"},s?this.renderMonths():this.renderQuarters()):le.createElement("div",{role:"table"},this.props.dayNamesHeader&&le.createElement("div",{role:"rowgroup"},this.props.dayNamesHeader),le.createElement("div",{className:this.getClassNames(),onMouseLeave:this.props.usePointerEvent?void 0:this.handleMouseLeave,onPointerLeave:this.props.usePointerEvent?this.handleMouseLeave:void 0,"aria-label":"".concat(c).concat(br(i,"MMMM, yyyy",this.props.locale)),role:"rowgroup"},this.renderWeeks()))},t}(h.Component),TF=function(e){pn(t,e);function t(){var n=e!==null&&e.apply(this,arguments)||this;return n.monthOptionButtonsRef={},n.isSelectedMonth=function(s){return n.props.month===s},n.handleOptionKeyDown=function(s,a){var i;switch(a.key){case"Enter":a.preventDefault(),n.onChange(s);break;case"Escape":a.preventDefault(),n.props.onCancel();break;case"ArrowUp":case"ArrowDown":{a.preventDefault();var l=(s+(a.key==="ArrowUp"?-1:1)+n.props.monthNames.length)%n.props.monthNames.length;(i=n.monthOptionButtonsRef[l])===null||i===void 0||i.focus();break}}},n.renderOptions=function(){return n.monthOptionButtonsRef={},n.props.monthNames.map(function(s,a){return le.createElement("div",{ref:function(i){n.monthOptionButtonsRef[a]=i,n.isSelectedMonth(a)&&(i==null||i.focus())},role:"button",tabIndex:0,className:n.isSelectedMonth(a)?"react-datepicker__month-option react-datepicker__month-option--selected_month":"react-datepicker__month-option",key:s,onClick:n.onChange.bind(n,a),onKeyDown:n.handleOptionKeyDown.bind(n,a),"aria-selected":n.isSelectedMonth(a)?"true":void 0},n.isSelectedMonth(a)?le.createElement("span",{className:"react-datepicker__month-option--selected"},""):"",s)})},n.onChange=function(s){return n.props.onChange(s)},n.handleClickOutside=function(){return n.props.onCancel()},n}return t.prototype.render=function(){return le.createElement(om,{className:"react-datepicker__month-dropdown",onClickOutside:this.handleClickOutside},this.renderOptions())},t}(h.Component),AF=function(e){pn(t,e);function t(){var n=e!==null&&e.apply(this,arguments)||this;return n.state={dropdownVisible:!1},n.renderSelectOptions=function(s){return s.map(function(a,i){return le.createElement("option",{key:a,value:i},a)})},n.renderSelectMode=function(s){return le.createElement("select",{value:n.props.month,className:"react-datepicker__month-select",onChange:function(a){return n.onChange(parseInt(a.target.value))}},n.renderSelectOptions(s))},n.renderReadView=function(s,a){return le.createElement("button",{key:"read",type:"button",style:{visibility:s?"visible":"hidden"},className:"react-datepicker__month-read-view",onClick:n.toggleDropdown},le.createElement("span",{className:"react-datepicker__month-read-view--down-arrow"}),le.createElement("span",{className:"react-datepicker__month-read-view--selected-month"},a[n.props.month]))},n.renderDropdown=function(s){return le.createElement(TF,Rt({key:"dropdown"},n.props,{monthNames:s,onChange:n.onChange,onCancel:n.toggleDropdown}))},n.renderScrollMode=function(s){var a=n.state.dropdownVisible,i=[n.renderReadView(!a,s)];return a&&i.unshift(n.renderDropdown(s)),i},n.onChange=function(s){n.toggleDropdown(),s!==n.props.month&&n.props.onChange(s)},n.toggleDropdown=function(){return n.setState({dropdownVisible:!n.state.dropdownVisible})},n}return t.prototype.render=function(){var n=this,s=[0,1,2,3,4,5,6,7,8,9,10,11].map(this.props.useShortMonthInDropdown?function(i){return _S(i,n.props.locale)}:function(i){return Ix(i,n.props.locale)}),a;switch(this.props.dropdownMode){case"scroll":a=this.renderScrollMode(s);break;case"select":a=this.renderSelectMode(s);break}return le.createElement("div",{className:"react-datepicker__month-dropdown-container react-datepicker__month-dropdown-container--".concat(this.props.dropdownMode)},a)},t}(h.Component);function PF(e,t){for(var n=[],s=ka(e),a=ka(t);!ui(s,a);)n.push(er(s)),s=$s(s,1);return n}var OF=function(e){pn(t,e);function t(n){var s=e.call(this,n)||this;return s.renderOptions=function(){return s.state.monthYearsList.map(function(a){var i=qf(a),l=Ws(s.props.date,a)&&Cn(s.props.date,a);return le.createElement("div",{className:l?"react-datepicker__month-year-option--selected_month-year":"react-datepicker__month-year-option",key:i,onClick:s.onChange.bind(s,i),"aria-selected":l?"true":void 0},l?le.createElement("span",{className:"react-datepicker__month-year-option--selected"},""):"",br(a,s.props.dateFormat,s.props.locale))})},s.onChange=function(a){return s.props.onChange(a)},s.handleClickOutside=function(){s.props.onCancel()},s.state={monthYearsList:PF(s.props.minDate,s.props.maxDate)},s}return t.prototype.render=function(){var n=xt({"react-datepicker__month-year-dropdown":!0,"react-datepicker__month-year-dropdown--scrollable":this.props.scrollableMonthYearDropdown});return le.createElement(om,{className:n,onClickOutside:this.handleClickOutside},this.renderOptions())},t}(h.Component),MF=function(e){pn(t,e);function t(){var n=e!==null&&e.apply(this,arguments)||this;return n.state={dropdownVisible:!1},n.renderSelectOptions=function(){for(var s=ka(n.props.minDate),a=ka(n.props.maxDate),i=[];!ui(s,a);){var l=qf(s);i.push(le.createElement("option",{key:l,value:l},br(s,n.props.dateFormat,n.props.locale))),s=$s(s,1)}return i},n.onSelectChange=function(s){n.onChange(parseInt(s.target.value))},n.renderSelectMode=function(){return le.createElement("select",{value:qf(ka(n.props.date)),className:"react-datepicker__month-year-select",onChange:n.onSelectChange},n.renderSelectOptions())},n.renderReadView=function(s){var a=br(n.props.date,n.props.dateFormat,n.props.locale);return le.createElement("div",{key:"read",style:{visibility:s?"visible":"hidden"},className:"react-datepicker__month-year-read-view",onClick:n.toggleDropdown},le.createElement("span",{className:"react-datepicker__month-year-read-view--down-arrow"}),le.createElement("span",{className:"react-datepicker__month-year-read-view--selected-month-year"},a))},n.renderDropdown=function(){return le.createElement(OF,Rt({key:"dropdown"},n.props,{onChange:n.onChange,onCancel:n.toggleDropdown}))},n.renderScrollMode=function(){var s=n.state.dropdownVisible,a=[n.renderReadView(!s)];return s&&a.unshift(n.renderDropdown()),a},n.onChange=function(s){n.toggleDropdown();var a=er(s);Ws(n.props.date,a)&&Cn(n.props.date,a)||n.props.onChange(a)},n.toggleDropdown=function(){return n.setState({dropdownVisible:!n.state.dropdownVisible})},n}return t.prototype.render=function(){var n;switch(this.props.dropdownMode){case"scroll":n=this.renderScrollMode();break;case"select":n=this.renderSelectMode();break}return le.createElement("div",{className:"react-datepicker__month-year-dropdown-container react-datepicker__month-year-dropdown-container--".concat(this.props.dropdownMode)},n)},t}(h.Component),IF=function(e){pn(t,e);function t(){var n=e!==null&&e.apply(this,arguments)||this;return n.state={height:null},n.scrollToTheSelectedTime=function(){requestAnimationFrame(function(){var s,a,i;n.list&&(n.list.scrollTop=(i=n.centerLi&&t.calcCenterPosition(n.props.monthRef?n.props.monthRef.clientHeight-((a=(s=n.header)===null||s===void 0?void 0:s.clientHeight)!==null&&a!==void 0?a:0):n.list.clientHeight,n.centerLi))!==null&&i!==void 0?i:0)})},n.handleClick=function(s){var a,i;(n.props.minTime||n.props.maxTime)&&Tv(s,n.props)||(n.props.excludeTimes||n.props.includeTimes||n.props.filterTime)&&Dv(s,n.props)||(i=(a=n.props).onChange)===null||i===void 0||i.call(a,s)},n.isSelectedTime=function(s){return n.props.selected&&NF(n.props.selected,s)},n.isDisabledTime=function(s){return(n.props.minTime||n.props.maxTime)&&Tv(s,n.props)||(n.props.excludeTimes||n.props.includeTimes||n.props.filterTime)&&Dv(s,n.props)},n.liClasses=function(s){var a,i=["react-datepicker__time-list-item",n.props.timeClassName?n.props.timeClassName(s):void 0];return n.isSelectedTime(s)&&i.push("react-datepicker__time-list-item--selected"),n.isDisabledTime(s)&&i.push("react-datepicker__time-list-item--disabled"),n.props.injectTimes&&(ja(s)*3600+Na(s)*60+ai(s))%(((a=n.props.intervals)!==null&&a!==void 0?a:t.defaultProps.intervals)*60)!==0&&i.push("react-datepicker__time-list-item--injected"),i.join(" ")},n.handleOnKeyDown=function(s,a){var i,l;s.key===Ge.Space&&(s.preventDefault(),s.key=Ge.Enter),(s.key===Ge.ArrowUp||s.key===Ge.ArrowLeft)&&s.target instanceof HTMLElement&&s.target.previousSibling&&(s.preventDefault(),s.target.previousSibling instanceof HTMLElement&&s.target.previousSibling.focus()),(s.key===Ge.ArrowDown||s.key===Ge.ArrowRight)&&s.target instanceof HTMLElement&&s.target.nextSibling&&(s.preventDefault(),s.target.nextSibling instanceof HTMLElement&&s.target.nextSibling.focus()),s.key===Ge.Enter&&n.handleClick(a),(l=(i=n.props).handleOnKeyDown)===null||l===void 0||l.call(i,s)},n.renderTimes=function(){for(var s,a=[],i=typeof n.props.format=="string"?n.props.format:"p",l=(s=n.props.intervals)!==null&&s!==void 0?s:t.defaultProps.intervals,o=n.props.selected||n.props.openToDate||er(),c=Md(o),d=n.props.injectTimes&&n.props.injectTimes.sort(function(x,b){return x.getTime()-b.getTime()}),u=60*jF(o),m=u/l,p=0;p<m;p++){var f=zf(c,p*l);if(a.push(f),d){var y=wF(c,f,p,l,d);a=a.concat(y)}}var g=a.reduce(function(x,b){return b.getTime()<=o.getTime()?b:x},a[0]);return a.map(function(x){return le.createElement("li",{key:x.valueOf(),onClick:n.handleClick.bind(n,x),className:n.liClasses(x),ref:function(b){x===g&&(n.centerLi=b)},onKeyDown:function(b){n.handleOnKeyDown(b,x)},tabIndex:x===g?0:-1,role:"option","aria-selected":n.isSelectedTime(x)?"true":void 0,"aria-disabled":n.isDisabledTime(x)?"true":void 0},br(x,i,n.props.locale))})},n.renderTimeCaption=function(){return n.props.showTimeCaption===!1?le.createElement(le.Fragment,null):le.createElement("div",{className:"react-datepicker__header react-datepicker__header--time ".concat(n.props.showTimeSelectOnly?"react-datepicker__header--time--only":""),ref:function(s){n.header=s}},le.createElement("div",{className:"react-datepicker-time__header"},n.props.timeCaption))},n}return Object.defineProperty(t,"defaultProps",{get:function(){return{intervals:30,todayButton:null,timeCaption:"Time",showTimeCaption:!0}},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){this.scrollToTheSelectedTime(),this.observeDatePickerHeightChanges()},t.prototype.componentWillUnmount=function(){var n;(n=this.resizeObserver)===null||n===void 0||n.disconnect()},t.prototype.observeDatePickerHeightChanges=function(){var n=this,s=this.props.monthRef;this.updateContainerHeight(),s&&(this.resizeObserver=new ResizeObserver(function(){n.updateContainerHeight()}),this.resizeObserver.observe(s))},t.prototype.updateContainerHeight=function(){this.props.monthRef&&this.header&&this.setState({height:this.props.monthRef.clientHeight-this.header.clientHeight})},t.prototype.render=function(){var n=this,s,a=this.state.height;return le.createElement("div",{className:"react-datepicker__time-container ".concat(((s=this.props.todayButton)!==null&&s!==void 0?s:t.defaultProps.todayButton)?"react-datepicker__time-container--with-today-button":"")},this.renderTimeCaption(),le.createElement("div",{className:"react-datepicker__time"},le.createElement("div",{className:"react-datepicker__time-box"},le.createElement("ul",{className:"react-datepicker__time-list",ref:function(i){n.list=i},style:a?{height:a}:{},role:"listbox","aria-label":this.props.timeCaption},this.renderTimes()))))},t.calcCenterPosition=function(n,s){return s.offsetTop-(n/2-s.clientHeight/2)},t}(h.Component),zv=3,LF=function(e){pn(t,e);function t(n){var s=e.call(this,n)||this;return s.YEAR_REFS=Xs([],Array(s.props.yearItemNumber),!0).map(function(){return h.createRef()}),s.isDisabled=function(a){return us(a,{minDate:s.props.minDate,maxDate:s.props.maxDate,excludeDates:s.props.excludeDates,includeDates:s.props.includeDates,filterDate:s.props.filterDate})},s.isExcluded=function(a){return Lx(a,{excludeDates:s.props.excludeDates})},s.selectingDate=function(){var a;return(a=s.props.selectingDate)!==null&&a!==void 0?a:s.props.preSelection},s.updateFocusOnPaginate=function(a){var i=function(){var l,o;(o=(l=s.YEAR_REFS[a])===null||l===void 0?void 0:l.current)===null||o===void 0||o.focus()};window.requestAnimationFrame(i)},s.handleYearClick=function(a,i){s.props.onDayClick&&s.props.onDayClick(a,i)},s.handleYearNavigation=function(a,i){var l,o,c,d,u=s.props,m=u.date,p=u.yearItemNumber;if(!(m===void 0||p===void 0)){var f=xa(m,p).startPeriod;s.isDisabled(i)||s.isExcluded(i)||((o=(l=s.props).setPreSelection)===null||o===void 0||o.call(l,i),a-f<0?s.updateFocusOnPaginate(p-(f-a)):a-f>=p?s.updateFocusOnPaginate(Math.abs(p-(a-f))):(d=(c=s.YEAR_REFS[a-f])===null||c===void 0?void 0:c.current)===null||d===void 0||d.focus())}},s.isSameDay=function(a,i){return Lt(a,i)},s.isCurrentYear=function(a){return a===Tt(er())},s.isRangeStart=function(a){return s.props.startDate&&s.props.endDate&&Ws(Hs(er(),a),s.props.startDate)},s.isRangeEnd=function(a){return s.props.startDate&&s.props.endDate&&Ws(Hs(er(),a),s.props.endDate)},s.isInRange=function(a){return ed(a,s.props.startDate,s.props.endDate)},s.isInSelectingRange=function(a){var i=s.props,l=i.selectsStart,o=i.selectsEnd,c=i.selectsRange,d=i.startDate,u=i.endDate;return!(l||o||c)||!s.selectingDate()?!1:l&&u?ed(a,s.selectingDate(),u):o&&d||c&&d&&!u?ed(a,d,s.selectingDate()):!1},s.isSelectingRangeStart=function(a){var i;if(!s.isInSelectingRange(a))return!1;var l=s.props,o=l.startDate,c=l.selectsStart,d=Hs(er(),a);return c?Ws(d,(i=s.selectingDate())!==null&&i!==void 0?i:null):Ws(d,o??null)},s.isSelectingRangeEnd=function(a){var i;if(!s.isInSelectingRange(a))return!1;var l=s.props,o=l.endDate,c=l.selectsEnd,d=l.selectsRange,u=Hs(er(),a);return c||d?Ws(u,(i=s.selectingDate())!==null&&i!==void 0?i:null):Ws(u,o??null)},s.isKeyboardSelected=function(a){if(!(s.props.disabledKeyboardNavigation||s.props.date===void 0||s.props.preSelection==null)){var i=s.props,l=i.minDate,o=i.maxDate,c=i.excludeDates,d=i.includeDates,u=i.filterDate,m=i.selected,p=Fo(Hs(s.props.date,a)),f=(l||o||c||d||u)&&Id(a,s.props),y=!!m&&Lt(p,Fo(m)),g=Lt(p,Fo(s.props.preSelection));return!s.props.inline&&!y&&g&&!f}},s.isSelectedYear=function(a){var i=s.props,l=i.selectsMultiple,o=i.selected,c=i.selectedDates;return l?c==null?void 0:c.some(function(d){return a===Tt(d)}):!!o&&a===Tt(o)},s.onYearClick=function(a,i){var l=s.props.date;l!==void 0&&s.handleYearClick(Fo(Hs(l,i)),a)},s.onYearKeyDown=function(a,i){var l,o,c=a.key,d=s.props,u=d.date,m=d.yearItemNumber,p=d.handleOnKeyDown;if(c!==Ge.Tab&&a.preventDefault(),!s.props.disabledKeyboardNavigation)switch(c){case Ge.Enter:if(s.props.selected==null)break;s.onYearClick(a,i),(o=(l=s.props).setPreSelection)===null||o===void 0||o.call(l,s.props.selected);break;case Ge.ArrowRight:if(s.props.preSelection==null)break;s.handleYearNavigation(i+1,va(s.props.preSelection,1));break;case Ge.ArrowLeft:if(s.props.preSelection==null)break;s.handleYearNavigation(i-1,Xi(s.props.preSelection,1));break;case Ge.ArrowUp:{if(u===void 0||m===void 0||s.props.preSelection==null)break;var f=xa(u,m).startPeriod,y=zv,g=i-y;if(g<f){var x=m%y;i>=f&&i<f+x?y=x:y+=x,g=i-y}s.handleYearNavigation(g,Xi(s.props.preSelection,y));break}case Ge.ArrowDown:{if(u===void 0||m===void 0||s.props.preSelection==null)break;var b=xa(u,m).endPeriod,y=zv,g=i+y;if(g>b){var x=m%y;i<=b&&i>b-x?y=x:y+=x,g=i+y}s.handleYearNavigation(g,va(s.props.preSelection,y));break}}p&&p(a)},s.getYearClassNames=function(a){var i=s.props,l=i.date,o=i.minDate,c=i.maxDate,d=i.excludeDates,u=i.includeDates,m=i.filterDate,p=i.yearClassName;return xt("react-datepicker__year-text","react-datepicker__year-".concat(a),l?p==null?void 0:p(Hs(l,a)):void 0,{"react-datepicker__year-text--selected":s.isSelectedYear(a),"react-datepicker__year-text--disabled":(o||c||d||u||m)&&Id(a,s.props),"react-datepicker__year-text--keyboard-selected":s.isKeyboardSelected(a),"react-datepicker__year-text--range-start":s.isRangeStart(a),"react-datepicker__year-text--range-end":s.isRangeEnd(a),"react-datepicker__year-text--in-range":s.isInRange(a),"react-datepicker__year-text--in-selecting-range":s.isInSelectingRange(a),"react-datepicker__year-text--selecting-range-start":s.isSelectingRangeStart(a),"react-datepicker__year-text--selecting-range-end":s.isSelectingRangeEnd(a),"react-datepicker__year-text--today":s.isCurrentYear(a)})},s.getYearTabIndex=function(a){if(s.props.disabledKeyboardNavigation||s.props.preSelection==null)return"-1";var i=Tt(s.props.preSelection),l=Id(a,s.props);return a===i&&!l?"0":"-1"},s.getYearContent=function(a){return s.props.renderYearContent?s.props.renderYearContent(a):a},s}return t.prototype.render=function(){var n=this,s=[],a=this.props,i=a.date,l=a.yearItemNumber,o=a.onYearMouseEnter,c=a.onYearMouseLeave;if(i===void 0)return null;for(var d=xa(i,l),u=d.startPeriod,m=d.endPeriod,p=function(g){s.push(le.createElement("div",{ref:f.YEAR_REFS[g-u],onClick:function(x){n.onYearClick(x,g)},onKeyDown:function(x){AS(x)&&(x.preventDefault(),x.key=Ge.Enter),n.onYearKeyDown(x,g)},tabIndex:Number(f.getYearTabIndex(g)),className:f.getYearClassNames(g),onMouseEnter:f.props.usePointerEvent?void 0:function(x){return o(x,g)},onPointerEnter:f.props.usePointerEvent?function(x){return o(x,g)}:void 0,onMouseLeave:f.props.usePointerEvent?void 0:function(x){return c(x,g)},onPointerLeave:f.props.usePointerEvent?function(x){return c(x,g)}:void 0,key:g,"aria-current":f.isCurrentYear(g)?"date":void 0},f.getYearContent(g)))},f=this,y=u;y<=m;y++)p(y);return le.createElement("div",{className:"react-datepicker__year"},le.createElement("div",{className:"react-datepicker__year-wrapper",onMouseLeave:this.props.usePointerEvent?void 0:this.props.clearSelectingDate,onPointerLeave:this.props.usePointerEvent?this.props.clearSelectingDate:void 0},s))},t}(h.Component);function RF(e,t,n,s){for(var a=[],i=0;i<2*t+1;i++){var l=e+t-i,o=!0;n&&(o=Tt(n)<=l),s&&o&&(o=Tt(s)>=l),o&&a.push(l)}return a}var $F=function(e){pn(t,e);function t(n){var s=e.call(this,n)||this;s.yearOptionButtonsRef={},s.handleOptionKeyDown=function(o,c){var d;switch(c.key){case"Enter":c.preventDefault(),s.onChange(o);break;case"Escape":c.preventDefault(),s.props.onCancel();break;case"ArrowUp":case"ArrowDown":{c.preventDefault();var u=o+(c.key==="ArrowUp"?1:-1);s.yearOptionButtonsRef[u]&&((d=s.yearOptionButtonsRef[u])===null||d===void 0||d.focus());break}}},s.renderOptions=function(){s.yearOptionButtonsRef={};var o=s.props.year,c=s.state.yearsList.map(function(m){return le.createElement("div",{ref:function(p){s.yearOptionButtonsRef[m]=p,m===o&&(p==null||p.focus())},role:"button",tabIndex:0,className:o===m?"react-datepicker__year-option react-datepicker__year-option--selected_year":"react-datepicker__year-option",key:m,onClick:s.onChange.bind(s,m),onKeyDown:s.handleOptionKeyDown.bind(s,m),"aria-selected":o===m?"true":void 0},o===m?le.createElement("span",{className:"react-datepicker__year-option--selected"},""):"",m)}),d=s.props.minDate?Tt(s.props.minDate):null,u=s.props.maxDate?Tt(s.props.maxDate):null;return(!u||!s.state.yearsList.find(function(m){return m===u}))&&c.unshift(le.createElement("div",{className:"react-datepicker__year-option",key:"upcoming",onClick:s.incrementYears},le.createElement("a",{className:"react-datepicker__navigation react-datepicker__navigation--years react-datepicker__navigation--years-upcoming"}))),(!d||!s.state.yearsList.find(function(m){return m===d}))&&c.push(le.createElement("div",{className:"react-datepicker__year-option",key:"previous",onClick:s.decrementYears},le.createElement("a",{className:"react-datepicker__navigation react-datepicker__navigation--years react-datepicker__navigation--years-previous"}))),c},s.onChange=function(o){s.props.onChange(o)},s.handleClickOutside=function(){s.props.onCancel()},s.shiftYears=function(o){var c=s.state.yearsList.map(function(d){return d+o});s.setState({yearsList:c})},s.incrementYears=function(){return s.shiftYears(1)},s.decrementYears=function(){return s.shiftYears(-1)};var a=n.yearDropdownItemNumber,i=n.scrollableYearDropdown,l=a||(i?10:5);return s.state={yearsList:RF(s.props.year,l,s.props.minDate,s.props.maxDate)},s.dropdownRef=h.createRef(),s}return t.prototype.componentDidMount=function(){var n=this.dropdownRef.current;if(n){var s=n.children?Array.from(n.children):null,a=s?s.find(function(i){return i.ariaSelected}):null;n.scrollTop=a&&a instanceof HTMLElement?a.offsetTop+(a.clientHeight-n.clientHeight)/2:(n.scrollHeight-n.clientHeight)/2}},t.prototype.render=function(){var n=xt({"react-datepicker__year-dropdown":!0,"react-datepicker__year-dropdown--scrollable":this.props.scrollableYearDropdown});return le.createElement(om,{className:n,containerRef:this.dropdownRef,onClickOutside:this.handleClickOutside},this.renderOptions())},t}(h.Component),FF=function(e){pn(t,e);function t(){var n=e!==null&&e.apply(this,arguments)||this;return n.state={dropdownVisible:!1},n.renderSelectOptions=function(){for(var s=n.props.minDate?Tt(n.props.minDate):1900,a=n.props.maxDate?Tt(n.props.maxDate):2100,i=[],l=s;l<=a;l++)i.push(le.createElement("option",{key:l,value:l},l));return i},n.onSelectChange=function(s){n.onChange(parseInt(s.target.value))},n.renderSelectMode=function(){return le.createElement("select",{value:n.props.year,className:"react-datepicker__year-select",onChange:n.onSelectChange},n.renderSelectOptions())},n.renderReadView=function(s){return le.createElement("button",{key:"read",type:"button",style:{visibility:s?"visible":"hidden"},className:"react-datepicker__year-read-view",onClick:n.toggleDropdown},le.createElement("span",{className:"react-datepicker__year-read-view--down-arrow"}),le.createElement("span",{className:"react-datepicker__year-read-view--selected-year"},n.props.year))},n.renderDropdown=function(){return le.createElement($F,Rt({key:"dropdown"},n.props,{onChange:n.onChange,onCancel:n.toggleDropdown}))},n.renderScrollMode=function(){var s=n.state.dropdownVisible,a=[n.renderReadView(!s)];return s&&a.unshift(n.renderDropdown()),a},n.onChange=function(s){n.toggleDropdown(),s!==n.props.year&&n.props.onChange(s)},n.toggleDropdown=function(s){n.setState({dropdownVisible:!n.state.dropdownVisible},function(){n.props.adjustDateOnChange&&n.handleYearChange(n.props.date,s)})},n.handleYearChange=function(s,a){var i;(i=n.onSelect)===null||i===void 0||i.call(n,s,a),n.setOpen()},n.onSelect=function(s,a){var i,l;(l=(i=n.props).onSelect)===null||l===void 0||l.call(i,s,a)},n.setOpen=function(){var s,a;(a=(s=n.props).setOpen)===null||a===void 0||a.call(s,!0)},n}return t.prototype.render=function(){var n;switch(this.props.dropdownMode){case"scroll":n=this.renderScrollMode();break;case"select":n=this.renderSelectMode();break}return le.createElement("div",{className:"react-datepicker__year-dropdown-container react-datepicker__year-dropdown-container--".concat(this.props.dropdownMode)},n)},t}(h.Component),zF=["react-datepicker__year-select","react-datepicker__month-select","react-datepicker__month-year-select"],PS="react-datepicker-ignore-onclickoutside",BF=function(e){var t=(e.className||"").split(/\s+/);return zF.some(function(n){return t.indexOf(n)>=0})},UF=function(e){pn(t,e);function t(n){var s=e.call(this,n)||this;return s.monthContainer=void 0,s.handleClickOutside=function(a){s.props.onClickOutside(a)},s.setClickOutsideRef=function(){return s.containerRef.current},s.handleDropdownFocus=function(a){var i,l;BF(a.target)&&((l=(i=s.props).onDropdownFocus)===null||l===void 0||l.call(i,a))},s.getDateInView=function(){var a=s.props,i=a.preSelection,l=a.selected,o=a.openToDate,c=DS(s.props),d=TS(s.props),u=er(),m=o||l||i;return m||(c&&Ks(u,c)?c:d&&ui(u,d)?d:u)},s.increaseMonth=function(){s.setState(function(a){var i=a.date;return{date:$s(i,1)}},function(){return s.handleMonthChange(s.state.date)})},s.decreaseMonth=function(){s.setState(function(a){var i=a.date;return{date:Ca(i,1)}},function(){return s.handleMonthChange(s.state.date)})},s.handleDayClick=function(a,i,l){s.props.onSelect(a,i,l),s.props.setPreSelection&&s.props.setPreSelection(a)},s.handleDayMouseEnter=function(a){s.setState({selectingDate:a}),s.props.onDayMouseEnter&&s.props.onDayMouseEnter(a)},s.handleMonthMouseLeave=function(){s.setState({selectingDate:void 0}),s.props.onMonthMouseLeave&&s.props.onMonthMouseLeave()},s.handleYearMouseEnter=function(a,i){s.setState({selectingDate:Hs(er(),i)}),s.props.onYearMouseEnter&&s.props.onYearMouseEnter(a,i)},s.handleYearMouseLeave=function(a,i){s.props.onYearMouseLeave&&s.props.onYearMouseLeave(a,i)},s.handleYearChange=function(a){var i,l,o,c;(l=(i=s.props).onYearChange)===null||l===void 0||l.call(i,a),s.setState({isRenderAriaLiveMessage:!0}),s.props.adjustDateOnChange&&(s.props.onSelect(a),(c=(o=s.props).setOpen)===null||c===void 0||c.call(o,!0)),s.props.setPreSelection&&s.props.setPreSelection(a)},s.getEnabledPreSelectionDateForMonth=function(a){if(!us(a,s.props))return a;for(var i=ka(a),l=cF(a),o=v6(l,i),c=null,d=0;d<=o;d++){var u=Rs(i,d);if(!us(u,s.props)){c=u;break}}return c},s.handleMonthChange=function(a){var i,l,o,c=(i=s.getEnabledPreSelectionDateForMonth(a))!==null&&i!==void 0?i:a;s.handleCustomMonthChange(c),s.props.adjustDateOnChange&&(s.props.onSelect(c),(o=(l=s.props).setOpen)===null||o===void 0||o.call(l,!0)),s.props.setPreSelection&&s.props.setPreSelection(c)},s.handleCustomMonthChange=function(a){var i,l;(l=(i=s.props).onMonthChange)===null||l===void 0||l.call(i,a),s.setState({isRenderAriaLiveMessage:!0})},s.handleMonthYearChange=function(a){s.handleYearChange(a),s.handleMonthChange(a)},s.changeYear=function(a){s.setState(function(i){var l=i.date;return{date:Hs(l,Number(a))}},function(){return s.handleYearChange(s.state.date)})},s.changeMonth=function(a){s.setState(function(i){var l=i.date;return{date:cs(l,Number(a))}},function(){return s.handleMonthChange(s.state.date)})},s.changeMonthYear=function(a){s.setState(function(i){var l=i.date;return{date:Hs(cs(l,bn(a)),Tt(a))}},function(){return s.handleMonthYearChange(s.state.date)})},s.header=function(a){a===void 0&&(a=s.state.date);var i=ii(a,s.props.locale,s.props.calendarStartDay),l=[];return s.props.showWeekNumbers&&l.push(le.createElement("div",{key:"W",className:"react-datepicker__day-name",role:"columnheader"},le.createElement("span",{className:"react-datepicker__sr-only"},"Week number"),le.createElement("span",{"aria-hidden":"true"},s.props.weekLabel||"#"))),l.concat([0,1,2,3,4,5,6].map(function(o){var c=Rs(i,o),d=s.formatWeekday(c,s.props.locale),u=s.props.weekDayClassName?s.props.weekDayClassName(c):void 0;return le.createElement("div",{key:o,role:"columnheader",className:xt("react-datepicker__day-name",u)},le.createElement("span",{className:"react-datepicker__sr-only"},br(c,"EEEE",s.props.locale)),le.createElement("span",{"aria-hidden":"true"},d))}))},s.formatWeekday=function(a,i){return s.props.formatWeekDay?dF(a,s.props.formatWeekDay,i):s.props.useWeekdaysShort?mF(a,i):uF(a,i)},s.decreaseYear=function(){s.setState(function(a){var i,l=a.date;return{date:Xi(l,s.props.showYearPicker?(i=s.props.yearItemNumber)!==null&&i!==void 0?i:t.defaultProps.yearItemNumber:1)}},function(){return s.handleYearChange(s.state.date)})},s.clearSelectingDate=function(){s.setState({selectingDate:void 0})},s.renderPreviousButton=function(){var a,i,l;if(!s.props.renderCustomHeader){var o=(a=s.props.monthsShown)!==null&&a!==void 0?a:t.defaultProps.monthsShown,c=s.props.showPreviousMonths?o-1:0,d=(i=s.props.monthSelectedIn)!==null&&i!==void 0?i:c,u=Ca(s.state.date,d),m;switch(!0){case s.props.showMonthYearPicker:m=Ov(s.state.date,s.props);break;case s.props.showYearPicker:m=xF(s.state.date,s.props);break;case s.props.showQuarterYearPicker:m=fF(s.state.date,s.props);break;default:m=Av(u,s.props);break}if(!(!((l=s.props.forceShowMonthNavigation)!==null&&l!==void 0?l:t.defaultProps.forceShowMonthNavigation)&&!s.props.showDisabledMonthNavigation&&m||s.props.showTimeSelectOnly)){var p=["react-datepicker__navigation-icon","react-datepicker__navigation-icon--previous"],f=["react-datepicker__navigation","react-datepicker__navigation--previous"],y=s.decreaseMonth;(s.props.showMonthYearPicker||s.props.showQuarterYearPicker||s.props.showYearPicker)&&(y=s.decreaseYear),m&&s.props.showDisabledMonthNavigation&&(f.push("react-datepicker__navigation--previous--disabled"),y=void 0);var g=s.props.showMonthYearPicker||s.props.showQuarterYearPicker||s.props.showYearPicker,x=s.props,b=x.previousMonthButtonLabel,v=b===void 0?t.defaultProps.previousMonthButtonLabel:b,w=x.previousYearButtonLabel,N=w===void 0?t.defaultProps.previousYearButtonLabel:w,k=s.props,j=k.previousMonthAriaLabel,S=j===void 0?typeof v=="string"?v:"Previous Month":j,_=k.previousYearAriaLabel,C=_===void 0?typeof N=="string"?N:"Previous Year":_;return le.createElement("button",{type:"button",className:f.join(" "),onClick:y,onKeyDown:s.props.handleOnKeyDown,"aria-label":g?C:S},le.createElement("span",{className:p.join(" ")},g?N:v))}}},s.increaseYear=function(){s.setState(function(a){var i,l=a.date;return{date:va(l,s.props.showYearPicker?(i=s.props.yearItemNumber)!==null&&i!==void 0?i:t.defaultProps.yearItemNumber:1)}},function(){return s.handleYearChange(s.state.date)})},s.renderNextButton=function(){var a;if(!s.props.renderCustomHeader){var i;switch(!0){case s.props.showMonthYearPicker:i=Mv(s.state.date,s.props);break;case s.props.showYearPicker:i=yF(s.state.date,s.props);break;case s.props.showQuarterYearPicker:i=gF(s.state.date,s.props);break;default:i=Pv(s.state.date,s.props);break}if(!(!((a=s.props.forceShowMonthNavigation)!==null&&a!==void 0?a:t.defaultProps.forceShowMonthNavigation)&&!s.props.showDisabledMonthNavigation&&i||s.props.showTimeSelectOnly)){var l=["react-datepicker__navigation","react-datepicker__navigation--next"],o=["react-datepicker__navigation-icon","react-datepicker__navigation-icon--next"];s.props.showTimeSelect&&l.push("react-datepicker__navigation--next--with-time"),s.props.todayButton&&l.push("react-datepicker__navigation--next--with-today-button");var c=s.increaseMonth;(s.props.showMonthYearPicker||s.props.showQuarterYearPicker||s.props.showYearPicker)&&(c=s.increaseYear),i&&s.props.showDisabledMonthNavigation&&(l.push("react-datepicker__navigation--next--disabled"),c=void 0);var d=s.props.showMonthYearPicker||s.props.showQuarterYearPicker||s.props.showYearPicker,u=s.props,m=u.nextMonthButtonLabel,p=m===void 0?t.defaultProps.nextMonthButtonLabel:m,f=u.nextYearButtonLabel,y=f===void 0?t.defaultProps.nextYearButtonLabel:f,g=s.props,x=g.nextMonthAriaLabel,b=x===void 0?typeof p=="string"?p:"Next Month":x,v=g.nextYearAriaLabel,w=v===void 0?typeof y=="string"?y:"Next Year":v;return le.createElement("button",{type:"button",className:l.join(" "),onClick:c,onKeyDown:s.props.handleOnKeyDown,"aria-label":d?w:b},le.createElement("span",{className:o.join(" ")},d?y:p))}}},s.renderCurrentMonth=function(a){a===void 0&&(a=s.state.date);var i=["react-datepicker__current-month"];return s.props.showYearDropdown&&i.push("react-datepicker__current-month--hasYearDropdown"),s.props.showMonthDropdown&&i.push("react-datepicker__current-month--hasMonthDropdown"),s.props.showMonthYearDropdown&&i.push("react-datepicker__current-month--hasMonthYearDropdown"),le.createElement("h2",{className:i.join(" ")},br(a,s.props.dateFormat,s.props.locale))},s.renderYearDropdown=function(a){if(a===void 0&&(a=!1),!(!s.props.showYearDropdown||a))return le.createElement(FF,Rt({},t.defaultProps,s.props,{date:s.state.date,onChange:s.changeYear,year:Tt(s.state.date)}))},s.renderMonthDropdown=function(a){if(a===void 0&&(a=!1),!(!s.props.showMonthDropdown||a))return le.createElement(AF,Rt({},t.defaultProps,s.props,{month:bn(s.state.date),onChange:s.changeMonth}))},s.renderMonthYearDropdown=function(a){if(a===void 0&&(a=!1),!(!s.props.showMonthYearDropdown||a))return le.createElement(MF,Rt({},t.defaultProps,s.props,{date:s.state.date,onChange:s.changeMonthYear}))},s.handleTodayButtonClick=function(a){s.props.onSelect(Sv(),a),s.props.setPreSelection&&s.props.setPreSelection(Sv())},s.renderTodayButton=function(){if(!(!s.props.todayButton||s.props.showTimeSelectOnly))return le.createElement("div",{className:"react-datepicker__today-button",onClick:s.handleTodayButtonClick},s.props.todayButton)},s.renderDayNamesHeader=function(a){return le.createElement("div",{className:"react-datepicker__day-names",role:"row"},s.header(a))},s.renderDefaultHeader=function(a){var i=a.monthDate,l=a.i;return le.createElement("div",{className:"react-datepicker__header ".concat(s.props.showTimeSelect?"react-datepicker__header--has-time-select":"")},s.renderCurrentMonth(i),le.createElement("div",{className:"react-datepicker__header__dropdown react-datepicker__header__dropdown--".concat(s.props.dropdownMode),onFocus:s.handleDropdownFocus},s.renderMonthDropdown(l!==0),s.renderMonthYearDropdown(l!==0),s.renderYearDropdown(l!==0)))},s.renderCustomHeader=function(a){var i,l,o=a.monthDate,c=a.i;if(s.props.showTimeSelect&&!s.state.monthContainer||s.props.showTimeSelectOnly)return null;var d=s.props,u=d.showYearPicker,m=d.yearItemNumber,p;if(u){var f=xa(o,m),y=f.startPeriod,g=f.endPeriod;p={startYear:y,endYear:g}}var x=Av(s.state.date,s.props),b=Pv(s.state.date,s.props),v=Ov(s.state.date,s.props),w=Mv(s.state.date,s.props);return le.createElement("div",{className:"react-datepicker__header react-datepicker__header--custom",onFocus:s.props.onDropdownFocus},(l=(i=s.props).renderCustomHeader)===null||l===void 0?void 0:l.call(i,Rt(Rt(Rt({},s.state),u&&{visibleYearsRange:p}),{customHeaderCount:c,monthDate:o,changeMonth:s.changeMonth,changeYear:s.changeYear,decreaseMonth:s.decreaseMonth,increaseMonth:s.increaseMonth,decreaseYear:s.decreaseYear,increaseYear:s.increaseYear,prevMonthButtonDisabled:x,nextMonthButtonDisabled:b,prevYearButtonDisabled:v,nextYearButtonDisabled:w})))},s.renderYearHeader=function(a){var i=a.monthDate,l=s.props,o=l.showYearPicker,c=l.yearItemNumber,d=c===void 0?t.defaultProps.yearItemNumber:c,u=xa(i,d),m=u.startPeriod,p=u.endPeriod;return le.createElement("div",{className:"react-datepicker__header react-datepicker-year-header"},o?"".concat(m," - ").concat(p):Tt(i))},s.renderHeader=function(a){var i=a.monthDate,l=a.i,o=l===void 0?0:l,c={monthDate:i,i:o};switch(!0){case s.props.renderCustomHeader!==void 0:return s.renderCustomHeader(c);case(s.props.showMonthYearPicker||s.props.showQuarterYearPicker||s.props.showYearPicker):return s.renderYearHeader(c);default:return s.renderDefaultHeader(c)}},s.renderMonths=function(){var a,i;if(!(s.props.showTimeSelectOnly||s.props.showYearPicker)){for(var l=[],o=(a=s.props.monthsShown)!==null&&a!==void 0?a:t.defaultProps.monthsShown,c=s.props.showPreviousMonths?o-1:0,d=s.props.showMonthYearPicker||s.props.showQuarterYearPicker?va(s.state.date,c):Ca(s.state.date,c),u=(i=s.props.monthSelectedIn)!==null&&i!==void 0?i:c,m=0;m<o;++m){var p=m-u+c,f=s.props.showMonthYearPicker||s.props.showQuarterYearPicker?va(d,p):$s(d,p),y="month-".concat(m),g=m<o-1,x=m>0;l.push(le.createElement("div",{key:y,ref:function(b){s.monthContainer=b??void 0},className:"react-datepicker__month-container"},s.renderHeader({monthDate:f,i:m}),le.createElement(DF,Rt({},t.defaultProps,s.props,{containerRef:s.containerRef,ariaLabelPrefix:s.props.monthAriaLabelPrefix,day:f,onDayClick:s.handleDayClick,handleOnKeyDown:s.props.handleOnDayKeyDown,handleOnMonthKeyDown:s.props.handleOnKeyDown,onDayMouseEnter:s.handleDayMouseEnter,onMouseLeave:s.handleMonthMouseLeave,orderInDisplay:m,selectingDate:s.state.selectingDate,monthShowsDuplicateDaysEnd:g,monthShowsDuplicateDaysStart:x,dayNamesHeader:s.renderDayNamesHeader(f)}))))}return l}},s.renderYears=function(){if(!s.props.showTimeSelectOnly&&s.props.showYearPicker)return le.createElement("div",{className:"react-datepicker__year--container"},s.renderHeader({monthDate:s.state.date}),le.createElement(LF,Rt({},t.defaultProps,s.props,{selectingDate:s.state.selectingDate,date:s.state.date,onDayClick:s.handleDayClick,clearSelectingDate:s.clearSelectingDate,onYearMouseEnter:s.handleYearMouseEnter,onYearMouseLeave:s.handleYearMouseLeave})))},s.renderTimeSection=function(){if(s.props.showTimeSelect&&(s.state.monthContainer||s.props.showTimeSelectOnly))return le.createElement(IF,Rt({},t.defaultProps,s.props,{onChange:s.props.onTimeChange,format:s.props.timeFormat,intervals:s.props.timeIntervals,monthRef:s.state.monthContainer}))},s.renderInputTimeSection=function(){var a=s.props.selected?new Date(s.props.selected):void 0,i=a&&cm(a)&&!!s.props.selected,l=i?"".concat(Lv(a.getHours()),":").concat(Lv(a.getMinutes())):"";if(s.props.showTimeInput)return le.createElement(CF,Rt({},t.defaultProps,s.props,{date:a,timeString:l,onChange:s.props.onTimeChange}))},s.renderAriaLiveRegion=function(){var a,i=xa(s.state.date,(a=s.props.yearItemNumber)!==null&&a!==void 0?a:t.defaultProps.yearItemNumber),l=i.startPeriod,o=i.endPeriod,c;return s.props.showYearPicker?c="".concat(l," - ").concat(o):s.props.showMonthYearPicker||s.props.showQuarterYearPicker?c=Tt(s.state.date):c="".concat(Ix(bn(s.state.date),s.props.locale)," ").concat(Tt(s.state.date)),le.createElement("span",{role:"alert","aria-live":"polite",className:"react-datepicker__aria-live"},s.state.isRenderAriaLiveMessage&&c)},s.renderChildren=function(){if(s.props.children)return le.createElement("div",{className:"react-datepicker__children-container"},s.props.children)},s.containerRef=h.createRef(),s.state={date:s.getDateInView(),selectingDate:void 0,monthContainer:void 0,isRenderAriaLiveMessage:!1},s}return Object.defineProperty(t,"defaultProps",{get:function(){return{monthsShown:1,forceShowMonthNavigation:!1,outsideClickIgnoreClass:PS,timeCaption:"Time",previousYearButtonLabel:"Previous Year",nextYearButtonLabel:"Next Year",previousMonthButtonLabel:"Previous Month",nextMonthButtonLabel:"Next Month",yearItemNumber:kc}},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){var n=this;this.props.showTimeSelect&&(this.assignMonthContainer=function(){n.setState({monthContainer:n.monthContainer})}())},t.prototype.componentDidUpdate=function(n){var s=this;if(this.props.preSelection&&(!Lt(this.props.preSelection,n.preSelection)||this.props.monthSelectedIn!==n.monthSelectedIn)){var a=!Cn(this.state.date,this.props.preSelection);this.setState({date:this.props.preSelection},function(){return a&&s.handleCustomMonthChange(s.state.date)})}else this.props.openToDate&&!Lt(this.props.openToDate,n.openToDate)&&this.setState({date:this.props.openToDate})},t.prototype.render=function(){var n=this.props.container||rF;return le.createElement(om,{onClickOutside:this.handleClickOutside,style:{display:"contents"},ignoreClass:this.props.outsideClickIgnoreClass},le.createElement("div",{style:{display:"contents"},ref:this.containerRef},le.createElement(n,{className:xt("react-datepicker",this.props.className,{"react-datepicker--time-only":this.props.showTimeSelectOnly}),showTime:this.props.showTimeSelect||this.props.showTimeInput,showTimeSelectOnly:this.props.showTimeSelectOnly},this.renderAriaLiveRegion(),this.renderPreviousButton(),this.renderNextButton(),this.renderMonths(),this.renderYears(),this.renderTodayButton(),this.renderTimeSection(),this.renderInputTimeSection(),this.renderChildren())))},t}(h.Component),qF=function(e){var t=e.icon,n=e.className,s=n===void 0?"":n,a=e.onClick,i="react-datepicker__calendar-icon";if(typeof t=="string")return le.createElement("i",{className:"".concat(i," ").concat(t," ").concat(s),"aria-hidden":"true",onClick:a});if(le.isValidElement(t)){var l=t;return le.cloneElement(l,{className:"".concat(l.props.className||""," ").concat(i," ").concat(s),onClick:function(o){typeof l.props.onClick=="function"&&l.props.onClick(o),typeof a=="function"&&a(o)}})}return le.createElement("svg",{className:"".concat(i," ").concat(s),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",onClick:a},le.createElement("path",{d:"M96 32V64H48C21.5 64 0 85.5 0 112v48H448V112c0-26.5-21.5-48-48-48H352V32c0-17.7-14.3-32-32-32s-32 14.3-32 32V64H160V32c0-17.7-14.3-32-32-32S96 14.3 96 32zM448 192H0V464c0 26.5 21.5 48 48 48H400c26.5 0 48-21.5 48-48V192z"}))},OS=function(e){pn(t,e);function t(n){var s=e.call(this,n)||this;return s.portalRoot=null,s.el=document.createElement("div"),s}return t.prototype.componentDidMount=function(){this.portalRoot=(this.props.portalHost||document).getElementById(this.props.portalId),this.portalRoot||(this.portalRoot=document.createElement("div"),this.portalRoot.setAttribute("id",this.props.portalId),(this.props.portalHost||document.body).appendChild(this.portalRoot)),this.portalRoot.appendChild(this.el)},t.prototype.componentWillUnmount=function(){this.portalRoot&&this.portalRoot.removeChild(this.el)},t.prototype.render=function(){return EA.createPortal(this.props.children,this.el)},t}(h.Component),HF="[tabindex], a, button, input, select, textarea",WF=function(e){return(e instanceof HTMLAnchorElement||!e.disabled)&&e.tabIndex!==-1},MS=function(e){pn(t,e);function t(n){var s=e.call(this,n)||this;return s.getTabChildren=function(){var a;return Array.prototype.slice.call((a=s.tabLoopRef.current)===null||a===void 0?void 0:a.querySelectorAll(HF),1,-1).filter(WF)},s.handleFocusStart=function(){var a=s.getTabChildren();a&&a.length>1&&a[a.length-1].focus()},s.handleFocusEnd=function(){var a=s.getTabChildren();a&&a.length>1&&a[0].focus()},s.tabLoopRef=h.createRef(),s}return t.prototype.render=function(){var n;return((n=this.props.enableTabLoop)!==null&&n!==void 0?n:t.defaultProps.enableTabLoop)?le.createElement("div",{className:"react-datepicker__tab-loop",ref:this.tabLoopRef},le.createElement("div",{className:"react-datepicker__tab-loop__start",tabIndex:0,onFocus:this.handleFocusStart}),this.props.children,le.createElement("div",{className:"react-datepicker__tab-loop__end",tabIndex:0,onFocus:this.handleFocusEnd})):this.props.children},t.defaultProps={enableTabLoop:!0},t}(h.Component);function YF(e){function t(n){var s,a=typeof n.hidePopper=="boolean"?n.hidePopper:!0,i=h.useRef(null),l=tF(Rt({open:!a,whileElementsMounted:O$,placement:n.popperPlacement,middleware:Xs([U$({padding:15}),B$(10),q$({element:i})],(s=n.popperModifiers)!==null&&s!==void 0?s:[],!0)},n.popperProps)),o=Rt(Rt({},n),{hidePopper:a,popperProps:Rt(Rt({},l),{arrowRef:i})});return le.createElement(e,Rt({},o))}return t.displayName="withFloating(".concat(e.displayName||e.name||"Component",")"),t}var VF=function(e){var t=e.className,n=e.wrapperClassName,s=e.hidePopper,a=s===void 0?!0:s,i=e.popperComponent,l=e.targetComponent,o=e.enableTabLoop,c=e.popperOnKeyDown,d=e.portalId,u=e.portalHost,m=e.popperProps,p=e.showArrow,f=void 0;if(!a){var y=xt("react-datepicker-popper",t);f=le.createElement(MS,{enableTabLoop:o},le.createElement("div",{ref:m.refs.setFloating,style:m.floatingStyles,className:y,"data-placement":m.placement,onKeyDown:c},i,p&&le.createElement(G$,{ref:m.arrowRef,context:m.context,fill:"currentColor",strokeWidth:1,height:8,width:16,style:{transform:"translateY(-1px)"},className:"react-datepicker__triangle"})))}e.popperContainer&&(f=h.createElement(e.popperContainer,{},f)),d&&!a&&(f=le.createElement(OS,{portalId:d,portalHost:u},f));var g=xt("react-datepicker-wrapper",n);return le.createElement(le.Fragment,null,le.createElement("div",{ref:m.refs.setReference,className:g},l),f)},GF=YF(VF);function KF(e,t){return e&&t?bn(e)!==bn(t)||Tt(e)!==Tt(t):e!==t}var Sh="Date input not valid.",Bv=function(e){pn(t,e);function t(n){var s=e.call(this,n)||this;return s.calendar=null,s.input=null,s.getPreSelection=function(){return s.props.openToDate?s.props.openToDate:s.props.selectsEnd&&s.props.startDate?s.props.startDate:s.props.selectsStart&&s.props.endDate?s.props.endDate:er()},s.modifyHolidays=function(){var a;return(a=s.props.holidays)===null||a===void 0?void 0:a.reduce(function(i,l){var o=new Date(l.date);return cm(o)?Xs(Xs([],i,!0),[Rt(Rt({},l),{date:o})],!1):i},[])},s.calcInitialState=function(){var a,i=s.getPreSelection(),l=DS(s.props),o=TS(s.props),c=l&&Ks(i,Md(l))?l:o&&ui(i,_v(o))?o:i;return{open:s.props.startOpen||!1,preventFocus:!1,inputValue:null,preSelection:(a=s.props.selectsRange?s.props.startDate:s.props.selected)!==null&&a!==void 0?a:c,highlightDates:Iv(s.props.highlightDates),focused:!1,shouldFocusDayInline:!1,isRenderAriaLiveMessage:!1,wasHidden:!1}},s.getInputValue=function(){var a,i=s.props,l=i.locale,o=i.startDate,c=i.endDate,d=i.rangeSeparator,u=i.selected,m=i.selectedDates,p=i.selectsMultiple,f=i.selectsRange,y=i.value,g=(a=s.props.dateFormat)!==null&&a!==void 0?a:t.defaultProps.dateFormat,x=s.state.inputValue;return typeof y=="string"?y:typeof x=="string"?x:f?sF(o,c,{dateFormat:g,locale:l,rangeSeparator:d}):p?aF(m??[],{dateFormat:g,locale:l}):os(u,{dateFormat:g,locale:l})},s.resetHiddenStatus=function(){s.setState(Rt(Rt({},s.state),{wasHidden:!1}))},s.setHiddenStatus=function(){s.setState(Rt(Rt({},s.state),{wasHidden:!0}))},s.setHiddenStateOnVisibilityHidden=function(){document.visibilityState==="hidden"&&s.setHiddenStatus()},s.clearPreventFocusTimeout=function(){s.preventFocusTimeout&&clearTimeout(s.preventFocusTimeout)},s.setFocus=function(){var a,i;(i=(a=s.input)===null||a===void 0?void 0:a.focus)===null||i===void 0||i.call(a,{preventScroll:!0})},s.setBlur=function(){var a,i;(i=(a=s.input)===null||a===void 0?void 0:a.blur)===null||i===void 0||i.call(a),s.cancelFocusInput()},s.deferBlur=function(){requestAnimationFrame(function(){s.setBlur()})},s.setOpen=function(a,i){i===void 0&&(i=!1),s.setState({open:a,preSelection:a&&s.state.open?s.state.preSelection:s.calcInitialState().preSelection,lastPreSelectChange:_h},function(){a||s.setState(function(l){return{focused:i?l.focused:!1}},function(){!i&&s.deferBlur(),s.setState({inputValue:null})})})},s.inputOk=function(){return wa(s.state.preSelection)},s.isCalendarOpen=function(){return s.props.open===void 0?s.state.open&&!s.props.disabled&&!s.props.readOnly:s.props.open},s.handleFocus=function(a){var i,l,o=s.state.wasHidden,c=o?s.state.open:!0;o&&s.resetHiddenStatus(),s.state.preventFocus||((l=(i=s.props).onFocus)===null||l===void 0||l.call(i,a),c&&!s.props.preventOpenOnFocus&&!s.props.readOnly&&s.setOpen(!0)),s.setState({focused:!0})},s.sendFocusBackToInput=function(){s.preventFocusTimeout&&s.clearPreventFocusTimeout(),s.setState({preventFocus:!0},function(){s.preventFocusTimeout=setTimeout(function(){s.setFocus(),s.setState({preventFocus:!1})})})},s.cancelFocusInput=function(){clearTimeout(s.inputFocusTimeout),s.inputFocusTimeout=void 0},s.deferFocusInput=function(){s.cancelFocusInput(),s.inputFocusTimeout=setTimeout(function(){return s.setFocus()},1)},s.handleDropdownFocus=function(){s.cancelFocusInput()},s.resetInputValue=function(){s.setState(Rt(Rt({},s.state),{inputValue:null}))},s.handleBlur=function(a){var i,l;(!s.state.open||s.props.withPortal||s.props.showTimeInput)&&((l=(i=s.props).onBlur)===null||l===void 0||l.call(i,a)),s.resetInputValue(),s.state.open&&s.props.open===!1&&s.setOpen(!1),s.setState({focused:!1})},s.handleCalendarClickOutside=function(a){var i,l;s.props.inline||s.setOpen(!1),(l=(i=s.props).onClickOutside)===null||l===void 0||l.call(i,a),s.props.withPortal&&a.preventDefault()},s.handleChange=function(){for(var a,i,l,o,c,d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];var m=d[0];if(!(s.props.onChangeRaw&&(s.props.onChangeRaw.apply(s,d),!m||typeof m.isDefaultPrevented!="function"||m.isDefaultPrevented()))){s.setState({inputValue:(m==null?void 0:m.target)instanceof HTMLInputElement?m.target.value:null,lastPreSelectChange:XF});var p=s.props,f=p.selectsRange,y=p.startDate,g=p.endDate,x=(a=s.props.dateFormat)!==null&&a!==void 0?a:t.defaultProps.dateFormat,b=(i=s.props.strictParsing)!==null&&i!==void 0?i:t.defaultProps.strictParsing,v=(m==null?void 0:m.target)instanceof HTMLInputElement?m.target.value:"";if(f){var w=s.props.rangeSeparator,N=w.trim(),k=v.split(x.includes(N)?w:N,2).map(function(T){return T.trim()}),j=k[0],S=k[1],_=jh(j??"",x,s.props.locale,b),C=_?jh(S??"",x,s.props.locale,b):null,D=(y==null?void 0:y.getTime())!==(_==null?void 0:_.getTime()),A=(g==null?void 0:g.getTime())!==(C==null?void 0:C.getTime());if(!D&&!A||_&&us(_,s.props)||C&&us(C,s.props))return;(o=(l=s.props).onChange)===null||o===void 0||o.call(l,[_,C],m)}else{var E=jh(v,x,s.props.locale,b,(c=s.props.selected)!==null&&c!==void 0?c:void 0);(E||!v)&&s.setSelected(E,m,!0)}}},s.handleSelect=function(a,i,l){if(!s.props.readOnly){var o=s.props,c=o.selectsRange,d=o.startDate,u=o.endDate,m=o.swapRange,p=!c||d&&!u&&(m||!Ch(a,d));s.props.shouldCloseOnSelect&&!s.props.showTimeSelect&&p&&s.sendFocusBackToInput(),s.props.onChangeRaw&&s.props.onChangeRaw(i),s.setSelected(a,i,!1,l),s.props.showDateSelect&&s.setState({isRenderAriaLiveMessage:!0}),!s.props.shouldCloseOnSelect||s.props.showTimeSelect?s.setPreSelection(a):p&&s.setOpen(!1)}},s.setSelected=function(a,i,l,o){var c,d,u=a;if(s.props.showYearPicker){if(u!==null&&Id(Tt(u),s.props))return}else if(s.props.showMonthYearPicker){if(u!==null&&ES(u,s.props))return}else if(u!==null&&us(u,s.props))return;var m=s.props,p=m.onChange,f=m.selectsRange,y=m.startDate,g=m.endDate,x=m.selectsMultiple,b=m.selectedDates,v=m.minTime,w=m.swapRange;if(!Oi(s.props.selected,u)||s.props.allowSameDay||f||x)if(u!==null&&(s.props.selected&&(!l||!s.props.showTimeSelect&&!s.props.showTimeSelectOnly&&!s.props.showTimeInput)&&(u=Nh(u,{hour:ja(s.props.selected),minute:Na(s.props.selected),second:ai(s.props.selected)})),!l&&(s.props.showTimeSelect||s.props.showTimeSelectOnly)&&v&&(u=Nh(u,{hour:v.getHours(),minute:v.getMinutes(),second:v.getSeconds()})),s.props.inline||s.setState({preSelection:u}),s.props.focusSelectedMonth||s.setState({monthSelectedIn:o})),f){var N=!y&&!g,k=y&&!g,j=!y&&!!g,S=y&&g;N?p==null||p([u,null],i):k?u===null?p==null||p([null,null],i):Ch(u,y)?w?p==null||p([u,y],i):p==null||p([u,null],i):p==null||p([y,u],i):j&&(u&&Ch(u,g)?p==null||p([u,g],i):p==null||p([u,null],i)),S&&(p==null||p([u,null],i))}else if(x){if(u!==null)if(!(b!=null&&b.length))p==null||p([u],i);else{var _=b.some(function(D){return Lt(D,u)});if(_){var C=b.filter(function(D){return!Lt(D,u)});p==null||p(C,i)}else p==null||p(Xs(Xs([],b,!0),[u],!1),i)}}else p==null||p(u,i);l||((d=(c=s.props).onSelect)===null||d===void 0||d.call(c,u,i),s.setState({inputValue:null}))},s.setPreSelection=function(a){if(!s.props.readOnly){var i=wa(s.props.minDate),l=wa(s.props.maxDate),o=!0;if(a){var c=Md(a);if(i&&l)o=Ei(a,s.props.minDate,s.props.maxDate);else if(i){var d=Md(s.props.minDate);o=ui(a,d)||Oi(c,d)}else if(l){var u=_v(s.props.maxDate);o=Ks(a,u)||Oi(c,u)}}o&&s.setState({preSelection:a})}},s.toggleCalendar=function(){s.setOpen(!s.state.open)},s.handleTimeChange=function(a){var i,l;if(!(s.props.selectsRange||s.props.selectsMultiple)){var o=s.props.selected?s.props.selected:s.getPreSelection(),c=s.props.selected?a:Nh(o,{hour:ja(a),minute:Na(a)});s.setState({preSelection:c}),(l=(i=s.props).onChange)===null||l===void 0||l.call(i,c),s.props.shouldCloseOnSelect&&!s.props.showTimeInput&&(s.sendFocusBackToInput(),s.setOpen(!1)),s.props.showTimeInput&&s.setOpen(!0),(s.props.showTimeSelectOnly||s.props.showTimeSelect)&&s.setState({isRenderAriaLiveMessage:!0}),s.setState({inputValue:null})}},s.onInputClick=function(){var a,i;!s.props.disabled&&!s.props.readOnly&&s.setOpen(!0),(i=(a=s.props).onInputClick)===null||i===void 0||i.call(a)},s.onInputKeyDown=function(a){var i,l,o,c,d,u;(l=(i=s.props).onKeyDown)===null||l===void 0||l.call(i,a);var m=a.key;if(!s.state.open&&!s.props.inline&&!s.props.preventOpenOnFocus){(m===Ge.ArrowDown||m===Ge.ArrowUp||m===Ge.Enter)&&((o=s.onInputClick)===null||o===void 0||o.call(s));return}if(s.state.open){if(m===Ge.ArrowDown||m===Ge.ArrowUp){a.preventDefault();var p=s.props.showTimeSelectOnly?".react-datepicker__time-list-item[tabindex='0']":s.props.showWeekPicker&&s.props.showWeekNumbers?'.react-datepicker__week-number[tabindex="0"]':s.props.showFullMonthYearPicker||s.props.showMonthYearPicker?'.react-datepicker__month-text[tabindex="0"]':'.react-datepicker__day[tabindex="0"]',f=((c=s.calendar)===null||c===void 0?void 0:c.containerRef.current)instanceof Element&&s.calendar.containerRef.current.querySelector(p);f instanceof HTMLElement&&f.focus({preventScroll:!0});return}var y=er(s.state.preSelection);m===Ge.Enter?(a.preventDefault(),a.target.blur(),s.inputOk()&&s.state.lastPreSelectChange===_h?(s.handleSelect(y,a),!s.props.shouldCloseOnSelect&&s.setPreSelection(y)):s.setOpen(!1)):m===Ge.Escape?(a.preventDefault(),a.target.blur(),s.sendFocusBackToInput(),s.setOpen(!1)):m===Ge.Tab&&s.setOpen(!1),s.inputOk()||(u=(d=s.props).onInputError)===null||u===void 0||u.call(d,{code:1,msg:Sh})}},s.onPortalKeyDown=function(a){var i=a.key;i===Ge.Escape&&(a.preventDefault(),s.setState({preventFocus:!0},function(){s.setOpen(!1),setTimeout(function(){s.setFocus(),s.setState({preventFocus:!1})})}))},s.onDayKeyDown=function(a){var i,l,o,c,d,u,m=s.props,p=m.minDate,f=m.maxDate,y=m.disabledKeyboardNavigation,g=m.showWeekPicker,x=m.shouldCloseOnSelect,b=m.locale,v=m.calendarStartDay,w=m.adjustDateOnChange,N=m.inline;if((l=(i=s.props).onKeyDown)===null||l===void 0||l.call(i,a),!y){var k=a.key,j=a.shiftKey,S=er(s.state.preSelection),_=function(L,P){var $=P;switch(L){case Ge.ArrowRight:$=g?Xd(P,1):Rs(P,1);break;case Ge.ArrowLeft:$=g?hv(P):vR(P);break;case Ge.ArrowUp:$=hv(P);break;case Ge.ArrowDown:$=Xd(P,1);break;case Ge.PageUp:$=j?Xi(P,1):Ca(P,1);break;case Ge.PageDown:$=j?va(P,1):$s(P,1);break;case Ge.Home:$=ii(P,b,v);break;case Ge.End:$=oF(P);break}return $},C=function(L,P){for(var $=40,R=L,U=!1,I=0,z=_(L,P);!U;){if(I>=$){z=P;break}p&&z<p&&(R=Ge.ArrowRight,z=us(p,s.props)?_(R,z):p),f&&z>f&&(R=Ge.ArrowLeft,z=us(f,s.props)?_(R,z):f),us(z,s.props)?((R===Ge.PageUp||R===Ge.Home)&&(R=Ge.ArrowRight),(R===Ge.PageDown||R===Ge.End)&&(R=Ge.ArrowLeft),z=_(R,z)):U=!0,I++}return z};if(k===Ge.Enter){a.preventDefault(),s.handleSelect(S,a),!x&&s.setPreSelection(S);return}else if(k===Ge.Escape){a.preventDefault(),s.setOpen(!1),s.inputOk()||(c=(o=s.props).onInputError)===null||c===void 0||c.call(o,{code:1,msg:Sh});return}var D=null;switch(k){case Ge.ArrowLeft:case Ge.ArrowRight:case Ge.ArrowUp:case Ge.ArrowDown:case Ge.PageUp:case Ge.PageDown:case Ge.Home:case Ge.End:D=C(k,S);break}if(!D){(u=(d=s.props).onInputError)===null||u===void 0||u.call(d,{code:1,msg:Sh});return}if(a.preventDefault(),s.setState({lastPreSelectChange:_h}),w&&s.setSelected(D),s.setPreSelection(D),N){var A=bn(S),E=bn(D),T=Tt(S),M=Tt(D);A!==E||T!==M?s.setState({shouldFocusDayInline:!0}):s.setState({shouldFocusDayInline:!1})}}},s.onPopperKeyDown=function(a){var i=a.key;i===Ge.Escape&&(a.preventDefault(),s.sendFocusBackToInput(),s.setOpen(!1))},s.onClearClick=function(a){a&&a.preventDefault&&a.preventDefault(),s.sendFocusBackToInput();var i=s.props,l=i.selectsRange,o=i.onChange;l?o==null||o([null,null],a):o==null||o(null,a),s.setState({inputValue:null})},s.clear=function(){s.onClearClick()},s.onScroll=function(a){typeof s.props.closeOnScroll=="boolean"&&s.props.closeOnScroll?(a.target===document||a.target===document.documentElement||a.target===document.body)&&s.setOpen(!1):typeof s.props.closeOnScroll=="function"&&s.props.closeOnScroll(a)&&s.setOpen(!1)},s.renderCalendar=function(){var a,i;return!s.props.inline&&!s.isCalendarOpen()?null:le.createElement(UF,Rt({showMonthYearDropdown:void 0,ref:function(l){s.calendar=l}},s.props,s.state,{setOpen:s.setOpen,dateFormat:(a=s.props.dateFormatCalendar)!==null&&a!==void 0?a:t.defaultProps.dateFormatCalendar,onSelect:s.handleSelect,onClickOutside:s.handleCalendarClickOutside,holidays:vF(s.modifyHolidays()),outsideClickIgnoreClass:s.props.outsideClickIgnoreClass,onDropdownFocus:s.handleDropdownFocus,onTimeChange:s.handleTimeChange,className:s.props.calendarClassName,container:s.props.calendarContainer,handleOnKeyDown:s.props.onKeyDown,handleOnDayKeyDown:s.onDayKeyDown,setPreSelection:s.setPreSelection,dropdownMode:(i=s.props.dropdownMode)!==null&&i!==void 0?i:t.defaultProps.dropdownMode}),s.props.children)},s.renderAriaLiveRegion=function(){var a,i=s.props.locale,l=(a=s.props.dateFormat)!==null&&a!==void 0?a:t.defaultProps.dateFormat,o=s.props.showTimeInput||s.props.showTimeSelect,c=o?"PPPPp":"PPPP",d;return s.props.selectsRange?d="Selected start date: ".concat(os(s.props.startDate,{dateFormat:c,locale:i}),". ").concat(s.props.endDate?"End date: "+os(s.props.endDate,{dateFormat:c,locale:i}):""):s.props.showTimeSelectOnly?d="Selected time: ".concat(os(s.props.selected,{dateFormat:l,locale:i})):s.props.showYearPicker?d="Selected year: ".concat(os(s.props.selected,{dateFormat:"yyyy",locale:i})):s.props.showMonthYearPicker?d="Selected month: ".concat(os(s.props.selected,{dateFormat:"MMMM yyyy",locale:i})):s.props.showQuarterYearPicker?d="Selected quarter: ".concat(os(s.props.selected,{dateFormat:"yyyy, QQQ",locale:i})):d="Selected date: ".concat(os(s.props.selected,{dateFormat:c,locale:i})),le.createElement("span",{role:"alert","aria-live":"polite",className:"react-datepicker__aria-live"},d)},s.renderDateInput=function(){var a,i,l=xt(s.props.className,(a={},a[s.props.outsideClickIgnoreClass||t.defaultProps.outsideClickIgnoreClass]=s.state.open,a)),o=s.props.customInput||le.createElement("input",{type:"text"}),c=s.props.customInputRef||"ref";return h.cloneElement(o,(i={},i[c]=function(d){s.input=d},i.value=s.getInputValue(),i.onBlur=s.handleBlur,i.onChange=s.handleChange,i.onClick=s.onInputClick,i.onFocus=s.handleFocus,i.onKeyDown=s.onInputKeyDown,i.id=s.props.id,i.name=s.props.name,i.form=s.props.form,i.autoFocus=s.props.autoFocus,i.placeholder=s.props.placeholderText,i.disabled=s.props.disabled,i.autoComplete=s.props.autoComplete,i.className=xt(o.props.className,l),i.title=s.props.title,i.readOnly=s.props.readOnly,i.required=s.props.required,i.tabIndex=s.props.tabIndex,i["aria-describedby"]=s.props.ariaDescribedBy,i["aria-invalid"]=s.props.ariaInvalid,i["aria-labelledby"]=s.props.ariaLabelledBy,i["aria-required"]=s.props.ariaRequired,i))},s.renderClearButton=function(){var a=s.props,i=a.isClearable,l=a.disabled,o=a.selected,c=a.startDate,d=a.endDate,u=a.clearButtonTitle,m=a.clearButtonClassName,p=m===void 0?"":m,f=a.ariaLabelClose,y=f===void 0?"Close":f,g=a.selectedDates,x=a.readOnly;return i&&!x&&(o!=null||c!=null||d!=null||g!=null&&g.length)?le.createElement("button",{type:"button",className:xt("react-datepicker__close-icon",p,{"react-datepicker__close-icon--disabled":l}),disabled:l,"aria-label":y,onClick:s.onClearClick,title:u,tabIndex:-1}):null},s.state=s.calcInitialState(),s.preventFocusTimeout=void 0,s}return Object.defineProperty(t,"defaultProps",{get:function(){return{allowSameDay:!1,dateFormat:"MM/dd/yyyy",dateFormatCalendar:"LLLL yyyy",disabled:!1,disabledKeyboardNavigation:!1,dropdownMode:"scroll",preventOpenOnFocus:!1,monthsShown:1,outsideClickIgnoreClass:PS,readOnly:!1,rangeSeparator:SS,withPortal:!1,selectsDisabledDaysInRange:!1,shouldCloseOnSelect:!0,showTimeSelect:!1,showTimeInput:!1,showPreviousMonths:!1,showMonthYearPicker:!1,showFullMonthYearPicker:!1,showTwoColumnMonthYearPicker:!1,showFourColumnMonthYearPicker:!1,showYearPicker:!1,showQuarterYearPicker:!1,showWeekPicker:!1,strictParsing:!1,swapRange:!1,timeIntervals:30,timeCaption:"Time",previousMonthAriaLabel:"Previous Month",previousMonthButtonLabel:"Previous Month",nextMonthAriaLabel:"Next Month",nextMonthButtonLabel:"Next Month",previousYearAriaLabel:"Previous Year",previousYearButtonLabel:"Previous Year",nextYearAriaLabel:"Next Year",nextYearButtonLabel:"Next Year",timeInputLabel:"Time",enableTabLoop:!0,yearItemNumber:kc,focusSelectedMonth:!1,showPopperArrow:!0,excludeScrollbar:!0,customTimeInput:null,calendarStartDay:void 0,toggleCalendarOnIconClick:!1,usePointerEvent:!1}},enumerable:!1,configurable:!0}),t.prototype.componentDidMount=function(){window.addEventListener("scroll",this.onScroll,!0),document.addEventListener("visibilitychange",this.setHiddenStateOnVisibilityHidden)},t.prototype.componentDidUpdate=function(n,s){var a,i,l,o;n.inline&&KF(n.selected,this.props.selected)&&this.setPreSelection(this.props.selected),this.state.monthSelectedIn!==void 0&&n.monthsShown!==this.props.monthsShown&&this.setState({monthSelectedIn:0}),n.highlightDates!==this.props.highlightDates&&this.setState({highlightDates:Iv(this.props.highlightDates)}),!s.focused&&!Oi(n.selected,this.props.selected)&&this.setState({inputValue:null}),s.open!==this.state.open&&(s.open===!1&&this.state.open===!0&&((i=(a=this.props).onCalendarOpen)===null||i===void 0||i.call(a)),s.open===!0&&this.state.open===!1&&((o=(l=this.props).onCalendarClose)===null||o===void 0||o.call(l)))},t.prototype.componentWillUnmount=function(){this.clearPreventFocusTimeout(),window.removeEventListener("scroll",this.onScroll,!0),document.removeEventListener("visibilitychange",this.setHiddenStateOnVisibilityHidden)},t.prototype.renderInputContainer=function(){var n=this.props,s=n.showIcon,a=n.icon,i=n.calendarIconClassname,l=n.calendarIconClassName,o=n.toggleCalendarOnIconClick,c=this.state.open;return i&&console.warn("calendarIconClassname props is deprecated. should use calendarIconClassName props."),le.createElement("div",{className:"react-datepicker__input-container".concat(s?" react-datepicker__view-calendar-icon":"")},s&&le.createElement(qF,Rt({icon:a,className:xt(l,!l&&i,c&&"react-datepicker-ignore-onclickoutside")},o?{onClick:this.toggleCalendar}:null)),this.state.isRenderAriaLiveMessage&&this.renderAriaLiveRegion(),this.renderDateInput(),this.renderClearButton())},t.prototype.render=function(){var n=this.renderCalendar();if(this.props.inline)return n;if(this.props.withPortal){var s=this.state.open?le.createElement(MS,{enableTabLoop:this.props.enableTabLoop},le.createElement("div",{className:"react-datepicker__portal",tabIndex:-1,onKeyDown:this.onPortalKeyDown},n)):null;return this.state.open&&this.props.portalId&&(s=le.createElement(OS,Rt({portalId:this.props.portalId},this.props),s)),le.createElement("div",null,this.renderInputContainer(),s)}return le.createElement(GF,Rt({},this.props,{className:this.props.popperClassName,hidePopper:!this.isCalendarOpen(),targetComponent:this.renderInputContainer(),popperComponent:n,popperOnKeyDown:this.onPopperKeyDown,showArrow:this.props.showPopperArrow}))},t}(h.Component),XF="input",_h="navigate";const ko=({title:e,icon:t,children:n,defaultOpen:s=!1,className:a=""})=>{const[i,l]=h.useState(s);return r.jsxs("div",{className:a,children:[r.jsxs("button",{onClick:()=>l(!i),className:"flex items-center justify-between w-full py-2 text-xs font-semibold text-gray-700 uppercase tracking-wide hover:text-gray-900 transition-colors",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[t&&r.jsx(t,{className:"w-4 h-4"}),r.jsx("span",{children:e})]}),r.jsx(Xt,{className:`w-4 h-4 transition-transform ${i?"rotate-180":""}`})]}),r.jsx(ht,{children:i&&r.jsx(de.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:r.jsx("div",{className:"pt-2 pb-3 space-y-3",children:n})})})]})},Eh=({options:e,value:t,onChange:n,className:s=""})=>r.jsx("div",{className:`inline-flex bg-gray-100 rounded-lg p-1 ${s}`,children:e.map(a=>r.jsx("button",{onClick:()=>n(a.value),className:`
            px-3 py-2 text-sm font-medium rounded transition-all
            ${t===a.value?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}
          `,children:a.label},a.value))}),JF=({mode:e="overview",dateFilter:t,setDateFilter:n,clearFilter:s,setPreset:a,limitEnabled:i,setLimitEnabled:l,dataLimit:o,setDataLimit:c,selectedMetric:d,setSelectedMetric:u,showUnknown:m,setShowUnknown:p,showBenchmark:f,setShowBenchmark:y,showConcentration:g,setShowConcentration:x,topN:b,setTopN:v,onApply:w,onReset:N})=>{const[k,j]=h.useState((t==null?void 0:t.startDate)||null),[S,_]=h.useState((t==null?void 0:t.endDate)||null),C=[{id:"last_3_months",label:"Last 3M"},{id:"last_6_months",label:"Last 6M"},{id:"last_year",label:"Last Year"},{id:"all_time",label:"All Time"}],D=T=>{a(T),w==null||w()},A=()=>{k&&S&&(n({startDate:k,endDate:S,label:"Custom Range"}),w==null||w())},E=()=>{j(null),_(null),s==null||s(),l==null||l(!1),p==null||p(!1),y==null||y(!1),x==null||x(!1),N==null||N()};return r.jsxs("div",{className:"w-[380px]",style:{maxHeight:"448px"},children:[r.jsxs("div",{className:"overflow-y-auto space-y-4 px-1",style:{maxHeight:"360px"},children:[e==="overview"&&r.jsx(ko,{title:"Date",icon:yt,defaultOpen:!0,children:r.jsxs("div",{className:"space-y-3",children:[r.jsx("div",{className:"grid grid-cols-2 gap-2",children:C.map(T=>r.jsx("button",{onClick:()=>D(T.id),className:"px-3 py-2 text-sm font-medium rounded-lg border border-gray-200 hover:border-purple-300 hover:bg-purple-50 transition-all",children:T.label},T.id))}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-medium text-gray-600 block",children:"Custom Range"}),r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsx(Bv,{selected:k,onChange:T=>j(T),selectsStart:!0,startDate:k,endDate:S,maxDate:S||new Date,className:"w-full px-2 py-2 text-xs border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholderText:"Start",dateFormat:"MMM d, yyyy"}),r.jsx(Bv,{selected:S,onChange:T=>_(T),selectsEnd:!0,startDate:k,endDate:S,minDate:k,maxDate:new Date,className:"w-full px-2 py-2 text-xs border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholderText:"End",dateFormat:"MMM d, yyyy"})]})]})]})}),e==="comparative"&&r.jsxs(ko,{title:"Metric",icon:Ot,defaultOpen:!0,children:[r.jsx(Eh,{options:[{value:"revenue",label:"Revenue"},{value:"profit",label:"Profit"},{value:"volume",label:"Volume"}],value:d,onChange:u,className:"w-full"}),r.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Compare entities by metric"})]}),e==="overview"&&r.jsxs(ko,{title:"Limits",icon:cb,defaultOpen:!0,children:[r.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[r.jsx("button",{onClick:()=>l(!i),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${i?"bg-purple-600":"bg-gray-200"}`,children:r.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${i?"translate-x-6":"translate-x-1"}`})}),r.jsx("span",{className:"text-xs text-gray-700",children:"Limit results"})]}),i&&r.jsx(Eh,{options:[{value:10,label:"10"},{value:25,label:"25"},{value:50,label:"50"},{value:100,label:"100"}],value:o,onChange:c,className:"w-full"})]}),e==="comparative"&&r.jsx(ko,{title:"Advanced",icon:cb,children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-xs font-medium text-gray-700",children:"Unknown entities"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Show unidentified records"})]}),r.jsx("button",{onClick:()=>p(!m),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${m?"bg-purple-600":"bg-gray-200"}`,children:r.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${m?"translate-x-6":"translate-x-1"}`})})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-xs font-medium text-gray-700",children:"Median line"}),r.jsx("p",{className:"text-xs text-gray-500",children:"50th percentile"})]}),r.jsx("button",{onClick:()=>y(!f),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${f?"bg-purple-600":"bg-gray-200"}`,children:r.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${f?"translate-x-6":"translate-x-1"}`})})]})]})}),e==="comparative"&&r.jsx(ko,{title:"Concentration",icon:Ot,children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("button",{onClick:()=>x(!g),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${g?"bg-purple-600":"bg-gray-200"}`,children:r.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${g?"translate-x-6":"translate-x-1"}`})}),r.jsx("span",{className:"text-xs text-gray-700",children:"Show revenue concentration"})]}),g&&r.jsxs("div",{children:[r.jsx("label",{className:"text-xs font-medium text-gray-600 block mb-2",children:"Top N"}),r.jsx(Eh,{options:[{value:3,label:"3"},{value:5,label:"5"},{value:10,label:"10"},{value:25,label:"25"}],value:b,onChange:v,className:"w-full"})]})]})})]}),r.jsxs("div",{className:"border-t border-gray-200 p-3 flex items-center justify-between bg-white",children:[r.jsx("button",{onClick:E,className:"px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 transition-colors",children:"Reset"}),r.jsx("button",{onClick:e==="overview"?A:w,disabled:e==="overview"&&(!k||!S),className:"px-4 py-2 text-sm font-medium bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Apply"})]})]})},QF=({availableTables:e,tablesLoading:t,selectedTable:n,onTableChange:s,onClose:a})=>r.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:t?r.jsxs("div",{className:"flex items-center justify-center py-4",children:[r.jsx(Be,{className:"w-4 h-4 animate-spin text-gray-400 mr-2"}),r.jsx("span",{className:"text-sm text-gray-500",children:"Loading tables..."})]}):e.length===0?r.jsxs("div",{className:"py-4 text-center",children:[r.jsx(qn,{className:"w-8 h-8 text-gray-300 mx-auto mb-2"}),r.jsx("p",{className:"text-sm text-gray-500",children:"No tables available"}),r.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Upload data to see available tables"})]}):e.map(i=>{const l=typeof i=="string"?i:(i==null?void 0:i.table_name)||(i==null?void 0:i.name)||"Unknown",o=typeof i=="object"?i==null?void 0:i.row_count:null,c=n===l;return r.jsx("button",{onClick:()=>{s(l),a()},className:`
                w-full text-left p-3 rounded-lg transition-all duration-200 group
                ${c?"bg-purple-50 border-2 border-purple-200 text-purple-800":"hover:bg-gray-50 border-2 border-transparent text-gray-700"}
              `,children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`
                    p-2 rounded-md transition-colors
                    ${c?"bg-purple-100 text-purple-600":"bg-gray-100 text-gray-500 group-hover:bg-gray-200"}
                  `,children:r.jsx(qn,{className:"w-4 h-4"})}),r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-sm",children:l}),c&&r.jsx("div",{className:"text-xs text-purple-600 mt-0.5",children:"Currently selected"})]})]}),o!==null&&r.jsxs("div",{className:"text-xs text-gray-500 font-medium",children:[o.toLocaleString()," rows"]})]})},l)})}),ZF=({selectedTable:e,availableTables:t=[],tablesLoading:n=!1,onTableChange:s,className:a=""})=>{const[i,l]=h.useState(!1),o=n?"Loading...":e||"No Table Selected";return r.jsxs("div",{className:`relative ${a}`,children:[r.jsxs("button",{onClick:()=>l(!i),className:"flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors border border-gray-300 hover:bg-gray-50","aria-label":"Select data table","aria-expanded":i,"aria-haspopup":"dialog",children:[r.jsx(qn,{className:"w-4 h-4 text-gray-600"}),r.jsx("span",{className:"text-gray-700",children:"Table:"}),r.jsx("span",{className:"text-gray-900 font-semibold",children:o}),r.jsx(Xt,{className:`w-4 h-4 text-gray-500 transition-transform ${i?"rotate-180":""}`})]}),r.jsx(ht,{children:i&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-20",onClick:()=>l(!1),"aria-hidden":"true"}),r.jsx(de.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.15,ease:"easeOut"},className:"absolute top-full left-0 mt-2 z-30 w-80",role:"dialog","aria-label":"Select data table",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200",children:[r.jsx("div",{className:"px-4 py-3 border-b border-gray-100",children:r.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Select Data Table"})}),r.jsx("div",{className:"p-4",children:r.jsx(QF,{availableTables:t,tablesLoading:n,selectedTable:e,onTableChange:s,onClose:()=>l(!1)})})]})})]})})]})},Uv=({primaryAction:e,mode:t="overview",selectedTable:n,availableTables:s,tablesLoading:a,onTableChange:i,dateFilter:l,setDateFilter:o,clearDateFilter:c,setDatePreset:d,limitEnabled:u,setLimitEnabled:m,dataLimit:p,setDataLimit:f,selectedMetric:y,setSelectedMetric:g,showUnknown:x,setShowUnknown:b,showBenchmark:v,setShowBenchmark:w,showConcentration:N,setShowConcentration:k,topN:j,setTopN:S,themeColor:_="purple",className:C="",...D})=>{const A=h.useMemo(()=>{let E=0;return t==="overview"?(l&&E++,u&&E++):(y&&y!=="revenue"&&E++,N&&E++,v&&E++,x&&E++),E},[t,l,u,y,N,v,x]);return r.jsx(d6,{className:C,leftSection:r.jsxs(r.Fragment,{children:[e&&r.jsx(u6,{label:e.label||"New Item",onClick:e.onClick,themeColor:_,disabled:e.disabled,loading:e.loading}),t==="overview"&&i&&r.jsx(ZF,{selectedTable:n,availableTables:s,tablesLoading:a,onTableChange:i})]}),rightSection:r.jsx(m6,{filters:[{id:"unified-filter",label:"Filters",title:"Filters",hasActiveFilters:A>0,badge:A>0?A:null,content:({onClose:E})=>r.jsx(JF,{mode:t,dateFilter:l,setDateFilter:o,clearFilter:c,setPreset:d,limitEnabled:u,setLimitEnabled:m,dataLimit:p,setDataLimit:f,selectedMetric:y,setSelectedMetric:g,showUnknown:x,setShowUnknown:b,showBenchmark:v,setShowBenchmark:w,showConcentration:N,setShowConcentration:k,topN:j,setTopN:S,onApply:E,onReset:E})}]}),...D})},cu={CSV:".csv",EXCEL:".xlsx"},Rx=50*1024*1024,ez=(e,t=[cu.CSV,cu.EXCEL])=>{const n=e.name.toLowerCase(),s=t.some(a=>n.endsWith(a.toLowerCase()));return{isValid:s,error:s?null:`File type not supported. Allowed: ${t.join(", ")}`}},tz=(e,t=Rx)=>{const n=e.size<=t;return{isValid:n,error:n?null:`File size (${Vf(e.size)}) exceeds limit of ${Vf(t)}`,size:e.size,maxSize:t}},rz=e=>{const n=/^[a-zA-Z0-9_\-\s.]+$/.test(e);return{isValid:n,error:n?null:"File name contains invalid characters. Use only letters, numbers, spaces, hyphens, and underscores."}},IS=(e,t={})=>{const{allowedTypes:n=[cu.CSV,cu.EXCEL],maxSize:s=Rx,validateName:a=!0}=t,i=[],l=ez(e,n);l.isValid||i.push({type:"file_type",...l});const o=tz(e,s);if(o.isValid||i.push({type:"file_size",...o}),a){const d=rz(e.name);d.isValid||i.push({type:"file_name",...d})}const c=i.filter(d=>d.error).map(d=>d.error);return{isValid:c.length===0,errors:c,validations:i,fileInfo:{name:e.name,size:e.size,type:e.type,lastModified:e.lastModified}}},Vf=e=>{if(e===0)return"0 Bytes";const t=1024,n=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,s)).toFixed(1))+" "+n[s]},nz=e=>{const t={B:1,BYTES:1,KB:1024,MB:1048576,GB:1073741824},n=e.match(/^(\d+(?:\.\d+)?)\s*(B|BYTES|KB|MB|GB)$/i);if(!n)return Rx;const[,s,a]=n;return parseFloat(s)*t[a.toUpperCase()]},sz=({config:e,onFileSelected:t,analysisError:n,isAnalyzing:s})=>{var D,A,E;const[a,i]=h.useState(!1),[l,o]=h.useState(null),[c,d]=h.useState(null),[u,m]=h.useState("_new_table"),[p,f]=h.useState([]),[y,g]=h.useState(!1),[x,b]=h.useState(!1),v=h.useCallback(T=>{T.preventDefault(),T.stopPropagation(),T.type==="dragenter"||T.type==="dragover"?i(!0):T.type==="dragleave"&&i(!1)},[]);h.useEffect(()=>{const T=new AbortController;return(async()=>{g(!0);try{const L="http://localhost:8002",P=localStorage.getItem("id_token"),$=await fetch(`${L}/api/data/tables`,{headers:{Authorization:`Bearer ${P}`},signal:T.signal});if($.ok){const R=await $.json();f(R.tables||[])}}catch(L){L.name!=="AbortError"&&console.error("Failed to fetch tables:",L)}finally{g(!1)}})(),()=>T.abort()},[]);const w=h.useCallback(T=>{d(null);const M=IS(T,e);if(!M.isValid){d(M.errors.join(", "));return}o(T),t&&t(T,{target_table:u==="_new_table"?null:u})},[e,t,u]),N=h.useCallback(T=>{T.preventDefault(),T.stopPropagation(),i(!1),T.dataTransfer.files&&T.dataTransfer.files[0]&&w(T.dataTransfer.files[0])},[w]),k=T=>{T.target.files&&T.target.files[0]&&w(T.target.files[0])},j=()=>{o(null),d(null)},S=T=>{m(T),b(!1),l&&t&&t(l,{target_table:T==="_new_table"?null:T})},_=((D=e.getServiceConfig)==null?void 0:D.call(e))||{},C=h.useCallback(async()=>{var T,M,L;try{if(((T=e.databaseConfig)==null?void 0:T.schema_name)==="sales"||((M=e.databaseConfig)==null?void 0:M.service_type)==="nl2sql"||((L=e.mappingConfig)==null?void 0:L.service_context)==="sales"){const R=await fetch("http://localhost:8002/api/sales/download-template");if(R.ok){const U=await R.blob(),I=window.URL.createObjectURL(U),z=document.createElement("a");z.href=I,z.download="sales_data_template.csv",z.style.display="none",document.body.appendChild(z),z.click(),document.body.removeChild(z),window.URL.revokeObjectURL(I)}else throw new Error("Failed to download template")}else{const $=e.expectedColumns||["date","name","value","category"],R=[["2024-01-01","Sample Item 1","100","Category A"],["2024-01-02","Sample Item 2","200","Category B"],["2024-01-03","Sample Item 3","150","Category C"]],U=[$.join(","),...R.map(O=>O.join(","))].join(`
`),I=new Blob([U],{type:"text/csv;charset=utf-8;"}),z=window.URL.createObjectURL(I),F=document.createElement("a");F.href=z,F.download="data_template.csv",F.style.display="none",document.body.appendChild(F),F.click(),document.body.removeChild(F),window.URL.revokeObjectURL(z)}}catch(P){console.error("Failed to download template:",P)}},[e]);return r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:_.displayName||"Data Upload"}),r.jsx("p",{className:"text-gray-600",children:_.description||"Upload your data file for processing"})]}),r.jsx(We,{children:r.jsx(it,{className:"p-4",children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[r.jsx(qn,{className:"w-4 h-4"}),r.jsx("span",{className:"font-medium",children:"Target Table"})]}),r.jsxs("div",{className:"relative",children:[r.jsxs("button",{onClick:()=>b(!x),className:"w-full px-4 py-2 text-left bg-white border border-gray-300 rounded-lg hover:border-prelude-500 focus:outline-none focus:ring-2 focus:ring-prelude-500 focus:border-transparent transition-colors flex items-center justify-between",children:[r.jsx("span",{className:"text-gray-900",children:u==="_new_table"?"Create New Table":u}),r.jsx(Xt,{className:`w-4 h-4 text-gray-400 transition-transform ${x?"rotate-180":""}`})]}),x&&r.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-auto",children:[r.jsxs("button",{onClick:()=>S("_new_table"),className:"w-full px-4 py-2 text-left hover:bg-prelude-50 transition-colors flex items-center gap-2",children:[r.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),r.jsx("span",{className:"font-medium",children:"Create New Table"})]}),y?r.jsx("div",{className:"px-4 py-2 text-gray-500 text-sm",children:"Loading tables..."}):p.length>0?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"border-t border-gray-100 my-1"}),r.jsx("div",{className:"px-4 py-1 text-xs text-gray-500 uppercase tracking-wider",children:"Existing Tables"}),p.map(T=>r.jsxs("button",{onClick:()=>S(T.table_name),className:"w-full px-4 py-2 text-left hover:bg-prelude-50 transition-colors flex items-center justify-between",children:[r.jsx("span",{children:T.table_name}),r.jsxs("span",{className:"text-xs text-gray-500",children:[T.row_count," rows  ",T.column_count," cols"]})]},T.table_name))]}):r.jsx("div",{className:"px-4 py-2 text-gray-500 text-sm",children:"No existing tables found"})]})]}),r.jsx("p",{className:"text-xs text-gray-500",children:u==="_new_table"?"A new table will be created from your file":`Data will be appended to the ${u} table`})]})})}),r.jsx(We,{className:"bg-green-50 border-green-200",children:r.jsxs(it,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center justify-center gap-3 mb-2",children:[r.jsx(ra,{className:"h-5 w-5 text-green-600"}),r.jsx("span",{className:"font-medium text-green-800",children:"Need a template?"})]}),r.jsx("p",{className:"text-sm text-green-700 mb-3 text-center",children:"Download our template with sample data and proper column headers"}),r.jsx("div",{className:"flex justify-center",children:r.jsxs(H,{onClick:C,variant:"outline",size:"sm",className:"bg-white border-green-300 text-green-700 hover:bg-green-50",children:[r.jsx(ra,{className:"h-4 w-4 mr-2"}),"Download Template"]})}),r.jsxs("p",{className:"text-xs text-green-600 mt-2 text-center",children:[" ",r.jsx("strong",{children:"Tip:"})," Use the template to see the expected format and column names"]})]})}),r.jsx(We,{children:r.jsx(it,{className:"p-0",children:r.jsx("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-all duration-300 ${a?"border-prelude-800 bg-prelude-50 scale-105 shadow-lg":l?"border-green-400 bg-green-50":"border-gray-300 hover:border-prelude-500 hover:bg-gray-50"}`,onDragEnter:v,onDragLeave:v,onDragOver:v,onDrop:N,children:s?r.jsxs("div",{className:"space-y-4",children:[r.jsx(Il,{className:"w-12 h-12 mx-auto text-prelude-800 animate-spin"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-lg font-medium text-gray-700",children:"Analyzing your file..."}),r.jsx("p",{className:"text-sm text-gray-500",children:"AI is examining columns and data patterns"})]})]}):l?r.jsxs("div",{className:"space-y-4",children:[r.jsx(ZA,{className:"w-12 h-12 mx-auto text-green-500"}),r.jsxs("div",{children:[r.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-green-100 rounded-full mb-2",children:[r.jsx(bt,{className:"w-4 h-4 text-green-600"}),r.jsx("span",{className:"text-sm font-medium text-green-700",children:l.name})]}),r.jsxs("p",{className:"text-sm text-green-600",children:[Vf(l.size),"  Ready for analysis"]}),r.jsxs(H,{variant:"ghost",size:"sm",onClick:j,className:"mt-2",children:[r.jsx(Ze,{className:"w-4 h-4 mr-1"}),"Remove File"]})]})]}):r.jsxs("div",{className:"space-y-4",children:[r.jsx(vs,{className:`w-12 h-12 mx-auto transition-colors ${a?"text-prelude-800":"text-gray-400"}`}),r.jsxs("div",{children:[r.jsx("p",{className:"text-lg font-medium text-gray-700",children:"Drop your file here"}),r.jsxs("p",{className:"text-sm text-gray-500",children:["or"," ",r.jsxs("label",{className:"text-prelude-800 hover:text-prelude-900 cursor-pointer font-medium underline underline-offset-2",children:["browse to select",r.jsx("input",{type:"file",accept:(A=e.allowedFileTypes)==null?void 0:A.join(","),onChange:k,className:"hidden"})]})]}),r.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Supported formats: ",(E=e.allowedFileTypes)==null?void 0:E.join(", "),"  Max size: ",e.maxFileSize]})]})]})})})}),c&&r.jsx(We,{className:"border-red-200 bg-red-50",children:r.jsx(it,{className:"p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(dt,{className:"w-5 h-5 text-red-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-red-800",children:"File Validation Error"}),r.jsx("p",{className:"text-sm text-red-700 mt-1",children:c})]})]})})}),n&&r.jsx(We,{className:"border-red-200 bg-red-50",children:r.jsx(it,{className:"p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(dt,{className:"w-5 h-5 text-red-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-red-800",children:"Analysis Error"}),r.jsx("p",{className:"text-sm text-red-700 mt-1",children:n}),r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>l&&t(l),className:"mt-2",children:"Retry Analysis"})]})]})})}),r.jsx(We,{className:"bg-white border-prelude-100",children:r.jsx(it,{className:"p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(Ut,{className:"w-5 h-5 text-prelude-800 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Expected Data Format"}),e.expectedColumns&&e.expectedColumns.length>0&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Common columns we look for:"}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.expectedColumns.slice(0,8).map((T,M)=>r.jsx("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs font-mono text-gray-700",children:T},M)),e.expectedColumns.length>8&&r.jsxs("span",{className:"px-2 py-1 text-xs text-gray-500",children:["+",e.expectedColumns.length-8," more"]})]})]}),r.jsxs("div",{className:"mt-3 text-xs text-gray-500 space-y-1",children:[r.jsx("div",{children:" First row should contain column headers"}),r.jsx("div",{children:" Data will be automatically analyzed for optimal mapping"}),r.jsx("div",{children:" You can review and adjust mappings if needed"})]})]})]})})}),(s||l)&&!n&&r.jsx("div",{className:"text-center",children:r.jsx(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"inline-flex items-center gap-2 text-sm text-gray-600",children:s?r.jsxs(r.Fragment,{children:[r.jsx(Il,{className:"w-4 h-4 animate-spin"}),r.jsx("span",{children:"Analyzing file structure and content..."})]}):r.jsxs(r.Fragment,{children:[r.jsx(bt,{className:"w-4 h-4 text-green-500"}),r.jsx("span",{children:"Analysis complete  Proceeding to next step"})]})})})]})},qv=({icon:e,title:t,description:n,features:s=[],confidence:a,recommended:i=!1,onClick:l,disabled:o=!1,className:c=""})=>r.jsx(We,{className:`cursor-pointer transition-all duration-200 hover:shadow-lg border-2 ${i?"border-prelude-800 bg-prelude-50":"border-gray-200 hover:border-prelude-300"} ${o?"opacity-50 cursor-not-allowed":""} ${c}`,children:r.jsx(it,{className:"p-6",children:r.jsxs(de.div,{whileHover:o?{}:{scale:1.02},whileTap:o?{}:{scale:.98},onClick:o?void 0:l,children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${i?"bg-prelude-800":"bg-gray-100"}`,children:r.jsx(e,{className:`w-6 h-6 ${i?"text-white":"text-gray-600"}`})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t}),r.jsx("p",{className:"text-sm text-gray-600",children:n})]})]}),i&&r.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-prelude-800 text-white rounded-full text-xs font-medium",children:[r.jsx(on,{className:"w-3 h-3"}),r.jsx("span",{children:"Recommended"})]})]}),a!==void 0&&r.jsxs("div",{className:"mb-4",children:[r.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[r.jsx("span",{className:"text-gray-600",children:"Mapping Confidence"}),r.jsx("span",{className:`font-medium ${(typeof a=="object"?a.confidence:a)>=90?"text-green-600":(typeof a=="object"?a.confidence:a)>=70?"text-yellow-600":"text-red-600"}`,children:typeof a=="object"?a.confidence_display||a.confidence+"%":a+"%"})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:r.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${(typeof a=="object"?a.confidence:a)>=90?"bg-green-500":(typeof a=="object"?a.confidence:a)>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${typeof a=="object"?a.confidence:a}%`}})})]}),s.length>0&&r.jsx("div",{className:"mb-4",children:r.jsx("ul",{className:"space-y-2",children:s.map((d,u)=>r.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-700",children:[r.jsx(bt,{className:"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"}),r.jsx("span",{children:d})]},u))})}),r.jsx(H,{className:`w-full ${i?"bg-prelude-800 hover:bg-prelude-900 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-900"}`,disabled:o,onClick:d=>{d.stopPropagation(),!o&&l&&l()},children:i?"Choose Recommended":"Select This Mode"})]})})}),nd={targetService:"nl2sql",targetDatabase:"sales",expectedColumns:[],allowedFileTypes:[".csv",".xlsx"],maxFileSize:"100MB",quickUploadThreshold:90,databaseConfig:{schema_name:"sales",service_type:"nl2sql",timeout_seconds:30,database_type:"postgresql"},previewConfig:{sample_size:25,include_nulls:!0,max_unique_values:50,show_data_types:!0,analyze_patterns:!0,max_string_preview:100},mappingConfig:{service_context:"generic",confidence_threshold:70,use_ai_fallback:!0,enable_semantic_matching:!0,max_ai_retries:2,ai_model:"gpt-4o-mini"}},Hv={nl2sql:{displayName:"Sales Analytics",description:"Upload sales data for analytics and insights",icon:"BarChart3",targetService:"nl2sql",targetDatabase:"sales",expectedColumns:["employee_name","sales_amount","location","customer_name","profit","product_name","client_name","quotations_sent","emails_sent","calls_made","sale_date"],allowedFileTypes:[".csv",".xlsx"],maxFileSize:"100MB",quickUploadThreshold:90,databaseConfig:{schema_name:"sales",service_type:"nl2sql",database_type:"postgresql"},mappingConfig:{service_context:"sales",confidence_threshold:70,enable_semantic_matching:!0},previewConfig:{sample_size:30,analyze_patterns:!0}},employee:{displayName:"Employee Management",description:"Upload employee data and profiles",icon:"Users",targetService:"employee",targetDatabase:"employees",expectedColumns:["name","email","role","department","hire_date","phone","location","city","country","timezone"],allowedFileTypes:[".csv",".xlsx"],maxFileSize:"25MB",quickUploadThreshold:90,databaseConfig:{schema_name:"public",service_type:"employee",database_type:"postgresql"},mappingConfig:{service_context:"employee",confidence_threshold:70,enable_semantic_matching:!0},previewConfig:{sample_size:20,include_nulls:!0}},crm:{displayName:"Customer Management",description:"Upload customer data and interactions",icon:"UserCircle",targetService:"crm",targetDatabase:"customers",expectedColumns:["customer_name","email","phone","company","industry","contact_date","lead_source","deal_value","status"],allowedFileTypes:[".csv",".xlsx"],maxFileSize:"75MB",quickUploadThreshold:90,databaseConfig:{schema_name:"public",service_type:"crm",database_type:"postgresql"},mappingConfig:{service_context:"crm",confidence_threshold:70,enable_semantic_matching:!0},previewConfig:{sample_size:25,max_string_preview:150}},"lead-gen":{displayName:"Lead Generation",description:"Upload lead data for processing",icon:"Target",targetService:"lead-gen",targetDatabase:"leads",expectedColumns:["company_name","contact_name","email","phone","industry","company_size","location","website","linkedin_url"],allowedFileTypes:[".csv",".xlsx"],maxFileSize:"50MB",quickUploadThreshold:90,databaseConfig:{schema_name:"public",service_type:"lead-gen",database_type:"postgresql"},mappingConfig:{service_context:"lead_generation",confidence_threshold:70,enable_semantic_matching:!0},previewConfig:{sample_size:20,max_unique_values:100}}},LS=(e,t={})=>{const n=Hv[e]||Hv.nl2sql;return{...nd,...n,...t,databaseConfig:{...nd.databaseConfig,...n.databaseConfig,...t.databaseConfig},previewConfig:{...nd.previewConfig,...n.previewConfig,...t.previewConfig},mappingConfig:{...nd.mappingConfig,...n.mappingConfig,...t.mappingConfig}}},Wv={QUICK:{id:"quick",name:"Quick Upload",description:"Use AI suggestions automatically",icon:"Zap",color:"blue",features:["Automatic column mapping","AI-powered data analysis","Instant upload processing","Best for clean, well-structured data"],requirements:{minConfidence:90,maxMissingColumns:0,maxDataIssues:2}},ADVANCED:{id:"advanced",name:"Advanced Mapping",description:"Review and customize all mappings",icon:"Settings",color:"purple",features:["Interactive column mapping","Data preview with samples","Custom mapping rules","Best for complex or new data formats"],requirements:{minConfidence:0,maxMissingColumns:1/0,maxDataIssues:1/0}}},az=({analysisResult:e,analysisSummary:t,dataQuality:n,isQuickRecommended:s,onModeSelected:a})=>{if(!e||!t)return r.jsxs("div",{className:"p-6 text-center space-y-4",children:[r.jsx(Il,{className:"w-12 h-12 mx-auto text-prelude-800 animate-spin"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-lg font-medium text-gray-700",children:"Analyzing Your Data..."}),r.jsx("p",{className:"text-sm text-gray-500",children:"AI is examining columns and suggesting optimal mappings"})]})]});const{totalColumns:i,mappedColumns:l,mappingPercentage:o,overallConfidence:c,missingColumnsCount:d,newColumnsCount:u,dataIssuesCount:m,highSeverityIssues:p}=t,f={...Wv.QUICK,confidence:c},y={...Wv.ADVANCED},g=d>0||u>0||p>0;return r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsxs(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center space-y-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Analysis Complete"}),r.jsx("p",{className:"text-gray-600",children:"Your file has been analyzed. Choose how you'd like to proceed."})]}),r.jsxs("div",{className:"flex justify-center gap-6 text-sm",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"font-semibold text-gray-900",children:i}),r.jsx("div",{className:"text-gray-600",children:"Columns"})]}),r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:`font-semibold flex items-center justify-center gap-1 ${c>=90?"text-green-600":c>=70?"text-yellow-600":"text-red-600"}`,children:[c,"%",c>=90&&r.jsx(bt,{className:"w-3 h-3"}),c<70&&r.jsx(Cr,{className:"w-3 h-3"})]}),r.jsx("div",{className:"text-gray-600",children:"Match Confidence"}),r.jsx("div",{className:"text-xs text-gray-500",children:c>=90?"Excellent":c>=70?"Good":"Needs Review"})]}),r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:`font-semibold ${(n==null?void 0:n.score)>=80?"text-green-600":(n==null?void 0:n.score)>=60?"text-yellow-600":"text-red-600"}`,children:[(n==null?void 0:n.score)||0,"%"]}),r.jsx("div",{className:"text-gray-600",children:"Data Quality"})]})]})]}),g&&r.jsx(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:r.jsx(We,{className:"border-amber-200 bg-amber-50",children:r.jsx(it,{className:"p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(Cr,{className:"w-5 h-5 text-amber-500 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-amber-800 mb-2",children:"Mapping Considerations"}),r.jsxs("ul",{className:"text-sm text-amber-700 space-y-1",children:[c<70&&r.jsxs("li",{children:[" Some columns have low mapping confidence (",c,"%)"]}),d>0&&r.jsxs("li",{children:[" ",d," expected columns not found in your file"]}),u>0&&r.jsxs("li",{children:[" ",u," new columns will be added to the database"]}),p>0&&r.jsxs("li",{children:[" ",p," critical data quality issues detected"]})]})]})]})})})}),r.jsxs(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsx(qv,{icon:Ml,title:f.name,description:f.description,features:f.features,confidence:f.confidence,recommended:s&&!g,onClick:()=>a("quick"),disabled:p>0}),r.jsx(qv,{icon:ys,title:y.name,description:y.description,features:y.features,recommended:!s||g,onClick:()=>a("advanced")})]}),r.jsxs(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx(We,{children:r.jsxs(it,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx(Ot,{className:"w-5 h-5 text-blue-600"}),r.jsx("h4",{className:"font-medium text-gray-900",children:"Column Mapping"})]}),r.jsxs("div",{className:"space-y-2 text-sm",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Mapped columns:"}),r.jsxs("span",{className:"font-medium",children:[l," of ",i]})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Success rate:"}),r.jsxs("span",{className:`font-medium ${o>=90?"text-green-600":o>=70?"text-yellow-600":"text-red-600"}`,children:[o,"%"]})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:r.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${o>=90?"bg-green-500":o>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${o}%`}})})]})]})}),r.jsx(We,{children:r.jsxs(it,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx(Ut,{className:"w-5 h-5 text-purple-600"}),r.jsx("h4",{className:"font-medium text-gray-900",children:"Data Quality"})]}),r.jsxs("div",{className:"space-y-2 text-sm",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Overall score:"}),r.jsxs("span",{className:`font-medium ${((n==null?void 0:n.score)||0)>=90?"text-green-600":((n==null?void 0:n.score)||0)>=70?"text-yellow-600":"text-red-600"}`,children:[(n==null?void 0:n.score)||0,"%"]})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Data issues:"}),r.jsxs("span",{className:`font-medium ${m===0?"text-green-600":m<5?"text-yellow-600":"text-red-600"}`,children:[m," found"]})]}),(n==null?void 0:n.issues)&&r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Critical issues:"}),r.jsx("span",{className:`font-medium ${n.issues.critical===0?"text-green-600":"text-red-600"}`,children:n.issues.critical})]})]})]})})]}),r.jsx(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"text-center p-4 bg-gray-50 rounded-lg",children:r.jsxs("p",{className:"text-sm text-gray-600",children:[r.jsx("strong",{children:"Recommendation:"})," ",s&&!g?"Your data looks great! Quick Upload should work perfectly.":"We recommend Advanced Mapping to ensure the best results."]})})]})},iz=({selectedFile:e,analysisResult:t,onCompatibilityConfirmed:n,onNeedsMappingReview:s,uploadService:a})=>{var A;const[i,l]=h.useState(null),[o,c]=h.useState(null),[d,u]=h.useState(!0),[m,p]=h.useState(null),[f,y]=h.useState({recommendations:!0}),[g,x]=h.useState({}),b=h.useCallback(async()=>{var E,T,M,L;if(!(!e||!a)){u(!0),p(null);try{const P=(E=t==null?void 0:t.existing_table_info)==null?void 0:E.table_name;if(!P){l({success:!0,compatibility_analysis:{overall_compatible:!0,compatibility_score:100,append_safe:!0,operation_type:"CREATE",warnings:[],recommendations:[]}}),c({recommendations:[],business_context:{domain:"general",table_purpose:"data_storage",criticality:"low"},overall_confidence:100}),u(!1);return}const $=new FormData;$.append("file",e);const R={};t.mapping_suggestions&&t.mapping_suggestions.forEach(V=>{V.source_column&&V.target_column&&(R[V.source_column]=V.target_column)}),$.append("proposed_mappings",JSON.stringify(R));const U=new URLSearchParams({target_table:P}),I=await fetch(`${a.csvMappingServiceUrl}/api/data/analyze-schema-compatibility?${U}`,{method:"POST",body:$});if(!I.ok){const V=await I.text();throw console.error("Schema compatibility API error:",{status:I.status,statusText:I.statusText,errorText:V,url:I.url}),new Error(`Failed to analyze schema compatibility: ${I.status} ${V}`)}const z=await I.json();l(z);const F=t.mapping_suggestions||[],O=70,K=new Set(F.filter(V=>V.confidence>=O&&V.target_column).map(V=>V.source_column)),J=new Set(F.filter(V=>V.confidence>=O&&V.target_column).map(V=>V.target_column)),se=(t.new_columns||[]).map(V=>typeof V=="string"?V:V.name).filter(V=>!K.has(V)),Z=(t.missing_columns||[]).map(V=>typeof V=="string"?V:V.name).filter(V=>!J.has(V));if(se.length===0&&Z.length===0){c({recommendations:[],overall_confidence:100}),x({});return}const oe=await fetch(`${a.csvMappingServiceUrl}/api/data/column-mismatch-analysis`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({table_name:P,csv_columns:(t.source_columns||[]).map(V=>V.name),table_columns:(((T=t.existing_table_info)==null?void 0:T.columns)||[]).reduce((V,re)=>(V[re.name]=re.type,V),{}),extra_csv_columns:se,missing_table_columns:Z,type_mismatches:[]})});if(!oe.ok){const V=await oe.text();throw console.error("LLM recommendations API error:",{status:oe.status,statusText:oe.statusText,errorText:V,url:oe.url,requestBody:{table_name:P,csv_columns:(t.source_columns||[]).map(re=>re.name),table_columns:(((M=t.existing_table_info)==null?void 0:M.columns)||[]).reduce((re,Me)=>(re[Me.name]=Me.type,re),{}),extra_csv_columns:se,missing_table_columns:Z,type_mismatches:[]}}),new Error(`Failed to get LLM recommendations: ${oe.status} ${V}`)}const W=await oe.json();c(W);const B={};(L=W.recommendations)==null||L.forEach(V=>{B[V.column_name]={action:V.suggested_action,approved:!1,userOverride:!1}}),x(B)}catch(P){console.error("Compatibility analysis failed:",P),p(P.message)}finally{u(!1)}}},[e,a,t]);h.useEffect(()=>{b()},[b]);const v=h.useCallback(E=>{y(T=>({...T,[E]:!T[E]}))},[]),w=h.useCallback((E,T,M=!0)=>{x(L=>{var P;return{...L,[E]:{action:T,approved:M,userOverride:T!==((P=L[E])==null?void 0:P.action)}}})},[]),N=h.useCallback(E=>{switch(E==null?void 0:E.toLowerCase()){case"high":return{color:"text-red-600",bgColor:"bg-red-50 border-red-200",icon:Cr};case"medium":return{color:"text-yellow-600",bgColor:"bg-yellow-50 border-yellow-200",icon:Za};case"low":return{color:"text-blue-600",bgColor:"bg-blue-50 border-blue-200",icon:Za};default:return{color:"text-gray-600",bgColor:"bg-gray-50 border-gray-200",icon:Za}}},[]),k=h.useMemo(()=>{var T,M;return!i||!o?"loading":((T=o.recommendations)==null?void 0:T.some(L=>L.severity==="high"))?"requires_attention":(M=i.compatibility_analysis)!=null&&M.overall_compatible?"compatible":"review_needed"},[i,o]),j=h.useMemo(()=>{var T;return k==="loading"?!1:k==="compatible"?!0:(((T=o==null?void 0:o.recommendations)==null?void 0:T.filter(M=>M.severity==="high"))||[]).every(M=>{var L;return(L=g[M.column_name])==null?void 0:L.approved})},[k,o,g]),S=h.useCallback(()=>{k==="compatible"?n({compatibilityData:i,llmRecommendations:o,userDecisions:{}}):s({compatibilityData:i,llmRecommendations:o,userDecisions:g})},[k,i,o,g,n,s]);if(d)return r.jsxs("div",{className:"flex flex-col h-full items-center justify-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-prelude-800 mb-4"}),r.jsx("p",{className:"text-gray-600",children:"Analyzing schema compatibility..."}),r.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Getting AI recommendations for your data"})]});if(m)return r.jsxs("div",{className:"flex flex-col h-full items-center justify-center",children:[r.jsx(Cr,{className:"w-12 h-12 text-red-500 mb-4"}),r.jsx("p",{className:"text-red-600 font-medium",children:"Compatibility Analysis Failed"}),r.jsx("p",{className:"text-gray-600 text-sm mt-2",children:m}),r.jsxs(H,{onClick:b,variant:"outline",className:"mt-4",children:[r.jsx(Be,{className:"w-4 h-4 mr-2"}),"Retry Analysis"]})]});const _={compatible:{icon:bt,color:"text-green-600",bgColor:"bg-green-50",title:"Schema Compatible",description:"Your data structure matches the target table perfectly"},requires_attention:{icon:Cr,color:"text-red-600",bgColor:"bg-red-50",title:"Attention Required",description:"Critical schema issues need to be resolved"},review_needed:{icon:Za,color:"text-yellow-600",bgColor:"bg-yellow-50",title:"Review Recommended",description:"Some compatibility issues detected"}},C=_[k]||_.review_needed,D=C.icon;return r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsx("div",{className:"p-6 border-b border-gray-200 bg-white",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:`p-3 rounded-full ${C.bgColor}`,children:r.jsx(D,{className:`w-6 h-6 ${C.color}`})}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-gray-900",children:C.title}),r.jsx("p",{className:"text-sm text-gray-600",children:C.description})]})]}),(i==null?void 0:i.compatibility_analysis)&&r.jsxs("div",{className:"text-right",children:[r.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[Math.round(i.compatibility_analysis.compatibility_score),"%"]}),r.jsx("div",{className:"text-sm text-gray-600",children:"Compatibility Score"})]})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:((A=o==null?void 0:o.recommendations)==null?void 0:A.length)>0&&r.jsxs(We,{children:[r.jsx(ir,{className:"cursor-pointer",onClick:()=>v("recommendations"),children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Br,{className:"w-5 h-5 text-prelude-600"}),r.jsx(cr,{className:"text-lg",children:"AI Recommendations"}),r.jsxs("span",{className:"bg-prelude-100 text-prelude-800 px-2 py-1 rounded-full text-xs font-medium",children:[o.recommendations.length," column differences"]})]}),f.recommendations?r.jsx(La,{className:"w-5 h-5 text-gray-400"}):r.jsx(Xt,{className:"w-5 h-5 text-gray-400"})]})}),r.jsx(ht,{children:f.recommendations&&r.jsx(de.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},children:r.jsx(it,{className:"space-y-4",children:o.recommendations.map((E,T)=>{const M=N(E.severity),L=g[E.column_name];return r.jsx("div",{className:`p-4 rounded-lg border-2 ${M.bgColor}`,children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[r.jsx("span",{className:"font-medium text-gray-900",children:E.column_name}),r.jsxs("span",{className:`text-sm font-medium ${M.color}`,children:["(",E.severity,")"]})]}),r.jsx("div",{className:"text-gray-700 text-sm",children:E.recommendation})]}),r.jsx(H,{size:"sm",variant:L!=null&&L.approved?"default":"outline",onClick:()=>w(E.column_name,E.suggested_action,!0),className:"min-w-[80px] ml-4",children:L!=null&&L.approved?r.jsxs(r.Fragment,{children:[r.jsx(bt,{className:"w-3 h-3 mr-1"}),"OK"]}):"Approve"})]})},T)})})})})]})}),r.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("div",{className:"text-sm text-gray-600",children:(o==null?void 0:o.overall_confidence)&&r.jsxs("span",{children:["AI Confidence: ",Math.round(o.overall_confidence*100),"%"]})}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(H,{variant:"outline",onClick:()=>window.history.back(),children:"Review Again"}),r.jsx(H,{onClick:S,disabled:!j,className:"bg-prelude-800 hover:bg-prelude-900 text-white",children:k==="compatible"?r.jsxs(r.Fragment,{children:[r.jsx(bt,{className:"w-4 h-4 mr-2"}),"Proceed with Upload"]}):r.jsxs(r.Fragment,{children:["Continue to Mapping",r.jsx(Dn,{className:"w-4 h-4 ml-2"})]})})]})]})})]})},lz=le.memo(({previewData:e,mappings:t={},dataIssues:n=[],isLoading:s=!1,className:a=""})=>{const[i,l]=h.useState(!1),[o,c]=h.useState(null),d=h.useMemo(()=>!e||!e.preview_data?[]:e.preview_data.map(p=>{const f={};return Object.entries(p).forEach(([y,g])=>{const x=t[y]||y;f[x]={value:g,sourceColumn:y,isMapped:!!t[y],hasIssues:n.some(b=>b.column===y)}}),f}),[e,t,n]),u=h.useMemo(()=>{if(!d.length)return[];const p=Object.keys(d[0]);if(i)return p;const f=p.filter(g=>d[0][g].isMapped),y=p.filter(g=>!d[0][g].isMapped);return[...f,...y].slice(0,5)},[d,i]),m=h.useMemo(()=>{if(!e)return null;const{data_quality_score:p,preview_stats:f}=e;return{score:Math.round(p||0),totalRows:(f==null?void 0:f.total_rows_analyzed)||0,nullPercentage:Math.round((f==null?void 0:f.null_percentage)||0),issuesCount:n.length}},[e,n]);return s?r.jsxs(We,{className:a,children:[r.jsx(ir,{children:r.jsx(cr,{className:"text-lg",children:"Data Preview"})}),r.jsx(it,{children:r.jsxs("div",{className:"animate-pulse space-y-3",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),r.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})})]}):!e||!d.length?r.jsxs(We,{className:a,children:[r.jsx(ir,{children:r.jsx(cr,{className:"text-lg",children:"Data Preview"})}),r.jsx(it,{children:r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx(bs,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),r.jsx("p",{children:"No preview data available"}),r.jsx("p",{className:"text-sm",children:"Upload a file to see data preview"})]})})]}):r.jsxs(We,{className:a,children:[r.jsxs(ir,{children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx(cr,{className:"text-lg",children:"Data Preview"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(H,{variant:"ghost",size:"sm",onClick:()=>l(!i),children:[i?r.jsx(Ku,{className:"w-4 h-4"}):r.jsx(bs,{className:"w-4 h-4"}),r.jsx("span",{className:"ml-1",children:i?"Show Less":"Show All"})]}),r.jsxs(H,{variant:"ghost",size:"sm",children:[r.jsx(ra,{className:"w-4 h-4"}),r.jsx("span",{className:"ml-1",children:"Export"})]})]})]}),m&&r.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mt-2",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(bt,{className:"w-4 h-4 text-green-500"}),r.jsxs("span",{children:["Quality: ",m.score,"%"]})]}),r.jsxs("div",{children:[m.totalRows," rows sampled"]}),m.nullPercentage>0&&r.jsxs("div",{className:"flex items-center gap-1 text-amber-600",children:[r.jsx(Cr,{className:"w-4 h-4"}),r.jsxs("span",{children:[m.nullPercentage,"% null values"]})]}),m.issuesCount>0&&r.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[r.jsx(Cr,{className:"w-4 h-4"}),r.jsxs("span",{children:[m.issuesCount," data issues"]})]})]})]}),r.jsxs(it,{children:[n.length>0&&r.jsx("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx(Cr,{className:"w-5 h-5 text-amber-500 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-amber-800 mb-1",children:"Data Quality Issues"}),r.jsxs("div",{className:"space-y-1",children:[n.slice(0,3).map((p,f)=>r.jsxs("div",{className:"text-sm text-amber-700",children:[r.jsxs("span",{className:"font-medium",children:[p.column,":"]})," ",p.description]},f)),n.length>3&&r.jsxs("div",{className:"text-sm text-amber-600",children:["+",n.length-3," more issues"]})]})]})]})}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full text-sm",children:[r.jsx("thead",{children:r.jsx("tr",{className:"border-b border-gray-200 bg-gray-50",children:u.map(p=>{const f=d[0][p];return r.jsx("th",{className:"px-3 py-2 text-left",children:r.jsxs("div",{className:"space-y-1",children:[r.jsx("div",{className:"font-medium text-gray-900",children:p}),f.sourceColumn!==p&&r.jsxs("div",{className:"text-xs text-gray-500",children:["from: ",f.sourceColumn]}),r.jsxs("div",{className:"flex items-center gap-1",children:[f.isMapped?r.jsx("span",{className:"inline-block w-2 h-2 bg-green-500 rounded-full"}):r.jsx("span",{className:"inline-block w-2 h-2 bg-gray-300 rounded-full"}),f.hasIssues&&r.jsx(Cr,{className:"w-3 h-3 text-amber-500"})]})]})},p)})})}),r.jsx("tbody",{children:d.slice(0,10).map((p,f)=>r.jsx("tr",{className:`border-b border-gray-100 hover:bg-gray-50 cursor-pointer ${o===f?"bg-prelude-50":""}`,onClick:()=>c(o===f?null:f),children:u.map(y=>{const g=p[y],x=g==null?void 0:g.value;return r.jsx("td",{className:"px-3 py-2",children:r.jsxs("div",{className:"max-w-[200px]",children:[x==null?r.jsx("span",{className:"text-gray-400 italic",children:"null"}):typeof x=="string"&&x.length>50?r.jsxs("span",{title:x,className:"truncate block",children:[x.substring(0,47),"..."]}):r.jsx("span",{className:typeof x=="number"?"font-mono":"",children:String(x)}),(g==null?void 0:g.hasIssues)&&r.jsx("div",{className:"text-xs text-amber-600 mt-1",children:"Data issue detected"})]})},y)})},f))})]})}),d.length>10&&r.jsxs("div",{className:"text-center py-3 text-sm text-gray-500 border-t",children:["Showing 10 of ",d.length," rows"]}),!i&&Object.keys(d[0]).length>5&&r.jsxs("div",{className:"text-center py-2 text-sm text-gray-500",children:["Showing 5 of ",Object.keys(d[0]).length," columns"]})]})]})});function Gf(){return Gf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Gf.apply(null,arguments)}function Yv(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Kf(e,t){return Kf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},Kf(e,t)}function oz(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Kf(e,t)}var Vv=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function cz(e,t){return!!(e===t||Vv(e)&&Vv(t))}function dz(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!cz(e[n],t[n]))return!1;return!0}function Dh(e,t){t===void 0&&(t=dz);var n,s=[],a,i=!1;function l(){for(var o=[],c=0;c<arguments.length;c++)o[c]=arguments[c];return i&&n===this&&t(o,s)||(a=e.apply(this,o),i=!0,n=this,s=o),a}return l}var uz=typeof performance=="object"&&typeof performance.now=="function",Gv=uz?function(){return performance.now()}:function(){return Date.now()};function Kv(e){cancelAnimationFrame(e.id)}function mz(e,t){var n=Gv();function s(){Gv()-n>=t?e.call(null):a.id=requestAnimationFrame(s)}var a={id:requestAnimationFrame(s)};return a}var Th=-1;function Xv(e){if(e===void 0&&(e=!1),Th===-1||e){var t=document.createElement("div"),n=t.style;n.width="50px",n.height="50px",n.overflow="scroll",document.body.appendChild(t),Th=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return Th}var fl=null;function Jv(e){if(e===void 0&&(e=!1),fl===null||e){var t=document.createElement("div"),n=t.style;n.width="50px",n.height="50px",n.overflow="scroll",n.direction="rtl";var s=document.createElement("div"),a=s.style;return a.width="100px",a.height="100px",t.appendChild(s),document.body.appendChild(t),t.scrollLeft>0?fl="positive-descending":(t.scrollLeft=1,t.scrollLeft===0?fl="negative":fl="positive-ascending"),document.body.removeChild(t),fl}return fl}var hz=150,pz=function(t,n){return t};function fz(e){var t,n=e.getItemOffset,s=e.getEstimatedTotalSize,a=e.getItemSize,i=e.getOffsetForIndexAndAlignment,l=e.getStartIndexForOffset,o=e.getStopIndexForStartIndex,c=e.initInstanceProps,d=e.shouldResetStyleCacheOnItemSizeChange,u=e.validateProps;return t=function(m){oz(p,m);function p(y){var g;return g=m.call(this,y)||this,g._instanceProps=c(g.props,Yv(g)),g._outerRef=void 0,g._resetIsScrollingTimeoutId=null,g.state={instance:Yv(g),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof g.props.initialScrollOffset=="number"?g.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},g._callOnItemsRendered=void 0,g._callOnItemsRendered=Dh(function(x,b,v,w){return g.props.onItemsRendered({overscanStartIndex:x,overscanStopIndex:b,visibleStartIndex:v,visibleStopIndex:w})}),g._callOnScroll=void 0,g._callOnScroll=Dh(function(x,b,v){return g.props.onScroll({scrollDirection:x,scrollOffset:b,scrollUpdateWasRequested:v})}),g._getItemStyle=void 0,g._getItemStyle=function(x){var b=g.props,v=b.direction,w=b.itemSize,N=b.layout,k=g._getItemStyleCache(d&&w,d&&N,d&&v),j;if(k.hasOwnProperty(x))j=k[x];else{var S=n(g.props,x,g._instanceProps),_=a(g.props,x,g._instanceProps),C=v==="horizontal"||N==="horizontal",D=v==="rtl",A=C?S:0;k[x]=j={position:"absolute",left:D?void 0:A,right:D?A:void 0,top:C?0:S,height:C?"100%":_,width:C?_:"100%"}}return j},g._getItemStyleCache=void 0,g._getItemStyleCache=Dh(function(x,b,v){return{}}),g._onScrollHorizontal=function(x){var b=x.currentTarget,v=b.clientWidth,w=b.scrollLeft,N=b.scrollWidth;g.setState(function(k){if(k.scrollOffset===w)return null;var j=g.props.direction,S=w;if(j==="rtl")switch(Jv()){case"negative":S=-w;break;case"positive-descending":S=N-v-w;break}return S=Math.max(0,Math.min(S,N-v)),{isScrolling:!0,scrollDirection:k.scrollOffset<S?"forward":"backward",scrollOffset:S,scrollUpdateWasRequested:!1}},g._resetIsScrollingDebounced)},g._onScrollVertical=function(x){var b=x.currentTarget,v=b.clientHeight,w=b.scrollHeight,N=b.scrollTop;g.setState(function(k){if(k.scrollOffset===N)return null;var j=Math.max(0,Math.min(N,w-v));return{isScrolling:!0,scrollDirection:k.scrollOffset<j?"forward":"backward",scrollOffset:j,scrollUpdateWasRequested:!1}},g._resetIsScrollingDebounced)},g._outerRefSetter=function(x){var b=g.props.outerRef;g._outerRef=x,typeof b=="function"?b(x):b!=null&&typeof b=="object"&&b.hasOwnProperty("current")&&(b.current=x)},g._resetIsScrollingDebounced=function(){g._resetIsScrollingTimeoutId!==null&&Kv(g._resetIsScrollingTimeoutId),g._resetIsScrollingTimeoutId=mz(g._resetIsScrolling,hz)},g._resetIsScrolling=function(){g._resetIsScrollingTimeoutId=null,g.setState({isScrolling:!1},function(){g._getItemStyleCache(-1,null)})},g}p.getDerivedStateFromProps=function(g,x){return gz(g,x),u(g),null};var f=p.prototype;return f.scrollTo=function(g){g=Math.max(0,g),this.setState(function(x){return x.scrollOffset===g?null:{scrollDirection:x.scrollOffset<g?"forward":"backward",scrollOffset:g,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},f.scrollToItem=function(g,x){x===void 0&&(x="auto");var b=this.props,v=b.itemCount,w=b.layout,N=this.state.scrollOffset;g=Math.max(0,Math.min(g,v-1));var k=0;if(this._outerRef){var j=this._outerRef;w==="vertical"?k=j.scrollWidth>j.clientWidth?Xv():0:k=j.scrollHeight>j.clientHeight?Xv():0}this.scrollTo(i(this.props,g,x,N,this._instanceProps,k))},f.componentDidMount=function(){var g=this.props,x=g.direction,b=g.initialScrollOffset,v=g.layout;if(typeof b=="number"&&this._outerRef!=null){var w=this._outerRef;x==="horizontal"||v==="horizontal"?w.scrollLeft=b:w.scrollTop=b}this._callPropsCallbacks()},f.componentDidUpdate=function(){var g=this.props,x=g.direction,b=g.layout,v=this.state,w=v.scrollOffset,N=v.scrollUpdateWasRequested;if(N&&this._outerRef!=null){var k=this._outerRef;if(x==="horizontal"||b==="horizontal")if(x==="rtl")switch(Jv()){case"negative":k.scrollLeft=-w;break;case"positive-ascending":k.scrollLeft=w;break;default:var j=k.clientWidth,S=k.scrollWidth;k.scrollLeft=S-j-w;break}else k.scrollLeft=w;else k.scrollTop=w}this._callPropsCallbacks()},f.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&Kv(this._resetIsScrollingTimeoutId)},f.render=function(){var g=this.props,x=g.children,b=g.className,v=g.direction,w=g.height,N=g.innerRef,k=g.innerElementType,j=g.innerTagName,S=g.itemCount,_=g.itemData,C=g.itemKey,D=C===void 0?pz:C,A=g.layout,E=g.outerElementType,T=g.outerTagName,M=g.style,L=g.useIsScrolling,P=g.width,$=this.state.isScrolling,R=v==="horizontal"||A==="horizontal",U=R?this._onScrollHorizontal:this._onScrollVertical,I=this._getRangeToRender(),z=I[0],F=I[1],O=[];if(S>0)for(var K=z;K<=F;K++)O.push(h.createElement(x,{data:_,key:D(K,_),index:K,isScrolling:L?$:void 0,style:this._getItemStyle(K)}));var J=s(this.props,this._instanceProps);return h.createElement(E||T||"div",{className:b,onScroll:U,ref:this._outerRefSetter,style:Gf({position:"relative",height:w,width:P,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:v},M)},h.createElement(k||j||"div",{children:O,ref:N,style:{height:R?"100%":J,pointerEvents:$?"none":void 0,width:R?J:"100%"}}))},f._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var g=this.props.itemCount;if(g>0){var x=this._getRangeToRender(),b=x[0],v=x[1],w=x[2],N=x[3];this._callOnItemsRendered(b,v,w,N)}}if(typeof this.props.onScroll=="function"){var k=this.state,j=k.scrollDirection,S=k.scrollOffset,_=k.scrollUpdateWasRequested;this._callOnScroll(j,S,_)}},f._getRangeToRender=function(){var g=this.props,x=g.itemCount,b=g.overscanCount,v=this.state,w=v.isScrolling,N=v.scrollDirection,k=v.scrollOffset;if(x===0)return[0,0,0,0];var j=l(this.props,k,this._instanceProps),S=o(this.props,j,k,this._instanceProps),_=!w||N==="backward"?Math.max(1,b):1,C=!w||N==="forward"?Math.max(1,b):1;return[Math.max(0,j-_),Math.max(0,Math.min(x-1,S+C)),j,S]},p}(h.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},t}var gz=function(t,n){t.children,t.direction,t.height,t.layout,t.innerTagName,t.outerTagName,t.width,n.instance},xz=fz({getItemOffset:function(t,n){var s=t.itemSize;return n*s},getItemSize:function(t,n){var s=t.itemSize;return s},getEstimatedTotalSize:function(t){var n=t.itemCount,s=t.itemSize;return s*n},getOffsetForIndexAndAlignment:function(t,n,s,a,i,l){var o=t.direction,c=t.height,d=t.itemCount,u=t.itemSize,m=t.layout,p=t.width,f=o==="horizontal"||m==="horizontal",y=f?p:c,g=Math.max(0,d*u-y),x=Math.min(g,n*u),b=Math.max(0,n*u-y+u+l);switch(s==="smart"&&(a>=b-y&&a<=x+y?s="auto":s="center"),s){case"start":return x;case"end":return b;case"center":{var v=Math.round(b+(x-b)/2);return v<Math.ceil(y/2)?0:v>g+Math.floor(y/2)?g:v}case"auto":default:return a>=b&&a<=x?a:a<b?b:x}},getStartIndexForOffset:function(t,n){var s=t.itemCount,a=t.itemSize;return Math.max(0,Math.min(s-1,Math.floor(n/a)))},getStopIndexForStartIndex:function(t,n,s){var a=t.direction,i=t.height,l=t.itemCount,o=t.itemSize,c=t.layout,d=t.width,u=a==="horizontal"||c==="horizontal",m=n*o,p=u?d:i,f=Math.ceil((p+s-m)/o);return Math.max(0,Math.min(l-1,n+f-1))},initInstanceProps:function(t){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(t){t.itemSize}});const yz=({className:e="w-4 h-4"})=>le.createElement(Mr,{className:e}),bz=({className:e="w-4 h-4"})=>le.createElement(qn,{className:e}),vz=({className:e="w-4 h-4"})=>le.createElement(Wt,{className:e}),wz=({className:e="w-4 h-4"})=>le.createElement(Ze,{className:e}),RS=({className:e="w-4 h-4"})=>le.createElement(Xt,{className:e}),jz=({className:e="w-4 h-4"})=>le.createElement(zn,{className:e}),Nz=({className:e="w-4 h-4"})=>le.createElement(Br,{className:e}),Cz=({className:e="w-4 h-4"})=>le.createElement(tP,{className:e}),kz=({className:e="w-4 h-4"})=>le.createElement(vs,{className:e}),Sz=({className:e="w-4 h-4"})=>le.createElement(Ku,{className:e}),Qv={ai_recommendation:{icon:yz,iconColor:"text-white",bgColor:"bg-purple-500",hoverBgColor:"hover:bg-purple-600",label:"AI Recommended",description:"Suggested by artificial intelligence"},database_column:{icon:bz,iconColor:"text-white",bgColor:"bg-blue-500",hoverBgColor:"hover:bg-blue-600",label:"Database Column",description:"Existing PostgreSQL column"},import_new:{icon:vz,iconColor:"text-white",bgColor:"bg-green-500",hoverBgColor:"hover:bg-green-600",label:"Import as New",description:"Create new column in database"},ignore_column:{icon:Sz,iconColor:"text-white",bgColor:"bg-gray-500",hoverBgColor:"hover:bg-gray-600",label:"Ignore Column",description:"Exclude from import"},choose:{icon:RS,iconColor:"text-gray-600",bgColor:"bg-gray-200",hoverBgColor:"hover:bg-gray-300",label:"Choose Column",description:"Select mapping option"}},_z={ai_recommendations:{title:"AI Recommendations",icon:Nz,description:"Intelligent mapping suggestions",priority:1},database_columns:{title:"Available Database Columns",icon:Cz,description:"Existing PostgreSQL columns",priority:2},import_options:{title:"Import Options",icon:kz,description:"Column handling options",priority:3}},$S=e=>Qv[e]||Qv.choose,$x=e=>e.isRecommended&&e.confidence>0?"ai_recommendation":e.value==="import_as_new"?"import_new":e.value==="ignore_column"?"ignore_column":e.value===""||e.value===null?"choose":"database_column",Ez=e=>{const t={ai_recommendations:[],database_columns:[],import_options:[]};return e.forEach(n=>{const s=$x(n);s==="ai_recommendation"?t.ai_recommendations.push({...n,type:s}):s==="import_new"||s==="ignore_column"?t.import_options.push({...n,type:s}):s==="database_column"&&t.database_columns.push({...n,type:s})}),t},FS=h.forwardRef(({selectedValue:e,selectedOption:t,placeholder:n="Choose column...",isOpen:s=!1,onClick:a,onKeyDown:i,disabled:l=!1,className:o="",llmRecommendation:c,confidence:d=0,hasError:u=!1,"aria-label":m,...p},f)=>{const g=!e||e===""?n:t?t.label:e,x=e&&e!=="",b=t?$x(t):"choose",v=$S(b),w=()=>{if(!c)return"";switch(c.severity){case"high":return"border-red-300 bg-red-50";case"medium":return"border-yellow-300 bg-yellow-50";case"low":return"border-blue-300 bg-blue-50";default:return""}};return r.jsxs("button",{ref:f,type:"button",onClick:a,onKeyDown:i,disabled:l,"aria-haspopup":"listbox","aria-expanded":s,"aria-label":m,className:`
        w-full flex items-center justify-between gap-2 px-3 py-2
        text-sm border rounded-md transition-all duration-150
        ${l?"bg-gray-50 text-gray-500 cursor-not-allowed border-gray-200":u?"border-red-300 bg-red-50 hover:border-red-400":c?w():s?"border-prelude-500 bg-prelude-50 ring-1 ring-prelude-300":x?"border-gray-300 bg-white hover:border-prelude-400 focus:border-prelude-500 focus:ring-1 focus:ring-prelude-300":"border-gray-300 bg-white hover:border-gray-400 focus:border-prelude-500 focus:ring-1 focus:ring-prelude-300"}
        focus:outline-none
        ${o}
      `,...p,children:[r.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[x&&t&&r.jsx("div",{className:`
            w-4 h-4 rounded flex items-center justify-center flex-shrink-0
            ${v.bgColor} ${v.iconColor}
          `,children:r.jsx(v.icon,{className:"w-2.5 h-2.5"})}),r.jsx("span",{className:`
          truncate flex-1
          ${x?l?"text-gray-500":"text-gray-900 font-medium":l?"text-gray-400":"text-gray-500"}
        `,children:g}),r.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[d>0&&x&&r.jsxs("span",{className:`
              text-xs px-1.5 py-0.5 rounded-full font-medium
              ${d>=90?"bg-green-100 text-green-800":d>=70?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}
            `,children:[Math.round(d),"%"]}),(t==null?void 0:t.hasLlmSupport)&&r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-1 h-1 bg-purple-500 rounded-full animate-pulse"}),r.jsx("span",{className:"text-xs text-purple-600 ml-0.5 font-medium",children:"AI"})]}),c&&r.jsx("div",{className:`
              w-2 h-2 rounded-full
              ${c.severity==="high"?"bg-red-500":c.severity==="medium"?"bg-yellow-500":"bg-blue-500"}
            `})]})]}),r.jsx(de.div,{animate:{rotate:s?180:0},transition:{duration:.2},className:`
          flex-shrink-0 ml-1
          ${l?"text-gray-400":"text-gray-500"}
        `,children:r.jsx(RS,{className:"w-4 h-4"})})]})});FS.displayName="DropdownTrigger";const Dz=({searchTerm:e="",onSearchChange:t,onClear:n,placeholder:s="Search columns...",autoFocus:a=!1,disabled:i=!1,className:l="",resultCount:o=0,totalCount:c=0})=>{const d=h.useRef(null),[u,m]=h.useState(!1);h.useEffect(()=>{if(a&&d.current&&!i){const b=setTimeout(()=>{d.current.focus()},100);return()=>clearTimeout(b)}},[a,i]);const p=b=>{const v=b.target.value;t&&t(v)},f=()=>{n&&n(),d.current&&d.current.focus()},y=b=>{b.stopPropagation(),b.key==="Escape"&&e&&(b.preventDefault(),f())},g=e&&e.length>0,x=g&&c>0;return r.jsxs("div",{className:`border-b border-gray-200 bg-white ${l}`,children:[r.jsx("div",{className:"relative px-3 py-2",children:r.jsxs("div",{className:`
          relative flex items-center border rounded-md transition-colors duration-150
          ${u?"border-prelude-300 ring-1 ring-prelude-300":"border-gray-300"}
          ${i?"bg-gray-50 cursor-not-allowed":"bg-white"}
        `,children:[r.jsx("div",{className:"pl-2 pr-1",children:r.jsx(jz,{className:`
              w-4 h-4 transition-colors duration-150
              ${u?"text-prelude-500":"text-gray-400"}
            `})}),r.jsx("input",{ref:d,type:"text",value:e,onChange:p,onKeyDown:y,onFocus:()=>m(!0),onBlur:()=>m(!1),placeholder:s,disabled:i,className:`
              flex-1 px-2 py-1.5 text-sm bg-transparent border-none outline-none
              placeholder-gray-400
              ${i?"cursor-not-allowed text-gray-500":"text-gray-900"}
            `,"aria-label":"Search dropdown options",role:"searchbox","aria-expanded":"true",autoComplete:"off"}),r.jsx(ht,{children:g&&!i&&r.jsx(de.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.15},onClick:f,className:`
                  p-1 rounded transition-colors duration-150
                  hover:bg-gray-100 focus:bg-gray-100 focus:outline-none
                  text-gray-400 hover:text-gray-600
                `,"aria-label":"Clear search",type:"button",children:r.jsx(wz,{className:"w-3 h-3"})})})]})}),r.jsx(ht,{children:x&&r.jsxs(de.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.15},className:"px-3 py-1.5 bg-gray-50 border-b border-gray-200",children:[r.jsxs("div",{className:"flex items-center justify-between text-xs",children:[r.jsx("span",{className:"text-gray-600",children:o===0?r.jsx("span",{className:"text-amber-600",children:"No results found"}):r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"font-medium text-prelude-600",children:o}),r.jsxs("span",{className:"text-gray-500",children:[" of ",c," columns"]})]})}),o===0&&r.jsx("button",{onClick:f,className:"text-prelude-600 hover:text-prelude-700 font-medium",type:"button",children:"Clear search"})]}),o===0&&e.length>2&&r.jsx("div",{className:"mt-1 text-xs text-gray-500",children:'Try searching for column types like "name", "id", or "date"'})]})})]})},zS=h.forwardRef(({option:e,isSelected:t=!1,isFocused:n=!1,onClick:s,onMouseEnter:a,className:i="",...l},o)=>{const c=$x(e),d=$S(c),u=d.icon,m=()=>{s&&s(e.value)},p=y=>!y||y===0?null:`${Math.round(y)}%`,f=y=>y>=90?"bg-green-100 text-green-800":y>=70?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800";return r.jsxs(de.div,{ref:o,initial:{opacity:0,y:-2},animate:{opacity:1,y:0},exit:{opacity:0,y:-2},transition:{duration:.1},role:"option","aria-selected":t,tabIndex:-1,className:`
        flex items-center gap-3 px-3 py-2.5 cursor-pointer
        transition-all duration-150 ease-in-out
        ${n?"bg-prelude-50":"hover:bg-gray-50"}
        ${t?"bg-prelude-100 border-l-2 border-prelude-500":""}
        ${i}
      `,onClick:m,onMouseEnter:a,...l,children:[r.jsx("div",{className:`
        w-5 h-5 rounded flex items-center justify-center flex-shrink-0
        ${d.bgColor} ${d.iconColor}
        shadow-sm
      `,children:r.jsx(u,{className:"w-3 h-3"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:`
            text-sm font-medium truncate
            ${t?"text-prelude-800":"text-gray-900"}
          `,children:e.label}),e.confidence>0&&r.jsx("span",{className:`
              text-xs px-1.5 py-0.5 rounded-full font-medium
              ${f(e.confidence)}
            `,children:p(e.confidence)}),e.hasLlmSupport&&r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-1.5 h-1.5 bg-purple-500 rounded-full animate-pulse"}),r.jsx("span",{className:"text-xs text-purple-600 ml-1 font-medium",children:"AI+"})]}),e.isRecommended&&r.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-blue-100 text-blue-800 rounded-full font-medium",children:"Recommended"})]}),e.description&&r.jsx("div",{className:"text-xs text-gray-500 mt-0.5 truncate",children:e.description})]}),r.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:t&&r.jsx(de.div,{initial:{scale:0},animate:{scale:1},className:"w-2 h-2 bg-prelude-500 rounded-full"})})]})});zS.displayName="DropdownOption";const Ah=({groupKey:e,options:t=[],selectedValue:n,focusedIndex:s,onOptionClick:a,onOptionMouseEnter:i,className:l="",showHeader:o=!0,showCount:c=!0})=>{if(!t||t.length===0)return null;const d=_z[e],u=d==null?void 0:d.icon,m=p=>p;return r.jsxs(de.div,{initial:{opacity:0,y:-4},animate:{opacity:1,y:0},transition:{duration:.2},className:`${l}`,children:[o&&d&&r.jsxs("div",{className:"px-3 py-2 border-b border-gray-100 bg-gray-50",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[u&&r.jsx("div",{className:"w-4 h-4 text-gray-600",children:r.jsx(u,{className:"w-4 h-4"})}),r.jsx("span",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wide",children:d.title})]}),c&&r.jsx("span",{className:"text-xs text-gray-500 bg-gray-200 px-2 py-0.5 rounded-full",children:t.length})]}),d.description&&r.jsx("div",{className:"text-xs text-gray-500 mt-1",children:d.description})]}),r.jsx("div",{className:"py-1",children:t.map((p,f)=>{const y=n===p.value,g=s===m(f);return r.jsx(zS,{option:p,isSelected:y,isFocused:g,onClick:a,onMouseEnter:()=>i&&i(m(f))},`${e}-${p.value}-${f}`)})})]})},BS=({isOpen:e=!1,options:t=[],selectedValue:n,onOptionSelect:s,onClose:a,searchable:i=!0,searchTerm:l="",onSearchChange:o,onSearchClear:c,position:d={top:0,left:0,width:0,maxHeight:300},focusedIndex:u=-1,onFocusedIndexChange:m,className:p=""})=>{const f=h.useRef(null),y=h.useRef(null);h.useEffect(()=>{if(!e)return;const S=C=>{f.current&&f.current.contains(C.target)||C.target.closest('[role="button"][aria-haspopup="listbox"]')||a==null||a()},_=setTimeout(()=>{document.addEventListener("mousedown",S,!1)},50);return()=>{clearTimeout(_),document.removeEventListener("mousedown",S,!1)}},[e,a]),h.useEffect(()=>{if(!e)return;const S=_=>{const C=t.length;if(C!==0)switch(_.key){case"ArrowDown":_.preventDefault(),m==null||m(u<C-1?u+1:0);break;case"ArrowUp":_.preventDefault(),m==null||m(u>0?u-1:C-1);break;case"Enter":if(_.preventDefault(),u>=0&&u<C){const D=t[u];s==null||s(D.value)}break;case"Escape":_.preventDefault(),l?c==null||c():a==null||a();break;case"Tab":a==null||a();break}};return document.addEventListener("keydown",S),()=>document.removeEventListener("keydown",S)},[e,u,t,m,s,a,l,c]),h.useEffect(()=>{if(e&&i&&y.current){const S=setTimeout(()=>{var _,C;y.current&&e&&((C=(_=y.current)==null?void 0:_.focus)==null||C.call(_))},100);return()=>clearTimeout(S)}},[e,i]);const g=Ez(t),x=t.length>0,b=l?t.length>0:!0,v=S=>{m==null||m(S)},w=Object.values(g).reduce((S,_)=>S+_.length,0),N={top:typeof d.top=="number"&&d.top>=0?d.top:100,left:typeof d.left=="number"&&d.left>=0?d.left:100,width:typeof d.width=="number"&&d.width>0?d.width:280,maxHeight:typeof d.maxHeight=="number"&&d.maxHeight>0?d.maxHeight:300},k=e&&x,j=r.jsx(ht,{children:e&&k&&r.jsxs(de.div,{ref:f,initial:{opacity:0,y:-8,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-8,scale:.95},transition:{duration:.15,ease:"easeOut"},className:`
            bg-white border-2 border-gray-300 rounded-lg shadow-2xl overflow-hidden
            ${p}
          `,style:{position:"fixed",top:N.top,left:N.left,width:N.width,maxHeight:N.maxHeight,zIndex:1e4,minWidth:"280px"},role:"listbox","aria-multiselectable":"false","aria-label":"Column mapping options",children:[i&&r.jsx(Dz,{ref:y,searchTerm:l,onSearchChange:o,onClear:c,resultCount:w,totalCount:t.length,autoFocus:!0}),r.jsx("div",{className:"overflow-y-auto",style:{maxHeight:i?N.maxHeight-60:N.maxHeight},children:x&&b?r.jsxs("div",{children:[g.ai_recommendations.length>0&&r.jsx(Ah,{groupKey:"ai_recommendations",options:g.ai_recommendations,selectedValue:n,focusedIndex:u,onOptionClick:s,onOptionMouseEnter:v}),g.database_columns.length>0&&r.jsx(Ah,{groupKey:"database_columns",options:g.database_columns,selectedValue:n,focusedIndex:u,onOptionClick:s,onOptionMouseEnter:v}),g.import_options.length>0&&r.jsx(Ah,{groupKey:"import_options",options:g.import_options,selectedValue:n,focusedIndex:u,onOptionClick:s,onOptionMouseEnter:v})]}):r.jsxs("div",{className:"px-4 py-8 text-center",children:[r.jsx("div",{className:"text-gray-400 mb-2",children:r.jsx("svg",{className:"w-8 h-8 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),r.jsx("div",{className:"text-sm text-gray-500",children:l?"No matching columns found":"No options available"}),l&&r.jsx("button",{onClick:c,className:"text-sm text-prelude-600 hover:text-prelude-700 mt-2 font-medium",children:"Clear search"})]})})]})});return typeof document<"u"?eo.createPortal(j,document.body):j};BS.displayName="DropdownMenu";const US=h.createContext(),qS=()=>{const e=h.useContext(US);if(!e)throw new Error("useDropdownContext must be used within a DropdownProvider");return e},Tz=({children:e})=>{const[t,n]=h.useState(new Set),s=h.useCallback(c=>{n(d=>d.has(c)?new Set:new Set([c]))},[]),a=h.useCallback(c=>{n(d=>{const u=new Set(d);return u.delete(c),u})},[]),i=h.useCallback(()=>{n(new Set)},[]),l=h.useCallback(c=>t.has(c),[t]),o={toggleDropdown:s,closeDropdown:a,closeAllDropdowns:i,isDropdownOpen:l};return r.jsx(US.Provider,{value:o,children:e})},Az=({value:e="",options:t=[],onChange:n,placeholder:s="Choose column...",searchable:a=!0,disabled:i=!1,className:l="","aria-label":o,columnName:c,llmRecommendation:d,confidence:u=0,hasError:m=!1,maxHeight:p=300,...f})=>{const{isDropdownOpen:y,toggleDropdown:g,closeDropdown:x}=qS(),b=y(c),[v,w]=h.useState(""),[N,k]=h.useState(-1),[j,S]=h.useState({top:0,left:0,width:280,maxHeight:300}),_=h.useRef(null),C=h.useMemo(()=>t.find(U=>U.value===e)||null,[t,e]),D=h.useMemo(()=>{if(!v)return t;const U=v.toLowerCase();return t.filter(I=>I.label.toLowerCase().includes(U)||I.value.toLowerCase().includes(U)||I.description&&I.description.toLowerCase().includes(U))},[t,v]),A=h.useCallback(()=>{if(_.current){const U=_.current.getBoundingClientRect(),z=window.innerHeight-U.bottom,F=U.top,O=p||300,K=z<O&&F>z,J=Math.max(280,Math.min(U.width,400)),se=window.innerWidth;let Z=U.left;Z+J>se-16&&(Z=Math.max(8,se-J-16)),Z=Math.max(8,Z);const W={top:K?Math.max(8,U.top-O-4):U.bottom+4,left:Z,width:J,maxHeight:Math.min(K?F-8:z-8,O)};S(W)}},[p]),E=h.useCallback(U=>{i||(U.stopPropagation(),b?(g(c),w(""),k(-1)):(k(-1),w(""),A(),g(c)))},[b,i,c,g,A]);h.useEffect(()=>{b&&A()},[b,A]);const T=h.useCallback(U=>{n&&n(U),x(c),w(""),k(-1),setTimeout(()=>{_.current&&_.current.focus()},50)},[n,c,x]),M=h.useCallback(U=>{w(U),k(-1)},[]),L=h.useCallback(()=>{w(""),k(-1)},[]),P=h.useCallback(U=>{switch(U.key){case"ArrowDown":case"ArrowUp":case"Enter":case" ":U.preventDefault(),b||E(U);break;case"Escape":b&&(U.preventDefault(),x(c));break}},[b,E,c,x]),$=h.useCallback(U=>{k(U)},[]);h.useEffect(()=>{if(b){let U=null;const I=()=>{U&&clearTimeout(U),U=setTimeout(A,16)};return window.addEventListener("scroll",I,!0),window.addEventListener("resize",I),()=>{U&&clearTimeout(U),window.removeEventListener("scroll",I,!0),window.removeEventListener("resize",I)}}},[b,A]);const R=h.useMemo(()=>t.some(I=>I.value==="ignore_column")?t:[...t,{value:"ignore_column",label:"Ignore column",type:"ignore_column",isRecommended:!1,hasLlmSupport:!1,description:"Exclude this column from import"}],[t]);return r.jsxs("div",{className:`relative ${l}`,...f,children:[r.jsx(FS,{ref:_,selectedValue:e,selectedOption:C,placeholder:s,isOpen:b,onClick:E,onKeyDown:P,disabled:i,llmRecommendation:d,confidence:u,hasError:m,"aria-label":o||`Select mapping for ${c||"column"}`}),r.jsx(BS,{isOpen:b,options:a?D:R,selectedValue:e,onOptionSelect:T,onClose:()=>x(c),searchable:a,searchTerm:v,onSearchChange:M,onSearchClear:L,position:j,focusedIndex:N,onFocusedIndexChange:$})]})},Zv=120,Ph=240,Pz=800,Xf=le.memo(({column:e,generateOptionsForColumn:t,handleMappingChange:n,getLlmRecommendation:s,effectiveMappings:a,isVisible:i})=>{var d;if(!e)return null;const l=a.find(u=>u.source_column===e.name),o=s(e.name),c=i?t(e.name):[];return r.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow duration-200",children:r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("h4",{className:"font-medium text-gray-900 truncate",children:e.display_name||e.name}),e.data_type&&r.jsx("span",{className:"text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded",children:e.data_type})]}),e.sample_values&&e.sample_values.length>0&&r.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:[r.jsx("span",{className:"text-xs text-gray-500",children:"Sample: "}),e.sample_values.slice(0,3).map((u,m)=>r.jsxs("span",{className:"inline-block mr-2 px-1.5 py-0.5 bg-gray-50 rounded text-xs",children:[String(u).substring(0,20),String(u).length>20?"...":""]},m))]}),e.stats&&r.jsxs("div",{className:"text-xs text-gray-500",children:[e.stats.null_count>0&&r.jsxs("span",{className:"mr-3",children:[e.stats.null_count," nulls"]}),e.stats.unique_count&&r.jsxs("span",{className:"mr-3",children:[e.stats.unique_count," unique"]})]})]}),r.jsx("div",{className:"flex items-center flex-shrink-0",children:r.jsx(Dn,{className:"w-4 h-4 text-gray-400"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx(Az,{value:(l==null?void 0:l.target_column)||"",options:c,onChange:u=>n(e.name,u),placeholder:"Choose column...",columnName:e.name,llmRecommendation:o,confidence:(d=c.find(u=>u.value===(l==null?void 0:l.target_column)))==null?void 0:d.confidence,searchable:!0,"aria-label":`Map ${e.display_name||e.name} to target column`,className:"w-full"}),o&&o.suggested_action&&r.jsxs("div",{className:"text-xs text-purple-600 mt-1",children:["AI suggests: ",o.suggested_action.replace("_"," ")]})]})]})})});Xf.displayName="ColumnSection";const HS=le.memo(({index:e,style:t,data:n})=>{const{columns:s,generateOptionsForColumn:a,handleMappingChange:i,getLlmRecommendation:l,effectiveMappings:o,isVisible:c}=n,d=Math.ceil(s.length/2),u=s[e],m=s[e+d];return r.jsx("div",{style:t,className:"px-2",children:r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsx(Xf,{column:u,generateOptionsForColumn:a,handleMappingChange:i,getLlmRecommendation:l,effectiveMappings:o,isVisible:c}),m?r.jsx(Xf,{column:m,generateOptionsForColumn:a,handleMappingChange:i,getLlmRecommendation:l,effectiveMappings:o,isVisible:c}):r.jsx("div",{})]})})});HS.displayName="ColumnRow";const Oz=({columns:e=[],generateOptionsForColumn:t,handleMappingChange:n,getLlmRecommendation:s,effectiveMappings:a=[],className:i=""})=>{const l=h.useRef(null),o=h.useRef(null),[c,d]=h.useState(Ph),u=Math.ceil(e.length/2);if(h.useEffect(()=>{var g;const f=()=>{if(o.current){const b=o.current.parentElement;if(b){const v=b.clientHeight,w=parseInt(getComputedStyle(b).paddingTop)+parseInt(getComputedStyle(b).paddingBottom),N=Math.max(Ph,Math.min(Pz,v-w));d(N)}}};f();const y=new ResizeObserver(f);return(g=o.current)!=null&&g.parentElement&&y.observe(o.current.parentElement),()=>{y.disconnect()}},[]),h.useEffect(()=>{l.current&&l.current.scrollToItem(0)},[e]),!e.length)return r.jsxs("div",{className:"text-center py-8 px-4",children:[r.jsx("div",{className:"text-gray-400 mb-2",children:r.jsx("div",{className:"w-8 h-8 mx-auto mb-2 opacity-50",children:""})}),r.jsx("p",{className:"text-gray-500",children:"No source columns found"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Please check your file format"})]});const m={columns:e,generateOptionsForColumn:t,handleMappingChange:n,getLlmRecommendation:s,effectiveMappings:a,isVisible:!0},p=h.useMemo(()=>{if(!u)return Ph;const f=u*Zv;return Math.min(c,f)},[u,c]);return r.jsxs("div",{ref:o,className:`relative flex flex-col ${i}`,style:{height:"100%"},children:[r.jsx(xz,{ref:l,height:p,itemCount:u,itemSize:Zv,itemData:m,className:"scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",overscanCount:2,children:HS}),e.length>5&&r.jsxs("div",{className:"absolute bottom-2 right-2 text-xs text-gray-500 bg-white px-2 py-1 rounded shadow-sm",children:[e.length," columns"]})]})},Mz=({selectedFile:e,analysisResult:t,userMappings:n,effectiveMappings:s,overallConfidence:a,validationResults:i,onUpdateMapping:l,onMappingConfirmed:o,onLoadPreview:c,llmRecommendations:d})=>{var L;const[u,m]=h.useState(!1),[p,f]=h.useState(null),[y,g]=h.useState(!1),{closeAllDropdowns:x}=qS();h.useEffect(()=>()=>{x(),f(null)},[x]);const b=h.useCallback(async()=>{if(!(!e||!c)){g(!0);try{const P=await c(e);f(P)}catch{f(null)}finally{g(!1)}}},[e,c]);h.useEffect(()=>{e&&Object.keys(n).length>0&&b()},[e,n,b]);const v=h.useCallback((P,$)=>{l&&($==="import_as_new"?l(P,"import_as_new"):$==="ignore_column"?l(P,"ignore_column"):$==="none"||$===""?l(P,null):l(P,$))},[l]),w=h.useCallback(()=>{t!=null&&t.mapping_suggestions&&t.mapping_suggestions.filter(P=>P.target_column&&P.confidence>=90).forEach(P=>{l(P.source_column,P.target_column)})},[t==null?void 0:t.mapping_suggestions,l]),N=h.useCallback(()=>{t!=null&&t.mapping_suggestions&&(Object.keys(n).forEach(P=>{l(P,null)}),t.mapping_suggestions.filter(P=>P.target_column).forEach(P=>{l(P.source_column,P.target_column)}))},[t==null?void 0:t.mapping_suggestions,n,l]),k=()=>{const P=D();P&&P.forEach($=>{const R=s.find(U=>U.source_column===$.name);R!=null&&R.target_column||l($.name,"ignore_column")})},j=()=>{const P=D();P&&P.forEach($=>{const R=s.find(U=>U.source_column===$.name);R!=null&&R.target_column||l($.name,"import_as_new")})},S=h.useMemo(()=>(t==null?void 0:t.source_columns)||[],[t==null?void 0:t.source_columns]),_=h.useMemo(()=>(t==null?void 0:t.mapping_suggestions)||[],[t==null?void 0:t.mapping_suggestions]),C=h.useMemo(()=>{if(!S.length)return new Map;const P=new Map;return S.forEach($=>{P.set($.name,$.original_position??0)}),P},[S]),D=h.useCallback(()=>S.length?[...S].sort((P,$)=>{const R=s.find(K=>K.source_column===P.name),U=s.find(K=>K.source_column===$.name),I=(R==null?void 0:R.confidence)||0,z=(U==null?void 0:U.confidence)||0;if(R!=null&&R.target_column&&!(U!=null&&U.target_column))return-1;if(!(R!=null&&R.target_column)&&(U!=null&&U.target_column))return 1;if(I!==z)return z-I;const F=C.get(P.name)??0,O=C.get($.name)??0;return F-O}):[],[S,s,C]),{existing_table_info:A=null}=t,E=(A==null?void 0:A.columns)||[],T=h.useCallback(P=>{var $;return($=d==null?void 0:d.recommendations)==null?void 0:$.find(R=>R.column_name===P)},[d]),M=h.useCallback(P=>{if(!S.length)return[];const $=new Set;s.forEach(O=>{O.target_column&&O.target_column!=="import_as_new"&&$.add(O.target_column)});const R=S.find(O=>O.name===P);if(!R)return[];const U=_.find(O=>O.source_column===R.name&&O.target_column),I=T(R.name),z=s.find(O=>O.source_column===R.name),F=[];if(z!=null&&z.target_column||F.push({value:"",label:"Choose column...",type:"choose",confidence:null,isRecommended:!1,hasLlmSupport:!1,group:"default"}),U&&U.target_column&&(!$.has(U.target_column)||(z==null?void 0:z.target_column)===U.target_column)){const O=I?`${U.target_column} (AI + LLM Recommended)`:`${U.target_column} (AI Recommended)`;F.push({value:U.target_column,label:O,type:"ai_recommendation",confidence:U.confidence,isRecommended:!0,hasLlmSupport:!!I,group:"ai_recommendations"})}return U!=null&&U.target_column||F.push({value:"import_as_new",label:"Import as new column (Recommended)",type:"import_new",confidence:null,isRecommended:!0,hasLlmSupport:!1,group:"import_options"}),E.length>0&&E.forEach(O=>{const K=(z==null?void 0:z.target_column)===O.name,J=$.has(O.name),se=U&&O.name===U.target_column;(!J||K||se)&&(se||F.push({value:O.name,label:O.name,type:"database_column",confidence:null,isRecommended:!1,hasLlmSupport:!1,group:"database_columns"}))}),U!=null&&U.target_column&&F.push({value:"import_as_new",label:"Import as new column",type:"import_new",confidence:null,isRecommended:!1,hasLlmSupport:!1,group:"import_options"}),F.push({value:"ignore_column",label:"Ignore column",type:"ignore_column",confidence:null,isRecommended:!1,hasLlmSupport:!1,group:"import_options",description:"Exclude this column from import"}),F},[S,_,E,T,s]);return t?r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("div",{className:"flex items-center gap-3",children:r.jsxs("div",{children:[r.jsxs("h3",{className:"font-medium text-gray-900",children:["Map Your Columns (",s.filter(P=>P.target_column).length," of ",((L=t==null?void 0:t.source_columns)==null?void 0:L.length)||0," mapped)"]}),r.jsx("p",{className:"text-sm text-gray-600",children:"Match source columns to target database fields"})]})}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(H,{variant:"ghost",size:"sm",onClick:w,title:"Auto-apply high confidence mappings (90%+)",className:"text-prelude-700 hover:text-prelude-800 hover:bg-prelude-50",children:[r.jsx(hP,{className:"w-4 h-4 mr-1"}),"Auto Map"]}),r.jsxs(H,{variant:"ghost",size:"sm",onClick:j,title:"Import all unmapped columns as new columns",className:"text-green-600 hover:text-green-700 hover:bg-green-50",children:[r.jsx(Wt,{className:"w-4 h-4 mr-1"}),"Import All"]}),r.jsxs(H,{variant:"ghost",size:"sm",onClick:k,title:"Ignore all unmapped columns",className:"text-gray-600 hover:text-gray-700 hover:bg-gray-50",children:[r.jsx(Ku,{className:"w-4 h-4 mr-1"}),"Ignore All"]}),r.jsxs(H,{variant:"ghost",size:"sm",onClick:N,title:"Reset to AI suggestions",className:"text-gray-600 hover:text-gray-700",children:[r.jsx(_d,{className:"w-4 h-4 mr-1"}),"Reset"]}),r.jsxs(H,{variant:"ghost",size:"sm",onClick:()=>m(!u),className:"text-gray-600 hover:text-gray-700",children:[r.jsx(bs,{className:"w-4 h-4 mr-1"}),u?"Hide Preview":"Show Preview"]})]})]})}),r.jsx("div",{className:"flex-1 min-h-0 flex flex-col",children:r.jsxs("div",{className:`flex-1 min-h-0 grid transition-all duration-300 ${u?"grid-cols-2":"grid-cols-1"} gap-0`,children:[r.jsx("div",{className:"flex flex-col min-h-0 h-full",children:r.jsx("div",{className:"flex-1 min-h-0 p-6 flex flex-col",children:r.jsx(Oz,{columns:D(),generateOptionsForColumn:M,handleMappingChange:v,getLlmRecommendation:T,effectiveMappings:s,className:"flex-1 min-h-0"})})}),r.jsx(ht,{children:u&&r.jsxs(de.div,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},className:"flex flex-col border-l border-gray-200",children:[r.jsxs("div",{className:"p-4 bg-gray-50 border-b border-gray-200",children:[r.jsx("h4",{className:"font-medium text-gray-900",children:"Data Preview"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Preview with current mappings"})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:r.jsx(lz,{previewData:p,mappings:n,dataIssues:t.data_issues||[],isLoading:y})})]})})]})}),r.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:[i&&r.jsxs("div",{className:"mb-4",children:[i.issues.length>0&&r.jsx("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded-lg",children:r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx(Cr,{className:"w-5 h-5 text-red-500 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-red-800",children:"Issues Found"}),r.jsx("ul",{className:"text-sm text-red-700 mt-1 space-y-1",children:i.issues.slice(0,3).map((P,$)=>r.jsxs("li",{children:[" ",P.message]},$))})]})]})}),i.warnings.length>0&&r.jsx("div",{className:"mb-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx(Cr,{className:"w-5 h-5 text-yellow-500 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-yellow-800",children:"Warnings"}),r.jsx("ul",{className:"text-sm text-yellow-700 mt-1 space-y-1",children:i.warnings.slice(0,2).map((P,$)=>r.jsxs("li",{children:[" ",P.message]},$))})]})]})})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("div",{className:"text-sm text-gray-600",children:a>0&&r.jsxs("span",{children:[a,"% confidence"]})}),r.jsxs("div",{className:"flex items-center gap-3",children:[!u&&r.jsxs(H,{variant:"ghost",onClick:()=>m(!0),children:[r.jsx(bs,{className:"w-4 h-4 mr-2"}),"Preview Data"]}),r.jsxs(H,{onClick:o,disabled:!(i!=null&&i.canProceed),className:"bg-prelude-800 hover:bg-prelude-900 text-white",children:[r.jsx(ax,{className:"w-4 h-4 mr-2"}),"Continue Upload",r.jsx(Dn,{className:"w-4 h-4 ml-2"})]})]})]})]})]}):r.jsx("div",{className:"p-6",children:r.jsxs("div",{className:"animate-pulse space-y-4",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),r.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})})},Iz=e=>r.jsx(Tz,{children:r.jsx(Mz,{...e})}),He={TABLE_NOT_FOUND:"table_not_found",SCHEMA_INCOMPATIBLE:"schema_incompatible",PERMISSION_DENIED:"permission_denied",CONSTRAINT_VIOLATION:"constraint_violation",TRANSACTION_FAILED:"transaction_failed",LLM_SERVICE_DOWN:"llm_service_down",NETWORK_ERROR:"network_error",TIMEOUT_ERROR:"timeout_error",VALIDATION_ERROR:"validation_error",DATA_TYPE_MISMATCH:"data_type_mismatch",COLUMN_COUNT_MISMATCH:"column_count_mismatch",DUPLICATE_KEY_ERROR:"duplicate_key_error",FOREIGN_KEY_ERROR:"foreign_key_error",CHECK_CONSTRAINT_ERROR:"check_constraint_error",NOT_NULL_VIOLATION:"not_null_violation",INSUFFICIENT_PRIVILEGES:"insufficient_privileges",DISK_SPACE_ERROR:"disk_space_error",MEMORY_ERROR:"memory_error",CONNECTION_ERROR:"connection_error",SERVICE_UNAVAILABLE:"service_unavailable"},Fr={MEDIUM:"medium",HIGH:"high",CRITICAL:"critical"},Je={RETRY:"retry",RETRY_WITH_BACKOFF:"retry_with_backoff",SELECT_DIFFERENT_TABLE:"select_different_table",CREATE_NEW_TABLE:"create_new_table",USE_ADVANCED_MAPPING:"use_advanced_mapping",REVIEW_COLUMN_MAPPING:"review_column_mapping",MODIFY_DATA:"modify_data",CONTACT_ADMIN:"contact_admin",CANCEL_OPERATION:"cancel_operation",SWITCH_TO_CREATE_MODE:"switch_to_create_mode",REDUCE_FILE_SIZE:"reduce_file_size",TRY_DIFFERENT_SERVICE:"try_different_service",REFRESH_CONNECTION:"refresh_connection"},ew={[He.TABLE_NOT_FOUND]:{title:"Target Table Not Found",message:"The table you selected for append no longer exists. It may have been deleted or renamed by another user.",severity:Fr.HIGH,actions:[Je.SELECT_DIFFERENT_TABLE,Je.CREATE_NEW_TABLE,Je.CANCEL_OPERATION],recoverable:!0,retryable:!1},[He.SCHEMA_INCOMPATIBLE]:{title:"Schema Incompatibility",message:"Your CSV data has structural differences that cannot be automatically resolved with the target table.",severity:Fr.HIGH,actions:[Je.USE_ADVANCED_MAPPING,Je.REVIEW_COLUMN_MAPPING,Je.SWITCH_TO_CREATE_MODE,Je.CANCEL_OPERATION],recoverable:!0,retryable:!1},[He.PERMISSION_DENIED]:{title:"Permission Denied",message:"You don't have sufficient permissions to modify this table. Contact your administrator for access.",severity:Fr.CRITICAL,actions:[Je.CONTACT_ADMIN,Je.SELECT_DIFFERENT_TABLE,Je.CANCEL_OPERATION],recoverable:!1,retryable:!1},[He.CONSTRAINT_VIOLATION]:{title:"Data Constraint Violation",message:"Some data in your file violates table constraints (unique keys, foreign keys, or check constraints).",severity:Fr.HIGH,actions:[Je.REVIEW_COLUMN_MAPPING,Je.MODIFY_DATA,Je.SWITCH_TO_CREATE_MODE,Je.CANCEL_OPERATION],recoverable:!0,retryable:!1},[He.TRANSACTION_FAILED]:{title:"Transaction Failed",message:"The database transaction failed during data insertion. Your table was not modified.",severity:Fr.HIGH,actions:[Je.RETRY,Je.REVIEW_COLUMN_MAPPING,Je.CANCEL_OPERATION],recoverable:!0,retryable:!0},[He.LLM_SERVICE_DOWN]:{title:"AI Service Unavailable",message:"The AI recommendation service is temporarily unavailable. You can still proceed with manual mapping.",severity:Fr.MEDIUM,actions:[Je.USE_ADVANCED_MAPPING,Je.RETRY_WITH_BACKOFF,Je.CANCEL_OPERATION],recoverable:!0,retryable:!0},[He.NETWORK_ERROR]:{title:"Network Connection Error",message:"Unable to connect to the server. Please check your internet connection and try again.",severity:Fr.MEDIUM,actions:[Je.RETRY,Je.REFRESH_CONNECTION,Je.CANCEL_OPERATION],recoverable:!0,retryable:!0},[He.TIMEOUT_ERROR]:{title:"Upload Timeout",message:"The upload took too long to complete. This often happens with large files or slow connections.",severity:Fr.MEDIUM,actions:[Je.RETRY,Je.REDUCE_FILE_SIZE,Je.CANCEL_OPERATION],recoverable:!0,retryable:!0},[He.VALIDATION_ERROR]:{title:"Data Validation Error",message:"Some data in your file doesn't meet the validation requirements for the target table.",severity:Fr.MEDIUM,actions:[Je.REVIEW_COLUMN_MAPPING,Je.MODIFY_DATA,Je.CANCEL_OPERATION],recoverable:!0,retryable:!1},[He.DATA_TYPE_MISMATCH]:{title:"Data Type Mismatch",message:"Column data types in your file don't match the target table schema.",severity:Fr.HIGH,actions:[Je.USE_ADVANCED_MAPPING,Je.REVIEW_COLUMN_MAPPING,Je.SWITCH_TO_CREATE_MODE],recoverable:!0,retryable:!1},[He.DUPLICATE_KEY_ERROR]:{title:"Duplicate Key Error",message:"Your data contains duplicate values for columns with unique constraints.",severity:Fr.HIGH,actions:[Je.MODIFY_DATA,Je.REVIEW_COLUMN_MAPPING,Je.CANCEL_OPERATION],recoverable:!0,retryable:!1},[He.INSUFFICIENT_PRIVILEGES]:{title:"Insufficient Database Privileges",message:"Your database user doesn't have the required privileges to perform this operation.",severity:Fr.CRITICAL,actions:[Je.CONTACT_ADMIN,Je.TRY_DIFFERENT_SERVICE,Je.CANCEL_OPERATION],recoverable:!1,retryable:!1},[He.SERVICE_UNAVAILABLE]:{title:"Service Temporarily Unavailable",message:"The upload service is temporarily unavailable. Please try again in a few moments.",severity:Fr.HIGH,actions:[Je.RETRY_WITH_BACKOFF,Je.TRY_DIFFERENT_SERVICE,Je.CANCEL_OPERATION],recoverable:!0,retryable:!0}},WS={[Je.RETRY]:{label:"Try Again",description:"Retry the operation immediately",icon:"RefreshCw",primary:!0},[Je.RETRY_WITH_BACKOFF]:{label:"Retry in a Moment",description:"Wait and retry automatically",icon:"Clock",primary:!0},[Je.SELECT_DIFFERENT_TABLE]:{label:"Select Different Table",description:"Choose a different table to append to",icon:"Table",primary:!1},[Je.CREATE_NEW_TABLE]:{label:"Create New Table",description:"Create a new table instead of appending",icon:"Plus",primary:!1},[Je.USE_ADVANCED_MAPPING]:{label:"Advanced Mapping",description:"Use manual column mapping options",icon:"Settings",primary:!0},[Je.REVIEW_COLUMN_MAPPING]:{label:"Review Column Mapping",description:"Check and modify column mappings",icon:"MapPin",primary:!0},[Je.MODIFY_DATA]:{label:"Modify Data",description:"Fix data issues in your file first",icon:"Edit",primary:!1},[Je.CONTACT_ADMIN]:{label:"Contact Administrator",description:"Get help from system administrator",icon:"HelpCircle",primary:!1},[Je.CANCEL_OPERATION]:{label:"Cancel",description:"Cancel the upload operation",icon:"X",primary:!1},[Je.SWITCH_TO_CREATE_MODE]:{label:"Create New Table Instead",description:"Create a new table with your data",icon:"Plus",primary:!1},[Je.REDUCE_FILE_SIZE]:{label:"Reduce File Size",description:"Try with a smaller file or fewer rows",icon:"Minimize2",primary:!1},[Je.TRY_DIFFERENT_SERVICE]:{label:"Try Different Service",description:"Switch to a different backend service",icon:"Shuffle",primary:!1},[Je.REFRESH_CONNECTION]:{label:"Refresh Connection",description:"Reset your connection and try again",icon:"Wifi",primary:!1}},tw={TABLE_NOT_FOUND:He.TABLE_NOT_FOUND,RELATION_DOES_NOT_EXIST:He.TABLE_NOT_FOUND,NO_SUCH_TABLE:He.TABLE_NOT_FOUND,SCHEMA_MISMATCH:He.SCHEMA_INCOMPATIBLE,COLUMN_MISMATCH:He.SCHEMA_INCOMPATIBLE,TYPE_MISMATCH:He.DATA_TYPE_MISMATCH,COLUMN_COUNT_MISMATCH:He.COLUMN_COUNT_MISMATCH,PERMISSION_DENIED:He.PERMISSION_DENIED,ACCESS_DENIED:He.PERMISSION_DENIED,INSUFFICIENT_PRIVILEGES:He.INSUFFICIENT_PRIVILEGES,UNAUTHORIZED:He.PERMISSION_DENIED,UNIQUE_VIOLATION:He.DUPLICATE_KEY_ERROR,FOREIGN_KEY_VIOLATION:He.FOREIGN_KEY_ERROR,CHECK_VIOLATION:He.CHECK_CONSTRAINT_ERROR,NOT_NULL_VIOLATION:He.NOT_NULL_VIOLATION,CONSTRAINT_VIOLATION:He.CONSTRAINT_VIOLATION,TRANSACTION_FAILED:He.TRANSACTION_FAILED,ROLLBACK:He.TRANSACTION_FAILED,DEADLOCK:He.TRANSACTION_FAILED,LLM_SERVICE_UNAVAILABLE:He.LLM_SERVICE_DOWN,AI_SERVICE_DOWN:He.LLM_SERVICE_DOWN,RECOMMENDATION_SERVICE_ERROR:He.LLM_SERVICE_DOWN,CONNECTION_ERROR:He.CONNECTION_ERROR,NETWORK_ERROR:He.NETWORK_ERROR,TIMEOUT:He.TIMEOUT_ERROR,REQUEST_TIMEOUT:He.TIMEOUT_ERROR,VALIDATION_ERROR:He.VALIDATION_ERROR,DATA_VALIDATION_FAILED:He.VALIDATION_ERROR,DISK_FULL:He.DISK_SPACE_ERROR,OUT_OF_MEMORY:He.MEMORY_ERROR,RESOURCE_EXHAUSTED:He.MEMORY_ERROR,SERVICE_UNAVAILABLE:He.SERVICE_UNAVAILABLE,SERVER_ERROR:He.SERVICE_UNAVAILABLE,INTERNAL_SERVER_ERROR:He.SERVICE_UNAVAILABLE},Fx={[He.NETWORK_ERROR]:{maxAttempts:3,baseDelayMs:1e3,maxDelayMs:1e4,exponentialBase:2},[He.TIMEOUT_ERROR]:{maxAttempts:2,baseDelayMs:2e3,maxDelayMs:15e3,exponentialBase:2},[He.LLM_SERVICE_DOWN]:{maxAttempts:2,baseDelayMs:5e3,maxDelayMs:2e4,exponentialBase:1.5},[He.TRANSACTION_FAILED]:{maxAttempts:2,baseDelayMs:1e3,maxDelayMs:5e3,exponentialBase:1.5},[He.SERVICE_UNAVAILABLE]:{maxAttempts:3,baseDelayMs:3e3,maxDelayMs:3e4,exponentialBase:2}};function Ld(e,t={}){let n=null,s="",a={},i=null;if(e.response){i=e.response.status;const c=e.response.data;typeof c=="object"?(n=c.error_code||c.code||c.type,s=c.message||c.error||c.detail,a=c.details||c.data||{}):s=c||e.response.statusText}else e.message?(s=e.message,n=rw(s)):typeof e=="string"?(s=e,n=rw(e)):typeof e=="object"&&(n=e.code||e.type||e.error_code,s=e.message||e.error||e.description,a=e.details||e.data||{});const l=Lz(n,i,s),o=ew[l]||ew[He.SERVICE_UNAVAILABLE];return{type:l,code:n,message:s,details:a,httpStatus:i,severity:o.severity,title:o.title,userMessage:o.message,recoverable:o.recoverable,retryable:o.retryable,suggestedActions:o.actions,retryConfig:Fx[l],context:t,timestamp:new Date().toISOString(),originalError:e}}function rw(e){if(!e||typeof e!="string")return null;const t=e.toUpperCase(),n=[{pattern:/TABLE.*NOT.*FOUND|RELATION.*DOES NOT EXIST/i,code:"TABLE_NOT_FOUND"},{pattern:/PERMISSION.*DENIED|ACCESS.*DENIED/i,code:"PERMISSION_DENIED"},{pattern:/UNIQUE.*VIOLATION|DUPLICATE.*KEY/i,code:"UNIQUE_VIOLATION"},{pattern:/FOREIGN.*KEY.*VIOLATION/i,code:"FOREIGN_KEY_VIOLATION"},{pattern:/CHECK.*VIOLATION|CHECK.*CONSTRAINT/i,code:"CHECK_VIOLATION"},{pattern:/NOT.*NULL.*VIOLATION/i,code:"NOT_NULL_VIOLATION"},{pattern:/TYPE.*MISMATCH|DATA.*TYPE/i,code:"TYPE_MISMATCH"},{pattern:/COLUMN.*MISMATCH|COLUMN.*COUNT/i,code:"COLUMN_MISMATCH"},{pattern:/SCHEMA.*MISMATCH/i,code:"SCHEMA_MISMATCH"},{pattern:/NETWORK.*ERROR|CONNECTION.*ERROR/i,code:"NETWORK_ERROR"},{pattern:/TIMEOUT|TIMED.*OUT/i,code:"TIMEOUT"},{pattern:/CONNECTION.*REFUSED|FAILED.*TO.*CONNECT/i,code:"CONNECTION_ERROR"},{pattern:/SERVICE.*UNAVAILABLE|SERVER.*ERROR/i,code:"SERVICE_UNAVAILABLE"},{pattern:/LLM.*SERVICE|AI.*SERVICE|RECOMMENDATION.*SERVICE/i,code:"LLM_SERVICE_UNAVAILABLE"},{pattern:/TRANSACTION.*FAILED|ROLLBACK|DEADLOCK/i,code:"TRANSACTION_FAILED"},{pattern:/DISK.*FULL|OUT.*OF.*SPACE/i,code:"DISK_FULL"},{pattern:/OUT.*OF.*MEMORY|MEMORY.*ERROR/i,code:"OUT_OF_MEMORY"},{pattern:/VALIDATION.*ERROR|VALIDATION.*FAILED/i,code:"VALIDATION_ERROR"}];for(const{pattern:s,code:a}of n)if(s.test(t))return a;return null}function Lz(e,t,n,s){if(e&&tw[e.toUpperCase()])return tw[e.toUpperCase()];if(t)switch(t){case 401:case 403:return He.PERMISSION_DENIED;case 404:return He.TABLE_NOT_FOUND;case 408:case 504:return He.TIMEOUT_ERROR;case 409:return He.CONSTRAINT_VIOLATION;case 422:return He.VALIDATION_ERROR;case 429:return He.SERVICE_UNAVAILABLE;case 500:case 502:case 503:return He.SERVICE_UNAVAILABLE;default:if(t>=400&&t<500)return He.VALIDATION_ERROR;if(t>=500)return He.SERVICE_UNAVAILABLE}if(n){const a=n.toUpperCase();if(a.includes("TABLE")&&a.includes("NOT FOUND"))return He.TABLE_NOT_FOUND;if(a.includes("PERMISSION")||a.includes("ACCESS"))return He.PERMISSION_DENIED;if(a.includes("TIMEOUT")||a.includes("TIMED OUT"))return He.TIMEOUT_ERROR;if(a.includes("NETWORK")||a.includes("CONNECTION"))return He.NETWORK_ERROR;if(a.includes("LLM")||a.includes("AI SERVICE"))return He.LLM_SERVICE_DOWN;if(a.includes("UNIQUE")||a.includes("DUPLICATE"))return He.DUPLICATE_KEY_ERROR;if(a.includes("SCHEMA")||a.includes("COLUMN"))return He.SCHEMA_INCOMPATIBLE}return He.SERVICE_UNAVAILABLE}function Rz(e,t={}){const n={};for(const s of e.suggestedActions){const a=WS[s];a&&(n[s]={...a,handler:$z(s,e,t)})}return n}function $z(e,t,n){return async(s={})=>{const a={...n,...s};switch(e){case Je.RETRY:return{action:"retry",immediate:!0,...a};case Je.RETRY_WITH_BACKOFF:return{action:"retry",immediate:!1,delay:(t.retryConfig||Fx[He.SERVICE_UNAVAILABLE]).baseDelayMs,...a};case Je.SELECT_DIFFERENT_TABLE:return{action:"navigate",phase:"file-selection",...a};case Je.CREATE_NEW_TABLE:return{action:"configure",mode:"create",clearTargetTable:!0,...a};case Je.USE_ADVANCED_MAPPING:return{action:"navigate",phase:"column-mapping",...a};case Je.REVIEW_COLUMN_MAPPING:return{action:"navigate",phase:"column-mapping",...a};case Je.SWITCH_TO_CREATE_MODE:return{action:"configure",mode:"create",operationMode:"CREATE",...a};case Je.CANCEL_OPERATION:return{action:"cancel",...a};case Je.CONTACT_ADMIN:return{action:"external",type:"contact_admin",errorDetails:t,...a};case Je.REFRESH_CONNECTION:return{action:"refresh",type:"connection",clearCache:!0,...a};default:return{action:"unknown",actionType:e,...a}}}}function Fz(e,t){t||(t=Fx[He.SERVICE_UNAVAILABLE]);const n=t.baseDelayMs*Math.pow(t.exponentialBase,e);return Math.min(n,t.maxDelayMs)}function zz(e,t=0){if(!e.retryable)return!1;const n=e.retryConfig;return n?t<n.maxAttempts:!1}function Bz(e,t={}){const{showTechnicalDetails:n=!1,showRecoveryActions:s=!0,includeTimestamp:a=!0}=t,i={title:e.title,message:e.userMessage,severity:e.severity,recoverable:e.recoverable,retryable:e.retryable};return s&&e.suggestedActions&&(i.actions=e.suggestedActions.map(l=>{const o=WS[l];return{type:l,label:o==null?void 0:o.label,description:o==null?void 0:o.description,icon:o==null?void 0:o.icon,primary:o==null?void 0:o.primary}})),n&&(i.technical={code:e.code,type:e.type,httpStatus:e.httpStatus,originalMessage:e.message,details:e.details}),a&&(i.timestamp=e.timestamp),i}const ut={IDLE:"idle",UPLOADING:"uploading",PROCESSING:"processing",SUCCESS:"success",ERROR:"error",CANCELLED:"cancelled",RETRYING:"retrying",RECOVERING:"recovering"},Uz=e=>{const[t,n]=h.useState(ut.IDLE),[s,a]=h.useState(0),[i,l]=h.useState(null),[o,c]=h.useState(null),[d,u]=h.useState(null),[m,p]=h.useState([]),[f,y]=h.useState([]),[g,x]=h.useState(null),[b,v]=h.useState(null),[w,N]=h.useState(0),[k,j]=h.useState({}),S=h.useRef(null),_=h.useCallback((F,O="info")=>{const K={timestamp:new Date().toISOString(),message:F,type:O,id:Date.now()+Math.random()};y(J=>[...J,K]),console.log(`[Upload ${O.toUpperCase()}] ${F}`)},[]),C=h.useCallback((F,O)=>{a(Math.max(0,Math.min(100,F))),O&&_(O)},[_]),D=h.useCallback(async(F,O={},K="quick",J={})=>{var Z,oe;if(!F||!e)throw new Error("File and upload service are required");n(ut.UPLOADING),a(0),l(null),c(null),u(null),p([]),y([]),x(new Date),v(null),N(0),j({file:F,mappings:O,mode:K,options:J}),S.current=new AbortController;let se=null;try{_(`Starting ${K} upload for file: ${F.name}`,"info"),_(`File size: ${(F.size/1024/1024).toFixed(2)} MB`,"info"),Object.keys(O).length>0&&_(`Using ${Object.keys(O).length} custom column mappings`,"info"),C(10,"Validating file...");const W=e.validateFile(F);if(!W.isValid)throw new Error(`File validation failed: ${W.errors.join(", ")}`);if(C(20,"File validation passed"),(Z=S.current)!=null&&Z.signal.aborted)throw new Error("Upload cancelled by user");C(30,"Uploading file to server..."),se=setInterval(()=>{a(V=>Math.min(V+Math.random()*10,80))},500);const B=await e.uploadFile(F,O,K,J);if(clearInterval(se),(oe=S.current)!=null&&oe.signal.aborted)throw new Error("Upload cancelled by user");return C(90,"Processing upload results..."),n(ut.PROCESSING),await new Promise(V=>setTimeout(V,1e3)),C(100,"Upload completed successfully!"),n(ut.SUCCESS),l(B),v(new Date),_("File uploaded and processed successfully","success"),B.rows_processed&&_(`Processed ${B.rows_processed} rows`,"success"),B.warnings&&B.warnings.length>0&&B.warnings.forEach(V=>{_(V,"warning")}),B}catch(W){se&&clearInterval(se);const B=W.message||"Upload failed with unknown error";if(B.includes("cancelled"))n(ut.CANCELLED),_("Upload cancelled by user","warning");else{const V=W.parsedError||Ld(W,{operation:"upload",fileName:F.name,mode:K,targetTable:J.target_table,phase:"upload"});u(V),c(V.userMessage||B);const re=Rz(V,{file:F,mappings:O,mode:K,options:J});p(Object.values(re)),n(ut.ERROR),_(`Upload failed: ${V.title}`,"error"),_(V.userMessage,"error"),console.error("Upload error details:",{parsed:V,originalError:W,context:{file:F.name,mode:K,options:J}})}throw v(new Date),W}finally{S.current=null}},[e,_,C]),A=h.useCallback(()=>{S.current&&!S.current.signal.aborted&&(S.current.abort(),_("Cancelling upload...","warning"))},[_]),E=h.useCallback(()=>{S.current&&S.current.abort(),n(ut.IDLE),a(0),l(null),c(null),u(null),p([]),y([]),x(null),v(null),N(0),j({})},[]),T=h.useCallback(async(F,O,K,J={})=>{if(!k.file)return D(F,O,K,J);N(se=>se+1),n(ut.RETRYING),_(`Retrying upload (attempt ${w+1})...`,"info");try{return await D(k.file,k.mappings,k.mode,k.options)}catch(se){throw _(`Retry attempt ${w+1} failed`,"error"),se}},[D,k,w,_]),M=h.useCallback(()=>{if(!g)return null;const O=(b||new Date)-g;return{milliseconds:O,seconds:Math.round(O/1e3),formatted:qz(O)}},[g,b]),L=h.useCallback(()=>({state:t,progress:s,duration:M(),logs:f.length,errors:f.filter(F=>F.type==="error").length,warnings:f.filter(F=>F.type==="warning").length,retryAttempts:w,hasError:!!o,hasParsedError:!!d,hasRecoveryOptions:m.length>0,errorType:d==null?void 0:d.type,errorSeverity:d==null?void 0:d.severity,recoverable:(d==null?void 0:d.recoverable)||!1,retryable:(d==null?void 0:d.retryable)||!1,success:t===ut.SUCCESS,failed:t===ut.ERROR,cancelled:t===ut.CANCELLED,inProgress:[ut.UPLOADING,ut.PROCESSING,ut.RETRYING].includes(t)}),[t,s,f,M,w,o,d,m]),P=h.useCallback(()=>{y([])},[]),$=h.useCallback(()=>({uploadId:g==null?void 0:g.toISOString(),state:t,duration:M(),logs:f,result:i,error:o,parsedError:d,retryAttempts:w,recoveryActions:m.map(F=>({type:F.type,label:F.label,description:F.description,primary:F.primary})),context:k}),[t,g,f,i,o,d,w,m,k,M]),R=h.useCallback(async(F,O={})=>{if(!d||!m.length)return console.warn("No recovery actions available"),{action:"none"};const K=m.find(J=>J.type===F);if(!K||!K.handler)return console.warn("Recovery action not found or invalid:",F),{action:"invalid",actionType:F};n(ut.RECOVERING),_(`Executing recovery action: ${K.label}`,"info");try{const J=await K.handler(O);return _(`Recovery action completed: ${K.label}`,"success"),J}catch(J){throw _(`Recovery action failed: ${K.label}`,"error"),J}finally{t===ut.RECOVERING&&n(ut.ERROR)}},[d,m,t,_]),U=h.useCallback(F=>m.some(O=>O.type===F),[m]),I=h.useCallback((F={})=>d?Bz(d,F):o?{title:"Upload Error",message:o,severity:"high",recoverable:!1,actions:[]}:null,[d,o]),z=h.useCallback(()=>!d||w>=3?!1:[He.NETWORK_ERROR,He.TIMEOUT_ERROR,He.SERVICE_UNAVAILABLE].includes(d.type),[d,w]);return{uploadState:t,progress:s,uploadResult:i,error:o,parsedError:d,recoveryActions:m,logs:f,retryAttempts:w,startUpload:D,cancelUpload:A,resetUpload:E,retryUpload:T,executeRecoveryAction:R,addLog:_,clearLogs:P,exportLogs:$,getUploadDuration:M,getUploadStats:L,getFormattedError:I,canExecuteRecoveryAction:U,canAutoRetry:z,isIdle:t===ut.IDLE,isUploading:t===ut.UPLOADING,isProcessing:t===ut.PROCESSING,isRetrying:t===ut.RETRYING,isRecovering:t===ut.RECOVERING,isSuccess:t===ut.SUCCESS,isError:t===ut.ERROR,isCancelled:t===ut.CANCELLED,inProgress:[ut.UPLOADING,ut.PROCESSING,ut.RETRYING].includes(t),canCancel:[ut.UPLOADING,ut.PROCESSING,ut.RETRYING].includes(t),canRetry:[ut.ERROR,ut.CANCELLED].includes(t),hasRecoveryOptions:m.length>0}},qz=e=>{if(e<1e3)return`${e}ms`;const t=Math.floor(e/1e3),n=Math.floor(t/60);return n>0?`${n}m ${t%60}s`:`${t}s`},Hz=({error:e,parsedError:t,recoveryActions:n=[],onRecoveryAction:s,onRetry:a,showTechnicalDetails:i=!1,className:l=""})=>{var w;const[o,c]=h.useState(!1),[d,u]=h.useState(null),m=N=>{switch(N){case Fr.CRITICAL:return{icon:Ql,color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200",badgeColor:"bg-red-100 text-red-800"};case Fr.HIGH:return{icon:Cr,color:"text-orange-600",bgColor:"bg-orange-50",borderColor:"border-orange-200",badgeColor:"bg-orange-100 text-orange-800"};case Fr.MEDIUM:return{icon:dt,color:"text-yellow-600",bgColor:"bg-yellow-50",borderColor:"border-yellow-200",badgeColor:"bg-yellow-100 text-yellow-800"};default:return{icon:dt,color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",badgeColor:"bg-blue-100 text-blue-800"}}},p=N=>({[Je.RETRY]:Be,[Je.RETRY_WITH_BACKOFF]:jt,[Je.SELECT_DIFFERENT_TABLE]:qn,[Je.USE_ADVANCED_MAPPING]:ys,[Je.CONTACT_ADMIN]:Cf,[Je.REFRESH_CONNECTION]:_f})[N]||ys,f=h.useCallback(async N=>{if(s){u(N);try{await s(N)}catch(k){console.error("Recovery action failed:",k)}finally{u(null)}}},[s]),y=t||{title:"Upload Error",userMessage:(e==null?void 0:e.message)||"An unexpected error occurred",severity:Fr.HIGH,retryable:!1,type:"unknown_error"},g=m(y.severity),x=g.icon,b=n.filter(N=>N.primary),v=n.filter(N=>!N.primary);return r.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`${l}`,children:r.jsxs(We,{className:`${g.borderColor} ${g.bgColor}`,children:[r.jsx(ir,{className:"pb-4",children:r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsx("div",{className:`p-2 rounded-full ${g.bgColor}`,children:r.jsx(x,{className:`w-6 h-6 ${g.color}`})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(cr,{className:"text-lg font-semibold text-gray-900",children:y.title}),r.jsx(an,{className:g.badgeColor,children:(w=y.severity)==null?void 0:w.toUpperCase()})]}),r.jsx("p",{className:"text-gray-700 leading-relaxed",children:y.userMessage}),t&&r.jsxs("div",{className:"flex items-center gap-4 mt-3 text-sm text-gray-500",children:[t.recoverable&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(AC,{className:"w-4 h-4"}),r.jsx("span",{children:"Recoverable"})]}),t.retryable&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(Be,{className:"w-4 h-4"}),r.jsx("span",{children:"Retryable"})]}),r.jsxs("div",{className:"text-xs",children:["Type: ",t.type]})]})]})]})}),r.jsxs(it,{className:"space-y-4",children:[b.length>0&&r.jsxs("div",{className:"space-y-3",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Recommended Actions"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(N=>{const k=p(N.type),j=d===N.type;return r.jsxs(H,{onClick:()=>f(N.type),disabled:j,size:"sm",className:"flex items-center gap-2",children:[j?r.jsx(Be,{className:"w-4 h-4 animate-spin"}):r.jsx(k,{className:"w-4 h-4"}),N.label]},N.type)})})]}),v.length>0&&r.jsxs("div",{className:"space-y-3",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Other Options"}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:v.map(N=>{const k=p(N.type),j=d===N.type;return r.jsxs(H,{onClick:()=>f(N.type),disabled:j,variant:"outline",size:"sm",className:"flex items-center gap-2 justify-start h-auto p-3",children:[j?r.jsx(Be,{className:"w-4 h-4 animate-spin"}):r.jsx(k,{className:"w-4 h-4"}),r.jsxs("div",{className:"text-left",children:[r.jsx("div",{className:"font-medium",children:N.label}),N.description&&r.jsx("div",{className:"text-xs text-gray-500 mt-1",children:N.description})]})]},N.type)})})]}),y.retryable&&a&&r.jsx("div",{className:"pt-2 border-t border-gray-200",children:r.jsxs(H,{onClick:a,variant:"outline",size:"sm",className:"w-full flex items-center justify-center gap-2",children:[r.jsx(Be,{className:"w-4 h-4"}),"Try Again"]})}),(i||t)&&r.jsxs("div",{children:[r.jsx(H,{variant:"ghost",size:"sm",className:"w-full flex items-center justify-center gap-2 text-gray-500 hover:text-gray-700",onClick:()=>c(!o),children:o?r.jsxs(r.Fragment,{children:[r.jsx(La,{className:"w-4 h-4"}),"Hide Technical Details"]}):r.jsxs(r.Fragment,{children:[r.jsx(Xt,{className:"w-4 h-4"}),"Show Technical Details"]})}),o&&r.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:r.jsxs("div",{className:"space-y-3 text-sm",children:[(t==null?void 0:t.code)&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-700",children:"Error Code:"}),r.jsx("span",{className:"ml-2 font-mono text-gray-600",children:t.code})]}),(t==null?void 0:t.httpStatus)&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-700",children:"HTTP Status:"}),r.jsx("span",{className:"ml-2 font-mono text-gray-600",children:t.httpStatus})]}),(t==null?void 0:t.message)&&t.message!==t.userMessage&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-700",children:"Technical Message:"}),r.jsx("div",{className:"mt-1 p-2 bg-white rounded border font-mono text-xs text-gray-600 whitespace-pre-wrap",children:t.message})]}),(t==null?void 0:t.details)&&Object.keys(t.details).length>0&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-700",children:"Additional Details:"}),r.jsx("div",{className:"mt-1 p-2 bg-white rounded border",children:r.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap",children:JSON.stringify(t.details,null,2)})})]}),(t==null?void 0:t.timestamp)&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-700",children:"Timestamp:"}),r.jsx("span",{className:"ml-2 font-mono text-gray-600",children:new Date(t.timestamp).toLocaleString()})]})]})})]}),y.severity===Fr.CRITICAL&&r.jsx("div",{className:"pt-2 border-t border-gray-200",children:r.jsxs(H,{variant:"link",size:"sm",className:"w-full flex items-center justify-center gap-2 text-gray-500",onClick:()=>{window.open(`/help/upload-errors#${y.type}`,"_blank")},children:[r.jsx(sa,{className:"w-4 h-4"}),"Get Help with This Error"]})})]})]})})},Wz=({selectedFile:e,uploadMode:t,userMappings:n,uploadState:s,progress:a,uploadResult:i,uploadError:l,parsedError:o,recoveryActions:c=[],logs:d,uploadStats:u,onStartUpload:m,onUploadComplete:p,onRetry:f,onRecoveryAction:y,formattedError:g,canAutoRetry:x,hasRecoveryOptions:b})=>{var S,_;const[v,w]=h.useState(!1),N=h.useRef(!1);h.useEffect(()=>{e&&s===ut.IDLE&&m&&m(e,n,t)},[e,s,n,t,m]),h.useEffect(()=>{s===ut.SUCCESS&&i&&p&&!N.current&&(N.current=!0,p(i)),s!==ut.SUCCESS&&(N.current=!1)},[s,i,p]);const k=()=>{switch(s){case ut.UPLOADING:case ut.PROCESSING:return r.jsx(Be,{className:"w-8 h-8 text-blue-600 animate-spin"});case ut.RETRYING:return r.jsx(Be,{className:"w-8 h-8 text-orange-600 animate-spin"});case ut.SUCCESS:return r.jsx(bt,{className:"w-8 h-8 text-green-600"});case ut.ERROR:case ut.CANCELLED:return r.jsx(Ze,{className:"w-8 h-8 text-red-600"});default:return r.jsx(vs,{className:"w-8 h-8 text-gray-400"})}},j=()=>{switch(s){case ut.UPLOADING:return"Uploading your file...";case ut.PROCESSING:return"Processing data and applying mappings...";case ut.RETRYING:return`Retrying upload${u!=null&&u.retryAttempts?` (attempt ${u.retryAttempts+1})`:""}...`;case ut.SUCCESS:return"Upload completed successfully!";case ut.ERROR:return(o==null?void 0:o.title)||"Upload failed";case ut.CANCELLED:return"Upload was cancelled";default:return"Preparing upload..."}};return r.jsxs("div",{className:"p-6 space-y-6 h-full overflow-y-auto",children:[r.jsxs(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center space-y-4",children:[r.jsx("div",{className:"flex justify-center",children:k()}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:j()}),e&&r.jsxs("p",{className:"text-gray-600 mt-1",children:[e.name,"  ",t==="quick"?"Quick Upload":"Advanced Upload"]})]}),(s===ut.UPLOADING||s===ut.PROCESSING||s===ut.RETRYING)&&r.jsxs("div",{className:"max-w-md mx-auto",children:[r.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 mb-2",children:[r.jsx("span",{children:"Progress"}),r.jsxs("span",{children:[a,"%"]}),(u==null?void 0:u.retryAttempts)>0&&r.jsxs("span",{className:"text-orange-600 text-xs",children:["(Retry #",u.retryAttempts+1,")"]})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:r.jsx(de.div,{className:`h-2 rounded-full ${s===ut.RETRYING?"bg-orange-600":"bg-prelude-800"}`,initial:{width:0},animate:{width:`${a}%`},transition:{duration:.3}})}),s===ut.RETRYING&&r.jsx("div",{className:"mt-2 text-xs text-orange-700 text-center",children:x?"Auto-retry in progress...":"Manual retry in progress..."})]})]}),u&&(u.inProgress||u.success||u.failed)&&r.jsx(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:r.jsxs(We,{children:[r.jsx(ir,{children:r.jsxs(cr,{className:"text-lg flex items-center gap-2",children:[r.jsx(jt,{className:"w-5 h-5"}),"Upload Statistics"]})}),r.jsx(it,{children:r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"font-semibold text-gray-900",children:((S=u.duration)==null?void 0:S.formatted)||"---"}),r.jsx("div",{className:"text-gray-600",children:"Duration"})]}),r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:"font-semibold text-gray-900",children:[a,"%"]}),r.jsx("div",{className:"text-gray-600",children:"Progress"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"font-semibold text-gray-900",children:u.logs}),r.jsx("div",{className:"text-gray-600",children:"Log Entries"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:`font-semibold ${u.errors>0?"text-red-600":"text-green-600"}`,children:u.errors}),r.jsx("div",{className:"text-gray-600",children:"Errors"})]})]})})]})}),s===ut.SUCCESS&&i&&r.jsxs(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"space-y-4",children:[r.jsx(We,{className:"border-green-200 bg-green-50",children:r.jsx(it,{className:"p-6",children:r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsx(bt,{className:"w-8 h-8 text-green-600 flex-shrink-0"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"text-lg font-semibold text-green-900 mb-2",children:"Upload Successful!"}),r.jsx("p",{className:"text-green-800 mb-4",children:"Your data has been successfully uploaded and processed."}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[i.rows_processed&&r.jsxs("div",{className:"text-center p-3 bg-white rounded-lg border border-green-200",children:[r.jsx(qn,{className:"w-5 h-5 text-green-600 mx-auto mb-1"}),r.jsx("div",{className:"font-semibold text-green-900",children:i.rows_processed.toLocaleString()}),r.jsx("div",{className:"text-sm text-green-700",children:"Rows Processed"})]}),i.columns_mapped&&r.jsxs("div",{className:"text-center p-3 bg-white rounded-lg border border-green-200",children:[r.jsx(Ot,{className:"w-5 h-5 text-green-600 mx-auto mb-1"}),r.jsx("div",{className:"font-semibold text-green-900",children:i.columns_mapped}),r.jsx("div",{className:"text-sm text-green-700",children:"Columns Mapped"})]}),i.data_quality_score&&r.jsxs("div",{className:"text-center p-3 bg-white rounded-lg border border-green-200",children:[r.jsx(bt,{className:"w-5 h-5 text-green-600 mx-auto mb-1"}),r.jsxs("div",{className:"font-semibold text-green-900",children:[Math.round(i.data_quality_score),"%"]}),r.jsx("div",{className:"text-sm text-green-700",children:"Quality Score"})]}),r.jsxs("div",{className:"text-center p-3 bg-white rounded-lg border border-green-200",children:[r.jsx(Ut,{className:"w-5 h-5 text-green-600 mx-auto mb-1"}),r.jsx("div",{className:"font-semibold text-green-900",children:i.table_name||"N/A"}),r.jsx("div",{className:"text-sm text-green-700",children:"Table Created"})]})]}),i.message&&r.jsx("div",{className:"p-3 bg-white rounded border border-green-200",children:r.jsx("p",{className:"text-sm text-green-800",children:i.message})})]})]})})}),i.warnings&&i.warnings.length>0&&r.jsx(We,{className:"border-yellow-200 bg-yellow-50",children:r.jsx(it,{className:"p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(dt,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-yellow-800",children:"Warnings"}),r.jsx("ul",{className:"text-sm text-yellow-700 mt-1 space-y-1",children:i.warnings.map((C,D)=>r.jsxs("li",{children:[" ",C]},D))})]})]})})})]}),s===ut.ERROR&&r.jsxs(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[r.jsx(Hz,{error:{message:l},parsedError:o,recoveryActions:c,onRecoveryAction:y,onRetry:f,showTechnicalDetails:!0,className:"mb-6"}),r.jsx(We,{className:"border-orange-200 bg-orange-50",children:r.jsxs(it,{className:"p-4",children:[r.jsxs("h4",{className:"font-medium text-orange-900 mb-3 flex items-center gap-2",children:[r.jsx(Ut,{className:"w-4 h-4"}),"Upload Context"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-orange-800",children:"File:"}),r.jsx("div",{className:"text-orange-700",children:(e==null?void 0:e.name)||"Unknown"}),r.jsx("div",{className:"text-xs text-orange-600",children:e!=null&&e.size?`${(e.size/1024/1024).toFixed(1)} MB`:""})]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-orange-800",children:"Mode:"}),r.jsx("div",{className:"text-orange-700 capitalize",children:t||"Unknown"}),r.jsxs("div",{className:"text-xs text-orange-600",children:[Object.keys(n||{}).length," column mappings"]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-orange-800",children:"Attempts:"}),r.jsx("div",{className:"text-orange-700",children:((u==null?void 0:u.retryAttempts)||0)+1}),r.jsx("div",{className:"text-xs text-orange-600",children:((_=u==null?void 0:u.duration)==null?void 0:_.formatted)||"No duration"})]})]}),x&&r.jsx("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded",children:r.jsxs("div",{className:"text-sm text-blue-800",children:[r.jsx("strong",{children:"Auto-retry available:"})," This error type supports automatic retry."]})})]})})]}),s===ut.CANCELLED&&r.jsx(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:r.jsx(We,{className:"border-yellow-200 bg-yellow-50",children:r.jsx(it,{className:"p-6",children:r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsx(Ze,{className:"w-8 h-8 text-yellow-600 flex-shrink-0"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"text-lg font-semibold text-yellow-900 mb-2",children:"Upload Cancelled"}),r.jsx("p",{className:"text-yellow-800 mb-4",children:"The upload process was cancelled before completion. No data was modified."}),r.jsxs("div",{className:"flex gap-3",children:[r.jsxs(H,{onClick:f,className:"bg-yellow-600 hover:bg-yellow-700 text-white",children:[r.jsx(Be,{className:"w-4 h-4 mr-2"}),"Start Over"]}),d.length>0&&r.jsxs(H,{variant:"outline",onClick:()=>w(!0),className:"border-yellow-300 text-yellow-800 hover:bg-yellow-100",children:[r.jsx(Ut,{className:"w-4 h-4 mr-2"}),"View Progress Log"]})]})]})]})})})}),r.jsx(ht,{children:v&&d.length>0&&r.jsx(de.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:r.jsxs(We,{children:[r.jsx(ir,{children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx(cr,{className:"text-lg",children:"Upload Logs"}),r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>w(!1),children:r.jsx(Ze,{className:"w-4 h-4"})})]})}),r.jsx(it,{children:r.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2 font-mono text-sm",children:d.map(C=>r.jsxs("div",{className:`p-2 rounded text-xs ${C.type==="error"?"bg-red-100 text-red-800":C.type==="warning"?"bg-yellow-100 text-yellow-800":C.type==="success"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:[r.jsx("span",{className:"text-gray-500",children:new Date(C.timestamp).toLocaleTimeString()})," - ",r.jsx("span",{children:C.message})]},C.id))})})]})})}),!(u!=null&&u.inProgress)&&r.jsxs(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"flex justify-center gap-4",children:[d.length>0&&r.jsxs(H,{variant:"ghost",onClick:()=>w(!v),children:[r.jsx(Ut,{className:"w-4 h-4 mr-2"}),v?"Hide Logs":"View Logs"]}),(i==null?void 0:i.view_url)&&r.jsxs(H,{variant:"ghost",onClick:()=>window.open(i.view_url,"_blank"),children:[r.jsx(sa,{className:"w-4 h-4 mr-2"}),"View Data"]}),(i==null?void 0:i.download_url)&&r.jsxs(H,{variant:"ghost",children:[r.jsx(ra,{className:"w-4 h-4 mr-2"}),"Download Report"]})]})]})},Yz=({isOpen:e,onClose:t,parsedError:n,recoveryActions:s=[],onRecoveryAction:a,onRetry:i,allowDismiss:l=!0,autoRetryCountdown:o=null})=>{var k;const[c,d]=h.useState(null),[u,m]=h.useState(o),[p,f]=h.useState(!!o);h.useEffect(()=>{if(!p||u<=0)return;const j=setInterval(()=>{m(S=>S<=1?(f(!1),i==null||i(),0):S-1)},1e3);return()=>clearInterval(j)},[p,u,i]);const y=h.useCallback(()=>{f(!1),m(0)},[]),g=h.useCallback(async j=>{if(a){d(j);try{const S=await a(j);(S==null?void 0:S.action)!=="none"&&(S==null?void 0:S.action)!=="invalid"&&setTimeout(()=>t(),500)}catch(S){console.error("Recovery action failed:",S)}finally{d(null)}}},[a,t]);if(!e||!n)return null;const b=(j=>{switch(j){case Fr.CRITICAL:return{icon:Ql,color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-500",badgeColor:"bg-red-100 text-red-800"};case Fr.HIGH:return{icon:Cr,color:"text-orange-600",bgColor:"bg-orange-50",borderColor:"border-orange-500",badgeColor:"bg-orange-100 text-orange-800"};default:return{icon:dt,color:"text-yellow-600",bgColor:"bg-yellow-50",borderColor:"border-yellow-500",badgeColor:"bg-yellow-100 text-yellow-800"}}})(n.severity),v=b.icon,w=s.filter(j=>j.primary),N=s.filter(j=>!j.primary);return r.jsx("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center p-4 bg-black bg-opacity-60",children:r.jsx(motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-auto",onClick:j=>j.stopPropagation(),children:r.jsxs(We,{className:`border-2 ${b.borderColor}`,children:[r.jsx(ir,{className:`${b.bgColor} border-b border-gray-200`,children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsx("div",{className:"p-3 rounded-full bg-white shadow-sm",children:r.jsx(v,{className:`w-8 h-8 ${b.color}`})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx(cr,{className:"text-xl font-semibold text-gray-900",children:n.title}),r.jsxs(an,{className:b.badgeColor,children:[(k=n.severity)==null?void 0:k.toUpperCase()," ERROR"]})]}),r.jsx("p",{className:"text-gray-800 leading-relaxed text-base",children:n.userMessage})]})]}),l&&r.jsx(H,{variant:"ghost",size:"sm",onClick:t,className:"p-2 hover:bg-white hover:bg-opacity-50",children:r.jsx(Ze,{className:"w-5 h-5 text-gray-500"})})]})}),r.jsxs(it,{className:"p-6 space-y-6",children:[p&&u>0&&r.jsx(motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(jt,{className:"w-5 h-5 text-blue-600"}),r.jsxs("div",{children:[r.jsxs("div",{className:"font-medium text-blue-900",children:["Auto-retry in ",u," seconds"]}),r.jsx("div",{className:"text-sm text-blue-700",children:"We'll automatically retry this operation"})]})]}),r.jsx(H,{variant:"outline",size:"sm",onClick:y,className:"border-blue-300 text-blue-700 hover:bg-blue-100",children:"Cancel Auto-retry"})]})}),w.length>0&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(bt,{className:"w-5 h-5 text-green-600"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Recommended Solutions"})]}),r.jsx("div",{className:"space-y-3",children:w.map((j,S)=>{const _=c===j.type;return r.jsx(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:S*.1},className:"p-4 border border-gray-200 rounded-lg hover:border-gray-300 transition-colors",children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium text-gray-900 mb-1",children:j.label}),j.description&&r.jsx("div",{className:"text-sm text-gray-600 mb-3",children:j.description})]}),r.jsxs(H,{onClick:()=>g(j.type),disabled:_,className:"ml-4 flex items-center gap-2",children:[_?r.jsx(Be,{className:"w-4 h-4 animate-spin"}):r.jsx(Dn,{className:"w-4 h-4"}),_?"Processing...":"Execute"]})]})},j.type)})})]}),w.length>0&&N.length>0&&r.jsx(Hk,{className:"my-6"}),N.length>0&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(dt,{className:"w-5 h-5 text-gray-600"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Other Options"})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:N.map(j=>{const S=c===j.type;return r.jsxs(H,{onClick:()=>g(j.type),disabled:S,variant:"outline",className:"h-auto p-4 flex flex-col items-start text-left",children:[r.jsx("div",{className:"font-medium mb-1",children:S?r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Be,{className:"w-4 h-4 animate-spin"}),"Processing..."]}):j.label}),j.description&&!S&&r.jsx("div",{className:"text-xs text-gray-500",children:j.description})]},j.type)})})]}),n.retryable&&i&&!p&&r.jsx("div",{className:"pt-4 border-t border-gray-200",children:r.jsxs(H,{onClick:i,variant:"outline",className:"w-full flex items-center justify-center gap-2 h-12",children:[r.jsx(Be,{className:"w-5 h-5"}),"Retry Operation Now"]})}),n.code&&r.jsx("div",{className:"pt-4 border-t border-gray-200",children:r.jsxs("details",{className:"group",children:[r.jsxs("summary",{className:"cursor-pointer text-sm text-gray-500 hover:text-gray-700 flex items-center gap-2",children:[r.jsx("span",{children:"Technical Details"}),r.jsx(sa,{className:"w-4 h-4"})]}),r.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200",children:r.jsxs("div",{className:"space-y-2 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Error Code:"}),r.jsx("span",{className:"ml-2 font-mono",children:n.code})]}),n.httpStatus&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"HTTP Status:"}),r.jsx("span",{className:"ml-2 font-mono",children:n.httpStatus})]}),n.type&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Error Type:"}),r.jsx("span",{className:"ml-2 font-mono",children:n.type})]}),n.timestamp&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Time:"}),r.jsx("span",{className:"ml-2",children:new Date(n.timestamp).toLocaleString()})]})]})})]})})]})]})})})},Vz=(e,t)=>{const[n,s]=h.useState(null),[a,i]=h.useState(!1),[l,o]=h.useState(null),c=h.useRef(null);h.useEffect(()=>()=>{c.current&&c.current.abort()},[]);const d=h.useMemo(()=>JSON.stringify({allowedTypes:t.allowedFileTypes,maxSize:t.maxFileSize,threshold:t.quickUploadThreshold}),[t.allowedFileTypes,t.maxFileSize,t.quickUploadThreshold]),u=h.useCallback(async(x,b={})=>{if(x){c.current&&c.current.abort(),c.current=new AbortController,i(!0),o(null);try{const v=IS(x,{allowedTypes:t.allowedFileTypes,maxSize:nz(t.maxFileSize||"50MB")});if(!v.isValid)throw new Error(v.errors.join(", "));const w=await e.analyzeUpload(x,{database_config:{...t.databaseConfig,...b.database_config},mapping_config:{...t.mappingConfig,...b.mapping_config},preview_config:{...t.previewConfig,...b.preview_config},target_table:b.target_table},{signal:c.current.signal});return s(w),w}catch(v){if(v.name==="AbortError")return console.log("File analysis was cancelled"),null;throw console.error("File analysis failed:",v),o(v.message),v}finally{i(!1)}}},[e,d]),m=h.useCallback(()=>{c.current&&(c.current.abort(),c.current=null),s(null),o(null),i(!1)},[]),p=h.useCallback(()=>{if(!n)return null;const{source_columns:x=[],mapping_suggestions:b=[],overall_confidence:v=0,missing_columns:w=[],new_columns:N=[],data_issues:k=[],data_quality_score:j=0}=n,S=b.filter(C=>C.target_column).length,_=b.filter(C=>C.target_column&&C.confidence>=90).length;return{totalColumns:x.length,mappedColumns:S,unmappedColumns:x.length-S,mappingPercentage:x.length>0?Math.round(S/x.length*100):0,overallConfidence:Math.round(v),highConfidenceCount:_,mediumConfidenceCount:b.filter(C=>C.target_column&&C.confidence>=70&&C.confidence<90).length,lowConfidenceCount:S-_,missingColumnsCount:w.length,newColumnsCount:N.length,dataIssuesCount:k.length,highSeverityIssues:k.filter(C=>C.severity==="high").length,dataQualityScore:Math.round(j),recommendedMode:v>=t.quickUploadThreshold?"quick":"advanced"}},[n,t.quickUploadThreshold]),f=h.useCallback(()=>{if(!n)return!1;const x=p();return x.overallConfidence>=t.quickUploadThreshold&&x.missingColumnsCount===0&&x.highSeverityIssues===0},[n,t.quickUploadThreshold,p]),y=h.useCallback(()=>{if(!n)return null;const{data_quality_score:x=0,data_issues:b=[]}=n;let v="poor",w="red";x>=95?(v="excellent",w="green"):x>=80?(v="good",w="blue"):x>=60&&(v="fair",w="yellow");const N=b.filter(j=>j.severity==="high"),k=b.filter(j=>j.severity==="medium");return{score:Math.round(x),level:v,color:w,issues:{critical:N.length,warnings:k.length,total:b.length},details:b}},[n]),g=h.useCallback(()=>{if(!n)return null;const{source_columns:x=[],mapping_suggestions:b=[]}=n;return x.map(v=>{const w=b.find(N=>N.source_column===v.name);return{...v,mapping:w,status:w!=null&&w.target_column?w.confidence>=90?"auto_mapped":"review_needed":"unmapped"}})},[n]);return{analysisResult:n,isAnalyzing:a,analysisError:l,analyzeFile:u,resetAnalysis:m,getAnalysisSummary:p,isQuickUploadRecommended:f,getDataQuality:y,getColumnAnalysis:g,hasAnalysis:!!n,hasError:!!l,canProceed:!!n&&!l}},El={HIGH:90,MEDIUM:70},So={AUTO_MAPPED:"auto_mapped",REVIEW_NEEDED:"review_needed",UNMAPPED:"unmapped",MANUAL:"manual"},Jf={MANUAL:"manual"},Gz=e=>!e||!e.target_column?So.UNMAPPED:e.mapping_type===Jf.MANUAL?So.MANUAL:e.confidence>=El.HIGH?So.AUTO_MAPPED:e.confidence>=El.MEDIUM?So.REVIEW_NEEDED:So.UNMAPPED,Kz=(e,t,n=null)=>{if(n&&typeof n.overall_confidence=="number")return Math.round(n.overall_confidence);if(!e||e.length===0)return 0;const s=e.filter(l=>l.target_column);if(s.length===0)return 0;const i=s.reduce((l,o)=>l+(o.confidence||0),0)/s.length;return Math.round(i)},Xz=(e,t)=>{const n=new Set(t.filter(s=>s.target_column).map(s=>s.source_column));return e.filter(s=>!n.has(s.name))},Jz=(e,t)=>{const n=new Set(t.filter(s=>s.target_column).map(s=>s.target_column));return e.columns.filter(s=>s.required&&!n.has(s.name)).map(s=>s.name)},Qz=(e,t,n,s={})=>{const a=[],i=[],l=Object.values(s).filter(u=>u==="ignore_column").length;e.length-l;const o=Jz(t,n);o.length>0&&a.push({type:"missing_required",message:`Required columns not mapped: ${o.join(", ")}`,columns:o,severity:"high"});const c=Xz(e,n).filter(u=>s[u.name]!=="ignore_column");if(c.length>0&&i.push({type:"unmapped_source",message:`Source columns will be imported as new: ${c.map(u=>u.name).join(", ")}`,columns:c.map(u=>u.name),severity:"medium"}),l>0){const u=Object.entries(s).filter(([,m])=>m==="ignore_column").map(([m])=>m);i.push({type:"ignored_columns",message:`${l} columns will be ignored: ${u.join(", ")}`,columns:u,severity:"low"})}const d=n.filter(u=>u.target_column&&u.target_column!=="ignore_column"&&u.confidence<El.MEDIUM);return d.length>0&&i.push({type:"low_confidence",message:`${d.length} mappings have low confidence`,columns:d.map(u=>u.source_column),severity:"medium"}),{isValid:a.length===0,issues:a,warnings:i,canProceed:a.filter(u=>u.severity==="high").length===0,stats:{totalColumns:e.length,mappedColumns:n.filter(u=>u.target_column&&u.target_column!=="ignore_column").length,ignoredColumns:l,unmappedColumns:c.length}}},Zz=(e,t)=>{const n=[...e];return Object.entries(t).forEach(([s,a])=>{const i=n.findIndex(c=>c.source_column===s),l=c=>100,o=c=>c==="ignore_column"?"ignore":c==="import_as_new"?"import_new":"map";i>=0?n[i]={...n[i],target_column:a,mapping_type:Jf.MANUAL,confidence:l(a),suggested_action:o(a)}:n.push({source_column:s,target_column:a,confidence:l(a),mapping_type:Jf.MANUAL,suggested_action:o(a)})}),n},e8=e=>{const t={};return e.filter(n=>n.target_column).forEach(n=>{t[n.source_column]=n.target_column}),t},t8=(e,t,n={})=>{const s=e.length,a=t.filter(p=>p.target_column==="ignore_column").length,i=t.filter(p=>p.target_column==="import_as_new").length,l=t.filter(p=>p.target_column&&p.target_column!=="ignore_column"&&p.target_column!=="import_as_new").length,o=s-l-a-i,c=t.filter(p=>p.target_column&&p.target_column!=="ignore_column"&&p.target_column!=="import_as_new"),d=c.filter(p=>p.confidence>=El.HIGH).length,u=c.filter(p=>p.confidence>=El.MEDIUM&&p.confidence<El.HIGH).length,m=c.length-d-u;return{total:s,mapped:l,ignored:a,importAsNew:i,unmapped:o,mappingPercentage:s>0?Math.round((l+i)/s*100):0,processedPercentage:s>0?Math.round((s-o)/s*100):0,confidence:{high:d,medium:u,low:m}}},r8=(e,t)=>{switch(t.type){case"SET_USER_MAPPING":return{...e,userMappings:{...e.userMappings,[t.sourceColumn]:t.targetColumn}};case"REMOVE_USER_MAPPING":const{[t.sourceColumn]:n,...s}=e.userMappings;return{...e,userMappings:s};case"BULK_AUTO_MAP":return{...e,userMappings:{...e.userMappings,...t.mappings}};case"RESET_MAPPINGS":return{...e,userMappings:t.mappings||{}};case"CLEAR_ALL_MAPPINGS":return{...e,userMappings:{}};case"IMPORT_MAPPINGS":return{...e,userMappings:t.mappings};case"SET_DROPDOWN_STATE":return{...e,openDropdowns:t.openDropdowns};default:return e}},n8={userMappings:{},openDropdowns:new Set},s8=(e,t)=>{const[n,s]=h.useReducer(r8,n8),{userMappings:a,openDropdowns:i}=n,[l,o]=h.useState(null),[c,d]=h.useState(!1),[u,m]=h.useState(null),[p,f]=h.useState(null),[y,g]=h.useState(null),[x,b]=h.useState(null),[v,w]=h.useState(!1),[N,k]=h.useState(null),j=h.useRef(null);h.useEffect(()=>()=>{j.current&&j.current.abort()},[]);const S=h.useMemo(()=>e!=null&&e.mapping_suggestions?Zz(e.mapping_suggestions,a):[],[e==null?void 0:e.mapping_suggestions,a]),_=h.useMemo(()=>e!=null&&e.source_columns?t8(e.source_columns,S):null,[e==null?void 0:e.source_columns,S]),C=h.useMemo(()=>(e==null?void 0:e.overall_confidence)!==void 0&&(e==null?void 0:e.overall_confidence)!==null?Math.round(e.overall_confidence):e!=null&&e.source_columns?Kz(S,e.source_columns,e):0,[S,e]),D=h.useMemo(()=>!(e!=null&&e.source_columns)||!(e!=null&&e.existing_table_info)?{isValid:!1,issues:[],warnings:[],canProceed:!1}:Qz(e.source_columns,e.existing_table_info,S,a),[e,S,a]),A=h.useCallback((G,q)=>{s({type:"SET_USER_MAPPING",sourceColumn:G,targetColumn:q})},[]),E=h.useCallback(G=>{s({type:"REMOVE_USER_MAPPING",sourceColumn:G})},[]),T=h.useCallback(()=>{s({type:"CLEAR_ALL_MAPPINGS"})},[]),M=h.useCallback(()=>{if(!(e!=null&&e.mapping_suggestions))return;const G={};e.mapping_suggestions.filter(q=>q.target_column&&q.confidence>=90).forEach(q=>{G[q.source_column]=q.target_column}),s({type:"BULK_AUTO_MAP",mappings:G})},[e==null?void 0:e.mapping_suggestions]),L=h.useCallback(()=>{if(!(e!=null&&e.mapping_suggestions))return;const G=e8(e.mapping_suggestions);s({type:"RESET_MAPPINGS",mappings:G})},[e==null?void 0:e.mapping_suggestions]),P=h.useCallback(async G=>{if(!(!G||!t)){j.current&&j.current.abort(),j.current=new AbortController,d(!0),m(null);try{const q=await t.previewMapping(G,a,{signal:j.current.signal});return o(q),q}catch(q){if(q.name==="AbortError")return console.log("Preview loading was cancelled"),null;throw console.error("Preview loading failed:",q),m(q.message),q}finally{d(!1)}}},[t,a]),$=h.useCallback(G=>S.find(q=>q.source_column===G),[S]),R=h.useCallback(G=>{const q=S.find(Q=>Q.target_column===G);return(q==null?void 0:q.source_column)||null},[S]),U=h.useCallback(G=>S.some(q=>q.target_column===G),[S]),I=h.useCallback(()=>{if(!(e!=null&&e.source_columns))return[];const G=new Set(S.filter(q=>q.target_column).map(q=>q.source_column));return e.source_columns.filter(q=>!G.has(q.name))},[e==null?void 0:e.source_columns,S]),z=h.useCallback(()=>{var q;if(!((q=e==null?void 0:e.existing_table_info)!=null&&q.columns))return[];const G=new Set(S.filter(Q=>Q.target_column).map(Q=>Q.target_column));return e.existing_table_info.columns.filter(Q=>!G.has(Q.name))},[e==null?void 0:e.existing_table_info,S]),F=h.useCallback(G=>{f(G)},[]),O=h.useCallback(()=>{f(null)},[]),K=h.useCallback((G,q)=>{G&&q&&A(G.name,q.name),f(null)},[A]),J=h.useCallback(()=>{if(!(e!=null&&e.source_columns))return{};const G={auto_mapped:[],review_needed:[],unmapped:[],manual:[]};return e.source_columns.forEach(q=>{const Q=$(q.name),ue=Gz(Q);G[ue]&&G[ue].push({...q,mapping:Q})}),G},[e==null?void 0:e.source_columns,$]),se=h.useCallback(()=>({userMappings:a,effectiveMappings:S,stats:_,confidence:C,validation:D}),[a,S,_,C,D]),Z=h.useCallback(async(G=!1)=>{if(!(!t||!(e!=null&&e.existing_table_info)||y&&!G)){w(!0),k(null);try{const q=e.existing_table_info.table_name,Q=e.source_columns||[],ue=e.missing_columns||[],Le=e.new_columns||[],ge=await t.getColumnMismatchRecommendations(q,Q,ue,Le);return g(ge),ge}catch(q){throw console.error("Failed to load LLM recommendations:",q),k(q.message),q}finally{w(!1)}}},[t,e,y]),oe=h.useCallback(async(G=!1)=>{if(!(!t||!(e!=null&&e.existing_table_info)||x&&!G))try{const q=e.existing_table_info.table_name,Q=e.source_columns||[],ue=await t.analyzeSchemaCompatibility(q,Q,"APPEND");return b(ue),ue}catch(q){throw console.error("Failed to load compatibility analysis:",q),q}},[t,e,x]),W=h.useCallback(async(G=!1)=>{if(!t||!(e!=null&&e.existing_table_info))return null;try{const q=e.existing_table_info.table_name,Q=e.source_columns||[],ue=await t.getComprehensiveAnalysis(q,Q,"APPEND");return b(ue.compatibility),g(ue.llmRecommendations),ue}catch(q){throw console.error("Failed to load comprehensive analysis:",q),k(q.message),q}},[t,e]),B=h.useCallback((G=null)=>{const q=G||(y==null?void 0:y.recommendations)||[],Q={};q.forEach(ue=>{ue.suggested_action==="add_column"?Q[ue.column_name]="import_as_new":ue.suggested_action==="map_existing"&&ue.target_column?Q[ue.column_name]=ue.target_column:ue.suggested_action==="skip_column"&&(Q[ue.column_name]=null)}),s({type:"BULK_AUTO_MAP",mappings:Q})},[y]),V=h.useCallback(G=>{var q;return((q=y==null?void 0:y.recommendations)==null?void 0:q.find(Q=>Q.column_name===G))||null},[y]),re=h.useMemo(()=>{var G;return((G=y==null?void 0:y.recommendations)==null?void 0:G.length)>0},[y]),Me=h.useCallback(()=>{if(!y)return null;const G=y.recommendations||[],q=G.reduce((Q,ue)=>(Q[ue.severity]=(Q[ue.severity]||0)+1,Q),{});return{totalRecommendations:G.length,severityCounts:q,overallConfidence:y.overall_confidence,businessContext:y.business_context,hasHighSeverityIssues:(q.high||0)>0,hasMediumSeverityIssues:(q.medium||0)>0}},[y]),he=h.useCallback(G=>{s({type:"IMPORT_MAPPINGS",mappings:G})},[]);return{userMappings:a,effectiveMappings:S,previewData:l,isLoadingPreview:c,previewError:u,draggedColumn:p,llmRecommendations:y,compatibilityData:x,isLoadingLlmInsights:v,llmInsightsError:N,openDropdowns:i,dispatch:s,mappingStats:_,overallConfidence:C,validationResults:D,updateMapping:A,removeMapping:E,clearAllMappings:T,autoApplyHighConfidenceMappings:M,resetToSuggestions:L,loadPreview:P,loadLlmRecommendations:Z,loadCompatibilityAnalysis:oe,loadComprehensiveAnalysis:W,applyLlmRecommendations:B,getLlmRecommendationForColumn:V,getLlmInsightsSummary:Me,getMappingForSource:$,getSourceForTarget:R,isTargetMapped:U,getUnmappedSources:I,getUnmappedTargets:z,getColumnsByStatus:J,handleDragStart:F,handleDragEnd:O,handleDrop:K,exportMappings:se,importMappings:he,hasPreview:!!l,hasPreviewError:!!u,canProceed:D.canProceed,hasMappings:Object.keys(a).length>0,isComplete:D.isValid,hasLlmInsights:re,hasLlmInsightsError:!!N,hasCompatibilityData:!!x}};class a8{constructor(t){this.config={targetService:"nl2sql",targetDatabase:"sales",expectedColumns:[],allowedFileTypes:[".csv",".xlsx"],maxFileSize:"50MB",quickUploadThreshold:90,databaseConfig:{schema_name:"sales",service_type:"nl2sql",timeout_seconds:30},previewConfig:{sample_size:25,include_nulls:!0,max_unique_values:50,show_data_types:!0,analyze_patterns:!0},mappingConfig:{service_context:"generic",confidence_threshold:70,use_ai_fallback:!0,enable_semantic_matching:!0},...t},this.serviceEndpoints={nl2sql:{baseUrl:"http://localhost:8002",uploadEndpoint:"/api/data/upload",analyzeEndpoint:"/api/data/analyze"},employee:{baseUrl:"http://localhost:7001",uploadEndpoint:"/employees/upload",analyzeEndpoint:"/employees/analyze"},crm:{baseUrl:"http://localhost:8003",uploadEndpoint:"/customers/upload",analyzeEndpoint:"/customers/analyze"},"lead-gen":{baseUrl:"http://localhost:9000",uploadEndpoint:"/leads/upload",analyzeEndpoint:"/leads/analyze"}},this.csvMappingServiceUrl=this.serviceEndpoints.nl2sql.baseUrl}async analyzeUpload(t,n={}){try{const s=new FormData;s.append("file",t);const a={...this.config.mappingConfig,...n.mapping_config},i=n.target_table||null,l=a.use_ai_fallback!==!1,o=a.confidence_threshold||70,c=new URLSearchParams;i&&c.append("target_table",i),c.append("use_ai_fallback",l.toString()),c.append("confidence_threshold",(o/100).toString());const d=localStorage.getItem("id_token"),u=await fetch(`${this.csvMappingServiceUrl}/api/data/analyze-upload-advanced?${c}`,{method:"POST",headers:{Authorization:`Bearer ${d}`},body:s});u.ok||await this._handleApiError(u,{operation:"analyze",fileName:t.name,targetTable:i,phase:"analysis"});const m=await u.json(),p=(m==null?void 0:m.analysis)||m||{},f=(p.overall_confidence||0)*100,y=(p.mapping_suggestions||[]).map(g=>({...g,confidence:(g.confidence||0)*100}));return{upload_mode:f>=this.config.quickUploadThreshold?"quick":"advanced",source_columns:p.source_columns||[],existing_table_info:p.existing_table_info,mapping_suggestions:y,missing_columns:p.missing_columns||[],new_columns:p.new_columns||[],overall_confidence:f,recommended_flow:this._determineRecommendedFlow({...p,overall_confidence:f}),data_issues:p.data_issues||[],preview_stats:p.preview_stats,data_quality_score:(p.data_quality_score||0)*100}}catch(s){const a=Ld(s,{operation:"analyze",fileName:t.name,targetTable:n.target_table,phase:"analysis"});console.error("File analysis failed:",a);const i=new Error(a.userMessage);throw i.parsedError=a,i.originalError=s,i}}async previewMapping(t,n){try{const s=new FormData;s.append("file",t);const a=new URLSearchParams;a.append("user_mappings",JSON.stringify(n)),a.append("sample_size",this.config.previewConfig.sample_size||10);const i=localStorage.getItem("id_token"),l=await fetch(`${this.csvMappingServiceUrl}/api/data/preview-mapping?${a}`,{method:"POST",headers:{Authorization:`Bearer ${i}`},body:s});l.ok||await this._handleApiError(l,{operation:"preview",fileName:t.name,phase:"mapping_preview",mappingCount:Object.keys(n).length});const o=await l.json();return o.preview||o}catch(s){const a=Ld(s,{operation:"preview",fileName:t.name,phase:"mapping_preview",mappingCount:Object.keys(n).length});console.error("Mapping preview failed:",a);const i=new Error(a.userMessage);throw i.parsedError=a,i.originalError=s,i}}async uploadFile(t,n,s="quick",a={}){const i=this.serviceEndpoints[this.config.targetService];if(!i)throw new Error(`Unsupported service: ${this.config.targetService}`);const l={operation:"upload",fileName:t.name,targetTable:a.target_table,mode:s,phase:"upload",service:this.config.targetService};return await this._executeWithRetry(async()=>{const o=new FormData;if(o.append("file",t),o.append("mapping_mode",s),o.append("target_database",this.config.targetDatabase),n&&Object.keys(n).length>0&&o.append("user_mappings",JSON.stringify(n)),this.config.targetService==="nl2sql"){const m=a.target_table;m?(o.append("target_table",m),o.append("operation_mode","APPEND")):(o.append("table_name",this.config.tableName||t.name.replace(/\.(csv|xlsx)$/i,"")),o.append("operation_mode","CREATE")),o.append("auto_adapt","true")}const c=localStorage.getItem("id_token"),d=await fetch(`${i.baseUrl}${i.uploadEndpoint}`,{method:"POST",headers:{Authorization:`Bearer ${c}`},body:o,signal:AbortSignal.timeout(a.timeout||3e5)});d.ok||await this._handleApiError(d,l);const u=await d.json();if(!u||typeof u!="object")throw new Error("Invalid response format from server");return u},l)}validateFile(t){const n=[],s=t.name.toLowerCase();this.config.allowedFileTypes.some(l=>s.endsWith(l.toLowerCase()))||n.push(`File type not supported. Allowed types: ${this.config.allowedFileTypes.join(", ")}`);const i=this._parseFileSize(this.config.maxFileSize);return t.size>i&&n.push(`File size exceeds limit of ${this.config.maxFileSize}`),/^[a-zA-Z0-9_\-\s.]+$/.test(t.name)||n.push("File name contains invalid characters"),{isValid:n.length===0,errors:n}}getServiceConfig(){const t={nl2sql:{displayName:"Sales Analytics",description:"Upload sales data for analytics and insights",expectedColumns:["employee_name","sales_amount","location","customer_name"],icon:"BarChart3"},employee:{displayName:"Employee Management",description:"Upload employee data and profiles",expectedColumns:["name","email","role","department"],icon:"Users"},crm:{displayName:"Customer Management",description:"Upload customer data and interactions",expectedColumns:["customer_name","email","phone","company"],icon:"UserCircle"},"lead-gen":{displayName:"Lead Generation",description:"Upload lead data for processing",expectedColumns:["company_name","contact_name","email","industry"],icon:"Target"}};return t[this.config.targetService]||t.nl2sql}_determineRecommendedFlow(t){const{overall_confidence:n=0,missing_columns:s=[],data_issues:a=[]}=t||{};return n>=90&&s.length===0&&a.length===0?"quick_upload":n<50||a.filter(i=>i.severity==="high").length>0?"require_review":"show_mapping_ui"}_parseFileSize(t){const n={KB:1024,MB:1048576,GB:1073741824},s=t.match(/^(\d+(?:\.\d+)?)\s*(KB|MB|GB)$/i);if(!s)return 50*1024*1024;const[,a,i]=s;return parseFloat(a)*n[i.toUpperCase()]}async checkLLMServiceHealth(){try{return(await fetch(`${this.csvMappingServiceUrl}/health`,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok}catch(t){return t.name==="AbortError"?console.warn("LLM service health check timed out"):console.warn("LLM service health check failed:",t),!1}}async _executeWithRetry(t,n={},s=0){try{return await t()}catch(a){const i=Ld(a,n);if(zz(i,s)){const o=Fz(s,i.retryConfig);return console.warn(`Operation failed (attempt ${s+1}), retrying in ${o}ms:`,i),await new Promise(c=>setTimeout(c,o)),this._executeWithRetry(t,n,s+1)}const l=new Error(i.userMessage);throw l.parsedError=i,l.originalError=a,l}}async _handleApiError(t,n={}){let s=`Request failed with status ${t.status}`,a={};try{const l=t.headers.get("content-type");l&&l.includes("application/json")?(a=await t.json(),s=a.message||a.error||a.detail||s):s=await t.text()||t.statusText||s}catch(l){console.warn("Failed to parse error response:",l),s=`${s}: ${t.statusText}`}const i=new Error(s);throw i.response={status:t.status,statusText:t.statusText,data:a},i}_validateOperationContext(t,n={}){const s=[];switch(t){case"upload":n.fileName||s.push("File name is required for upload operations"),n.mode==="append"&&!n.targetTable&&s.push("Target table is required for append operations");break;case"analyze":n.fileName||s.push("File name is required for analysis operations");break}if(s.length>0)throw new Error(`Operation validation failed: ${s.join(", ")}`)}_getErrorContext(t={}){var n;return{...t,service:this.config.targetService,database:this.config.targetDatabase,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,serviceConfig:{baseUrl:(n=this.serviceEndpoints[this.config.targetService])==null?void 0:n.baseUrl,timeout:this.config.timeout}}}isCriticalError(t){return t.parsedError?[He.PERMISSION_DENIED,He.INSUFFICIENT_PRIVILEGES,He.TABLE_NOT_FOUND,He.SCHEMA_INCOMPATIBLE].includes(t.parsedError.type):!1}getDisplayError(t){return t.parsedError?{title:t.parsedError.title,message:t.parsedError.userMessage,severity:t.parsedError.severity,recoverable:t.parsedError.recoverable,actions:t.parsedError.suggestedActions}:{title:"Upload Error",message:t.message||"An unexpected error occurred",severity:"high",recoverable:!1,actions:["cancel_operation"]}}}const i8=({isOpen:e,onClose:t,onUploadSuccess:n,config:s={}})=>{var ze;const[a,i]=h.useState("file-selection"),[l,o]=h.useState(null),[c,d]=h.useState({}),[u,m]=h.useState(null),[p,f]=h.useState(null),[y,g]=h.useState(null),[x,b]=h.useState(!1),[v,w]=h.useState(null),[N,k]=h.useState([]),j=h.useMemo(()=>LS(s.targetService||"nl2sql",s),[s]),S=h.useMemo(()=>new a8(j),[j]),{analysisResult:_,isAnalyzing:C,analysisError:D,analyzeFile:A,resetAnalysis:E,getAnalysisSummary:T,isQuickUploadRecommended:M,getDataQuality:L}=Vz(S,j),{userMappings:P,effectiveMappings:$,mappingStats:R,overallConfidence:U,validationResults:I,updateMapping:z,clearAllMappings:F,loadPreview:O,exportMappings:K}=s8(_,S),{uploadState:J,progress:se,uploadResult:Z,error:oe,parsedError:W,recoveryActions:B,logs:V,startUpload:re,resetUpload:Me,retryUpload:he,executeRecoveryAction:G,getUploadStats:q,getFormattedError:Q,canAutoRetry:ue,hasRecoveryOptions:Le}=Uz(S),ge={"file-selection":{component:sz,title:"Upload Data File",description:"Choose your file and let AI analyze it",showBack:!1},"mode-decision":{component:az,title:"Choose Upload Method",description:"Select how you want to process your data",showBack:!0},"schema-compatibility":{component:iz,title:"Schema Compatibility Review",description:"AI recommendations for data structure",showBack:!0},"column-mapping":{component:Iz,title:"Map Your Columns",description:"Review and customize column mappings",showBack:!0},"upload-processing":{component:Wz,title:"Processing Upload",description:"Your data is being processed",showBack:!1}},Se=h.useCallback(async(ee,X={})=>{o(ee),d(X);try{const te=await A(ee,X);te.recommended_flow==="quick_upload"&&M()?(m("quick"),te.existing_table_info?i("schema-compatibility"):i("upload-processing")):i("mode-decision")}catch(te){console.error("File analysis failed:",te),st(te,"analysis")}},[A,M]),ce=h.useCallback(ee=>{var X,te;m(ee),ee==="quick"?_!=null&&_.existing_table_info?i("schema-compatibility"):i("upload-processing"):_!=null&&_.existing_table_info&&(((X=_==null?void 0:_.new_columns)==null?void 0:X.length)>0||((te=_==null?void 0:_.missing_columns)==null?void 0:te.length)>0)?i("schema-compatibility"):i("column-mapping")},[_]),ke=h.useCallback(ee=>{f(ee.compatibilityData),g(ee.llmRecommendations),i("upload-processing")},[]),Pe=h.useCallback(ee=>{f(ee.compatibilityData),g(ee.llmRecommendations),i("column-mapping")},[]),qe=h.useCallback(()=>{i("upload-processing")},[]),ne=h.useCallback((ee,X,te)=>re(ee,X,te,c),[re,c]),ye=h.useCallback(ee=>{n&&n(ee)},[n]),Ee=h.useCallback(()=>{switch(a){case"mode-decision":i("file-selection");break;case"schema-compatibility":i("mode-decision");break;case"column-mapping":i(p?"schema-compatibility":"mode-decision");break;case"upload-processing":i(u==="advanced"?"column-mapping":p?"schema-compatibility":"mode-decision");break}},[a,u,p]),st=h.useCallback((ee,X={})=>{var te;if(console.error("Critical error occurred:",ee,X),S.isCriticalError(ee)){const we=S.getDisplayError(ee);w(ee.parsedError||we),k(((te=ee.parsedError)==null?void 0:te.suggestedActions)||we.actions||[]),b(!0)}},[S]),Ke=h.useCallback(()=>{i("file-selection"),o(null),d({}),m(null),f(null),g(null),b(!1),w(null),k([]),E(),F(),Me()},[E,F,Me]),At=h.useCallback(async(ee,X={})=>{try{const te=await G(ee,X);switch(te.action){case"navigate":i(te.phase),b(!1);break;case"configure":te.mode==="create"&&(d({...c,target_table:null}),m("create")),te.clearTargetTable&&d({...c,target_table:null}),b(!1);break;case"retry":b(!1),te.immediate&&await he();break;case"cancel":b(!1),Ke();break;case"external":te.type==="contact_admin"&&console.log("Contact admin requested for error:",te.errorDetails);break;default:console.log("Unhandled recovery action result:",te)}return te}catch(te){throw console.error("Error recovery action failed:",te),te}},[G,c,he,Ke]),lt=h.useCallback(ee=>{W&&W.severity==="critical"&&(w(W),k(B),b(!0))},[W,B]);le.useEffect(()=>{J==="error"&&W&&lt(W)},[J,W,lt]);const Ht=h.useCallback(()=>{if(!(J==="uploading"||J==="processing"||J==="retrying"||J==="recovering")){if(x){b(!1);return}Ke(),t()}},[J,x,Ke,t]);if(!e)return null;const pt=ge[a],be=pt.component;return r.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black bg-opacity-50",children:[r.jsxs(de.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl shadow-xl max-w-[110rem] w-full h-[95vh] flex flex-col",onWheel:ee=>{ee.stopPropagation()},children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx(ht,{children:pt.showBack&&r.jsx(de.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:r.jsx(H,{variant:"ghost",size:"sm",onClick:Ee,className:"p-2",children:r.jsx(Wi,{className:"w-4 h-4"})})})}),r.jsx("div",{className:"w-10 h-10 bg-prelude-800 rounded-full flex items-center justify-center",children:r.jsx("span",{className:"text-white text-lg font-semibold",children:((ze=j.displayName)==null?void 0:ze[0])||"U"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:pt.title}),r.jsx("p",{className:"text-sm text-gray-600",children:pt.description})]})]}),r.jsx(H,{variant:"ghost",size:"sm",onClick:Ht,disabled:J==="uploading"||J==="processing"||J==="retrying"||J==="recovering",className:"p-2",children:r.jsx(Ze,{className:"w-5 h-5 text-gray-500"})})]}),r.jsxs("div",{className:"px-6 py-3 border-b border-gray-100 bg-gray-50",children:[r.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[r.jsxs("span",{children:["Step ",Object.keys(ge).indexOf(a)+1," of ",Object.keys(ge).length]}),r.jsx("span",{children:j.displayName})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1",children:r.jsx(de.div,{className:"bg-prelude-800 h-1 rounded-full",initial:{width:"20%"},animate:{width:a==="file-selection"?"20%":a==="mode-decision"?"40%":a==="schema-compatibility"?"60%":a==="column-mapping"?"80%":"100%"},transition:{duration:.3}})})]}),r.jsx("div",{className:"flex-1 overflow-auto",children:r.jsx(ht,{mode:"wait",children:r.jsx(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},className:"h-full",children:r.jsx(be,{config:j,uploadService:S,onFileSelected:Se,analysisResult:_,isAnalyzing:C,analysisError:D,analysisSummary:T(),dataQuality:L(),onModeSelected:ce,isQuickRecommended:M(),onCompatibilityConfirmed:ke,onNeedsMappingReview:Pe,llmRecommendations:y,compatibilityData:p,selectedFile:l,userMappings:P,effectiveMappings:$,mappingStats:R,overallConfidence:U,validationResults:I,onUpdateMapping:z,onMappingConfirmed:qe,onLoadPreview:O,uploadMode:u,uploadState:J,progress:se,uploadResult:Z,uploadError:oe,parsedError:W,recoveryActions:B,logs:V,uploadStats:q(),onStartUpload:ne,onUploadComplete:ye,onRetry:()=>i("file-selection"),onRecoveryAction:At,formattedError:Q(),canAutoRetry:ue(),hasRecoveryOptions:Le,exportMappings:K})},a)})})]}),r.jsx(Yz,{isOpen:x,onClose:()=>b(!1),parsedError:v,recoveryActions:N.map(ee=>B.find(te=>te.type===ee)||{type:ee,label:ee.replace(/_/g," "),primary:!1}),onRecoveryAction:At,onRetry:he,allowDismiss:(v==null?void 0:v.severity)!=="critical",autoRetryCountdown:ue()&&(v!=null&&v.retryable)?10:null})]})},l8=({isOpen:e,onClose:t,onUploadSuccess:n})=>{const s=LS("nl2sql",{targetDatabase:"sales",tableName:"",expectedColumns:["employee_name","location","sales_amount","profit","product_name","client_name","quotations_sent","emails_sent","calls_made","sale_date"],allowedFileTypes:[".csv",".xlsx"],maxFileSize:"100MB",quickUploadThreshold:75,databaseConfig:{schema_name:"sales",service_type:"nl2sql",database_type:"postgresql"},mappingConfig:{service_context:"sales",confidence_threshold:.75,enable_semantic_matching:!0},previewConfig:{sample_size:30,analyze_patterns:!0,include_nulls:!0}});return r.jsx(i8,{isOpen:e,onClose:t,onUploadSuccess:n,config:s})};var Oh={},Mh={},nw;function o8(){return nw||(nw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return n==="__proto__"}e.isUnsafeProperty=t}(Mh)),Mh}var Ih={},sw;function YS(){return sw||(sw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){switch(typeof n){case"number":case"symbol":return!1;case"string":return n.includes(".")||n.includes("[")||n.includes("]")}}e.isDeepKey=t}(Ih)),Ih}var Lh={},aw;function VS(){return aw||(aw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){var s;return typeof n=="string"||typeof n=="symbol"?n:Object.is((s=n==null?void 0:n.valueOf)==null?void 0:s.call(n),-0)?"-0":String(n)}e.toKey=t}(Lh)),Lh}var Rh={},iw;function zx(){return iw||(iw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){const s=[],a=n.length;if(a===0)return s;let i=0,l="",o="",c=!1;for(n.charCodeAt(0)===46&&(s.push(""),i++);i<a;){const d=n[i];o?d==="\\"&&i+1<a?(i++,l+=n[i]):d===o?o="":l+=d:c?d==='"'||d==="'"?o=d:d==="]"?(c=!1,s.push(l),l=""):l+=d:d==="["?(c=!0,l&&(s.push(l),l="")):d==="."?l&&(s.push(l),l=""):l+=d,i++}return l&&s.push(l),s}e.toPath=t}(Rh)),Rh}var lw;function Bx(){return lw||(lw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=o8(),n=YS(),s=VS(),a=zx();function i(o,c,d){if(o==null)return d;switch(typeof c){case"string":{if(t.isUnsafeProperty(c))return d;const u=o[c];return u===void 0?n.isDeepKey(c)?i(o,a.toPath(c),d):d:u}case"number":case"symbol":{typeof c=="number"&&(c=s.toKey(c));const u=o[c];return u===void 0?d:u}default:{if(Array.isArray(c))return l(o,c,d);if(Object.is(c==null?void 0:c.valueOf(),-0)?c="-0":c=String(c),t.isUnsafeProperty(c))return d;const u=o[c];return u===void 0?d:u}}}function l(o,c,d){if(c.length===0)return d;let u=o;for(let m=0;m<c.length;m++){if(u==null||t.isUnsafeProperty(c[m]))return d;u=u[c[m]]}return u===void 0?d:u}e.get=i}(Oh)),Oh}var $h,ow;function c8(){return ow||(ow=1,$h=Bx().get),$h}var d8=c8();const hi=ks(d8);var Fh={exports:{}},or={};/** @license React v17.0.2
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cw;function u8(){if(cw)return or;cw=1;var e=60103,t=60106,n=60107,s=60108,a=60114,i=60109,l=60110,o=60112,c=60113,d=60120,u=60115,m=60116,p=60121,f=60122,y=60117,g=60129,x=60131;if(typeof Symbol=="function"&&Symbol.for){var b=Symbol.for;e=b("react.element"),t=b("react.portal"),n=b("react.fragment"),s=b("react.strict_mode"),a=b("react.profiler"),i=b("react.provider"),l=b("react.context"),o=b("react.forward_ref"),c=b("react.suspense"),d=b("react.suspense_list"),u=b("react.memo"),m=b("react.lazy"),p=b("react.block"),f=b("react.server.block"),y=b("react.fundamental"),g=b("react.debug_trace_mode"),x=b("react.legacy_hidden")}function v(T){if(typeof T=="object"&&T!==null){var M=T.$$typeof;switch(M){case e:switch(T=T.type,T){case n:case a:case s:case c:case d:return T;default:switch(T=T&&T.$$typeof,T){case l:case o:case m:case u:case i:return T;default:return M}}case t:return M}}}var w=i,N=e,k=o,j=n,S=m,_=u,C=t,D=a,A=s,E=c;return or.ContextConsumer=l,or.ContextProvider=w,or.Element=N,or.ForwardRef=k,or.Fragment=j,or.Lazy=S,or.Memo=_,or.Portal=C,or.Profiler=D,or.StrictMode=A,or.Suspense=E,or.isAsyncMode=function(){return!1},or.isConcurrentMode=function(){return!1},or.isContextConsumer=function(T){return v(T)===l},or.isContextProvider=function(T){return v(T)===i},or.isElement=function(T){return typeof T=="object"&&T!==null&&T.$$typeof===e},or.isForwardRef=function(T){return v(T)===o},or.isFragment=function(T){return v(T)===n},or.isLazy=function(T){return v(T)===m},or.isMemo=function(T){return v(T)===u},or.isPortal=function(T){return v(T)===t},or.isProfiler=function(T){return v(T)===a},or.isStrictMode=function(T){return v(T)===s},or.isSuspense=function(T){return v(T)===c},or.isValidElementType=function(T){return typeof T=="string"||typeof T=="function"||T===n||T===a||T===g||T===s||T===c||T===d||T===x||typeof T=="object"&&T!==null&&(T.$$typeof===m||T.$$typeof===u||T.$$typeof===i||T.$$typeof===l||T.$$typeof===o||T.$$typeof===y||T.$$typeof===p||T[0]===f)},or.typeOf=v,or}var dw;function m8(){return dw||(dw=1,Fh.exports=u8()),Fh.exports}var h8=m8(),ln=e=>e===0?0:e>0?1:-1,Tn=e=>typeof e=="number"&&e!=+e,Mi=e=>typeof e=="string"&&e.indexOf("%")===e.length-1,et=e=>(typeof e=="number"||e instanceof Number)&&!Tn(e),js=e=>et(e)||typeof e=="string",p8=0,Qi=e=>{var t=++p8;return"".concat(e||"").concat(t)},En=function(t,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!et(t)&&typeof t!="string")return s;var i;if(Mi(t)){if(n==null)return s;var l=t.indexOf("%");i=n*parseFloat(t.slice(0,l))/100}else i=+t;return Tn(i)&&(i=s),a&&n!=null&&i>n&&(i=n),i},GS=e=>{if(!Array.isArray(e))return!1;for(var t=e.length,n={},s=0;s<t;s++)if(!n[e[s]])n[e[s]]=!0;else return!0;return!1},Jn=(e,t)=>et(e)&&et(t)?n=>e+n*(t-e):()=>t;function KS(e,t,n){if(!(!e||!e.length))return e.find(s=>s&&(typeof t=="function"?t(s):hi(s,t))===n)}var mr=e=>e===null||typeof e>"u",_c=e=>mr(e)?e:"".concat(e.charAt(0).toUpperCase()).concat(e.slice(1)),f8=["viewBox","children"],g8=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],uw=["points","pathLength"],zh={svg:f8,polygon:uw,polyline:uw},Ux=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],qx=(e,t)=>{if(!e||typeof e=="function"||typeof e=="boolean")return null;var n=e;if(h.isValidElement(e)&&(n=e.props),typeof n!="object"&&typeof n!="function")return null;var s={};return Object.keys(n).forEach(a=>{Ux.includes(a)&&(s[a]=i=>n[a](n,i))}),s},x8=(e,t,n)=>s=>(e(t,n,s),null),Ec=(e,t,n)=>{if(e===null||typeof e!="object"&&typeof e!="function")return null;var s=null;return Object.keys(e).forEach(a=>{var i=e[a];Ux.includes(a)&&typeof i=="function"&&(s||(s={}),s[a]=x8(i,t,n))}),s},mw=e=>typeof e=="string"?e:e?e.displayName||e.name||"Component":"",hw=null,Bh=null,XS=e=>{if(e===hw&&Array.isArray(Bh))return Bh;var t=[];return h.Children.forEach(e,n=>{mr(n)||(h8.isFragment(n)?t=t.concat(XS(n.props.children)):t.push(n))}),Bh=t,hw=e,t};function Dc(e,t){var n=[],s=[];return Array.isArray(t)?s=t.map(a=>mw(a)):s=[mw(t)],XS(e).forEach(a=>{var i=hi(a,"type.displayName")||hi(a,"type.name");s.indexOf(i)!==-1&&n.push(a)}),n}var JS=e=>e&&typeof e=="object"&&"clipDot"in e?!!e.clipDot:!0,y8=(e,t,n,s)=>{var a,i=(a=s&&(zh==null?void 0:zh[s]))!==null&&a!==void 0?a:[];return t.startsWith("data-")||typeof e!="function"&&(s&&i.includes(t)||g8.includes(t))||n&&Ux.includes(t)},$t=(e,t,n)=>{if(!e||typeof e=="function"||typeof e=="boolean")return null;var s=e;if(h.isValidElement(e)&&(s=e.props),typeof s!="object"&&typeof s!="function")return null;var a={};return Object.keys(s).forEach(i=>{var l;y8((l=s)===null||l===void 0?void 0:l[i],i,t,n)&&(a[i]=s[i])}),a},b8=["children","width","height","viewBox","className","style","title","desc"];function Qf(){return Qf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Qf.apply(null,arguments)}function v8(e,t){if(e==null)return{};var n,s,a=w8(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function w8(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}var Hx=h.forwardRef((e,t)=>{var{children:n,width:s,height:a,viewBox:i,className:l,style:o,title:c,desc:d}=e,u=v8(e,b8),m=i||{width:s,height:a,x:0,y:0},p=xt("recharts-surface",l);return h.createElement("svg",Qf({},$t(u,!0,"svg"),{className:p,width:s,height:a,style:o,viewBox:"".concat(m.x," ").concat(m.y," ").concat(m.width," ").concat(m.height),ref:t}),h.createElement("title",null,c),h.createElement("desc",null,d),n)}),j8=["children","className"];function Zf(){return Zf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Zf.apply(null,arguments)}function N8(e,t){if(e==null)return{};var n,s,a=C8(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function C8(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}var Jr=h.forwardRef((e,t)=>{var{children:n,className:s}=e,a=N8(e,j8),i=xt("recharts-layer",s);return h.createElement("g",Zf({className:i},$t(a,!0),{ref:t}),n)}),QS=h.createContext(null),k8=()=>h.useContext(QS);function pr(e){return function(){return e}}const ZS=Math.cos,du=Math.sin,Fs=Math.sqrt,uu=Math.PI,dm=2*uu,eg=Math.PI,tg=2*eg,Di=1e-6,S8=tg-Di;function e2(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function _8(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return e2;const n=10**t;return function(s){this._+=s[0];for(let a=1,i=s.length;a<i;++a)this._+=Math.round(arguments[a]*n)/n+s[a]}}class E8{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?e2:_8(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,s,a){this._append`Q${+t},${+n},${this._x1=+s},${this._y1=+a}`}bezierCurveTo(t,n,s,a,i,l){this._append`C${+t},${+n},${+s},${+a},${this._x1=+i},${this._y1=+l}`}arcTo(t,n,s,a,i){if(t=+t,n=+n,s=+s,a=+a,i=+i,i<0)throw new Error(`negative radius: ${i}`);let l=this._x1,o=this._y1,c=s-t,d=a-n,u=l-t,m=o-n,p=u*u+m*m;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(p>Di)if(!(Math.abs(m*c-d*u)>Di)||!i)this._append`L${this._x1=t},${this._y1=n}`;else{let f=s-l,y=a-o,g=c*c+d*d,x=f*f+y*y,b=Math.sqrt(g),v=Math.sqrt(p),w=i*Math.tan((eg-Math.acos((g+p-x)/(2*b*v)))/2),N=w/v,k=w/b;Math.abs(N-1)>Di&&this._append`L${t+N*u},${n+N*m}`,this._append`A${i},${i},0,0,${+(m*f>u*y)},${this._x1=t+k*c},${this._y1=n+k*d}`}}arc(t,n,s,a,i,l){if(t=+t,n=+n,s=+s,l=!!l,s<0)throw new Error(`negative radius: ${s}`);let o=s*Math.cos(a),c=s*Math.sin(a),d=t+o,u=n+c,m=1^l,p=l?a-i:i-a;this._x1===null?this._append`M${d},${u}`:(Math.abs(this._x1-d)>Di||Math.abs(this._y1-u)>Di)&&this._append`L${d},${u}`,s&&(p<0&&(p=p%tg+tg),p>S8?this._append`A${s},${s},0,1,${m},${t-o},${n-c}A${s},${s},0,1,${m},${this._x1=d},${this._y1=u}`:p>Di&&this._append`A${s},${s},0,${+(p>=eg)},${m},${this._x1=t+s*Math.cos(i)},${this._y1=n+s*Math.sin(i)}`)}rect(t,n,s,a){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${s=+s}v${+a}h${-s}Z`}toString(){return this._}}function Wx(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const s=Math.floor(n);if(!(s>=0))throw new RangeError(`invalid digits: ${n}`);t=s}return e},()=>new E8(t)}function Yx(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function t2(e){this._context=e}t2.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function um(e){return new t2(e)}function r2(e){return e[0]}function n2(e){return e[1]}function s2(e,t){var n=pr(!0),s=null,a=um,i=null,l=Wx(o);e=typeof e=="function"?e:e===void 0?r2:pr(e),t=typeof t=="function"?t:t===void 0?n2:pr(t);function o(c){var d,u=(c=Yx(c)).length,m,p=!1,f;for(s==null&&(i=a(f=l())),d=0;d<=u;++d)!(d<u&&n(m=c[d],d,c))===p&&((p=!p)?i.lineStart():i.lineEnd()),p&&i.point(+e(m,d,c),+t(m,d,c));if(f)return i=null,f+""||null}return o.x=function(c){return arguments.length?(e=typeof c=="function"?c:pr(+c),o):e},o.y=function(c){return arguments.length?(t=typeof c=="function"?c:pr(+c),o):t},o.defined=function(c){return arguments.length?(n=typeof c=="function"?c:pr(!!c),o):n},o.curve=function(c){return arguments.length?(a=c,s!=null&&(i=a(s)),o):a},o.context=function(c){return arguments.length?(c==null?s=i=null:i=a(s=c),o):s},o}function sd(e,t,n){var s=null,a=pr(!0),i=null,l=um,o=null,c=Wx(d);e=typeof e=="function"?e:e===void 0?r2:pr(+e),t=typeof t=="function"?t:pr(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?n2:pr(+n);function d(m){var p,f,y,g=(m=Yx(m)).length,x,b=!1,v,w=new Array(g),N=new Array(g);for(i==null&&(o=l(v=c())),p=0;p<=g;++p){if(!(p<g&&a(x=m[p],p,m))===b)if(b=!b)f=p,o.areaStart(),o.lineStart();else{for(o.lineEnd(),o.lineStart(),y=p-1;y>=f;--y)o.point(w[y],N[y]);o.lineEnd(),o.areaEnd()}b&&(w[p]=+e(x,p,m),N[p]=+t(x,p,m),o.point(s?+s(x,p,m):w[p],n?+n(x,p,m):N[p]))}if(v)return o=null,v+""||null}function u(){return s2().defined(a).curve(l).context(i)}return d.x=function(m){return arguments.length?(e=typeof m=="function"?m:pr(+m),s=null,d):e},d.x0=function(m){return arguments.length?(e=typeof m=="function"?m:pr(+m),d):e},d.x1=function(m){return arguments.length?(s=m==null?null:typeof m=="function"?m:pr(+m),d):s},d.y=function(m){return arguments.length?(t=typeof m=="function"?m:pr(+m),n=null,d):t},d.y0=function(m){return arguments.length?(t=typeof m=="function"?m:pr(+m),d):t},d.y1=function(m){return arguments.length?(n=m==null?null:typeof m=="function"?m:pr(+m),d):n},d.lineX0=d.lineY0=function(){return u().x(e).y(t)},d.lineY1=function(){return u().x(e).y(n)},d.lineX1=function(){return u().x(s).y(t)},d.defined=function(m){return arguments.length?(a=typeof m=="function"?m:pr(!!m),d):a},d.curve=function(m){return arguments.length?(l=m,i!=null&&(o=l(i)),d):l},d.context=function(m){return arguments.length?(m==null?i=o=null:o=l(i=m),d):i},d}class a2{constructor(t,n){this._context=t,this._x=n}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,n){switch(t=+t,n=+n,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,n,t,n):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+n)/2,t,this._y0,t,n);break}}this._x0=t,this._y0=n}}function D8(e){return new a2(e,!0)}function T8(e){return new a2(e,!1)}const Vx={draw(e,t){const n=Fs(t/uu);e.moveTo(n,0),e.arc(0,0,n,0,dm)}},A8={draw(e,t){const n=Fs(t/5)/2;e.moveTo(-3*n,-n),e.lineTo(-n,-n),e.lineTo(-n,-3*n),e.lineTo(n,-3*n),e.lineTo(n,-n),e.lineTo(3*n,-n),e.lineTo(3*n,n),e.lineTo(n,n),e.lineTo(n,3*n),e.lineTo(-n,3*n),e.lineTo(-n,n),e.lineTo(-3*n,n),e.closePath()}},i2=Fs(1/3),P8=i2*2,O8={draw(e,t){const n=Fs(t/P8),s=n*i2;e.moveTo(0,-n),e.lineTo(s,0),e.lineTo(0,n),e.lineTo(-s,0),e.closePath()}},M8={draw(e,t){const n=Fs(t),s=-n/2;e.rect(s,s,n,n)}},I8=.8908130915292852,l2=du(uu/10)/du(7*uu/10),L8=du(dm/10)*l2,R8=-ZS(dm/10)*l2,$8={draw(e,t){const n=Fs(t*I8),s=L8*n,a=R8*n;e.moveTo(0,-n),e.lineTo(s,a);for(let i=1;i<5;++i){const l=dm*i/5,o=ZS(l),c=du(l);e.lineTo(c*n,-o*n),e.lineTo(o*s-c*a,c*s+o*a)}e.closePath()}},Uh=Fs(3),F8={draw(e,t){const n=-Fs(t/(Uh*3));e.moveTo(0,n*2),e.lineTo(-Uh*n,-n),e.lineTo(Uh*n,-n),e.closePath()}},as=-.5,is=Fs(3)/2,rg=1/Fs(12),z8=(rg/2+1)*3,B8={draw(e,t){const n=Fs(t/z8),s=n/2,a=n*rg,i=s,l=n*rg+n,o=-i,c=l;e.moveTo(s,a),e.lineTo(i,l),e.lineTo(o,c),e.lineTo(as*s-is*a,is*s+as*a),e.lineTo(as*i-is*l,is*i+as*l),e.lineTo(as*o-is*c,is*o+as*c),e.lineTo(as*s+is*a,as*a-is*s),e.lineTo(as*i+is*l,as*l-is*i),e.lineTo(as*o+is*c,as*c-is*o),e.closePath()}};function U8(e,t){let n=null,s=Wx(a);e=typeof e=="function"?e:pr(e||Vx),t=typeof t=="function"?t:pr(t===void 0?64:+t);function a(){let i;if(n||(n=i=s()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),i)return n=null,i+""||null}return a.type=function(i){return arguments.length?(e=typeof i=="function"?i:pr(i),a):e},a.size=function(i){return arguments.length?(t=typeof i=="function"?i:pr(+i),a):t},a.context=function(i){return arguments.length?(n=i??null,a):n},a}function mu(){}function hu(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function o2(e){this._context=e}o2.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:hu(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:hu(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function q8(e){return new o2(e)}function c2(e){this._context=e}c2.prototype={areaStart:mu,areaEnd:mu,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:hu(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function H8(e){return new c2(e)}function d2(e){this._context=e}d2.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,s=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,s):this._context.moveTo(n,s);break;case 3:this._point=4;default:hu(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function W8(e){return new d2(e)}function u2(e){this._context=e}u2.prototype={areaStart:mu,areaEnd:mu,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function Y8(e){return new u2(e)}function pw(e){return e<0?-1:1}function fw(e,t,n){var s=e._x1-e._x0,a=t-e._x1,i=(e._y1-e._y0)/(s||a<0&&-0),l=(n-e._y1)/(a||s<0&&-0),o=(i*a+l*s)/(s+a);return(pw(i)+pw(l))*Math.min(Math.abs(i),Math.abs(l),.5*Math.abs(o))||0}function gw(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function qh(e,t,n){var s=e._x0,a=e._y0,i=e._x1,l=e._y1,o=(i-s)/3;e._context.bezierCurveTo(s+o,a+o*t,i-o,l-o*n,i,l)}function pu(e){this._context=e}pu.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:qh(this,this._t0,gw(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,qh(this,gw(this,n=fw(this,e,t)),n);break;default:qh(this,this._t0,n=fw(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function m2(e){this._context=new h2(e)}(m2.prototype=Object.create(pu.prototype)).point=function(e,t){pu.prototype.point.call(this,t,e)};function h2(e){this._context=e}h2.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,s,a,i){this._context.bezierCurveTo(t,e,s,n,i,a)}};function V8(e){return new pu(e)}function G8(e){return new m2(e)}function p2(e){this._context=e}p2.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var s=xw(e),a=xw(t),i=0,l=1;l<n;++i,++l)this._context.bezierCurveTo(s[0][i],a[0][i],s[1][i],a[1][i],e[l],t[l]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function xw(e){var t,n=e.length-1,s,a=new Array(n),i=new Array(n),l=new Array(n);for(a[0]=0,i[0]=2,l[0]=e[0]+2*e[1],t=1;t<n-1;++t)a[t]=1,i[t]=4,l[t]=4*e[t]+2*e[t+1];for(a[n-1]=2,i[n-1]=7,l[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)s=a[t]/i[t-1],i[t]-=s,l[t]-=s*l[t-1];for(a[n-1]=l[n-1]/i[n-1],t=n-2;t>=0;--t)a[t]=(l[t]-a[t+1])/i[t];for(i[n-1]=(e[n]+a[n-1])/2,t=0;t<n-1;++t)i[t]=2*e[t+1]-a[t+1];return[a,i]}function K8(e){return new p2(e)}function mm(e,t){this._context=e,this._t=t}mm.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function X8(e){return new mm(e,.5)}function J8(e){return new mm(e,0)}function Q8(e){return new mm(e,1)}function Ul(e,t){if((l=e.length)>1)for(var n=1,s,a,i=e[t[0]],l,o=i.length;n<l;++n)for(a=i,i=e[t[n]],s=0;s<o;++s)i[s][1]+=i[s][0]=isNaN(a[s][1])?a[s][0]:a[s][1]}function ng(e){for(var t=e.length,n=new Array(t);--t>=0;)n[t]=t;return n}function Z8(e,t){return e[t]}function e7(e){const t=[];return t.key=e,t}function t7(){var e=pr([]),t=ng,n=Ul,s=Z8;function a(i){var l=Array.from(e.apply(this,arguments),e7),o,c=l.length,d=-1,u;for(const m of i)for(o=0,++d;o<c;++o)(l[o][d]=[0,+s(m,l[o].key,d,i)]).data=m;for(o=0,u=Yx(t(l));o<c;++o)l[u[o]].index=o;return n(l,u),l}return a.keys=function(i){return arguments.length?(e=typeof i=="function"?i:pr(Array.from(i)),a):e},a.value=function(i){return arguments.length?(s=typeof i=="function"?i:pr(+i),a):s},a.order=function(i){return arguments.length?(t=i==null?ng:typeof i=="function"?i:pr(Array.from(i)),a):t},a.offset=function(i){return arguments.length?(n=i??Ul,a):n},a}function r7(e,t){if((s=e.length)>0){for(var n,s,a=0,i=e[0].length,l;a<i;++a){for(l=n=0;n<s;++n)l+=e[n][a][1]||0;if(l)for(n=0;n<s;++n)e[n][a][1]/=l}Ul(e,t)}}function n7(e,t){if((a=e.length)>0){for(var n=0,s=e[t[0]],a,i=s.length;n<i;++n){for(var l=0,o=0;l<a;++l)o+=e[l][n][1]||0;s[n][1]+=s[n][0]=-o/2}Ul(e,t)}}function s7(e,t){if(!(!((l=e.length)>0)||!((i=(a=e[t[0]]).length)>0))){for(var n=0,s=1,a,i,l;s<i;++s){for(var o=0,c=0,d=0;o<l;++o){for(var u=e[t[o]],m=u[s][1]||0,p=u[s-1][1]||0,f=(m-p)/2,y=0;y<o;++y){var g=e[t[y]],x=g[s][1]||0,b=g[s-1][1]||0;f+=x-b}c+=m,d+=f*m}a[s-1][1]+=a[s-1][0]=n,c&&(n-=d/c)}a[s-1][1]+=a[s-1][0]=n,Ul(e,t)}}var a7=["type","size","sizeType"];function sg(){return sg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},sg.apply(null,arguments)}function yw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function bw(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yw(Object(n),!0).forEach(function(s){i7(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yw(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function i7(e,t,n){return(t=l7(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l7(e){var t=o7(e,"string");return typeof t=="symbol"?t:t+""}function o7(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function c7(e,t){if(e==null)return{};var n,s,a=d7(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function d7(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}var f2={symbolCircle:Vx,symbolCross:A8,symbolDiamond:O8,symbolSquare:M8,symbolStar:$8,symbolTriangle:F8,symbolWye:B8},u7=Math.PI/180,m7=e=>{var t="symbol".concat(_c(e));return f2[t]||Vx},h7=(e,t,n)=>{if(t==="area")return e;switch(n){case"cross":return 5*e*e/9;case"diamond":return .5*e*e/Math.sqrt(3);case"square":return e*e;case"star":{var s=18*u7;return 1.25*e*e*(Math.tan(s)-Math.tan(s*2)*Math.tan(s)**2)}case"triangle":return Math.sqrt(3)*e*e/4;case"wye":return(21-10*Math.sqrt(3))*e*e/8;default:return Math.PI*e*e/4}},p7=(e,t)=>{f2["symbol".concat(_c(e))]=t},Gx=e=>{var{type:t="circle",size:n=64,sizeType:s="area"}=e,a=c7(e,a7),i=bw(bw({},a),{},{type:t,size:n,sizeType:s}),l=()=>{var m=m7(t),p=U8().type(m).size(h7(n,s,t));return p()},{className:o,cx:c,cy:d}=i,u=$t(i,!0);return c===+c&&d===+d&&n===+n?h.createElement("path",sg({},u,{className:xt("recharts-symbols",o),transform:"translate(".concat(c,", ").concat(d,")"),d:l()})):null};Gx.registerSymbol=p7;function ag(){return ag=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},ag.apply(null,arguments)}function vw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function f7(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?vw(Object(n),!0).forEach(function(s){Kx(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vw(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Kx(e,t,n){return(t=g7(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g7(e){var t=x7(e,"string");return typeof t=="symbol"?t:t+""}function x7(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ts=32;class Xx extends h.PureComponent{renderIcon(t,n){var{inactiveColor:s}=this.props,a=Ts/2,i=Ts/6,l=Ts/3,o=t.inactive?s:t.color,c=n??t.type;if(c==="none")return null;if(c==="plainline")return h.createElement("line",{strokeWidth:4,fill:"none",stroke:o,strokeDasharray:t.payload.strokeDasharray,x1:0,y1:a,x2:Ts,y2:a,className:"recharts-legend-icon"});if(c==="line")return h.createElement("path",{strokeWidth:4,fill:"none",stroke:o,d:"M0,".concat(a,"h").concat(l,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(2*l,",").concat(a,`
            H`).concat(Ts,"M").concat(2*l,",").concat(a,`
            A`).concat(i,",").concat(i,",0,1,1,").concat(l,",").concat(a),className:"recharts-legend-icon"});if(c==="rect")return h.createElement("path",{stroke:"none",fill:o,d:"M0,".concat(Ts/8,"h").concat(Ts,"v").concat(Ts*3/4,"h").concat(-32,"z"),className:"recharts-legend-icon"});if(h.isValidElement(t.legendIcon)){var d=f7({},t);return delete d.legendIcon,h.cloneElement(t.legendIcon,d)}return h.createElement(Gx,{fill:o,cx:a,cy:a,size:Ts,sizeType:"diameter",type:c})}renderItems(){var{payload:t,iconSize:n,layout:s,formatter:a,inactiveColor:i,iconType:l}=this.props,o={x:0,y:0,width:Ts,height:Ts},c={display:s==="horizontal"?"inline-block":"block",marginRight:10},d={display:"inline-block",verticalAlign:"middle",marginRight:4};return t.map((u,m)=>{var p=u.formatter||a,f=xt({"recharts-legend-item":!0,["legend-item-".concat(m)]:!0,inactive:u.inactive});if(u.type==="none")return null;var y=u.inactive?i:u.color,g=p?p(u.value,u,m):u.value;return h.createElement("li",ag({className:f,style:c,key:"legend-item-".concat(m)},Ec(this.props,u,m)),h.createElement(Hx,{width:n,height:n,viewBox:o,style:d,"aria-label":"".concat(g," legend icon")},this.renderIcon(u,l)),h.createElement("span",{className:"recharts-legend-item-text",style:{color:y}},g))})}render(){var{payload:t,layout:n,align:s}=this.props;if(!t||!t.length)return null;var a={padding:0,margin:0,textAlign:n==="horizontal"?s:"left"};return h.createElement("ul",{className:"recharts-default-legend",style:a},this.renderItems())}}Kx(Xx,"displayName","Legend");Kx(Xx,"defaultProps",{align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"});var Hh={},Wh={},ww;function y7(){return ww||(ww=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n,s){const a=new Map;for(let i=0;i<n.length;i++){const l=n[i],o=s(l);a.has(o)||a.set(o,l)}return Array.from(a.values())}e.uniqBy=t}(Wh)),Wh}var Yh={},jw;function g2(){return jw||(jw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return n}e.identity=t}(Yh)),Yh}var Vh={},Gh={},Kh={},Nw;function b7(){return Nw||(Nw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return Number.isSafeInteger(n)&&n>=0}e.isLength=t}(Kh)),Kh}var Cw;function Jx(){return Cw||(Cw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=b7();function n(s){return s!=null&&typeof s!="function"&&t.isLength(s.length)}e.isArrayLike=n}(Gh)),Gh}var Xh={},kw;function v7(){return kw||(kw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return typeof n=="object"&&n!==null}e.isObjectLike=t}(Xh)),Xh}var Sw;function w7(){return Sw||(Sw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=Jx(),n=v7();function s(a){return n.isObjectLike(a)&&t.isArrayLike(a)}e.isArrayLikeObject=s}(Vh)),Vh}var Jh={},Qh={},_w;function j7(){return _w||(_w=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=Bx();function n(s){return function(a){return t.get(a,s)}}e.property=n}(Qh)),Qh}var Zh={},ep={},tp={},rp={},Ew;function x2(){return Ew||(Ew=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return n!==null&&(typeof n=="object"||typeof n=="function")}e.isObject=t}(rp)),rp}var np={},Dw;function y2(){return Dw||(Dw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return n==null||typeof n!="object"&&typeof n!="function"}e.isPrimitive=t}(np)),np}var sp={},Tw;function Qx(){return Tw||(Tw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n,s){return n===s||Number.isNaN(n)&&Number.isNaN(s)}e.eq=t}(sp)),sp}var Aw;function N7(){return Aw||(Aw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=Zx(),n=x2(),s=y2(),a=Qx();function i(m,p,f){return typeof f!="function"?t.isMatch(m,p):l(m,p,function y(g,x,b,v,w,N){const k=f(g,x,b,v,w,N);return k!==void 0?!!k:l(g,x,y,N)},new Map)}function l(m,p,f,y){if(p===m)return!0;switch(typeof p){case"object":return o(m,p,f,y);case"function":return Object.keys(p).length>0?l(m,{...p},f,y):a.eq(m,p);default:return n.isObject(m)?typeof p=="string"?p==="":!0:a.eq(m,p)}}function o(m,p,f,y){if(p==null)return!0;if(Array.isArray(p))return d(m,p,f,y);if(p instanceof Map)return c(m,p,f,y);if(p instanceof Set)return u(m,p,f,y);const g=Object.keys(p);if(m==null)return g.length===0;if(g.length===0)return!0;if(y&&y.has(p))return y.get(p)===m;y&&y.set(p,m);try{for(let x=0;x<g.length;x++){const b=g[x];if(!s.isPrimitive(m)&&!(b in m)||p[b]===void 0&&m[b]!==void 0||p[b]===null&&m[b]!==null||!f(m[b],p[b],b,m,p,y))return!1}return!0}finally{y&&y.delete(p)}}function c(m,p,f,y){if(p.size===0)return!0;if(!(m instanceof Map))return!1;for(const[g,x]of p.entries()){const b=m.get(g);if(f(b,x,g,m,p,y)===!1)return!1}return!0}function d(m,p,f,y){if(p.length===0)return!0;if(!Array.isArray(m))return!1;const g=new Set;for(let x=0;x<p.length;x++){const b=p[x];let v=!1;for(let w=0;w<m.length;w++){if(g.has(w))continue;const N=m[w];let k=!1;if(f(N,b,x,m,p,y)&&(k=!0),k){g.add(w),v=!0;break}}if(!v)return!1}return!0}function u(m,p,f,y){return p.size===0?!0:m instanceof Set?d([...m],[...p],f,y):!1}e.isMatchWith=i,e.isSetMatch=u}(tp)),tp}var Pw;function Zx(){return Pw||(Pw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=N7();function n(s,a){return t.isMatchWith(s,a,()=>{})}e.isMatch=n}(ep)),ep}var ap={},ip={},lp={},Ow;function b2(){return Ow||(Ow=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return Object.getOwnPropertySymbols(n).filter(s=>Object.prototype.propertyIsEnumerable.call(n,s))}e.getSymbols=t}(lp)),lp}var op={},Mw;function e0(){return Mw||(Mw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return n==null?n===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(n)}e.getTag=t}(op)),op}var cp={},Iw;function t0(){return Iw||(Iw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t="[object RegExp]",n="[object String]",s="[object Number]",a="[object Boolean]",i="[object Arguments]",l="[object Symbol]",o="[object Date]",c="[object Map]",d="[object Set]",u="[object Array]",m="[object Function]",p="[object ArrayBuffer]",f="[object Object]",y="[object Error]",g="[object DataView]",x="[object Uint8Array]",b="[object Uint8ClampedArray]",v="[object Uint16Array]",w="[object Uint32Array]",N="[object BigUint64Array]",k="[object Int8Array]",j="[object Int16Array]",S="[object Int32Array]",_="[object BigInt64Array]",C="[object Float32Array]",D="[object Float64Array]";e.argumentsTag=i,e.arrayBufferTag=p,e.arrayTag=u,e.bigInt64ArrayTag=_,e.bigUint64ArrayTag=N,e.booleanTag=a,e.dataViewTag=g,e.dateTag=o,e.errorTag=y,e.float32ArrayTag=C,e.float64ArrayTag=D,e.functionTag=m,e.int16ArrayTag=j,e.int32ArrayTag=S,e.int8ArrayTag=k,e.mapTag=c,e.numberTag=s,e.objectTag=f,e.regexpTag=t,e.setTag=d,e.stringTag=n,e.symbolTag=l,e.uint16ArrayTag=v,e.uint32ArrayTag=w,e.uint8ArrayTag=x,e.uint8ClampedArrayTag=b}(cp)),cp}var dp={},Lw;function C7(){return Lw||(Lw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}e.isTypedArray=t}(dp)),dp}var Rw;function v2(){return Rw||(Rw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=b2(),n=e0(),s=t0(),a=y2(),i=C7();function l(u,m){return o(u,void 0,u,new Map,m)}function o(u,m,p,f=new Map,y=void 0){const g=y==null?void 0:y(u,m,p,f);if(g!=null)return g;if(a.isPrimitive(u))return u;if(f.has(u))return f.get(u);if(Array.isArray(u)){const x=new Array(u.length);f.set(u,x);for(let b=0;b<u.length;b++)x[b]=o(u[b],b,p,f,y);return Object.hasOwn(u,"index")&&(x.index=u.index),Object.hasOwn(u,"input")&&(x.input=u.input),x}if(u instanceof Date)return new Date(u.getTime());if(u instanceof RegExp){const x=new RegExp(u.source,u.flags);return x.lastIndex=u.lastIndex,x}if(u instanceof Map){const x=new Map;f.set(u,x);for(const[b,v]of u)x.set(b,o(v,b,p,f,y));return x}if(u instanceof Set){const x=new Set;f.set(u,x);for(const b of u)x.add(o(b,void 0,p,f,y));return x}if(typeof Buffer<"u"&&Buffer.isBuffer(u))return u.subarray();if(i.isTypedArray(u)){const x=new(Object.getPrototypeOf(u)).constructor(u.length);f.set(u,x);for(let b=0;b<u.length;b++)x[b]=o(u[b],b,p,f,y);return x}if(u instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&u instanceof SharedArrayBuffer)return u.slice(0);if(u instanceof DataView){const x=new DataView(u.buffer.slice(0),u.byteOffset,u.byteLength);return f.set(u,x),c(x,u,p,f,y),x}if(typeof File<"u"&&u instanceof File){const x=new File([u],u.name,{type:u.type});return f.set(u,x),c(x,u,p,f,y),x}if(u instanceof Blob){const x=new Blob([u],{type:u.type});return f.set(u,x),c(x,u,p,f,y),x}if(u instanceof Error){const x=new u.constructor;return f.set(u,x),x.message=u.message,x.name=u.name,x.stack=u.stack,x.cause=u.cause,c(x,u,p,f,y),x}if(typeof u=="object"&&d(u)){const x=Object.create(Object.getPrototypeOf(u));return f.set(u,x),c(x,u,p,f,y),x}return u}function c(u,m,p=u,f,y){const g=[...Object.keys(m),...t.getSymbols(m)];for(let x=0;x<g.length;x++){const b=g[x],v=Object.getOwnPropertyDescriptor(u,b);(v==null||v.writable)&&(u[b]=o(m[b],b,p,f,y))}}function d(u){switch(n.getTag(u)){case s.argumentsTag:case s.arrayTag:case s.arrayBufferTag:case s.dataViewTag:case s.booleanTag:case s.dateTag:case s.float32ArrayTag:case s.float64ArrayTag:case s.int8ArrayTag:case s.int16ArrayTag:case s.int32ArrayTag:case s.mapTag:case s.numberTag:case s.objectTag:case s.regexpTag:case s.setTag:case s.stringTag:case s.symbolTag:case s.uint8ArrayTag:case s.uint8ClampedArrayTag:case s.uint16ArrayTag:case s.uint32ArrayTag:return!0;default:return!1}}e.cloneDeepWith=l,e.cloneDeepWithImpl=o,e.copyProperties=c}(ip)),ip}var $w;function k7(){return $w||($w=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=v2();function n(s){return t.cloneDeepWithImpl(s,void 0,s,new Map,void 0)}e.cloneDeep=n}(ap)),ap}var Fw;function S7(){return Fw||(Fw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=Zx(),n=k7();function s(a){return a=n.cloneDeep(a),i=>t.isMatch(i,a)}e.matches=s}(Zh)),Zh}var up={},mp={},hp={},zw;function _7(){return zw||(zw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=v2(),n=t0();function s(a,i){return t.cloneDeepWith(a,(l,o,c,d)=>{const u=i==null?void 0:i(l,o,c,d);if(u!=null)return u;if(typeof a=="object")switch(Object.prototype.toString.call(a)){case n.numberTag:case n.stringTag:case n.booleanTag:{const m=new a.constructor(a==null?void 0:a.valueOf());return t.copyProperties(m,a),m}case n.argumentsTag:{const m={};return t.copyProperties(m,a),m.length=a.length,m[Symbol.iterator]=a[Symbol.iterator],m}default:return}})}e.cloneDeepWith=s}(hp)),hp}var Bw;function E7(){return Bw||(Bw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=_7();function n(s){return t.cloneDeepWith(s)}e.cloneDeep=n}(mp)),mp}var pp={},fp={},Uw;function w2(){return Uw||(Uw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=/^(?:0|[1-9]\d*)$/;function n(s,a=Number.MAX_SAFE_INTEGER){switch(typeof s){case"number":return Number.isInteger(s)&&s>=0&&s<a;case"symbol":return!1;case"string":return t.test(s)}}e.isIndex=n}(fp)),fp}var gp={},qw;function D7(){return qw||(qw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=e0();function n(s){return s!==null&&typeof s=="object"&&t.getTag(s)==="[object Arguments]"}e.isArguments=n}(gp)),gp}var Hw;function T7(){return Hw||(Hw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=YS(),n=w2(),s=D7(),a=zx();function i(l,o){let c;if(Array.isArray(o)?c=o:typeof o=="string"&&t.isDeepKey(o)&&(l==null?void 0:l[o])==null?c=a.toPath(o):c=[o],c.length===0)return!1;let d=l;for(let u=0;u<c.length;u++){const m=c[u];if((d==null||!Object.hasOwn(d,m))&&!((Array.isArray(d)||s.isArguments(d))&&n.isIndex(m)&&m<d.length))return!1;d=d[m]}return!0}e.has=i}(pp)),pp}var Ww;function A7(){return Ww||(Ww=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=Zx(),n=VS(),s=E7(),a=Bx(),i=T7();function l(o,c){switch(typeof o){case"object":{Object.is(o==null?void 0:o.valueOf(),-0)&&(o="-0");break}case"number":{o=n.toKey(o);break}}return c=s.cloneDeep(c),function(d){const u=a.get(d,o);return u===void 0?i.has(d,o):c===void 0?u===void 0:t.isMatch(u,c)}}e.matchesProperty=l}(up)),up}var Yw;function P7(){return Yw||(Yw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=g2(),n=j7(),s=S7(),a=A7();function i(l){if(l==null)return t.identity;switch(typeof l){case"function":return l;case"object":return Array.isArray(l)&&l.length===2?a.matchesProperty(l[0],l[1]):s.matches(l);case"string":case"symbol":case"number":return n.property(l)}}e.iteratee=i}(Jh)),Jh}var Vw;function O7(){return Vw||(Vw=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=y7(),n=g2(),s=w7(),a=P7();function i(l,o=n.identity){return s.isArrayLikeObject(l)?t.uniqBy(Array.from(l),a.iteratee(o)):[]}e.uniqBy=i}(Hh)),Hh}var xp,Gw;function M7(){return Gw||(Gw=1,xp=O7().uniqBy),xp}var I7=M7();const Kw=ks(I7);function j2(e,t,n){return t===!0?Kw(e,n):typeof t=="function"?Kw(e,t):e}var yp={exports:{}},bp={},vp={exports:{}},wp={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xw;function L7(){if(Xw)return wp;Xw=1;var e=tx();function t(m,p){return m===p&&(m!==0||1/m===1/p)||m!==m&&p!==p}var n=typeof Object.is=="function"?Object.is:t,s=e.useState,a=e.useEffect,i=e.useLayoutEffect,l=e.useDebugValue;function o(m,p){var f=p(),y=s({inst:{value:f,getSnapshot:p}}),g=y[0].inst,x=y[1];return i(function(){g.value=f,g.getSnapshot=p,c(g)&&x({inst:g})},[m,f,p]),a(function(){return c(g)&&x({inst:g}),m(function(){c(g)&&x({inst:g})})},[m]),l(f),f}function c(m){var p=m.getSnapshot;m=m.value;try{var f=p();return!n(m,f)}catch{return!0}}function d(m,p){return p()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:o;return wp.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:u,wp}var Jw;function R7(){return Jw||(Jw=1,vp.exports=L7()),vp.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qw;function $7(){if(Qw)return bp;Qw=1;var e=tx(),t=R7();function n(d,u){return d===u&&(d!==0||1/d===1/u)||d!==d&&u!==u}var s=typeof Object.is=="function"?Object.is:n,a=t.useSyncExternalStore,i=e.useRef,l=e.useEffect,o=e.useMemo,c=e.useDebugValue;return bp.useSyncExternalStoreWithSelector=function(d,u,m,p,f){var y=i(null);if(y.current===null){var g={hasValue:!1,value:null};y.current=g}else g=y.current;y=o(function(){function b(j){if(!v){if(v=!0,w=j,j=p(j),f!==void 0&&g.hasValue){var S=g.value;if(f(S,j))return N=S}return N=j}if(S=N,s(w,j))return S;var _=p(j);return f!==void 0&&f(S,_)?(w=j,S):(w=j,N=_)}var v=!1,w,N,k=m===void 0?null:m;return[function(){return b(u())},k===null?void 0:function(){return b(k())}]},[u,m,p,f]);var x=a(d,y[0],y[1]);return l(function(){g.hasValue=!0,g.value=x},[x]),c(x),x},bp}var Zw;function F7(){return Zw||(Zw=1,yp.exports=$7()),yp.exports}var z7=F7(),r0=h.createContext(null),B7=e=>e,vr=()=>{var e=h.useContext(r0);return e?e.store.dispatch:B7},Rd=()=>{},U7=()=>Rd,q7=(e,t)=>e===t;function tt(e){var t=h.useContext(r0);return z7.useSyncExternalStoreWithSelector(t?t.subscription.addNestedSub:U7,t?t.store.getState:Rd,t?t.store.getState:Rd,t?e:Rd,q7)}function H7(e,t=`expected a function, instead received ${typeof e}`){if(typeof e!="function")throw new TypeError(t)}function W7(e,t=`expected an object, instead received ${typeof e}`){if(typeof e!="object")throw new TypeError(t)}function Y7(e,t="expected all items to be functions, instead received the following types: "){if(!e.every(n=>typeof n=="function")){const n=e.map(s=>typeof s=="function"?`function ${s.name||"unnamed"}()`:typeof s).join(", ");throw new TypeError(`${t}[${n}]`)}}var ej=e=>Array.isArray(e)?e:[e];function V7(e){const t=Array.isArray(e[0])?e[0]:e;return Y7(t,"createSelector expects all input-selectors to be functions, but received the following types: "),t}function G7(e,t){const n=[],{length:s}=e;for(let a=0;a<s;a++)n.push(e[a].apply(null,t));return n}var K7=class{constructor(e){this.value=e}deref(){return this.value}},X7=typeof WeakRef<"u"?WeakRef:K7,J7=0,tj=1;function ad(){return{s:J7,v:void 0,o:null,p:null}}function N2(e,t={}){let n=ad();const{resultEqualityCheck:s}=t;let a,i=0;function l(){var m;let o=n;const{length:c}=arguments;for(let p=0,f=c;p<f;p++){const y=arguments[p];if(typeof y=="function"||typeof y=="object"&&y!==null){let g=o.o;g===null&&(o.o=g=new WeakMap);const x=g.get(y);x===void 0?(o=ad(),g.set(y,o)):o=x}else{let g=o.p;g===null&&(o.p=g=new Map);const x=g.get(y);x===void 0?(o=ad(),g.set(y,o)):o=x}}const d=o;let u;if(o.s===tj)u=o.v;else if(u=e.apply(null,arguments),i++,s){const p=((m=a==null?void 0:a.deref)==null?void 0:m.call(a))??a;p!=null&&s(p,u)&&(u=p,i!==0&&i--),a=typeof u=="object"&&u!==null||typeof u=="function"?new X7(u):u}return d.s=tj,d.v=u,u}return l.clearCache=()=>{n=ad(),l.resetResultsCount()},l.resultsCount=()=>i,l.resetResultsCount=()=>{i=0},l}function Q7(e,...t){const n=typeof e=="function"?{memoize:e,memoizeOptions:t}:e,s=(...a)=>{let i=0,l=0,o,c={},d=a.pop();typeof d=="object"&&(c=d,d=a.pop()),H7(d,`createSelector expects an output function after the inputs, but received: [${typeof d}]`);const u={...n,...c},{memoize:m,memoizeOptions:p=[],argsMemoize:f=N2,argsMemoizeOptions:y=[]}=u,g=ej(p),x=ej(y),b=V7(a),v=m(function(){return i++,d.apply(null,arguments)},...g),w=f(function(){l++;const k=G7(b,arguments);return o=v.apply(null,k),o},...x);return Object.assign(w,{resultFunc:d,memoizedResultFunc:v,dependencies:b,dependencyRecomputations:()=>l,resetDependencyRecomputations:()=>{l=0},lastResult:()=>o,recomputations:()=>i,resetRecomputations:()=>{i=0},memoize:m,argsMemoize:f})};return Object.assign(s,{withTypes:()=>s}),s}var ve=Q7(N2),Z7=Object.assign((e,t=ve)=>{W7(e,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof e}`);const n=Object.keys(e),s=n.map(i=>e[i]);return t(s,(...i)=>i.reduce((l,o,c)=>(l[n[c]]=o,l),{}))},{withTypes:()=>Z7}),jp={},Np={},Cp={},rj;function eB(){return rj||(rj=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(s){return typeof s=="symbol"?1:s===null?2:s===void 0?3:s!==s?4:0}const n=(s,a,i)=>{if(s!==a){const l=t(s),o=t(a);if(l===o&&l===0){if(s<a)return i==="desc"?1:-1;if(s>a)return i==="desc"?-1:1}return i==="desc"?o-l:l-o}return 0};e.compareValues=n}(Cp)),Cp}var kp={},Sp={},nj;function C2(){return nj||(nj=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return typeof n=="symbol"||n instanceof Symbol}e.isSymbol=t}(Sp)),Sp}var sj;function tB(){return sj||(sj=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=C2(),n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;function a(i,l){return Array.isArray(i)?!1:typeof i=="number"||typeof i=="boolean"||i==null||t.isSymbol(i)?!0:typeof i=="string"&&(s.test(i)||!n.test(i))||l!=null&&Object.hasOwn(l,i)}e.isKey=a}(kp)),kp}var aj;function rB(){return aj||(aj=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=eB(),n=tB(),s=zx();function a(i,l,o,c){if(i==null)return[];o=c?void 0:o,Array.isArray(i)||(i=Object.values(i)),Array.isArray(l)||(l=l==null?[null]:[l]),l.length===0&&(l=[null]),Array.isArray(o)||(o=o==null?[]:[o]),o=o.map(f=>String(f));const d=(f,y)=>{let g=f;for(let x=0;x<y.length&&g!=null;++x)g=g[y[x]];return g},u=(f,y)=>y==null||f==null?y:typeof f=="object"&&"key"in f?Object.hasOwn(y,f.key)?y[f.key]:d(y,f.path):typeof f=="function"?f(y):Array.isArray(f)?d(y,f):typeof y=="object"?y[f]:y,m=l.map(f=>(Array.isArray(f)&&f.length===1&&(f=f[0]),f==null||typeof f=="function"||Array.isArray(f)||n.isKey(f)?f:{key:f,path:s.toPath(f)}));return i.map(f=>({original:f,criteria:m.map(y=>u(y,f))})).slice().sort((f,y)=>{for(let g=0;g<m.length;g++){const x=t.compareValues(f.criteria[g],y.criteria[g],o[g]);if(x!==0)return x}return 0}).map(f=>f.original)}e.orderBy=a}(Np)),Np}var _p={},ij;function nB(){return ij||(ij=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n,s=1){const a=[],i=Math.floor(s),l=(o,c)=>{for(let d=0;d<o.length;d++){const u=o[d];Array.isArray(u)&&c<i?l(u,c+1):a.push(u)}};return l(n,0),a}e.flatten=t}(_p)),_p}var Ep={},lj;function k2(){return lj||(lj=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=w2(),n=Jx(),s=x2(),a=Qx();function i(l,o,c){return s.isObject(c)&&(typeof o=="number"&&n.isArrayLike(c)&&t.isIndex(o)&&o<c.length||typeof o=="string"&&o in c)?a.eq(c[o],l):!1}e.isIterateeCall=i}(Ep)),Ep}var oj;function sB(){return oj||(oj=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=rB(),n=nB(),s=k2();function a(i,...l){const o=l.length;return o>1&&s.isIterateeCall(i,l[0],l[1])?l=[]:o>2&&s.isIterateeCall(l[0],l[1],l[2])&&(l=[l[0]]),t.orderBy(i,n.flatten(l),["asc"])}e.sortBy=a}(jp)),jp}var Dp,cj;function aB(){return cj||(cj=1,Dp=sB().sortBy),Dp}var iB=aB();const hm=ks(iB);var S2=e=>e.legend.settings,lB=e=>e.legend.size,oB=e=>e.legend.payload,cB=ve([oB,S2],(e,t)=>{var{itemSorter:n}=t,s=e.flat(1);return n?hm(s,n):s});function dB(){return tt(cB)}var id=1;function _2(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],[t,n]=h.useState({height:0,left:0,top:0,width:0}),s=h.useCallback(a=>{if(a!=null){var i=a.getBoundingClientRect(),l={height:i.height,left:i.left,top:i.top,width:i.width};(Math.abs(l.height-t.height)>id||Math.abs(l.left-t.left)>id||Math.abs(l.top-t.top)>id||Math.abs(l.width-t.width)>id)&&n({height:l.height,left:l.left,top:l.top,width:l.width})}},[t.width,t.height,t.top,t.left,...e]);return[t,s]}function un(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var uB=typeof Symbol=="function"&&Symbol.observable||"@@observable",dj=uB,Tp=()=>Math.random().toString(36).substring(7).split("").join("."),mB={INIT:`@@redux/INIT${Tp()}`,REPLACE:`@@redux/REPLACE${Tp()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Tp()}`},fu=mB;function n0(e){if(typeof e!="object"||e===null)return!1;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||Object.getPrototypeOf(e)===null}function E2(e,t,n){if(typeof e!="function")throw new Error(un(2));if(typeof t=="function"&&typeof n=="function"||typeof n=="function"&&typeof arguments[3]=="function")throw new Error(un(0));if(typeof t=="function"&&typeof n>"u"&&(n=t,t=void 0),typeof n<"u"){if(typeof n!="function")throw new Error(un(1));return n(E2)(e,t)}let s=e,a=t,i=new Map,l=i,o=0,c=!1;function d(){l===i&&(l=new Map,i.forEach((x,b)=>{l.set(b,x)}))}function u(){if(c)throw new Error(un(3));return a}function m(x){if(typeof x!="function")throw new Error(un(4));if(c)throw new Error(un(5));let b=!0;d();const v=o++;return l.set(v,x),function(){if(b){if(c)throw new Error(un(6));b=!1,d(),l.delete(v),i=null}}}function p(x){if(!n0(x))throw new Error(un(7));if(typeof x.type>"u")throw new Error(un(8));if(typeof x.type!="string")throw new Error(un(17));if(c)throw new Error(un(9));try{c=!0,a=s(a,x)}finally{c=!1}return(i=l).forEach(v=>{v()}),x}function f(x){if(typeof x!="function")throw new Error(un(10));s=x,p({type:fu.REPLACE})}function y(){const x=m;return{subscribe(b){if(typeof b!="object"||b===null)throw new Error(un(11));function v(){const N=b;N.next&&N.next(u())}return v(),{unsubscribe:x(v)}},[dj](){return this}}}return p({type:fu.INIT}),{dispatch:p,subscribe:m,getState:u,replaceReducer:f,[dj]:y}}function hB(e){Object.keys(e).forEach(t=>{const n=e[t];if(typeof n(void 0,{type:fu.INIT})>"u")throw new Error(un(12));if(typeof n(void 0,{type:fu.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(un(13))})}function D2(e){const t=Object.keys(e),n={};for(let i=0;i<t.length;i++){const l=t[i];typeof e[l]=="function"&&(n[l]=e[l])}const s=Object.keys(n);let a;try{hB(n)}catch(i){a=i}return function(l={},o){if(a)throw a;let c=!1;const d={};for(let u=0;u<s.length;u++){const m=s[u],p=n[m],f=l[m],y=p(f,o);if(typeof y>"u")throw o&&o.type,new Error(un(14));d[m]=y,c=c||y!==f}return c=c||s.length!==Object.keys(l).length,c?d:l}}function gu(...e){return e.length===0?t=>t:e.length===1?e[0]:e.reduce((t,n)=>(...s)=>t(n(...s)))}function pB(...e){return t=>(n,s)=>{const a=t(n,s);let i=()=>{throw new Error(un(15))};const l={getState:a.getState,dispatch:(c,...d)=>i(c,...d)},o=e.map(c=>c(l));return i=gu(...o)(a.dispatch),{...a,dispatch:i}}}function T2(e){return n0(e)&&"type"in e&&typeof e.type=="string"}var A2=Symbol.for("immer-nothing"),uj=Symbol.for("immer-draftable"),rs=Symbol.for("immer-state");function Is(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var ql=Object.getPrototypeOf;function Zi(e){return!!e&&!!e[rs]}function Pa(e){var t;return e?P2(e)||Array.isArray(e)||!!e[uj]||!!((t=e.constructor)!=null&&t[uj])||fm(e)||gm(e):!1}var fB=Object.prototype.constructor.toString();function P2(e){if(!e||typeof e!="object")return!1;const t=ql(e);if(t===null)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object?!0:typeof n=="function"&&Function.toString.call(n)===fB}function xu(e,t){pm(e)===0?Reflect.ownKeys(e).forEach(n=>{t(n,e[n],e)}):e.forEach((n,s)=>t(s,n,e))}function pm(e){const t=e[rs];return t?t.type_:Array.isArray(e)?1:fm(e)?2:gm(e)?3:0}function ig(e,t){return pm(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function O2(e,t,n){const s=pm(e);s===2?e.set(t,n):s===3?e.add(n):e[t]=n}function gB(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function fm(e){return e instanceof Map}function gm(e){return e instanceof Set}function Ti(e){return e.copy_||e.base_}function lg(e,t){if(fm(e))return new Map(e);if(gm(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const n=P2(e);if(t===!0||t==="class_only"&&!n){const s=Object.getOwnPropertyDescriptors(e);delete s[rs];let a=Reflect.ownKeys(s);for(let i=0;i<a.length;i++){const l=a[i],o=s[l];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(s[l]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[l]})}return Object.create(ql(e),s)}else{const s=ql(e);if(s!==null&&n)return{...e};const a=Object.create(s);return Object.assign(a,e)}}function s0(e,t=!1){return xm(e)||Zi(e)||!Pa(e)||(pm(e)>1&&(e.set=e.add=e.clear=e.delete=xB),Object.freeze(e),t&&Object.entries(e).forEach(([n,s])=>s0(s,!0))),e}function xB(){Is(2)}function xm(e){return Object.isFrozen(e)}var yB={};function el(e){const t=yB[e];return t||Is(0,e),t}var tc;function M2(){return tc}function bB(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function mj(e,t){t&&(el("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function og(e){cg(e),e.drafts_.forEach(vB),e.drafts_=null}function cg(e){e===tc&&(tc=e.parent_)}function hj(e){return tc=bB(tc,e)}function vB(e){const t=e[rs];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function pj(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return e!==void 0&&e!==n?(n[rs].modified_&&(og(t),Is(4)),Pa(e)&&(e=yu(t,e),t.parent_||bu(t,e)),t.patches_&&el("Patches").generateReplacementPatches_(n[rs].base_,e,t.patches_,t.inversePatches_)):e=yu(t,n,[]),og(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==A2?e:void 0}function yu(e,t,n){if(xm(t))return t;const s=t[rs];if(!s)return xu(t,(a,i)=>fj(e,s,t,a,i,n)),t;if(s.scope_!==e)return t;if(!s.modified_)return bu(e,s.base_,!0),s.base_;if(!s.finalized_){s.finalized_=!0,s.scope_.unfinalizedDrafts_--;const a=s.copy_;let i=a,l=!1;s.type_===3&&(i=new Set(a),a.clear(),l=!0),xu(i,(o,c)=>fj(e,s,a,o,c,n,l)),bu(e,a,!1),n&&e.patches_&&el("Patches").generatePatches_(s,n,e.patches_,e.inversePatches_)}return s.copy_}function fj(e,t,n,s,a,i,l){if(Zi(a)){const o=i&&t&&t.type_!==3&&!ig(t.assigned_,s)?i.concat(s):void 0,c=yu(e,a,o);if(O2(n,s,c),Zi(c))e.canAutoFreeze_=!1;else return}else l&&n.add(a);if(Pa(a)&&!xm(a)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;yu(e,a),(!t||!t.scope_.parent_)&&typeof s!="symbol"&&Object.prototype.propertyIsEnumerable.call(n,s)&&bu(e,a)}}function bu(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&s0(t,n)}function wB(e,t){const n=Array.isArray(e),s={type_:n?1:0,scope_:t?t.scope_:M2(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let a=s,i=a0;n&&(a=[s],i=rc);const{revoke:l,proxy:o}=Proxy.revocable(a,i);return s.draft_=o,s.revoke_=l,o}var a0={get(e,t){if(t===rs)return e;const n=Ti(e);if(!ig(n,t))return jB(e,n,t);const s=n[t];return e.finalized_||!Pa(s)?s:s===Ap(e.base_,t)?(Pp(e),e.copy_[t]=ug(s,e)):s},has(e,t){return t in Ti(e)},ownKeys(e){return Reflect.ownKeys(Ti(e))},set(e,t,n){const s=I2(Ti(e),t);if(s!=null&&s.set)return s.set.call(e.draft_,n),!0;if(!e.modified_){const a=Ap(Ti(e),t),i=a==null?void 0:a[rs];if(i&&i.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(gB(n,a)&&(n!==void 0||ig(e.base_,t)))return!0;Pp(e),dg(e)}return e.copy_[t]===n&&(n!==void 0||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty(e,t){return Ap(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,Pp(e),dg(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const n=Ti(e),s=Reflect.getOwnPropertyDescriptor(n,t);return s&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:s.enumerable,value:n[t]}},defineProperty(){Is(11)},getPrototypeOf(e){return ql(e.base_)},setPrototypeOf(){Is(12)}},rc={};xu(a0,(e,t)=>{rc[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});rc.deleteProperty=function(e,t){return rc.set.call(this,e,t,void 0)};rc.set=function(e,t,n){return a0.set.call(this,e[0],t,n,e[0])};function Ap(e,t){const n=e[rs];return(n?Ti(n):e)[t]}function jB(e,t,n){var a;const s=I2(t,n);return s?"value"in s?s.value:(a=s.get)==null?void 0:a.call(e.draft_):void 0}function I2(e,t){if(!(t in e))return;let n=ql(e);for(;n;){const s=Object.getOwnPropertyDescriptor(n,t);if(s)return s;n=ql(n)}}function dg(e){e.modified_||(e.modified_=!0,e.parent_&&dg(e.parent_))}function Pp(e){e.copy_||(e.copy_=lg(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var NB=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,n,s)=>{if(typeof t=="function"&&typeof n!="function"){const i=n;n=t;const l=this;return function(c=i,...d){return l.produce(c,u=>n.call(this,u,...d))}}typeof n!="function"&&Is(6),s!==void 0&&typeof s!="function"&&Is(7);let a;if(Pa(t)){const i=hj(this),l=ug(t,void 0);let o=!0;try{a=n(l),o=!1}finally{o?og(i):cg(i)}return mj(i,s),pj(a,i)}else if(!t||typeof t!="object"){if(a=n(t),a===void 0&&(a=t),a===A2&&(a=void 0),this.autoFreeze_&&s0(a,!0),s){const i=[],l=[];el("Patches").generateReplacementPatches_(t,a,i,l),s(i,l)}return a}else Is(1,t)},this.produceWithPatches=(t,n)=>{if(typeof t=="function")return(l,...o)=>this.produceWithPatches(l,c=>t(c,...o));let s,a;return[this.produce(t,n,(l,o)=>{s=l,a=o}),s,a]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){Pa(e)||Is(8),Zi(e)&&(e=Sa(e));const t=hj(this),n=ug(e,void 0);return n[rs].isManual_=!0,cg(t),n}finishDraft(e,t){const n=e&&e[rs];(!n||!n.isManual_)&&Is(9);const{scope_:s}=n;return mj(s,t),pj(void 0,s)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const a=t[n];if(a.path.length===0&&a.op==="replace"){e=a.value;break}}n>-1&&(t=t.slice(n+1));const s=el("Patches").applyPatches_;return Zi(e)?s(e,t):this.produce(e,a=>s(a,t))}};function ug(e,t){const n=fm(e)?el("MapSet").proxyMap_(e,t):gm(e)?el("MapSet").proxySet_(e,t):wB(e,t);return(t?t.scope_:M2()).drafts_.push(n),n}function Sa(e){return Zi(e)||Is(10,e),L2(e)}function L2(e){if(!Pa(e)||xm(e))return e;const t=e[rs];let n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=lg(e,t.scope_.immer_.useStrictShallowCopy_)}else n=lg(e,!0);return xu(n,(s,a)=>{O2(n,s,L2(a))}),t&&(t.finalized_=!1),n}var ns=new NB,R2=ns.produce;ns.produceWithPatches.bind(ns);ns.setAutoFreeze.bind(ns);ns.setUseStrictShallowCopy.bind(ns);ns.applyPatches.bind(ns);ns.createDraft.bind(ns);ns.finishDraft.bind(ns);function $2(e){return({dispatch:n,getState:s})=>a=>i=>typeof i=="function"?i(n,s,e):a(i)}var CB=$2(),kB=$2,SB=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?gu:gu.apply(null,arguments)};function Ns(e,t){function n(...s){if(t){let a=t(...s);if(!a)throw new Error(ts(0));return{type:e,payload:a.payload,..."meta"in a&&{meta:a.meta},..."error"in a&&{error:a.error}}}return{type:e,payload:s[0]}}return n.toString=()=>`${e}`,n.type=e,n.match=s=>T2(s)&&s.type===e,n}var F2=class zo extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,zo.prototype)}static get[Symbol.species](){return zo}concat(...t){return super.concat.apply(this,t)}prepend(...t){return t.length===1&&Array.isArray(t[0])?new zo(...t[0].concat(this)):new zo(...t.concat(this))}};function gj(e){return Pa(e)?R2(e,()=>{}):e}function ld(e,t,n){return e.has(t)?e.get(t):e.set(t,n(t)).get(t)}function _B(e){return typeof e=="boolean"}var EB=()=>function(t){const{thunk:n=!0,immutableCheck:s=!0,serializableCheck:a=!0,actionCreatorCheck:i=!0}=t??{};let l=new F2;return n&&(_B(n)?l.push(CB):l.push(kB(n.extraArgument))),l},DB="RTK_autoBatch",xj=e=>t=>{setTimeout(t,e)},TB=(e={type:"raf"})=>t=>(...n)=>{const s=t(...n);let a=!0,i=!1,l=!1;const o=new Set,c=e.type==="tick"?queueMicrotask:e.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:xj(10):e.type==="callback"?e.queueNotification:xj(e.timeout),d=()=>{l=!1,i&&(i=!1,o.forEach(u=>u()))};return Object.assign({},s,{subscribe(u){const m=()=>a&&u(),p=s.subscribe(m);return o.add(u),()=>{p(),o.delete(u)}},dispatch(u){var m;try{return a=!((m=u==null?void 0:u.meta)!=null&&m[DB]),i=!a,i&&(l||(l=!0,c(d))),s.dispatch(u)}finally{a=!0}}})},AB=e=>function(n){const{autoBatch:s=!0}=n??{};let a=new F2(e);return s&&a.push(TB(typeof s=="object"?s:void 0)),a};function PB(e){const t=EB(),{reducer:n=void 0,middleware:s,devTools:a=!0,preloadedState:i=void 0,enhancers:l=void 0}=e||{};let o;if(typeof n=="function")o=n;else if(n0(n))o=D2(n);else throw new Error(ts(1));let c;typeof s=="function"?c=s(t):c=t();let d=gu;a&&(d=SB({trace:!1,...typeof a=="object"&&a}));const u=pB(...c),m=AB(u);let p=typeof l=="function"?l(m):m();const f=d(...p);return E2(o,i,f)}function z2(e){const t={},n=[];let s;const a={addCase(i,l){const o=typeof i=="string"?i:i.type;if(!o)throw new Error(ts(28));if(o in t)throw new Error(ts(29));return t[o]=l,a},addMatcher(i,l){return n.push({matcher:i,reducer:l}),a},addDefaultCase(i){return s=i,a}};return e(a),[t,n,s]}function OB(e){return typeof e=="function"}function MB(e,t){let[n,s,a]=z2(t),i;if(OB(e))i=()=>gj(e());else{const o=gj(e);i=()=>o}function l(o=i(),c){let d=[n[c.type],...s.filter(({matcher:u})=>u(c)).map(({reducer:u})=>u)];return d.filter(u=>!!u).length===0&&(d=[a]),d.reduce((u,m)=>{if(m)if(Zi(u)){const f=m(u,c);return f===void 0?u:f}else{if(Pa(u))return R2(u,p=>m(p,c));{const p=m(u,c);if(p===void 0){if(u===null)return u;throw Error("A case reducer on a non-draftable value must not return undefined")}return p}}return u},o)}return l.getInitialState=i,l}var IB="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",LB=(e=21)=>{let t="",n=e;for(;n--;)t+=IB[Math.random()*64|0];return t},RB=Symbol.for("rtk-slice-createasyncthunk");function $B(e,t){return`${e}/${t}`}function FB({creators:e}={}){var n;const t=(n=e==null?void 0:e.asyncThunk)==null?void 0:n[RB];return function(a){const{name:i,reducerPath:l=i}=a;if(!i)throw new Error(ts(11));const o=(typeof a.reducers=="function"?a.reducers(BB()):a.reducers)||{},c=Object.keys(o),d={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},u={addCase(N,k){const j=typeof N=="string"?N:N.type;if(!j)throw new Error(ts(12));if(j in d.sliceCaseReducersByType)throw new Error(ts(13));return d.sliceCaseReducersByType[j]=k,u},addMatcher(N,k){return d.sliceMatchers.push({matcher:N,reducer:k}),u},exposeAction(N,k){return d.actionCreators[N]=k,u},exposeCaseReducer(N,k){return d.sliceCaseReducersByName[N]=k,u}};c.forEach(N=>{const k=o[N],j={reducerName:N,type:$B(i,N),createNotation:typeof a.reducers=="function"};qB(k)?WB(j,k,u,t):UB(j,k,u)});function m(){const[N={},k=[],j=void 0]=typeof a.extraReducers=="function"?z2(a.extraReducers):[a.extraReducers],S={...N,...d.sliceCaseReducersByType};return MB(a.initialState,_=>{for(let C in S)_.addCase(C,S[C]);for(let C of d.sliceMatchers)_.addMatcher(C.matcher,C.reducer);for(let C of k)_.addMatcher(C.matcher,C.reducer);j&&_.addDefaultCase(j)})}const p=N=>N,f=new Map,y=new WeakMap;let g;function x(N,k){return g||(g=m()),g(N,k)}function b(){return g||(g=m()),g.getInitialState()}function v(N,k=!1){function j(_){let C=_[N];return typeof C>"u"&&k&&(C=ld(y,j,b)),C}function S(_=p){const C=ld(f,k,()=>new WeakMap);return ld(C,_,()=>{const D={};for(const[A,E]of Object.entries(a.selectors??{}))D[A]=zB(E,_,()=>ld(y,_,b),k);return D})}return{reducerPath:N,getSelectors:S,get selectors(){return S(j)},selectSlice:j}}const w={name:i,reducer:x,actions:d.actionCreators,caseReducers:d.sliceCaseReducersByName,getInitialState:b,...v(l),injectInto(N,{reducerPath:k,...j}={}){const S=k??l;return N.inject({reducerPath:S,reducer:x},j),{...w,...v(S,!0)}}};return w}}function zB(e,t,n,s){function a(i,...l){let o=t(i);return typeof o>"u"&&s&&(o=n()),e(o,...l)}return a.unwrapped=e,a}var Ss=FB();function BB(){function e(t,n){return{_reducerDefinitionType:"asyncThunk",payloadCreator:t,...n}}return e.withTypes=()=>e,{reducer(t){return Object.assign({[t.name](...n){return t(...n)}}[t.name],{_reducerDefinitionType:"reducer"})},preparedReducer(t,n){return{_reducerDefinitionType:"reducerWithPrepare",prepare:t,reducer:n}},asyncThunk:e}}function UB({type:e,reducerName:t,createNotation:n},s,a){let i,l;if("reducer"in s){if(n&&!HB(s))throw new Error(ts(17));i=s.reducer,l=s.prepare}else i=s;a.addCase(e,i).exposeCaseReducer(t,i).exposeAction(t,l?Ns(e,l):Ns(e))}function qB(e){return e._reducerDefinitionType==="asyncThunk"}function HB(e){return e._reducerDefinitionType==="reducerWithPrepare"}function WB({type:e,reducerName:t},n,s,a){if(!a)throw new Error(ts(18));const{payloadCreator:i,fulfilled:l,pending:o,rejected:c,settled:d,options:u}=n,m=a(e,i,u);s.exposeAction(t,m),l&&s.addCase(m.fulfilled,l),o&&s.addCase(m.pending,o),c&&s.addCase(m.rejected,c),d&&s.addMatcher(m.settled,d),s.exposeCaseReducer(t,{fulfilled:l||od,pending:o||od,rejected:c||od,settled:d||od})}function od(){}var YB="task",B2="listener",U2="completed",i0="cancelled",VB=`task-${i0}`,GB=`task-${U2}`,mg=`${B2}-${i0}`,KB=`${B2}-${U2}`,ym=class{constructor(e){Xe(this,"name","TaskAbortError");Xe(this,"message");this.code=e,this.message=`${YB} ${i0} (reason: ${e})`}},l0=(e,t)=>{if(typeof e!="function")throw new TypeError(ts(32))},vu=()=>{},q2=(e,t=vu)=>(e.catch(t),e),H2=(e,t)=>(e.addEventListener("abort",t,{once:!0}),()=>e.removeEventListener("abort",t)),Bi=(e,t)=>{const n=e.signal;n.aborted||("reason"in n||Object.defineProperty(n,"reason",{enumerable:!0,value:t,configurable:!0,writable:!0}),e.abort(t))},Ui=e=>{if(e.aborted){const{reason:t}=e;throw new ym(t)}};function W2(e,t){let n=vu;return new Promise((s,a)=>{const i=()=>a(new ym(e.reason));if(e.aborted){i();return}n=H2(e,i),t.finally(()=>n()).then(s,a)}).finally(()=>{n=vu})}var XB=async(e,t)=>{try{return await Promise.resolve(),{status:"ok",value:await e()}}catch(n){return{status:n instanceof ym?"cancelled":"rejected",error:n}}finally{t==null||t()}},wu=e=>t=>q2(W2(e,t).then(n=>(Ui(e),n))),Y2=e=>{const t=wu(e);return n=>t(new Promise(s=>setTimeout(s,n)))},{assign:Dl}=Object,yj={},bm="listenerMiddleware",JB=(e,t)=>{const n=s=>H2(e,()=>Bi(s,e.reason));return(s,a)=>{l0(s);const i=new AbortController;n(i);const l=XB(async()=>{Ui(e),Ui(i.signal);const o=await s({pause:wu(i.signal),delay:Y2(i.signal),signal:i.signal});return Ui(i.signal),o},()=>Bi(i,GB));return a!=null&&a.autoJoin&&t.push(l.catch(vu)),{result:wu(e)(l),cancel(){Bi(i,VB)}}}},QB=(e,t)=>{const n=async(s,a)=>{Ui(t);let i=()=>{};const o=[new Promise((c,d)=>{let u=e({predicate:s,effect:(m,p)=>{p.unsubscribe(),c([m,p.getState(),p.getOriginalState()])}});i=()=>{u(),d()}})];a!=null&&o.push(new Promise(c=>setTimeout(c,a,null)));try{const c=await W2(t,Promise.race(o));return Ui(t),c}finally{i()}};return(s,a)=>q2(n(s,a))},V2=e=>{let{type:t,actionCreator:n,matcher:s,predicate:a,effect:i}=e;if(t)a=Ns(t).match;else if(n)t=n.type,a=n.match;else if(s)a=s;else if(!a)throw new Error(ts(21));return l0(i),{predicate:a,type:t,effect:i}},G2=Dl(e=>{const{type:t,predicate:n,effect:s}=V2(e);return{id:LB(),effect:s,type:t,predicate:n,pending:new Set,unsubscribe:()=>{throw new Error(ts(22))}}},{withTypes:()=>G2}),bj=(e,t)=>{const{type:n,effect:s,predicate:a}=V2(t);return Array.from(e.values()).find(i=>(typeof n=="string"?i.type===n:i.predicate===a)&&i.effect===s)},hg=e=>{e.pending.forEach(t=>{Bi(t,mg)})},ZB=e=>()=>{e.forEach(hg),e.clear()},vj=(e,t,n)=>{try{e(t,n)}catch(s){setTimeout(()=>{throw s},0)}},K2=Dl(Ns(`${bm}/add`),{withTypes:()=>K2}),eU=Ns(`${bm}/removeAll`),X2=Dl(Ns(`${bm}/remove`),{withTypes:()=>X2}),tU=(...e)=>{console.error(`${bm}/error`,...e)},Tc=(e={})=>{const t=new Map,{extra:n,onError:s=tU}=e;l0(s);const a=u=>(u.unsubscribe=()=>t.delete(u.id),t.set(u.id,u),m=>{u.unsubscribe(),m!=null&&m.cancelActive&&hg(u)}),i=u=>{const m=bj(t,u)??G2(u);return a(m)};Dl(i,{withTypes:()=>i});const l=u=>{const m=bj(t,u);return m&&(m.unsubscribe(),u.cancelActive&&hg(m)),!!m};Dl(l,{withTypes:()=>l});const o=async(u,m,p,f)=>{const y=new AbortController,g=QB(i,y.signal),x=[];try{u.pending.add(y),await Promise.resolve(u.effect(m,Dl({},p,{getOriginalState:f,condition:(b,v)=>g(b,v).then(Boolean),take:g,delay:Y2(y.signal),pause:wu(y.signal),extra:n,signal:y.signal,fork:JB(y.signal,x),unsubscribe:u.unsubscribe,subscribe:()=>{t.set(u.id,u)},cancelActiveListeners:()=>{u.pending.forEach((b,v,w)=>{b!==y&&(Bi(b,mg),w.delete(b))})},cancel:()=>{Bi(y,mg),u.pending.delete(y)},throwIfCancelled:()=>{Ui(y.signal)}})))}catch(b){b instanceof ym||vj(s,b,{raisedBy:"effect"})}finally{await Promise.all(x),Bi(y,KB),u.pending.delete(y)}},c=ZB(t);return{middleware:u=>m=>p=>{if(!T2(p))return m(p);if(K2.match(p))return i(p.payload);if(eU.match(p)){c();return}if(X2.match(p))return l(p.payload);let f=u.getState();const y=()=>{if(f===yj)throw new Error(ts(23));return f};let g;try{if(g=m(p),t.size>0){const x=u.getState(),b=Array.from(t.values());for(const v of b){let w=!1;try{w=v.predicate(p,x,f)}catch(N){w=!1,vj(s,N,{raisedBy:"predicate"})}w&&o(v,p,u,y)}}}finally{f=yj}return g},startListening:i,stopListening:l,clearListeners:c}};function ts(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var rU={layoutType:"horizontal",width:0,height:0,margin:{top:5,right:5,bottom:5,left:5},scale:1},J2=Ss({name:"chartLayout",initialState:rU,reducers:{setLayout(e,t){e.layoutType=t.payload},setChartSize(e,t){e.width=t.payload.width,e.height=t.payload.height},setMargin(e,t){e.margin.top=t.payload.top,e.margin.right=t.payload.right,e.margin.bottom=t.payload.bottom,e.margin.left=t.payload.left},setScale(e,t){e.scale=t.payload}}}),{setMargin:nU,setLayout:sU,setChartSize:aU,setScale:iU}=J2.actions,lU=J2.reducer;function wj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function jj(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?wj(Object(n),!0).forEach(function(s){oU(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wj(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function oU(e,t,n){return(t=cU(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cU(e){var t=dU(e,"string");return typeof t=="symbol"?t:t+""}function dU(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ju=Math.PI/180,uU=e=>e*180/Math.PI,qr=(e,t,n,s)=>({x:e+Math.cos(-ju*s)*n,y:t+Math.sin(-ju*s)*n}),Q2=function(t,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(s.left||0)-(s.right||0)),Math.abs(n-(s.top||0)-(s.bottom||0)))/2},mU=(e,t)=>{var{x:n,y:s}=e,{x:a,y:i}=t;return Math.sqrt((n-a)**2+(s-i)**2)},hU=(e,t)=>{var{x:n,y:s}=e,{cx:a,cy:i}=t,l=mU({x:n,y:s},{x:a,y:i});if(l<=0)return{radius:l,angle:0};var o=(n-a)/l,c=Math.acos(o);return s>i&&(c=2*Math.PI-c),{radius:l,angle:uU(c),angleInRadian:c}},pU=e=>{var{startAngle:t,endAngle:n}=e,s=Math.floor(t/360),a=Math.floor(n/360),i=Math.min(s,a);return{startAngle:t-i*360,endAngle:n-i*360}},fU=(e,t)=>{var{startAngle:n,endAngle:s}=t,a=Math.floor(n/360),i=Math.floor(s/360),l=Math.min(a,i);return e+l*360},gU=(e,t)=>{var{x:n,y:s}=e,{radius:a,angle:i}=hU({x:n,y:s},t),{innerRadius:l,outerRadius:o}=t;if(a<l||a>o||a===0)return null;var{startAngle:c,endAngle:d}=pU(t),u=i,m;if(c<=d){for(;u>d;)u-=360;for(;u<c;)u+=360;m=u>=c&&u<=d}else{for(;u>c;)u-=360;for(;u<d;)u+=360;m=u>=d&&u<=c}return m?jj(jj({},t),{},{radius:a,angle:fU(u,t)}):null};function Nj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function ms(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Nj(Object(n),!0).forEach(function(s){xU(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nj(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function xU(e,t,n){return(t=yU(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yU(e){var t=bU(e,"string");return typeof t=="symbol"?t:t+""}function bU(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function yr(e,t,n){return mr(e)||mr(t)?n:js(t)?hi(e,t,n):typeof t=="function"?t(e):n}var vU=(e,t,n,s,a)=>{var i,l=-1,o=(i=t==null?void 0:t.length)!==null&&i!==void 0?i:0;if(o<=1||e==null)return 0;if(s==="angleAxis"&&a!=null&&Math.abs(Math.abs(a[1]-a[0])-360)<=1e-6)for(var c=0;c<o;c++){var d=c>0?n[c-1].coordinate:n[o-1].coordinate,u=n[c].coordinate,m=c>=o-1?n[0].coordinate:n[c+1].coordinate,p=void 0;if(ln(u-d)!==ln(m-u)){var f=[];if(ln(m-u)===ln(a[1]-a[0])){p=m;var y=u+a[1]-a[0];f[0]=Math.min(y,(y+d)/2),f[1]=Math.max(y,(y+d)/2)}else{p=d;var g=m+a[1]-a[0];f[0]=Math.min(u,(g+u)/2),f[1]=Math.max(u,(g+u)/2)}var x=[Math.min(u,(p+u)/2),Math.max(u,(p+u)/2)];if(e>x[0]&&e<=x[1]||e>=f[0]&&e<=f[1]){({index:l}=n[c]);break}}else{var b=Math.min(d,m),v=Math.max(d,m);if(e>(b+u)/2&&e<=(v+u)/2){({index:l}=n[c]);break}}}else if(t){for(var w=0;w<o;w++)if(w===0&&e<=(t[w].coordinate+t[w+1].coordinate)/2||w>0&&w<o-1&&e>(t[w].coordinate+t[w-1].coordinate)/2&&e<=(t[w].coordinate+t[w+1].coordinate)/2||w===o-1&&e>(t[w].coordinate+t[w-1].coordinate)/2){({index:l}=t[w]);break}}return l},wU=(e,t,n)=>{if(t&&n){var{width:s,height:a}=n,{align:i,verticalAlign:l,layout:o}=t;if((o==="vertical"||o==="horizontal"&&l==="middle")&&i!=="center"&&et(e[i]))return ms(ms({},e),{},{[i]:e[i]+(s||0)});if((o==="horizontal"||o==="vertical"&&i==="center")&&l!=="middle"&&et(e[l]))return ms(ms({},e),{},{[l]:e[l]+(a||0)})}return e},bi=(e,t)=>e==="horizontal"&&t==="xAxis"||e==="vertical"&&t==="yAxis"||e==="centric"&&t==="angleAxis"||e==="radial"&&t==="radiusAxis",Z2=(e,t,n,s)=>{if(s)return e.map(o=>o.coordinate);var a,i,l=e.map(o=>(o.coordinate===t&&(a=!0),o.coordinate===n&&(i=!0),o.coordinate));return a||l.push(t),i||l.push(n),l},e_=(e,t,n)=>{if(!e)return null;var{duplicateDomain:s,type:a,range:i,scale:l,realScaleType:o,isCategorical:c,categoricalDomain:d,tickCount:u,ticks:m,niceTicks:p,axisType:f}=e;if(!l)return null;var y=o==="scaleBand"&&l.bandwidth?l.bandwidth()/2:2,g=a==="category"&&l.bandwidth?l.bandwidth()/y:0;if(g=f==="angleAxis"&&i&&i.length>=2?ln(i[0]-i[1])*2*g:g,m||p){var x=(m||p||[]).map((b,v)=>{var w=s?s.indexOf(b):b;return{coordinate:l(w)+g,value:b,offset:g,index:v}});return x.filter(b=>!Tn(b.coordinate))}return c&&d?d.map((b,v)=>({coordinate:l(b)+g,value:b,index:v,offset:g})):l.ticks&&u!=null?l.ticks(u).map((b,v)=>({coordinate:l(b)+g,value:b,offset:g,index:v})):l.domain().map((b,v)=>({coordinate:l(b)+g,value:s?s[b]:b,index:v,offset:g}))},Cj=1e-4,jU=e=>{var t=e.domain();if(!(!t||t.length<=2)){var n=t.length,s=e.range(),a=Math.min(s[0],s[1])-Cj,i=Math.max(s[0],s[1])+Cj,l=e(t[0]),o=e(t[n-1]);(l<a||l>i||o<a||o>i)&&e.domain([t[0],t[n-1]])}},NU=(e,t)=>{if(!t||t.length!==2||!et(t[0])||!et(t[1]))return e;var n=Math.min(t[0],t[1]),s=Math.max(t[0],t[1]),a=[e[0],e[1]];return(!et(e[0])||e[0]<n)&&(a[0]=n),(!et(e[1])||e[1]>s)&&(a[1]=s),a[0]>s&&(a[0]=s),a[1]<n&&(a[1]=n),a},CU=e=>{var t=e.length;if(!(t<=0))for(var n=0,s=e[0].length;n<s;++n)for(var a=0,i=0,l=0;l<t;++l){var o=Tn(e[l][n][1])?e[l][n][0]:e[l][n][1];o>=0?(e[l][n][0]=a,e[l][n][1]=a+o,a=e[l][n][1]):(e[l][n][0]=i,e[l][n][1]=i+o,i=e[l][n][1])}},kU=e=>{var t=e.length;if(!(t<=0))for(var n=0,s=e[0].length;n<s;++n)for(var a=0,i=0;i<t;++i){var l=Tn(e[i][n][1])?e[i][n][0]:e[i][n][1];l>=0?(e[i][n][0]=a,e[i][n][1]=a+l,a=e[i][n][1]):(e[i][n][0]=0,e[i][n][1]=0)}},SU={sign:CU,expand:r7,none:Ul,silhouette:n7,wiggle:s7,positive:kU},_U=(e,t,n)=>{var s=SU[n],a=t7().keys(t).value((i,l)=>+yr(i,l,0)).order(ng).offset(s);return a(e)};function t_(e){return e==null?void 0:String(e)}function kj(e){var{axis:t,ticks:n,bandSize:s,entry:a,index:i,dataKey:l}=e;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!mr(a[t.dataKey])){var o=KS(n,"value",a[t.dataKey]);if(o)return o.coordinate+s/2}return n[i]?n[i].coordinate+s/2:null}var c=yr(a,mr(l)?t.dataKey:l);return mr(c)?null:t.scale(c)}var Sj=e=>{var{axis:t,ticks:n,offset:s,bandSize:a,entry:i,index:l}=e;if(t.type==="category")return n[l]?n[l].coordinate+s:null;var o=yr(i,t.dataKey,t.scale.domain()[l]);return mr(o)?null:t.scale(o)-a/2+s},EU=e=>{var{numericAxis:t}=e,n=t.scale.domain();if(t.type==="number"){var s=Math.min(n[0],n[1]),a=Math.max(n[0],n[1]);return s<=0&&a>=0?0:a<0?a:s}return n[0]},DU=e=>{var t=e.flat(2).filter(et);return[Math.min(...t),Math.max(...t)]},TU=e=>[e[0]===1/0?0:e[0],e[1]===-1/0?0:e[1]],AU=(e,t,n)=>{if(e!=null)return TU(Object.keys(e).reduce((s,a)=>{var i=e[a],{stackedData:l}=i,o=l.reduce((c,d)=>{var u=DU(d.slice(t,n+1));return[Math.min(c[0],u[0]),Math.max(c[1],u[1])]},[1/0,-1/0]);return[Math.min(o[0],s[0]),Math.max(o[1],s[1])]},[1/0,-1/0]))},_j=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,Ej=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,nc=(e,t,n)=>{if(e&&e.scale&&e.scale.bandwidth){var s=e.scale.bandwidth();if(!n||s>0)return s}if(e&&t&&t.length>=2){for(var a=hm(t,u=>u.coordinate),i=1/0,l=1,o=a.length;l<o;l++){var c=a[l],d=a[l-1];i=Math.min((c.coordinate||0)-(d.coordinate||0),i)}return i===1/0?0:i}return n?void 0:0};function Dj(e){var{tooltipEntrySettings:t,dataKey:n,payload:s,value:a,name:i}=e;return ms(ms({},t),{},{dataKey:n,payload:s,value:a,name:i})}function ao(e,t){if(e)return String(e);if(typeof t=="string")return t}function PU(e,t,n,s,a){if(n==="horizontal"||n==="vertical"){var i=e>=a.left&&e<=a.left+a.width&&t>=a.top&&t<=a.top+a.height;return i?{x:e,y:t}:null}return s?gU({x:e,y:t},s):null}var OU=(e,t,n,s)=>{var a=t.find(d=>d&&d.index===n);if(a){if(e==="horizontal")return{x:a.coordinate,y:s.y};if(e==="vertical")return{x:s.x,y:a.coordinate};if(e==="centric"){var i=a.coordinate,{radius:l}=s;return ms(ms(ms({},s),qr(s.cx,s.cy,l,i)),{},{angle:i,radius:l})}var o=a.coordinate,{angle:c}=s;return ms(ms(ms({},s),qr(s.cx,s.cy,o,c)),{},{angle:c,radius:o})}return{x:0,y:0}},MU=(e,t)=>t==="horizontal"?e.x:t==="vertical"?e.y:t==="centric"?e.angle:e.radius,$a=e=>e.layout.width,Fa=e=>e.layout.height,IU=e=>e.layout.scale,r_=e=>e.layout.margin,o0=ve(e=>e.cartesianAxis.xAxis,e=>Object.values(e)),c0=ve(e=>e.cartesianAxis.yAxis,e=>Object.values(e)),n_="data-recharts-item-index",s_="data-recharts-item-data-key",vm=60;function Tj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Ya(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Tj(Object(n),!0).forEach(function(s){LU(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tj(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function LU(e,t,n){return(t=RU(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function RU(e){var t=$U(e,"string");return typeof t=="symbol"?t:t+""}function $U(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var FU=e=>e.brush.height,Zr=ve([$a,Fa,r_,FU,o0,c0,S2,lB],(e,t,n,s,a,i,l,o)=>{var c=i.reduce((y,g)=>{var{orientation:x}=g;if(!g.mirror&&!g.hide){var b=typeof g.width=="number"?g.width:vm;return Ya(Ya({},y),{},{[x]:y[x]+b})}return y},{left:n.left||0,right:n.right||0}),d=a.reduce((y,g)=>{var{orientation:x}=g;return!g.mirror&&!g.hide?Ya(Ya({},y),{},{[x]:hi(y,"".concat(x))+g.height}):y},{top:n.top||0,bottom:n.bottom||0}),u=Ya(Ya({},d),c),m=u.bottom;u.bottom+=s,u=wU(u,l,o);var p=e-u.left-u.right,f=t-u.top-u.bottom;return Ya(Ya({brushBottom:m},u),{},{width:Math.max(p,0),height:Math.max(f,0)})}),zU=ve(Zr,e=>({x:e.left,y:e.top,width:e.width,height:e.height})),a_=ve($a,Fa,(e,t)=>({x:0,y:0,width:e,height:t})),BU=h.createContext(null),jn=()=>h.useContext(BU)!=null,wm=e=>e.brush,jm=ve([wm,Zr,r_],(e,t,n)=>({height:e.height,x:et(e.x)?e.x:t.left,y:et(e.y)?e.y:t.top+t.height+t.brushBottom-((n==null?void 0:n.bottom)||0),width:et(e.width)?e.width:t.width})),Nm=()=>{var e,t=jn(),n=tt(zU),s=tt(jm),a=(e=tt(wm))===null||e===void 0?void 0:e.padding;return!t||!s||!a?n:{width:s.width-a.left-a.right,height:s.height-a.top-a.bottom,x:a.left,y:a.top}},UU={top:0,bottom:0,left:0,right:0,width:0,height:0,brushBottom:0},i_=()=>{var e;return(e=tt(Zr))!==null&&e!==void 0?e:UU},d0=()=>tt($a),u0=()=>tt(Fa),qU={top:0,right:0,bottom:0,left:0},HU=()=>{var e;return(e=tt(t=>t.layout.margin))!==null&&e!==void 0?e:qU},Qt=e=>e.layout.layoutType,Cm=()=>tt(Qt),WU={settings:{layout:"horizontal",align:"center",verticalAlign:"middle",itemSorter:"value"},size:{width:0,height:0},payload:[]},l_=Ss({name:"legend",initialState:WU,reducers:{setLegendSize(e,t){e.size.width=t.payload.width,e.size.height=t.payload.height},setLegendSettings(e,t){e.settings.align=t.payload.align,e.settings.layout=t.payload.layout,e.settings.verticalAlign=t.payload.verticalAlign,e.settings.itemSorter=t.payload.itemSorter},addLegendPayload(e,t){e.payload.push(t.payload)},removeLegendPayload(e,t){var n=Sa(e).payload.indexOf(t.payload);n>-1&&e.payload.splice(n,1)}}}),{setLegendSize:Aj,setLegendSettings:YU,addLegendPayload:o_,removeLegendPayload:c_}=l_.actions,VU=l_.reducer,GU=["contextPayload"];function pg(){return pg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},pg.apply(null,arguments)}function Pj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Hl(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Pj(Object(n),!0).forEach(function(s){m0(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pj(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function m0(e,t,n){return(t=KU(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function KU(e){var t=XU(e,"string");return typeof t=="symbol"?t:t+""}function XU(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function JU(e,t){if(e==null)return{};var n,s,a=QU(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function QU(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}function ZU(e){return e.value}function e9(e){var{contextPayload:t}=e,n=JU(e,GU),s=j2(t,e.payloadUniqBy,ZU),a=Hl(Hl({},n),{},{payload:s});return h.isValidElement(e.content)?h.cloneElement(e.content,a):typeof e.content=="function"?h.createElement(e.content,a):h.createElement(Xx,a)}function t9(e,t,n,s,a,i){var{layout:l,align:o,verticalAlign:c}=t,d,u;return(!e||(e.left===void 0||e.left===null)&&(e.right===void 0||e.right===null))&&(o==="center"&&l==="vertical"?d={left:((s||0)-i.width)/2}:d=o==="right"?{right:n&&n.right||0}:{left:n&&n.left||0}),(!e||(e.top===void 0||e.top===null)&&(e.bottom===void 0||e.bottom===null))&&(c==="middle"?u={top:((a||0)-i.height)/2}:u=c==="bottom"?{bottom:n&&n.bottom||0}:{top:n&&n.top||0}),Hl(Hl({},d),u)}function r9(e){var t=vr();return h.useEffect(()=>{t(YU(e))},[t,e]),null}function n9(e){var t=vr();return h.useEffect(()=>(t(Aj(e)),()=>{t(Aj({width:0,height:0}))}),[t,e]),null}function s9(e){var t=dB(),n=k8(),s=HU(),{width:a,height:i,wrapperStyle:l,portal:o}=e,[c,d]=_2([t]),u=d0(),m=u0(),p=u-(s.left||0)-(s.right||0),f=sc.getWidthOrHeight(e.layout,i,a,p),y=o?l:Hl(Hl({position:"absolute",width:(f==null?void 0:f.width)||a||"auto",height:(f==null?void 0:f.height)||i||"auto"},t9(l,e,s,u,m,c)),l),g=o??n;if(g==null)return null;var x=h.createElement("div",{className:"recharts-legend-wrapper",style:y,ref:d},h.createElement(r9,{layout:e.layout,align:e.align,verticalAlign:e.verticalAlign,itemSorter:e.itemSorter}),h.createElement(n9,{width:c.width,height:c.height}),h.createElement(e9,pg({},e,f,{margin:s,chartWidth:u,chartHeight:m,contextPayload:t})));return eo.createPortal(x,g)}class sc extends h.PureComponent{static getWidthOrHeight(t,n,s,a){return t==="vertical"&&et(n)?{height:n}:t==="horizontal"?{width:s||a}:null}render(){return h.createElement(s9,this.props)}}m0(sc,"displayName","Legend");m0(sc,"defaultProps",{align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"});function fg(){return fg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},fg.apply(null,arguments)}function Oj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Op(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Oj(Object(n),!0).forEach(function(s){a9(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oj(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function a9(e,t,n){return(t=i9(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i9(e){var t=l9(e,"string");return typeof t=="symbol"?t:t+""}function l9(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function o9(e){return Array.isArray(e)&&js(e[0])&&js(e[1])?e.join(" ~ "):e}var c9=e=>{var{separator:t=" : ",contentStyle:n={},itemStyle:s={},labelStyle:a={},payload:i,formatter:l,itemSorter:o,wrapperClassName:c,labelClassName:d,label:u,labelFormatter:m,accessibilityLayer:p=!1}=e,f=()=>{if(i&&i.length){var k={padding:0,margin:0},j=(o?hm(i,o):i).map((S,_)=>{if(S.type==="none")return null;var C=S.formatter||l||o9,{value:D,name:A}=S,E=D,T=A;if(C){var M=C(D,A,S,_,i);if(Array.isArray(M))[E,T]=M;else if(M!=null)E=M;else return null}var L=Op({display:"block",paddingTop:4,paddingBottom:4,color:S.color||"#000"},s);return h.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(_),style:L},js(T)?h.createElement("span",{className:"recharts-tooltip-item-name"},T):null,js(T)?h.createElement("span",{className:"recharts-tooltip-item-separator"},t):null,h.createElement("span",{className:"recharts-tooltip-item-value"},E),h.createElement("span",{className:"recharts-tooltip-item-unit"},S.unit||""))});return h.createElement("ul",{className:"recharts-tooltip-item-list",style:k},j)}return null},y=Op({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},n),g=Op({margin:0},a),x=!mr(u),b=x?u:"",v=xt("recharts-default-tooltip",c),w=xt("recharts-tooltip-label",d);x&&m&&i!==void 0&&i!==null&&(b=m(u,i));var N=p?{role:"status","aria-live":"assertive"}:{};return h.createElement("div",fg({className:v,style:y},N),h.createElement("p",{className:w,style:g},h.isValidElement(b)?b:"".concat(b)),f())},_o="recharts-tooltip-wrapper",d9={visibility:"hidden"};function u9(e){var{coordinate:t,translateX:n,translateY:s}=e;return xt(_o,{["".concat(_o,"-right")]:et(n)&&t&&et(t.x)&&n>=t.x,["".concat(_o,"-left")]:et(n)&&t&&et(t.x)&&n<t.x,["".concat(_o,"-bottom")]:et(s)&&t&&et(t.y)&&s>=t.y,["".concat(_o,"-top")]:et(s)&&t&&et(t.y)&&s<t.y})}function Mj(e){var{allowEscapeViewBox:t,coordinate:n,key:s,offsetTopLeft:a,position:i,reverseDirection:l,tooltipDimension:o,viewBox:c,viewBoxDimension:d}=e;if(i&&et(i[s]))return i[s];var u=n[s]-o-(a>0?a:0),m=n[s]+a;if(t[s])return l[s]?u:m;var p=c[s];if(p==null)return 0;if(l[s]){var f=u,y=p;return f<y?Math.max(m,p):Math.max(u,p)}if(d==null)return 0;var g=m+o,x=p+d;return g>x?Math.max(u,p):Math.max(m,p)}function m9(e){var{translateX:t,translateY:n,useTranslate3d:s}=e;return{transform:s?"translate3d(".concat(t,"px, ").concat(n,"px, 0)"):"translate(".concat(t,"px, ").concat(n,"px)")}}function h9(e){var{allowEscapeViewBox:t,coordinate:n,offsetTopLeft:s,position:a,reverseDirection:i,tooltipBox:l,useTranslate3d:o,viewBox:c}=e,d,u,m;return l.height>0&&l.width>0&&n?(u=Mj({allowEscapeViewBox:t,coordinate:n,key:"x",offsetTopLeft:s,position:a,reverseDirection:i,tooltipDimension:l.width,viewBox:c,viewBoxDimension:c.width}),m=Mj({allowEscapeViewBox:t,coordinate:n,key:"y",offsetTopLeft:s,position:a,reverseDirection:i,tooltipDimension:l.height,viewBox:c,viewBoxDimension:c.height}),d=m9({translateX:u,translateY:m,useTranslate3d:o})):d=d9,{cssProperties:d,cssClasses:u9({translateX:u,translateY:m,coordinate:n})}}function Ij(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function cd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ij(Object(n),!0).forEach(function(s){gg(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ij(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function gg(e,t,n){return(t=p9(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p9(e){var t=f9(e,"string");return typeof t=="symbol"?t:t+""}function f9(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}class g9 extends h.PureComponent{constructor(){super(...arguments),gg(this,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0}}),gg(this,"handleKeyDown",t=>{if(t.key==="Escape"){var n,s,a,i;this.setState({dismissed:!0,dismissedAtCoordinate:{x:(n=(s=this.props.coordinate)===null||s===void 0?void 0:s.x)!==null&&n!==void 0?n:0,y:(a=(i=this.props.coordinate)===null||i===void 0?void 0:i.y)!==null&&a!==void 0?a:0}})}})}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}componentDidUpdate(){var t,n;this.state.dismissed&&(((t=this.props.coordinate)===null||t===void 0?void 0:t.x)!==this.state.dismissedAtCoordinate.x||((n=this.props.coordinate)===null||n===void 0?void 0:n.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}render(){var{active:t,allowEscapeViewBox:n,animationDuration:s,animationEasing:a,children:i,coordinate:l,hasPayload:o,isAnimationActive:c,offset:d,position:u,reverseDirection:m,useTranslate3d:p,viewBox:f,wrapperStyle:y,lastBoundingBox:g,innerRef:x,hasPortalFromProps:b}=this.props,{cssClasses:v,cssProperties:w}=h9({allowEscapeViewBox:n,coordinate:l,offsetTopLeft:d,position:u,reverseDirection:m,tooltipBox:{height:g.height,width:g.width},useTranslate3d:p,viewBox:f}),N=b?{}:cd(cd({transition:c&&t?"transform ".concat(s,"ms ").concat(a):void 0},w),{},{pointerEvents:"none",visibility:!this.state.dismissed&&t&&o?"visible":"hidden",position:"absolute",top:0,left:0}),k=cd(cd({},N),{},{visibility:!this.state.dismissed&&t&&o?"visible":"hidden"},y);return h.createElement("div",{xmlns:"http://www.w3.org/1999/xhtml",tabIndex:-1,className:v,style:k,ref:x},i)}}var x9=()=>!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout),il={isSsr:x9()},d_=()=>tt(e=>e.rootProps.accessibilityLayer);function ss(e){return Number.isFinite(e)}function Wl(e){return typeof e=="number"&&e>0&&Number.isFinite(e)}function xg(){return xg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},xg.apply(null,arguments)}function Lj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Rj(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Lj(Object(n),!0).forEach(function(s){y9(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lj(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function y9(e,t,n){return(t=b9(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b9(e){var t=v9(e,"string");return typeof t=="symbol"?t:t+""}function v9(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var $j={curveBasisClosed:H8,curveBasisOpen:W8,curveBasis:q8,curveBumpX:D8,curveBumpY:T8,curveLinearClosed:Y8,curveLinear:um,curveMonotoneX:V8,curveMonotoneY:G8,curveNatural:K8,curveStep:X8,curveStepAfter:Q8,curveStepBefore:J8},dd=e=>ss(e.x)&&ss(e.y),Eo=e=>e.x,Do=e=>e.y,w9=(e,t)=>{if(typeof e=="function")return e;var n="curve".concat(_c(e));return(n==="curveMonotone"||n==="curveBump")&&t?$j["".concat(n).concat(t==="vertical"?"Y":"X")]:$j[n]||um},j9=e=>{var{type:t="linear",points:n=[],baseLine:s,layout:a,connectNulls:i=!1}=e,l=w9(t,a),o=i?n.filter(dd):n,c;if(Array.isArray(s)){var d=i?s.filter(m=>dd(m)):s,u=o.map((m,p)=>Rj(Rj({},m),{},{base:d[p]}));return a==="vertical"?c=sd().y(Do).x1(Eo).x0(m=>m.base.x):c=sd().x(Eo).y1(Do).y0(m=>m.base.y),c.defined(dd).curve(l),c(u)}return a==="vertical"&&et(s)?c=sd().y(Do).x1(Eo).x0(s):et(s)?c=sd().x(Eo).y1(Do).y0(s):c=s2().x(Eo).y(Do),c.defined(dd).curve(l),c(o)},h0=e=>{var{className:t,points:n,path:s,pathRef:a}=e;if((!n||!n.length)&&!s)return null;var i=n&&n.length?j9(e):s;return h.createElement("path",xg({},$t(e,!1),qx(e),{className:xt("recharts-curve",t),d:i===null?void 0:i,ref:a}))},N9=["x","y","top","left","width","height","className"];function yg(){return yg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},yg.apply(null,arguments)}function Fj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function C9(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Fj(Object(n),!0).forEach(function(s){k9(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fj(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function k9(e,t,n){return(t=S9(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S9(e){var t=_9(e,"string");return typeof t=="symbol"?t:t+""}function _9(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function E9(e,t){if(e==null)return{};var n,s,a=D9(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function D9(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}var T9=(e,t,n,s,a,i)=>"M".concat(e,",").concat(a,"v").concat(s,"M").concat(i,",").concat(t,"h").concat(n),A9=e=>{var{x:t=0,y:n=0,top:s=0,left:a=0,width:i=0,height:l=0,className:o}=e,c=E9(e,N9),d=C9({x:t,y:n,top:s,left:a,width:i,height:l},c);return!et(t)||!et(n)||!et(i)||!et(l)||!et(s)||!et(a)?null:h.createElement("path",yg({},$t(d,!0),{className:xt("recharts-cross",o),d:T9(t,n,i,l,s,a)}))};function P9(e,t,n,s){var a=s/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-a:n.left+.5,y:e==="horizontal"?n.top+.5:t.y-a,width:e==="horizontal"?s:n.width-1,height:e==="horizontal"?n.height-1:s}}function zj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function O9(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zj(Object(n),!0).forEach(function(s){M9(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zj(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function M9(e,t,n){return(t=I9(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I9(e){var t=L9(e,"string");return typeof t=="symbol"?t:t+""}function L9(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function _s(e,t){var n=O9({},e),s=t,a=Object.keys(t),i=a.reduce((l,o)=>(l[o]===void 0&&s[o]!==void 0&&(l[o]=s[o]),l),n);return i}var Mp={},Ip={},Lp={},Bj;function R9(){return Bj||(Bj=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){if(!n||typeof n!="object")return!1;const s=Object.getPrototypeOf(n);return s===null||s===Object.prototype||Object.getPrototypeOf(s)===null?Object.prototype.toString.call(n)==="[object Object]":!1}e.isPlainObject=t}(Lp)),Lp}var Uj;function $9(){return Uj||(Uj=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=R9(),n=b2(),s=e0(),a=t0(),i=Qx();function l(d,u,m){return o(d,u,void 0,void 0,void 0,void 0,m)}function o(d,u,m,p,f,y,g){const x=g(d,u,m,p,f,y);if(x!==void 0)return x;if(typeof d==typeof u)switch(typeof d){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return d===u;case"number":return d===u||Object.is(d,u);case"function":return d===u;case"object":return c(d,u,y,g)}return c(d,u,y,g)}function c(d,u,m,p){if(Object.is(d,u))return!0;let f=s.getTag(d),y=s.getTag(u);if(f===a.argumentsTag&&(f=a.objectTag),y===a.argumentsTag&&(y=a.objectTag),f!==y)return!1;switch(f){case a.stringTag:return d.toString()===u.toString();case a.numberTag:{const b=d.valueOf(),v=u.valueOf();return i.eq(b,v)}case a.booleanTag:case a.dateTag:case a.symbolTag:return Object.is(d.valueOf(),u.valueOf());case a.regexpTag:return d.source===u.source&&d.flags===u.flags;case a.functionTag:return d===u}m=m??new Map;const g=m.get(d),x=m.get(u);if(g!=null&&x!=null)return g===u;m.set(d,u),m.set(u,d);try{switch(f){case a.mapTag:{if(d.size!==u.size)return!1;for(const[b,v]of d.entries())if(!u.has(b)||!o(v,u.get(b),b,d,u,m,p))return!1;return!0}case a.setTag:{if(d.size!==u.size)return!1;const b=Array.from(d.values()),v=Array.from(u.values());for(let w=0;w<b.length;w++){const N=b[w],k=v.findIndex(j=>o(N,j,void 0,d,u,m,p));if(k===-1)return!1;v.splice(k,1)}return!0}case a.arrayTag:case a.uint8ArrayTag:case a.uint8ClampedArrayTag:case a.uint16ArrayTag:case a.uint32ArrayTag:case a.bigUint64ArrayTag:case a.int8ArrayTag:case a.int16ArrayTag:case a.int32ArrayTag:case a.bigInt64ArrayTag:case a.float32ArrayTag:case a.float64ArrayTag:{if(typeof Buffer<"u"&&Buffer.isBuffer(d)!==Buffer.isBuffer(u)||d.length!==u.length)return!1;for(let b=0;b<d.length;b++)if(!o(d[b],u[b],b,d,u,m,p))return!1;return!0}case a.arrayBufferTag:return d.byteLength!==u.byteLength?!1:c(new Uint8Array(d),new Uint8Array(u),m,p);case a.dataViewTag:return d.byteLength!==u.byteLength||d.byteOffset!==u.byteOffset?!1:c(new Uint8Array(d),new Uint8Array(u),m,p);case a.errorTag:return d.name===u.name&&d.message===u.message;case a.objectTag:{if(!(c(d.constructor,u.constructor,m,p)||t.isPlainObject(d)&&t.isPlainObject(u)))return!1;const v=[...Object.keys(d),...n.getSymbols(d)],w=[...Object.keys(u),...n.getSymbols(u)];if(v.length!==w.length)return!1;for(let N=0;N<v.length;N++){const k=v[N],j=d[k];if(!Object.hasOwn(u,k))return!1;const S=u[k];if(!o(j,S,k,d,u,m,p))return!1}return!0}default:return!1}}finally{m.delete(d),m.delete(u)}}e.isEqualWith=l}(Ip)),Ip}var Rp={},qj;function F9(){return qj||(qj=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(){}e.noop=t}(Rp)),Rp}var Hj;function z9(){return Hj||(Hj=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=$9(),n=F9();function s(a,i){return t.isEqualWith(a,i,n.noop)}e.isEqual=s}(Mp)),Mp}var $p,Wj;function B9(){return Wj||(Wj=1,$p=z9().isEqual),$p}var U9=B9();const q9=ks(U9);function H9(e){var t={},n=()=>null,s=!1,a=null,i=l=>{if(!s){if(Array.isArray(l)){if(!l.length)return;var o=l,[c,...d]=o;if(typeof c=="number"){a=e.setTimeout(i.bind(null,d),c);return}i(c),a=e.setTimeout(i.bind(null,d));return}typeof l=="object"&&(t=l,n(t)),typeof l=="function"&&l()}};return{stop:()=>{s=!0},start:l=>{s=!1,a&&(a(),a=null),i(l)},subscribe:l=>(n=l,()=>{n=()=>null}),getTimeoutController:()=>e}}var Nu=1e-4,u_=(e,t)=>[0,3*e,3*t-6*e,3*e-3*t+1],m_=(e,t)=>e.map((n,s)=>n*t**s).reduce((n,s)=>n+s),Yj=(e,t)=>n=>{var s=u_(e,t);return m_(s,n)},W9=(e,t)=>n=>{var s=u_(e,t),a=[...s.map((i,l)=>i*l).slice(1),0];return m_(a,n)},Vj=function(){for(var t,n,s,a,i=arguments.length,l=new Array(i),o=0;o<i;o++)l[o]=arguments[o];if(l.length===1)switch(l[0]){case"linear":[t,s,n,a]=[0,0,1,1];break;case"ease":[t,s,n,a]=[.25,.1,.25,1];break;case"ease-in":[t,s,n,a]=[.42,0,1,1];break;case"ease-out":[t,s,n,a]=[.42,0,.58,1];break;case"ease-in-out":[t,s,n,a]=[0,0,.58,1];break;default:{var c=l[0].split("(");c[0]==="cubic-bezier"&&c[1].split(")")[0].split(",").length===4&&([t,s,n,a]=c[1].split(")")[0].split(",").map(y=>parseFloat(y)))}}else l.length===4&&([t,s,n,a]=l);var d=Yj(t,n),u=Yj(s,a),m=W9(t,n),p=y=>y>1?1:y<0?0:y,f=y=>{for(var g=y>1?1:y,x=g,b=0;b<8;++b){var v=d(x)-g,w=m(x);if(Math.abs(v-g)<Nu||w<Nu)return u(x);x=p(x-v/w)}return u(x)};return f.isStepper=!1,f},Y9=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{stiff:n=100,damping:s=8,dt:a=17}=t,i=(l,o,c)=>{var d=-(l-o)*n,u=c*s,m=c+(d-u)*a/1e3,p=c*a/1e3+l;return Math.abs(p-o)<Nu&&Math.abs(m)<Nu?[o,0]:[p,m]};return i.isStepper=!0,i.dt=a,i},V9=e=>{if(typeof e=="string")switch(e){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return Vj(e);case"spring":return Y9();default:if(e.split("(")[0]==="cubic-bezier")return Vj(e)}return typeof e=="function"?e:null};function Gj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Kj(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Gj(Object(n),!0).forEach(function(s){G9(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gj(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function G9(e,t,n){return(t=K9(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function K9(e){var t=X9(e,"string");return typeof t=="symbol"?t:t+""}function X9(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var J9=e=>e.replace(/([A-Z])/g,t=>"-".concat(t.toLowerCase())),Q9=(e,t,n)=>e.map(s=>"".concat(J9(s)," ").concat(t,"ms ").concat(n)).join(","),Z9=(e,t)=>[Object.keys(e),Object.keys(t)].reduce((n,s)=>n.filter(a=>s.includes(a))),ac=(e,t)=>Object.keys(t).reduce((n,s)=>Kj(Kj({},n),{},{[s]:e(s,t[s])}),{});function Xj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function hn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Xj(Object(n),!0).forEach(function(s){eq(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xj(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function eq(e,t,n){return(t=tq(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tq(e){var t=rq(e,"string");return typeof t=="symbol"?t:t+""}function rq(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Cu=(e,t,n)=>e+(t-e)*n,bg=e=>{var{from:t,to:n}=e;return t!==n},h_=(e,t,n)=>{var s=ac((a,i)=>{if(bg(i)){var[l,o]=e(i.from,i.to,i.velocity);return hn(hn({},i),{},{from:l,velocity:o})}return i},t);return n<1?ac((a,i)=>bg(i)?hn(hn({},i),{},{velocity:Cu(i.velocity,s[a].velocity,n),from:Cu(i.from,s[a].from,n)}):i,t):h_(e,s,n-1)};function nq(e,t,n,s,a,i){var l,o=s.reduce((p,f)=>hn(hn({},p),{},{[f]:{from:e[f],velocity:0,to:t[f]}}),{}),c=()=>ac((p,f)=>f.from,o),d=()=>!Object.values(o).filter(bg).length,u=null,m=p=>{l||(l=p);var f=p-l,y=f/n.dt;o=h_(n,o,y),a(hn(hn(hn({},e),t),c())),l=p,d()||(u=i.setTimeout(m))};return()=>(u=i.setTimeout(m),()=>{u()})}function sq(e,t,n,s,a,i,l){var o=null,c=a.reduce((m,p)=>hn(hn({},m),{},{[p]:[e[p],t[p]]}),{}),d,u=m=>{d||(d=m);var p=(m-d)/s,f=ac((g,x)=>Cu(...x,n(p)),c);if(i(hn(hn(hn({},e),t),f)),p<1)o=l.setTimeout(u);else{var y=ac((g,x)=>Cu(...x,n(1)),c);i(hn(hn(hn({},e),t),y))}};return()=>(o=l.setTimeout(u),()=>{o()})}const aq=(e,t,n,s,a,i)=>{var l=Z9(e,t);return n.isStepper===!0?nq(e,t,n,l,a,i):sq(e,t,n,s,l,a,i)};class iq{setTimeout(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=performance.now(),a=null,i=l=>{l-s>=n?t(l):typeof requestAnimationFrame=="function"&&(a=requestAnimationFrame(i))};return a=requestAnimationFrame(i),()=>{cancelAnimationFrame(a)}}}var lq=["children","begin","duration","attributeName","easing","isActive","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart","animationManager"];function vg(){return vg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},vg.apply(null,arguments)}function oq(e,t){if(e==null)return{};var n,s,a=cq(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function cq(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}function Jj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Va(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Jj(Object(n),!0).forEach(function(s){Ii(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jj(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Ii(e,t,n){return(t=dq(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function dq(e){var t=uq(e,"string");return typeof t=="symbol"?t:t+""}function uq(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function mq(){return H9(new iq)}class p0 extends h.PureComponent{constructor(t,n){super(t,n),Ii(this,"mounted",!1),Ii(this,"manager",null),Ii(this,"stopJSAnimation",null),Ii(this,"unSubscribe",null);var{isActive:s,attributeName:a,from:i,to:l,children:o,duration:c,animationManager:d}=this.props;if(this.manager=d,this.handleStyleChange=this.handleStyleChange.bind(this),this.changeStyle=this.changeStyle.bind(this),!s||c<=0){this.state={style:{}},typeof o=="function"&&(this.state={style:l});return}if(i){if(typeof o=="function"){this.state={style:i};return}this.state={style:a?{[a]:i}:i}}else this.state={style:{}}}componentDidMount(){var{isActive:t,canBegin:n}=this.props;this.mounted=!0,!(!t||!n)&&this.runAnimation(this.props)}componentDidUpdate(t){var{isActive:n,canBegin:s,attributeName:a,shouldReAnimate:i,to:l,from:o}=this.props,{style:c}=this.state;if(s){if(!n){var d={style:a?{[a]:l}:l};this.state&&c&&(a&&c[a]!==l||!a&&c!==l)&&this.setState(d);return}if(!(q9(t.to,l)&&t.canBegin&&t.isActive)){var u=!t.canBegin||!t.isActive;this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var m=u||i?o:t.to;if(this.state&&c){var p={style:a?{[a]:m}:m};(a&&c[a]!==m||!a&&c!==m)&&this.setState(p)}this.runAnimation(Va(Va({},this.props),{},{from:m,begin:0}))}}}componentWillUnmount(){this.mounted=!1;var{onAnimationEnd:t}=this.props;this.unSubscribe&&this.unSubscribe(),this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation(),t&&t()}handleStyleChange(t){this.changeStyle(t)}changeStyle(t){this.mounted&&this.setState({style:t})}runJSAnimation(t){var{from:n,to:s,duration:a,easing:i,begin:l,onAnimationEnd:o,onAnimationStart:c}=t,d=aq(n,s,V9(i),a,this.changeStyle,this.manager.getTimeoutController()),u=()=>{this.stopJSAnimation=d()};this.manager.start([c,l,u,a,o])}runAnimation(t){var{begin:n,duration:s,attributeName:a,to:i,easing:l,onAnimationStart:o,onAnimationEnd:c,children:d}=t;if(this.unSubscribe=this.manager.subscribe(this.handleStyleChange),typeof l=="function"||typeof d=="function"||l==="spring"){this.runJSAnimation(t);return}var u=a?{[a]:i}:i,m=Q9(Object.keys(u),s,l);this.manager.start([o,n,Va(Va({},u),{},{transition:m}),s,c])}render(){var t=this.props,{children:n,begin:s,duration:a,attributeName:i,easing:l,isActive:o,from:c,to:d,canBegin:u,onAnimationEnd:m,shouldReAnimate:p,onAnimationReStart:f,animationManager:y}=t,g=oq(t,lq),x=h.Children.count(n),b=this.state.style;if(typeof n=="function")return n(b);if(!o||x===0||a<=0)return n;var v=w=>{var{style:N={},className:k}=w.props,j=h.cloneElement(w,Va(Va({},g),{},{style:Va(Va({},N),b),className:k}));return j};return x===1?v(h.Children.only(n)):h.createElement("div",null,h.Children.map(n,w=>v(w)))}}Ii(p0,"displayName","Animate");Ii(p0,"defaultProps",{begin:0,duration:1e3,attributeName:"",easing:"ease",isActive:!0,canBegin:!0,onAnimationEnd:()=>{},onAnimationStart:()=>{}});var hq=h.createContext(null);function pi(e){var t,n,s=h.useContext(hq);return h.createElement(p0,vg({},e,{animationManager:(t=(n=e.animationManager)!==null&&n!==void 0?n:s)!==null&&t!==void 0?t:mq()}))}function ku(){return ku=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},ku.apply(null,arguments)}var Qj=(e,t,n,s,a)=>{var i=Math.min(Math.abs(n)/2,Math.abs(s)/2),l=s>=0?1:-1,o=n>=0?1:-1,c=s>=0&&n>=0||s<0&&n<0?1:0,d;if(i>0&&a instanceof Array){for(var u=[0,0,0,0],m=0,p=4;m<p;m++)u[m]=a[m]>i?i:a[m];d="M".concat(e,",").concat(t+l*u[0]),u[0]>0&&(d+="A ".concat(u[0],",").concat(u[0],",0,0,").concat(c,",").concat(e+o*u[0],",").concat(t)),d+="L ".concat(e+n-o*u[1],",").concat(t),u[1]>0&&(d+="A ".concat(u[1],",").concat(u[1],",0,0,").concat(c,`,
        `).concat(e+n,",").concat(t+l*u[1])),d+="L ".concat(e+n,",").concat(t+s-l*u[2]),u[2]>0&&(d+="A ".concat(u[2],",").concat(u[2],",0,0,").concat(c,`,
        `).concat(e+n-o*u[2],",").concat(t+s)),d+="L ".concat(e+o*u[3],",").concat(t+s),u[3]>0&&(d+="A ".concat(u[3],",").concat(u[3],",0,0,").concat(c,`,
        `).concat(e,",").concat(t+s-l*u[3])),d+="Z"}else if(i>0&&a===+a&&a>0){var f=Math.min(i,a);d="M ".concat(e,",").concat(t+l*f,`
            A `).concat(f,",").concat(f,",0,0,").concat(c,",").concat(e+o*f,",").concat(t,`
            L `).concat(e+n-o*f,",").concat(t,`
            A `).concat(f,",").concat(f,",0,0,").concat(c,",").concat(e+n,",").concat(t+l*f,`
            L `).concat(e+n,",").concat(t+s-l*f,`
            A `).concat(f,",").concat(f,",0,0,").concat(c,",").concat(e+n-o*f,",").concat(t+s,`
            L `).concat(e+o*f,",").concat(t+s,`
            A `).concat(f,",").concat(f,",0,0,").concat(c,",").concat(e,",").concat(t+s-l*f," Z")}else d="M ".concat(e,",").concat(t," h ").concat(n," v ").concat(s," h ").concat(-n," Z");return d},pq={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},p_=e=>{var t=_s(e,pq),n=h.useRef(null),[s,a]=h.useState(-1);h.useEffect(()=>{if(n.current&&n.current.getTotalLength)try{var b=n.current.getTotalLength();b&&a(b)}catch{}},[]);var{x:i,y:l,width:o,height:c,radius:d,className:u}=t,{animationEasing:m,animationDuration:p,animationBegin:f,isAnimationActive:y,isUpdateAnimationActive:g}=t;if(i!==+i||l!==+l||o!==+o||c!==+c||o===0||c===0)return null;var x=xt("recharts-rectangle",u);return g?h.createElement(pi,{canBegin:s>0,from:{width:o,height:c,x:i,y:l},to:{width:o,height:c,x:i,y:l},duration:p,animationEasing:m,isActive:g},b=>{var{width:v,height:w,x:N,y:k}=b;return h.createElement(pi,{canBegin:s>0,from:"0px ".concat(s===-1?1:s,"px"),to:"".concat(s,"px 0px"),attributeName:"strokeDasharray",begin:f,duration:p,isActive:y,easing:m},h.createElement("path",ku({},$t(t,!0),{className:x,d:Qj(N,k,v,w,d),ref:n})))}):h.createElement("path",ku({},$t(t,!0),{className:x,d:Qj(i,l,o,c,d)}))};function f_(e){var{cx:t,cy:n,radius:s,startAngle:a,endAngle:i}=e,l=qr(t,n,s,a),o=qr(t,n,s,i);return{points:[l,o],cx:t,cy:n,radius:s,startAngle:a,endAngle:i}}function wg(){return wg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},wg.apply(null,arguments)}var fq=(e,t)=>{var n=ln(t-e),s=Math.min(Math.abs(t-e),359.999);return n*s},ud=e=>{var{cx:t,cy:n,radius:s,angle:a,sign:i,isExternal:l,cornerRadius:o,cornerIsExternal:c}=e,d=o*(l?1:-1)+s,u=Math.asin(o/d)/ju,m=c?a:a+i*u,p=qr(t,n,d,m),f=qr(t,n,s,m),y=c?a-i*u:a,g=qr(t,n,d*Math.cos(u*ju),y);return{center:p,circleTangency:f,lineTangency:g,theta:u}},g_=e=>{var{cx:t,cy:n,innerRadius:s,outerRadius:a,startAngle:i,endAngle:l}=e,o=fq(i,l),c=i+o,d=qr(t,n,a,i),u=qr(t,n,a,c),m="M ".concat(d.x,",").concat(d.y,`
    A `).concat(a,",").concat(a,`,0,
    `).concat(+(Math.abs(o)>180),",").concat(+(i>c),`,
    `).concat(u.x,",").concat(u.y,`
  `);if(s>0){var p=qr(t,n,s,i),f=qr(t,n,s,c);m+="L ".concat(f.x,",").concat(f.y,`
            A `).concat(s,",").concat(s,`,0,
            `).concat(+(Math.abs(o)>180),",").concat(+(i<=c),`,
            `).concat(p.x,",").concat(p.y," Z")}else m+="L ".concat(t,",").concat(n," Z");return m},gq=e=>{var{cx:t,cy:n,innerRadius:s,outerRadius:a,cornerRadius:i,forceCornerRadius:l,cornerIsExternal:o,startAngle:c,endAngle:d}=e,u=ln(d-c),{circleTangency:m,lineTangency:p,theta:f}=ud({cx:t,cy:n,radius:a,angle:c,sign:u,cornerRadius:i,cornerIsExternal:o}),{circleTangency:y,lineTangency:g,theta:x}=ud({cx:t,cy:n,radius:a,angle:d,sign:-u,cornerRadius:i,cornerIsExternal:o}),b=o?Math.abs(c-d):Math.abs(c-d)-f-x;if(b<0)return l?"M ".concat(p.x,",").concat(p.y,`
        a`).concat(i,",").concat(i,",0,0,1,").concat(i*2,`,0
        a`).concat(i,",").concat(i,",0,0,1,").concat(-i*2,`,0
      `):g_({cx:t,cy:n,innerRadius:s,outerRadius:a,startAngle:c,endAngle:d});var v="M ".concat(p.x,",").concat(p.y,`
    A`).concat(i,",").concat(i,",0,0,").concat(+(u<0),",").concat(m.x,",").concat(m.y,`
    A`).concat(a,",").concat(a,",0,").concat(+(b>180),",").concat(+(u<0),",").concat(y.x,",").concat(y.y,`
    A`).concat(i,",").concat(i,",0,0,").concat(+(u<0),",").concat(g.x,",").concat(g.y,`
  `);if(s>0){var{circleTangency:w,lineTangency:N,theta:k}=ud({cx:t,cy:n,radius:s,angle:c,sign:u,isExternal:!0,cornerRadius:i,cornerIsExternal:o}),{circleTangency:j,lineTangency:S,theta:_}=ud({cx:t,cy:n,radius:s,angle:d,sign:-u,isExternal:!0,cornerRadius:i,cornerIsExternal:o}),C=o?Math.abs(c-d):Math.abs(c-d)-k-_;if(C<0&&i===0)return"".concat(v,"L").concat(t,",").concat(n,"Z");v+="L".concat(S.x,",").concat(S.y,`
      A`).concat(i,",").concat(i,",0,0,").concat(+(u<0),",").concat(j.x,",").concat(j.y,`
      A`).concat(s,",").concat(s,",0,").concat(+(C>180),",").concat(+(u>0),",").concat(w.x,",").concat(w.y,`
      A`).concat(i,",").concat(i,",0,0,").concat(+(u<0),",").concat(N.x,",").concat(N.y,"Z")}else v+="L".concat(t,",").concat(n,"Z");return v},xq={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},x_=e=>{var t=_s(e,xq),{cx:n,cy:s,innerRadius:a,outerRadius:i,cornerRadius:l,forceCornerRadius:o,cornerIsExternal:c,startAngle:d,endAngle:u,className:m}=t;if(i<a||d===u)return null;var p=xt("recharts-sector",m),f=i-a,y=En(l,f,0,!0),g;return y>0&&Math.abs(d-u)<360?g=gq({cx:n,cy:s,innerRadius:a,outerRadius:i,cornerRadius:Math.min(y,f/2),forceCornerRadius:o,cornerIsExternal:c,startAngle:d,endAngle:u}):g=g_({cx:n,cy:s,innerRadius:a,outerRadius:i,startAngle:d,endAngle:u}),h.createElement("path",wg({},$t(t,!0),{className:p,d:g}))};function yq(e,t,n){var s,a,i,l;if(e==="horizontal")s=t.x,i=s,a=n.top,l=n.top+n.height;else if(e==="vertical")a=t.y,l=a,s=n.left,i=n.left+n.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var{cx:o,cy:c,innerRadius:d,outerRadius:u,angle:m}=t,p=qr(o,c,d,m),f=qr(o,c,u,m);s=p.x,a=p.y,i=f.x,l=f.y}else return f_(t);return[{x:s,y:a},{x:i,y:l}]}var Fp={},zp={},Bp={},Zj;function bq(){return Zj||(Zj=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=C2();function n(s){return t.isSymbol(s)?NaN:Number(s)}e.toNumber=n}(Bp)),Bp}var eN;function vq(){return eN||(eN=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=bq();function n(s){return s?(s=t.toNumber(s),s===1/0||s===-1/0?(s<0?-1:1)*Number.MAX_VALUE:s===s?s:0):s===0?s:0}e.toFinite=n}(zp)),zp}var tN;function wq(){return tN||(tN=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=k2(),n=vq();function s(a,i,l){l&&typeof l!="number"&&t.isIterateeCall(a,i,l)&&(i=l=void 0),a=n.toFinite(a),i===void 0?(i=a,a=0):i=n.toFinite(i),l=l===void 0?a<i?1:-1:n.toFinite(l);const o=Math.max(Math.ceil((i-a)/(l||1)),0),c=new Array(o);for(let d=0;d<o;d++)c[d]=a,a+=l;return c}e.range=s}(Fp)),Fp}var Up,rN;function jq(){return rN||(rN=1,Up=wq().range),Up}var Nq=jq();const y_=ks(Nq);function li(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Cq(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function f0(e){let t,n,s;e.length!==2?(t=li,n=(o,c)=>li(e(o),c),s=(o,c)=>e(o)-c):(t=e===li||e===Cq?e:kq,n=e,s=e);function a(o,c,d=0,u=o.length){if(d<u){if(t(c,c)!==0)return u;do{const m=d+u>>>1;n(o[m],c)<0?d=m+1:u=m}while(d<u)}return d}function i(o,c,d=0,u=o.length){if(d<u){if(t(c,c)!==0)return u;do{const m=d+u>>>1;n(o[m],c)<=0?d=m+1:u=m}while(d<u)}return d}function l(o,c,d=0,u=o.length){const m=a(o,c,d,u-1);return m>d&&s(o[m-1],c)>-s(o[m],c)?m-1:m}return{left:a,center:l,right:i}}function kq(){return 0}function b_(e){return e===null?NaN:+e}function*Sq(e,t){for(let n of e)n!=null&&(n=+n)>=n&&(yield n)}const _q=f0(li),Ac=_q.right;f0(b_).center;class nN extends Map{constructor(t,n=Tq){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[s,a]of t)this.set(s,a)}get(t){return super.get(sN(this,t))}has(t){return super.has(sN(this,t))}set(t,n){return super.set(Eq(this,t),n)}delete(t){return super.delete(Dq(this,t))}}function sN({_intern:e,_key:t},n){const s=t(n);return e.has(s)?e.get(s):n}function Eq({_intern:e,_key:t},n){const s=t(n);return e.has(s)?e.get(s):(e.set(s,n),n)}function Dq({_intern:e,_key:t},n){const s=t(n);return e.has(s)&&(n=e.get(s),e.delete(s)),n}function Tq(e){return e!==null&&typeof e=="object"?e.valueOf():e}function Aq(e=li){if(e===li)return v_;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,n)=>{const s=e(t,n);return s||s===0?s:(e(n,n)===0)-(e(t,t)===0)}}function v_(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const Pq=Math.sqrt(50),Oq=Math.sqrt(10),Mq=Math.sqrt(2);function Su(e,t,n){const s=(t-e)/Math.max(0,n),a=Math.floor(Math.log10(s)),i=s/Math.pow(10,a),l=i>=Pq?10:i>=Oq?5:i>=Mq?2:1;let o,c,d;return a<0?(d=Math.pow(10,-a)/l,o=Math.round(e*d),c=Math.round(t*d),o/d<e&&++o,c/d>t&&--c,d=-d):(d=Math.pow(10,a)*l,o=Math.round(e/d),c=Math.round(t/d),o*d<e&&++o,c*d>t&&--c),c<o&&.5<=n&&n<2?Su(e,t,n*2):[o,c,d]}function jg(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const s=t<e,[a,i,l]=s?Su(t,e,n):Su(e,t,n);if(!(i>=a))return[];const o=i-a+1,c=new Array(o);if(s)if(l<0)for(let d=0;d<o;++d)c[d]=(i-d)/-l;else for(let d=0;d<o;++d)c[d]=(i-d)*l;else if(l<0)for(let d=0;d<o;++d)c[d]=(a+d)/-l;else for(let d=0;d<o;++d)c[d]=(a+d)*l;return c}function Ng(e,t,n){return t=+t,e=+e,n=+n,Su(e,t,n)[2]}function Cg(e,t,n){t=+t,e=+e,n=+n;const s=t<e,a=s?Ng(t,e,n):Ng(e,t,n);return(s?-1:1)*(a<0?1/-a:a)}function aN(e,t){let n;for(const s of e)s!=null&&(n<s||n===void 0&&s>=s)&&(n=s);return n}function iN(e,t){let n;for(const s of e)s!=null&&(n>s||n===void 0&&s>=s)&&(n=s);return n}function w_(e,t,n=0,s=1/0,a){if(t=Math.floor(t),n=Math.floor(Math.max(0,n)),s=Math.floor(Math.min(e.length-1,s)),!(n<=t&&t<=s))return e;for(a=a===void 0?v_:Aq(a);s>n;){if(s-n>600){const c=s-n+1,d=t-n+1,u=Math.log(c),m=.5*Math.exp(2*u/3),p=.5*Math.sqrt(u*m*(c-m)/c)*(d-c/2<0?-1:1),f=Math.max(n,Math.floor(t-d*m/c+p)),y=Math.min(s,Math.floor(t+(c-d)*m/c+p));w_(e,t,f,y,a)}const i=e[t];let l=n,o=s;for(To(e,n,t),a(e[s],i)>0&&To(e,n,s);l<o;){for(To(e,l,o),++l,--o;a(e[l],i)<0;)++l;for(;a(e[o],i)>0;)--o}a(e[n],i)===0?To(e,n,o):(++o,To(e,o,s)),o<=t&&(n=o+1),t<=o&&(s=o-1)}return e}function To(e,t,n){const s=e[t];e[t]=e[n],e[n]=s}function Iq(e,t,n){if(e=Float64Array.from(Sq(e)),!(!(s=e.length)||isNaN(t=+t))){if(t<=0||s<2)return iN(e);if(t>=1)return aN(e);var s,a=(s-1)*t,i=Math.floor(a),l=aN(w_(e,i).subarray(0,i+1)),o=iN(e.subarray(i+1));return l+(o-l)*(a-i)}}function Lq(e,t,n=b_){if(!(!(s=e.length)||isNaN(t=+t))){if(t<=0||s<2)return+n(e[0],0,e);if(t>=1)return+n(e[s-1],s-1,e);var s,a=(s-1)*t,i=Math.floor(a),l=+n(e[i],i,e),o=+n(e[i+1],i+1,e);return l+(o-l)*(a-i)}}function Rq(e,t,n){e=+e,t=+t,n=(a=arguments.length)<2?(t=e,e=0,1):a<3?1:+n;for(var s=-1,a=Math.max(0,Math.ceil((t-e)/n))|0,i=new Array(a);++s<a;)i[s]=e+s*n;return i}function Es(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function za(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const kg=Symbol("implicit");function g0(){var e=new nN,t=[],n=[],s=kg;function a(i){let l=e.get(i);if(l===void 0){if(s!==kg)return s;e.set(i,l=t.push(i)-1)}return n[l%n.length]}return a.domain=function(i){if(!arguments.length)return t.slice();t=[],e=new nN;for(const l of i)e.has(l)||e.set(l,t.push(l)-1);return a},a.range=function(i){return arguments.length?(n=Array.from(i),a):n.slice()},a.unknown=function(i){return arguments.length?(s=i,a):s},a.copy=function(){return g0(t,n).unknown(s)},Es.apply(a,arguments),a}function x0(){var e=g0().unknown(void 0),t=e.domain,n=e.range,s=0,a=1,i,l,o=!1,c=0,d=0,u=.5;delete e.unknown;function m(){var p=t().length,f=a<s,y=f?a:s,g=f?s:a;i=(g-y)/Math.max(1,p-c+d*2),o&&(i=Math.floor(i)),y+=(g-y-i*(p-c))*u,l=i*(1-c),o&&(y=Math.round(y),l=Math.round(l));var x=Rq(p).map(function(b){return y+i*b});return n(f?x.reverse():x)}return e.domain=function(p){return arguments.length?(t(p),m()):t()},e.range=function(p){return arguments.length?([s,a]=p,s=+s,a=+a,m()):[s,a]},e.rangeRound=function(p){return[s,a]=p,s=+s,a=+a,o=!0,m()},e.bandwidth=function(){return l},e.step=function(){return i},e.round=function(p){return arguments.length?(o=!!p,m()):o},e.padding=function(p){return arguments.length?(c=Math.min(1,d=+p),m()):c},e.paddingInner=function(p){return arguments.length?(c=Math.min(1,p),m()):c},e.paddingOuter=function(p){return arguments.length?(d=+p,m()):d},e.align=function(p){return arguments.length?(u=Math.max(0,Math.min(1,p)),m()):u},e.copy=function(){return x0(t(),[s,a]).round(o).paddingInner(c).paddingOuter(d).align(u)},Es.apply(m(),arguments)}function j_(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return j_(t())},e}function $q(){return j_(x0.apply(null,arguments).paddingInner(1))}function y0(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function N_(e,t){var n=Object.create(e.prototype);for(var s in t)n[s]=t[s];return n}function Pc(){}var ic=.7,_u=1/ic,Tl="\\s*([+-]?\\d+)\\s*",lc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ea="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Fq=/^#([0-9a-f]{3,8})$/,zq=new RegExp(`^rgb\\(${Tl},${Tl},${Tl}\\)$`),Bq=new RegExp(`^rgb\\(${ea},${ea},${ea}\\)$`),Uq=new RegExp(`^rgba\\(${Tl},${Tl},${Tl},${lc}\\)$`),qq=new RegExp(`^rgba\\(${ea},${ea},${ea},${lc}\\)$`),Hq=new RegExp(`^hsl\\(${lc},${ea},${ea}\\)$`),Wq=new RegExp(`^hsla\\(${lc},${ea},${ea},${lc}\\)$`),lN={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};y0(Pc,oc,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:oN,formatHex:oN,formatHex8:Yq,formatHsl:Vq,formatRgb:cN,toString:cN});function oN(){return this.rgb().formatHex()}function Yq(){return this.rgb().formatHex8()}function Vq(){return C_(this).formatHsl()}function cN(){return this.rgb().formatRgb()}function oc(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Fq.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?dN(t):n===3?new Fn(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?md(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?md(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=zq.exec(e))?new Fn(t[1],t[2],t[3],1):(t=Bq.exec(e))?new Fn(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Uq.exec(e))?md(t[1],t[2],t[3],t[4]):(t=qq.exec(e))?md(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Hq.exec(e))?hN(t[1],t[2]/100,t[3]/100,1):(t=Wq.exec(e))?hN(t[1],t[2]/100,t[3]/100,t[4]):lN.hasOwnProperty(e)?dN(lN[e]):e==="transparent"?new Fn(NaN,NaN,NaN,0):null}function dN(e){return new Fn(e>>16&255,e>>8&255,e&255,1)}function md(e,t,n,s){return s<=0&&(e=t=n=NaN),new Fn(e,t,n,s)}function Gq(e){return e instanceof Pc||(e=oc(e)),e?(e=e.rgb(),new Fn(e.r,e.g,e.b,e.opacity)):new Fn}function Sg(e,t,n,s){return arguments.length===1?Gq(e):new Fn(e,t,n,s??1)}function Fn(e,t,n,s){this.r=+e,this.g=+t,this.b=+n,this.opacity=+s}y0(Fn,Sg,N_(Pc,{brighter(e){return e=e==null?_u:Math.pow(_u,e),new Fn(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?ic:Math.pow(ic,e),new Fn(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Fn(qi(this.r),qi(this.g),qi(this.b),Eu(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:uN,formatHex:uN,formatHex8:Kq,formatRgb:mN,toString:mN}));function uN(){return`#${Li(this.r)}${Li(this.g)}${Li(this.b)}`}function Kq(){return`#${Li(this.r)}${Li(this.g)}${Li(this.b)}${Li((isNaN(this.opacity)?1:this.opacity)*255)}`}function mN(){const e=Eu(this.opacity);return`${e===1?"rgb(":"rgba("}${qi(this.r)}, ${qi(this.g)}, ${qi(this.b)}${e===1?")":`, ${e})`}`}function Eu(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function qi(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Li(e){return e=qi(e),(e<16?"0":"")+e.toString(16)}function hN(e,t,n,s){return s<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Ls(e,t,n,s)}function C_(e){if(e instanceof Ls)return new Ls(e.h,e.s,e.l,e.opacity);if(e instanceof Pc||(e=oc(e)),!e)return new Ls;if(e instanceof Ls)return e;e=e.rgb();var t=e.r/255,n=e.g/255,s=e.b/255,a=Math.min(t,n,s),i=Math.max(t,n,s),l=NaN,o=i-a,c=(i+a)/2;return o?(t===i?l=(n-s)/o+(n<s)*6:n===i?l=(s-t)/o+2:l=(t-n)/o+4,o/=c<.5?i+a:2-i-a,l*=60):o=c>0&&c<1?0:l,new Ls(l,o,c,e.opacity)}function Xq(e,t,n,s){return arguments.length===1?C_(e):new Ls(e,t,n,s??1)}function Ls(e,t,n,s){this.h=+e,this.s=+t,this.l=+n,this.opacity=+s}y0(Ls,Xq,N_(Pc,{brighter(e){return e=e==null?_u:Math.pow(_u,e),new Ls(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?ic:Math.pow(ic,e),new Ls(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,s=n+(n<.5?n:1-n)*t,a=2*n-s;return new Fn(qp(e>=240?e-240:e+120,a,s),qp(e,a,s),qp(e<120?e+240:e-120,a,s),this.opacity)},clamp(){return new Ls(pN(this.h),hd(this.s),hd(this.l),Eu(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Eu(this.opacity);return`${e===1?"hsl(":"hsla("}${pN(this.h)}, ${hd(this.s)*100}%, ${hd(this.l)*100}%${e===1?")":`, ${e})`}`}}));function pN(e){return e=(e||0)%360,e<0?e+360:e}function hd(e){return Math.max(0,Math.min(1,e||0))}function qp(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const b0=e=>()=>e;function Jq(e,t){return function(n){return e+n*t}}function Qq(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(s){return Math.pow(e+s*t,n)}}function Zq(e){return(e=+e)==1?k_:function(t,n){return n-t?Qq(t,n,e):b0(isNaN(t)?n:t)}}function k_(e,t){var n=t-e;return n?Jq(e,n):b0(isNaN(e)?t:e)}const fN=function e(t){var n=Zq(t);function s(a,i){var l=n((a=Sg(a)).r,(i=Sg(i)).r),o=n(a.g,i.g),c=n(a.b,i.b),d=k_(a.opacity,i.opacity);return function(u){return a.r=l(u),a.g=o(u),a.b=c(u),a.opacity=d(u),a+""}}return s.gamma=e,s}(1);function eH(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,s=t.slice(),a;return function(i){for(a=0;a<n;++a)s[a]=e[a]*(1-i)+t[a]*i;return s}}function tH(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function rH(e,t){var n=t?t.length:0,s=e?Math.min(n,e.length):0,a=new Array(s),i=new Array(n),l;for(l=0;l<s;++l)a[l]=io(e[l],t[l]);for(;l<n;++l)i[l]=t[l];return function(o){for(l=0;l<s;++l)i[l]=a[l](o);return i}}function nH(e,t){var n=new Date;return e=+e,t=+t,function(s){return n.setTime(e*(1-s)+t*s),n}}function Du(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function sH(e,t){var n={},s={},a;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(a in t)a in e?n[a]=io(e[a],t[a]):s[a]=t[a];return function(i){for(a in n)s[a]=n[a](i);return s}}var _g=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Hp=new RegExp(_g.source,"g");function aH(e){return function(){return e}}function iH(e){return function(t){return e(t)+""}}function lH(e,t){var n=_g.lastIndex=Hp.lastIndex=0,s,a,i,l=-1,o=[],c=[];for(e=e+"",t=t+"";(s=_g.exec(e))&&(a=Hp.exec(t));)(i=a.index)>n&&(i=t.slice(n,i),o[l]?o[l]+=i:o[++l]=i),(s=s[0])===(a=a[0])?o[l]?o[l]+=a:o[++l]=a:(o[++l]=null,c.push({i:l,x:Du(s,a)})),n=Hp.lastIndex;return n<t.length&&(i=t.slice(n),o[l]?o[l]+=i:o[++l]=i),o.length<2?c[0]?iH(c[0].x):aH(t):(t=c.length,function(d){for(var u=0,m;u<t;++u)o[(m=c[u]).i]=m.x(d);return o.join("")})}function io(e,t){var n=typeof t,s;return t==null||n==="boolean"?b0(t):(n==="number"?Du:n==="string"?(s=oc(t))?(t=s,fN):lH:t instanceof oc?fN:t instanceof Date?nH:tH(t)?eH:Array.isArray(t)?rH:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?sH:Du)(e,t)}function v0(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function oH(e,t){t===void 0&&(t=e,e=io);for(var n=0,s=t.length-1,a=t[0],i=new Array(s<0?0:s);n<s;)i[n]=e(a,a=t[++n]);return function(l){var o=Math.max(0,Math.min(s-1,Math.floor(l*=s)));return i[o](l-o)}}function cH(e){return function(){return e}}function Tu(e){return+e}var gN=[0,1];function Sn(e){return e}function Eg(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:cH(isNaN(t)?NaN:.5)}function dH(e,t){var n;return e>t&&(n=e,e=t,t=n),function(s){return Math.max(e,Math.min(t,s))}}function uH(e,t,n){var s=e[0],a=e[1],i=t[0],l=t[1];return a<s?(s=Eg(a,s),i=n(l,i)):(s=Eg(s,a),i=n(i,l)),function(o){return i(s(o))}}function mH(e,t,n){var s=Math.min(e.length,t.length)-1,a=new Array(s),i=new Array(s),l=-1;for(e[s]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++l<s;)a[l]=Eg(e[l],e[l+1]),i[l]=n(t[l],t[l+1]);return function(o){var c=Ac(e,o,1,s)-1;return i[c](a[c](o))}}function Oc(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function km(){var e=gN,t=gN,n=io,s,a,i,l=Sn,o,c,d;function u(){var p=Math.min(e.length,t.length);return l!==Sn&&(l=dH(e[0],e[p-1])),o=p>2?mH:uH,c=d=null,m}function m(p){return p==null||isNaN(p=+p)?i:(c||(c=o(e.map(s),t,n)))(s(l(p)))}return m.invert=function(p){return l(a((d||(d=o(t,e.map(s),Du)))(p)))},m.domain=function(p){return arguments.length?(e=Array.from(p,Tu),u()):e.slice()},m.range=function(p){return arguments.length?(t=Array.from(p),u()):t.slice()},m.rangeRound=function(p){return t=Array.from(p),n=v0,u()},m.clamp=function(p){return arguments.length?(l=p?!0:Sn,u()):l!==Sn},m.interpolate=function(p){return arguments.length?(n=p,u()):n},m.unknown=function(p){return arguments.length?(i=p,m):i},function(p,f){return s=p,a=f,u()}}function w0(){return km()(Sn,Sn)}function hH(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Au(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,s=e.slice(0,n);return[s.length>1?s[0]+s.slice(2):s,+e.slice(n+1)]}function Yl(e){return e=Au(Math.abs(e)),e?e[1]:NaN}function pH(e,t){return function(n,s){for(var a=n.length,i=[],l=0,o=e[0],c=0;a>0&&o>0&&(c+o+1>s&&(o=Math.max(1,s-c)),i.push(n.substring(a-=o,a+o)),!((c+=o+1)>s));)o=e[l=(l+1)%e.length];return i.reverse().join(t)}}function fH(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var gH=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function cc(e){if(!(t=gH.exec(e)))throw new Error("invalid format: "+e);var t;return new j0({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}cc.prototype=j0.prototype;function j0(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}j0.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function xH(e){e:for(var t=e.length,n=1,s=-1,a;n<t;++n)switch(e[n]){case".":s=a=n;break;case"0":s===0&&(s=n),a=n;break;default:if(!+e[n])break e;s>0&&(s=0);break}return s>0?e.slice(0,s)+e.slice(a+1):e}var S_;function yH(e,t){var n=Au(e,t);if(!n)return e+"";var s=n[0],a=n[1],i=a-(S_=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,l=s.length;return i===l?s:i>l?s+new Array(i-l+1).join("0"):i>0?s.slice(0,i)+"."+s.slice(i):"0."+new Array(1-i).join("0")+Au(e,Math.max(0,t+i-1))[0]}function xN(e,t){var n=Au(e,t);if(!n)return e+"";var s=n[0],a=n[1];return a<0?"0."+new Array(-a).join("0")+s:s.length>a+1?s.slice(0,a+1)+"."+s.slice(a+1):s+new Array(a-s.length+2).join("0")}const yN={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:hH,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>xN(e*100,t),r:xN,s:yH,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function bN(e){return e}var vN=Array.prototype.map,wN=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function bH(e){var t=e.grouping===void 0||e.thousands===void 0?bN:pH(vN.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",s=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",i=e.numerals===void 0?bN:fH(vN.call(e.numerals,String)),l=e.percent===void 0?"%":e.percent+"",o=e.minus===void 0?"":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function d(m){m=cc(m);var p=m.fill,f=m.align,y=m.sign,g=m.symbol,x=m.zero,b=m.width,v=m.comma,w=m.precision,N=m.trim,k=m.type;k==="n"?(v=!0,k="g"):yN[k]||(w===void 0&&(w=12),N=!0,k="g"),(x||p==="0"&&f==="=")&&(x=!0,p="0",f="=");var j=g==="$"?n:g==="#"&&/[boxX]/.test(k)?"0"+k.toLowerCase():"",S=g==="$"?s:/[%p]/.test(k)?l:"",_=yN[k],C=/[defgprs%]/.test(k);w=w===void 0?6:/[gprs]/.test(k)?Math.max(1,Math.min(21,w)):Math.max(0,Math.min(20,w));function D(A){var E=j,T=S,M,L,P;if(k==="c")T=_(A)+T,A="";else{A=+A;var $=A<0||1/A<0;if(A=isNaN(A)?c:_(Math.abs(A),w),N&&(A=xH(A)),$&&+A==0&&y!=="+"&&($=!1),E=($?y==="("?y:o:y==="-"||y==="("?"":y)+E,T=(k==="s"?wN[8+S_/3]:"")+T+($&&y==="("?")":""),C){for(M=-1,L=A.length;++M<L;)if(P=A.charCodeAt(M),48>P||P>57){T=(P===46?a+A.slice(M+1):A.slice(M))+T,A=A.slice(0,M);break}}}v&&!x&&(A=t(A,1/0));var R=E.length+A.length+T.length,U=R<b?new Array(b-R+1).join(p):"";switch(v&&x&&(A=t(U+A,U.length?b-T.length:1/0),U=""),f){case"<":A=E+A+T+U;break;case"=":A=E+U+A+T;break;case"^":A=U.slice(0,R=U.length>>1)+E+A+T+U.slice(R);break;default:A=U+E+A+T;break}return i(A)}return D.toString=function(){return m+""},D}function u(m,p){var f=d((m=cc(m),m.type="f",m)),y=Math.max(-8,Math.min(8,Math.floor(Yl(p)/3)))*3,g=Math.pow(10,-y),x=wN[8+y/3];return function(b){return f(g*b)+x}}return{format:d,formatPrefix:u}}var pd,N0,__;vH({thousands:",",grouping:[3],currency:["$",""]});function vH(e){return pd=bH(e),N0=pd.format,__=pd.formatPrefix,pd}function wH(e){return Math.max(0,-Yl(Math.abs(e)))}function jH(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Yl(t)/3)))*3-Yl(Math.abs(e)))}function NH(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Yl(t)-Yl(e))+1}function E_(e,t,n,s){var a=Cg(e,t,n),i;switch(s=cc(s??",f"),s.type){case"s":{var l=Math.max(Math.abs(e),Math.abs(t));return s.precision==null&&!isNaN(i=jH(a,l))&&(s.precision=i),__(s,l)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(i=NH(a,Math.max(Math.abs(e),Math.abs(t))))&&(s.precision=i-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(i=wH(a))&&(s.precision=i-(s.type==="%")*2);break}}return N0(s)}function vi(e){var t=e.domain;return e.ticks=function(n){var s=t();return jg(s[0],s[s.length-1],n??10)},e.tickFormat=function(n,s){var a=t();return E_(a[0],a[a.length-1],n??10,s)},e.nice=function(n){n==null&&(n=10);var s=t(),a=0,i=s.length-1,l=s[a],o=s[i],c,d,u=10;for(o<l&&(d=l,l=o,o=d,d=a,a=i,i=d);u-- >0;){if(d=Ng(l,o,n),d===c)return s[a]=l,s[i]=o,t(s);if(d>0)l=Math.floor(l/d)*d,o=Math.ceil(o/d)*d;else if(d<0)l=Math.ceil(l*d)/d,o=Math.floor(o*d)/d;else break;c=d}return e},e}function D_(){var e=w0();return e.copy=function(){return Oc(e,D_())},Es.apply(e,arguments),vi(e)}function T_(e){var t;function n(s){return s==null||isNaN(s=+s)?t:s}return n.invert=n,n.domain=n.range=function(s){return arguments.length?(e=Array.from(s,Tu),n):e.slice()},n.unknown=function(s){return arguments.length?(t=s,n):t},n.copy=function(){return T_(e).unknown(t)},e=arguments.length?Array.from(e,Tu):[0,1],vi(n)}function A_(e,t){e=e.slice();var n=0,s=e.length-1,a=e[n],i=e[s],l;return i<a&&(l=n,n=s,s=l,l=a,a=i,i=l),e[n]=t.floor(a),e[s]=t.ceil(i),e}function jN(e){return Math.log(e)}function NN(e){return Math.exp(e)}function CH(e){return-Math.log(-e)}function kH(e){return-Math.exp(-e)}function SH(e){return isFinite(e)?+("1e"+e):e<0?0:e}function _H(e){return e===10?SH:e===Math.E?Math.exp:t=>Math.pow(e,t)}function EH(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function CN(e){return(t,n)=>-e(-t,n)}function C0(e){const t=e(jN,NN),n=t.domain;let s=10,a,i;function l(){return a=EH(s),i=_H(s),n()[0]<0?(a=CN(a),i=CN(i),e(CH,kH)):e(jN,NN),t}return t.base=function(o){return arguments.length?(s=+o,l()):s},t.domain=function(o){return arguments.length?(n(o),l()):n()},t.ticks=o=>{const c=n();let d=c[0],u=c[c.length-1];const m=u<d;m&&([d,u]=[u,d]);let p=a(d),f=a(u),y,g;const x=o==null?10:+o;let b=[];if(!(s%1)&&f-p<x){if(p=Math.floor(p),f=Math.ceil(f),d>0){for(;p<=f;++p)for(y=1;y<s;++y)if(g=p<0?y/i(-p):y*i(p),!(g<d)){if(g>u)break;b.push(g)}}else for(;p<=f;++p)for(y=s-1;y>=1;--y)if(g=p>0?y/i(-p):y*i(p),!(g<d)){if(g>u)break;b.push(g)}b.length*2<x&&(b=jg(d,u,x))}else b=jg(p,f,Math.min(f-p,x)).map(i);return m?b.reverse():b},t.tickFormat=(o,c)=>{if(o==null&&(o=10),c==null&&(c=s===10?"s":","),typeof c!="function"&&(!(s%1)&&(c=cc(c)).precision==null&&(c.trim=!0),c=N0(c)),o===1/0)return c;const d=Math.max(1,s*o/t.ticks().length);return u=>{let m=u/i(Math.round(a(u)));return m*s<s-.5&&(m*=s),m<=d?c(u):""}},t.nice=()=>n(A_(n(),{floor:o=>i(Math.floor(a(o))),ceil:o=>i(Math.ceil(a(o)))})),t}function P_(){const e=C0(km()).domain([1,10]);return e.copy=()=>Oc(e,P_()).base(e.base()),Es.apply(e,arguments),e}function kN(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function SN(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function k0(e){var t=1,n=e(kN(t),SN(t));return n.constant=function(s){return arguments.length?e(kN(t=+s),SN(t)):t},vi(n)}function O_(){var e=k0(km());return e.copy=function(){return Oc(e,O_()).constant(e.constant())},Es.apply(e,arguments)}function _N(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function DH(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function TH(e){return e<0?-e*e:e*e}function S0(e){var t=e(Sn,Sn),n=1;function s(){return n===1?e(Sn,Sn):n===.5?e(DH,TH):e(_N(n),_N(1/n))}return t.exponent=function(a){return arguments.length?(n=+a,s()):n},vi(t)}function _0(){var e=S0(km());return e.copy=function(){return Oc(e,_0()).exponent(e.exponent())},Es.apply(e,arguments),e}function AH(){return _0.apply(null,arguments).exponent(.5)}function EN(e){return Math.sign(e)*e*e}function PH(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function M_(){var e=w0(),t=[0,1],n=!1,s;function a(i){var l=PH(e(i));return isNaN(l)?s:n?Math.round(l):l}return a.invert=function(i){return e.invert(EN(i))},a.domain=function(i){return arguments.length?(e.domain(i),a):e.domain()},a.range=function(i){return arguments.length?(e.range((t=Array.from(i,Tu)).map(EN)),a):t.slice()},a.rangeRound=function(i){return a.range(i).round(!0)},a.round=function(i){return arguments.length?(n=!!i,a):n},a.clamp=function(i){return arguments.length?(e.clamp(i),a):e.clamp()},a.unknown=function(i){return arguments.length?(s=i,a):s},a.copy=function(){return M_(e.domain(),t).round(n).clamp(e.clamp()).unknown(s)},Es.apply(a,arguments),vi(a)}function I_(){var e=[],t=[],n=[],s;function a(){var l=0,o=Math.max(1,t.length);for(n=new Array(o-1);++l<o;)n[l-1]=Lq(e,l/o);return i}function i(l){return l==null||isNaN(l=+l)?s:t[Ac(n,l)]}return i.invertExtent=function(l){var o=t.indexOf(l);return o<0?[NaN,NaN]:[o>0?n[o-1]:e[0],o<n.length?n[o]:e[e.length-1]]},i.domain=function(l){if(!arguments.length)return e.slice();e=[];for(let o of l)o!=null&&!isNaN(o=+o)&&e.push(o);return e.sort(li),a()},i.range=function(l){return arguments.length?(t=Array.from(l),a()):t.slice()},i.unknown=function(l){return arguments.length?(s=l,i):s},i.quantiles=function(){return n.slice()},i.copy=function(){return I_().domain(e).range(t).unknown(s)},Es.apply(i,arguments)}function L_(){var e=0,t=1,n=1,s=[.5],a=[0,1],i;function l(c){return c!=null&&c<=c?a[Ac(s,c,0,n)]:i}function o(){var c=-1;for(s=new Array(n);++c<n;)s[c]=((c+1)*t-(c-n)*e)/(n+1);return l}return l.domain=function(c){return arguments.length?([e,t]=c,e=+e,t=+t,o()):[e,t]},l.range=function(c){return arguments.length?(n=(a=Array.from(c)).length-1,o()):a.slice()},l.invertExtent=function(c){var d=a.indexOf(c);return d<0?[NaN,NaN]:d<1?[e,s[0]]:d>=n?[s[n-1],t]:[s[d-1],s[d]]},l.unknown=function(c){return arguments.length&&(i=c),l},l.thresholds=function(){return s.slice()},l.copy=function(){return L_().domain([e,t]).range(a).unknown(i)},Es.apply(vi(l),arguments)}function R_(){var e=[.5],t=[0,1],n,s=1;function a(i){return i!=null&&i<=i?t[Ac(e,i,0,s)]:n}return a.domain=function(i){return arguments.length?(e=Array.from(i),s=Math.min(e.length,t.length-1),a):e.slice()},a.range=function(i){return arguments.length?(t=Array.from(i),s=Math.min(e.length,t.length-1),a):t.slice()},a.invertExtent=function(i){var l=t.indexOf(i);return[e[l-1],e[l]]},a.unknown=function(i){return arguments.length?(n=i,a):n},a.copy=function(){return R_().domain(e).range(t).unknown(n)},Es.apply(a,arguments)}const Wp=new Date,Yp=new Date;function en(e,t,n,s){function a(i){return e(i=arguments.length===0?new Date:new Date(+i)),i}return a.floor=i=>(e(i=new Date(+i)),i),a.ceil=i=>(e(i=new Date(i-1)),t(i,1),e(i),i),a.round=i=>{const l=a(i),o=a.ceil(i);return i-l<o-i?l:o},a.offset=(i,l)=>(t(i=new Date(+i),l==null?1:Math.floor(l)),i),a.range=(i,l,o)=>{const c=[];if(i=a.ceil(i),o=o==null?1:Math.floor(o),!(i<l)||!(o>0))return c;let d;do c.push(d=new Date(+i)),t(i,o),e(i);while(d<i&&i<l);return c},a.filter=i=>en(l=>{if(l>=l)for(;e(l),!i(l);)l.setTime(l-1)},(l,o)=>{if(l>=l)if(o<0)for(;++o<=0;)for(;t(l,-1),!i(l););else for(;--o>=0;)for(;t(l,1),!i(l););}),n&&(a.count=(i,l)=>(Wp.setTime(+i),Yp.setTime(+l),e(Wp),e(Yp),Math.floor(n(Wp,Yp))),a.every=i=>(i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?a.filter(s?l=>s(l)%i===0:l=>a.count(0,l)%i===0):a)),a}const Pu=en(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);Pu.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?en(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):Pu);Pu.range;const ya=1e3,fs=ya*60,ba=fs*60,Oa=ba*24,E0=Oa*7,DN=Oa*30,Vp=Oa*365,Ri=en(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*ya)},(e,t)=>(t-e)/ya,e=>e.getUTCSeconds());Ri.range;const D0=en(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*ya)},(e,t)=>{e.setTime(+e+t*fs)},(e,t)=>(t-e)/fs,e=>e.getMinutes());D0.range;const T0=en(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*fs)},(e,t)=>(t-e)/fs,e=>e.getUTCMinutes());T0.range;const A0=en(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*ya-e.getMinutes()*fs)},(e,t)=>{e.setTime(+e+t*ba)},(e,t)=>(t-e)/ba,e=>e.getHours());A0.range;const P0=en(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*ba)},(e,t)=>(t-e)/ba,e=>e.getUTCHours());P0.range;const Mc=en(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*fs)/Oa,e=>e.getDate()-1);Mc.range;const Sm=en(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Oa,e=>e.getUTCDate()-1);Sm.range;const $_=en(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Oa,e=>Math.floor(e/Oa));$_.range;function ll(e){return en(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*fs)/E0)}const _m=ll(0),Ou=ll(1),OH=ll(2),MH=ll(3),Vl=ll(4),IH=ll(5),LH=ll(6);_m.range;Ou.range;OH.range;MH.range;Vl.range;IH.range;LH.range;function ol(e){return en(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/E0)}const Em=ol(0),Mu=ol(1),RH=ol(2),$H=ol(3),Gl=ol(4),FH=ol(5),zH=ol(6);Em.range;Mu.range;RH.range;$H.range;Gl.range;FH.range;zH.range;const O0=en(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());O0.range;const M0=en(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());M0.range;const Ma=en(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Ma.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:en(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});Ma.range;const Ia=en(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Ia.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:en(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});Ia.range;function F_(e,t,n,s,a,i){const l=[[Ri,1,ya],[Ri,5,5*ya],[Ri,15,15*ya],[Ri,30,30*ya],[i,1,fs],[i,5,5*fs],[i,15,15*fs],[i,30,30*fs],[a,1,ba],[a,3,3*ba],[a,6,6*ba],[a,12,12*ba],[s,1,Oa],[s,2,2*Oa],[n,1,E0],[t,1,DN],[t,3,3*DN],[e,1,Vp]];function o(d,u,m){const p=u<d;p&&([d,u]=[u,d]);const f=m&&typeof m.range=="function"?m:c(d,u,m),y=f?f.range(d,+u+1):[];return p?y.reverse():y}function c(d,u,m){const p=Math.abs(u-d)/m,f=f0(([,,x])=>x).right(l,p);if(f===l.length)return e.every(Cg(d/Vp,u/Vp,m));if(f===0)return Pu.every(Math.max(Cg(d,u,m),1));const[y,g]=l[p/l[f-1][2]<l[f][2]/p?f-1:f];return y.every(g)}return[o,c]}const[BH,UH]=F_(Ia,M0,Em,$_,P0,T0),[qH,HH]=F_(Ma,O0,_m,Mc,A0,D0);function Gp(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Kp(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Ao(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function WH(e){var t=e.dateTime,n=e.date,s=e.time,a=e.periods,i=e.days,l=e.shortDays,o=e.months,c=e.shortMonths,d=Po(a),u=Oo(a),m=Po(i),p=Oo(i),f=Po(l),y=Oo(l),g=Po(o),x=Oo(o),b=Po(c),v=Oo(c),w={a:$,A:R,b:U,B:I,c:null,d:IN,e:IN,f:pW,g:CW,G:SW,H:uW,I:mW,j:hW,L:z_,m:fW,M:gW,p:z,q:F,Q:$N,s:FN,S:xW,u:yW,U:bW,V:vW,w:wW,W:jW,x:null,X:null,y:NW,Y:kW,Z:_W,"%":RN},N={a:O,A:K,b:J,B:se,c:null,d:LN,e:LN,f:AW,g:BW,G:qW,H:EW,I:DW,j:TW,L:U_,m:PW,M:OW,p:Z,q:oe,Q:$N,s:FN,S:MW,u:IW,U:LW,V:RW,w:$W,W:FW,x:null,X:null,y:zW,Y:UW,Z:HW,"%":RN},k={a:D,A,b:E,B:T,c:M,d:ON,e:ON,f:lW,g:PN,G:AN,H:MN,I:MN,j:nW,L:iW,m:rW,M:sW,p:C,q:tW,Q:cW,s:dW,S:aW,u:XH,U:JH,V:QH,w:KH,W:ZH,x:L,X:P,y:PN,Y:AN,Z:eW,"%":oW};w.x=j(n,w),w.X=j(s,w),w.c=j(t,w),N.x=j(n,N),N.X=j(s,N),N.c=j(t,N);function j(W,B){return function(V){var re=[],Me=-1,he=0,G=W.length,q,Q,ue;for(V instanceof Date||(V=new Date(+V));++Me<G;)W.charCodeAt(Me)===37&&(re.push(W.slice(he,Me)),(Q=TN[q=W.charAt(++Me)])!=null?q=W.charAt(++Me):Q=q==="e"?" ":"0",(ue=B[q])&&(q=ue(V,Q)),re.push(q),he=Me+1);return re.push(W.slice(he,Me)),re.join("")}}function S(W,B){return function(V){var re=Ao(1900,void 0,1),Me=_(re,W,V+="",0),he,G;if(Me!=V.length)return null;if("Q"in re)return new Date(re.Q);if("s"in re)return new Date(re.s*1e3+("L"in re?re.L:0));if(B&&!("Z"in re)&&(re.Z=0),"p"in re&&(re.H=re.H%12+re.p*12),re.m===void 0&&(re.m="q"in re?re.q:0),"V"in re){if(re.V<1||re.V>53)return null;"w"in re||(re.w=1),"Z"in re?(he=Kp(Ao(re.y,0,1)),G=he.getUTCDay(),he=G>4||G===0?Mu.ceil(he):Mu(he),he=Sm.offset(he,(re.V-1)*7),re.y=he.getUTCFullYear(),re.m=he.getUTCMonth(),re.d=he.getUTCDate()+(re.w+6)%7):(he=Gp(Ao(re.y,0,1)),G=he.getDay(),he=G>4||G===0?Ou.ceil(he):Ou(he),he=Mc.offset(he,(re.V-1)*7),re.y=he.getFullYear(),re.m=he.getMonth(),re.d=he.getDate()+(re.w+6)%7)}else("W"in re||"U"in re)&&("w"in re||(re.w="u"in re?re.u%7:"W"in re?1:0),G="Z"in re?Kp(Ao(re.y,0,1)).getUTCDay():Gp(Ao(re.y,0,1)).getDay(),re.m=0,re.d="W"in re?(re.w+6)%7+re.W*7-(G+5)%7:re.w+re.U*7-(G+6)%7);return"Z"in re?(re.H+=re.Z/100|0,re.M+=re.Z%100,Kp(re)):Gp(re)}}function _(W,B,V,re){for(var Me=0,he=B.length,G=V.length,q,Q;Me<he;){if(re>=G)return-1;if(q=B.charCodeAt(Me++),q===37){if(q=B.charAt(Me++),Q=k[q in TN?B.charAt(Me++):q],!Q||(re=Q(W,V,re))<0)return-1}else if(q!=V.charCodeAt(re++))return-1}return re}function C(W,B,V){var re=d.exec(B.slice(V));return re?(W.p=u.get(re[0].toLowerCase()),V+re[0].length):-1}function D(W,B,V){var re=f.exec(B.slice(V));return re?(W.w=y.get(re[0].toLowerCase()),V+re[0].length):-1}function A(W,B,V){var re=m.exec(B.slice(V));return re?(W.w=p.get(re[0].toLowerCase()),V+re[0].length):-1}function E(W,B,V){var re=b.exec(B.slice(V));return re?(W.m=v.get(re[0].toLowerCase()),V+re[0].length):-1}function T(W,B,V){var re=g.exec(B.slice(V));return re?(W.m=x.get(re[0].toLowerCase()),V+re[0].length):-1}function M(W,B,V){return _(W,t,B,V)}function L(W,B,V){return _(W,n,B,V)}function P(W,B,V){return _(W,s,B,V)}function $(W){return l[W.getDay()]}function R(W){return i[W.getDay()]}function U(W){return c[W.getMonth()]}function I(W){return o[W.getMonth()]}function z(W){return a[+(W.getHours()>=12)]}function F(W){return 1+~~(W.getMonth()/3)}function O(W){return l[W.getUTCDay()]}function K(W){return i[W.getUTCDay()]}function J(W){return c[W.getUTCMonth()]}function se(W){return o[W.getUTCMonth()]}function Z(W){return a[+(W.getUTCHours()>=12)]}function oe(W){return 1+~~(W.getUTCMonth()/3)}return{format:function(W){var B=j(W+="",w);return B.toString=function(){return W},B},parse:function(W){var B=S(W+="",!1);return B.toString=function(){return W},B},utcFormat:function(W){var B=j(W+="",N);return B.toString=function(){return W},B},utcParse:function(W){var B=S(W+="",!0);return B.toString=function(){return W},B}}}var TN={"-":"",_:" ",0:"0"},cn=/^\s*\d+/,YH=/^%/,VH=/[\\^$*+?|[\]().{}]/g;function Vt(e,t,n){var s=e<0?"-":"",a=(s?-e:e)+"",i=a.length;return s+(i<n?new Array(n-i+1).join(t)+a:a)}function GH(e){return e.replace(VH,"\\$&")}function Po(e){return new RegExp("^(?:"+e.map(GH).join("|")+")","i")}function Oo(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function KH(e,t,n){var s=cn.exec(t.slice(n,n+1));return s?(e.w=+s[0],n+s[0].length):-1}function XH(e,t,n){var s=cn.exec(t.slice(n,n+1));return s?(e.u=+s[0],n+s[0].length):-1}function JH(e,t,n){var s=cn.exec(t.slice(n,n+2));return s?(e.U=+s[0],n+s[0].length):-1}function QH(e,t,n){var s=cn.exec(t.slice(n,n+2));return s?(e.V=+s[0],n+s[0].length):-1}function ZH(e,t,n){var s=cn.exec(t.slice(n,n+2));return s?(e.W=+s[0],n+s[0].length):-1}function AN(e,t,n){var s=cn.exec(t.slice(n,n+4));return s?(e.y=+s[0],n+s[0].length):-1}function PN(e,t,n){var s=cn.exec(t.slice(n,n+2));return s?(e.y=+s[0]+(+s[0]>68?1900:2e3),n+s[0].length):-1}function eW(e,t,n){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return s?(e.Z=s[1]?0:-(s[2]+(s[3]||"00")),n+s[0].length):-1}function tW(e,t,n){var s=cn.exec(t.slice(n,n+1));return s?(e.q=s[0]*3-3,n+s[0].length):-1}function rW(e,t,n){var s=cn.exec(t.slice(n,n+2));return s?(e.m=s[0]-1,n+s[0].length):-1}function ON(e,t,n){var s=cn.exec(t.slice(n,n+2));return s?(e.d=+s[0],n+s[0].length):-1}function nW(e,t,n){var s=cn.exec(t.slice(n,n+3));return s?(e.m=0,e.d=+s[0],n+s[0].length):-1}function MN(e,t,n){var s=cn.exec(t.slice(n,n+2));return s?(e.H=+s[0],n+s[0].length):-1}function sW(e,t,n){var s=cn.exec(t.slice(n,n+2));return s?(e.M=+s[0],n+s[0].length):-1}function aW(e,t,n){var s=cn.exec(t.slice(n,n+2));return s?(e.S=+s[0],n+s[0].length):-1}function iW(e,t,n){var s=cn.exec(t.slice(n,n+3));return s?(e.L=+s[0],n+s[0].length):-1}function lW(e,t,n){var s=cn.exec(t.slice(n,n+6));return s?(e.L=Math.floor(s[0]/1e3),n+s[0].length):-1}function oW(e,t,n){var s=YH.exec(t.slice(n,n+1));return s?n+s[0].length:-1}function cW(e,t,n){var s=cn.exec(t.slice(n));return s?(e.Q=+s[0],n+s[0].length):-1}function dW(e,t,n){var s=cn.exec(t.slice(n));return s?(e.s=+s[0],n+s[0].length):-1}function IN(e,t){return Vt(e.getDate(),t,2)}function uW(e,t){return Vt(e.getHours(),t,2)}function mW(e,t){return Vt(e.getHours()%12||12,t,2)}function hW(e,t){return Vt(1+Mc.count(Ma(e),e),t,3)}function z_(e,t){return Vt(e.getMilliseconds(),t,3)}function pW(e,t){return z_(e,t)+"000"}function fW(e,t){return Vt(e.getMonth()+1,t,2)}function gW(e,t){return Vt(e.getMinutes(),t,2)}function xW(e,t){return Vt(e.getSeconds(),t,2)}function yW(e){var t=e.getDay();return t===0?7:t}function bW(e,t){return Vt(_m.count(Ma(e)-1,e),t,2)}function B_(e){var t=e.getDay();return t>=4||t===0?Vl(e):Vl.ceil(e)}function vW(e,t){return e=B_(e),Vt(Vl.count(Ma(e),e)+(Ma(e).getDay()===4),t,2)}function wW(e){return e.getDay()}function jW(e,t){return Vt(Ou.count(Ma(e)-1,e),t,2)}function NW(e,t){return Vt(e.getFullYear()%100,t,2)}function CW(e,t){return e=B_(e),Vt(e.getFullYear()%100,t,2)}function kW(e,t){return Vt(e.getFullYear()%1e4,t,4)}function SW(e,t){var n=e.getDay();return e=n>=4||n===0?Vl(e):Vl.ceil(e),Vt(e.getFullYear()%1e4,t,4)}function _W(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Vt(t/60|0,"0",2)+Vt(t%60,"0",2)}function LN(e,t){return Vt(e.getUTCDate(),t,2)}function EW(e,t){return Vt(e.getUTCHours(),t,2)}function DW(e,t){return Vt(e.getUTCHours()%12||12,t,2)}function TW(e,t){return Vt(1+Sm.count(Ia(e),e),t,3)}function U_(e,t){return Vt(e.getUTCMilliseconds(),t,3)}function AW(e,t){return U_(e,t)+"000"}function PW(e,t){return Vt(e.getUTCMonth()+1,t,2)}function OW(e,t){return Vt(e.getUTCMinutes(),t,2)}function MW(e,t){return Vt(e.getUTCSeconds(),t,2)}function IW(e){var t=e.getUTCDay();return t===0?7:t}function LW(e,t){return Vt(Em.count(Ia(e)-1,e),t,2)}function q_(e){var t=e.getUTCDay();return t>=4||t===0?Gl(e):Gl.ceil(e)}function RW(e,t){return e=q_(e),Vt(Gl.count(Ia(e),e)+(Ia(e).getUTCDay()===4),t,2)}function $W(e){return e.getUTCDay()}function FW(e,t){return Vt(Mu.count(Ia(e)-1,e),t,2)}function zW(e,t){return Vt(e.getUTCFullYear()%100,t,2)}function BW(e,t){return e=q_(e),Vt(e.getUTCFullYear()%100,t,2)}function UW(e,t){return Vt(e.getUTCFullYear()%1e4,t,4)}function qW(e,t){var n=e.getUTCDay();return e=n>=4||n===0?Gl(e):Gl.ceil(e),Vt(e.getUTCFullYear()%1e4,t,4)}function HW(){return"+0000"}function RN(){return"%"}function $N(e){return+e}function FN(e){return Math.floor(+e/1e3)}var gl,H_,W_;WW({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function WW(e){return gl=WH(e),H_=gl.format,gl.parse,W_=gl.utcFormat,gl.utcParse,gl}function YW(e){return new Date(e)}function VW(e){return e instanceof Date?+e:+new Date(+e)}function I0(e,t,n,s,a,i,l,o,c,d){var u=w0(),m=u.invert,p=u.domain,f=d(".%L"),y=d(":%S"),g=d("%I:%M"),x=d("%I %p"),b=d("%a %d"),v=d("%b %d"),w=d("%B"),N=d("%Y");function k(j){return(c(j)<j?f:o(j)<j?y:l(j)<j?g:i(j)<j?x:s(j)<j?a(j)<j?b:v:n(j)<j?w:N)(j)}return u.invert=function(j){return new Date(m(j))},u.domain=function(j){return arguments.length?p(Array.from(j,VW)):p().map(YW)},u.ticks=function(j){var S=p();return e(S[0],S[S.length-1],j??10)},u.tickFormat=function(j,S){return S==null?k:d(S)},u.nice=function(j){var S=p();return(!j||typeof j.range!="function")&&(j=t(S[0],S[S.length-1],j??10)),j?p(A_(S,j)):u},u.copy=function(){return Oc(u,I0(e,t,n,s,a,i,l,o,c,d))},u}function GW(){return Es.apply(I0(qH,HH,Ma,O0,_m,Mc,A0,D0,Ri,H_).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function KW(){return Es.apply(I0(BH,UH,Ia,M0,Em,Sm,P0,T0,Ri,W_).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Dm(){var e=0,t=1,n,s,a,i,l=Sn,o=!1,c;function d(m){return m==null||isNaN(m=+m)?c:l(a===0?.5:(m=(i(m)-n)*a,o?Math.max(0,Math.min(1,m)):m))}d.domain=function(m){return arguments.length?([e,t]=m,n=i(e=+e),s=i(t=+t),a=n===s?0:1/(s-n),d):[e,t]},d.clamp=function(m){return arguments.length?(o=!!m,d):o},d.interpolator=function(m){return arguments.length?(l=m,d):l};function u(m){return function(p){var f,y;return arguments.length?([f,y]=p,l=m(f,y),d):[l(0),l(1)]}}return d.range=u(io),d.rangeRound=u(v0),d.unknown=function(m){return arguments.length?(c=m,d):c},function(m){return i=m,n=m(e),s=m(t),a=n===s?0:1/(s-n),d}}function wi(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Y_(){var e=vi(Dm()(Sn));return e.copy=function(){return wi(e,Y_())},za.apply(e,arguments)}function V_(){var e=C0(Dm()).domain([1,10]);return e.copy=function(){return wi(e,V_()).base(e.base())},za.apply(e,arguments)}function G_(){var e=k0(Dm());return e.copy=function(){return wi(e,G_()).constant(e.constant())},za.apply(e,arguments)}function L0(){var e=S0(Dm());return e.copy=function(){return wi(e,L0()).exponent(e.exponent())},za.apply(e,arguments)}function XW(){return L0.apply(null,arguments).exponent(.5)}function K_(){var e=[],t=Sn;function n(s){if(s!=null&&!isNaN(s=+s))return t((Ac(e,s,1)-1)/(e.length-1))}return n.domain=function(s){if(!arguments.length)return e.slice();e=[];for(let a of s)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(li),n},n.interpolator=function(s){return arguments.length?(t=s,n):t},n.range=function(){return e.map((s,a)=>t(a/(e.length-1)))},n.quantiles=function(s){return Array.from({length:s+1},(a,i)=>Iq(e,i/s))},n.copy=function(){return K_(t).domain(e)},za.apply(n,arguments)}function Tm(){var e=0,t=.5,n=1,s=1,a,i,l,o,c,d=Sn,u,m=!1,p;function f(g){return isNaN(g=+g)?p:(g=.5+((g=+u(g))-i)*(s*g<s*i?o:c),d(m?Math.max(0,Math.min(1,g)):g))}f.domain=function(g){return arguments.length?([e,t,n]=g,a=u(e=+e),i=u(t=+t),l=u(n=+n),o=a===i?0:.5/(i-a),c=i===l?0:.5/(l-i),s=i<a?-1:1,f):[e,t,n]},f.clamp=function(g){return arguments.length?(m=!!g,f):m},f.interpolator=function(g){return arguments.length?(d=g,f):d};function y(g){return function(x){var b,v,w;return arguments.length?([b,v,w]=x,d=oH(g,[b,v,w]),f):[d(0),d(.5),d(1)]}}return f.range=y(io),f.rangeRound=y(v0),f.unknown=function(g){return arguments.length?(p=g,f):p},function(g){return u=g,a=g(e),i=g(t),l=g(n),o=a===i?0:.5/(i-a),c=i===l?0:.5/(l-i),s=i<a?-1:1,f}}function X_(){var e=vi(Tm()(Sn));return e.copy=function(){return wi(e,X_())},za.apply(e,arguments)}function J_(){var e=C0(Tm()).domain([.1,1,10]);return e.copy=function(){return wi(e,J_()).base(e.base())},za.apply(e,arguments)}function Q_(){var e=k0(Tm());return e.copy=function(){return wi(e,Q_()).constant(e.constant())},za.apply(e,arguments)}function R0(){var e=S0(Tm());return e.copy=function(){return wi(e,R0()).exponent(e.exponent())},za.apply(e,arguments)}function JW(){return R0.apply(null,arguments).exponent(.5)}const Bo=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:x0,scaleDiverging:X_,scaleDivergingLog:J_,scaleDivergingPow:R0,scaleDivergingSqrt:JW,scaleDivergingSymlog:Q_,scaleIdentity:T_,scaleImplicit:kg,scaleLinear:D_,scaleLog:P_,scaleOrdinal:g0,scalePoint:$q,scalePow:_0,scaleQuantile:I_,scaleQuantize:L_,scaleRadial:M_,scaleSequential:Y_,scaleSequentialLog:V_,scaleSequentialPow:L0,scaleSequentialQuantile:K_,scaleSequentialSqrt:XW,scaleSequentialSymlog:G_,scaleSqrt:AH,scaleSymlog:O_,scaleThreshold:R_,scaleTime:GW,scaleUtc:KW,tickFormat:E_},Symbol.toStringTag,{value:"Module"}));var cl=e=>e.chartData,$0=ve([cl],e=>{var t=e.chartData!=null?e.chartData.length-1:0;return{chartData:e.chartData,computedData:e.computedData,dataEndIndex:t,dataStartIndex:0}}),F0=(e,t,n,s)=>s?$0(e):cl(e);function Kl(e){if(Array.isArray(e)&&e.length===2){var[t,n]=e;if(ss(t)&&ss(n))return!0}return!1}function zN(e,t,n){return n?e:[Math.min(e[0],t[0]),Math.max(e[1],t[1])]}function QW(e,t){if(t&&typeof e!="function"&&Array.isArray(e)&&e.length===2){var[n,s]=e,a,i;if(ss(n))a=n;else if(typeof n=="function")return;if(ss(s))i=s;else if(typeof s=="function")return;var l=[a,i];if(Kl(l))return l}}function ZW(e,t,n){if(!(!n&&t==null)){if(typeof e=="function"&&t!=null)try{var s=e(t,n);if(Kl(s))return zN(s,t,n)}catch{}if(Array.isArray(e)&&e.length===2){var[a,i]=e,l,o;if(a==="auto")t!=null&&(l=Math.min(...t));else if(et(a))l=a;else if(typeof a=="function")try{t!=null&&(l=a(t==null?void 0:t[0]))}catch{}else if(typeof a=="string"&&_j.test(a)){var c=_j.exec(a);if(c==null||t==null)l=void 0;else{var d=+c[1];l=t[0]-d}}else l=t==null?void 0:t[0];if(i==="auto")t!=null&&(o=Math.max(...t));else if(et(i))o=i;else if(typeof i=="function")try{t!=null&&(o=i(t==null?void 0:t[1]))}catch{}else if(typeof i=="string"&&Ej.test(i)){var u=Ej.exec(i);if(u==null||t==null)o=void 0;else{var m=+u[1];o=t[1]+m}}else o=t==null?void 0:t[1];var p=[l,o];if(Kl(p))return t==null?p:zN(p,t,n)}}}var lo=1e9,eY={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},B0,jr=!0,Cs="[DecimalError] ",Hi=Cs+"Invalid argument: ",z0=Cs+"Exponent out of range: ",oo=Math.floor,Ai=Math.pow,tY=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Qn,nn=1e7,xr=7,Z_=9007199254740991,Iu=oo(Z_/xr),rt={};rt.absoluteValue=rt.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};rt.comparedTo=rt.cmp=function(e){var t,n,s,a,i=this;if(e=new i.constructor(e),i.s!==e.s)return i.s||-e.s;if(i.e!==e.e)return i.e>e.e^i.s<0?1:-1;for(s=i.d.length,a=e.d.length,t=0,n=s<a?s:a;t<n;++t)if(i.d[t]!==e.d[t])return i.d[t]>e.d[t]^i.s<0?1:-1;return s===a?0:s>a^i.s<0?1:-1};rt.decimalPlaces=rt.dp=function(){var e=this,t=e.d.length-1,n=(t-e.e)*xr;if(t=e.d[t],t)for(;t%10==0;t/=10)n--;return n<0?0:n};rt.dividedBy=rt.div=function(e){return _a(this,new this.constructor(e))};rt.dividedToIntegerBy=rt.idiv=function(e){var t=this,n=t.constructor;return ur(_a(t,new n(e),0,1),n.precision)};rt.equals=rt.eq=function(e){return!this.cmp(e)};rt.exponent=function(){return Wr(this)};rt.greaterThan=rt.gt=function(e){return this.cmp(e)>0};rt.greaterThanOrEqualTo=rt.gte=function(e){return this.cmp(e)>=0};rt.isInteger=rt.isint=function(){return this.e>this.d.length-2};rt.isNegative=rt.isneg=function(){return this.s<0};rt.isPositive=rt.ispos=function(){return this.s>0};rt.isZero=function(){return this.s===0};rt.lessThan=rt.lt=function(e){return this.cmp(e)<0};rt.lessThanOrEqualTo=rt.lte=function(e){return this.cmp(e)<1};rt.logarithm=rt.log=function(e){var t,n=this,s=n.constructor,a=s.precision,i=a+5;if(e===void 0)e=new s(10);else if(e=new s(e),e.s<1||e.eq(Qn))throw Error(Cs+"NaN");if(n.s<1)throw Error(Cs+(n.s?"NaN":"-Infinity"));return n.eq(Qn)?new s(0):(jr=!1,t=_a(dc(n,i),dc(e,i),i),jr=!0,ur(t,a))};rt.minus=rt.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?rE(t,e):eE(t,(e.s=-e.s,e))};rt.modulo=rt.mod=function(e){var t,n=this,s=n.constructor,a=s.precision;if(e=new s(e),!e.s)throw Error(Cs+"NaN");return n.s?(jr=!1,t=_a(n,e,0,1).times(e),jr=!0,n.minus(t)):ur(new s(n),a)};rt.naturalExponential=rt.exp=function(){return tE(this)};rt.naturalLogarithm=rt.ln=function(){return dc(this)};rt.negated=rt.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};rt.plus=rt.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?eE(t,e):rE(t,(e.s=-e.s,e))};rt.precision=rt.sd=function(e){var t,n,s,a=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Hi+e);if(t=Wr(a)+1,s=a.d.length-1,n=s*xr+1,s=a.d[s],s){for(;s%10==0;s/=10)n--;for(s=a.d[0];s>=10;s/=10)n++}return e&&t>n?t:n};rt.squareRoot=rt.sqrt=function(){var e,t,n,s,a,i,l,o=this,c=o.constructor;if(o.s<1){if(!o.s)return new c(0);throw Error(Cs+"NaN")}for(e=Wr(o),jr=!1,a=Math.sqrt(+o),a==0||a==1/0?(t=Js(o.d),(t.length+e)%2==0&&(t+="0"),a=Math.sqrt(t),e=oo((e+1)/2)-(e<0||e%2),a==1/0?t="5e"+e:(t=a.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),s=new c(t)):s=new c(a.toString()),n=c.precision,a=l=n+3;;)if(i=s,s=i.plus(_a(o,i,l+2)).times(.5),Js(i.d).slice(0,l)===(t=Js(s.d)).slice(0,l)){if(t=t.slice(l-3,l+1),a==l&&t=="4999"){if(ur(i,n+1,0),i.times(i).eq(o)){s=i;break}}else if(t!="9999")break;l+=4}return jr=!0,ur(s,n)};rt.times=rt.mul=function(e){var t,n,s,a,i,l,o,c,d,u=this,m=u.constructor,p=u.d,f=(e=new m(e)).d;if(!u.s||!e.s)return new m(0);for(e.s*=u.s,n=u.e+e.e,c=p.length,d=f.length,c<d&&(i=p,p=f,f=i,l=c,c=d,d=l),i=[],l=c+d,s=l;s--;)i.push(0);for(s=d;--s>=0;){for(t=0,a=c+s;a>s;)o=i[a]+f[s]*p[a-s-1]+t,i[a--]=o%nn|0,t=o/nn|0;i[a]=(i[a]+t)%nn|0}for(;!i[--l];)i.pop();return t?++n:i.shift(),e.d=i,e.e=n,jr?ur(e,m.precision):e};rt.toDecimalPlaces=rt.todp=function(e,t){var n=this,s=n.constructor;return n=new s(n),e===void 0?n:(la(e,0,lo),t===void 0?t=s.rounding:la(t,0,8),ur(n,e+Wr(n)+1,t))};rt.toExponential=function(e,t){var n,s=this,a=s.constructor;return e===void 0?n=tl(s,!0):(la(e,0,lo),t===void 0?t=a.rounding:la(t,0,8),s=ur(new a(s),e+1,t),n=tl(s,!0,e+1)),n};rt.toFixed=function(e,t){var n,s,a=this,i=a.constructor;return e===void 0?tl(a):(la(e,0,lo),t===void 0?t=i.rounding:la(t,0,8),s=ur(new i(a),e+Wr(a)+1,t),n=tl(s.abs(),!1,e+Wr(s)+1),a.isneg()&&!a.isZero()?"-"+n:n)};rt.toInteger=rt.toint=function(){var e=this,t=e.constructor;return ur(new t(e),Wr(e)+1,t.rounding)};rt.toNumber=function(){return+this};rt.toPower=rt.pow=function(e){var t,n,s,a,i,l,o=this,c=o.constructor,d=12,u=+(e=new c(e));if(!e.s)return new c(Qn);if(o=new c(o),!o.s){if(e.s<1)throw Error(Cs+"Infinity");return o}if(o.eq(Qn))return o;if(s=c.precision,e.eq(Qn))return ur(o,s);if(t=e.e,n=e.d.length-1,l=t>=n,i=o.s,l){if((n=u<0?-u:u)<=Z_){for(a=new c(Qn),t=Math.ceil(s/xr+4),jr=!1;n%2&&(a=a.times(o),UN(a.d,t)),n=oo(n/2),n!==0;)o=o.times(o),UN(o.d,t);return jr=!0,e.s<0?new c(Qn).div(a):ur(a,s)}}else if(i<0)throw Error(Cs+"NaN");return i=i<0&&e.d[Math.max(t,n)]&1?-1:1,o.s=1,jr=!1,a=e.times(dc(o,s+d)),jr=!0,a=tE(a),a.s=i,a};rt.toPrecision=function(e,t){var n,s,a=this,i=a.constructor;return e===void 0?(n=Wr(a),s=tl(a,n<=i.toExpNeg||n>=i.toExpPos)):(la(e,1,lo),t===void 0?t=i.rounding:la(t,0,8),a=ur(new i(a),e,t),n=Wr(a),s=tl(a,e<=n||n<=i.toExpNeg,e)),s};rt.toSignificantDigits=rt.tosd=function(e,t){var n=this,s=n.constructor;return e===void 0?(e=s.precision,t=s.rounding):(la(e,1,lo),t===void 0?t=s.rounding:la(t,0,8)),ur(new s(n),e,t)};rt.toString=rt.valueOf=rt.val=rt.toJSON=rt[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Wr(e),n=e.constructor;return tl(e,t<=n.toExpNeg||t>=n.toExpPos)};function eE(e,t){var n,s,a,i,l,o,c,d,u=e.constructor,m=u.precision;if(!e.s||!t.s)return t.s||(t=new u(e)),jr?ur(t,m):t;if(c=e.d,d=t.d,l=e.e,a=t.e,c=c.slice(),i=l-a,i){for(i<0?(s=c,i=-i,o=d.length):(s=d,a=l,o=c.length),l=Math.ceil(m/xr),o=l>o?l+1:o+1,i>o&&(i=o,s.length=1),s.reverse();i--;)s.push(0);s.reverse()}for(o=c.length,i=d.length,o-i<0&&(i=o,s=d,d=c,c=s),n=0;i;)n=(c[--i]=c[i]+d[i]+n)/nn|0,c[i]%=nn;for(n&&(c.unshift(n),++a),o=c.length;c[--o]==0;)c.pop();return t.d=c,t.e=a,jr?ur(t,m):t}function la(e,t,n){if(e!==~~e||e<t||e>n)throw Error(Hi+e)}function Js(e){var t,n,s,a=e.length-1,i="",l=e[0];if(a>0){for(i+=l,t=1;t<a;t++)s=e[t]+"",n=xr-s.length,n&&(i+=Ja(n)),i+=s;l=e[t],s=l+"",n=xr-s.length,n&&(i+=Ja(n))}else if(l===0)return"0";for(;l%10===0;)l/=10;return i+l}var _a=function(){function e(s,a){var i,l=0,o=s.length;for(s=s.slice();o--;)i=s[o]*a+l,s[o]=i%nn|0,l=i/nn|0;return l&&s.unshift(l),s}function t(s,a,i,l){var o,c;if(i!=l)c=i>l?1:-1;else for(o=c=0;o<i;o++)if(s[o]!=a[o]){c=s[o]>a[o]?1:-1;break}return c}function n(s,a,i){for(var l=0;i--;)s[i]-=l,l=s[i]<a[i]?1:0,s[i]=l*nn+s[i]-a[i];for(;!s[0]&&s.length>1;)s.shift()}return function(s,a,i,l){var o,c,d,u,m,p,f,y,g,x,b,v,w,N,k,j,S,_,C=s.constructor,D=s.s==a.s?1:-1,A=s.d,E=a.d;if(!s.s)return new C(s);if(!a.s)throw Error(Cs+"Division by zero");for(c=s.e-a.e,S=E.length,k=A.length,f=new C(D),y=f.d=[],d=0;E[d]==(A[d]||0);)++d;if(E[d]>(A[d]||0)&&--c,i==null?v=i=C.precision:l?v=i+(Wr(s)-Wr(a))+1:v=i,v<0)return new C(0);if(v=v/xr+2|0,d=0,S==1)for(u=0,E=E[0],v++;(d<k||u)&&v--;d++)w=u*nn+(A[d]||0),y[d]=w/E|0,u=w%E|0;else{for(u=nn/(E[0]+1)|0,u>1&&(E=e(E,u),A=e(A,u),S=E.length,k=A.length),N=S,g=A.slice(0,S),x=g.length;x<S;)g[x++]=0;_=E.slice(),_.unshift(0),j=E[0],E[1]>=nn/2&&++j;do u=0,o=t(E,g,S,x),o<0?(b=g[0],S!=x&&(b=b*nn+(g[1]||0)),u=b/j|0,u>1?(u>=nn&&(u=nn-1),m=e(E,u),p=m.length,x=g.length,o=t(m,g,p,x),o==1&&(u--,n(m,S<p?_:E,p))):(u==0&&(o=u=1),m=E.slice()),p=m.length,p<x&&m.unshift(0),n(g,m,x),o==-1&&(x=g.length,o=t(E,g,S,x),o<1&&(u++,n(g,S<x?_:E,x))),x=g.length):o===0&&(u++,g=[0]),y[d++]=u,o&&g[0]?g[x++]=A[N]||0:(g=[A[N]],x=1);while((N++<k||g[0]!==void 0)&&v--)}return y[0]||y.shift(),f.e=c,ur(f,l?i+Wr(f)+1:i)}}();function tE(e,t){var n,s,a,i,l,o,c=0,d=0,u=e.constructor,m=u.precision;if(Wr(e)>16)throw Error(z0+Wr(e));if(!e.s)return new u(Qn);for(jr=!1,o=m,l=new u(.03125);e.abs().gte(.1);)e=e.times(l),d+=5;for(s=Math.log(Ai(2,d))/Math.LN10*2+5|0,o+=s,n=a=i=new u(Qn),u.precision=o;;){if(a=ur(a.times(e),o),n=n.times(++c),l=i.plus(_a(a,n,o)),Js(l.d).slice(0,o)===Js(i.d).slice(0,o)){for(;d--;)i=ur(i.times(i),o);return u.precision=m,t==null?(jr=!0,ur(i,m)):i}i=l}}function Wr(e){for(var t=e.e*xr,n=e.d[0];n>=10;n/=10)t++;return t}function Xp(e,t,n){if(t>e.LN10.sd())throw jr=!0,n&&(e.precision=n),Error(Cs+"LN10 precision limit exceeded");return ur(new e(e.LN10),t)}function Ja(e){for(var t="";e--;)t+="0";return t}function dc(e,t){var n,s,a,i,l,o,c,d,u,m=1,p=10,f=e,y=f.d,g=f.constructor,x=g.precision;if(f.s<1)throw Error(Cs+(f.s?"NaN":"-Infinity"));if(f.eq(Qn))return new g(0);if(t==null?(jr=!1,d=x):d=t,f.eq(10))return t==null&&(jr=!0),Xp(g,d);if(d+=p,g.precision=d,n=Js(y),s=n.charAt(0),i=Wr(f),Math.abs(i)<15e14){for(;s<7&&s!=1||s==1&&n.charAt(1)>3;)f=f.times(e),n=Js(f.d),s=n.charAt(0),m++;i=Wr(f),s>1?(f=new g("0."+n),i++):f=new g(s+"."+n.slice(1))}else return c=Xp(g,d+2,x).times(i+""),f=dc(new g(s+"."+n.slice(1)),d-p).plus(c),g.precision=x,t==null?(jr=!0,ur(f,x)):f;for(o=l=f=_a(f.minus(Qn),f.plus(Qn),d),u=ur(f.times(f),d),a=3;;){if(l=ur(l.times(u),d),c=o.plus(_a(l,new g(a),d)),Js(c.d).slice(0,d)===Js(o.d).slice(0,d))return o=o.times(2),i!==0&&(o=o.plus(Xp(g,d+2,x).times(i+""))),o=_a(o,new g(m),d),g.precision=x,t==null?(jr=!0,ur(o,x)):o;o=c,a+=2}}function BN(e,t){var n,s,a;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(s=t.search(/e/i))>0?(n<0&&(n=s),n+=+t.slice(s+1),t=t.substring(0,s)):n<0&&(n=t.length),s=0;t.charCodeAt(s)===48;)++s;for(a=t.length;t.charCodeAt(a-1)===48;)--a;if(t=t.slice(s,a),t){if(a-=s,n=n-s-1,e.e=oo(n/xr),e.d=[],s=(n+1)%xr,n<0&&(s+=xr),s<a){for(s&&e.d.push(+t.slice(0,s)),a-=xr;s<a;)e.d.push(+t.slice(s,s+=xr));t=t.slice(s),s=xr-t.length}else s-=a;for(;s--;)t+="0";if(e.d.push(+t),jr&&(e.e>Iu||e.e<-Iu))throw Error(z0+n)}else e.s=0,e.e=0,e.d=[0];return e}function ur(e,t,n){var s,a,i,l,o,c,d,u,m=e.d;for(l=1,i=m[0];i>=10;i/=10)l++;if(s=t-l,s<0)s+=xr,a=t,d=m[u=0];else{if(u=Math.ceil((s+1)/xr),i=m.length,u>=i)return e;for(d=i=m[u],l=1;i>=10;i/=10)l++;s%=xr,a=s-xr+l}if(n!==void 0&&(i=Ai(10,l-a-1),o=d/i%10|0,c=t<0||m[u+1]!==void 0||d%i,c=n<4?(o||c)&&(n==0||n==(e.s<0?3:2)):o>5||o==5&&(n==4||c||n==6&&(s>0?a>0?d/Ai(10,l-a):0:m[u-1])%10&1||n==(e.s<0?8:7))),t<1||!m[0])return c?(i=Wr(e),m.length=1,t=t-i-1,m[0]=Ai(10,(xr-t%xr)%xr),e.e=oo(-t/xr)||0):(m.length=1,m[0]=e.e=e.s=0),e;if(s==0?(m.length=u,i=1,u--):(m.length=u+1,i=Ai(10,xr-s),m[u]=a>0?(d/Ai(10,l-a)%Ai(10,a)|0)*i:0),c)for(;;)if(u==0){(m[0]+=i)==nn&&(m[0]=1,++e.e);break}else{if(m[u]+=i,m[u]!=nn)break;m[u--]=0,i=1}for(s=m.length;m[--s]===0;)m.pop();if(jr&&(e.e>Iu||e.e<-Iu))throw Error(z0+Wr(e));return e}function rE(e,t){var n,s,a,i,l,o,c,d,u,m,p=e.constructor,f=p.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new p(e),jr?ur(t,f):t;if(c=e.d,m=t.d,s=t.e,d=e.e,c=c.slice(),l=d-s,l){for(u=l<0,u?(n=c,l=-l,o=m.length):(n=m,s=d,o=c.length),a=Math.max(Math.ceil(f/xr),o)+2,l>a&&(l=a,n.length=1),n.reverse(),a=l;a--;)n.push(0);n.reverse()}else{for(a=c.length,o=m.length,u=a<o,u&&(o=a),a=0;a<o;a++)if(c[a]!=m[a]){u=c[a]<m[a];break}l=0}for(u&&(n=c,c=m,m=n,t.s=-t.s),o=c.length,a=m.length-o;a>0;--a)c[o++]=0;for(a=m.length;a>l;){if(c[--a]<m[a]){for(i=a;i&&c[--i]===0;)c[i]=nn-1;--c[i],c[a]+=nn}c[a]-=m[a]}for(;c[--o]===0;)c.pop();for(;c[0]===0;c.shift())--s;return c[0]?(t.d=c,t.e=s,jr?ur(t,f):t):new p(0)}function tl(e,t,n){var s,a=Wr(e),i=Js(e.d),l=i.length;return t?(n&&(s=n-l)>0?i=i.charAt(0)+"."+i.slice(1)+Ja(s):l>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(a<0?"e":"e+")+a):a<0?(i="0."+Ja(-a-1)+i,n&&(s=n-l)>0&&(i+=Ja(s))):a>=l?(i+=Ja(a+1-l),n&&(s=n-a-1)>0&&(i=i+"."+Ja(s))):((s=a+1)<l&&(i=i.slice(0,s)+"."+i.slice(s)),n&&(s=n-l)>0&&(a+1===l&&(i+="."),i+=Ja(s))),e.s<0?"-"+i:i}function UN(e,t){if(e.length>t)return e.length=t,!0}function nE(e){var t,n,s;function a(i){var l=this;if(!(l instanceof a))return new a(i);if(l.constructor=a,i instanceof a){l.s=i.s,l.e=i.e,l.d=(i=i.d)?i.slice():i;return}if(typeof i=="number"){if(i*0!==0)throw Error(Hi+i);if(i>0)l.s=1;else if(i<0)i=-i,l.s=-1;else{l.s=0,l.e=0,l.d=[0];return}if(i===~~i&&i<1e7){l.e=0,l.d=[i];return}return BN(l,i.toString())}else if(typeof i!="string")throw Error(Hi+i);if(i.charCodeAt(0)===45?(i=i.slice(1),l.s=-1):l.s=1,tY.test(i))BN(l,i);else throw Error(Hi+i)}if(a.prototype=rt,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.clone=nE,a.config=a.set=rY,e===void 0&&(e={}),e)for(s=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<s.length;)e.hasOwnProperty(n=s[t++])||(e[n]=this[n]);return a.config(e),a}function rY(e){if(!e||typeof e!="object")throw Error(Cs+"Object expected");var t,n,s,a=["precision",1,lo,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<a.length;t+=3)if((s=e[n=a[t]])!==void 0)if(oo(s)===s&&s>=a[t+1]&&s<=a[t+2])this[n]=s;else throw Error(Hi+n+": "+s);if((s=e[n="LN10"])!==void 0)if(s==Math.LN10)this[n]=new this(s);else throw Error(Hi+n+": "+s);return this}var B0=nE(eY);Qn=new B0(1);const sr=B0;var nY=e=>e,sE={},aE=e=>e===sE,qN=e=>function t(){return arguments.length===0||arguments.length===1&&aE(arguments.length<=0?void 0:arguments[0])?t:e(...arguments)},iE=(e,t)=>e===1?t:qN(function(){for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];var i=s.filter(l=>l!==sE).length;return i>=e?t(...s):iE(e-i,qN(function(){for(var l=arguments.length,o=new Array(l),c=0;c<l;c++)o[c]=arguments[c];var d=s.map(u=>aE(u)?o.shift():u);return t(...d,...o)}))}),Am=e=>iE(e.length,e),Dg=(e,t)=>{for(var n=[],s=e;s<t;++s)n[s-e]=s;return n},sY=Am((e,t)=>Array.isArray(t)?t.map(e):Object.keys(t).map(n=>t[n]).map(e)),aY=function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];if(!n.length)return nY;var a=n.reverse(),i=a[0],l=a.slice(1);return function(){return l.reduce((o,c)=>c(o),i(...arguments))}},Tg=e=>Array.isArray(e)?e.reverse():e.split("").reverse().join(""),lE=e=>{var t=null,n=null;return function(){for(var s=arguments.length,a=new Array(s),i=0;i<s;i++)a[i]=arguments[i];return t&&a.every((l,o)=>{var c;return l===((c=t)===null||c===void 0?void 0:c[o])})||(t=a,n=e(...a)),n}};function oE(e){var t;return e===0?t=1:t=Math.floor(new sr(e).abs().log(10).toNumber())+1,t}function cE(e,t,n){for(var s=new sr(e),a=0,i=[];s.lt(t)&&a<1e5;)i.push(s.toNumber()),s=s.add(n),a++;return i}Am((e,t,n)=>{var s=+e,a=+t;return s+n*(a-s)});Am((e,t,n)=>{var s=t-+e;return s=s||1/0,(n-e)/s});Am((e,t,n)=>{var s=t-+e;return s=s||1/0,Math.max(0,Math.min(1,(n-e)/s))});var dE=e=>{var[t,n]=e,[s,a]=[t,n];return t>n&&([s,a]=[n,t]),[s,a]},uE=(e,t,n)=>{if(e.lte(0))return new sr(0);var s=oE(e.toNumber()),a=new sr(10).pow(s),i=e.div(a),l=s!==1?.05:.1,o=new sr(Math.ceil(i.div(l).toNumber())).add(n).mul(l),c=o.mul(a);return t?new sr(c.toNumber()):new sr(Math.ceil(c.toNumber()))},iY=(e,t,n)=>{var s=new sr(1),a=new sr(e);if(!a.isint()&&n){var i=Math.abs(e);i<1?(s=new sr(10).pow(oE(e)-1),a=new sr(Math.floor(a.div(s).toNumber())).mul(s)):i>1&&(a=new sr(Math.floor(e)))}else e===0?a=new sr(Math.floor((t-1)/2)):n||(a=new sr(Math.floor(e)));var l=Math.floor((t-1)/2),o=aY(sY(c=>a.add(new sr(c-l).mul(s)).toNumber()),Dg);return o(0,t)},mE=function(t,n,s,a){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((n-t)/(s-1)))return{step:new sr(0),tickMin:new sr(0),tickMax:new sr(0)};var l=uE(new sr(n).sub(t).div(s-1),a,i),o;t<=0&&n>=0?o=new sr(0):(o=new sr(t).add(n).div(2),o=o.sub(new sr(o).mod(l)));var c=Math.ceil(o.sub(t).div(l).toNumber()),d=Math.ceil(new sr(n).sub(o).div(l).toNumber()),u=c+d+1;return u>s?mE(t,n,s,a,i+1):(u<s&&(d=n>0?d+(s-u):d,c=n>0?c:c+(s-u)),{step:l,tickMin:o.sub(new sr(c).mul(l)),tickMax:o.add(new sr(d).mul(l))})};function lY(e){var[t,n]=e,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=Math.max(s,2),[l,o]=dE([t,n]);if(l===-1/0||o===1/0){var c=o===1/0?[l,...Dg(0,s-1).map(()=>1/0)]:[...Dg(0,s-1).map(()=>-1/0),o];return t>n?Tg(c):c}if(l===o)return iY(l,s,a);var{step:d,tickMin:u,tickMax:m}=mE(l,o,i,a,0),p=cE(u,m.add(new sr(.1).mul(d)),d);return t>n?Tg(p):p}function oY(e,t){var[n,s]=e,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,[i,l]=dE([n,s]);if(i===-1/0||l===1/0)return[n,s];if(i===l)return[i];var o=Math.max(t,2),c=uE(new sr(l).sub(i).div(o-1),a,0),d=[...cE(new sr(i),new sr(l),c),l];return a===!1&&(d=d.map(u=>Math.round(u))),n>s?Tg(d):d}var cY=lE(lY),dY=lE(oY),hE=e=>e.rootProps.maxBarSize,uY=e=>e.rootProps.barGap,pE=e=>e.rootProps.barCategoryGap,mY=e=>e.rootProps.barSize,Ic=e=>e.rootProps.stackOffset,U0=e=>e.options.chartName,q0=e=>e.rootProps.syncId,fE=e=>e.rootProps.syncMethod,H0=e=>e.options.eventEmitter,fa={allowDuplicatedCategory:!0,angleAxisId:0,reversed:!1,scale:"auto",tick:!0,type:"category"},Xn={allowDataOverflow:!1,allowDuplicatedCategory:!0,radiusAxisId:0,scale:"auto",tick:!0,tickCount:5,type:"number"},Pm=(e,t)=>{if(!(!e||!t))return e!=null&&e.reversed?[t[1],t[0]]:t},hY={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!1,dataKey:void 0,domain:void 0,id:fa.angleAxisId,includeHidden:!1,name:void 0,reversed:fa.reversed,scale:fa.scale,tick:fa.tick,tickCount:void 0,ticks:void 0,type:fa.type,unit:void 0},pY={allowDataOverflow:Xn.allowDataOverflow,allowDecimals:!1,allowDuplicatedCategory:Xn.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:Xn.radiusAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:Xn.scale,tick:Xn.tick,tickCount:Xn.tickCount,ticks:void 0,type:Xn.type,unit:void 0},fY={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:fa.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:fa.angleAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:fa.scale,tick:fa.tick,tickCount:void 0,ticks:void 0,type:"number",unit:void 0},gY={allowDataOverflow:Xn.allowDataOverflow,allowDecimals:!1,allowDuplicatedCategory:Xn.allowDuplicatedCategory,dataKey:void 0,domain:void 0,id:Xn.radiusAxisId,includeHidden:!1,name:void 0,reversed:!1,scale:Xn.scale,tick:Xn.tick,tickCount:Xn.tickCount,ticks:void 0,type:"category",unit:void 0},W0=(e,t)=>e.polarAxis.angleAxis[t]!=null?e.polarAxis.angleAxis[t]:e.layout.layoutType==="radial"?fY:hY,Y0=(e,t)=>e.polarAxis.radiusAxis[t]!=null?e.polarAxis.radiusAxis[t]:e.layout.layoutType==="radial"?gY:pY,Om=e=>e.polarOptions,V0=ve([$a,Fa,Zr],Q2),gE=ve([Om,V0],(e,t)=>{if(e!=null)return En(e.innerRadius,t,0)}),xE=ve([Om,V0],(e,t)=>{if(e!=null)return En(e.outerRadius,t,t*.8)}),xY=e=>{if(e==null)return[0,0];var{startAngle:t,endAngle:n}=e;return[t,n]},yE=ve([Om],xY);ve([W0,yE],Pm);var bE=ve([V0,gE,xE],(e,t,n)=>{if(!(e==null||t==null||n==null))return[t,n]});ve([Y0,bE],Pm);var yY=ve([Qt,Om,gE,xE,$a,Fa],(e,t,n,s,a,i)=>{if(!(e!=="centric"&&e!=="radial"||t==null||n==null||s==null)){var{cx:l,cy:o,startAngle:c,endAngle:d}=t;return{cx:En(l,a,a/2),cy:En(o,i,i/2),innerRadius:n,outerRadius:s,startAngle:c,endAngle:d,clockWise:!1}}}),Ir=(e,t)=>t,Lc=(e,t,n)=>n;function HN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Lu(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?HN(Object(n),!0).forEach(function(s){bY(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HN(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function bY(e,t,n){return(t=vY(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vY(e){var t=wY(e,"string");return typeof t=="symbol"?t:t+""}function wY(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ag=[0,"auto"],Gn={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:void 0,height:30,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"bottom",padding:{left:0,right:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"category",unit:void 0},ha=(e,t)=>{var n=e.cartesianAxis.xAxis[t];return n??Gn},Kn={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:Ag,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"left",padding:{top:0,bottom:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"number",unit:void 0,width:vm},Ba=(e,t)=>{var n=e.cartesianAxis.yAxis[t];return n??Kn},jY={domain:[0,"auto"],includeHidden:!1,reversed:!1,allowDataOverflow:!1,allowDuplicatedCategory:!1,dataKey:void 0,id:0,name:"",range:[64,64],scale:"auto",type:"number",unit:""},G0=(e,t)=>{var n=e.cartesianAxis.zAxis[t];return n??jY},Lr=(e,t,n)=>{switch(t){case"xAxis":return ha(e,n);case"yAxis":return Ba(e,n);case"zAxis":return G0(e,n);case"angleAxis":return W0(e,n);case"radiusAxis":return Y0(e,n);default:throw new Error("Unexpected axis type: ".concat(t))}},NY=(e,t,n)=>{switch(t){case"xAxis":return ha(e,n);case"yAxis":return Ba(e,n);default:throw new Error("Unexpected axis type: ".concat(t))}},Rc=(e,t,n)=>{switch(t){case"xAxis":return ha(e,n);case"yAxis":return Ba(e,n);case"angleAxis":return W0(e,n);case"radiusAxis":return Y0(e,n);default:throw new Error("Unexpected axis type: ".concat(t))}},vE=e=>e.graphicalItems.countOfBars>0;function K0(e,t){return n=>{switch(e){case"xAxis":return"xAxisId"in n&&n.xAxisId===t;case"yAxis":return"yAxisId"in n&&n.yAxisId===t;case"zAxis":return"zAxisId"in n&&n.zAxisId===t;case"angleAxis":return"angleAxisId"in n&&n.angleAxisId===t;case"radiusAxis":return"radiusAxisId"in n&&n.radiusAxisId===t;default:return!1}}}var Mm=e=>e.graphicalItems.cartesianItems,CY=ve([Ir,Lc],K0),X0=(e,t,n)=>e.filter(n).filter(s=>(t==null?void 0:t.includeHidden)===!0?!0:!s.hide),$c=ve([Mm,Lr,CY],X0),wE=e=>e.filter(t=>t.stackId===void 0),kY=ve([$c],wE),J0=e=>e.map(t=>t.data).filter(Boolean).flat(1),SY=ve([$c],J0),Q0=(e,t)=>{var{chartData:n=[],dataStartIndex:s,dataEndIndex:a}=t;return e.length>0?e:n.slice(s,a+1)},Im=ve([SY,F0],Q0),Z0=(e,t,n)=>(t==null?void 0:t.dataKey)!=null?e.map(s=>({value:yr(s,t.dataKey)})):n.length>0?n.map(s=>s.dataKey).flatMap(s=>e.map(a=>({value:yr(a,s)}))):e.map(s=>({value:s})),Lm=ve([Im,Lr,$c],Z0);function jE(e,t){switch(e){case"xAxis":return t.direction==="x";case"yAxis":return t.direction==="y";default:return!1}}function dl(e){return e.filter(t=>js(t)||t instanceof Date).map(Number).filter(t=>Tn(t)===!1)}function _Y(e,t,n){return!n||typeof t!="number"||Tn(t)?[]:n.length?dl(n.flatMap(s=>{var a=yr(e,s.dataKey),i,l;if(Array.isArray(a)?[i,l]=a:i=l=a,!(!ss(i)||!ss(l)))return[t-i,t+l]})):[]}var NE=(e,t,n)=>{var s={},a=t.reduce((i,l)=>(l.stackId==null||(i[l.stackId]==null&&(i[l.stackId]=[]),i[l.stackId].push(l)),i),s);return Object.fromEntries(Object.entries(a).map(i=>{var[l,o]=i,c=o.map(d=>d.dataKey);return[l,{stackedData:_U(e,c,n),graphicalItems:o}]}))},Pg=ve([Im,$c,Ic],NE),CE=(e,t,n)=>{var{dataStartIndex:s,dataEndIndex:a}=t;if(n!=="zAxis"){var i=AU(e,s,a);if(!(i!=null&&i[0]===0&&i[1]===0))return i}},EY=ve([Pg,cl,Ir],CE),kE=(e,t,n,s)=>n.length>0?e.flatMap(a=>n.flatMap(i=>{var l,o,c=(l=i.errorBars)===null||l===void 0?void 0:l.filter(u=>jE(s,u)),d=yr(a,(o=t.dataKey)!==null&&o!==void 0?o:i.dataKey);return{value:d,errorDomain:_Y(a,d,c)}})).filter(Boolean):(t==null?void 0:t.dataKey)!=null?e.map(a=>({value:yr(a,t.dataKey),errorDomain:[]})):e.map(a=>({value:a,errorDomain:[]})),DY=ve(Im,Lr,kY,Ir,kE);function TY(e){var{value:t}=e;if(js(t)||t instanceof Date)return t}var AY=e=>{var t=e.flatMap(s=>[s.value,s.errorDomain]).flat(1),n=dl(t);if(n.length!==0)return[Math.min(...n),Math.max(...n)]},PY=(e,t,n)=>{var s=e.map(TY).filter(a=>a!=null);return n&&(t.dataKey==null||t.allowDuplicatedCategory&&GS(s))?y_(0,e.length):t.allowDuplicatedCategory?s:Array.from(new Set(s))},ey=e=>{var t;if(e==null||!("domain"in e))return Ag;if(e.domain!=null)return e.domain;if(e.ticks!=null){if(e.type==="number"){var n=dl(e.ticks);return[Math.min(...n),Math.max(...n)]}if(e.type==="category")return e.ticks.map(String)}return(t=e==null?void 0:e.domain)!==null&&t!==void 0?t:Ag},ty=function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];var a=n.filter(Boolean);if(a.length!==0){var i=a.flat(),l=Math.min(...i),o=Math.max(...i);return[l,o]}},SE=e=>e.referenceElements.dots,co=(e,t,n)=>e.filter(s=>s.ifOverflow==="extendDomain").filter(s=>t==="xAxis"?s.xAxisId===n:s.yAxisId===n),OY=ve([SE,Ir,Lc],co),_E=e=>e.referenceElements.areas,MY=ve([_E,Ir,Lc],co),EE=e=>e.referenceElements.lines,IY=ve([EE,Ir,Lc],co),DE=(e,t)=>{var n=dl(e.map(s=>t==="xAxis"?s.x:s.y));if(n.length!==0)return[Math.min(...n),Math.max(...n)]},LY=ve(OY,Ir,DE),TE=(e,t)=>{var n=dl(e.flatMap(s=>[t==="xAxis"?s.x1:s.y1,t==="xAxis"?s.x2:s.y2]));if(n.length!==0)return[Math.min(...n),Math.max(...n)]},RY=ve([MY,Ir],TE),AE=(e,t)=>{var n=dl(e.map(s=>t==="xAxis"?s.x:s.y));if(n.length!==0)return[Math.min(...n),Math.max(...n)]},$Y=ve(IY,Ir,AE),FY=ve(LY,$Y,RY,(e,t,n)=>ty(e,n,t)),PE=ve([Lr],ey),ry=(e,t,n,s,a)=>{var i=QW(t,e.allowDataOverflow);return i??ZW(t,ty(n,a,AY(s)),e.allowDataOverflow)},zY=ve([Lr,PE,EY,DY,FY],ry),BY=[0,1],ny=(e,t,n,s,a,i,l)=>{if(!(e==null||n==null||n.length===0)){var{dataKey:o,type:c}=e,d=bi(t,i);return d&&o==null?y_(0,n.length):c==="category"?PY(s,e,d):a==="expand"?BY:l}},sy=ve([Lr,Qt,Im,Lm,Ic,Ir,zY],ny),OE=(e,t,n,s,a)=>{if(e!=null){var{scale:i,type:l}=e;if(i==="auto")return t==="radial"&&a==="radiusAxis"?"band":t==="radial"&&a==="angleAxis"?"linear":l==="category"&&s&&(s.indexOf("LineChart")>=0||s.indexOf("AreaChart")>=0||s.indexOf("ComposedChart")>=0&&!n)?"point":l==="category"?"band":"linear";if(typeof i=="string"){var o="scale".concat(_c(i));return o in Bo?o:"point"}}},uo=ve([Lr,Qt,vE,U0,Ir],OE);function UY(e){if(e!=null){if(e in Bo)return Bo[e]();var t="scale".concat(_c(e));if(t in Bo)return Bo[t]()}}function ay(e,t,n,s){if(!(n==null||s==null)){if(typeof e.scale=="function")return e.scale.copy().domain(n).range(s);var a=UY(t);if(a!=null){var i=a.domain(n).range(s);return jU(i),i}}}var iy=(e,t,n)=>{var s=ey(t);if(!(n!=="auto"&&n!=="linear")){if(t!=null&&t.tickCount&&Array.isArray(s)&&(s[0]==="auto"||s[1]==="auto")&&Kl(e))return cY(e,t.tickCount,t.allowDecimals);if(t!=null&&t.tickCount&&t.type==="number"&&Kl(e))return dY(e,t.tickCount,t.allowDecimals)}},ly=ve([sy,Rc,uo],iy),oy=(e,t,n,s)=>{if(s!=="angleAxis"&&(e==null?void 0:e.type)==="number"&&Kl(t)&&Array.isArray(n)&&n.length>0){var a=t[0],i=n[0],l=t[1],o=n[n.length-1];return[Math.min(a,i),Math.max(l,o)]}return t},qY=ve([Lr,sy,ly,Ir],oy),HY=ve(Lm,Lr,(e,t)=>{if(!(!t||t.type!=="number")){var n=1/0,s=Array.from(dl(e.map(o=>o.value))).sort((o,c)=>o-c);if(s.length<2)return 1/0;var a=s[s.length-1]-s[0];if(a===0)return 1/0;for(var i=0;i<s.length-1;i++){var l=s[i+1]-s[i];n=Math.min(n,l)}return n/a}}),ME=ve(HY,Qt,pE,Zr,(e,t,n,s)=>s,(e,t,n,s,a)=>{if(!ss(e))return 0;var i=t==="vertical"?s.height:s.width;if(a==="gap")return e*i/2;if(a==="no-gap"){var l=En(n,e*i),o=e*i/2;return o-l-(o-l)/i*l}return 0}),WY=(e,t)=>{var n=ha(e,t);return n==null||typeof n.padding!="string"?0:ME(e,"xAxis",t,n.padding)},YY=(e,t)=>{var n=Ba(e,t);return n==null||typeof n.padding!="string"?0:ME(e,"yAxis",t,n.padding)},VY=ve(ha,WY,(e,t)=>{var n,s;if(e==null)return{left:0,right:0};var{padding:a}=e;return typeof a=="string"?{left:t,right:t}:{left:((n=a.left)!==null&&n!==void 0?n:0)+t,right:((s=a.right)!==null&&s!==void 0?s:0)+t}}),GY=ve(Ba,YY,(e,t)=>{var n,s;if(e==null)return{top:0,bottom:0};var{padding:a}=e;return typeof a=="string"?{top:t,bottom:t}:{top:((n=a.top)!==null&&n!==void 0?n:0)+t,bottom:((s=a.bottom)!==null&&s!==void 0?s:0)+t}}),KY=ve([Zr,VY,jm,wm,(e,t,n)=>n],(e,t,n,s,a)=>{var{padding:i}=s;return a?[i.left,n.width-i.right]:[e.left+t.left,e.left+e.width-t.right]}),XY=ve([Zr,Qt,GY,jm,wm,(e,t,n)=>n],(e,t,n,s,a,i)=>{var{padding:l}=a;return i?[s.height-l.bottom,l.top]:t==="horizontal"?[e.top+e.height-n.bottom,e.top+n.top]:[e.top+n.top,e.top+e.height-n.bottom]}),Fc=(e,t,n,s)=>{var a;switch(t){case"xAxis":return KY(e,n,s);case"yAxis":return XY(e,n,s);case"zAxis":return(a=G0(e,n))===null||a===void 0?void 0:a.range;case"angleAxis":return yE(e);case"radiusAxis":return bE(e,n);default:return}},IE=ve([Lr,Fc],Pm),fi=ve([Lr,uo,qY,IE],ay);ve($c,Ir,(e,t)=>e.flatMap(n=>{var s;return(s=n.errorBars)!==null&&s!==void 0?s:[]}).filter(n=>jE(t,n)));function LE(e,t){return e.id<t.id?-1:e.id>t.id?1:0}var Rm=(e,t)=>t,$m=(e,t,n)=>n,JY=ve(o0,Rm,$m,(e,t,n)=>e.filter(s=>s.orientation===t).filter(s=>s.mirror===n).sort(LE)),QY=ve(c0,Rm,$m,(e,t,n)=>e.filter(s=>s.orientation===t).filter(s=>s.mirror===n).sort(LE)),RE=(e,t)=>({width:e.width,height:t.height}),ZY=(e,t)=>{var n=typeof t.width=="number"?t.width:vm;return{width:n,height:e.height}},$E=ve(Zr,ha,RE),eV=(e,t,n)=>{switch(t){case"top":return e.top;case"bottom":return n-e.bottom;default:return 0}},tV=(e,t,n)=>{switch(t){case"left":return e.left;case"right":return n-e.right;default:return 0}},rV=ve(Fa,Zr,JY,Rm,$m,(e,t,n,s,a)=>{var i={},l;return n.forEach(o=>{var c=RE(t,o);l==null&&(l=eV(t,s,e));var d=s==="top"&&!a||s==="bottom"&&a;i[o.id]=l-Number(d)*c.height,l+=(d?-1:1)*c.height}),i}),nV=ve($a,Zr,QY,Rm,$m,(e,t,n,s,a)=>{var i={},l;return n.forEach(o=>{var c=ZY(t,o);l==null&&(l=tV(t,s,e));var d=s==="left"&&!a||s==="right"&&a;i[o.id]=l-Number(d)*c.width,l+=(d?-1:1)*c.width}),i}),sV=(e,t)=>{var n=Zr(e),s=ha(e,t);if(s!=null){var a=rV(e,s.orientation,s.mirror),i=a[t];return i==null?{x:n.left,y:0}:{x:n.left,y:i}}},aV=(e,t)=>{var n=Zr(e),s=Ba(e,t);if(s!=null){var a=nV(e,s.orientation,s.mirror),i=a[t];return i==null?{x:0,y:n.top}:{x:i,y:n.top}}},FE=ve(Zr,Ba,(e,t)=>{var n=typeof t.width=="number"?t.width:vm;return{width:n,height:e.height}}),WN=(e,t,n)=>{switch(t){case"xAxis":return $E(e,n).width;case"yAxis":return FE(e,n).height;default:return}},zE=(e,t,n,s)=>{if(n!=null){var{allowDuplicatedCategory:a,type:i,dataKey:l}=n,o=bi(e,s),c=t.map(d=>d.value);if(l&&o&&i==="category"&&a&&GS(c))return c}},cy=ve([Qt,Lm,Lr,Ir],zE),BE=(e,t,n,s)=>{if(!(n==null||n.dataKey==null)){var{type:a,scale:i}=n,l=bi(e,s);if(l&&(a==="number"||i!=="auto"))return t.map(o=>o.value)}},dy=ve([Qt,Lm,Rc,Ir],BE),YN=ve([Qt,NY,uo,fi,cy,dy,Fc,ly,Ir],(e,t,n,s,a,i,l,o,c)=>{if(t==null)return null;var d=bi(e,c);return{angle:t.angle,interval:t.interval,minTickGap:t.minTickGap,orientation:t.orientation,tick:t.tick,tickCount:t.tickCount,tickFormatter:t.tickFormatter,ticks:t.ticks,type:t.type,unit:t.unit,axisType:c,categoricalDomain:i,duplicateDomain:a,isCategorical:d,niceTicks:o,range:l,realScaleType:n,scale:s}}),iV=(e,t,n,s,a,i,l,o,c)=>{if(!(t==null||s==null)){var d=bi(e,c),{type:u,ticks:m,tickCount:p}=t,f=n==="scaleBand"&&typeof s.bandwidth=="function"?s.bandwidth()/2:2,y=u==="category"&&s.bandwidth?s.bandwidth()/f:0;y=c==="angleAxis"&&i!=null&&i.length>=2?ln(i[0]-i[1])*2*y:y;var g=m||a;if(g){var x=g.map((b,v)=>{var w=l?l.indexOf(b):b;return{index:v,coordinate:s(w)+y,value:b,offset:y}});return x.filter(b=>!Tn(b.coordinate))}return d&&o?o.map((b,v)=>({coordinate:s(b)+y,value:b,index:v,offset:y})):s.ticks?s.ticks(p).map(b=>({coordinate:s(b)+y,value:b,offset:y})):s.domain().map((b,v)=>({coordinate:s(b)+y,value:l?l[b]:b,index:v,offset:y}))}},UE=ve([Qt,Rc,uo,fi,ly,Fc,cy,dy,Ir],iV),lV=(e,t,n,s,a,i,l)=>{if(!(t==null||n==null||s==null||s[0]===s[1])){var o=bi(e,l),{tickCount:c}=t,d=0;return d=l==="angleAxis"&&(s==null?void 0:s.length)>=2?ln(s[0]-s[1])*2*d:d,o&&i?i.map((u,m)=>({coordinate:n(u)+d,value:u,index:m,offset:d})):n.ticks?n.ticks(c).map(u=>({coordinate:n(u)+d,value:u,offset:d})):n.domain().map((u,m)=>({coordinate:n(u)+d,value:a?a[u]:u,index:m,offset:d}))}},gi=ve([Qt,Rc,fi,Fc,cy,dy,Ir],lV),oa=ve(Lr,fi,(e,t)=>{if(!(e==null||t==null))return Lu(Lu({},e),{},{scale:t})}),oV=ve([Lr,uo,sy,IE],ay);ve((e,t,n)=>G0(e,n),oV,(e,t)=>{if(!(e==null||t==null))return Lu(Lu({},e),{},{scale:t})});var cV=ve([Qt,o0,c0],(e,t,n)=>{switch(e){case"horizontal":return t.some(s=>s.reversed)?"right-to-left":"left-to-right";case"vertical":return n.some(s=>s.reversed)?"bottom-to-top":"top-to-bottom";case"centric":case"radial":return"left-to-right";default:return}}),qE=e=>e.options.defaultTooltipEventType,HE=e=>e.options.validateTooltipEventTypes;function WE(e,t,n){if(e==null)return t;var s=e?"axis":"item";return n==null?t:n.includes(s)?s:t}function uy(e,t){var n=qE(e),s=HE(e);return WE(t,n,s)}function dV(e){return tt(t=>uy(t,e))}var YE=(e,t)=>{var n,s=Number(t);if(!(Tn(s)||t==null))return s>=0?e==null||(n=e[s])===null||n===void 0?void 0:n.value:void 0},uV=e=>e.tooltip.settings,Qa={active:!1,index:null,dataKey:void 0,coordinate:void 0},mV={itemInteraction:{click:Qa,hover:Qa},axisInteraction:{click:Qa,hover:Qa},keyboardInteraction:Qa,syncInteraction:{active:!1,index:null,dataKey:void 0,label:void 0,coordinate:void 0},tooltipItemPayloads:[],settings:{shared:void 0,trigger:"hover",axisId:0,active:!1,defaultIndex:void 0}},VE=Ss({name:"tooltip",initialState:mV,reducers:{addTooltipEntrySettings(e,t){e.tooltipItemPayloads.push(t.payload)},removeTooltipEntrySettings(e,t){var n=Sa(e).tooltipItemPayloads.indexOf(t.payload);n>-1&&e.tooltipItemPayloads.splice(n,1)},setTooltipSettingsState(e,t){e.settings=t.payload},setActiveMouseOverItemIndex(e,t){e.syncInteraction.active=!1,e.keyboardInteraction.active=!1,e.itemInteraction.hover.active=!0,e.itemInteraction.hover.index=t.payload.activeIndex,e.itemInteraction.hover.dataKey=t.payload.activeDataKey,e.itemInteraction.hover.coordinate=t.payload.activeCoordinate},mouseLeaveChart(e){e.itemInteraction.hover.active=!1,e.axisInteraction.hover.active=!1},mouseLeaveItem(e){e.itemInteraction.hover.active=!1},setActiveClickItemIndex(e,t){e.syncInteraction.active=!1,e.itemInteraction.click.active=!0,e.keyboardInteraction.active=!1,e.itemInteraction.click.index=t.payload.activeIndex,e.itemInteraction.click.dataKey=t.payload.activeDataKey,e.itemInteraction.click.coordinate=t.payload.activeCoordinate},setMouseOverAxisIndex(e,t){e.syncInteraction.active=!1,e.axisInteraction.hover.active=!0,e.keyboardInteraction.active=!1,e.axisInteraction.hover.index=t.payload.activeIndex,e.axisInteraction.hover.dataKey=t.payload.activeDataKey,e.axisInteraction.hover.coordinate=t.payload.activeCoordinate},setMouseClickAxisIndex(e,t){e.syncInteraction.active=!1,e.keyboardInteraction.active=!1,e.axisInteraction.click.active=!0,e.axisInteraction.click.index=t.payload.activeIndex,e.axisInteraction.click.dataKey=t.payload.activeDataKey,e.axisInteraction.click.coordinate=t.payload.activeCoordinate},setSyncInteraction(e,t){e.syncInteraction=t.payload},setKeyboardInteraction(e,t){e.keyboardInteraction.active=t.payload.active,e.keyboardInteraction.index=t.payload.activeIndex,e.keyboardInteraction.coordinate=t.payload.activeCoordinate,e.keyboardInteraction.dataKey=t.payload.activeDataKey}}}),{addTooltipEntrySettings:hV,removeTooltipEntrySettings:pV,setTooltipSettingsState:fV,setActiveMouseOverItemIndex:GE,mouseLeaveItem:gV,mouseLeaveChart:KE,setActiveClickItemIndex:xV,setMouseOverAxisIndex:XE,setMouseClickAxisIndex:yV,setSyncInteraction:Og,setKeyboardInteraction:Mg}=VE.actions,bV=VE.reducer;function VN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function fd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?VN(Object(n),!0).forEach(function(s){vV(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VN(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function vV(e,t,n){return(t=wV(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wV(e){var t=jV(e,"string");return typeof t=="symbol"?t:t+""}function jV(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function NV(e,t,n){return t==="axis"?n==="click"?e.axisInteraction.click:e.axisInteraction.hover:n==="click"?e.itemInteraction.click:e.itemInteraction.hover}function CV(e){return e.index!=null}var JE=(e,t,n,s)=>{if(t==null)return Qa;var a=NV(e,t,n);if(a==null)return Qa;if(a.active)return a;if(e.keyboardInteraction.active)return e.keyboardInteraction;if(e.syncInteraction.active&&e.syncInteraction.index!=null)return e.syncInteraction;var i=e.settings.active===!0;if(CV(a)){if(i)return fd(fd({},a),{},{active:!0})}else if(s!=null)return{active:!0,coordinate:void 0,dataKey:void 0,index:s};return fd(fd({},Qa),{},{coordinate:a.coordinate})},my=(e,t)=>{var n=e==null?void 0:e.index;if(n==null)return null;var s=Number(n);if(!ss(s))return n;var a=0,i=1/0;return t.length>0&&(i=t.length-1),String(Math.max(a,Math.min(s,i)))},QE=(e,t,n,s,a,i,l,o)=>{if(!(i==null||o==null)){var c=l[0],d=c==null?void 0:o(c.positions,i);if(d!=null)return d;var u=a==null?void 0:a[Number(i)];if(u)switch(n){case"horizontal":return{x:u.coordinate,y:(s.top+t)/2};default:return{x:(s.left+e)/2,y:u.coordinate}}}},ZE=(e,t,n,s)=>{if(t==="axis")return e.tooltipItemPayloads;if(e.tooltipItemPayloads.length===0)return[];var a;return n==="hover"?a=e.itemInteraction.hover.dataKey:a=e.itemInteraction.click.dataKey,a==null&&s!=null?[e.tooltipItemPayloads[0]]:e.tooltipItemPayloads.filter(i=>{var l;return((l=i.settings)===null||l===void 0?void 0:l.dataKey)===a})},zc=e=>e.options.tooltipPayloadSearcher,mo=e=>e.tooltip;function GN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function KN(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?GN(Object(n),!0).forEach(function(s){kV(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GN(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function kV(e,t,n){return(t=SV(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function SV(e){var t=_V(e,"string");return typeof t=="symbol"?t:t+""}function _V(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function EV(e,t,n){return Array.isArray(e)&&e&&t+n!==0?e.slice(t,n+1):e}function DV(e,t){return e??t}var eD=(e,t,n,s,a,i,l)=>{if(!(t==null||i==null)){var{chartData:o,computedData:c,dataStartIndex:d,dataEndIndex:u}=n,m=[];return e.reduce((p,f)=>{var y,{dataDefinedOnItem:g,settings:x}=f,b=DV(g,o),v=EV(b,d,u),w=(y=x==null?void 0:x.dataKey)!==null&&y!==void 0?y:s==null?void 0:s.dataKey,N=x==null?void 0:x.nameKey,k;if(s!=null&&s.dataKey&&Array.isArray(v)&&!Array.isArray(v[0])&&l==="axis"?k=KS(v,s.dataKey,a):k=i(v,t,c,N),Array.isArray(k))k.forEach(S=>{var _=KN(KN({},x),{},{name:S.name,unit:S.unit,color:void 0,fill:void 0});p.push(Dj({tooltipEntrySettings:_,dataKey:S.dataKey,payload:S.payload,value:yr(S.payload,S.dataKey),name:S.name}))});else{var j;p.push(Dj({tooltipEntrySettings:x,dataKey:w,payload:k,value:yr(k,w),name:(j=yr(k,N))!==null&&j!==void 0?j:x==null?void 0:x.name}))}return p},m)}},dn=e=>{var t=Qt(e);return t==="horizontal"?"xAxis":t==="vertical"?"yAxis":t==="centric"?"angleAxis":"radiusAxis"},ho=e=>e.tooltip.settings.axisId,fn=e=>{var t=dn(e),n=ho(e);return Rc(e,t,n)},hy=ve([fn,Qt,vE,U0,dn],OE),TV=ve([e=>e.graphicalItems.cartesianItems,e=>e.graphicalItems.polarItems],(e,t)=>[...e,...t]),AV=ve([dn,ho],K0),Fm=ve([TV,fn,AV],X0),PV=ve([Fm],J0),ul=ve([PV,cl],Q0),py=ve([ul,fn,Fm],Z0),OV=ve([fn],ey),MV=ve([ul,Fm,Ic],NE),IV=ve([MV,cl,dn],CE),LV=ve([Fm],wE),RV=ve([ul,fn,LV,dn],kE),$V=ve([SE,dn,ho],co),FV=ve([$V,dn],DE),zV=ve([_E,dn,ho],co),BV=ve([zV,dn],TE),UV=ve([EE,dn,ho],co),qV=ve([UV,dn],AE),HV=ve([FV,qV,BV],ty),WV=ve([fn,OV,IV,RV,HV],ry),tD=ve([fn,Qt,ul,py,Ic,dn,WV],ny),YV=ve([tD,fn,hy],iy),VV=ve([fn,tD,YV,dn],oy),rD=e=>{var t=dn(e),n=ho(e),s=!1;return Fc(e,t,n,s)},nD=ve([fn,rD],Pm),sD=ve([fn,hy,VV,nD],ay),GV=ve([Qt,py,fn,dn],zE),KV=ve([Qt,py,fn,dn],BE),XV=(e,t,n,s,a,i,l,o)=>{if(t){var{type:c}=t,d=bi(e,o);if(s){var u=n==="scaleBand"&&s.bandwidth?s.bandwidth()/2:2,m=c==="category"&&s.bandwidth?s.bandwidth()/u:0;return m=o==="angleAxis"&&a!=null&&(a==null?void 0:a.length)>=2?ln(a[0]-a[1])*2*m:m,d&&l?l.map((p,f)=>({coordinate:s(p)+m,value:p,index:f,offset:m})):s.domain().map((p,f)=>({coordinate:s(p)+m,value:i?i[p]:p,index:f,offset:m}))}}},Ua=ve([Qt,fn,hy,sD,rD,GV,KV,dn],XV),fy=ve([qE,HE,uV],(e,t,n)=>WE(n.shared,e,t)),aD=e=>e.tooltip.settings.trigger,gy=e=>e.tooltip.settings.defaultIndex,zm=ve([mo,fy,aD,gy],JE),xi=ve([zm,ul],my),iD=ve([Ua,xi],YE),lD=ve([zm],e=>{if(e)return e.dataKey}),oD=ve([mo,fy,aD,gy],ZE),JV=ve([$a,Fa,Qt,Zr,Ua,gy,oD,zc],QE),QV=ve([zm,JV],(e,t)=>e!=null&&e.coordinate?e.coordinate:t),ZV=ve([zm],e=>e.active),eG=ve([oD,xi,cl,fn,iD,zc,fy],eD),tG=ve([eG],e=>{if(e!=null){var t=e.map(n=>n.payload).filter(n=>n!=null);return Array.from(new Set(t))}});function XN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function JN(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?XN(Object(n),!0).forEach(function(s){rG(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):XN(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function rG(e,t,n){return(t=nG(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function nG(e){var t=sG(e,"string");return typeof t=="symbol"?t:t+""}function sG(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var aG=()=>tt(fn),iG=()=>{var e=aG(),t=tt(Ua),n=tt(sD);return nc(JN(JN({},e),{},{scale:n}),t)},lG=()=>tt(U0),xy=(e,t)=>t,cD=(e,t,n)=>n,yy=(e,t,n,s)=>s,oG=ve(Ua,e=>hm(e,t=>t.coordinate)),by=ve([mo,xy,cD,yy],JE),dD=ve([by,ul],my),cG=(e,t,n)=>{if(t!=null){var s=mo(e);return t==="axis"?n==="hover"?s.axisInteraction.hover.dataKey:s.axisInteraction.click.dataKey:n==="hover"?s.itemInteraction.hover.dataKey:s.itemInteraction.click.dataKey}},uD=ve([mo,xy,cD,yy],ZE),Ru=ve([$a,Fa,Qt,Zr,Ua,yy,uD,zc],QE),dG=ve([by,Ru],(e,t)=>{var n;return(n=e.coordinate)!==null&&n!==void 0?n:t}),mD=ve(Ua,dD,YE),uG=ve([uD,dD,cl,fn,mD,zc,xy],eD),mG=ve([by],e=>({isActive:e.active,activeIndex:e.index})),hG=(e,t,n,s,a,i,l,o)=>{if(!(!e||!t||!s||!a||!i)){var c=PU(e.chartX,e.chartY,t,n,o);if(c){var d=MU(c,t),u=vU(d,l,i,s,a),m=OU(t,i,u,c);return{activeIndex:String(u),activeCoordinate:m}}}};function Ig(){return Ig=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Ig.apply(null,arguments)}function QN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function gd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?QN(Object(n),!0).forEach(function(s){pG(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QN(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function pG(e,t,n){return(t=fG(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fG(e){var t=gG(e,"string");return typeof t=="symbol"?t:t+""}function gG(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function xG(e){var{coordinate:t,payload:n,index:s,offset:a,tooltipAxisBandSize:i,layout:l,cursor:o,tooltipEventType:c,chartName:d}=e,u=t,m=n,p=s;if(!o||!u||d!=="ScatterChart"&&c!=="axis")return null;var f,y;if(d==="ScatterChart")f=u,y=A9;else if(d==="BarChart")f=P9(l,u,a,i),y=p_;else if(l==="radial"){var{cx:g,cy:x,radius:b,startAngle:v,endAngle:w}=f_(u);f={cx:g,cy:x,startAngle:v,endAngle:w,innerRadius:b,outerRadius:b},y=x_}else f={points:yq(l,u,a)},y=h0;var N=typeof o=="object"&&"className"in o?o.className:void 0,k=gd(gd(gd(gd({stroke:"#ccc",pointerEvents:"none"},a),f),$t(o,!1)),{},{payload:m,payloadIndex:p,className:xt("recharts-tooltip-cursor",N)});return h.isValidElement(o)?h.cloneElement(o,k):h.createElement(y,k)}function yG(e){var t=iG(),n=i_(),s=Cm(),a=lG();return h.createElement(xG,Ig({},e,{coordinate:e.coordinate,index:e.index,payload:e.payload,offset:n,layout:s,tooltipAxisBandSize:t,chartName:a}))}var hD=h.createContext(null),bG=()=>h.useContext(hD),Jp={exports:{}},ZN;function vG(){return ZN||(ZN=1,function(e){var t=Object.prototype.hasOwnProperty,n="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(n=!1));function a(c,d,u){this.fn=c,this.context=d,this.once=u||!1}function i(c,d,u,m,p){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new a(u,m||c,p),y=n?n+d:d;return c._events[y]?c._events[y].fn?c._events[y]=[c._events[y],f]:c._events[y].push(f):(c._events[y]=f,c._eventsCount++),c}function l(c,d){--c._eventsCount===0?c._events=new s:delete c._events[d]}function o(){this._events=new s,this._eventsCount=0}o.prototype.eventNames=function(){var d=[],u,m;if(this._eventsCount===0)return d;for(m in u=this._events)t.call(u,m)&&d.push(n?m.slice(1):m);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(u)):d},o.prototype.listeners=function(d){var u=n?n+d:d,m=this._events[u];if(!m)return[];if(m.fn)return[m.fn];for(var p=0,f=m.length,y=new Array(f);p<f;p++)y[p]=m[p].fn;return y},o.prototype.listenerCount=function(d){var u=n?n+d:d,m=this._events[u];return m?m.fn?1:m.length:0},o.prototype.emit=function(d,u,m,p,f,y){var g=n?n+d:d;if(!this._events[g])return!1;var x=this._events[g],b=arguments.length,v,w;if(x.fn){switch(x.once&&this.removeListener(d,x.fn,void 0,!0),b){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,u),!0;case 3:return x.fn.call(x.context,u,m),!0;case 4:return x.fn.call(x.context,u,m,p),!0;case 5:return x.fn.call(x.context,u,m,p,f),!0;case 6:return x.fn.call(x.context,u,m,p,f,y),!0}for(w=1,v=new Array(b-1);w<b;w++)v[w-1]=arguments[w];x.fn.apply(x.context,v)}else{var N=x.length,k;for(w=0;w<N;w++)switch(x[w].once&&this.removeListener(d,x[w].fn,void 0,!0),b){case 1:x[w].fn.call(x[w].context);break;case 2:x[w].fn.call(x[w].context,u);break;case 3:x[w].fn.call(x[w].context,u,m);break;case 4:x[w].fn.call(x[w].context,u,m,p);break;default:if(!v)for(k=1,v=new Array(b-1);k<b;k++)v[k-1]=arguments[k];x[w].fn.apply(x[w].context,v)}}return!0},o.prototype.on=function(d,u,m){return i(this,d,u,m,!1)},o.prototype.once=function(d,u,m){return i(this,d,u,m,!0)},o.prototype.removeListener=function(d,u,m,p){var f=n?n+d:d;if(!this._events[f])return this;if(!u)return l(this,f),this;var y=this._events[f];if(y.fn)y.fn===u&&(!p||y.once)&&(!m||y.context===m)&&l(this,f);else{for(var g=0,x=[],b=y.length;g<b;g++)(y[g].fn!==u||p&&!y[g].once||m&&y[g].context!==m)&&x.push(y[g]);x.length?this._events[f]=x.length===1?x[0]:x:l(this,f)}return this},o.prototype.removeAllListeners=function(d){var u;return d?(u=n?n+d:d,this._events[u]&&l(this,u)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o}(Jp)),Jp.exports}var wG=vG();const jG=ks(wG);var uc=new jG,Lg="recharts.syncEvent.tooltip",e1="recharts.syncEvent.brush";function vy(e,t){if(t){var n=Number.parseInt(t,10);if(!Tn(n))return e==null?void 0:e[n]}}var NG={chartName:"",tooltipPayloadSearcher:void 0,eventEmitter:void 0,defaultTooltipEventType:"axis"},pD=Ss({name:"options",initialState:NG,reducers:{createEventEmitter:e=>{e.eventEmitter==null&&(e.eventEmitter=Symbol("rechartsEventEmitter"))}}}),CG=pD.reducer,{createEventEmitter:kG}=pD.actions;function SG(e){return e.tooltip.syncInteraction}var _G={chartData:void 0,computedData:void 0,dataStartIndex:0,dataEndIndex:0},fD=Ss({name:"chartData",initialState:_G,reducers:{setChartData(e,t){if(e.chartData=t.payload,t.payload==null){e.dataStartIndex=0,e.dataEndIndex=0;return}t.payload.length>0&&e.dataEndIndex!==t.payload.length-1&&(e.dataEndIndex=t.payload.length-1)},setComputedData(e,t){e.computedData=t.payload},setDataStartEndIndexes(e,t){var{startIndex:n,endIndex:s}=t.payload;n!=null&&(e.dataStartIndex=n),s!=null&&(e.dataEndIndex=s)}}}),{setChartData:t1,setDataStartEndIndexes:EG,setComputedData:Ose}=fD.actions,DG=fD.reducer,gD=()=>{};function TG(){var e=tt(q0),t=tt(H0),n=vr(),s=tt(fE),a=tt(Ua),i=Cm(),l=Nm(),o=tt(c=>c.rootProps.className);h.useEffect(()=>{if(e==null)return gD;var c=(d,u,m)=>{if(t!==m&&e===d){if(s==="index"){n(u);return}if(a!=null){var p;if(typeof s=="function"){var f={activeTooltipIndex:u.payload.index==null?void 0:Number(u.payload.index),isTooltipActive:u.payload.active,activeIndex:u.payload.index==null?void 0:Number(u.payload.index),activeLabel:u.payload.label,activeDataKey:u.payload.dataKey,activeCoordinate:u.payload.coordinate},y=s(a,f);p=a[y]}else s==="value"&&(p=a.find(j=>String(j.value)===u.payload.label));var{coordinate:g}=u.payload;if(p==null||u.payload.active===!1||g==null||l==null){n(Og({active:!1,coordinate:void 0,dataKey:void 0,index:null,label:void 0}));return}var{x,y:b}=g,v=Math.min(x,l.x+l.width),w=Math.min(b,l.y+l.height),N={x:i==="horizontal"?p.coordinate:v,y:i==="horizontal"?w:p.coordinate},k=Og({active:u.payload.active,coordinate:N,dataKey:u.payload.dataKey,index:String(p.index),label:u.payload.label});n(k)}}};return uc.on(Lg,c),()=>{uc.off(Lg,c)}},[o,n,t,e,s,a,i,l])}function AG(){var e=tt(q0),t=tt(H0),n=vr();h.useEffect(()=>{if(e==null)return gD;var s=(a,i,l)=>{t!==l&&e===a&&n(EG(i))};return uc.on(e1,s),()=>{uc.off(e1,s)}},[n,t,e])}function PG(){var e=vr();h.useEffect(()=>{e(kG())},[e]),TG(),AG()}function OG(e,t,n,s,a,i){var l=tt(p=>cG(p,e,t)),o=tt(H0),c=tt(q0),d=tt(fE),u=tt(SG),m=u==null?void 0:u.active;h.useEffect(()=>{if(!m&&c!=null&&o!=null){var p=Og({active:i,coordinate:n,dataKey:l,index:a,label:typeof s=="number"?String(s):s});uc.emit(Lg,c,p,o)}},[m,n,l,a,s,o,c,d,i])}function r1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function n1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?r1(Object(n),!0).forEach(function(s){MG(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function MG(e,t,n){return(t=IG(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function IG(e){var t=LG(e,"string");return typeof t=="symbol"?t:t+""}function LG(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function RG(e){return e.dataKey}function $G(e,t){return h.isValidElement(e)?h.cloneElement(e,t):typeof e=="function"?h.createElement(e,t):h.createElement(c9,t)}var s1=[],FG={allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",axisId:0,contentStyle:{},cursor:!0,filterNull:!0,isAnimationActive:!il.isSsr,itemSorter:"name",itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,wrapperStyle:{}};function $u(e){var t=_s(e,FG),{active:n,allowEscapeViewBox:s,animationDuration:a,animationEasing:i,content:l,filterNull:o,isAnimationActive:c,offset:d,payloadUniqBy:u,position:m,reverseDirection:p,useTranslate3d:f,wrapperStyle:y,cursor:g,shared:x,trigger:b,defaultIndex:v,portal:w,axisId:N}=t,k=vr(),j=typeof v=="number"?String(v):v;h.useEffect(()=>{k(fV({shared:x,trigger:b,axisId:N,active:n,defaultIndex:j}))},[k,x,b,N,n,j]);var S=Nm(),_=d_(),C=dV(x),{activeIndex:D,isActive:A}=tt(J=>mG(J,C,b,j)),E=tt(J=>uG(J,C,b,j)),T=tt(J=>mD(J,C,b,j)),M=tt(J=>dG(J,C,b,j)),L=E,P=bG(),$=n??A,[R,U]=_2([L,$]),I=C==="axis"?T:void 0;OG(C,b,M,I,D,$);var z=w??P;if(z==null)return null;var F=L??s1;$||(F=s1),o&&F.length&&(F=j2(L.filter(J=>J.value!=null&&(J.hide!==!0||t.includeHidden)),u,RG));var O=F.length>0,K=h.createElement(g9,{allowEscapeViewBox:s,animationDuration:a,animationEasing:i,isAnimationActive:c,active:$,coordinate:M,hasPayload:O,offset:d,position:m,reverseDirection:p,useTranslate3d:f,viewBox:S,wrapperStyle:y,lastBoundingBox:R,innerRef:U,hasPortalFromProps:!!w},$G(l,n1(n1({},t),{},{payload:F,label:I,active:$,coordinate:M,accessibilityLayer:_})));return h.createElement(h.Fragment,null,eo.createPortal(K,z),$&&h.createElement(yG,{cursor:g,tooltipEventType:C,coordinate:M,payload:L,index:D}))}var Qp={},Zp={},a1;function zG(){return a1||(a1=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n,s=0,a={}){typeof a!="object"&&(a={});let i=null,l=null,o=null,c=0,d=null,u;const{leading:m=!1,trailing:p=!0,maxWait:f}=a,y="maxWait"in a,g=y?Math.max(Number(f)||0,s):0,x=S=>(i!==null&&(u=n.apply(l,i)),i=l=null,c=S,u),b=S=>(c=S,d=setTimeout(k,s),m&&i!==null?x(S):u),v=S=>(d=null,p&&i!==null?x(S):u),w=S=>{if(o===null)return!0;const _=S-o,C=_>=s||_<0,D=y&&S-c>=g;return C||D},N=S=>{const _=o===null?0:S-o,C=s-_,D=g-(S-c);return y?Math.min(C,D):C},k=()=>{const S=Date.now();if(w(S))return v(S);d=setTimeout(k,N(S))},j=function(...S){const _=Date.now(),C=w(_);if(i=S,l=this,o=_,C){if(d===null)return b(_);if(y)return clearTimeout(d),d=setTimeout(k,s),x(_)}return d===null&&(d=setTimeout(k,s)),u};return j.cancel=()=>{d!==null&&clearTimeout(d),c=0,o=i=l=d=null},j.flush=()=>d===null?u:v(Date.now()),j}e.debounce=t}(Zp)),Zp}var i1;function BG(){return i1||(i1=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=zG();function n(s,a=0,i={}){const{leading:l=!0,trailing:o=!0}=i;return t.debounce(s,a,{leading:l,maxWait:a,trailing:o})}e.throttle=n}(Qp)),Qp}var ef,l1;function UG(){return l1||(l1=1,ef=BG().throttle),ef}var qG=UG();const HG=ks(qG);var Vo=function(t,n){for(var s=arguments.length,a=new Array(s>2?s-2:0),i=2;i<s;i++)a[i-2]=arguments[i]};function o1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function tf(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?o1(Object(n),!0).forEach(function(s){WG(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function WG(e,t,n){return(t=YG(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function YG(e){var t=VG(e,"string");return typeof t=="symbol"?t:t+""}function VG(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Fu=h.forwardRef((e,t)=>{var{aspect:n,initialDimension:s={width:-1,height:-1},width:a="100%",height:i="100%",minWidth:l=0,minHeight:o,maxHeight:c,children:d,debounce:u=0,id:m,className:p,onResize:f,style:y={}}=e,g=h.useRef(null),x=h.useRef();x.current=f,h.useImperativeHandle(t,()=>g.current);var[b,v]=h.useState({containerWidth:s.width,containerHeight:s.height}),w=h.useCallback((k,j)=>{v(S=>{var _=Math.round(k),C=Math.round(j);return S.containerWidth===_&&S.containerHeight===C?S:{containerWidth:_,containerHeight:C}})},[]);h.useEffect(()=>{var k=C=>{var D,{width:A,height:E}=C[0].contentRect;w(A,E),(D=x.current)===null||D===void 0||D.call(x,A,E)};u>0&&(k=HG(k,u,{trailing:!0,leading:!1}));var j=new ResizeObserver(k),{width:S,height:_}=g.current.getBoundingClientRect();return w(S,_),j.observe(g.current),()=>{j.disconnect()}},[w,u]);var N=h.useMemo(()=>{var{containerWidth:k,containerHeight:j}=b;if(k<0||j<0)return null;Vo(Mi(a)||Mi(i),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,a,i),Vo(!n||n>0,"The aspect(%s) must be greater than zero.",n);var S=Mi(a)?k:a,_=Mi(i)?j:i;return n&&n>0&&(S?_=S/n:_&&(S=_*n),c&&_>c&&(_=c)),Vo(S>0||_>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,S,_,a,i,l,o,n),h.Children.map(d,C=>h.cloneElement(C,{width:S,height:_,style:tf({width:S,height:_},C.props.style)}))},[n,d,i,c,o,l,b,a]);return h.createElement("div",{id:m?"".concat(m):void 0,className:xt("recharts-responsive-container",p),style:tf(tf({},y),{},{width:a,height:i,minWidth:l,minHeight:o,maxHeight:c}),ref:g},h.createElement("div",{style:{width:0,height:0,overflow:"visible"}},N))}),Xl=e=>null;Xl.displayName="Cell";function c1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Rg(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?c1(Object(n),!0).forEach(function(s){GG(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function GG(e,t,n){return(t=KG(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function KG(e){var t=XG(e,"string");return typeof t=="symbol"?t:t+""}function XG(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var xl={widthCache:{},cacheCount:0},JG=2e3,QG={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},d1="recharts_measurement_span";function ZG(e){var t=Rg({},e);return Object.keys(t).forEach(n=>{t[n]||delete t[n]}),t}var Go=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||il.isSsr)return{width:0,height:0};var s=ZG(n),a=JSON.stringify({text:t,copyStyle:s});if(xl.widthCache[a])return xl.widthCache[a];try{var i=document.getElementById(d1);i||(i=document.createElement("span"),i.setAttribute("id",d1),i.setAttribute("aria-hidden","true"),document.body.appendChild(i));var l=Rg(Rg({},QG),s);Object.assign(i.style,l),i.textContent="".concat(t);var o=i.getBoundingClientRect(),c={width:o.width,height:o.height};return xl.widthCache[a]=c,++xl.cacheCount>JG&&(xl.cacheCount=0,xl.widthCache={}),c}catch{return{width:0,height:0}}},u1=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,m1=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,eK=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,tK=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,xD={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},rK=Object.keys(xD),wl="NaN";function nK(e,t){return e*xD[t]}class Ln{static parse(t){var n,[,s,a]=(n=tK.exec(t))!==null&&n!==void 0?n:[];return new Ln(parseFloat(s),a??"")}constructor(t,n){this.num=t,this.unit=n,this.num=t,this.unit=n,Tn(t)&&(this.unit=""),n!==""&&!eK.test(n)&&(this.num=NaN,this.unit=""),rK.includes(n)&&(this.num=nK(t,n),this.unit="px")}add(t){return this.unit!==t.unit?new Ln(NaN,""):new Ln(this.num+t.num,this.unit)}subtract(t){return this.unit!==t.unit?new Ln(NaN,""):new Ln(this.num-t.num,this.unit)}multiply(t){return this.unit!==""&&t.unit!==""&&this.unit!==t.unit?new Ln(NaN,""):new Ln(this.num*t.num,this.unit||t.unit)}divide(t){return this.unit!==""&&t.unit!==""&&this.unit!==t.unit?new Ln(NaN,""):new Ln(this.num/t.num,this.unit||t.unit)}toString(){return"".concat(this.num).concat(this.unit)}isNaN(){return Tn(this.num)}}function yD(e){if(e.includes(wl))return wl;for(var t=e;t.includes("*")||t.includes("/");){var n,[,s,a,i]=(n=u1.exec(t))!==null&&n!==void 0?n:[],l=Ln.parse(s??""),o=Ln.parse(i??""),c=a==="*"?l.multiply(o):l.divide(o);if(c.isNaN())return wl;t=t.replace(u1,c.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var d,[,u,m,p]=(d=m1.exec(t))!==null&&d!==void 0?d:[],f=Ln.parse(u??""),y=Ln.parse(p??""),g=m==="+"?f.add(y):f.subtract(y);if(g.isNaN())return wl;t=t.replace(m1,g.toString())}return t}var h1=/\(([^()]*)\)/;function sK(e){for(var t=e,n;(n=h1.exec(t))!=null;){var[,s]=n;t=t.replace(h1,yD(s))}return t}function aK(e){var t=e.replace(/\s+/g,"");return t=sK(t),t=yD(t),t}function iK(e){try{return aK(e)}catch{return wl}}function rf(e){var t=iK(e.slice(5,-1));return t===wl?"":t}var lK=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],oK=["dx","dy","angle","className","breakAll"];function $g(){return $g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},$g.apply(null,arguments)}function p1(e,t){if(e==null)return{};var n,s,a=cK(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function cK(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}var bD=/[ \f\n\r\t\v\u2028\u2029]+/,vD=e=>{var{children:t,breakAll:n,style:s}=e;try{var a=[];mr(t)||(n?a=t.toString().split(""):a=t.toString().split(bD));var i=a.map(o=>({word:o,width:Go(o,s).width})),l=n?0:Go("",s).width;return{wordsWithComputedWidth:i,spaceWidth:l}}catch{return null}},dK=(e,t,n,s,a)=>{var{maxLines:i,children:l,style:o,breakAll:c}=e,d=et(i),u=l,m=function(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return A.reduce((E,T)=>{var{word:M,width:L}=T,P=E[E.length-1];if(P&&(s==null||a||P.width+L+n<Number(s)))P.words.push(M),P.width+=L+n;else{var $={words:[M],width:L};E.push($)}return E},[])},p=m(t),f=D=>D.reduce((A,E)=>A.width>E.width?A:E);if(!d||a)return p;var y=p.length>i||f(p).width>Number(s);if(!y)return p;for(var g="",x=D=>{var A=u.slice(0,D),E=vD({breakAll:c,style:o,children:A+g}).wordsWithComputedWidth,T=m(E),M=T.length>i||f(T).width>Number(s);return[M,T]},b=0,v=u.length-1,w=0,N;b<=v&&w<=u.length-1;){var k=Math.floor((b+v)/2),j=k-1,[S,_]=x(j),[C]=x(k);if(!S&&!C&&(b=k+1),S&&C&&(v=k-1),!S&&C){N=_;break}w++}return N||p},f1=e=>{var t=mr(e)?[]:e.toString().split(bD);return[{words:t}]},uK=e=>{var{width:t,scaleToFit:n,children:s,style:a,breakAll:i,maxLines:l}=e;if((t||n)&&!il.isSsr){var o,c,d=vD({breakAll:i,children:s,style:a});if(d){var{wordsWithComputedWidth:u,spaceWidth:m}=d;o=u,c=m}else return f1(s);return dK({breakAll:i,children:s,maxLines:l,style:a},o,c,t,n)}return f1(s)},g1="#808080",Bm=h.forwardRef((e,t)=>{var{x:n=0,y:s=0,lineHeight:a="1em",capHeight:i="0.71em",scaleToFit:l=!1,textAnchor:o="start",verticalAnchor:c="end",fill:d=g1}=e,u=p1(e,lK),m=h.useMemo(()=>uK({breakAll:u.breakAll,children:u.children,maxLines:u.maxLines,scaleToFit:l,style:u.style,width:u.width}),[u.breakAll,u.children,u.maxLines,l,u.style,u.width]),{dx:p,dy:f,angle:y,className:g,breakAll:x}=u,b=p1(u,oK);if(!js(n)||!js(s))return null;var v=n+(et(p)?p:0),w=s+(et(f)?f:0),N;switch(c){case"start":N=rf("calc(".concat(i,")"));break;case"middle":N=rf("calc(".concat((m.length-1)/2," * -").concat(a," + (").concat(i," / 2))"));break;default:N=rf("calc(".concat(m.length-1," * -").concat(a,")"));break}var k=[];if(l){var j=m[0].width,{width:S}=u;k.push("scale(".concat(et(S)?S/j:1,")"))}return y&&k.push("rotate(".concat(y,", ").concat(v,", ").concat(w,")")),k.length&&(b.transform=k.join(" ")),h.createElement("text",$g({},$t(b,!0),{ref:t,x:v,y:w,className:xt("recharts-text",g),textAnchor:o,fill:d.includes("url")?g1:d}),m.map((_,C)=>{var D=_.words.join(x?"":" ");return h.createElement("tspan",{x:v,dy:C===0?N:a,key:"".concat(D,"-").concat(C)},D)}))});Bm.displayName="Text";var mK=["offset"],hK=["labelRef"];function x1(e,t){if(e==null)return{};var n,s,a=pK(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function pK(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}function y1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Rr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?y1(Object(n),!0).forEach(function(s){fK(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function fK(e,t,n){return(t=gK(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gK(e){var t=xK(e,"string");return typeof t=="symbol"?t:t+""}function xK(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ga(){return ga=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},ga.apply(null,arguments)}var yK=e=>{var{value:t,formatter:n}=e,s=mr(e.children)?t:e.children;return typeof n=="function"?n(s):s},wy=e=>e!=null&&typeof e=="function",bK=(e,t)=>{var n=ln(t-e),s=Math.min(Math.abs(t-e),360);return n*s},vK=(e,t,n)=>{var{position:s,viewBox:a,offset:i,className:l}=e,{cx:o,cy:c,innerRadius:d,outerRadius:u,startAngle:m,endAngle:p,clockWise:f}=a,y=(d+u)/2,g=bK(m,p),x=g>=0?1:-1,b,v;s==="insideStart"?(b=m+x*i,v=f):s==="insideEnd"?(b=p-x*i,v=!f):s==="end"&&(b=p+x*i,v=f),v=g<=0?v:!v;var w=qr(o,c,y,b),N=qr(o,c,y,b+(v?1:-1)*359),k="M".concat(w.x,",").concat(w.y,`
    A`).concat(y,",").concat(y,",0,1,").concat(v?0:1,`,
    `).concat(N.x,",").concat(N.y),j=mr(e.id)?Qi("recharts-radial-line-"):e.id;return h.createElement("text",ga({},n,{dominantBaseline:"central",className:xt("recharts-radial-bar-label",l)}),h.createElement("defs",null,h.createElement("path",{id:j,d:k})),h.createElement("textPath",{xlinkHref:"#".concat(j)},t))},wK=e=>{var{viewBox:t,offset:n,position:s}=e,{cx:a,cy:i,innerRadius:l,outerRadius:o,startAngle:c,endAngle:d}=t,u=(c+d)/2;if(s==="outside"){var{x:m,y:p}=qr(a,i,o+n,u);return{x:m,y:p,textAnchor:m>=a?"start":"end",verticalAnchor:"middle"}}if(s==="center")return{x:a,y:i,textAnchor:"middle",verticalAnchor:"middle"};if(s==="centerTop")return{x:a,y:i,textAnchor:"middle",verticalAnchor:"start"};if(s==="centerBottom")return{x:a,y:i,textAnchor:"middle",verticalAnchor:"end"};var f=(l+o)/2,{x:y,y:g}=qr(a,i,f,u);return{x:y,y:g,textAnchor:"middle",verticalAnchor:"middle"}},jK=(e,t)=>{var{parentViewBox:n,offset:s,position:a}=e,{x:i,y:l,width:o,height:c}=t,d=c>=0?1:-1,u=d*s,m=d>0?"end":"start",p=d>0?"start":"end",f=o>=0?1:-1,y=f*s,g=f>0?"end":"start",x=f>0?"start":"end";if(a==="top"){var b={x:i+o/2,y:l-d*s,textAnchor:"middle",verticalAnchor:m};return Rr(Rr({},b),n?{height:Math.max(l-n.y,0),width:o}:{})}if(a==="bottom"){var v={x:i+o/2,y:l+c+u,textAnchor:"middle",verticalAnchor:p};return Rr(Rr({},v),n?{height:Math.max(n.y+n.height-(l+c),0),width:o}:{})}if(a==="left"){var w={x:i-y,y:l+c/2,textAnchor:g,verticalAnchor:"middle"};return Rr(Rr({},w),n?{width:Math.max(w.x-n.x,0),height:c}:{})}if(a==="right"){var N={x:i+o+y,y:l+c/2,textAnchor:x,verticalAnchor:"middle"};return Rr(Rr({},N),n?{width:Math.max(n.x+n.width-N.x,0),height:c}:{})}var k=n?{width:o,height:c}:{};return a==="insideLeft"?Rr({x:i+y,y:l+c/2,textAnchor:x,verticalAnchor:"middle"},k):a==="insideRight"?Rr({x:i+o-y,y:l+c/2,textAnchor:g,verticalAnchor:"middle"},k):a==="insideTop"?Rr({x:i+o/2,y:l+u,textAnchor:"middle",verticalAnchor:p},k):a==="insideBottom"?Rr({x:i+o/2,y:l+c-u,textAnchor:"middle",verticalAnchor:m},k):a==="insideTopLeft"?Rr({x:i+y,y:l+u,textAnchor:x,verticalAnchor:p},k):a==="insideTopRight"?Rr({x:i+o-y,y:l+u,textAnchor:g,verticalAnchor:p},k):a==="insideBottomLeft"?Rr({x:i+y,y:l+c-u,textAnchor:x,verticalAnchor:m},k):a==="insideBottomRight"?Rr({x:i+o-y,y:l+c-u,textAnchor:g,verticalAnchor:m},k):a&&typeof a=="object"&&(et(a.x)||Mi(a.x))&&(et(a.y)||Mi(a.y))?Rr({x:i+En(a.x,o),y:l+En(a.y,c),textAnchor:"end",verticalAnchor:"end"},k):Rr({x:i+o/2,y:l+c/2,textAnchor:"middle",verticalAnchor:"middle"},k)},NK=e=>"cx"in e&&et(e.cx);function Rn(e){var{offset:t=5}=e,n=x1(e,mK),s=Rr({offset:t},n),{viewBox:a,position:i,value:l,children:o,content:c,className:d="",textBreakAll:u,labelRef:m}=s,p=Nm(),f=a||p;if(!f||mr(l)&&mr(o)&&!h.isValidElement(c)&&typeof c!="function")return null;if(h.isValidElement(c)){var{labelRef:y}=s,g=x1(s,hK);return h.cloneElement(c,g)}var x;if(typeof c=="function"){if(x=h.createElement(c,s),h.isValidElement(x))return x}else x=yK(s);var b=NK(f),v=$t(s,!0);if(b&&(i==="insideStart"||i==="insideEnd"||i==="end"))return vK(s,x,v);var w=b?wK(s):jK(s,f);return h.createElement(Bm,ga({ref:m,className:xt("recharts-label",d)},v,w,{breakAll:u}),x)}Rn.displayName="Label";var wD=e=>{var{cx:t,cy:n,angle:s,startAngle:a,endAngle:i,r:l,radius:o,innerRadius:c,outerRadius:d,x:u,y:m,top:p,left:f,width:y,height:g,clockWise:x,labelViewBox:b}=e;if(b)return b;if(et(y)&&et(g)){if(et(u)&&et(m))return{x:u,y:m,width:y,height:g};if(et(p)&&et(f))return{x:p,y:f,width:y,height:g}}if(et(u)&&et(m))return{x:u,y:m,width:0,height:0};if(et(t)&&et(n))return{cx:t,cy:n,startAngle:a||s||0,endAngle:i||s||0,innerRadius:c||0,outerRadius:d||o||l||0,clockWise:x};if(e.viewBox)return e.viewBox},CK=(e,t,n)=>{if(!e)return null;var s={viewBox:t,labelRef:n};return e===!0?h.createElement(Rn,ga({key:"label-implicit"},s)):js(e)?h.createElement(Rn,ga({key:"label-implicit",value:e},s)):h.isValidElement(e)?e.type===Rn?h.cloneElement(e,Rr({key:"label-implicit"},s)):h.createElement(Rn,ga({key:"label-implicit",content:e},s)):wy(e)?h.createElement(Rn,ga({key:"label-implicit",content:e},s)):e&&typeof e=="object"?h.createElement(Rn,ga({},e,{key:"label-implicit"},s)):null},kK=function(t,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&s&&!t.label)return null;var{children:a,labelRef:i}=t,l=wD(t),o=Dc(a,Rn).map((d,u)=>h.cloneElement(d,{viewBox:n||l,key:"label-".concat(u)}));if(!s)return o;var c=CK(t.label,n||l,i);return[c,...o]};Rn.parseViewBox=wD;Rn.renderCallByParent=kK;var nf={},sf={},b1;function SK(){return b1||(b1=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return n[n.length-1]}e.last=t}(sf)),sf}var af={},v1;function _K(){return v1||(v1=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){return Array.isArray(n)?n:Array.from(n)}e.toArray=t}(af)),af}var w1;function EK(){return w1||(w1=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});const t=SK(),n=_K(),s=Jx();function a(i){if(s.isArrayLike(i))return t.last(n.toArray(i))}e.last=a}(nf)),nf}var lf,j1;function DK(){return j1||(j1=1,lf=EK().last),lf}var TK=DK();const AK=ks(TK);var PK=["valueAccessor"],OK=["data","dataKey","clockWise","id","textBreakAll"];function zu(){return zu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},zu.apply(null,arguments)}function N1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function C1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?N1(Object(n),!0).forEach(function(s){MK(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function MK(e,t,n){return(t=IK(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function IK(e){var t=LK(e,"string");return typeof t=="symbol"?t:t+""}function LK(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function k1(e,t){if(e==null)return{};var n,s,a=RK(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function RK(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}var $K=e=>Array.isArray(e.value)?AK(e.value):e.value;function oi(e){var{valueAccessor:t=$K}=e,n=k1(e,PK),{data:s,dataKey:a,clockWise:i,id:l,textBreakAll:o}=n,c=k1(n,OK);return!s||!s.length?null:h.createElement(Jr,{className:"recharts-label-list"},s.map((d,u)=>{var m=mr(a)?t(d,u):yr(d&&d.payload,a),p=mr(l)?{}:{id:"".concat(l,"-").concat(u)};return h.createElement(Rn,zu({},$t(d,!0),c,p,{parentViewBox:d.parentViewBox,value:m,textBreakAll:o,viewBox:Rn.parseViewBox(mr(i)?d:C1(C1({},d),{},{clockWise:i})),key:"label-".concat(u),index:u}))}))}oi.displayName="LabelList";function FK(e,t){return e?e===!0?h.createElement(oi,{key:"labelList-implicit",data:t}):h.isValidElement(e)||wy(e)?h.createElement(oi,{key:"labelList-implicit",data:t,content:e}):typeof e=="object"?h.createElement(oi,zu({data:t},e,{key:"labelList-implicit"})):null:null}function zK(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&n&&!e.label)return null;var{children:s}=e,a=Dc(s,oi).map((l,o)=>h.cloneElement(l,{data:t,key:"labelList-".concat(o)}));if(!n)return a;var i=FK(e.label,t);return[i,...a]}oi.renderCallByParent=zK;function Fg(){return Fg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Fg.apply(null,arguments)}var jD=e=>{var{cx:t,cy:n,r:s,className:a}=e,i=xt("recharts-dot",a);return t===+t&&n===+n&&s===+s?h.createElement("circle",Fg({},$t(e,!1),qx(e),{className:i,cx:t,cy:n,r:s})):null},ND=e=>e.graphicalItems.polarItems,BK=ve([Ir,Lc],K0),jy=ve([ND,Lr,BK],X0),UK=ve([jy],J0),Ny=ve([UK,$0],Q0),qK=ve([Ny,Lr,jy],Z0),HK=ve([Ny,Lr,jy],(e,t,n)=>n.length>0?e.flatMap(s=>n.flatMap(a=>{var i,l=yr(s,(i=t.dataKey)!==null&&i!==void 0?i:a.dataKey);return{value:l,errorDomain:[]}})).filter(Boolean):(t==null?void 0:t.dataKey)!=null?e.map(s=>({value:yr(s,t.dataKey),errorDomain:[]})):e.map(s=>({value:s,errorDomain:[]}))),S1=()=>{},WK=ve([Lr,PE,S1,HK,S1],ry),CD=ve([Lr,Qt,Ny,qK,Ic,Ir,WK],ny),YK=ve([CD,Lr,uo],iy);ve([Lr,CD,YK,Ir],oy);var VK={radiusAxis:{},angleAxis:{}},kD=Ss({name:"polarAxis",initialState:VK,reducers:{addRadiusAxis(e,t){e.radiusAxis[t.payload.id]=t.payload},removeRadiusAxis(e,t){delete e.radiusAxis[t.payload.id]},addAngleAxis(e,t){e.angleAxis[t.payload.id]=t.payload},removeAngleAxis(e,t){delete e.angleAxis[t.payload.id]}}}),{addRadiusAxis:Mse,removeRadiusAxis:Ise,addAngleAxis:Lse,removeAngleAxis:Rse}=kD.actions,GK=kD.reducer;function _1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function E1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?_1(Object(n),!0).forEach(function(s){KK(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function KK(e,t,n){return(t=XK(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function XK(e){var t=JK(e,"string");return typeof t=="symbol"?t:t+""}function JK(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Cy=(e,t)=>t,QK=[],ky=(e,t,n)=>(n==null?void 0:n.length)===0?QK:n,SD=ve([$0,Cy,ky],(e,t,n)=>{var{chartData:s}=e,a;if((t==null?void 0:t.data)!=null&&t.data.length>0?a=t.data:a=s,(!a||!a.length)&&n!=null&&(a=n.map(i=>E1(E1({},t.presentationProps),i.props))),a!=null)return a}),ZK=ve([SD,Cy,ky],(e,t,n)=>{if(e!=null)return e.map((s,a)=>{var i,l=yr(s,t.nameKey,t.name),o;return n!=null&&(i=n[a])!==null&&i!==void 0&&(i=i.props)!==null&&i!==void 0&&i.fill?o=n[a].props.fill:typeof s=="object"&&s!=null&&"fill"in s?o=s.fill:o=t.fill,{value:ao(l,t.dataKey),color:o,payload:s,type:t.legendType}})}),eX=ve([ND,Cy],(e,t)=>{if(e.some(n=>n.type==="pie"&&t.dataKey===n.dataKey&&t.data===n.data))return t}),tX=ve([SD,eX,ky,Zr],(e,t,n,s)=>{if(!(t==null||e==null))return YX({offset:s,pieSettings:t,displayedData:e,cells:n})}),rX={countOfBars:0,cartesianItems:[],polarItems:[]},_D=Ss({name:"graphicalItems",initialState:rX,reducers:{addBar(e){e.countOfBars+=1},removeBar(e){e.countOfBars-=1},addCartesianGraphicalItem(e,t){e.cartesianItems.push(t.payload)},replaceCartesianGraphicalItem(e,t){var{prev:n,next:s}=t.payload,a=Sa(e).cartesianItems.indexOf(n);a>-1&&(e.cartesianItems[a]=s)},removeCartesianGraphicalItem(e,t){var n=Sa(e).cartesianItems.indexOf(t.payload);n>-1&&e.cartesianItems.splice(n,1)},addPolarGraphicalItem(e,t){e.polarItems.push(t.payload)},removePolarGraphicalItem(e,t){var n=Sa(e).polarItems.indexOf(t.payload);n>-1&&e.polarItems.splice(n,1)}}}),{addBar:nX,removeBar:sX,addCartesianGraphicalItem:aX,replaceCartesianGraphicalItem:iX,removeCartesianGraphicalItem:lX,addPolarGraphicalItem:oX,removePolarGraphicalItem:cX}=_D.actions,dX=_D.reducer;function D1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function T1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?D1(Object(n),!0).forEach(function(s){uX(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function uX(e,t,n){return(t=mX(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mX(e){var t=hX(e,"string");return typeof t=="symbol"?t:t+""}function hX(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function pX(e){var t=vr(),n=h.useRef(null);return h.useEffect(()=>{var s=T1(T1({},e),{},{stackId:t_(e.stackId)});n.current===null?t(aX(s)):n.current!==s&&t(iX({prev:n.current,next:s})),n.current=s},[t,e]),h.useEffect(()=>()=>{n.current&&(t(lX(n.current)),n.current=null)},[t]),null}function fX(e){var t=vr();return h.useEffect(()=>(t(oX(e)),()=>{t(cX(e))}),[t,e]),null}var of={},A1;function gX(){return A1||(A1=1,function(e){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});function t(n){var a;if(typeof n!="object"||n==null)return!1;if(Object.getPrototypeOf(n)===null)return!0;if(Object.prototype.toString.call(n)!=="[object Object]"){const i=n[Symbol.toStringTag];return i==null||!((a=Object.getOwnPropertyDescriptor(n,Symbol.toStringTag))!=null&&a.writable)?!1:n.toString()===`[object ${i}]`}let s=n;for(;Object.getPrototypeOf(s)!==null;)s=Object.getPrototypeOf(s);return Object.getPrototypeOf(n)===s}e.isPlainObject=t}(of)),of}var cf,P1;function xX(){return P1||(P1=1,cf=gX().isPlainObject),cf}var yX=xX();const bX=ks(yX);function Bu(){return Bu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Bu.apply(null,arguments)}var O1=(e,t,n,s,a)=>{var i=n-s,l;return l="M ".concat(e,",").concat(t),l+="L ".concat(e+n,",").concat(t),l+="L ".concat(e+n-i/2,",").concat(t+a),l+="L ".concat(e+n-i/2-s,",").concat(t+a),l+="L ".concat(e,",").concat(t," Z"),l},vX={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},wX=e=>{var t=_s(e,vX),n=h.useRef(),[s,a]=h.useState(-1);h.useEffect(()=>{if(n.current&&n.current.getTotalLength)try{var x=n.current.getTotalLength();x&&a(x)}catch{}},[]);var{x:i,y:l,upperWidth:o,lowerWidth:c,height:d,className:u}=t,{animationEasing:m,animationDuration:p,animationBegin:f,isUpdateAnimationActive:y}=t;if(i!==+i||l!==+l||o!==+o||c!==+c||d!==+d||o===0&&c===0||d===0)return null;var g=xt("recharts-trapezoid",u);return y?h.createElement(pi,{canBegin:s>0,from:{upperWidth:0,lowerWidth:0,height:d,x:i,y:l},to:{upperWidth:o,lowerWidth:c,height:d,x:i,y:l},duration:p,animationEasing:m,isActive:y},x=>{var{upperWidth:b,lowerWidth:v,height:w,x:N,y:k}=x;return h.createElement(pi,{canBegin:s>0,from:"0px ".concat(s===-1?1:s,"px"),to:"".concat(s,"px 0px"),attributeName:"strokeDasharray",begin:f,duration:p,easing:m},h.createElement("path",Bu({},$t(t,!0),{className:g,d:O1(N,k,b,v,w),ref:n})))}):h.createElement("g",null,h.createElement("path",Bu({},$t(t,!0),{className:g,d:O1(i,l,o,c,d)})))},jX=["option","shapeType","propTransformer","activeClassName","isActive"];function NX(e,t){if(e==null)return{};var n,s,a=CX(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function CX(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}function M1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Uu(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?M1(Object(n),!0).forEach(function(s){kX(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function kX(e,t,n){return(t=SX(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function SX(e){var t=_X(e,"string");return typeof t=="symbol"?t:t+""}function _X(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function EX(e,t){return Uu(Uu({},t),e)}function DX(e,t){return e==="symbols"}function I1(e){var{shapeType:t,elementProps:n}=e;switch(t){case"rectangle":return h.createElement(p_,n);case"trapezoid":return h.createElement(wX,n);case"sector":return h.createElement(x_,n);case"symbols":if(DX(t))return h.createElement(Gx,n);break;default:return null}}function TX(e){return h.isValidElement(e)?e.props:e}function ED(e){var{option:t,shapeType:n,propTransformer:s=EX,activeClassName:a="recharts-active-shape",isActive:i}=e,l=NX(e,jX),o;if(h.isValidElement(t))o=h.cloneElement(t,Uu(Uu({},l),TX(t)));else if(typeof t=="function")o=t(l);else if(bX(t)&&typeof t!="boolean"){var c=s(t,l);o=h.createElement(I1,{shapeType:n,elementProps:c})}else{var d=l;o=h.createElement(I1,{shapeType:n,elementProps:d})}return i?h.createElement(Jr,{className:a},o):o}var Sy=(e,t)=>{var n=vr();return(s,a)=>i=>{e==null||e(s,a,i),n(GE({activeIndex:String(a),activeDataKey:t,activeCoordinate:s.tooltipPosition}))}},_y=e=>{var t=vr();return(n,s)=>a=>{e==null||e(n,s,a),t(gV())}},Ey=(e,t)=>{var n=vr();return(s,a)=>i=>{e==null||e(s,a,i),n(xV({activeIndex:String(a),activeDataKey:t,activeCoordinate:s.tooltipPosition}))}};function Dy(e){var{fn:t,args:n}=e,s=vr(),a=jn();return h.useEffect(()=>{if(!a){var i=t(n);return s(hV(i)),()=>{s(pV(i))}}},[t,n,s,a]),null}var DD=()=>{};function TD(e){var{legendPayload:t}=e,n=vr(),s=jn();return h.useEffect(()=>s?DD:(n(o_(t)),()=>{n(c_(t))}),[n,s,t]),null}function AX(e){var{legendPayload:t}=e,n=vr(),s=tt(Qt);return h.useEffect(()=>s!=="centric"&&s!=="radial"?DD:(n(o_(t)),()=>{n(c_(t))}),[n,s,t]),null}function Ty(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"animation-",n=h.useRef(Qi(t)),s=h.useRef(e);return s.current!==e&&(n.current=Qi(t),s.current=e),n.current}var PX=["onMouseEnter","onClick","onMouseLeave"];function OX(e,t){if(e==null)return{};var n,s,a=MX(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function MX(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}function L1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function _r(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?L1(Object(n),!0).forEach(function(s){Um(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Um(e,t,n){return(t=IX(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function IX(e){var t=LX(e,"string");return typeof t=="symbol"?t:t+""}function LX(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function rl(){return rl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},rl.apply(null,arguments)}function RX(e){var t=h.useMemo(()=>$t(e,!1),[e]),n=h.useMemo(()=>Dc(e.children,Xl),[e.children]),s=h.useMemo(()=>({name:e.name,nameKey:e.nameKey,tooltipType:e.tooltipType,data:e.data,dataKey:e.dataKey,cx:e.cx,cy:e.cy,startAngle:e.startAngle,endAngle:e.endAngle,minAngle:e.minAngle,paddingAngle:e.paddingAngle,innerRadius:e.innerRadius,outerRadius:e.outerRadius,cornerRadius:e.cornerRadius,legendType:e.legendType,fill:e.fill,presentationProps:t}),[e.cornerRadius,e.cx,e.cy,e.data,e.dataKey,e.endAngle,e.innerRadius,e.minAngle,e.name,e.nameKey,e.outerRadius,e.paddingAngle,e.startAngle,e.tooltipType,e.legendType,e.fill,t]),a=tt(i=>ZK(i,s,n));return h.createElement(AX,{legendPayload:a})}function $X(e){var{dataKey:t,nameKey:n,sectors:s,stroke:a,strokeWidth:i,fill:l,name:o,hide:c,tooltipType:d}=e;return{dataDefinedOnItem:s==null?void 0:s.map(u=>u.tooltipPayload),positions:s==null?void 0:s.map(u=>u.tooltipPosition),settings:{stroke:a,strokeWidth:i,fill:l,dataKey:t,nameKey:n,name:ao(o,t),hide:c,type:d,color:l,unit:""}}}var FX=(e,t)=>e>t?"start":e<t?"end":"middle",zX=(e,t,n)=>typeof t=="function"?t(e):En(t,n,n*.8),BX=(e,t,n)=>{var{top:s,left:a,width:i,height:l}=t,o=Q2(i,l),c=a+En(e.cx,i,i/2),d=s+En(e.cy,l,l/2),u=En(e.innerRadius,o,0),m=zX(n,e.outerRadius,o),p=e.maxRadius||Math.sqrt(i*i+l*l)/2;return{cx:c,cy:d,innerRadius:u,outerRadius:m,maxRadius:p}},UX=(e,t)=>{var n=ln(t-e),s=Math.min(Math.abs(t-e),360);return n*s},qX=(e,t)=>{if(h.isValidElement(e))return h.cloneElement(e,t);if(typeof e=="function")return e(t);var n=xt("recharts-pie-label-line",typeof e!="boolean"?e.className:"");return h.createElement(h0,rl({},t,{type:"linear",className:n}))},HX=(e,t,n)=>{if(h.isValidElement(e))return h.cloneElement(e,t);var s=n;if(typeof e=="function"&&(s=e(t),h.isValidElement(s)))return s;var a=xt("recharts-pie-label-text",typeof e!="boolean"&&typeof e!="function"?e.className:"");return h.createElement(Bm,rl({},t,{alignmentBaseline:"middle",className:a}),s)};function WX(e){var{sectors:t,props:n,showLabels:s}=e,{label:a,labelLine:i,dataKey:l}=n;if(!s||!a||!t)return null;var o=$t(n,!1),c=$t(a,!1),d=$t(i,!1),u=typeof a=="object"&&"offsetRadius"in a&&a.offsetRadius||20,m=t.map((p,f)=>{var y=(p.startAngle+p.endAngle)/2,g=qr(p.cx,p.cy,p.outerRadius+u,y),x=_r(_r(_r(_r({},o),p),{},{stroke:"none"},c),{},{index:f,textAnchor:FX(g.x,p.cx)},g),b=_r(_r(_r(_r({},o),p),{},{fill:"none",stroke:p.fill},d),{},{index:f,points:[qr(p.cx,p.cy,p.outerRadius,y),g],key:"line"});return h.createElement(Jr,{key:"label-".concat(p.startAngle,"-").concat(p.endAngle,"-").concat(p.midAngle,"-").concat(f)},i&&qX(i,b),HX(a,x,yr(p,l)))});return h.createElement(Jr,{className:"recharts-pie-labels"},m)}function AD(e){var{sectors:t,activeShape:n,inactiveShape:s,allOtherPieProps:a,showLabels:i}=e,l=tt(xi),{onMouseEnter:o,onClick:c,onMouseLeave:d}=a,u=OX(a,PX),m=Sy(o,a.dataKey),p=_y(d),f=Ey(c,a.dataKey);return t==null?null:h.createElement(h.Fragment,null,t.map((y,g)=>{if((y==null?void 0:y.startAngle)===0&&(y==null?void 0:y.endAngle)===0&&t.length!==1)return null;var x=n&&String(g)===l,b=l?s:null,v=x?n:b,w=_r(_r({},y),{},{stroke:y.stroke,tabIndex:-1,[n_]:g,[s_]:a.dataKey});return h.createElement(Jr,rl({tabIndex:-1,className:"recharts-pie-sector"},Ec(u,y,g),{onMouseEnter:m(y,g),onMouseLeave:p(y,g),onClick:f(y,g),key:"sector-".concat(y==null?void 0:y.startAngle,"-").concat(y==null?void 0:y.endAngle,"-").concat(y.midAngle,"-").concat(g)}),h.createElement(ED,rl({option:v,isActive:x,shapeType:"sector"},w)))}),h.createElement(WX,{sectors:t,props:a,showLabels:i}))}function YX(e){var t,{pieSettings:n,displayedData:s,cells:a,offset:i}=e,{cornerRadius:l,startAngle:o,endAngle:c,dataKey:d,nameKey:u,tooltipType:m}=n,p=Math.abs(n.minAngle),f=UX(o,c),y=Math.abs(f),g=s.length<=1?0:(t=n.paddingAngle)!==null&&t!==void 0?t:0,x=s.filter(j=>yr(j,d,0)!==0).length,b=(y>=360?x:x-1)*g,v=y-x*p-b,w=s.reduce((j,S)=>{var _=yr(S,d,0);return j+(et(_)?_:0)},0),N;if(w>0){var k;N=s.map((j,S)=>{var _=yr(j,d,0),C=yr(j,u,S),D=BX(n,i,j),A=(et(_)?_:0)/w,E,T=_r(_r({},j),a&&a[S]&&a[S].props);S?E=k.endAngle+ln(f)*g*(_!==0?1:0):E=o;var M=E+ln(f)*((_!==0?p:0)+A*v),L=(E+M)/2,P=(D.innerRadius+D.outerRadius)/2,$=[{name:C,value:_,payload:T,dataKey:d,type:m}],R=qr(D.cx,D.cy,P,L);return k=_r(_r(_r(_r({},n.presentationProps),{},{percent:A,cornerRadius:l,name:C,tooltipPayload:$,midAngle:L,middleRadius:P,tooltipPosition:R},T),D),{},{value:yr(j,d),startAngle:E,endAngle:M,payload:T,paddingAngle:ln(f)*g}),k})}return N}function VX(e){var{props:t,previousSectorsRef:n}=e,{sectors:s,isAnimationActive:a,animationBegin:i,animationDuration:l,animationEasing:o,activeShape:c,inactiveShape:d,onAnimationStart:u,onAnimationEnd:m}=t,p=Ty(t,"recharts-pie-"),f=n.current,[y,g]=h.useState(!0),x=h.useCallback(()=>{typeof m=="function"&&m(),g(!1)},[m]),b=h.useCallback(()=>{typeof u=="function"&&u(),g(!0)},[u]);return h.createElement(pi,{begin:i,duration:l,isActive:a,easing:o,from:{t:0},to:{t:1},onAnimationStart:b,onAnimationEnd:x,key:p},v=>{var{t:w}=v,N=[],k=s&&s[0],j=k.startAngle;return s.forEach((S,_)=>{var C=f&&f[_],D=_>0?hi(S,"paddingAngle",0):0;if(C){var A=Jn(C.endAngle-C.startAngle,S.endAngle-S.startAngle),E=_r(_r({},S),{},{startAngle:j+D,endAngle:j+A(w)+D});N.push(E),j=E.endAngle}else{var{endAngle:T,startAngle:M}=S,L=Jn(0,T-M),P=L(w),$=_r(_r({},S),{},{startAngle:j+D,endAngle:j+P+D});N.push($),j=$.endAngle}}),n.current=N,h.createElement(Jr,null,h.createElement(AD,{sectors:N,activeShape:c,inactiveShape:d,allOtherPieProps:t,showLabels:!y}))})}function GX(e){var{sectors:t,isAnimationActive:n,activeShape:s,inactiveShape:a}=e,i=h.useRef(null),l=i.current;return n&&t&&t.length&&(!l||l!==t)?h.createElement(VX,{props:e,previousSectorsRef:i}):h.createElement(AD,{sectors:t,activeShape:s,inactiveShape:a,allOtherPieProps:e,showLabels:!0})}function KX(e){var{hide:t,className:n,rootTabIndex:s}=e,a=xt("recharts-pie",n);return t?null:h.createElement(Jr,{tabIndex:s,className:a},h.createElement(GX,e))}var PD={animationBegin:400,animationDuration:1500,animationEasing:"ease",cx:"50%",cy:"50%",dataKey:"value",endAngle:360,fill:"#808080",hide:!1,innerRadius:0,isAnimationActive:!il.isSsr,labelLine:!0,legendType:"rect",minAngle:0,nameKey:"name",outerRadius:"80%",paddingAngle:0,rootTabIndex:0,startAngle:0,stroke:"#fff"};function XX(e){var t=_s(e,PD),n=h.useMemo(()=>Dc(e.children,Xl),[e.children]),s=$t(t,!1),a=h.useMemo(()=>({name:t.name,nameKey:t.nameKey,tooltipType:t.tooltipType,data:t.data,dataKey:t.dataKey,cx:t.cx,cy:t.cy,startAngle:t.startAngle,endAngle:t.endAngle,minAngle:t.minAngle,paddingAngle:t.paddingAngle,innerRadius:t.innerRadius,outerRadius:t.outerRadius,cornerRadius:t.cornerRadius,legendType:t.legendType,fill:t.fill,presentationProps:s}),[t.cornerRadius,t.cx,t.cy,t.data,t.dataKey,t.endAngle,t.innerRadius,t.minAngle,t.name,t.nameKey,t.outerRadius,t.paddingAngle,t.startAngle,t.tooltipType,t.legendType,t.fill,s]),i=tt(l=>tX(l,a,n));return h.createElement(h.Fragment,null,h.createElement(Dy,{fn:$X,args:_r(_r({},t),{},{sectors:i})}),h.createElement(KX,rl({},t,{sectors:i})))}class qu extends h.PureComponent{constructor(){super(...arguments),Um(this,"id",Qi("recharts-pie-"))}render(){return h.createElement(h.Fragment,null,h.createElement(fX,{data:this.props.data,dataKey:this.props.dataKey,hide:this.props.hide,angleAxisId:0,radiusAxisId:0,stackId:void 0,barSize:void 0,type:"pie"}),h.createElement(RX,this.props),h.createElement(XX,this.props),this.props.children)}}Um(qu,"displayName","Pie");Um(qu,"defaultProps",PD);var JX=ve([Zr],e=>{if(e)return{top:e.top,bottom:e.bottom,left:e.left,right:e.right}}),QX=ve([JX,$a,Fa],(e,t,n)=>{if(!(!e||t==null||n==null))return{x:e.left,y:e.top,width:Math.max(0,t-e.left-e.right),height:Math.max(0,n-e.top-e.bottom)}}),ZX=e=>{var t=jn();return tt(n=>oa(n,"xAxis",e,t))},eJ=e=>{var t=jn();return tt(n=>oa(n,"yAxis",e,t))},Ay=()=>tt(QX),tJ=()=>tt(tG);function R1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function $1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?R1(Object(n),!0).forEach(function(s){rJ(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function rJ(e,t,n){return(t=nJ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function nJ(e){var t=sJ(e,"string");return typeof t=="symbol"?t:t+""}function sJ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var aJ=e=>{var{point:t,childIndex:n,mainColor:s,activeDot:a,dataKey:i}=e;if(a===!1||t.x==null||t.y==null)return null;var l=$1($1({index:n,dataKey:i,cx:t.x,cy:t.y,r:4,fill:s??"none",strokeWidth:2,stroke:"#fff",payload:t.payload,value:t.value},$t(a,!1)),qx(a)),o;return h.isValidElement(a)?o=h.cloneElement(a,l):typeof a=="function"?o=a(l):o=h.createElement(jD,l),h.createElement(Jr,{className:"recharts-active-dot"},o)};function iJ(e){var{points:t,mainColor:n,activeDot:s,itemDataKey:a}=e,i=tt(xi),l=tJ();if(t==null||l==null)return null;var o=t.find(c=>l.includes(c.payload));return mr(o)?null:aJ({point:o,childIndex:Number(i),mainColor:n,dataKey:a,activeDot:s})}var lJ=()=>{var e=vr();return h.useEffect(()=>(e(nX()),()=>{e(sX())})),null},oJ=["children"];function cJ(e,t){if(e==null)return{};var n,s,a=dJ(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function dJ(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}var F1=()=>{},OD=h.createContext({addErrorBar:F1,removeErrorBar:F1}),uJ={data:[],xAxisId:"xAxis-0",yAxisId:"yAxis-0",dataPointFormatter:()=>({x:0,y:0,value:0}),errorBarOffset:0},MD=h.createContext(uJ);function ID(e){var{children:t}=e,n=cJ(e,oJ);return h.createElement(MD.Provider,{value:n},t)}var mJ=()=>h.useContext(MD),LD=e=>{var{children:t,xAxisId:n,yAxisId:s,zAxisId:a,dataKey:i,data:l,stackId:o,hide:c,type:d,barSize:u}=e,[m,p]=h.useState([]),f=h.useCallback(x=>{p(b=>[...b,x])},[p]),y=h.useCallback(x=>{p(b=>b.filter(v=>v!==x))},[p]),g=jn();return h.createElement(OD.Provider,{value:{addErrorBar:f,removeErrorBar:y}},h.createElement(pX,{type:d,data:l,xAxisId:n,yAxisId:s,zAxisId:a,dataKey:i,errorBars:m,stackId:o,hide:c,barSize:u,isPanorama:g}),t)};function hJ(e){var{addErrorBar:t,removeErrorBar:n}=h.useContext(OD);return h.useEffect(()=>(t(e),()=>{n(e)}),[t,n,e]),null}var pJ=["direction","width","dataKey","isAnimationActive","animationBegin","animationDuration","animationEasing"];function RD(e,t,n){return(t=fJ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fJ(e){var t=gJ(e,"string");return typeof t=="symbol"?t:t+""}function gJ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function mc(){return mc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},mc.apply(null,arguments)}function xJ(e,t){if(e==null)return{};var n,s,a=yJ(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function yJ(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}function bJ(e){var{direction:t,width:n,dataKey:s,isAnimationActive:a,animationBegin:i,animationDuration:l,animationEasing:o}=e,c=xJ(e,pJ),d=$t(c,!1),{data:u,dataPointFormatter:m,xAxisId:p,yAxisId:f,errorBarOffset:y}=mJ(),g=ZX(p),x=eJ(f);if((g==null?void 0:g.scale)==null||(x==null?void 0:x.scale)==null||u==null||t==="x"&&g.type!=="number")return null;var b=u.map(v=>{var{x:w,y:N,value:k,errorVal:j}=m(v,s,t);if(!j)return null;var S=[],_,C;if(Array.isArray(j)?[_,C]=j:_=C=j,t==="x"){var{scale:D}=g,A=N+y,E=A+n,T=A-n,M=D(k-_),L=D(k+C);S.push({x1:L,y1:E,x2:L,y2:T}),S.push({x1:M,y1:A,x2:L,y2:A}),S.push({x1:M,y1:E,x2:M,y2:T})}else if(t==="y"){var{scale:P}=x,$=w+y,R=$-n,U=$+n,I=P(k-_),z=P(k+C);S.push({x1:R,y1:z,x2:U,y2:z}),S.push({x1:$,y1:I,x2:$,y2:z}),S.push({x1:R,y1:I,x2:U,y2:I})}var F="".concat(w+y,"px ").concat(N+y,"px");return h.createElement(Jr,mc({className:"recharts-errorBar",key:"bar-".concat(S.map(O=>"".concat(O.x1,"-").concat(O.x2,"-").concat(O.y1,"-").concat(O.y2)))},d),S.map(O=>{var K=a?{transformOrigin:"".concat(O.x1-5,"px")}:void 0;return h.createElement(pi,{from:{transform:"scaleY(0)",transformOrigin:F},to:{transform:"scaleY(1)",transformOrigin:F},begin:i,easing:o,isActive:a,duration:l,key:"line-".concat(O.x1,"-").concat(O.x2,"-").concat(O.y1,"-").concat(O.y2),style:{transformOrigin:F}},h.createElement("line",mc({},O,{style:K})))}))});return h.createElement(Jr,{className:"recharts-errorBars"},b)}var $D=h.createContext(void 0);function vJ(e){var t=h.useContext($D);return e??t??"x"}function FD(e){var{direction:t,children:n}=e;return h.createElement($D.Provider,{value:t},n)}var zD={stroke:"black",strokeWidth:1.5,width:5,offset:0,isAnimationActive:!0,animationBegin:0,animationDuration:400,animationEasing:"ease-in-out"};function wJ(e){var t=vJ(e.direction),{width:n,isAnimationActive:s,animationBegin:a,animationDuration:i,animationEasing:l}=_s(e,zD);return h.createElement(h.Fragment,null,h.createElement(hJ,{dataKey:e.dataKey,direction:t}),h.createElement(bJ,mc({},e,{direction:t,width:n,isAnimationActive:s,animationBegin:a,animationDuration:i,animationEasing:l})))}class BD extends h.Component{render(){return h.createElement(wJ,this.props)}}RD(BD,"defaultProps",zD);RD(BD,"displayName","ErrorBar");var jJ="Invariant failed";function NJ(e,t){throw new Error(jJ)}var CJ=["x","y"];function zg(){return zg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},zg.apply(null,arguments)}function z1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Mo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?z1(Object(n),!0).forEach(function(s){kJ(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function kJ(e,t,n){return(t=SJ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function SJ(e){var t=_J(e,"string");return typeof t=="symbol"?t:t+""}function _J(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function EJ(e,t){if(e==null)return{};var n,s,a=DJ(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function DJ(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}function TJ(e,t){var{x:n,y:s}=e,a=EJ(e,CJ),i="".concat(n),l=parseInt(i,10),o="".concat(s),c=parseInt(o,10),d="".concat(t.height||a.height),u=parseInt(d,10),m="".concat(t.width||a.width),p=parseInt(m,10);return Mo(Mo(Mo(Mo(Mo({},t),a),l?{x:l}:{}),c?{y:c}:{}),{},{height:u,width:p,name:t.name,radius:t.radius})}function UD(e){return h.createElement(ED,zg({shapeType:"rectangle",propTransformer:TJ,activeClassName:"recharts-active-bar"},e))}var AJ=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(s,a)=>{if(et(t))return t;var i=et(s)||mr(s);return i?t(s,a):(i||NJ(),n)}};function Py(e,t){var n,s,a=tt(d=>ha(d,e)),i=tt(d=>Ba(d,t)),l=(n=a==null?void 0:a.allowDataOverflow)!==null&&n!==void 0?n:Gn.allowDataOverflow,o=(s=i==null?void 0:i.allowDataOverflow)!==null&&s!==void 0?s:Kn.allowDataOverflow,c=l||o;return{needClip:c,needClipX:l,needClipY:o}}function qD(e){var{xAxisId:t,yAxisId:n,clipPathId:s}=e,a=Ay(),{needClipX:i,needClipY:l,needClip:o}=Py(t,n);if(!o)return null;var{x:c,y:d,width:u,height:m}=a;return h.createElement("clipPath",{id:"clipPath-".concat(s)},h.createElement("rect",{x:i?c:c-u/2,y:l?d:d-m/2,width:i?u:u*2,height:l?m:m*2}))}var PJ=["onMouseEnter","onMouseLeave","onClick"],OJ=["value","background","tooltipPosition"],MJ=["onMouseEnter","onClick","onMouseLeave"];function hc(){return hc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},hc.apply(null,arguments)}function B1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function xn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?B1(Object(n),!0).forEach(function(s){qm(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function qm(e,t,n){return(t=IJ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function IJ(e){var t=LJ(e,"string");return typeof t=="symbol"?t:t+""}function LJ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Bg(e,t){if(e==null)return{};var n,s,a=RJ(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function RJ(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}var $J=e=>{var{dataKey:t,name:n,fill:s,legendType:a,hide:i}=e;return[{inactive:i,dataKey:t,type:a,color:s,value:ao(n,t),payload:e}]};function FJ(e){var{dataKey:t,stroke:n,strokeWidth:s,fill:a,name:i,hide:l,unit:o}=e;return{dataDefinedOnItem:void 0,positions:void 0,settings:{stroke:n,strokeWidth:s,fill:a,dataKey:t,nameKey:void 0,name:ao(i,t),hide:l,type:e.tooltipType,color:e.fill,unit:o}}}function zJ(e){var t=tt(xi),{data:n,dataKey:s,background:a,allOtherBarProps:i}=e,{onMouseEnter:l,onMouseLeave:o,onClick:c}=i,d=Bg(i,PJ),u=Sy(l,s),m=_y(o),p=Ey(c,s);if(!a||n==null)return null;var f=$t(a,!1);return h.createElement(h.Fragment,null,n.map((y,g)=>{var{value:x,background:b,tooltipPosition:v}=y,w=Bg(y,OJ);if(!b)return null;var N=u(y,g),k=m(y,g),j=p(y,g),S=xn(xn(xn(xn(xn({option:a,isActive:String(g)===t},w),{},{fill:"#eee"},b),f),Ec(d,y,g)),{},{onMouseEnter:N,onMouseLeave:k,onClick:j,dataKey:s,index:g,className:"recharts-bar-background-rectangle"});return h.createElement(UD,hc({key:"background-bar-".concat(g)},S))}))}function HD(e){var{data:t,props:n,showLabels:s}=e,a=$t(n,!1),{shape:i,dataKey:l,activeBar:o}=n,c=tt(xi),d=tt(lD),{onMouseEnter:u,onClick:m,onMouseLeave:p}=n,f=Bg(n,MJ),y=Sy(u,l),g=_y(p),x=Ey(m,l);return t?h.createElement(h.Fragment,null,t.map((b,v)=>{var w=o&&String(v)===c&&(d==null||l===d),N=w?o:i,k=xn(xn(xn({},a),b),{},{isActive:w,option:N,index:v,dataKey:l});return h.createElement(Jr,hc({className:"recharts-bar-rectangle"},Ec(f,b,v),{onMouseEnter:y(b,v),onMouseLeave:g(b,v),onClick:x(b,v),key:"rectangle-".concat(b==null?void 0:b.x,"-").concat(b==null?void 0:b.y,"-").concat(b==null?void 0:b.value,"-").concat(v)}),h.createElement(UD,k))}),s&&oi.renderCallByParent(n,t)):null}function BJ(e){var{props:t,previousRectanglesRef:n}=e,{data:s,layout:a,isAnimationActive:i,animationBegin:l,animationDuration:o,animationEasing:c,onAnimationEnd:d,onAnimationStart:u}=t,m=n.current,p=Ty(t,"recharts-bar-"),[f,y]=h.useState(!1),g=h.useCallback(()=>{typeof d=="function"&&d(),y(!1)},[d]),x=h.useCallback(()=>{typeof u=="function"&&u(),y(!0)},[u]);return h.createElement(pi,{begin:l,duration:o,isActive:i,easing:c,from:{t:0},to:{t:1},onAnimationEnd:g,onAnimationStart:x,key:p},b=>{var{t:v}=b,w=v===1?s:s.map((N,k)=>{var j=m&&m[k];if(j){var S=Jn(j.x,N.x),_=Jn(j.y,N.y),C=Jn(j.width,N.width),D=Jn(j.height,N.height);return xn(xn({},N),{},{x:S(v),y:_(v),width:C(v),height:D(v)})}if(a==="horizontal"){var A=Jn(0,N.height),E=A(v);return xn(xn({},N),{},{y:N.y+N.height-E,height:E})}var T=Jn(0,N.width),M=T(v);return xn(xn({},N),{},{width:M})});return v>0&&(n.current=w),h.createElement(Jr,null,h.createElement(HD,{props:t,data:w,showLabels:!f}))})}function UJ(e){var{data:t,isAnimationActive:n}=e,s=h.useRef(null);return n&&t&&t.length&&(s.current==null||s.current!==t)?h.createElement(BJ,{previousRectanglesRef:s,props:e}):h.createElement(HD,{props:e,data:t,showLabels:!0})}var WD=0,qJ=(e,t)=>{var n=Array.isArray(e.value)?e.value[1]:e.value;return{x:e.x,y:e.y,value:n,errorVal:yr(e,t)}};class HJ extends h.PureComponent{constructor(){super(...arguments),qm(this,"id",Qi("recharts-bar-"))}render(){var{hide:t,data:n,dataKey:s,className:a,xAxisId:i,yAxisId:l,needClip:o,background:c,id:d,layout:u}=this.props;if(t)return null;var m=xt("recharts-bar",a),p=mr(d)?this.id:d;return h.createElement(Jr,{className:m},o&&h.createElement("defs",null,h.createElement(qD,{clipPathId:p,xAxisId:i,yAxisId:l})),h.createElement(Jr,{className:"recharts-bar-rectangles",clipPath:o?"url(#clipPath-".concat(p,")"):null},h.createElement(zJ,{data:n,dataKey:s,background:c,allOtherBarProps:this.props}),h.createElement(UJ,this.props)),h.createElement(FD,{direction:u==="horizontal"?"y":"x"},this.props.children))}}var YD={activeBar:!1,animationBegin:0,animationDuration:400,animationEasing:"ease",hide:!1,isAnimationActive:!il.isSsr,legendType:"rect",minPointSize:WD,xAxisId:0,yAxisId:0};function WJ(e){var{xAxisId:t,yAxisId:n,hide:s,legendType:a,minPointSize:i,activeBar:l,animationBegin:o,animationDuration:c,animationEasing:d,isAnimationActive:u}=_s(e,YD),{needClip:m}=Py(t,n),p=Cm(),f=jn(),y=h.useMemo(()=>({barSize:e.barSize,data:void 0,dataKey:e.dataKey,maxBarSize:e.maxBarSize,minPointSize:i,stackId:t_(e.stackId)}),[e.barSize,e.dataKey,e.maxBarSize,i,e.stackId]),g=Dc(e.children,Xl),x=tt(w=>bQ(w,t,n,f,y,g));if(p!=="vertical"&&p!=="horizontal")return null;var b,v=x==null?void 0:x[0];return v==null||v.height==null||v.width==null?b=0:b=p==="vertical"?v.height/2:v.width/2,h.createElement(ID,{xAxisId:t,yAxisId:n,data:x,dataPointFormatter:qJ,errorBarOffset:b},h.createElement(HJ,hc({},e,{layout:p,needClip:m,data:x,xAxisId:t,yAxisId:n,hide:s,legendType:a,minPointSize:i,activeBar:l,animationBegin:o,animationDuration:c,animationEasing:d,isAnimationActive:u})))}function YJ(e){var{layout:t,barSettings:{dataKey:n,minPointSize:s},pos:a,bandSize:i,xAxis:l,yAxis:o,xAxisTicks:c,yAxisTicks:d,stackedData:u,displayedData:m,offset:p,cells:f}=e,y=t==="horizontal"?o:l,g=u?y.scale.domain():null,x=EU({numericAxis:y});return m.map((b,v)=>{var w,N,k,j,S,_;u?w=NU(u[v],g):(w=yr(b,n),Array.isArray(w)||(w=[x,w]));var C=AJ(s,WD)(w[1],v);if(t==="horizontal"){var D,[A,E]=[o.scale(w[0]),o.scale(w[1])];N=Sj({axis:l,ticks:c,bandSize:i,offset:a.offset,entry:b,index:v}),k=(D=E??A)!==null&&D!==void 0?D:void 0,j=a.size;var T=A-E;if(S=Tn(T)?0:T,_={x:N,y:p.top,width:j,height:p.height},Math.abs(C)>0&&Math.abs(S)<Math.abs(C)){var M=ln(S||C)*(Math.abs(C)-Math.abs(S));k-=M,S+=M}}else{var[L,P]=[l.scale(w[0]),l.scale(w[1])];if(N=L,k=Sj({axis:o,ticks:d,bandSize:i,offset:a.offset,entry:b,index:v}),j=P-L,S=a.size,_={x:p.left,y:k,width:p.width,height:S},Math.abs(C)>0&&Math.abs(j)<Math.abs(C)){var $=ln(j||C)*(Math.abs(C)-Math.abs(j));j+=$}}var R=xn(xn({},b),{},{x:N,y:k,width:j,height:S,value:u?w:w[1],payload:b,background:_,tooltipPosition:{x:N+j/2,y:k+S/2}},f&&f[v]&&f[v].props);return R})}class Al extends h.PureComponent{render(){return h.createElement(LD,{type:"bar",data:null,xAxisId:this.props.xAxisId,yAxisId:this.props.yAxisId,zAxisId:0,dataKey:this.props.dataKey,stackId:this.props.stackId,hide:this.props.hide,barSize:this.props.barSize},h.createElement(lJ,null),h.createElement(TD,{legendPayload:$J(this.props)}),h.createElement(Dy,{fn:FJ,args:this.props}),h.createElement(WJ,this.props))}}qm(Al,"displayName","Bar");qm(Al,"defaultProps",YD);function U1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function xd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?U1(Object(n),!0).forEach(function(s){VJ(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function VJ(e,t,n){return(t=GJ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function GJ(e){var t=KJ(e,"string");return typeof t=="symbol"?t:t+""}function KJ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var XJ=(e,t)=>t,JJ=(e,t,n)=>n,QJ=(e,t,n,s)=>s,Oy=(e,t,n,s,a)=>a,ZJ=(e,t,n,s,a)=>a.maxBarSize,eQ=(e,t,n,s,a,i)=>i,q1=(e,t,n)=>{var s=n??e;if(!mr(s))return En(s,t,0)},tQ=ve([Qt,Mm,XJ,JJ,QJ],(e,t,n,s,a)=>t.filter(i=>e==="horizontal"?i.xAxisId===n:i.yAxisId===s).filter(i=>i.isPanorama===a).filter(i=>i.hide===!1).filter(i=>i.type==="bar")),rQ=(e,t,n,s)=>{var a=Qt(e);return a==="horizontal"?Pg(e,"yAxis",n,s):Pg(e,"xAxis",t,s)},nQ=(e,t,n)=>{var s=Qt(e);return s==="horizontal"?WN(e,"xAxis",t):WN(e,"yAxis",n)};function sQ(e){return e.stackId!=null&&e.dataKey!=null}var aQ=(e,t,n)=>{var s={},a=e.filter(sQ),i=e.filter(d=>d.stackId==null),l=a.reduce((d,u)=>(d[u.stackId]||(d[u.stackId]=[]),d[u.stackId].push(u),d),s),o=Object.entries(l).map(d=>{var[u,m]=d,p=m.map(y=>y.dataKey),f=q1(t,n,m[0].barSize);return{stackId:u,dataKeys:p,barSize:f}}),c=i.map(d=>{var u=[d.dataKey].filter(p=>p!=null),m=q1(t,n,d.barSize);return{stackId:void 0,dataKeys:u,barSize:m}});return[...o,...c]},iQ=ve([tQ,mY,nQ],aQ),lQ=(e,t,n,s,a)=>{var i,l,o=Qt(e),c=hE(e),{maxBarSize:d}=a,u=mr(d)?c:d,m,p;return o==="horizontal"?(m=oa(e,"xAxis",t,s),p=gi(e,"xAxis",t,s)):(m=oa(e,"yAxis",n,s),p=gi(e,"yAxis",n,s)),(i=(l=nc(m,p,!0))!==null&&l!==void 0?l:u)!==null&&i!==void 0?i:0},VD=(e,t,n,s)=>{var a=Qt(e),i,l;return a==="horizontal"?(i=oa(e,"xAxis",t,s),l=gi(e,"xAxis",t,s)):(i=oa(e,"yAxis",n,s),l=gi(e,"yAxis",n,s)),nc(i,l)};function oQ(e,t,n,s,a){var i=s.length;if(!(i<1)){var l=En(e,n,0,!0),o,c=[];if(ss(s[0].barSize)){var d=!1,u=n/i,m=s.reduce((b,v)=>b+(v.barSize||0),0);m+=(i-1)*l,m>=n&&(m-=(i-1)*l,l=0),m>=n&&u>0&&(d=!0,u*=.9,m=i*u);var p=(n-m)/2>>0,f={offset:p-l,size:0};o=s.reduce((b,v)=>{var w,N={stackId:v.stackId,dataKeys:v.dataKeys,position:{offset:f.offset+f.size+l,size:d?u:(w=v.barSize)!==null&&w!==void 0?w:0}},k=[...b,N];return f=k[k.length-1].position,k},c)}else{var y=En(t,n,0,!0);n-2*y-(i-1)*l<=0&&(l=0);var g=(n-2*y-(i-1)*l)/i;g>1&&(g>>=0);var x=ss(a)?Math.min(g,a):g;o=s.reduce((b,v,w)=>[...b,{stackId:v.stackId,dataKeys:v.dataKeys,position:{offset:y+(g+l)*w+(g-x)/2,size:x}}],c)}return o}}var cQ=(e,t,n,s,a,i,l)=>{var o=mr(l)?t:l,c=oQ(n,s,a!==i?a:i,e,o);return a!==i&&c!=null&&(c=c.map(d=>xd(xd({},d),{},{position:xd(xd({},d.position),{},{offset:d.position.offset-a/2})}))),c},dQ=ve([iQ,hE,uY,pE,lQ,VD,ZJ],cQ),uQ=(e,t,n,s)=>oa(e,"xAxis",t,s),mQ=(e,t,n,s)=>oa(e,"yAxis",n,s),hQ=(e,t,n,s)=>gi(e,"xAxis",t,s),pQ=(e,t,n,s)=>gi(e,"yAxis",n,s),fQ=ve([dQ,Oy],(e,t)=>{if(e!=null){var n=e.find(s=>s.stackId===t.stackId&&s.dataKeys.includes(t.dataKey));if(n!=null)return n.position}}),gQ=(e,t)=>{if(!(!e||(t==null?void 0:t.dataKey)==null)){var{stackId:n}=t;if(n!=null){var s=e[n];if(s){var{stackedData:a}=s;if(a){var i=a.find(l=>l.key===t.dataKey);return i}}}}},xQ=ve([Mm,Oy],(e,t)=>{if(e.some(n=>n.type==="bar"&&t.dataKey===n.dataKey&&t.stackId===n.stackId&&t.stackId===n.stackId))return t}),yQ=ve([rQ,Oy],gQ),bQ=ve([Zr,uQ,mQ,hQ,pQ,fQ,Qt,F0,VD,yQ,xQ,eQ],(e,t,n,s,a,i,l,o,c,d,u,m)=>{var{chartData:p,dataStartIndex:f,dataEndIndex:y}=o;if(!(u==null||i==null||l!=="horizontal"&&l!=="vertical"||t==null||n==null||s==null||a==null||c==null)){var{data:g}=u,x;if(g!=null&&g.length>0?x=g:x=p==null?void 0:p.slice(f,y+1),x!=null)return YJ({layout:l,barSettings:u,pos:i,bandSize:c,xAxis:t,yAxis:n,xAxisTicks:s,yAxisTicks:a,stackedData:d,displayedData:x,offset:e,cells:m})}}),GD=e=>{var{chartData:t}=e,n=vr(),s=jn();return h.useEffect(()=>s?()=>{}:(n(t1(t)),()=>{n(t1(void 0))}),[t,n,s]),null},H1={x:0,y:0,width:0,height:0,padding:{top:0,right:0,bottom:0,left:0}},KD=Ss({name:"brush",initialState:H1,reducers:{setBrushSettings(e,t){return t.payload==null?H1:t.payload}}}),{setBrushSettings:$se}=KD.actions,vQ=KD.reducer;function W1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function yd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?W1(Object(n),!0).forEach(function(s){XD(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function XD(e,t,n){return(t=wQ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wQ(e){var t=jQ(e,"string");return typeof t=="symbol"?t:t+""}function jQ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var NQ=(e,t)=>{var{x:n,y:s}=e,{x:a,y:i}=t;return{x:Math.min(n,a),y:Math.min(s,i),width:Math.abs(a-n),height:Math.abs(i-s)}},CQ=e=>{var{x1:t,y1:n,x2:s,y2:a}=e;return NQ({x:t,y:n},{x:s,y:a})};class Hm{static create(t){return new Hm(t)}constructor(t){this.scale=t}get domain(){return this.scale.domain}get range(){return this.scale.range}get rangeMin(){return this.range()[0]}get rangeMax(){return this.range()[1]}get bandwidth(){return this.scale.bandwidth}apply(t){var{bandAware:n,position:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t!==void 0){if(s)switch(s){case"start":return this.scale(t);case"middle":{var a=this.bandwidth?this.bandwidth()/2:0;return this.scale(t)+a}case"end":{var i=this.bandwidth?this.bandwidth():0;return this.scale(t)+i}default:return this.scale(t)}if(n){var l=this.bandwidth?this.bandwidth()/2:0;return this.scale(t)+l}return this.scale(t)}}isInRange(t){var n=this.range(),s=n[0],a=n[n.length-1];return s<=a?t>=s&&t<=a:t>=a&&t<=s}}XD(Hm,"EPS",1e-4);var kQ=e=>{var t=Object.keys(e).reduce((n,s)=>yd(yd({},n),{},{[s]:Hm.create(e[s])}),{});return yd(yd({},t),{},{apply(n){var{bandAware:s,position:a}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.fromEntries(Object.entries(n).map(i=>{var[l,o]=i;return[l,t[l].apply(o,{bandAware:s,position:a})]}))},isInRange(n){return Object.keys(n).every(s=>t[s].isInRange(n[s]))}})};function SQ(e){return(e%180+180)%180}var _Q=function(t){var{width:n,height:s}=t,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=SQ(a),l=i*Math.PI/180,o=Math.atan(s/n),c=l>o&&l<Math.PI-o?s/Math.sin(l):n/Math.cos(l);return Math.abs(c)},EQ={dots:[],areas:[],lines:[]},JD=Ss({name:"referenceElements",initialState:EQ,reducers:{addDot:(e,t)=>{e.dots.push(t.payload)},removeDot:(e,t)=>{var n=Sa(e).dots.findIndex(s=>s===t.payload);n!==-1&&e.dots.splice(n,1)},addArea:(e,t)=>{e.areas.push(t.payload)},removeArea:(e,t)=>{var n=Sa(e).areas.findIndex(s=>s===t.payload);n!==-1&&e.areas.splice(n,1)},addLine:(e,t)=>{e.lines.push(t.payload)},removeLine:(e,t)=>{var n=Sa(e).lines.findIndex(s=>s===t.payload);n!==-1&&e.lines.splice(n,1)}}}),{addDot:Fse,removeDot:zse,addArea:Bse,removeArea:Use,addLine:DQ,removeLine:TQ}=JD.actions,AQ=JD.reducer,QD=h.createContext(void 0),PQ=e=>{var{children:t}=e,[n]=h.useState("".concat(Qi("recharts"),"-clip")),s=Ay();if(s==null)return null;var{x:a,y:i,width:l,height:o}=s;return h.createElement(QD.Provider,{value:n},h.createElement("defs",null,h.createElement("clipPath",{id:n},h.createElement("rect",{x:a,y:i,height:o,width:l}))),t)},OQ=()=>h.useContext(QD);function Y1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function V1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Y1(Object(n),!0).forEach(function(s){My(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function My(e,t,n){return(t=MQ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function MQ(e){var t=IQ(e,"string");return typeof t=="symbol"?t:t+""}function IQ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ug(){return Ug=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Ug.apply(null,arguments)}var LQ=(e,t)=>{var n;return h.isValidElement(e)?n=h.cloneElement(e,t):typeof e=="function"?n=e(t):n=h.createElement("line",Ug({},t,{className:"recharts-reference-line-line"})),n},RQ=(e,t,n,s,a,i,l,o,c)=>{var{x:d,y:u,width:m,height:p}=a;if(n){var{y:f}=c,y=e.y.apply(f,{position:i});if(Tn(y)||c.ifOverflow==="discard"&&!e.y.isInRange(y))return null;var g=[{x:d+m,y},{x:d,y}];return o==="left"?g.reverse():g}if(t){var{x}=c,b=e.x.apply(x,{position:i});if(Tn(b)||c.ifOverflow==="discard"&&!e.x.isInRange(b))return null;var v=[{x:b,y:u+p},{x:b,y:u}];return l==="top"?v.reverse():v}if(s){var{segment:w}=c,N=w.map(k=>e.apply(k,{position:i}));return c.ifOverflow==="discard"&&N.some(k=>!e.isInRange(k))?null:N}return null};function $Q(e){var t=vr();return h.useEffect(()=>(t(DQ(e)),()=>{t(TQ(e))})),null}function FQ(e){var{x:t,y:n,segment:s,xAxisId:a,yAxisId:i,shape:l,className:o,ifOverflow:c}=e,d=jn(),u=OQ(),m=tt(A=>ha(A,a)),p=tt(A=>Ba(A,i)),f=tt(A=>fi(A,"xAxis",a,d)),y=tt(A=>fi(A,"yAxis",i,d)),g=Nm(),x=js(t),b=js(n);if(!u||!g||m==null||p==null||f==null||y==null)return null;var v=kQ({x:f,y}),w=s&&s.length===2,N=RQ(v,x,b,w,g,e.position,m.orientation,p.orientation,e);if(!N)return null;var[{x:k,y:j},{x:S,y:_}]=N,C=c==="hidden"?"url(#".concat(u,")"):void 0,D=V1(V1({clipPath:C},$t(e,!0)),{},{x1:k,y1:j,x2:S,y2:_});return h.createElement(Jr,{className:xt("recharts-reference-line",o)},LQ(l,D),Rn.renderCallByParent(e,CQ({x1:k,y1:j,x2:S,y2:_})))}function zQ(e){return h.createElement(h.Fragment,null,h.createElement($Q,{yAxisId:e.yAxisId,xAxisId:e.xAxisId,ifOverflow:e.ifOverflow,x:e.x,y:e.y}),h.createElement(FQ,e))}class Iy extends h.Component{render(){return h.createElement(zQ,this.props)}}My(Iy,"displayName","ReferenceLine");My(Iy,"defaultProps",{ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function df(e,t){for(var n in e)if({}.hasOwnProperty.call(e,n)&&(!{}.hasOwnProperty.call(t,n)||e[n]!==t[n]))return!1;for(var s in t)if({}.hasOwnProperty.call(t,s)&&!{}.hasOwnProperty.call(e,s))return!1;return!0}function ZD(e,t,n){if(t<1)return[];if(t===1&&n===void 0)return e;for(var s=[],a=0;a<e.length;a+=t)s.push(e[a]);return s}function BQ(e,t,n){var s={width:e.width+t.width,height:e.height+t.height};return _Q(s,n)}function UQ(e,t,n){var s=n==="width",{x:a,y:i,width:l,height:o}=e;return t===1?{start:s?a:i,end:s?a+l:i+o}:{start:s?a+l:i+o,end:s?a:i}}function Hu(e,t,n,s,a){if(e*t<e*s||e*t>e*a)return!1;var i=n();return e*(t-e*i/2-s)>=0&&e*(t+e*i/2-a)<=0}function qQ(e,t){return ZD(e,t+1)}function HQ(e,t,n,s,a){for(var i=(s||[]).slice(),{start:l,end:o}=t,c=0,d=1,u=l,m=function(){var y=s==null?void 0:s[c];if(y===void 0)return{v:ZD(s,d)};var g=c,x,b=()=>(x===void 0&&(x=n(y,g)),x),v=y.coordinate,w=c===0||Hu(e,v,b,u,o);w||(c=0,u=l,d+=1),w&&(u=v+e*(b()/2+a),c+=d)},p;d<=i.length;)if(p=m(),p)return p.v;return[]}function G1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function gn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?G1(Object(n),!0).forEach(function(s){WQ(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function WQ(e,t,n){return(t=YQ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function YQ(e){var t=VQ(e,"string");return typeof t=="symbol"?t:t+""}function VQ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function GQ(e,t,n,s,a){for(var i=(s||[]).slice(),l=i.length,{start:o}=t,{end:c}=t,d=function(p){var f=i[p],y,g=()=>(y===void 0&&(y=n(f,p)),y);if(p===l-1){var x=e*(f.coordinate+e*g()/2-c);i[p]=f=gn(gn({},f),{},{tickCoord:x>0?f.coordinate-x*e:f.coordinate})}else i[p]=f=gn(gn({},f),{},{tickCoord:f.coordinate});var b=Hu(e,f.tickCoord,g,o,c);b&&(c=f.tickCoord-e*(g()/2+a),i[p]=gn(gn({},f),{},{isShow:!0}))},u=l-1;u>=0;u--)d(u);return i}function KQ(e,t,n,s,a,i){var l=(s||[]).slice(),o=l.length,{start:c,end:d}=t;if(i){var u=s[o-1],m=n(u,o-1),p=e*(u.coordinate+e*m/2-d);l[o-1]=u=gn(gn({},u),{},{tickCoord:p>0?u.coordinate-p*e:u.coordinate});var f=Hu(e,u.tickCoord,()=>m,c,d);f&&(d=u.tickCoord-e*(m/2+a),l[o-1]=gn(gn({},u),{},{isShow:!0}))}for(var y=i?o-1:o,g=function(v){var w=l[v],N,k=()=>(N===void 0&&(N=n(w,v)),N);if(v===0){var j=e*(w.coordinate-e*k()/2-c);l[v]=w=gn(gn({},w),{},{tickCoord:j<0?w.coordinate-j*e:w.coordinate})}else l[v]=w=gn(gn({},w),{},{tickCoord:w.coordinate});var S=Hu(e,w.tickCoord,k,c,d);S&&(c=w.tickCoord+e*(k()/2+a),l[v]=gn(gn({},w),{},{isShow:!0}))},x=0;x<y;x++)g(x);return l}function Ly(e,t,n){var{tick:s,ticks:a,viewBox:i,minTickGap:l,orientation:o,interval:c,tickFormatter:d,unit:u,angle:m}=e;if(!a||!a.length||!s)return[];if(et(c)||il.isSsr){var p;return(p=qQ(a,et(c)?c:0))!==null&&p!==void 0?p:[]}var f=[],y=o==="top"||o==="bottom"?"width":"height",g=u&&y==="width"?Go(u,{fontSize:t,letterSpacing:n}):{width:0,height:0},x=(w,N)=>{var k=typeof d=="function"?d(w.value,N):w.value;return y==="width"?BQ(Go(k,{fontSize:t,letterSpacing:n}),g,m):Go(k,{fontSize:t,letterSpacing:n})[y]},b=a.length>=2?ln(a[1].coordinate-a[0].coordinate):1,v=UQ(i,b,y);return c==="equidistantPreserveStart"?HQ(b,v,x,a,l):(c==="preserveStart"||c==="preserveStartEnd"?f=KQ(b,v,x,a,l,c==="preserveStartEnd"):f=GQ(b,v,x,a,l),f.filter(w=>w.isShow))}var XQ=["viewBox"],JQ=["viewBox"];function jl(){return jl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},jl.apply(null,arguments)}function K1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Vr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?K1(Object(n),!0).forEach(function(s){Ry(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function X1(e,t){if(e==null)return{};var n,s,a=QQ(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function QQ(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}function Ry(e,t,n){return(t=ZQ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ZQ(e){var t=eZ(e,"string");return typeof t=="symbol"?t:t+""}function eZ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}class ji extends h.Component{constructor(t){super(t),this.tickRefs=h.createRef(),this.tickRefs.current=[],this.state={fontSize:"",letterSpacing:""}}shouldComponentUpdate(t,n){var{viewBox:s}=t,a=X1(t,XQ),i=this.props,{viewBox:l}=i,o=X1(i,JQ);return!df(s,l)||!df(a,o)||!df(n,this.state)}getTickLineCoord(t){var{x:n,y:s,width:a,height:i,orientation:l,tickSize:o,mirror:c,tickMargin:d}=this.props,u,m,p,f,y,g,x=c?-1:1,b=t.tickSize||o,v=et(t.tickCoord)?t.tickCoord:t.coordinate;switch(l){case"top":u=m=t.coordinate,f=s+ +!c*i,p=f-x*b,g=p-x*d,y=v;break;case"left":p=f=t.coordinate,m=n+ +!c*a,u=m-x*b,y=u-x*d,g=v;break;case"right":p=f=t.coordinate,m=n+ +c*a,u=m+x*b,y=u+x*d,g=v;break;default:u=m=t.coordinate,f=s+ +c*i,p=f+x*b,g=p+x*d,y=v;break}return{line:{x1:u,y1:p,x2:m,y2:f},tick:{x:y,y:g}}}getTickTextAnchor(){var{orientation:t,mirror:n}=this.props,s;switch(t){case"left":s=n?"start":"end";break;case"right":s=n?"end":"start";break;default:s="middle";break}return s}getTickVerticalAnchor(){var{orientation:t,mirror:n}=this.props;switch(t){case"left":case"right":return"middle";case"top":return n?"start":"end";default:return n?"end":"start"}}renderAxisLine(){var{x:t,y:n,width:s,height:a,orientation:i,mirror:l,axisLine:o}=this.props,c=Vr(Vr(Vr({},$t(this.props,!1)),$t(o,!1)),{},{fill:"none"});if(i==="top"||i==="bottom"){var d=+(i==="top"&&!l||i==="bottom"&&l);c=Vr(Vr({},c),{},{x1:t,y1:n+d*a,x2:t+s,y2:n+d*a})}else{var u=+(i==="left"&&!l||i==="right"&&l);c=Vr(Vr({},c),{},{x1:t+u*s,y1:n,x2:t+u*s,y2:n+a})}return h.createElement("line",jl({},c,{className:xt("recharts-cartesian-axis-line",hi(o,"className"))}))}static renderTickItem(t,n,s){var a,i=xt(n.className,"recharts-cartesian-axis-tick-value");if(h.isValidElement(t))a=h.cloneElement(t,Vr(Vr({},n),{},{className:i}));else if(typeof t=="function")a=t(Vr(Vr({},n),{},{className:i}));else{var l="recharts-cartesian-axis-tick-value";typeof t!="boolean"&&(l=xt(l,t.className)),a=h.createElement(Bm,jl({},n,{className:l}),s)}return a}renderTicks(t,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],{tickLine:a,stroke:i,tick:l,tickFormatter:o,unit:c}=this.props,d=Ly(Vr(Vr({},this.props),{},{ticks:s}),t,n),u=this.getTickTextAnchor(),m=this.getTickVerticalAnchor(),p=$t(this.props,!1),f=$t(l,!1),y=Vr(Vr({},p),{},{fill:"none"},$t(a,!1)),g=d.map((x,b)=>{var{line:v,tick:w}=this.getTickLineCoord(x),N=Vr(Vr(Vr(Vr({textAnchor:u,verticalAnchor:m},p),{},{stroke:"none",fill:i},f),w),{},{index:b,payload:x,visibleTicksCount:d.length,tickFormatter:o});return h.createElement(Jr,jl({className:"recharts-cartesian-axis-tick",key:"tick-".concat(x.value,"-").concat(x.coordinate,"-").concat(x.tickCoord)},Ec(this.props,x,b)),a&&h.createElement("line",jl({},y,v,{className:xt("recharts-cartesian-axis-tick-line",hi(a,"className"))})),l&&ji.renderTickItem(l,N,"".concat(typeof o=="function"?o(x.value,b):x.value).concat(c||"")))});return g.length>0?h.createElement("g",{className:"recharts-cartesian-axis-ticks"},g):null}render(){var{axisLine:t,width:n,height:s,className:a,hide:i}=this.props;if(i)return null;var{ticks:l}=this.props;return n!=null&&n<=0||s!=null&&s<=0?null:h.createElement(Jr,{className:xt("recharts-cartesian-axis",a),ref:o=>{if(o){var c=o.getElementsByClassName("recharts-cartesian-axis-tick-value");this.tickRefs.current=Array.from(c);var d=c[0];if(d){var u=window.getComputedStyle(d).fontSize,m=window.getComputedStyle(d).letterSpacing;(u!==this.state.fontSize||m!==this.state.letterSpacing)&&this.setState({fontSize:window.getComputedStyle(d).fontSize,letterSpacing:window.getComputedStyle(d).letterSpacing})}}}},t&&this.renderAxisLine(),this.renderTicks(this.state.fontSize,this.state.letterSpacing,l),Rn.renderCallByParent(this.props))}}Ry(ji,"displayName","CartesianAxis");Ry(ji,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var tZ=["x1","y1","x2","y2","key"],rZ=["offset"],nZ=["xAxisId","yAxisId"],sZ=["xAxisId","yAxisId"];function J1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function yn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?J1(Object(n),!0).forEach(function(s){aZ(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function aZ(e,t,n){return(t=iZ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function iZ(e){var t=lZ(e,"string");return typeof t=="symbol"?t:t+""}function lZ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function $i(){return $i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},$i.apply(null,arguments)}function Wu(e,t){if(e==null)return{};var n,s,a=oZ(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function oZ(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}var cZ=e=>{var{fill:t}=e;if(!t||t==="none")return null;var{fillOpacity:n,x:s,y:a,width:i,height:l,ry:o}=e;return h.createElement("rect",{x:s,y:a,ry:o,width:i,height:l,stroke:"none",fill:t,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function eT(e,t){var n;if(h.isValidElement(e))n=h.cloneElement(e,t);else if(typeof e=="function")n=e(t);else{var{x1:s,y1:a,x2:i,y2:l,key:o}=t,c=Wu(t,tZ),d=$t(c,!1),{offset:u}=d,m=Wu(d,rZ);n=h.createElement("line",$i({},m,{x1:s,y1:a,x2:i,y2:l,fill:"none",key:o}))}return n}function dZ(e){var{x:t,width:n,horizontal:s=!0,horizontalPoints:a}=e;if(!s||!a||!a.length)return null;var{xAxisId:i,yAxisId:l}=e,o=Wu(e,nZ),c=a.map((d,u)=>{var m=yn(yn({},o),{},{x1:t,y1:d,x2:t+n,y2:d,key:"line-".concat(u),index:u});return eT(s,m)});return h.createElement("g",{className:"recharts-cartesian-grid-horizontal"},c)}function uZ(e){var{y:t,height:n,vertical:s=!0,verticalPoints:a}=e;if(!s||!a||!a.length)return null;var{xAxisId:i,yAxisId:l}=e,o=Wu(e,sZ),c=a.map((d,u)=>{var m=yn(yn({},o),{},{x1:d,y1:t,x2:d,y2:t+n,key:"line-".concat(u),index:u});return eT(s,m)});return h.createElement("g",{className:"recharts-cartesian-grid-vertical"},c)}function mZ(e){var{horizontalFill:t,fillOpacity:n,x:s,y:a,width:i,height:l,horizontalPoints:o,horizontal:c=!0}=e;if(!c||!t||!t.length)return null;var d=o.map(m=>Math.round(m+a-a)).sort((m,p)=>m-p);a!==d[0]&&d.unshift(0);var u=d.map((m,p)=>{var f=!d[p+1],y=f?a+l-m:d[p+1]-m;if(y<=0)return null;var g=p%t.length;return h.createElement("rect",{key:"react-".concat(p),y:m,x:s,height:y,width:i,stroke:"none",fill:t[g],fillOpacity:n,className:"recharts-cartesian-grid-bg"})});return h.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},u)}function hZ(e){var{vertical:t=!0,verticalFill:n,fillOpacity:s,x:a,y:i,width:l,height:o,verticalPoints:c}=e;if(!t||!n||!n.length)return null;var d=c.map(m=>Math.round(m+a-a)).sort((m,p)=>m-p);a!==d[0]&&d.unshift(0);var u=d.map((m,p)=>{var f=!d[p+1],y=f?a+l-m:d[p+1]-m;if(y<=0)return null;var g=p%n.length;return h.createElement("rect",{key:"react-".concat(p),x:m,y:i,width:y,height:o,stroke:"none",fill:n[g],fillOpacity:s,className:"recharts-cartesian-grid-bg"})});return h.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},u)}var pZ=(e,t)=>{var{xAxis:n,width:s,height:a,offset:i}=e;return Z2(Ly(yn(yn(yn({},ji.defaultProps),n),{},{ticks:e_(n),viewBox:{x:0,y:0,width:s,height:a}})),i.left,i.left+i.width,t)},fZ=(e,t)=>{var{yAxis:n,width:s,height:a,offset:i}=e;return Z2(Ly(yn(yn(yn({},ji.defaultProps),n),{},{ticks:e_(n),viewBox:{x:0,y:0,width:s,height:a}})),i.top,i.top+i.height,t)},gZ={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[],xAxisId:0,yAxisId:0};function $y(e){var t=d0(),n=u0(),s=i_(),a=yn(yn({},_s(e,gZ)),{},{x:et(e.x)?e.x:s.left,y:et(e.y)?e.y:s.top,width:et(e.width)?e.width:s.width,height:et(e.height)?e.height:s.height}),{xAxisId:i,yAxisId:l,x:o,y:c,width:d,height:u,syncWithTicks:m,horizontalValues:p,verticalValues:f}=a,y=jn(),g=tt(C=>YN(C,"xAxis",i,y)),x=tt(C=>YN(C,"yAxis",l,y));if(!et(d)||d<=0||!et(u)||u<=0||!et(o)||o!==+o||!et(c)||c!==+c)return null;var b=a.verticalCoordinatesGenerator||pZ,v=a.horizontalCoordinatesGenerator||fZ,{horizontalPoints:w,verticalPoints:N}=a;if((!w||!w.length)&&typeof v=="function"){var k=p&&p.length,j=v({yAxis:x?yn(yn({},x),{},{ticks:k?p:x.ticks}):void 0,width:t,height:n,offset:s},k?!0:m);Vo(Array.isArray(j),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(typeof j,"]")),Array.isArray(j)&&(w=j)}if((!N||!N.length)&&typeof b=="function"){var S=f&&f.length,_=b({xAxis:g?yn(yn({},g),{},{ticks:S?f:g.ticks}):void 0,width:t,height:n,offset:s},S?!0:m);Vo(Array.isArray(_),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(typeof _,"]")),Array.isArray(_)&&(N=_)}return h.createElement("g",{className:"recharts-cartesian-grid"},h.createElement(cZ,{fill:a.fill,fillOpacity:a.fillOpacity,x:a.x,y:a.y,width:a.width,height:a.height,ry:a.ry}),h.createElement(mZ,$i({},a,{horizontalPoints:w})),h.createElement(hZ,$i({},a,{verticalPoints:N})),h.createElement(dZ,$i({},a,{offset:s,horizontalPoints:w,xAxis:g,yAxis:x})),h.createElement(uZ,$i({},a,{offset:s,verticalPoints:N,xAxis:g,yAxis:x})))}$y.displayName="CartesianGrid";var tT=(e,t,n,s)=>oa(e,"xAxis",t,s),rT=(e,t,n,s)=>gi(e,"xAxis",t,s),nT=(e,t,n,s)=>oa(e,"yAxis",n,s),sT=(e,t,n,s)=>gi(e,"yAxis",n,s),xZ=ve([Qt,tT,nT,rT,sT],(e,t,n,s,a)=>bi(e,"xAxis")?nc(t,s,!1):nc(n,a,!1)),yZ=(e,t,n,s,a)=>a,bZ=ve([Mm,yZ],(e,t)=>{if(e.some(n=>n.type==="line"&&t.dataKey===n.dataKey&&t.data===n.data))return t}),vZ=ve([Qt,tT,nT,rT,sT,bZ,xZ,F0],(e,t,n,s,a,i,l,o)=>{var{chartData:c,dataStartIndex:d,dataEndIndex:u}=o;if(!(i==null||t==null||n==null||s==null||a==null||s.length===0||a.length===0||l==null)){var{dataKey:m,data:p}=i,f;if(p!=null&&p.length>0?f=p:f=c==null?void 0:c.slice(d,u+1),f!=null)return FZ({layout:e,xAxis:t,yAxis:n,xAxisTicks:s,yAxisTicks:a,dataKey:m,bandSize:l,displayedData:f})}}),wZ=["type","layout","connectNulls","needClip"],jZ=["activeDot","animateNewValues","animationBegin","animationDuration","animationEasing","connectNulls","dot","hide","isAnimationActive","label","legendType","xAxisId","yAxisId"];function aT(e,t){if(e==null)return{};var n,s,a=NZ(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function NZ(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}function Q1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Os(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Q1(Object(n),!0).forEach(function(s){Wm(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Wm(e,t,n){return(t=CZ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function CZ(e){var t=kZ(e,"string");return typeof t=="symbol"?t:t+""}function kZ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Jl(){return Jl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Jl.apply(null,arguments)}var SZ=e=>{var{dataKey:t,name:n,stroke:s,legendType:a,hide:i}=e;return[{inactive:i,dataKey:t,type:a,color:s,value:ao(n,t),payload:e}]};function _Z(e){var{dataKey:t,data:n,stroke:s,strokeWidth:a,fill:i,name:l,hide:o,unit:c}=e;return{dataDefinedOnItem:n,positions:void 0,settings:{stroke:s,strokeWidth:a,fill:i,dataKey:t,nameKey:void 0,name:ao(l,t),hide:o,type:e.tooltipType,color:e.stroke,unit:c}}}var iT=(e,t)=>"".concat(t,"px ").concat(e-t,"px");function EZ(e,t){for(var n=e.length%2!==0?[...e,0]:e,s=[],a=0;a<t;++a)s=[...s,...n];return s}var DZ=(e,t,n)=>{var s=n.reduce((m,p)=>m+p);if(!s)return iT(t,e);for(var a=Math.floor(e/s),i=e%s,l=t-e,o=[],c=0,d=0;c<n.length;d+=n[c],++c)if(d+n[c]>i){o=[...n.slice(0,c),i-d];break}var u=o.length%2===0?[0,l]:[l];return[...EZ(n,a),...o,...u].map(m=>"".concat(m,"px")).join(", ")};function TZ(e,t){var n;if(h.isValidElement(e))n=h.cloneElement(e,t);else if(typeof e=="function")n=e(t);else{var s=xt("recharts-line-dot",typeof e!="boolean"?e.className:"");n=h.createElement(jD,Jl({},t,{className:s}))}return n}function AZ(e,t){return e==null?!1:t?!0:e.length===1}function PZ(e){var{clipPathId:t,points:n,props:s}=e,{dot:a,dataKey:i,needClip:l}=s;if(!AZ(n,a))return null;var o=JS(a),c=$t(s,!1),d=$t(a,!0),u=n.map((p,f)=>{var y=Os(Os(Os({key:"dot-".concat(f),r:3},c),d),{},{index:f,cx:p.x,cy:p.y,dataKey:i,value:p.value,payload:p.payload,points:n});return TZ(a,y)}),m={clipPath:l?"url(#clipPath-".concat(o?"":"dots-").concat(t,")"):null};return h.createElement(Jr,Jl({className:"recharts-line-dots",key:"dots"},m),u)}function qg(e){var{clipPathId:t,pathRef:n,points:s,strokeDasharray:a,props:i,showLabels:l}=e,{type:o,layout:c,connectNulls:d,needClip:u}=i,m=aT(i,wZ),p=Os(Os({},$t(m,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:u?"url(#clipPath-".concat(t,")"):null,points:s,type:o,layout:c,connectNulls:d,strokeDasharray:a??i.strokeDasharray});return h.createElement(h.Fragment,null,(s==null?void 0:s.length)>1&&h.createElement(h0,Jl({},p,{pathRef:n})),h.createElement(PZ,{points:s,clipPathId:t,props:i}),l&&oi.renderCallByParent(i,s))}function OZ(e){try{return e&&e.getTotalLength&&e.getTotalLength()||0}catch{return 0}}function MZ(e){var{clipPathId:t,props:n,pathRef:s,previousPointsRef:a,longestAnimatedLengthRef:i}=e,{points:l,strokeDasharray:o,isAnimationActive:c,animationBegin:d,animationDuration:u,animationEasing:m,animateNewValues:p,width:f,height:y,onAnimationEnd:g,onAnimationStart:x}=n,b=a.current,v=Ty(n,"recharts-line-"),[w,N]=h.useState(!1),k=h.useCallback(()=>{typeof g=="function"&&g(),N(!1)},[g]),j=h.useCallback(()=>{typeof x=="function"&&x(),N(!0)},[x]),S=OZ(s.current),_=i.current;return h.createElement(pi,{begin:d,duration:u,isActive:c,easing:m,from:{t:0},to:{t:1},onAnimationEnd:k,onAnimationStart:j,key:v},C=>{var{t:D}=C,A=Jn(_,S+_),E=Math.min(A(D),S),T;if(o){var M="".concat(o).split(/[,\s]+/gim).map($=>parseFloat($));T=DZ(E,S,M)}else T=iT(S,E);if(b){var L=b.length/l.length,P=D===1?l:l.map(($,R)=>{var U=Math.floor(R*L);if(b[U]){var I=b[U],z=Jn(I.x,$.x),F=Jn(I.y,$.y);return Os(Os({},$),{},{x:z(D),y:F(D)})}if(p){var O=Jn(f*2,$.x),K=Jn(y/2,$.y);return Os(Os({},$),{},{x:O(D),y:K(D)})}return Os(Os({},$),{},{x:$.x,y:$.y})});return a.current=P,h.createElement(qg,{props:n,points:P,clipPathId:t,pathRef:s,showLabels:!w,strokeDasharray:T})}return D>0&&S>0&&(a.current=l,i.current=E),h.createElement(qg,{props:n,points:l,clipPathId:t,pathRef:s,showLabels:!w,strokeDasharray:T})})}function IZ(e){var{clipPathId:t,props:n}=e,{points:s,isAnimationActive:a}=n,i=h.useRef(null),l=h.useRef(0),o=h.useRef(null),c=i.current;return a&&s&&s.length&&c!==s?h.createElement(MZ,{props:n,clipPathId:t,previousPointsRef:i,longestAnimatedLengthRef:l,pathRef:o}):h.createElement(qg,{props:n,points:s,clipPathId:t,pathRef:o,showLabels:!0})}var LZ=(e,t)=>({x:e.x,y:e.y,value:e.value,errorVal:yr(e.payload,t)});class RZ extends h.Component{constructor(){super(...arguments),Wm(this,"id",Qi("recharts-line-"))}render(){var t,{hide:n,dot:s,points:a,className:i,xAxisId:l,yAxisId:o,top:c,left:d,width:u,height:m,id:p,needClip:f,layout:y}=this.props;if(n)return null;var g=xt("recharts-line",i),x=mr(p)?this.id:p,{r:b=3,strokeWidth:v=2}=(t=$t(s,!1))!==null&&t!==void 0?t:{r:3,strokeWidth:2},w=JS(s),N=b*2+v;return h.createElement(h.Fragment,null,h.createElement(Jr,{className:g},f&&h.createElement("defs",null,h.createElement(qD,{clipPathId:x,xAxisId:l,yAxisId:o}),!w&&h.createElement("clipPath",{id:"clipPath-dots-".concat(x)},h.createElement("rect",{x:d-N/2,y:c-N/2,width:u+N,height:m+N}))),h.createElement(IZ,{props:this.props,clipPathId:x}),h.createElement(FD,{direction:y==="horizontal"?"y":"x"},h.createElement(ID,{xAxisId:l,yAxisId:o,data:a,dataPointFormatter:LZ,errorBarOffset:0},this.props.children))),h.createElement(iJ,{activeDot:this.props.activeDot,points:a,mainColor:this.props.stroke,itemDataKey:this.props.dataKey}))}}var lT={activeDot:!0,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!0,fill:"#fff",hide:!1,isAnimationActive:!il.isSsr,label:!1,legendType:"line",stroke:"#3182bd",strokeWidth:1,xAxisId:0,yAxisId:0};function $Z(e){var t=_s(e,lT),{activeDot:n,animateNewValues:s,animationBegin:a,animationDuration:i,animationEasing:l,connectNulls:o,dot:c,hide:d,isAnimationActive:u,label:m,legendType:p,xAxisId:f,yAxisId:y}=t,g=aT(t,jZ),{needClip:x}=Py(f,y),{height:b,width:v,x:w,y:N}=Ay(),k=Cm(),j=jn(),S=h.useMemo(()=>({dataKey:e.dataKey,data:e.data}),[e.dataKey,e.data]),_=tt(C=>vZ(C,f,y,j,S));return k!=="horizontal"&&k!=="vertical"?null:h.createElement(RZ,Jl({},g,{connectNulls:o,dot:c,activeDot:n,animateNewValues:s,animationBegin:a,animationDuration:i,animationEasing:l,isAnimationActive:u,hide:d,label:m,legendType:p,xAxisId:f,yAxisId:y,points:_,layout:k,height:b,width:v,left:w,top:N,needClip:x}))}function FZ(e){var{layout:t,xAxis:n,yAxis:s,xAxisTicks:a,yAxisTicks:i,dataKey:l,bandSize:o,displayedData:c}=e;return c.map((d,u)=>{var m=yr(d,l);return t==="horizontal"?{x:kj({axis:n,ticks:a,bandSize:o,entry:d,index:u}),y:mr(m)?null:s.scale(m),value:m,payload:d}:{x:mr(m)?null:n.scale(m),y:kj({axis:s,ticks:i,bandSize:o,entry:d,index:u}),value:m,payload:d}})}class Fy extends h.PureComponent{render(){return h.createElement(LD,{type:"line",data:this.props.data,xAxisId:this.props.xAxisId,yAxisId:this.props.yAxisId,zAxisId:0,dataKey:this.props.dataKey,stackId:void 0,hide:this.props.hide,barSize:void 0},h.createElement(TD,{legendPayload:SZ(this.props)}),h.createElement(Dy,{fn:_Z,args:this.props}),h.createElement($Z,this.props))}}Wm(Fy,"displayName","Line");Wm(Fy,"defaultProps",lT);function Z1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function eC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Z1(Object(n),!0).forEach(function(s){zZ(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z1(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function zZ(e,t,n){return(t=BZ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function BZ(e){var t=UZ(e,"string");return typeof t=="symbol"?t:t+""}function UZ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var qZ={xAxis:{},yAxis:{},zAxis:{}},oT=Ss({name:"cartesianAxis",initialState:qZ,reducers:{addXAxis(e,t){e.xAxis[t.payload.id]=t.payload},removeXAxis(e,t){delete e.xAxis[t.payload.id]},addYAxis(e,t){e.yAxis[t.payload.id]=t.payload},removeYAxis(e,t){delete e.yAxis[t.payload.id]},addZAxis(e,t){e.zAxis[t.payload.id]=t.payload},removeZAxis(e,t){delete e.zAxis[t.payload.id]},updateYAxisWidth(e,t){var{id:n,width:s}=t.payload;e.yAxis[n]&&(e.yAxis[n]=eC(eC({},e.yAxis[n]),{},{width:s}))}}}),{addXAxis:HZ,removeXAxis:WZ,addYAxis:YZ,removeYAxis:VZ,addZAxis:qse,removeZAxis:Hse,updateYAxisWidth:GZ}=oT.actions,KZ=oT.reducer,XZ=["children"],JZ=["dangerouslySetInnerHTML","ticks"];function cT(e,t,n){return(t=QZ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function QZ(e){var t=ZZ(e,"string");return typeof t=="symbol"?t:t+""}function ZZ(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Hg(){return Hg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Hg.apply(null,arguments)}function dT(e,t){if(e==null)return{};var n,s,a=eee(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function eee(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}function tee(e){var t=vr(),n=h.useMemo(()=>{var{children:i}=e,l=dT(e,XZ);return l},[e]),s=tt(i=>ha(i,n.id)),a=n===s;return h.useEffect(()=>(t(HZ(n)),()=>{t(WZ(n))}),[n,t]),a?e.children:null}var ree=e=>{var{xAxisId:t,className:n}=e,s=tt(a_),a=jn(),i="xAxis",l=tt(f=>fi(f,i,t,a)),o=tt(f=>UE(f,i,t,a)),c=tt(f=>$E(f,t)),d=tt(f=>sV(f,t));if(c==null||d==null)return null;var{dangerouslySetInnerHTML:u,ticks:m}=e,p=dT(e,JZ);return h.createElement(ji,Hg({},p,{scale:l,x:d.x,y:d.y,width:c.width,height:c.height,className:xt("recharts-".concat(i," ").concat(i),n),viewBox:s,ticks:o}))},nee=e=>{var t,n,s,a,i;return h.createElement(tee,{interval:(t=e.interval)!==null&&t!==void 0?t:"preserveEnd",id:e.xAxisId,scale:e.scale,type:e.type,padding:e.padding,allowDataOverflow:e.allowDataOverflow,domain:e.domain,dataKey:e.dataKey,allowDuplicatedCategory:e.allowDuplicatedCategory,allowDecimals:e.allowDecimals,tickCount:e.tickCount,includeHidden:(n=e.includeHidden)!==null&&n!==void 0?n:!1,reversed:e.reversed,ticks:e.ticks,height:e.height,orientation:e.orientation,mirror:e.mirror,hide:e.hide,unit:e.unit,name:e.name,angle:(s=e.angle)!==null&&s!==void 0?s:0,minTickGap:(a=e.minTickGap)!==null&&a!==void 0?a:5,tick:(i=e.tick)!==null&&i!==void 0?i:!0,tickFormatter:e.tickFormatter},h.createElement(ree,e))};class Ym extends h.Component{render(){return h.createElement(nee,this.props)}}cT(Ym,"displayName","XAxis");cT(Ym,"defaultProps",{allowDataOverflow:Gn.allowDataOverflow,allowDecimals:Gn.allowDecimals,allowDuplicatedCategory:Gn.allowDuplicatedCategory,height:Gn.height,hide:!1,mirror:Gn.mirror,orientation:Gn.orientation,padding:Gn.padding,reversed:Gn.reversed,scale:Gn.scale,tickCount:Gn.tickCount,type:Gn.type,xAxisId:0});var see=e=>{var{ticks:t,label:n,labelGapWithTick:s=5,tickSize:a=0,tickMargin:i=0}=e,l=0;if(t){t.forEach(u=>{if(u){var m=u.getBoundingClientRect();m.width>l&&(l=m.width)}});var o=n?n.getBoundingClientRect().width:0,c=a+i,d=l+c+o+(n?s:0);return Math.round(d)}return 0},aee=["dangerouslySetInnerHTML","ticks"];function uT(e,t,n){return(t=iee(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function iee(e){var t=lee(e,"string");return typeof t=="symbol"?t:t+""}function lee(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Wg(){return Wg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Wg.apply(null,arguments)}function oee(e,t){if(e==null)return{};var n,s,a=cee(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function cee(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}function dee(e){var t=vr();return h.useEffect(()=>(t(YZ(e)),()=>{t(VZ(e))}),[e,t]),null}var uee=e=>{var t,{yAxisId:n,className:s,width:a,label:i}=e,l=h.useRef(null),o=h.useRef(null),c=tt(a_),d=jn(),u=vr(),m="yAxis",p=tt(w=>fi(w,m,n,d)),f=tt(w=>FE(w,n)),y=tt(w=>aV(w,n)),g=tt(w=>UE(w,m,n,d));if(h.useLayoutEffect(()=>{var w;if(!(a!=="auto"||!f||wy(i)||h.isValidElement(i))){var N=l.current,k=N==null||(w=N.tickRefs)===null||w===void 0?void 0:w.current,{tickSize:j,tickMargin:S}=N.props,_=see({ticks:k,label:o.current,labelGapWithTick:5,tickSize:j,tickMargin:S});Math.round(f.width)!==Math.round(_)&&u(GZ({id:n,width:_}))}},[l,l==null||(t=l.current)===null||t===void 0||(t=t.tickRefs)===null||t===void 0?void 0:t.current,f==null?void 0:f.width,f,u,i,n,a]),f==null||y==null)return null;var{dangerouslySetInnerHTML:x,ticks:b}=e,v=oee(e,aee);return h.createElement(ji,Wg({},v,{ref:l,labelRef:o,scale:p,x:y.x,y:y.y,width:f.width,height:f.height,className:xt("recharts-".concat(m," ").concat(m),s),viewBox:c,ticks:g}))},mee=e=>{var t,n,s,a,i;return h.createElement(h.Fragment,null,h.createElement(dee,{interval:(t=e.interval)!==null&&t!==void 0?t:"preserveEnd",id:e.yAxisId,scale:e.scale,type:e.type,domain:e.domain,allowDataOverflow:e.allowDataOverflow,dataKey:e.dataKey,allowDuplicatedCategory:e.allowDuplicatedCategory,allowDecimals:e.allowDecimals,tickCount:e.tickCount,padding:e.padding,includeHidden:(n=e.includeHidden)!==null&&n!==void 0?n:!1,reversed:e.reversed,ticks:e.ticks,width:e.width,orientation:e.orientation,mirror:e.mirror,hide:e.hide,unit:e.unit,name:e.name,angle:(s=e.angle)!==null&&s!==void 0?s:0,minTickGap:(a=e.minTickGap)!==null&&a!==void 0?a:5,tick:(i=e.tick)!==null&&i!==void 0?i:!0,tickFormatter:e.tickFormatter}),h.createElement(uee,e))},hee={allowDataOverflow:Kn.allowDataOverflow,allowDecimals:Kn.allowDecimals,allowDuplicatedCategory:Kn.allowDuplicatedCategory,hide:!1,mirror:Kn.mirror,orientation:Kn.orientation,padding:Kn.padding,reversed:Kn.reversed,scale:Kn.scale,tickCount:Kn.tickCount,type:Kn.type,width:Kn.width,yAxisId:0};class pc extends h.Component{render(){return h.createElement(mee,this.props)}}uT(pc,"displayName","YAxis");uT(pc,"defaultProps",hee);var uf={exports:{}},mf={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tC;function pee(){if(tC)return mf;tC=1;var e=tx();function t(c,d){return c===d&&(c!==0||1/c===1/d)||c!==c&&d!==d}var n=typeof Object.is=="function"?Object.is:t,s=e.useSyncExternalStore,a=e.useRef,i=e.useEffect,l=e.useMemo,o=e.useDebugValue;return mf.useSyncExternalStoreWithSelector=function(c,d,u,m,p){var f=a(null);if(f.current===null){var y={hasValue:!1,value:null};f.current=y}else y=f.current;f=l(function(){function x(k){if(!b){if(b=!0,v=k,k=m(k),p!==void 0&&y.hasValue){var j=y.value;if(p(j,k))return w=j}return w=k}if(j=w,n(v,k))return j;var S=m(k);return p!==void 0&&p(j,S)?(v=k,j):(v=k,w=S)}var b=!1,v,w,N=u===void 0?null:u;return[function(){return x(d())},N===null?void 0:function(){return x(N())}]},[d,u,m,p]);var g=s(c,f[0],f[1]);return i(function(){y.hasValue=!0,y.value=g},[g]),o(g),g},mf}var rC;function fee(){return rC||(rC=1,uf.exports=pee()),uf.exports}fee();function gee(e){e()}function xee(){let e=null,t=null;return{clear(){e=null,t=null},notify(){gee(()=>{let n=e;for(;n;)n.callback(),n=n.next})},get(){const n=[];let s=e;for(;s;)n.push(s),s=s.next;return n},subscribe(n){let s=!0;const a=t={callback:n,next:null,prev:t};return a.prev?a.prev.next=a:e=a,function(){!s||e===null||(s=!1,a.next?a.next.prev=a.prev:t=a.prev,a.prev?a.prev.next=a.next:e=a.next)}}}}var nC={notify(){},get:()=>[]};function yee(e,t){let n,s=nC,a=0,i=!1;function l(g){u();const x=s.subscribe(g);let b=!1;return()=>{b||(b=!0,x(),m())}}function o(){s.notify()}function c(){y.onStateChange&&y.onStateChange()}function d(){return i}function u(){a++,n||(n=e.subscribe(c),s=xee())}function m(){a--,n&&a===0&&(n(),n=void 0,s.clear(),s=nC)}function p(){i||(i=!0,u())}function f(){i&&(i=!1,m())}const y={addNestedSub:l,notifyNestedSubs:o,handleChangeWrapper:c,isSubscribed:d,trySubscribe:p,tryUnsubscribe:f,getListeners:()=>s};return y}var bee=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",vee=bee(),wee=()=>typeof navigator<"u"&&navigator.product==="ReactNative",jee=wee(),Nee=()=>vee||jee?h.useLayoutEffect:h.useEffect,Cee=Nee(),hf=Symbol.for("react-redux-context"),pf=typeof globalThis<"u"?globalThis:{};function kee(){if(!h.createContext)return{};const e=pf[hf]??(pf[hf]=new Map);let t=e.get(h.createContext);return t||(t=h.createContext(null),e.set(h.createContext,t)),t}var See=kee();function _ee(e){const{children:t,context:n,serverState:s,store:a}=e,i=h.useMemo(()=>{const c=yee(a);return{store:a,subscription:c,getServerState:s?()=>s:void 0}},[a,s]),l=h.useMemo(()=>a.getState(),[a]);Cee(()=>{const{subscription:c}=i;return c.onStateChange=c.notifyNestedSubs,c.trySubscribe(),l!==a.getState()&&c.notifyNestedSubs(),()=>{c.tryUnsubscribe(),c.onStateChange=void 0}},[i,l]);const o=n||See;return h.createElement(o.Provider,{value:i},t)}var Eee=_ee,Dee=(e,t)=>t,zy=ve([Dee,Qt,yY,dn,nD,Ua,oG,Zr],hG),By=e=>{var t=e.currentTarget.getBoundingClientRect(),n=t.width/e.currentTarget.offsetWidth,s=t.height/e.currentTarget.offsetHeight;return{chartX:Math.round((e.clientX-t.left)/n),chartY:Math.round((e.clientY-t.top)/s)}},mT=Ns("mouseClick"),hT=Tc();hT.startListening({actionCreator:mT,effect:(e,t)=>{var n=e.payload,s=zy(t.getState(),By(n));(s==null?void 0:s.activeIndex)!=null&&t.dispatch(yV({activeIndex:s.activeIndex,activeDataKey:void 0,activeCoordinate:s.activeCoordinate}))}});var Yg=Ns("mouseMove"),pT=Tc();pT.startListening({actionCreator:Yg,effect:(e,t)=>{var n=e.payload,s=t.getState(),a=uy(s,s.tooltip.settings.shared),i=zy(s,By(n));a==="axis"&&((i==null?void 0:i.activeIndex)!=null?t.dispatch(XE({activeIndex:i.activeIndex,activeDataKey:void 0,activeCoordinate:i.activeCoordinate})):t.dispatch(KE()))}});function Tee(e,t){return t instanceof HTMLElement?"HTMLElement <".concat(t.tagName,' class="').concat(t.className,'">'):t===window?"global.window":t}var sC={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,barSize:void 0,className:void 0,maxBarSize:void 0,stackOffset:"none",syncId:void 0,syncMethod:"index"},fT=Ss({name:"rootProps",initialState:sC,reducers:{updateOptions:(e,t)=>{var n;e.accessibilityLayer=t.payload.accessibilityLayer,e.barCategoryGap=t.payload.barCategoryGap,e.barGap=(n=t.payload.barGap)!==null&&n!==void 0?n:sC.barGap,e.barSize=t.payload.barSize,e.maxBarSize=t.payload.maxBarSize,e.stackOffset=t.payload.stackOffset,e.syncId=t.payload.syncId,e.syncMethod=t.payload.syncMethod,e.className=t.payload.className}}}),Aee=fT.reducer,{updateOptions:Pee}=fT.actions,gT=Ss({name:"polarOptions",initialState:null,reducers:{updatePolarOptions:(e,t)=>t.payload}}),{updatePolarOptions:Oee}=gT.actions,Mee=gT.reducer,xT=Ns("keyDown"),yT=Ns("focus"),Uy=Tc();Uy.startListening({actionCreator:xT,effect:(e,t)=>{var n=t.getState(),s=n.rootProps.accessibilityLayer!==!1;if(s){var{keyboardInteraction:a}=n.tooltip,i=e.payload;if(!(i!=="ArrowRight"&&i!=="ArrowLeft"&&i!=="Enter")){var l=Number(my(a,ul(n))),o=Ua(n);if(i==="Enter"){var c=Ru(n,"axis","hover",String(a.index));t.dispatch(Mg({active:!a.active,activeIndex:a.index,activeDataKey:a.dataKey,activeCoordinate:c}));return}var d=cV(n),u=d==="left-to-right"?1:-1,m=i==="ArrowRight"?1:-1,p=l+m*u;if(!(o==null||p>=o.length||p<0)){var f=Ru(n,"axis","hover",String(p));t.dispatch(Mg({active:!0,activeIndex:p.toString(),activeDataKey:void 0,activeCoordinate:f}))}}}}});Uy.startListening({actionCreator:yT,effect:(e,t)=>{var n=t.getState(),s=n.rootProps.accessibilityLayer!==!1;if(s){var{keyboardInteraction:a}=n.tooltip;if(!a.active&&a.index==null){var i="0",l=Ru(n,"axis","hover",String(i));t.dispatch(Mg({activeDataKey:void 0,active:!0,activeIndex:i,activeCoordinate:l}))}}}});var ls=Ns("externalEvent"),bT=Tc();bT.startListening({actionCreator:ls,effect:(e,t)=>{if(e.payload.handler!=null){var n=t.getState(),s={activeCoordinate:QV(n),activeDataKey:lD(n),activeIndex:xi(n),activeLabel:iD(n),activeTooltipIndex:xi(n),isTooltipActive:ZV(n)};e.payload.handler(s,e.payload.reactEvent)}}});var Iee=ve([mo],e=>e.tooltipItemPayloads),Lee=ve([Iee,zc,(e,t,n)=>t,(e,t,n)=>n],(e,t,n,s)=>{var a=e.find(o=>o.settings.dataKey===s);if(a!=null){var{positions:i}=a;if(i!=null){var l=t(i,n);return l}}}),vT=Ns("touchMove"),wT=Tc();wT.startListening({actionCreator:vT,effect:(e,t)=>{var n=e.payload,s=t.getState(),a=uy(s,s.tooltip.settings.shared);if(a==="axis"){var i=zy(s,By({clientX:n.touches[0].clientX,clientY:n.touches[0].clientY,currentTarget:n.currentTarget}));(i==null?void 0:i.activeIndex)!=null&&t.dispatch(XE({activeIndex:i.activeIndex,activeDataKey:void 0,activeCoordinate:i.activeCoordinate}))}else if(a==="item"){var l,o=n.touches[0],c=document.elementFromPoint(o.clientX,o.clientY);if(!c||!c.getAttribute)return;var d=c.getAttribute(n_),u=(l=c.getAttribute(s_))!==null&&l!==void 0?l:void 0,m=Lee(t.getState(),d,u);t.dispatch(GE({activeDataKey:u,activeIndex:d,activeCoordinate:m}))}}});var Ree=D2({brush:vQ,cartesianAxis:KZ,chartData:DG,graphicalItems:dX,layout:lU,legend:VU,options:CG,polarAxis:GK,polarOptions:Mee,referenceElements:AQ,rootProps:Aee,tooltip:bV}),$ee=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Chart";return PB({reducer:Ree,preloadedState:t,middleware:s=>s({serializableCheck:!1}).concat([hT.middleware,pT.middleware,Uy.middleware,bT.middleware,wT.middleware]),devTools:{serialize:{replacer:Tee},name:"recharts-".concat(n)}})};function jT(e){var{preloadedState:t,children:n,reduxStoreName:s}=e,a=jn(),i=h.useRef(null);if(a)return n;i.current==null&&(i.current=$ee(t,s));var l=r0;return h.createElement(Eee,{context:l,store:i.current},n)}function NT(e){var{layout:t,width:n,height:s,margin:a}=e,i=vr(),l=jn();return h.useEffect(()=>{l||(i(sU(t)),i(aU({width:n,height:s})),i(nU(a)))},[i,l,t,n,s,a]),null}function CT(e){var t=vr();return h.useEffect(()=>{t(Pee(e))},[t,e]),null}var Fee=["children"];function zee(e,t){if(e==null)return{};var n,s,a=Bee(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Bee(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}function Yu(){return Yu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Yu.apply(null,arguments)}var Uee={width:"100%",height:"100%"},qee=h.forwardRef((e,t)=>{var n=d0(),s=u0(),a=d_();if(!Wl(n)||!Wl(s))return null;var{children:i,otherAttributes:l,title:o,desc:c}=e,d,u;return typeof l.tabIndex=="number"?d=l.tabIndex:d=a?0:void 0,typeof l.role=="string"?u=l.role:u=a?"application":void 0,h.createElement(Hx,Yu({},l,{title:o,desc:c,role:u,tabIndex:d,width:n,height:s,style:Uee,ref:t}),i)}),Hee=e=>{var{children:t}=e,n=tt(jm);if(!n)return null;var{width:s,height:a,y:i,x:l}=n;return h.createElement(Hx,{width:s,height:a,x:l,y:i},t)},aC=h.forwardRef((e,t)=>{var{children:n}=e,s=zee(e,Fee),a=jn();return a?h.createElement(Hee,null,n):h.createElement(qee,Yu({ref:t},s),n)});function Wee(){var e=vr(),[t,n]=h.useState(null),s=tt(IU);return h.useEffect(()=>{if(t!=null){var a=t.getBoundingClientRect(),i=a.width/t.offsetWidth;ss(i)&&i!==s&&e(iU(i))}},[t,e,s]),n}function iC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Yee(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?iC(Object(n),!0).forEach(function(s){Vee(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iC(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Vee(e,t,n){return(t=Gee(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Gee(e){var t=Kee(e,"string");return typeof t=="symbol"?t:t+""}function Kee(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Xee=h.forwardRef((e,t)=>{var{children:n,className:s,height:a,onClick:i,onContextMenu:l,onDoubleClick:o,onMouseDown:c,onMouseEnter:d,onMouseLeave:u,onMouseMove:m,onMouseUp:p,onTouchEnd:f,onTouchMove:y,onTouchStart:g,style:x,width:b}=e,v=vr(),[w,N]=h.useState(null),[k,j]=h.useState(null);PG();var S=Wee(),_=h.useCallback(F=>{S(F),typeof t=="function"&&t(F),N(F),j(F)},[S,t,N,j]),C=h.useCallback(F=>{v(mT(F)),v(ls({handler:i,reactEvent:F}))},[v,i]),D=h.useCallback(F=>{v(Yg(F)),v(ls({handler:d,reactEvent:F}))},[v,d]),A=h.useCallback(F=>{v(KE()),v(ls({handler:u,reactEvent:F}))},[v,u]),E=h.useCallback(F=>{v(Yg(F)),v(ls({handler:m,reactEvent:F}))},[v,m]),T=h.useCallback(()=>{v(yT())},[v]),M=h.useCallback(F=>{v(xT(F.key))},[v]),L=h.useCallback(F=>{v(ls({handler:l,reactEvent:F}))},[v,l]),P=h.useCallback(F=>{v(ls({handler:o,reactEvent:F}))},[v,o]),$=h.useCallback(F=>{v(ls({handler:c,reactEvent:F}))},[v,c]),R=h.useCallback(F=>{v(ls({handler:p,reactEvent:F}))},[v,p]),U=h.useCallback(F=>{v(ls({handler:g,reactEvent:F}))},[v,g]),I=h.useCallback(F=>{v(vT(F)),v(ls({handler:y,reactEvent:F}))},[v,y]),z=h.useCallback(F=>{v(ls({handler:f,reactEvent:F}))},[v,f]);return h.createElement(hD.Provider,{value:w},h.createElement(QS.Provider,{value:k},h.createElement("div",{className:xt("recharts-wrapper",s),style:Yee({position:"relative",cursor:"default",width:b,height:a},x),onClick:C,onContextMenu:L,onDoubleClick:P,onFocus:T,onKeyDown:M,onMouseDown:$,onMouseEnter:D,onMouseLeave:A,onMouseMove:E,onMouseUp:R,onTouchEnd:z,onTouchMove:I,onTouchStart:U,ref:_},n)))}),Jee=["children","className","width","height","style","compact","title","desc"];function Qee(e,t){if(e==null)return{};var n,s,a=Zee(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Zee(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}var kT=h.forwardRef((e,t)=>{var{children:n,className:s,width:a,height:i,style:l,compact:o,title:c,desc:d}=e,u=Qee(e,Jee),m=$t(u,!1);return o?h.createElement(aC,{otherAttributes:m,title:c,desc:d},n):h.createElement(Xee,{className:s,style:l,width:a,height:i,onClick:e.onClick,onMouseLeave:e.onMouseLeave,onMouseEnter:e.onMouseEnter,onMouseMove:e.onMouseMove,onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,onContextMenu:e.onContextMenu,onDoubleClick:e.onDoubleClick,onTouchStart:e.onTouchStart,onTouchMove:e.onTouchMove,onTouchEnd:e.onTouchEnd},h.createElement(aC,{otherAttributes:m,title:c,desc:d,ref:t},h.createElement(PQ,null,n)))}),ete=["width","height"];function Vg(){return Vg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Vg.apply(null,arguments)}function tte(e,t){if(e==null)return{};var n,s,a=rte(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function rte(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}var nte={top:5,right:5,bottom:5,left:5},ste={accessibilityLayer:!0,layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:nte,reverseStackOrder:!1,syncMethod:"index"},ST=h.forwardRef(function(t,n){var s,a=_s(t.categoricalChartProps,ste),{width:i,height:l}=a,o=tte(a,ete);if(!Wl(i)||!Wl(l))return null;var{chartName:c,defaultTooltipEventType:d,validateTooltipEventTypes:u,tooltipPayloadSearcher:m,categoricalChartProps:p}=t,f={chartName:c,defaultTooltipEventType:d,validateTooltipEventTypes:u,tooltipPayloadSearcher:m,eventEmitter:void 0};return h.createElement(jT,{preloadedState:{options:f},reduxStoreName:(s=p.id)!==null&&s!==void 0?s:c},h.createElement(GD,{chartData:p.data}),h.createElement(NT,{width:i,height:l,layout:a.layout,margin:a.margin}),h.createElement(CT,{accessibilityLayer:a.accessibilityLayer,barCategoryGap:a.barCategoryGap,maxBarSize:a.maxBarSize,stackOffset:a.stackOffset,barGap:a.barGap,barSize:a.barSize,syncId:a.syncId,syncMethod:a.syncMethod,className:a.className}),h.createElement(kT,Vg({},o,{width:i,height:l,ref:n})))}),ate=["axis","item"],ite=h.forwardRef((e,t)=>h.createElement(ST,{chartName:"BarChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:ate,tooltipPayloadSearcher:vy,categoricalChartProps:e,ref:t}));function lte(e){var t=vr();return h.useEffect(()=>{t(Oee(e))},[t,e]),null}var ote=["width","height","layout"];function Gg(){return Gg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Gg.apply(null,arguments)}function cte(e,t){if(e==null)return{};var n,s,a=dte(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function dte(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.indexOf(s)!==-1)continue;n[s]=e[s]}return n}var ute={top:5,right:5,bottom:5,left:5},mte={accessibilityLayer:!0,stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:ute,reverseStackOrder:!1,syncMethod:"index",layout:"radial"},hte=h.forwardRef(function(t,n){var s,a=_s(t.categoricalChartProps,mte),{width:i,height:l,layout:o}=a,c=cte(a,ote);if(!Wl(i)||!Wl(l))return null;var{chartName:d,defaultTooltipEventType:u,validateTooltipEventTypes:m,tooltipPayloadSearcher:p}=t,f={chartName:d,defaultTooltipEventType:u,validateTooltipEventTypes:m,tooltipPayloadSearcher:p,eventEmitter:void 0};return h.createElement(jT,{preloadedState:{options:f},reduxStoreName:(s=a.id)!==null&&s!==void 0?s:d},h.createElement(GD,{chartData:a.data}),h.createElement(NT,{width:i,height:l,layout:o,margin:a.margin}),h.createElement(CT,{accessibilityLayer:a.accessibilityLayer,barCategoryGap:a.barCategoryGap,maxBarSize:a.maxBarSize,stackOffset:a.stackOffset,barGap:a.barGap,barSize:a.barSize,syncId:a.syncId,syncMethod:a.syncMethod,className:a.className}),h.createElement(lte,{cx:a.cx,cy:a.cy,startAngle:a.startAngle,endAngle:a.endAngle,innerRadius:a.innerRadius,outerRadius:a.outerRadius}),h.createElement(kT,Gg({width:i,height:l},c,{ref:n})))}),pte=["item"],fte={layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"},lC=h.forwardRef((e,t)=>{var n=_s(e,fte);return h.createElement(hte,{chartName:"PieChart",defaultTooltipEventType:"item",validateTooltipEventTypes:pte,tooltipPayloadSearcher:vy,categoricalChartProps:n,ref:t})}),gte=["axis"],xte=h.forwardRef((e,t)=>h.createElement(ST,{chartName:"ComposedChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:gte,tooltipPayloadSearcher:vy,categoricalChartProps:e,ref:t}));const yte=(e,t)=>{if(typeof e!="number")return"0";switch(t){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);case"number":default:return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:e%1!==0?1:0}).format(e)}},bte=(e,t=12)=>!e||typeof e!="string"?"":e.length<=t?e:e.substring(0,t-1)+"",vte=({active:e,payload:t,label:n,formatType:s,dataType:a,isStacked:i})=>{if(e&&t&&t.length){const l=t[0].payload;return r.jsxs("div",{className:"bg-white p-3 border border-gray-200 rounded-lg shadow-lg",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:l.fullName||n}),i?t.map((o,c)=>{var d;return r.jsxs("p",{style:{color:o.color},className:"text-sm font-semibold",children:[o.name,": $",((d=o.value)==null?void 0:d.toLocaleString())||0]},c)}):r.jsx("p",{className:"text-sm text-indigo-600 font-semibold",children:yte(l.displayValue,s)}),a==="location"&&l.employeeCount>0&&r.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Employees: ",l.employeeCount]}),a==="employee"&&l.location&&r.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Location: ",l.location]})]})}return null},Uo=h.memo(({data:e=[],title:t,color:n,formatType:s,height:a=380,chartType:i,currentPage:l=0,totalItems:o=0,onPageChange:c,dataType:d="location",showTooltip:u=!0,isStacked:m=!1,benchmark:p})=>{const f=m?15:20,y=Math.ceil((o||e.length)/f),g=l*f,x=g+f,b=h.useMemo(()=>e.slice(g,x),[e,g,x]),v=b.map(C=>({...C,name:bte(C.name,10),fullName:C.name})),w=C=>s==="currency"?C>=1e6?`$${(C/1e6).toFixed(1)}M`:C>=1e3?`$${(C/1e3).toFixed(0)}K`:`$${C}`:C>=1e6?`${(C/1e6).toFixed(1)}M`:C>=1e3?`${(C/1e3).toFixed(0)}K`:`${C}`,N=C=>s==="currency"?C>=1e6?`Median: $${(C/1e6).toFixed(1)}M`:C>=1e3?`Median: $${(C/1e3).toFixed(0)}K`:`Median: $${C.toLocaleString()}`:C>=1e6?`Median: ${(C/1e6).toFixed(1)}M`:C>=1e3?`Median: ${(C/1e3).toFixed(0)}K`:`Median: ${C.toLocaleString()}`,k=()=>{l>0&&c&&c(i,l-1)},j=()=>{l<y-1&&c&&c(i,l+1)},S=()=>{switch(d){case"employee":return"employees";case"location":return"locations";case"product":return"products";case"customer":return"customers";default:return"items"}},_=()=>{switch(d){case"employee":return"No employee data available";case"location":return"No location data available";case"product":return"No product data available";case"customer":return"No customer data available";default:return"No data available"}};return!e||e.length===0?r.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:t}),r.jsx("div",{className:"flex items-center justify-center h-64 text-gray-500",children:r.jsx("p",{children:_()})})]}):r.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t}),y>1&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:k,disabled:l===0,className:`p-1 rounded ${l===0?"text-gray-300 cursor-not-allowed":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:r.jsx(di,{className:"w-4 h-4"})}),r.jsxs("span",{className:"text-sm text-gray-600 px-2",children:[l+1," of ",y]}),r.jsx("button",{onClick:j,disabled:l>=y-1,className:`p-1 rounded ${l>=y-1?"text-gray-300 cursor-not-allowed":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:r.jsx(Ta,{className:"w-4 h-4"})})]}),y<=1&&r.jsxs("span",{className:"text-sm text-gray-500",children:["(",e.length," ",S(),")"]})]}),r.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-4",children:r.jsx(Fu,{width:"100%",height:a,children:r.jsxs(ite,{data:v,margin:{top:20,right:30,left:40,bottom:20},children:[r.jsx("defs",{children:r.jsxs("linearGradient",{id:`gradient-${i}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[r.jsx("stop",{offset:"5%",stopColor:n,stopOpacity:.8}),r.jsx("stop",{offset:"95%",stopColor:n,stopOpacity:.6})]})}),r.jsx($y,{strokeDasharray:"3 3",stroke:"#E5E7EB",vertical:!1}),r.jsx(Ym,{dataKey:"name",angle:-45,textAnchor:"end",height:40,tick:{fontSize:9,fill:"#6B7280"},interval:0}),r.jsx(pc,{tickFormatter:w,tick:{fontSize:11,fill:"#4B5563"}}),u&&r.jsx($u,{content:({active:C,payload:D,label:A})=>r.jsx(vte,{active:C,payload:D,label:A,formatType:s,dataType:d,isStacked:m}),cursor:{fill:"rgba(0, 0, 0, 0.1)"}}),m?r.jsxs(r.Fragment,{children:[r.jsx(Al,{dataKey:"profit",name:"Profit",fill:"#10B981",stackId:"a",radius:[0,0,0,0]}),r.jsx(Al,{dataKey:"additionalRevenue",name:"Additional Revenue",fill:"#3B82F6",stackId:"a",radius:[4,4,0,0]})]}):r.jsx(Al,{dataKey:"value",fill:`url(#gradient-${i})`,radius:[4,4,0,0],stroke:n,strokeWidth:1}),p!=null&&r.jsx(Iy,{y:p,stroke:"#ef4444",strokeDasharray:"3 3",strokeWidth:2,label:{value:N(p),position:"top",fill:"#ef4444",fontSize:12,fontWeight:"bold"}})]})})}),r.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-gray-600",children:[r.jsx("span",{children:y>1?`Showing ${Math.min(f,b.length)} of ${o||e.length} ${S()}`:`Ranked by highest ${d} performance  Hover for ${d} names`}),r.jsx("span",{className:"text-gray-500",children:y>1?`Page ${l+1}  Hover for ${d} details`:`Top ${Math.min(e.length,f)} shown`})]})]})});Uo.displayName="MetricBarChart";const bd=(e,t="value")=>{if(!e||!Array.isArray(e)||e.length===0)return 0;const n=e.map(a=>parseFloat(a[t])||0).sort((a,i)=>a-i),s=Math.floor(n.length/2);return n.length%2===0?(n[s-1]+n[s])/2:n[s]},oC=(e,t,n=5)=>{if(!e||!Array.isArray(e)||e.length===0)return{pieData:[],concentration:{topNPercentage:0,totalEntities:0,topNCount:0}};const s=e.reduce((d,u)=>d+(parseFloat(u.value)||0),0),a=e.slice(0,n),i=e.slice(n),l=a.map(d=>({name:d.name,value:parseFloat(d.value)||0,percentage:s>0?((parseFloat(d.value)||0)/s*100).toFixed(1):0}));if(i.length>0){const d=i.reduce((u,m)=>u+(parseFloat(m.value)||0),0);l.push({name:`Others (${i.length})`,value:d,percentage:s>0?(d/s*100).toFixed(1):0})}const o=a.reduce((d,u)=>d+(parseFloat(u.value)||0),0),c=s>0?(o/s*100).toFixed(1):0;return{pieData:l,concentration:{topNPercentage:parseFloat(c),totalEntities:e.length,topNCount:a.length}}},wte=(e,t="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0}).format(e||0),vd="prelude_filter_sales_date",_T=()=>{const[e,t]=h.useState(()=>{try{const o=Pl(vd);if(o)return{startDate:new Date(o.startDate),endDate:new Date(o.endDate),label:o.label||"Custom Range"};const c=sessionStorage.getItem("sales_trends_date_filter");if(c){const d=JSON.parse(c),u={startDate:new Date(d.startDate),endDate:new Date(d.endDate),label:d.label||"Custom Range"};return ti(vd,{startDate:u.startDate.toISOString(),endDate:u.endDate.toISOString(),label:u.label},{expires:30}),sessionStorage.removeItem("sales_trends_date_filter"),u}}catch(o){console.warn("Failed to restore date filter:",o)}return null}),n=h.useCallback(o=>{if(o===null)_C(vd),t(null);else{const c={startDate:o.startDate.toISOString(),endDate:o.endDate.toISOString(),label:o.label};ti(vd,c,{expires:30}),t(o)}},[]),s=h.useCallback(()=>{n(null)},[n]),a=h.useCallback(o=>{const c=Cx(new Date);let d,u;switch(o){case"last_3_months":d=Qs(Ca(c,3)),u="Last 3 Months";break;case"last_6_months":d=Qs(Ca(c,6)),u="Last 6 Months";break;case"last_year":d=Qs(Xi(c,1)),u="Last Year";break;case"all_time":s();return;default:return}n({startDate:d,endDate:c,label:u})},[n,s]),i=e!==null,l=h.useCallback(()=>e?e.label||"Custom Range":"All Time",[e]);return{dateFilter:e,setDateFilter:n,clearFilter:s,setPreset:a,isFilterActive:i,getFilterSummary:l}},jte=({topN:e})=>{const{concentrationData:t,concentrationLoading:n,concentrationError:s}=Zl(),a=["#031D4A","#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#6B7280"],{customerData:i,productData:l}=h.useMemo(()=>{var m,p;if(!t)return{customerData:null,productData:null};const d=(((m=t.customer)==null?void 0:m.raw_data)||[]).map(f=>({name:f.customer,value:f.total_revenue,revenue:f.total_revenue})),u=(((p=t.product)==null?void 0:p.raw_data)||[]).map(f=>({name:f.product,value:f.total_revenue,revenue:f.total_revenue}));return{customerData:oC(d,"customer",e),productData:oC(u,"product",e)}},[t,e]),o=({active:d,payload:u})=>{if(d&&u&&u.length){const m=u[0].payload;return r.jsxs("div",{className:"bg-white p-3 border border-gray-200 rounded-lg shadow-lg",children:[r.jsx("p",{className:"text-sm font-semibold text-gray-900",children:m.name}),r.jsx("p",{className:"text-sm text-gray-600",children:wte(m.value)}),r.jsxs("p",{className:"text-sm text-gray-500",children:[m.percentage,"%"]})]})}return null},c=({cx:d,cy:u,midAngle:m,innerRadius:p,outerRadius:f,percentage:y})=>{const g=Math.PI/180,x=p+(f-p)*.5,b=d+x*Math.cos(-m*g),v=u+x*Math.sin(-m*g);return parseFloat(y)<5?null:r.jsx("text",{x:b,y:v,fill:"white",textAnchor:b>d?"start":"end",dominantBaseline:"central",className:"text-xs font-semibold",children:`${y}%`})};return n?r.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[1,2].map(d=>r.jsx(We,{className:"p-6",children:r.jsxs("div",{className:"animate-pulse",children:[r.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/2 mb-4"}),r.jsx("div",{className:"h-64 bg-gray-100 rounded"})]})},d))}):s?r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:r.jsx("p",{className:"text-red-800",children:s})}):!i&&!l?r.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6 text-center",children:[r.jsx(PC,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),r.jsx("p",{className:"text-gray-600",children:"No concentration data available"})]}):r.jsx("div",{className:"space-y-6",children:r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[r.jsxs(We,{className:"p-6",children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Customer Revenue Concentration"}),(i==null?void 0:i.concentration)&&r.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Top ",i.concentration.topNCount,": ",i.concentration.topNPercentage,"% of revenue",r.jsxs("span",{className:"text-gray-400 ml-1",children:["(",i.concentration.totalEntities," total customers)"]})]})]}),r.jsx(Fu,{width:"100%",height:300,children:r.jsxs(lC,{children:[r.jsx(qu,{data:(i==null?void 0:i.pieData)||[],cx:"50%",cy:"50%",labelLine:!1,label:c,outerRadius:100,fill:"#8884d8",dataKey:"value",animationDuration:800,animationBegin:0,children:((i==null?void 0:i.pieData)||[]).map((d,u)=>r.jsx(Xl,{fill:a[u%a.length]},`cell-${u}`))}),r.jsx($u,{content:r.jsx(o,{})}),r.jsx(sc,{verticalAlign:"bottom",height:36,formatter:d=>r.jsx("span",{className:"text-xs text-gray-700",children:d})})]})})]}),r.jsxs(We,{className:"p-6",children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Product Revenue Concentration"}),(l==null?void 0:l.concentration)&&r.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Top ",l.concentration.topNCount,": ",l.concentration.topNPercentage,"% of revenue",r.jsxs("span",{className:"text-gray-400 ml-1",children:["(",l.concentration.totalEntities," total products)"]})]})]}),r.jsx(Fu,{width:"100%",height:300,children:r.jsxs(lC,{children:[r.jsx(qu,{data:(l==null?void 0:l.pieData)||[],cx:"50%",cy:"50%",labelLine:!1,label:c,outerRadius:100,fill:"#8884d8",dataKey:"value",animationDuration:800,animationBegin:0,children:((l==null?void 0:l.pieData)||[]).map((d,u)=>r.jsx(Xl,{fill:a[u%a.length]},`cell-${u}`))}),r.jsx($u,{content:r.jsx(o,{})}),r.jsx(sc,{verticalAlign:"bottom",height:36,formatter:d=>r.jsx("span",{className:"text-xs text-gray-700",children:d})})]})})]})]})})};function Nte(e){if(!e||!Array.isArray(e))return{unknownEntities:[],cleanData:[],stats:{totalCount:0,unknownCount:0,cleanCount:0}};const t=e.filter(s=>{var a;return s.name==="Unknown"||s.name==="unknown"||((a=s.name)==null?void 0:a.toLowerCase().includes("unknown"))}),n=e.filter(s=>{var a;return s.name!=="Unknown"&&s.name!=="unknown"&&!((a=s.name)!=null&&a.toLowerCase().includes("unknown"))});return{unknownEntities:t,cleanData:n,stats:{totalCount:e.length,unknownCount:t.length,cleanCount:n.length}}}const Cte=({tableName:e,selectedMetric:t,showBenchmark:n,showConcentration:s,showUnknown:a,topN:i,dataLimit:l,limitEnabled:o})=>{var v,w,N,k,j,S,_,C,D,A,E,T,M,L,P,$,R,U,I,z;const{dateFilter:c}=_T(),{comparativeData:d,comparativeLoading:u,comparativeError:m}=Zl(),[p,f]=le.useState({employee:0,location:0,product:0,customer:0}),y=(F,O,K,J,se,Z,oe)=>{if(!F||!Array.isArray(F))return{data:[],hiddenCount:0,hiddenTotal:0};let W=F;K&&(W=F.filter(he=>{const G=new Date(he.date||he.week_start||he.period||he.timestamp);return!isNaN(G)&&G>=K.startDate&&G<=K.endDate}));const B={};W.forEach(he=>{const G=he[O]||"Unknown";B[G]||(B[G]={revenue:0,profit:0,volume:0}),B[G].revenue+=he.total_revenue||he.revenue||0,B[G].profit+=he.total_profit||he.profit||0,B[G].volume+=he.unique_transactions||0});let V=Object.entries(B).map(([he,G])=>({name:he,fullName:he,value:G[J]||0,displayValue:G[J]||0,revenue:G.revenue,profit:G.profit,volume:G.volume}));V.sort((he,G)=>G[J]-he[J]);let re=0,Me=0;if(!se){const{cleanData:he,unknownEntities:G,stats:q}=Nte(V);re=q.unknownCount,Me=G.reduce((Q,ue)=>Q+(ue[J]||0),0),V=he}return oe&&Z&&Z<V.length&&(V=V.slice(0,Z)),{data:V,hiddenCount:re,hiddenTotal:Me}},g=(F,O)=>{f(K=>({...K,[F]:O}))},x=h.useMemo(()=>d?{Employee:y(d.Employee,"employee",c,t,a,l,o),Location:y(d.Location,"location",c,t,a,l,o),Products:y(d.Products,"product",c,t,a,l,o),Customers:y(d.Customers,"customer",c,t,a,l,o)}:null,[d,c,t,a,l,o]);if(u)return r.jsx("div",{className:"space-y-6",children:r.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:["Employee Performance","Location Performance","Product Performance","Customer Performance"].map((F,O)=>r.jsx(We,{className:"p-6",style:{height:"300px"},children:r.jsxs("div",{className:"animate-pulse",children:[r.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/2 mb-4"}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]}),r.jsx("div",{className:"mt-6 h-32 bg-gray-200 rounded"})]})},O))})});if(m)return r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:r.jsx("p",{className:"text-red-800",children:m})});if(!x)return r.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6 text-center",children:[r.jsx(Ot,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),r.jsx("p",{className:"text-gray-600",children:"No comparative metrics available"})]});const b=a?0:(((v=x.Employee)==null?void 0:v.hiddenCount)||0)+(((w=x.Location)==null?void 0:w.hiddenCount)||0)+(((N=x.Products)==null?void 0:N.hiddenCount)||0)+(((k=x.Customers)==null?void 0:k.hiddenCount)||0);return r.jsxs("div",{className:"space-y-6",children:[!a&&b>0&&r.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-center gap-2",children:[r.jsx(dt,{className:"w-4 h-4 text-blue-600 flex-shrink-0"}),r.jsxs("span",{className:"text-sm text-blue-800",children:["Hiding ",b," unknown ",b===1?"entity":"entities","."]})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[r.jsx(Uo,{data:((j=x.Employee)==null?void 0:j.data)||[],title:"Employee Performance",color:"#3B82F6",formatType:t==="volume"?"number":"currency",height:300,chartType:"employee",currentPage:p.employee,totalItems:((_=(S=x.Employee)==null?void 0:S.data)==null?void 0:_.length)||0,onPageChange:g,dataType:"employee",showTooltip:!0,isStacked:!1,benchmark:n?bd(((C=x.Employee)==null?void 0:C.data)||[],t):void 0}),r.jsx(Uo,{data:((D=x.Location)==null?void 0:D.data)||[],title:"Location Performance",color:"#3B82F6",formatType:t==="volume"?"number":"currency",height:300,chartType:"location",currentPage:p.location,totalItems:((E=(A=x.Location)==null?void 0:A.data)==null?void 0:E.length)||0,onPageChange:g,dataType:"location",showTooltip:!0,isStacked:!1,benchmark:n?bd(((T=x.Location)==null?void 0:T.data)||[],t):void 0}),r.jsx(Uo,{data:((M=x.Products)==null?void 0:M.data)||[],title:"Product Performance",color:"#3B82F6",formatType:t==="volume"?"number":"currency",height:300,chartType:"product",currentPage:p.product,totalItems:((P=(L=x.Products)==null?void 0:L.data)==null?void 0:P.length)||0,onPageChange:g,dataType:"product",showTooltip:!0,isStacked:!1,benchmark:n?bd((($=x.Products)==null?void 0:$.data)||[],t):void 0}),r.jsx(Uo,{data:((R=x.Customers)==null?void 0:R.data)||[],title:"Customer Performance",color:"#3B82F6",formatType:t==="volume"?"number":"currency",height:300,chartType:"customer",currentPage:p.customer,totalItems:((I=(U=x.Customers)==null?void 0:U.data)==null?void 0:I.length)||0,onPageChange:g,dataType:"customer",showTooltip:!0,isStacked:!1,benchmark:n?bd(((z=x.Customers)==null?void 0:z.data)||[],t):void 0})]}),s&&r.jsx(jte,{topN:i})]})};function kte(e){if(!e||e.length===0)return[];const t=[...e].sort((o,c)=>new Date(o.date)-new Date(c.date)),n=[],s=new Date(t[0].date),a=new Date(t[t.length-1].date),i=new Map(t.map(o=>[new Date(o.date).toISOString().split("T")[0],o.value]));let l=new Date(s);for(;l<=a;){const o=l.toISOString().split("T")[0];n.push({date:o,value:i.get(o)||0}),l.setDate(l.getDate()+7)}return n}function Ste(e){if(!e||e.length===0)return[];const t=new Map;return e.forEach(n=>{const s=new Date(n.date),a=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`;t.has(a)||t.set(a,{date:`${a}-01`,value:0,count:0});const i=t.get(a);i.value+=parseFloat(n.value)||0,i.count+=1}),Array.from(t.values()).map(n=>({date:n.date,value:n.value})).sort((n,s)=>new Date(n.date)-new Date(s.date))}function _te(e){return!e||e.length===0?[]:e.map((t,n)=>{let s=0;if(n>0){const a=parseFloat(t.value)||0,i=parseFloat(e[n-1].value)||0;i!==0&&(s=(a-i)/i*100,s=Math.max(-100,Math.min(150,s)))}return{...t,actualValue:t.value,cumulativeValue:s}})}function Ete(e,t="weekly"){if(!e||e.length===0)return[];const n=kte(e),s=t==="monthly"?Ste(n):n;return _te(s).map(i=>({...i,displayDate:Dte(i.date,t)}))}function Dte(e,t){const n=new Date(e);return t==="monthly"?n.toLocaleDateString("en-US",{month:"short",year:"2-digit"}):n.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function Tte(e){if(!e||e.length===0)return{leftAxis:{domain:[0,100]},rightAxis:{domain:[-100,150]}};const t=e.map(i=>i.actualValue||0),n=Math.max(...t);return{leftAxis:{domain:[0,Math.ceil(n*1.1)]},rightAxis:{domain:[-100,150]}}}const ff=({title:e,data:t=[],color:n="blue",formatType:s="number",icon:a,loading:i=!1,error:l=null,height:o=200,description:c="",table_total:d=null,dataLimit:u,limitEnabled:m})=>{var j;const[p,f]=h.useState("monthly"),g=typeof a=="string"?{TrendingUp:Ot,DollarSign:Ur,Package:LC,Users:kt,Target:Er,ShoppingCart:V4,BarChart:$A,Activity:Bn,MapPin:vn,Calendar:yt,CalendarDays:ib}[a]:a||Ot,x={primary:"#031D4A"},b=x,v=S=>{const _=parseFloat(S);if(isNaN(_))return"0";switch(s){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(_);case"percentage":return`${_.toFixed(1)}%`;case"number":default:return new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:_%1!==0?1:0}).format(_)}};let w=Ete(t,p);m&&u&&w.length>u&&(w=w.slice(-u));const N=Tte(w);d??(w.length>0&&((j=w[w.length-1])!=null&&j.actualValue));const k=({active:S,payload:_,label:C})=>{if(S&&_&&_.length){const D=_.find(E=>E.dataKey==="actualValue"),A=_.find(E=>E.dataKey==="cumulativeValue");return r.jsxs("div",{className:"bg-white p-3 border border-gray-200 rounded-lg shadow-lg",children:[r.jsx("p",{className:"text-sm text-gray-600",children:`Date: ${C}`}),D&&r.jsx("p",{className:"text-sm font-semibold",style:{color:x.primary},children:`Actual: ${v(D.value)}`}),A&&r.jsx("p",{className:"text-sm font-semibold text-gray-600",children:`Change: ${A.value.toFixed(1)}%`})]})}return null};return i?r.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 animate-pulse",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),r.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full"})]}),r.jsx("div",{className:"h-40 bg-gray-100 rounded mb-4"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]}):l?r.jsxs("div",{className:"bg-white rounded-lg border border-red-200 p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-900",children:e}),r.jsx(g,{className:"w-5 h-5 text-red-500"})]}),r.jsx("div",{className:"flex items-center justify-center h-40 bg-red-50 rounded",children:r.jsx("p",{className:"text-red-600 text-sm",children:"Error loading chart data"})})]}):!w||w.length===0?r.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-900",children:e}),r.jsx(g,{className:"w-5 h-5 text-gray-400"})]}),r.jsx("div",{className:"flex items-center justify-center h-40 bg-gray-50 rounded",children:r.jsx("p",{className:"text-gray-500 text-sm",children:"No trend data available"})})]}):r.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 hover:shadow-lg transition-all duration-200 hover:scale-[1.02]",children:[r.jsx("div",{className:"flex items-center justify-between mb-4",children:r.jsx("div",{className:"flex-1",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:e}),c&&r.jsx("p",{className:"text-xs text-gray-500",children:c})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:"flex items-center bg-gray-100 rounded-lg p-1",children:[r.jsxs("button",{onClick:()=>f("monthly"),className:`px-2 py-1 text-xs font-medium rounded transition-all duration-200 flex items-center gap-1 ${p==="monthly"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[r.jsx(ib,{className:"w-3 h-3"}),"Monthly"]}),r.jsxs("button",{onClick:()=>f("weekly"),className:`px-2 py-1 text-xs font-medium rounded transition-all duration-200 flex items-center gap-1 ${p==="weekly"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[r.jsx(yt,{className:"w-3 h-3"}),"Weekly"]})]}),r.jsx("div",{className:"w-10 h-10 rounded-full bg-prelude-50 flex items-center justify-center",children:r.jsx(g,{className:"w-5 h-5",style:{color:b.primary}})})]})]})})}),r.jsx("div",{style:{height:o},children:r.jsx(Fu,{width:"100%",height:"100%",children:r.jsxs(xte,{data:w,margin:{top:5,right:30,left:5,bottom:5},children:[r.jsx($y,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),r.jsx(Ym,{dataKey:"displayDate",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#6b7280"}}),r.jsx(pc,{yAxisId:"left",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#6b7280"},tickFormatter:v,domain:N.leftAxis.domain}),r.jsx(pc,{yAxisId:"right",orientation:"right",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#6b7280"},tickFormatter:S=>`${S}%`,domain:N.rightAxis.domain}),r.jsx($u,{content:r.jsx(k,{})}),r.jsx(Al,{yAxisId:"left",dataKey:"actualValue",fill:b.primary,fillOpacity:.6,radius:[2,2,0,0],animationDuration:1e3,animationEasing:"ease-in-out"}),r.jsx(Fy,{yAxisId:"right",type:"monotone",dataKey:"cumulativeValue",stroke:"#059669",strokeWidth:2,dot:{r:2,fill:"#059669"},activeDot:{r:4,fill:"#059669"},animationDuration:1e3,animationEasing:"ease-in-out"})]})})})]})},cC=({trendsData:e=[],loading:t=!1,error:n=null,dataLimit:s,limitEnabled:a})=>t?r.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[...Array(4)].map((i,l)=>r.jsx(ff,{title:"Loading...",loading:!0},`loading-${l}`))}):n?r.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[...Array(8)].map((i,l)=>r.jsx(ff,{title:`Chart ${l+1}`,error:"Failed to load trend data"},`error-${l}`))}):!e||e.length===0?r.jsx("div",{className:"flex items-center justify-center h-64 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-gray-500 text-lg font-medium mb-2",children:"No Trend Data Available"}),r.jsx("p",{className:"text-gray-400 text-sm",children:"Upload data to see trend charts"})]})}):r.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:e.map((i,l)=>r.jsx(ff,{title:i.title,data:i.data,color:i.color,formatType:i.format_type,icon:i.icon,description:i.description,loading:!1,error:i.error,height:200,table_total:i.table_total,dataLimit:s,limitEnabled:a},i.id||`chart-${l}`))}),Ate=({title:e,value:t,icon:n="TrendingUp",color:s="blue",formatType:a="number",loading:i=!1,error:l=null})=>{const o={TrendingUp:Ot,DollarSign:Ur,Users:kt,Target:Er}[n]||Ot,c={blue:"text-blue-600 bg-blue-50",green:"text-green-600 bg-green-50",purple:"text-purple-600 bg-purple-50",orange:"text-orange-600 bg-orange-50",red:"text-red-600 bg-red-50"},d=(u,m)=>{if(u==null||isNaN(u))return"N/A";const p=Number(u);switch(m){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(p);case"percentage":return`${p.toFixed(1)}%`;case"number":default:return p>=1e6?`${(p/1e6).toFixed(1)}M`:p>=1e3?`${(p/1e3).toFixed(1)}K`:p.toLocaleString()}};return i?r.jsxs(We,{className:"h-full",children:[r.jsxs(ir,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(cr,{className:"text-sm font-medium text-muted-foreground",children:e}),r.jsx("div",{className:`h-4 w-4 rounded ${c[s]||c.blue}`,children:r.jsx("div",{className:"animate-pulse bg-current opacity-20 h-full w-full rounded"})})]}),r.jsx(it,{children:r.jsxs("div",{className:"animate-pulse",children:[r.jsx("div",{className:"h-8 bg-gray-200 rounded w-24 mb-2"}),r.jsx("div",{className:"h-3 bg-gray-200 rounded w-16"})]})})]}):l?r.jsxs(We,{className:"h-full border-red-200",children:[r.jsxs(ir,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(cr,{className:"text-sm font-medium text-muted-foreground",children:e}),r.jsx(dt,{className:"h-4 w-4 text-red-500"})]}),r.jsxs(it,{children:[r.jsx("div",{className:"text-2xl font-bold text-red-600",children:"Error"}),r.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Failed to load"})]})]}):r.jsxs(We,{className:"h-full",children:[r.jsxs(ir,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(cr,{className:"text-sm font-medium text-muted-foreground",children:e}),r.jsx("div",{className:`p-2 rounded-lg ${c[s]||c.blue}`,children:r.jsx(o,{className:"h-4 w-4"})})]}),r.jsxs(it,{children:[r.jsx("div",{className:"text-2xl font-bold",children:d(t,a)}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Real-time data"})]})]})},Ga=le.memo(Ate),Pte=({selectedTable:e,dateFilter:t,dataLimit:n,limitEnabled:s})=>{var N,k,j,S;const{trendsData:a,trendsLoading:i,loadTrendsData:l,overallData:o,overallLoading:c,loadOverallData:d}=Zl();h.useEffect(()=>{e&&a===null&&!i&&l(e)},[e,a,i]),h.useEffect(()=>{e&&o===null&&!c&&d(e)},[e,o,c]);const u=h.useMemo(()=>!a||!t?a:a.map(_=>{const C=_.data.filter(D=>{const A=new Date(D.time_period||D.date);return A>=t.startDate&&A<=t.endDate});return{..._,data:C,filteredCount:C.length,totalCount:_.data.length}}),[a,t]),m=h.useMemo(()=>!u||!t?!0:u.some(_=>_.data.length>0),[u,t]),p=_=>!o||!o[_]||!o[_].data||o[_].data.length===0?null:o[_].data[0]||null,f=(N=p("total_revenue"))==null?void 0:N.total_revenue,y=(k=p("total_profit"))==null?void 0:k.total_profit,g=(j=p("total_customers"))==null?void 0:j.total_customers,b=((S=p("profit_margin"))==null?void 0:S.profit_margin_percentage)||(f&&y?y/f*100:null);if(c||i)return r.jsxs("div",{className:"space-y-8",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[r.jsx(Ga,{title:"Total Revenue",icon:"DollarSign",color:"green",loading:!0}),r.jsx(Ga,{title:"Total Profit",icon:"TrendingUp",color:"blue",loading:!0}),r.jsx(Ga,{title:"Total Customers",icon:"Users",color:"purple",loading:!0}),r.jsx(Ga,{title:"Profit Margin",icon:"Target",color:"orange",loading:!0})]}),r.jsx(cC,{loading:!0})]});const v=()=>r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[r.jsx(Ga,{title:"Total Revenue",value:f,icon:"DollarSign",color:"green",formatType:"currency",loading:c,error:o===null&&!c?"Failed to load":null}),r.jsx(Ga,{title:"Total Profit",value:y,icon:"TrendingUp",color:"blue",formatType:"currency",loading:c,error:o===null&&!c?"Failed to load":null}),r.jsx(Ga,{title:"Total Customers",value:g,icon:"Users",color:"purple",formatType:"number",loading:c,error:o===null&&!c?"Failed to load":null}),r.jsx(Ga,{title:"Profit Margin",value:b,icon:"Target",color:"orange",formatType:"percentage",loading:c,error:o===null&&!c?"Failed to load":null})]}),w=()=>r.jsxs("div",{className:"space-y-8",children:[v(),t&&!m&&r.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 flex items-start gap-3",children:[r.jsx(dt,{className:"w-5 h-5 text-amber-600 mt-0.5"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"text-sm font-medium text-amber-900",children:"No data in selected date range"}),r.jsxs("p",{className:"text-sm text-amber-700 mt-1",children:["No trend data available for ",tu(t.startDate,"MMM d, yyyy")," - ",tu(t.endDate,"MMM d, yyyy"),'. Try adjusting your date range or select "All Time" to view all available data.']})]})]}),r.jsx(cC,{trendsData:u,loading:i,error:null,dataLimit:n,limitEnabled:s})]});return a&&a.length>0,w()},Ote=le.memo(Pte),Ka="comparative_metrics_",Mte=()=>{const[e,t]=h.useState(()=>{try{return sessionStorage.getItem(`${Ka}metric`)||"revenue"}catch(g){return console.warn("Failed to restore metric selection:",g),"revenue"}}),[n,s]=h.useState(()=>{try{return sessionStorage.getItem(`${Ka}benchmark`)==="true"}catch(g){return console.warn("Failed to restore benchmark setting:",g),!0}}),[a,i]=h.useState(()=>{try{return sessionStorage.getItem(`${Ka}concentration`)!=="false"}catch(g){return console.warn("Failed to restore concentration setting:",g),!0}}),[l,o]=h.useState(()=>{try{const g=sessionStorage.getItem(`${Ka}topN`);return g?parseInt(g):5}catch(g){return console.warn("Failed to restore top N setting:",g),5}}),c=h.useCallback(g=>{sessionStorage.setItem(`${Ka}metric`,g),t(g)},[]),d=h.useCallback(g=>{sessionStorage.setItem(`${Ka}benchmark`,String(g)),s(g)},[]),u=h.useCallback(g=>{sessionStorage.setItem(`${Ka}concentration`,String(g)),i(g)},[]),m=h.useCallback(g=>{sessionStorage.setItem(`${Ka}topN`,String(g)),o(g)},[]),p=h.useCallback(()=>e.charAt(0).toUpperCase()+e.slice(1),[e]),f=h.useCallback(()=>n?"Median":"Median Off",[n]),y=h.useCallback(()=>a?`Top ${l}`:"Concentration Off",[a,l]);return{selectedMetric:e,setSelectedMetric:c,showBenchmark:n,setShowBenchmark:d,showConcentration:a,setShowConcentration:u,topN:l,setTopN:m,getMetricLabel:p,getBenchmarkLabel:f,getConcentrationLabel:y}},gf="prelude_filter_unknown",dC="sales_center_show_unknown",Ite=()=>{const[e,t]=h.useState(()=>{try{const a=Pl(gf);if(a!==null)return a;const i=sessionStorage.getItem(dC);if(i!==null){const l=i==="true";return ti(gf,l,{expires:365}),sessionStorage.removeItem(dC),l}}catch(a){console.warn("Failed to restore unknown filter setting:",a)}return!1}),n=h.useCallback(a=>{ti(gf,a,{expires:365}),t(a)},[]),s=h.useCallback(()=>e?"Unknown: Shown":"Unknown: Hidden",[e]);return{showUnknown:e,setShowUnknown:n,getFilterLabel:s}},wd="sales_center_data_limit_",Lte=()=>{const[e,t]=h.useState(()=>{try{const o=sessionStorage.getItem(`${wd}limit`);return o?parseInt(o):50}catch(o){return console.warn("Failed to restore data limit setting:",o),50}}),[n,s]=h.useState(()=>{try{return sessionStorage.getItem(`${wd}enabled`)!=="false"}catch(o){return console.warn("Failed to restore limit enabled setting:",o),!0}}),a=h.useCallback(o=>{sessionStorage.setItem(`${wd}limit`,String(o)),t(o)},[]),i=h.useCallback(o=>{sessionStorage.setItem(`${wd}enabled`,String(o)),s(o)},[]),l=h.useCallback(()=>!n||e>=999999?"Show All":`Top ${e}`,[n,e]);return{dataLimit:e,setDataLimit:a,limitEnabled:n,setLimitEnabled:i,getLimitLabel:l}};class Rte extends le.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,n){this.setState({error:t,errorInfo:n})}render(){return this.state.hasError?r.jsxs(We,{className:"p-8 text-center border-red-200 bg-red-50",children:[r.jsx(dt,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Something went wrong"}),r.jsx("p",{className:"text-red-600 mb-4",children:"There was an error loading this component. Please refresh the page and try again."}),r.jsxs(H,{onClick:()=>window.location.reload(),variant:"outline",className:"border-red-300 text-red-700 hover:bg-red-100",children:[r.jsx(Be,{className:"w-4 h-4 mr-2"}),"Refresh Page"]}),!1]}):this.props.children}}const $te=({mode:e="main-overview",selectedTable:t,availableTables:n=[],tablesLoading:s=!1,onTableChange:a})=>{const[i,l]=h.useState(!1),[o,c]=h.useState(!1),{setAvailableTables:d,overallLoading:u,trendsLoading:m}=Zl(),{dateFilter:p,setDateFilter:f,clearFilter:y,setPreset:g}=_T(),{selectedMetric:x,setSelectedMetric:b,showBenchmark:v,setShowBenchmark:w,showConcentration:N,setShowConcentration:k,topN:j,setTopN:S}=Mte(),{showUnknown:_,setShowUnknown:C}=Ite(),{dataLimit:D,setDataLimit:A,limitEnabled:E,setLimitEnabled:T}=Lte(),M=async L=>{if(o){console.log(" Upload success - tables update already in progress, skipping");return}console.log(" Upload success - updating tables list"),c(!0);try{const P=await gA();d(P),console.log(" Upload success - tables list updated")}catch(P){console.error("Failed to update tables after upload:",P)}finally{c(!1)}};if(e==="main-overview"||e==="upload-only"||e==="default")return r.jsxs("div",{className:"space-y-8",children:[r.jsx(Uv,{mode:"overview",primaryAction:{label:"Upload Data",onClick:()=>l(!0),loading:u||m},selectedTable:t,availableTables:n,tablesLoading:s,onTableChange:a,dateFilter:p,setDateFilter:f,clearDateFilter:y,setDatePreset:g,limitEnabled:E,setLimitEnabled:T,dataLimit:D,setDataLimit:A,themeColor:"purple"}),r.jsx(Ote,{selectedTable:t,dateFilter:p,dataLimit:D,limitEnabled:E}),r.jsx(l8,{isOpen:i,onClose:()=>l(!1),onUploadSuccess:M})]});if(e==="comparative-metrics")return r.jsxs("div",{className:"space-y-6",children:[r.jsx(Uv,{mode:"comparative",selectedMetric:x,setSelectedMetric:b,showUnknown:_,setShowUnknown:C,showBenchmark:v,setShowBenchmark:w,showConcentration:N,setShowConcentration:k,topN:j,setTopN:S,themeColor:"purple"}),r.jsx(Cte,{tableName:t,selectedMetric:x,showBenchmark:v,showConcentration:N,showUnknown:_,topN:j,dataLimit:D,limitEnabled:E})]})},$d=le.memo(e=>r.jsx(Rte,{children:r.jsx($te,{...e})}));$d.displayName="SalesAnalyticsDashboardWithErrorBoundary";const Fte={DollarSign:Ur,Users:kt,TrendingUp:Ot,TrendingDown:iP,BarChart3:Da,Package:LC,Calendar:yt,Target:Er,Activity:Bn,Database:qn},xf=10,zte=5,Bte=20,Ute=e=>typeof e!="number"?e:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:2}).format(e),qte=e=>{if(!e&&e!==0)return"";if(typeof e=="number")return Ute(e);const t=String(e);return t.length>500?t.substring(0,500)+"...":t},Hte=le.memo(({query:e,timestamp:t,onRerun:n})=>r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm text-gray-900 truncate",children:e}),r.jsx("p",{className:"text-xs text-gray-500",children:new Date(t).toLocaleString()})]}),r.jsx(H,{variant:"outline",size:"sm",onClick:()=>n(e),className:"ml-3 flex-shrink-0",children:r.jsx(Be,{className:"w-3 h-3"})})]})),Wte=le.memo(({metric:e})=>{const t=Fte[e.icon]||qn,n=e.positive!==!1;return r.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-100",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600 mb-1",children:e.label}),r.jsx("p",{className:`text-xl font-bold ${n?"text-green-600":"text-red-600"}`,children:e.value})]}),r.jsx(t,{className:`w-8 h-8 ${n?"text-green-500":"text-red-500"}`})]})})}),Yte=le.memo(({insights:e,loading:t})=>t?r.jsx("div",{className:"mb-6",children:r.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[r.jsx(Mr,{className:"w-5 h-5 text-purple-500"}),r.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Insights"}),r.jsx(Il,{className:"w-4 h-4 animate-spin"}),r.jsx("span",{className:"text-sm",children:"Generating insights..."})]})}):e?typeof e=="string"?r.jsx("div",{className:"mb-6",children:r.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[r.jsx(Mr,{className:"w-5 h-5 text-purple-500 mt-0.5"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Business Insights"}),r.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-lg border border-purple-100 mt-2",children:r.jsx("p",{className:"text-gray-800 leading-relaxed",children:e})})]})]})}):r.jsxs("div",{className:"mb-6",children:[r.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[r.jsx(Mr,{className:"w-5 h-5 text-purple-500 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Insights"}),r.jsx("p",{className:"text-gray-700 mt-1",children:e.summary})]})]}),Array.isArray(e.keyMetrics)&&e.keyMetrics.length>0&&r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:e.keyMetrics.map((n,s)=>r.jsx(Wte,{metric:n},s))}),Array.isArray(e.insights)&&e.insights.length>0&&r.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-lg border border-purple-100",children:r.jsx("ul",{className:"space-y-2",children:e.insights.map((n,s)=>r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx(bt,{className:"w-4 h-4 text-purple-500 mt-0.5 flex-shrink-0"}),r.jsx("span",{className:"text-gray-800",children:n})]},s))})})]}):null),Vte=le.memo(({data:e,columns:t,totalRows:n})=>r.jsxs("div",{className:"overflow-x-auto border rounded-lg",children:[r.jsxs("table",{className:"w-full text-sm",children:[r.jsx("thead",{children:r.jsx("tr",{className:"border-b border-gray-200 bg-gray-50",children:t.map((s,a)=>r.jsx("th",{className:"text-left py-2 px-3 font-medium text-gray-700",children:s},a))})}),r.jsx("tbody",{children:e.slice(0,xf).map((s,a)=>r.jsx("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:t.map((i,l)=>r.jsx("td",{className:"py-2 px-3 text-gray-900",children:qte(s[i])},l))},a))})]}),n>xf&&r.jsxs("div",{className:"p-2 text-xs text-gray-500 text-center bg-gray-50",children:["Showing first ",xf," of ",n," results"]})]})),Gte=({message:e,progress:t})=>r.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 rounded-lg border-2 border-blue-300 mb-4 shadow-sm",children:[r.jsx(Il,{className:"w-6 h-6 text-blue-600 animate-spin"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-base font-medium text-blue-900",children:e}),t!==void 0&&r.jsx("div",{className:"mt-2 w-full bg-blue-200 rounded-full h-3 shadow-inner",children:r.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-3 rounded-full transition-all duration-500 shadow-sm",style:{width:`${t}%`}})}),r.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:[t,"% complete"]})]})]}),Kte=({selectedTable:e})=>{const[t,n]=h.useState(""),[s,a]=h.useState([]),[i,l]=h.useState(!1),[o,c]=h.useState(null),[d,u]=h.useState(()=>{try{const C=localStorage.getItem("sales_query_use_streaming");return C!==null?JSON.parse(C):!0}catch{return!0}}),[m,p]=h.useState({}),f=h.useRef(null),y=h.useRef(null),[g,x]=h.useState(()=>{try{const C=localStorage.getItem("sales_query_history");return C?JSON.parse(C):[]}catch{return[]}});h.useCallback(C=>{u(C);try{localStorage.setItem("sales_query_use_streaming",JSON.stringify(C))}catch(D){console.error("Failed to save streaming preference:",D)}},[]);const b=h.useCallback(C=>{const D=[{query:C,timestamp:new Date().toISOString()},...g.filter(A=>A.query!==C)].slice(0,Bte);x(D);try{localStorage.setItem("sales_query_history",JSON.stringify(D))}catch(A){console.error("Failed to save query history:",A)}},[g]),v=h.useCallback(async C=>{if(C.trim()){l(!0),c(null);try{if(d)w(C);else{const D=await xA(C,e,!0);a(A=>[{id:Date.now(),query:C,result:D.query_result||D,insights:D.insights,performance:D.performance,timestamp:new Date().toISOString()},...A]),b(C)}}catch(D){console.error("Query execution failed:",D),a(A=>[{id:Date.now(),query:C,result:{is_error:!0,message:D.message||"Failed to execute query",data:[],columns:[],row_count:0},insights:null,timestamp:new Date().toISOString()},...A])}finally{l(!1)}}},[e,d,b]),w=h.useCallback(C=>{y.current&&(y.current(),y.current=null);const D=Date.now();a(E=>[{id:D,query:C,result:null,insights:null,timestamp:new Date().toISOString(),isStreaming:!0},...E]);const A=yA(C,{tableName:e},E=>{c(E)},E=>{a(T=>T.map(M=>M.id===D?{...M,result:E,isStreaming:!0}:M))},E=>{a(T=>T.map(M=>M.id===D?{...M,insights:E,isStreaming:!1}:M)),setTimeout(()=>c(null),1e3),l(!1),b(C)},E=>{console.error("Streaming error:",E),a(T=>T.map(M=>M.id===D?{...M,result:{is_error:!0,message:E.message,data:[],columns:[],row_count:0},isStreaming:!1}:M)),setTimeout(()=>c(null),1e3),l(!1)});y.current=A},[e,b]),N=h.useCallback(C=>{C.preventDefault(),t.trim()&&!i&&(v(t.trim()),n(""))},[t,i,v]),k=h.useCallback((C,D)=>{const A=[D.join(","),...C.map(M=>D.map(L=>{const P=M[L];return P==null?"":`"${P.toString().replace(/"/g,'""')}"`}).join(","))].join(`
`),E=new Blob([A],{type:"text/csv;charset=utf-8;"}),T=document.createElement("a");T.href=URL.createObjectURL(E),T.download=`query_results_${Date.now()}.csv`,T.click()},[]),j=h.useCallback(async C=>{try{return await navigator.clipboard.writeText(C),!0}catch(D){return console.error("Failed to copy text:",D),!1}},[]),S=h.useCallback(C=>{p(D=>({...D,[C]:!D[C]}))},[]);h.useEffect(()=>()=>{y.current&&y.current()},[]);const _=h.useMemo(()=>g.slice(0,zte),[g]);return r.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[r.jsx(Mr,{className:"w-6 h-6 text-purple-600"}),r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Natural Language Query"})]}),r.jsx("p",{className:"text-gray-600",children:"Ask questions about your sales data in plain English"}),r.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2 text-sm text-gray-600",children:[r.jsx(qn,{className:"w-4 h-4"}),r.jsxs("span",{children:["Querying table: ",r.jsx("span",{className:"font-medium text-gray-900",children:e})]})]})]}),r.jsx(We,{className:"p-4",children:r.jsxs("form",{onSubmit:N,className:"space-y-4",children:[r.jsx("textarea",{ref:f,value:t,onChange:C=>n(C.target.value),placeholder:"Ask a question about your sales data... (e.g., 'Who are my top performing salespeople this month?')",className:"w-full px-4 py-3 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,disabled:i}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[r.jsx(Kr,{className:"w-4 h-4"}),r.jsx("span",{children:"Powered by AI  Natural language to SQL"})]}),r.jsxs("span",{className:"text-xs text-gray-600 flex items-center gap-1",children:[r.jsx(Mr,{className:"w-3 h-3"}),r.jsx("span",{children:"Real-time processing"})]})]}),r.jsx(H,{type:"submit",disabled:!t.trim()||i,className:"flex items-center gap-2",children:i?r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"w-4 h-4 animate-spin"}),"Processing..."]}):r.jsxs(r.Fragment,{children:[r.jsx(to,{className:"w-4 h-4"}),"Ask Question"]})})]})]})}),o&&r.jsx(Gte,{...o}),_.length>0&&r.jsxs(We,{className:"p-4",children:[r.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center gap-2",children:[r.jsx(jt,{className:"w-4 h-4"}),"Recent Queries"]}),r.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:_.map((C,D)=>r.jsx(Hte,{query:C.query,timestamp:C.timestamp,onRerun:A=>{var E;n(A),(E=f.current)==null||E.focus()}},D))})]}),r.jsx("div",{className:"space-y-4",children:s.map(C=>{var D,A;return r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("h4",{className:"text-sm font-medium text-gray-700",children:['"',C.query,'"']}),C.result&&C.result.fuzzy_used&&r.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium bg-purple-100 text-purple-700 rounded-full",title:"Enhanced with fuzzy matching for better results",children:[r.jsx(Mr,{className:"w-3 h-3"}),"Smart Match"]})]}),r.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[C.performance&&r.jsxs(r.Fragment,{children:[C.performance.cache_hit&&" Cached",Math.round(C.performance.total_time_ms),"ms"]}),new Date(C.timestamp).toLocaleTimeString()]})]}),C.result&&r.jsx(We,{className:"p-6",children:C.result.is_error?r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(dt,{className:"w-5 h-5 text-red-500 mt-0.5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Query Failed"}),r.jsx("p",{className:"text-sm text-red-700 mt-1",children:C.result.message})]})]}):r.jsxs(r.Fragment,{children:[r.jsx(Yte,{insights:C.insights,loading:C.isStreaming}),r.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[r.jsxs("button",{onClick:()=>S(C.id),className:"flex items-center gap-2 text-sm text-gray-600 hover:text-gray-800",children:[m[C.id]?r.jsx(La,{className:"w-4 h-4"}):r.jsx(Xt,{className:"w-4 h-4"}),m[C.id]?"Hide":"Show"," Technical Details"]}),m[C.id]&&r.jsxs("div",{className:"mt-4 space-y-4",children:[r.jsxs("div",{className:"flex gap-2",children:[C.result.sql_query&&r.jsxs(H,{variant:"outline",size:"sm",onClick:()=>j(C.result.sql_query),className:"flex items-center gap-1",children:[r.jsx(yc,{className:"w-3 h-3"}),"Copy SQL"]}),((D=C.result.data)==null?void 0:D.length)>0&&r.jsxs(H,{variant:"outline",size:"sm",onClick:()=>k(C.result.data,C.result.columns),className:"flex items-center gap-1",children:[r.jsx(ra,{className:"w-3 h-3"}),"Export Data"]})]}),C.result.sql_query&&r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"p-3 bg-gray-100 rounded-lg",children:[r.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Generated SQL:"}),r.jsx("code",{className:"text-xs text-gray-800 font-mono block break-all",children:C.result.sql_query})]}),C.result.fuzzy_used&&C.result.exact_sql&&r.jsxs("div",{className:"p-3 bg-purple-50 rounded-lg border border-purple-200",children:[r.jsx("p",{className:"text-xs text-purple-600 mb-1 font-medium",children:"Enhanced with Smart Matching:"}),r.jsx("div",{className:"mt-2 text-xs text-purple-600",children:r.jsx("p",{children:" This query was enhanced to find similar matches and provide better results"})})]})]}),((A=C.result.data)==null?void 0:A.length)>0&&r.jsx(Vte,{data:C.result.data,columns:C.result.columns,totalRows:C.result.row_count})]})]})]})})]},C.id)})}),s.length===0&&!i&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(Kr,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Ready to Answer Your Questions"}),r.jsx("p",{className:"text-gray-600",children:"Type a question about your sales data above to get started"})]})]})},Xte=({overview:e})=>e?r.jsxs(We,{className:"p-6 border border-border bg-card",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx(Da,{className:"w-5 h-5 text-foreground"}),r.jsx("h3",{className:"text-2xl font-bold text-foreground",children:"Business Intelligence Summary"})]}),r.jsx("div",{className:"text-base leading-relaxed text-muted-foreground",children:e})]}):null,ET=h.forwardRef(({title:e,situation:t,actions:n,icon:s,onCardClick:a,dataAvailable:i=!0},l)=>{const o=(n==null?void 0:n.length)||0,c=i?"h-64 p-6 border border-border bg-card flex flex-col cursor-pointer hover:shadow-lg transition-shadow duration-200":"h-64 p-6 border border-gray-300 bg-gray-50 flex flex-col cursor-pointer hover:shadow-md transition-shadow duration-200 opacity-75",d=i?"w-5 h-5 text-foreground":"w-5 h-5 text-gray-400",u=i?"text-lg font-semibold text-foreground":"text-lg font-semibold text-gray-600",m=i?"text-sm text-muted-foreground leading-relaxed line-clamp-6":"text-sm text-gray-500 leading-relaxed line-clamp-6 italic";return r.jsxs(We,{ref:l,className:c,onClick:a,children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s&&r.jsx(s,{className:d}),r.jsx("h3",{className:u,children:e})]}),r.jsx("div",{className:"flex-1 overflow-hidden",children:r.jsx("p",{className:m,children:t||(i?"No situation details available":"")})}),r.jsx("div",{className:"pt-4 mt-auto border-t border-border",children:r.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[r.jsx("span",{children:i?r.jsxs(r.Fragment,{children:[o," ",o===1?"Action":"Actions"]}):r.jsx(r.Fragment,{children:""})}),r.jsx("span",{children:"Click to view "})]})})]})});ET.displayName="ActionFlipCard";const Jte=({isOpen:e,onClose:t,insights:n,currentIndex:s,onNavigate:a,cardPosition:i,navigationDirection:l})=>{var L;const o=n[s],c=s>0,d=s<n.length-1,[u,m]=h.useState(!1),[p,f]=h.useState(null),[y,g]=h.useState(!1),[x,b]=h.useState(!1),w={"Today's Priorities":{description:"Analyzes today's transactions to identify high-value customer activities requiring immediate follow-up.",timeframe:"Today only"},"Customer Engagement":{description:"Tracks customer interaction frequency changes over the past 30 days to identify relationships needing reactivation or maintenance.",timeframe:"Past 30 days"},"Revenue Opportunities":{description:"Identifies high-revenue but low-frequency customers from historical data to uncover growth potential.",timeframe:"Lifetime value (all-time)"},"Strategic Initiatives":{description:"Identifies long-term strategic customers and growth opportunities based on historical data to plan future direction.",timeframe:"Lifetime analysis (all-time)"},"Risk Assessment":{description:"Analyzes revenue concentration risk using the Pareto principle (80/20 rule) to identify over-dependence on specific customers. Healthy distribution: top 20% of customers should generate 70-85% of revenue.",timeframe:"Lifetime value (all-time)"},"Performance Intelligence":{description:"Monitors daily revenue fluctuation trends over the past 30 days to identify dates with exceptional performance.",timeframe:"Past 30 days"}}[o==null?void 0:o.title]||null;h.useEffect(()=>{m(!1),f(null),b(!1)},[s]);const N=async()=>{if(!(!o||!o.actions||o.actions.length===0)){if(p){b(!x);return}g(!0);try{const $=await(await fetch("http://localhost:8002/api/insights/optimize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({section_name:o.title,situation:o.situation,actions:o.actions,additional_context:{}})})).json();$.success&&$.optimized_actions?(f($.optimized_actions),b(!0)):(console.error("Optimization failed:",$.message),alert("Failed to optimize actions. Please try again."))}catch(P){console.error("Error optimizing actions:",P),alert("Failed to optimize actions. Please check your connection.")}finally{g(!1)}}};h.useEffect(()=>{if(!e)return;const P=$=>{$.key==="Escape"?t():$.key==="ArrowLeft"&&c?a(s-1):$.key==="ArrowRight"&&d&&a(s+1)};return window.addEventListener("keydown",P),()=>window.removeEventListener("keydown",P)},[e,s,c,d,t,a]);const k=h.useCallback(()=>{c&&a(s-1)},[c,s,a]),j=h.useCallback(()=>{d&&a(s+1)},[d,s,a]),S=P=>{switch(P==null?void 0:P.toUpperCase()){case"MAJOR":case"CRITICAL":return"text-red-700 font-bold bg-red-50 px-2 py-0.5 rounded";case"HIGH":return"text-red-600 font-semibold";case"MEDIUM":return"text-yellow-600 font-medium";case"LOW":return"text-blue-600 font-normal";default:return"text-foreground font-normal"}},_=P=>{if(!P)return"No deadline";try{return new Date(P).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch{return P}};if(!o)return null;const C=o.icon,D=((L=o.actions)==null?void 0:L.length)||0,A=D>0,E=()=>{if(!i||l!==null)return{opacity:1,scale:1,x:0,y:0};const P=window.innerWidth/2,$=window.innerHeight/2,R=i.left+i.width/2,U=i.top+i.height/2;return{opacity:0,scale:.3,x:R-P,y:U-$}},T=()=>l?l==="next"?{x:20}:{x:-20}:{x:0},M=()=>l?l==="next"?{x:-20}:{x:20}:{x:0};return r.jsx(ht,{mode:"wait",children:e&&r.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:t}),r.jsxs("div",{className:"relative z-50 w-full max-w-2xl mx-4",children:[r.jsxs(de.div,{initial:E(),animate:{opacity:1,scale:1,x:0,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",damping:25,stiffness:300,duration:.3},className:"relative w-full max-h-[85vh] bg-white rounded-lg shadow-2xl overflow-hidden",children:[r.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[C&&r.jsx(C,{className:"w-6 h-6 text-foreground"}),r.jsx("h2",{className:"text-xl font-semibold text-foreground",children:o.title}),w&&r.jsx("button",{onClick:()=>m(!u),className:"p-1 rounded-full hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500",title:"Show section information",children:r.jsx(Za,{className:`h-4 w-4 ${u?"text-purple-600":"text-gray-400"}`})})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("span",{className:"text-xs text-gray-500",children:[s+1," / ",n.length]}),r.jsxs("button",{onClick:t,className:"rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2",children:[r.jsx(Ze,{className:"h-5 w-5"}),r.jsx("span",{className:"sr-only",children:"Close"})]})]})]}),r.jsx(ht,{children:u&&w&&r.jsx(de.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:r.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[r.jsx("p",{className:"text-sm text-gray-600 leading-relaxed mb-2",children:w.description}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase",children:"Timeframe:"}),r.jsx("span",{className:"text-xs text-purple-600 font-semibold",children:w.timeframe})]})]})})})]}),r.jsx(ht,{mode:"wait",children:r.jsxs(de.div,{initial:{opacity:0,...T()},animate:{opacity:1,x:0},exit:{opacity:0,...M()},transition:{duration:.2,ease:"easeOut"},className:"overflow-y-auto max-h-[calc(85vh-80px)] p-6 space-y-6",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide mb-2",children:"Insight"}),r.jsx("p",{className:"text-base text-gray-800 leading-relaxed",children:o.situation||"No insight details available"})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:["Actions (",D,")"]}),x&&p&&r.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-purple-100 text-purple-700 rounded-full",children:"AI Optimized"})]}),A&&r.jsxs("button",{onClick:N,disabled:y,className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-purple-600 hover:text-purple-700 hover:bg-purple-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(Mr,{className:`h-4 w-4 ${y?"animate-pulse":""}`}),y?"Optimizing...":x?"View Original":"Optimize with AI"]})]}),A?r.jsx("div",{className:"space-y-4",children:(x&&p?p:o.actions).map((P,$)=>{var R;return r.jsxs("div",{className:`rounded-lg p-4 border transition-all ${x&&p?"bg-purple-50 border-purple-300 shadow-sm":"bg-gray-50 border-gray-200 hover:border-purple-300"}`,children:[r.jsx("div",{className:"font-medium text-foreground mb-2 text-base",children:typeof P=="string"?P:P.action}),!(x&&p)&&typeof P=="object"&&r.jsxs("div",{className:"flex flex-wrap gap-3 text-sm",children:[P.customer&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"text-gray-500",children:"Customer:"}),r.jsx("span",{className:"font-medium text-gray-900",children:P.customer})]}),P.priority&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"text-gray-500",children:"Priority:"}),r.jsx("span",{className:S(P.priority),children:P.priority})]}),P.deadline&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"text-gray-500",children:"Due:"}),r.jsx("span",{className:"text-gray-900",children:_(P.deadline)})]}),P.confidence&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"text-gray-500",children:"Confidence:"}),r.jsxs("span",{className:"text-gray-900 font-medium",children:[(P.confidence*100).toFixed(0),"%"]})]})]}),!(x&&p)&&typeof P=="object"&&P.calculation_details&&r.jsxs("details",{className:"mt-3",children:[r.jsxs("summary",{className:"cursor-pointer text-purple-600 hover:text-purple-700 font-medium text-sm flex items-center gap-2",children:[r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"View Calculation Details"]}),r.jsxs("div",{className:"mt-3 p-4 bg-white rounded-lg border border-purple-200 space-y-3 text-sm",children:[r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"font-semibold text-gray-700 min-w-[140px]",children:"Opportunity Value:"}),r.jsxs("span",{className:"text-green-600 font-bold",children:["$",(R=P.calculation_details.opportunity_value)==null?void 0:R.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),P.calculation_details.formula&&r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"font-semibold text-gray-700 min-w-[140px]",children:"Formula:"}),r.jsx("code",{className:"flex-1 text-xs bg-gray-50 px-3 py-2 rounded border border-gray-200 font-mono",children:P.calculation_details.formula})]}),P.calculation_details.assumptions&&P.calculation_details.assumptions.length>0&&r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"font-semibold text-gray-700 min-w-[140px]",children:"Assumptions:"}),r.jsx("ul",{className:"flex-1 list-disc list-inside space-y-1",children:P.calculation_details.assumptions.map((U,I)=>r.jsx("li",{className:"text-gray-600",children:U},I))})]}),P.calculation_details.reason&&r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"font-semibold text-gray-700 min-w-[140px]",children:"Reasoning:"}),r.jsx("span",{className:"flex-1 text-gray-600",children:P.calculation_details.reason})]}),P.calculation_details.target_description&&r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"font-semibold text-gray-700 min-w-[140px]",children:"Target:"}),r.jsx("span",{className:"flex-1 text-gray-600",children:P.calculation_details.target_description})]}),P.calculation_details.data_sources&&r.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[r.jsx("span",{className:"font-semibold text-gray-700 text-xs uppercase tracking-wide",children:"Data Sources:"}),r.jsx("div",{className:"mt-2 grid grid-cols-2 gap-2 text-xs",children:Object.entries(P.calculation_details.data_sources).map(([U,I])=>r.jsxs("div",{className:"flex justify-between bg-gray-50 px-2 py-1 rounded",children:[r.jsxs("span",{className:"text-gray-600",children:[U.replace(/_/g," "),":"]}),r.jsx("span",{className:"font-medium text-gray-900",children:typeof I=="number"&&U.includes("value")?`$${I.toLocaleString("en-US",{minimumFractionDigits:2})}`:I})]},U))})]})]})]})]},$)})}):r.jsxs("div",{className:"text-center bg-gray-50 rounded-lg py-12 px-6 border border-gray-200",children:[r.jsx("p",{className:"text-gray-600 text-base",children:"No actions required for this area."}),r.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Business operations are normal."})]})]})]},s)})]}),n.length>1&&r.jsxs(r.Fragment,{children:[r.jsx(de.button,{initial:{opacity:0,x:10},animate:{opacity:c?.9:.5,x:0},exit:{opacity:0,x:10},transition:{duration:.3,delay:.1,ease:"easeOut"},onClick:k,disabled:!c,className:"absolute left-[-60px] top-1/2 -translate-y-1/2 p-3 rounded-full bg-white shadow-lg transition-all z-10 hover:bg-gray-100 hover:scale-110 cursor-pointer","aria-label":"Previous insight",children:r.jsx(di,{className:"w-7 h-7 text-gray-700"})}),r.jsx(de.button,{initial:{opacity:0,x:-10},animate:{opacity:d?.9:.5,x:0},exit:{opacity:0,x:-10},transition:{duration:.3,delay:.1,ease:"easeOut"},onClick:j,disabled:!d,className:"absolute right-[-60px] top-1/2 -translate-y-1/2 p-3 rounded-full bg-white shadow-lg transition-all z-10 hover:bg-gray-100 hover:scale-110 cursor-pointer","aria-label":"Next insight",children:r.jsx(Ta,{className:"w-7 h-7 text-gray-700"})})]})]})]})})},Qte=[{key:"todays_priorities",title:"Today's Priorities",icon:dt},{key:"customer_engagement",title:"Customer Engagement",icon:kt},{key:"revenue_opportunities",title:"Revenue Opportunities",icon:Ur},{key:"business_risk_assessment",title:"Risk Assessment",icon:AC},{key:"performance_intelligence",title:"Performance Intelligence",icon:Ot},{key:"strategic_initiatives",title:"Strategic Initiatives",icon:Er}],Zte=({actionsData:e})=>{const[t,n]=h.useState(null),[s,a]=h.useState(null),[i,l]=h.useState(null),o=h.useRef([]);if(!e)return r.jsx("div",{className:"text-center text-muted-foreground py-12",children:"No action data available"});const c=Qte.map(p=>{const f=e[p.key]||{},y=f.data_available!==!1,g=y?f.situation||"No information available":f.situation||"";return{key:p.key,title:p.title,icon:p.icon,situation:g,actions:f.actions||[],dataAvailable:y}}),d=(p,f)=>{if(f){const y=f.getBoundingClientRect();a(y)}l(null),n(p)},u=()=>{n(null),a(null),l(null)},m=p=>{const f=p>t?"next":"prev";l(f),n(p)};return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map((p,f)=>r.jsx(ET,{ref:y=>o.current[f]=y,title:p.title,situation:p.situation,actions:p.actions,icon:p.icon,dataAvailable:p.dataAvailable,onCardClick:()=>d(f,o.current[f])},p.key))}),r.jsx(Jte,{isOpen:t!==null,onClose:u,insights:c,currentIndex:t||0,onNavigate:m,cardPosition:s,navigationDirection:i})]})},ere=()=>{var d;const{insights:e,insightsLoading:t,insightsError:n,selectedTable:s,selectedTimeframe:a,setSelectedTimeframe:i,getPreGeneratedInsightsData:l}=Zl(),[o,c]=h.useState(!1);return h.useEffect(()=>{s&&!t&&l(s,a)},[s,a]),s?r.jsxs("div",{className:"space-y-8",children:[t&&r.jsxs("div",{className:"space-y-8 animate-pulse",children:[r.jsx("div",{className:"h-32 bg-muted rounded-lg"}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3,4,5,6].map(u=>r.jsx("div",{className:"h-64 bg-muted rounded-lg"},u))})]}),n&&!t&&r.jsxs(We,{className:"p-6 border-red-200 bg-red-50",children:[r.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-2",children:"Error Loading Insights"}),r.jsx("p",{className:"text-red-700",children:n}),r.jsx(H,{onClick:()=>l(s,a),className:"mt-4 bg-red-600 hover:bg-red-700 text-white",children:"Retry"})]}),e&&!t&&!n&&r.jsxs(r.Fragment,{children:[((d=e.part_1_summary)==null?void 0:d.overview)&&r.jsx(Xte,{overview:e.part_1_summary.overview}),e.part_2_actions&&r.jsx(Zte,{actionsData:e.part_2_actions})]})]}):r.jsxs(We,{className:"p-12 text-center border-gray-200 bg-gradient-to-br from-purple-50 to-blue-50",children:[r.jsx(bc,{className:"w-16 h-16 text-purple-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Data Source"}),r.jsx("p",{className:"text-gray-600",children:"Choose a data table to generate AI-powered business insights and analytics."})]})},tre=le.memo(ere),rre=()=>{const[e,t]=h.useState("upload"),{selectedTable:n,availableTables:s,tablesLoading:a,handleTableChange:i,comparativeData:l,comparativeLoading:o,loadComparativeData:c}=Zl(),d=[{id:"upload",label:"Upload & Overview",icon:vs},{id:"comparative",label:"Comparative Metrics",icon:Da},{id:"insights",label:"Business Insights",icon:bc},{id:"ask",label:"Ask Questions",icon:Kr}];le.useEffect(()=>{e==="comparative"&&!l&&!o&&n&&c()},[e,l,o,n,c]);const u=()=>{switch(e){case"upload":return r.jsx($d,{mode:"upload-only",selectedTable:n,availableTables:s,tablesLoading:a,onTableChange:i},"upload-tab");case"insights":return r.jsx(tre,{selectedTable:n,availableTables:s,tablesLoading:a,onTableChange:i},"insights-tab");case"comparative":return r.jsx($d,{mode:"comparative-metrics",selectedTable:n,availableTables:s,tablesLoading:a,preloadedData:l,dataLoading:o},"comparative-tab");case"ask":return r.jsx(Kte,{selectedTable:n},"ask-tab");default:return r.jsx($d,{mode:"main-overview",selectedTable:n,availableTables:s,tablesLoading:a,onTableChange:i},"main-overview-tab")}};return r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx(ri,{title:"Sales Center",themeColor:"purple",tabs:d.map(m=>({id:m.id,label:m.label,icon:m.icon,isActive:e===m.id,onClick:()=>t(m.id)}))}),r.jsx("div",{className:"flex-1 p-4 overflow-auto",children:r.jsx("div",{children:u()})})]})},nre=le.memo(rre),sre="http://localhost:8003",are=async(e,t)=>{const n=await t(`${sre}/api/crm/meetings/${e}`);if(!n.ok){const s=await n.json();throw new Error(s.detail||"Failed to fetch meeting")}return n.json()},DT=({isOpen:e,onClose:t,meetingId:n,authFetch:s,meeting:a,onUpdate:i,onDelete:l,googleAccessToken:o})=>{const[c,d]=h.useState(null),[u,m]=h.useState(!1),[p,f]=h.useState(null),[y,g]=h.useState(!1),[x,b]=h.useState(!1),[v,w]=h.useState(!1),[N,k]=h.useState(!1),[j,S]=h.useState({title:"",description:"",start_time:"",end_time:"",location:"",attendees:[],timezone:""}),_=h.useCallback(async()=>{if(!n||!s){f("Missing meeting ID or authentication");return}m(!0),f(null);try{console.log(" Fetching CRM meeting details for interaction ID:",n);const I=await are(n,s);console.log(" Meeting data received:",I),d(I)}catch(I){console.error(" Error fetching meeting details:",I),f(I.message||"Failed to load meeting details")}finally{m(!1)}},[n,s]);h.useEffect(()=>{e?a?(console.log(" Using pre-loaded meeting data:",a),d(a),m(!1),f(null),C(a)):n&&_():(g(!1),k(!1),f(null))},[e,n,a,_]);const C=I=>{if(!I)return;const z=F=>{if(!F)return"";try{const O=new Date(F),K=O.getFullYear(),J=String(O.getMonth()+1).padStart(2,"0"),se=String(O.getDate()).padStart(2,"0"),Z=String(O.getHours()).padStart(2,"0"),oe=String(O.getMinutes()).padStart(2,"0");return`${K}-${J}-${se}T${Z}:${oe}`}catch{return""}};S({title:I.title||"",description:I.description||"",start_time:z(I.start_time),end_time:z(I.end_time),location:I.location||"",attendees:Array.isArray(I.attendees)?I.attendees:[],timezone:I.timezone||Intl.DateTimeFormat().resolvedOptions().timeZone})};h.useEffect(()=>{c&&C(c)},[c]);const D=I=>{if(!I)return"Not specified";try{return new Date(I).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch{return I}},A=I=>{if(!I)return"Not specified";try{return new Date(I).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",timeZoneName:"short"})}catch{return I}},E=(I,z)=>{if(!I||!z)return"Unknown";try{const F=new Date(I),K=new Date(z)-F,J=Math.floor(K/6e4);if(J<60)return`${J} minutes`;{const se=Math.floor(J/60),Z=J%60;return Z>0?`${se}h ${Z}m`:`${se} hour${se>1?"s":""}`}}catch{return"Unknown"}},T=()=>{g(!0),f(null)},M=()=>{g(!1),f(null),C(c)},L=(I,z)=>{S(F=>({...F,[I]:z}))},P=I=>{const z=I.split(",").map(F=>F.trim()).filter(F=>F);S(F=>({...F,attendees:z}))},$=async()=>{if(!j.title.trim()){f("Meeting title is required");return}if(!j.start_time||!j.end_time){f("Start time and end time are required");return}b(!0),f(null);try{const I="http://localhost:8003",z={title:j.title.trim(),description:j.description.trim(),start_time:new Date(j.start_time).toISOString(),end_time:new Date(j.end_time).toISOString(),location:j.location.trim(),attendees:j.attendees,timezone:j.timezone},F=await s(`${I}/api/crm/meetings/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(z)});if(F.ok){const O=await F.json();d(O),g(!1),i&&i(O)}else{const O=await F.json();f(O.detail||"Failed to update meeting")}}catch(I){console.error("Error updating meeting:",I),f(I.message||"Failed to update meeting")}finally{b(!1)}},R=()=>{k(!0)},U=async()=>{w(!0);try{const z=await s(`http://localhost:8003/api/crm/meetings/${n}`,{method:"DELETE"});if(z.ok)l&&l(),t();else{const O=(await z.json()).detail||"Failed to delete meeting";O.includes("No valid Google access token")||O.includes("reconnect")?f("Please reconnect Google Calendar. Go to Calendar page and sign in again."):O.includes("permission")||O.includes("ownership")?f("You do not have permission to delete this meeting."):f(`Failed to delete meeting: ${O}`)}}catch(I){console.error("Error deleting meeting:",I),f(`Error deleting meeting: ${I.message}`)}finally{w(!1)}};return r.jsx(ht,{children:e&&r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:t,children:r.jsxs(de.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-lg shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",onClick:I=>I.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-pink-50 to-purple-50 sticky top-0 z-10",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-pink-100 rounded-lg",children:r.jsx(yt,{className:"w-6 h-6 text-pink-600"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:u?"Loading...":(c==null?void 0:c.title)||"Meeting Details"}),r.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:y?"Edit Meeting":"Meeting Details"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[!y&&!u&&c&&r.jsxs(H,{variant:"outline",size:"sm",onClick:T,className:"text-blue-600 border-blue-300 hover:bg-blue-50",children:[r.jsx(nl,{className:"w-4 h-4 mr-2"}),"Edit"]}),r.jsx(H,{variant:"ghost",size:"sm",onClick:t,className:"text-gray-500 hover:text-gray-700",disabled:x||v,children:r.jsx(Ze,{className:"w-5 h-5"})})]})]}),r.jsxs("div",{className:"p-6",children:[u?r.jsxs("div",{className:"flex items-center justify-center py-12",children:[r.jsx(Ct,{className:"w-8 h-8 text-blue-600 animate-spin"}),r.jsx("span",{className:"ml-3 text-gray-600",children:"Loading meeting details..."})]}):p?r.jsxs("div",{className:"flex items-start gap-2 p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm font-medium text-red-900 mb-1",children:"Error"}),r.jsx("p",{className:"text-sm text-red-700",children:p})]}),r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>f(null),className:"text-red-600 hover:text-red-800",children:r.jsx(Ze,{className:"w-4 h-4"})})]}):null,!u&&c&&y?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Meeting Title *"}),r.jsx("input",{type:"text",value:j.title,onChange:I=>L("title",I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"Enter meeting title",disabled:x})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Time *"}),r.jsx("input",{type:"datetime-local",value:j.start_time,onChange:I=>L("start_time",I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",disabled:x})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Time *"}),r.jsx("input",{type:"datetime-local",value:j.end_time,onChange:I=>L("end_time",I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",disabled:x})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Location"}),r.jsx("input",{type:"text",value:j.location,onChange:I=>L("location",I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"Enter location or meeting link",disabled:x})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Attendees (comma-separated emails)"}),r.jsx("input",{type:"text",value:j.attendees.join(", "),onChange:I=>P(I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"email1@example.com, email2@example.com",disabled:x})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),r.jsx("textarea",{value:j.description,onChange:I=>L("description",I.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"Enter meeting description",disabled:x})]}),r.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-gray-200",children:[r.jsx(H,{variant:"outline",onClick:M,disabled:x,children:"Cancel"}),r.jsx(H,{onClick:$,disabled:x||!j.title.trim()||!j.start_time||!j.end_time,className:"bg-pink-600 hover:bg-pink-700 text-white",children:x?r.jsxs(r.Fragment,{children:[r.jsx(Ct,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Xr,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]})]}):!u&&c?r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{children:r.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:c.title})}),r.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 border border-gray-200",children:[r.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(Ut,{className:"w-5 h-5 text-blue-600"}),"Meeting Information"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(yt,{className:"w-5 h-5 text-blue-500 mt-1"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Date"}),r.jsx("p",{className:"text-base text-gray-900 mt-1",children:D(c.start_time)})]})]}),r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(jt,{className:"w-5 h-5 text-green-500 mt-1"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Time"}),r.jsx("p",{className:"text-base text-gray-900 mt-1",children:A(c.start_time)})]})]}),r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(jt,{className:"w-5 h-5 text-orange-500 mt-1"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Duration"}),r.jsx("p",{className:"text-base text-gray-900 mt-1",children:E(c.start_time,c.end_time)})]})]}),c.timezone&&r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(jt,{className:"w-5 h-5 text-purple-500 mt-1"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Timezone"}),r.jsx("p",{className:"text-base text-gray-900 mt-1",children:c.timezone})]})]}),c.location&&r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(vn,{className:"w-5 h-5 text-red-500 mt-1"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Location"}),r.jsx("p",{className:"text-base text-gray-900 mt-1",children:c.location})]})]}),c.meeting_link&&r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(IC,{className:"w-5 h-5 text-indigo-500 mt-1"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Meeting Link"}),r.jsx("a",{href:c.meeting_link,target:"_blank",rel:"noopener noreferrer",className:"text-base text-blue-600 hover:text-blue-800 underline mt-1 break-all",children:"Join Meeting"})]})]})]})]}),c.description&&r.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200",children:[r.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[r.jsx(Ut,{className:"w-5 h-5 text-blue-600"}),"Description"]}),r.jsx("p",{className:"text-gray-700 whitespace-pre-wrap leading-relaxed",children:c.description})]}),c.attendees&&c.attendees.length>0&&r.jsxs("div",{className:"bg-white rounded-lg p-6 border border-gray-200",children:[r.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(kt,{className:"w-5 h-5 text-blue-600"}),"Attendees (",c.attendees.length,")"]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:c.attendees.map((I,z)=>r.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[r.jsx(_t,{className:"w-4 h-4 text-gray-400"}),r.jsx("span",{className:"text-sm",children:I})]},z))})]}),N&&r.jsxs("div",{className:"flex items-start gap-2 p-4 bg-red-50 border border-red-200 rounded-lg",children:[r.jsx(fr,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm font-medium text-red-900 mb-1",children:"Are you sure?"}),r.jsx("p",{className:"text-sm text-red-700 mb-3",children:"This meeting will be permanently deleted from both your CRM and Google Calendar. This action cannot be undone."}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(H,{variant:"outline",size:"sm",onClick:()=>k(!1),disabled:v,children:"Cancel"}),r.jsx(H,{variant:"destructive",size:"sm",onClick:U,disabled:v,className:"bg-red-600 hover:bg-red-700 text-white",children:v?r.jsxs(r.Fragment,{children:[r.jsx(Ct,{className:"w-4 h-4 mr-2 animate-spin"}),"Deleting..."]}):"Confirm Delete"})]})]})]})]}):null]}),!u&&c&&!y&&r.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[r.jsxs(H,{variant:"outline",onClick:R,disabled:v||N,className:"text-red-600 border-red-300 hover:bg-red-50",children:[r.jsx(fr,{className:"h-4 w-4 mr-2"}),"Delete Meeting"]}),r.jsx(H,{onClick:t,disabled:v,className:"px-6",children:"Close"})]})]})})})},TT=({event:e,customer:t,deal:n,isOpen:s,onClose:a,notes:i=[],customerInteractions:l=[],onDelete:o,onUpdate:c,authFetch:d})=>{var O,K,J,se;const u="http://localhost:8003",m=n?n.deal_id:t==null?void 0:t.id,p=n?"deal":"customer";n?n.deal_name:t==null||t.name;const[f,y]=h.useState(!1),[g,x]=h.useState(""),[b,v]=h.useState(""),[w,N]=h.useState(!1),[k,j]=h.useState(!1),[S,_]=h.useState(""),C=50,D=5e3,A=(e==null?void 0:e.originalType)==="call";if(h.useEffect(()=>{var Z;e&&A&&(x(((Z=e.metadata)==null?void 0:Z.theme)||e.title||""),v(e.description||""),y(!1),_(""))},[e,A]),h.useEffect(()=>{const Z=oe=>{oe.key==="Escape"&&(f?U():a())};return s&&(document.addEventListener("keydown",Z),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",Z),document.body.style.overflow="unset"}},[s,f,a]),!s||!e)return null;const E=((O=e.metadata)==null?void 0:O.interactionId)||e.id||((K=e.metadata)==null?void 0:K.interaction_id),T=i.filter(Z=>Z.interaction_id===E),M=Z=>{if(!Z)return"N/A";const oe=new Date(Z);return isNaN(oe.getTime())?"Invalid Date":{date:oe.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),time:oe.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}},L=Z=>{if(!Z)return"N/A";const oe=new Date(Z);return isNaN(oe.getTime())?"Invalid Date":new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}).format(oe)},P=Z=>{switch(Z){case"important":return"Important";case"urgent":return"Urgent";case"starred":return"Starred";default:return""}},$=M(e.date),R=async()=>{if(!b.trim()){_("Call summary content cannot be empty");return}if(b.length>D){_(`Content cannot exceed ${D} characters`);return}if(g.length>C){_(`Theme cannot exceed ${C} characters`);return}N(!0),_("");try{const Z=p==="deal"?`${u}/api/crm/deals/${m}/call-summaries/${E}`:`${u}/api/crm/customers/${m}/call-summaries/${E}`,oe=await d(Z,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:b.trim(),theme:g.trim()||null})});if(oe.ok){const W=await oe.json();c&&await c(W),y(!1)}else{const W=await oe.json();_("Failed to update call summary: "+(W.detail||"Unknown error"))}}catch(Z){console.error("Error updating call summary:",Z),_("Error updating call summary: "+Z.message)}finally{N(!1)}},U=()=>{var Z;x(((Z=e.metadata)==null?void 0:Z.theme)||e.title||""),v(e.description||""),y(!1),_("")},z=(Z=>{switch(Z){case"email":return{icon:Dt,bgColor:"bg-blue-100",textColor:"text-blue-600",borderColor:"border-blue-200"};case"call":return{icon:sn,bgColor:"bg-green-100",textColor:"text-green-600",borderColor:"border-green-200"};case"meeting":return{icon:kt,bgColor:"bg-purple-100",textColor:"text-purple-600",borderColor:"border-purple-200"};default:return{icon:Kr,bgColor:"bg-gray-100",textColor:"text-gray-600",borderColor:"border-gray-200"}}})(e.originalType),F=z.icon;return r.jsx(ht,{children:s&&r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:a,children:r.jsxs(de.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:Z=>Z.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:`w-12 h-12 rounded-full ${z.bgColor} flex items-center justify-center`,children:r.jsx(F,{className:`w-6 h-6 ${z.textColor}`})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:e.title}),r.jsxs("p",{className:"text-sm text-gray-500 capitalize",children:[e.originalType," Interaction"]})]})]}),r.jsx(H,{variant:"ghost",size:"icon",onClick:a,className:"text-gray-400 hover:text-gray-600",children:r.jsx(Ze,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-6 space-y-6",children:[S&&r.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:S}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(yt,{className:"w-5 h-5 text-gray-400"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:$.date}),r.jsx("p",{className:"text-xs text-gray-500",children:"Date"})]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(jt,{className:"w-5 h-5 text-gray-400"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:$.time}),r.jsx("p",{className:"text-xs text-gray-500",children:"Time"})]})]})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[r.jsx(kt,{className:"w-5 h-5 text-gray-600"}),"Participants"]}),e.originalType==="email"&&((J=e.metadata)!=null&&J.sourceName)&&((se=e.metadata)!=null&&se.sourceType)?r.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(_t,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:"text-sm font-medium",children:e.metadata.sourceType==="customer"?e.metadata.sourceName:e.employeeName}),r.jsxs("span",{className:"text-xs text-gray-500",children:["(",e.metadata.sourceType==="customer"?"Customer":"Employee",")"]})]}),r.jsx(Dn,{className:"w-4 h-4 text-gray-400"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(_t,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:"text-sm font-medium",children:e.metadata.sourceType==="customer"?e.employeeName:t==null?void 0:t.company}),r.jsxs("span",{className:"text-xs text-gray-500",children:["(",e.metadata.sourceType==="customer"?"Employee":"Customer",")"]})]})]})}):r.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(_t,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:"text-sm font-medium",children:e.employeeName}),r.jsx("span",{className:"text-xs text-gray-500",children:"(Employee)"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(qt,{className:"w-4 h-4 text-gray-500"}),r.jsx("span",{className:"text-sm font-medium",children:t==null?void 0:t.company}),r.jsx("span",{className:"text-xs text-gray-500",children:"(Customer)"})]})]})})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[r.jsx(Kr,{className:"w-5 h-5 text-gray-600"}),"Content"]}),A&&!f&&r.jsxs(H,{variant:"outline",size:"sm",onClick:()=>y(!0),className:"flex items-center gap-2",children:[r.jsx(nl,{className:"w-4 h-4"}),"Edit"]})]}),A&&f?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Theme ",r.jsx("span",{className:"text-gray-400",children:"(Optional)"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:"text",value:g,onChange:Z=>x(Z.target.value),placeholder:"Call theme...",className:"w-full px-3 py-2 pr-20 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm",maxLength:C,disabled:w}),r.jsxs("div",{className:"absolute bottom-2 right-3 text-xs text-gray-400",children:[g.length,"/",C]})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Summary ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("textarea",{value:b,onChange:Z=>v(Z.target.value),placeholder:"Call summary...",className:"w-full h-48 px-3 py-2 pr-20 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm",maxLength:D,disabled:w}),r.jsxs("div",{className:"absolute bottom-3 right-3 text-xs text-gray-400",children:[b.length,"/",D]})]})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(H,{onClick:R,disabled:!b.trim()||w,className:"flex items-center gap-2 bg-pink-600 hover:bg-pink-700 text-white",children:w?r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):r.jsxs(r.Fragment,{children:[r.jsx($n,{className:"w-4 h-4"}),"Save Changes"]})}),r.jsxs(H,{variant:"outline",onClick:U,disabled:w,className:"flex items-center gap-2",children:[r.jsx(Ql,{className:"w-4 h-4"}),"Cancel"]})]})]}):r.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:r.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap leading-relaxed",children:e.description||"No content available"})})]}),T.length>0&&r.jsxs("div",{className:"space-y-3",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[r.jsx(Ut,{className:"w-5 h-5 text-gray-600"}),"Notes (",T.length,")"]}),r.jsx("div",{className:"space-y-3",children:T.map(Z=>r.jsx("div",{className:`rounded-lg border p-4 ${Z.isStarred?"border-yellow-200 bg-yellow-50":"border-gray-200 bg-gray-50"}`,children:r.jsxs("div",{className:"flex gap-3",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"w-7 h-7 bg-gray-700 rounded-full flex items-center justify-center",children:r.jsx(_t,{className:"w-3 h-3 text-white"})})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[Z.title&&r.jsx("h5",{className:"text-sm font-medium text-gray-900 truncate",children:Z.title}),Z.isStarred&&r.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 bg-yellow-100 text-yellow-800 rounded-full text-xs flex-shrink-0",children:[r.jsx(on,{className:"w-2.5 h-2.5 fill-yellow-400 text-yellow-400"}),P(Z.star)]})]}),r.jsx("div",{className:"text-sm text-gray-700 leading-relaxed mb-2",children:Z.body||Z.content}),r.jsxs("div",{className:"text-xs text-gray-500",children:[L(Z.date),Z.updated_at&&Z.updated_at.getTime()!==Z.date.getTime()&&r.jsxs("span",{children:["  edited ",L(Z.updated_at)]})]})]})]})},Z.id))})]})]}),r.jsx("div",{className:"flex justify-end items-center gap-3 p-6 border-t border-gray-200",children:r.jsx(H,{variant:"outline",onClick:a,disabled:w||k,children:"Close"})})]})})})},ire=({isOpen:e,onClose:t,onAddNote:n,interaction:s,isAdding:a})=>{const[o,c]=h.useState(""),[d,u]=h.useState(""),[m,p]=h.useState(!1);h.useEffect(()=>{s!=null&&s.theme||s!=null&&s.title?c(s.theme||s.title||""):c("")},[s]),h.useEffect(()=>{e||(c(""),u(""),p(!1))},[e]);const y=(b=>{switch(b==null?void 0:b.toLowerCase()){case"email":return{icon:Dt,bgColor:"bg-blue-100",textColor:"text-blue-600",borderColor:"border-blue-200"};case"call":return{icon:sn,bgColor:"bg-green-100",textColor:"text-green-600",borderColor:"border-green-200"};case"meeting":return{icon:kt,bgColor:"bg-purple-100",textColor:"text-purple-600",borderColor:"border-purple-200"};default:return{icon:yt,bgColor:"bg-gray-100",textColor:"text-gray-600",borderColor:"border-gray-200"}}})(s==null?void 0:s.type),g=y.icon,x=()=>{d.trim()&&n({title:o.trim(),body:d.trim(),star:m})};return h.useEffect(()=>{const b=v=>{v.key==="Escape"&&!a&&t()};return e&&document.addEventListener("keydown",b),()=>{document.removeEventListener("keydown",b)}},[e,a,t]),!e||!s?null:r.jsx(ht,{children:e&&r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-[60] flex items-center justify-center p-4",onClick:a?void 0:t,children:r.jsxs(de.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:b=>b.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:`w-12 h-12 rounded-full ${y.bgColor} flex items-center justify-center`,children:r.jsx(g,{className:`w-6 h-6 ${y.textColor}`})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Add Note to Interaction"}),r.jsxs("p",{className:"text-sm text-gray-500 capitalize",children:[s.type," Interaction"]})]})]}),r.jsx(H,{variant:"ghost",size:"icon",onClick:t,disabled:a,className:"text-gray-400 hover:text-gray-600",children:r.jsx(Ze,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(Ut,{className:"w-5 h-5 text-gray-500 mt-0.5"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.title}),r.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:s.description})]})]})}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Note Title"}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:"text",value:o,onChange:b=>c(b.target.value),placeholder:"Note title (optional)...",className:"w-full px-4 py-3 pr-20 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",maxLength:200,disabled:a}),r.jsxs("div",{className:"absolute bottom-3 right-3 text-xs text-gray-400",children:[o.length,"/",200]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Note Content ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("textarea",{value:d,onChange:b=>u(b.target.value),placeholder:"Add your note about this interaction...",className:"w-full h-32 px-4 py-3 pr-20 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",maxLength:2e3,disabled:a}),r.jsxs("div",{className:"absolute bottom-3 right-3 text-xs text-gray-400",children:[d.length,"/",2e3]})]})]}),r.jsx("div",{className:"flex items-center gap-3",children:r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:m,onChange:b=>p(b.target.checked),disabled:a,className:"sr-only"}),r.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-full text-sm transition-colors ${m?"bg-yellow-100 text-yellow-800 border border-yellow-300":"bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200"}`,children:[r.jsx(on,{className:`w-4 h-4 ${m?"fill-yellow-400 text-yellow-400":""}`}),m?"Important":"Mark as Important"]})]})})]}),r.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t border-gray-200 bg-gray-50",children:[r.jsx(H,{variant:"outline",onClick:t,disabled:a,children:"Cancel"}),r.jsx(H,{className:"bg-blue-600 hover:bg-blue-700 text-white disabled:bg-gray-400",onClick:x,disabled:!d.trim()||a,children:a?r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"w-4 h-4 mr-2 animate-spin"}),"Adding Note..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Wt,{className:"w-4 h-4 mr-2"}),"Add Note"]})})]})]})})})},lre=({customer:e,onMeetingCreated:t,authFetch:n,googleAccessToken:s,selectedDate:a,selectedTimeSlot:i})=>{const l="http://localhost:8003",[o,c]=h.useState(""),[d,u]=h.useState(""),[m,p]=h.useState(""),[f,y]=h.useState(""),[g,x]=h.useState(""),[b,v]=h.useState([]),[w,N]=h.useState(""),[k,j]=h.useState("Google Meet"),[S,_]=h.useState(!1),[C,D]=h.useState(""),[A,E]=h.useState(""),T=Intl.DateTimeFormat().resolvedOptions().timeZone;h.useEffect(()=>{e!=null&&e.email&&!b.includes(e.email)&&v([e.email])},[e]),h.useEffect(()=>{a&&p(a)},[a]),h.useEffect(()=>{i&&(y(i.start),x(i.end))},[i]);const M=R=>{R.preventDefault();const U=w.trim();if(!U)return;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(U)){D("Please enter a valid email address");return}b.includes(U)||(v([...b,U]),N(""),D(""))},L=R=>{v(b.filter(U=>U!==R))},P=()=>o.trim()?m?f?g?g<=f?"End time must be after start time":b.length===0?"At least one attendee is required":null:"End time is required":"Start time is required":"Meeting date is required":"Meeting title is required",$=async R=>{R.preventDefault();const U=P();if(U){D(U);return}D(""),E(""),_(!0);try{const I=`${m}T${f}:00`,z=`${m}T${g}:00`,F={title:o.trim(),description:d.trim(),start_time:I,end_time:z,attendees:b,location:k.trim(),timezone:T},O=await n(`${l}/api/crm/customers/${e.id}/meetings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(F)});if(O.ok){const K=await O.json();c(""),u(""),p(""),y(""),x(""),v([e.email]),j("Google Meet"),D(""),E(""),t&&await t(K)}else{const J=(await O.json()).detail||"Failed to create meeting";J.includes("No valid Google access token")||J.includes("reconnect")?D(" Please reconnect Google Calendar. Go to Calendar page and sign in again."):D(J)}}catch(I){console.error("Error creating meeting:",I),D(I.message||"Error creating meeting")}finally{_(!1)}};return r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Create New Meeting"}),r.jsxs("form",{onSubmit:$,className:"flex-1 flex flex-col gap-4",children:[A&&r.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-3 py-2 rounded text-sm",children:A}),C&&r.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded text-sm",children:C}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Meeting Title ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx(Ut,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),r.jsx("input",{type:"text",value:o,onChange:R=>c(R.target.value),placeholder:"e.g., Quarterly Business Review",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-pink-500",maxLength:200,disabled:S})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Date ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx(yt,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),r.jsx("input",{type:"date",value:m,onChange:R=>p(R.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-pink-500",disabled:S})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Start Time ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx(jt,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),r.jsx("input",{type:"time",value:f,onChange:R=>y(R.target.value),placeholder:"HH:MM",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-pink-500",disabled:S,title:"Enter time in HH:MM format or use picker"})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["End Time ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx(jt,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),r.jsx("input",{type:"time",value:g,onChange:R=>x(R.target.value),placeholder:"HH:MM",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-pink-500",disabled:S,title:"Enter time in HH:MM format or use picker"})]})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Attendees ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:b.map(R=>r.jsxs("div",{className:"flex items-center gap-1 bg-pink-100 text-pink-800 px-2 py-1 rounded-full text-xs",children:[r.jsx(kt,{className:"h-3 w-3"}),r.jsx("span",{children:R}),r.jsx("button",{type:"button",onClick:()=>L(R),className:"ml-1 hover:text-pink-900",disabled:S,children:""})]},R))}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"email",value:w,onChange:R=>N(R.target.value),placeholder:"Enter email address",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-pink-500",disabled:S,onKeyPress:R=>{R.key==="Enter"&&M(R)}}),r.jsx(H,{type:"button",onClick:M,variant:"outline",size:"sm",disabled:S,children:r.jsx(Wt,{className:"h-3 w-3"})})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Description ",r.jsx("span",{className:"text-gray-400",children:"(Optional)"})]}),r.jsx("textarea",{value:d,onChange:R=>u(R.target.value),placeholder:"Add meeting agenda, notes, or context...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm resize-none focus:outline-none focus:ring-2 focus:ring-pink-500",rows:4,maxLength:2e3,disabled:S}),r.jsxs("div",{className:"text-xs text-gray-400 text-right mt-1",children:[d.length,"/2000"]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Location ",r.jsx("span",{className:"text-gray-400",children:"(Optional)"})]}),r.jsxs("div",{className:"relative",children:[r.jsx(vn,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),r.jsx("input",{type:"text",value:k,onChange:R=>j(R.target.value),placeholder:"Google Meet (auto-generated)",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-pink-500",disabled:S})]})]}),r.jsx("div",{className:"mt-auto pt-4",children:r.jsx(H,{type:"submit",className:"w-full bg-pink-600 hover:bg-pink-700 text-white",disabled:S,children:S?r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"w-4 h-4 mr-2 animate-spin"}),"Creating Meeting..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Wt,{className:"w-4 h-4 mr-2"}),"Create Meeting"]})})})]})]})},ore=({meeting:e,onClose:t,onDelete:n,authFetch:s,googleAccessToken:a})=>{const i="http://localhost:8003",[l,o]=h.useState(!1),[c,d]=h.useState(!1),u=g=>{if(!g)return"";const x=document.createElement("div");x.innerHTML=g;let b=x.textContent||x.innerText||"";return b=b.replace(/\.{10,}/g,""),b=b.replace(/\s+/g," "),b=b.trim(),b},m=()=>{d(!0)},p=async()=>{o(!0);try{const g=await s(`${i}/api/crm/meetings/${e.interaction_id}`,{method:"DELETE"});if(g.ok)n();else{const b=(await g.json()).detail||"Failed to delete meeting";b.includes("No valid Google access token")||b.includes("reconnect")?alert(" Please reconnect Google Calendar. Go to Calendar page and sign in again."):b.includes("permission")||b.includes("ownership")?alert(" You do not have permission to delete this meeting."):alert(` Failed to delete meeting: ${b}`)}}catch(g){console.error("Error deleting meeting:",g),alert(` Error deleting meeting: ${g.message}`)}finally{o(!1)}},f=()=>{if(!e.start_time)return"No date specified";const g=new Date(e.start_time),x=e.end_time?new Date(e.end_time):null,b=g.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),v=g.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),w=x?x.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):"";return`${b}  ${v}${w?` - ${w}`:""}`},y=()=>{e.google_calendar_event_id&&window.open(`https://calendar.google.com/calendar/event?eid=${e.google_calendar_event_id}`,"_blank")};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:t,children:r.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full shadow-xl max-h-[90vh] overflow-y-auto",onClick:g=>g.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-pink-50 to-purple-50",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-pink-100 rounded-lg",children:r.jsx(yt,{className:"h-6 w-6 text-pink-600"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:e.title||"Untitled Meeting"}),r.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:"Meeting Details"})]})]}),r.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",disabled:l,children:r.jsx(Ze,{className:"h-6 w-6"})})]}),r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:r.jsx(jt,{className:"h-5 w-5 text-blue-600"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Date & Time"}),r.jsx("div",{className:"text-base text-gray-900",children:f()})]})]}),e.attendees&&e.attendees.length>0&&r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:r.jsx(kt,{className:"h-5 w-5 text-green-600"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Attendees"}),r.jsx("div",{className:"text-base text-gray-900",children:Array.isArray(e.attendees)?e.attendees.join(", "):e.attendees})]})]}),e.location&&r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:r.jsx(vn,{className:"h-5 w-5 text-purple-600"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Location"}),r.jsx("div",{className:"text-base text-gray-900",children:e.location})]})]}),e.description&&r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"p-2 bg-orange-50 rounded-lg",children:r.jsx(Ut,{className:"h-5 w-5 text-orange-600"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Description"}),r.jsx("div",{className:"text-base text-gray-900 whitespace-pre-wrap",children:u(e.description)})]})]}),e.google_calendar_event_id&&r.jsx("div",{className:"pt-4 border-t border-gray-200",children:r.jsxs("button",{onClick:y,className:"flex items-center gap-2 text-blue-600 hover:text-blue-800 transition-colors",children:[r.jsx(sa,{className:"h-4 w-4"}),r.jsx("span",{className:"text-sm font-medium",children:"View in Google Calendar"})]})}),c&&r.jsxs("div",{className:"flex items-start gap-2 p-4 bg-red-50 border border-red-200 rounded-lg",children:[r.jsx(fr,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm font-medium text-red-900 mb-1",children:"Are you sure?"}),r.jsx("p",{className:"text-sm text-red-700 mb-3",children:"This meeting will be permanently deleted from both your CRM and Google Calendar. This action cannot be undone."}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(H,{variant:"outline",size:"sm",onClick:()=>d(!1),disabled:l,children:"Cancel"}),r.jsx(H,{variant:"destructive",size:"sm",onClick:p,disabled:l,className:"bg-red-600 hover:bg-red-700 text-white",children:l?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"inline-block animate-spin mr-2",children:""}),"Deleting..."]}):"Confirm Delete"})]})]})]})]}),r.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[r.jsxs(H,{variant:"outline",onClick:m,disabled:l||c,className:"text-red-600 border-red-300 hover:bg-red-50",children:[r.jsx(fr,{className:"h-4 w-4 mr-2"}),"Delete Meeting"]}),r.jsx(H,{onClick:t,disabled:l,className:"px-6",children:"Close"})]})]})})},AT=({customer:e,authFetch:t,googleAccessToken:n,onDateSelect:s,onTimeSlotSelect:a,refreshTrigger:i,events:l,setEvents:o})=>{const c="http://localhost:8003",[d,u]=h.useState(new Date),[m,p]=h.useState("month"),[f,y]=h.useState(!1),[g,x]=h.useState(!1),[b,v]=h.useState(null),[w,N]=h.useState(!1),[k,j]=h.useState("google"),S=h.useCallback(async()=>{y(!0);try{const z=await t(`${c}/api/crm/meetings`);if(z.ok){const F=await z.json();if(o(F),F.length>0&&F[0].content)try{const O=typeof F[0].content=="string"?JSON.parse(F[0].content):F[0].content;O.calendar_provider&&j(O.calendar_provider)}catch{}}}catch(z){console.error("Error fetching meetings:",z)}finally{y(!1)}},[t,o,c]);h.useEffect(()=>{S()},[S,i]);const _=async()=>{x(!0);try{const z=await t(`${c}/api/crm/sync-all-google-calendar`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(z.ok){const F=await z.json(),O=k==="google"?"Google Calendar":"Outlook Calendar";alert(` Synced ${F.new_meetings} new meetings from ${O}`),S()}else{const O=(await z.json()).detail||"Unknown error",K=k==="google"?"Google Calendar":"Outlook Calendar";O.includes("No valid")||O.includes("reconnect")||O.includes("No calendar provider")?alert(` Please reconnect ${K}. Go to Calendar page and sign in again.`):alert("Sync failed: "+O)}}catch(z){console.error("Error syncing calendar:",z),alert("Sync failed: "+z.message)}finally{x(!1)}},C=z=>{const F=new Date(d);F.setMonth(d.getMonth()+z),u(F)},D=z=>{const F=new Date(d);F.setDate(d.getDate()+z*7),u(F)},A=z=>{const F=new Date(d);F.setDate(d.getDate()+z),u(F)},E=z=>{m==="month"?C(z):m==="week"?D(z):A(z)},T=()=>{u(new Date)},M=z=>{if(s){const F=z.getFullYear(),O=String(z.getMonth()+1).padStart(2,"0"),K=String(z.getDate()).padStart(2,"0");s(`${F}-${O}-${K}`)}},L=z=>{if(a){const F=`${String(z).padStart(2,"0")}:00`,O=`${String(z+1).padStart(2,"0")}:00`;a({start:F,end:O})}},P=(z,F)=>{F.stopPropagation(),v(z),N(!0)},$=()=>{N(!1),v(null),S()},R=()=>{const z=d.getFullYear(),F=d.getMonth(),O=new Date(z,F,1).getDay(),K=new Date(z,F+1,0).getDate(),J=[];for(let se=0;se<O;se++)J.push(r.jsx("div",{className:"h-24 bg-gray-50 border border-gray-200"},`empty-${se}`));for(let se=1;se<=K;se++){const Z=new Date(z,F,se),oe=Z.toISOString().split("T")[0],W=l.filter(V=>new Date(V.start_time).toISOString().split("T")[0]===oe),B=oe===new Date().toISOString().split("T")[0];J.push(r.jsxs("div",{onClick:()=>M(Z),className:`h-24 border border-gray-200 p-2 cursor-pointer hover:bg-gray-50 transition-colors ${B?"bg-pink-50 border-pink-300":""}`,children:[r.jsx("div",{className:`text-sm font-medium mb-1 ${B?"text-pink-600":"text-gray-700"}`,children:se}),r.jsxs("div",{className:"space-y-1",children:[W.slice(0,3).map(V=>r.jsxs("div",{onClick:re=>P(V,re),className:"text-xs bg-pink-100 text-pink-800 px-1 py-0.5 rounded truncate cursor-pointer hover:bg-pink-200 transition-colors",title:V.title,children:[new Date(V.start_time).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})," ",V.title]},V.interaction_id)),W.length>3&&r.jsxs("div",{className:"text-xs text-gray-500",children:["+",W.length-3," more"]})]})]},se))}return r.jsxs("div",{className:"grid grid-cols-7 gap-0 border border-gray-200 rounded-lg overflow-hidden",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(se=>r.jsx("div",{className:"bg-gray-100 text-center py-2 text-sm font-medium text-gray-700 border-b border-gray-200",children:se},se)),J]})},U=()=>{const z=new Date(d);z.setDate(d.getDate()-d.getDay());const F=[];for(let K=0;K<7;K++){const J=new Date(z);J.setDate(z.getDate()+K),F.push(J)}const O=Array.from({length:24},(K,J)=>J);return r.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[r.jsxs("div",{className:"grid grid-cols-8 border-b border-gray-200",children:[r.jsx("div",{className:"bg-gray-100 p-2 text-xs font-medium text-gray-500",children:"Time"}),F.map((K,J)=>{const se=K.toISOString().split("T")[0]===new Date().toISOString().split("T")[0];return r.jsxs("div",{className:`bg-gray-100 p-2 text-center ${se?"bg-pink-50":""}`,children:[r.jsx("div",{className:`text-xs font-medium ${se?"text-pink-600":"text-gray-700"}`,children:K.toLocaleDateString("en-US",{weekday:"short"})}),r.jsx("div",{className:`text-lg font-bold ${se?"text-pink-600":"text-gray-900"}`,children:K.getDate()})]},J)})]}),r.jsx("div",{className:"max-h-96 overflow-y-auto",children:O.map(K=>r.jsxs("div",{className:"grid grid-cols-8 border-b border-gray-100",children:[r.jsx("div",{className:"p-2 text-xs text-gray-500 bg-gray-50",children:K===0?"12 AM":K<12?`${K} AM`:K===12?"12 PM":`${K-12} PM`}),F.map((J,se)=>{const Z=J.toISOString().split("T")[0],oe=l.filter(W=>{const B=new Date(W.start_time),V=B.toISOString().split("T")[0],re=B.getHours();return V===Z&&re===K});return r.jsx("div",{onClick:()=>{M(J),L(K)},className:"p-1 border-l border-gray-100 min-h-[3rem] cursor-pointer hover:bg-gray-50 transition-colors",children:oe.map(W=>r.jsx("div",{onClick:B=>P(W,B),className:"text-xs bg-pink-100 text-pink-800 px-1 py-0.5 rounded mb-1 truncate cursor-pointer hover:bg-pink-200 transition-colors",title:W.title,children:W.title},W.interaction_id))},se)})]},K))})]})},I=()=>{const z=d.toISOString().split("T")[0],F=Array.from({length:24},(O,K)=>K);return r.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[r.jsxs("div",{className:"bg-gray-100 p-4 border-b border-gray-200",children:[r.jsx("div",{className:"text-sm text-gray-600",children:d.toLocaleDateString("en-US",{weekday:"long"})}),r.jsx("div",{className:"text-2xl font-bold text-gray-900",children:d.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),r.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:F.map(O=>{const K=l.filter(J=>{const se=new Date(J.start_time),Z=se.toISOString().split("T")[0],oe=se.getHours();return Z===z&&oe===O});return r.jsxs("div",{onClick:()=>L(O),className:"flex border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors",children:[r.jsx("div",{className:"w-20 p-3 text-sm text-gray-500 bg-gray-50 border-r border-gray-200",children:O===0?"12 AM":O<12?`${O} AM`:O===12?"12 PM":`${O-12} PM`}),r.jsx("div",{className:"flex-1 p-2 min-h-[3rem]",children:K.map(J=>r.jsxs("div",{onClick:se=>P(J,se),className:"bg-pink-100 text-pink-800 px-3 py-2 rounded mb-2 cursor-pointer hover:bg-pink-200 transition-colors",children:[r.jsx("div",{className:"font-medium text-sm",children:J.title}),r.jsxs("div",{className:"text-xs mt-1",children:[new Date(J.start_time).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})," - ",new Date(J.end_time).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})]}),J.attendees&&J.attendees.length>0&&r.jsx("div",{className:"text-xs mt-1 text-pink-700",children:J.attendees.join(", ")})]},J.interaction_id))})]},O)})})]})};return r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(yt,{className:"h-5 w-5 text-gray-700"}),r.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[m==="month"&&d.toLocaleDateString("en-US",{month:"long",year:"numeric"}),m==="week"&&`Week of ${d.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`,m==="day"&&d.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[r.jsx("button",{onClick:()=>p("month"),className:`px-3 py-1 text-xs rounded transition-colors ${m==="month"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Month"}),r.jsx("button",{onClick:()=>p("week"),className:`px-3 py-1 text-xs rounded transition-colors ${m==="week"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Week"}),r.jsx("button",{onClick:()=>p("day"),className:`px-3 py-1 text-xs rounded transition-colors ${m==="day"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Day"})]}),r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>E(-1),className:"p-1",children:r.jsx(di,{className:"h-4 w-4"})}),r.jsx(H,{variant:"ghost",size:"sm",onClick:T,className:"px-2 text-xs",children:"Today"}),r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>E(1),className:"p-1",children:r.jsx(Ta,{className:"h-4 w-4"})}),r.jsxs(H,{variant:"outline",size:"sm",onClick:_,disabled:g,className:"text-xs",children:[r.jsx(Be,{className:`h-3 w-3 mr-1 ${g?"animate-spin":""}`}),"Sync"]})]})]}),r.jsx("div",{className:"flex-1 overflow-auto",children:f?r.jsx("div",{className:"flex items-center justify-center h-full",children:r.jsx(Be,{className:"h-6 w-6 animate-spin text-gray-400"})}):r.jsxs(r.Fragment,{children:[m==="month"&&R(),m==="week"&&U(),m==="day"&&I()]})}),r.jsxs("div",{className:"mt-4 flex items-center gap-4 text-xs text-gray-600",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-3 h-3 bg-pink-100 rounded"}),r.jsx("span",{children:"Customer Meetings"})]}),r.jsx("div",{className:"text-gray-500",children:"Click on a date or time slot to auto-fill the form  Click on a meeting to view details"})]}),w&&b&&r.jsx(ore,{meeting:b,onClose:()=>{N(!1),v(null)},onDelete:$,authFetch:t,googleAccessToken:n})]})},cre=({customer:e,onMeetingCreated:t,authFetch:n})=>{const[s,a]=h.useState(null),[i,l]=h.useState(null),[o,c]=h.useState(null),[d,u]=h.useState([]),[m,p]=h.useState(0);h.useEffect(()=>{const x=localStorage.getItem("google_calendar_access_token")||localStorage.getItem("google_access_token");a(x)},[]);const f=async x=>{p(b=>b+1),t&&await t(x)},y=x=>{l(x)},g=x=>{c(x)};return r.jsxs("div",{className:"flex h-full gap-4 bg-gray-50",children:[r.jsx("div",{className:"w-[30%] bg-white rounded-lg border border-gray-200 p-6 overflow-y-auto",children:r.jsx(lre,{customer:e,onMeetingCreated:f,authFetch:n,googleAccessToken:s,selectedDate:i,selectedTimeSlot:o})}),r.jsx("div",{className:"w-[70%] bg-white rounded-lg border border-gray-200 p-6 overflow-y-auto",children:r.jsx(AT,{customer:e,authFetch:n,googleAccessToken:s,onDateSelect:y,onTimeSlotSelect:g,refreshTrigger:m,events:d,setEvents:u})})]})},dre=({isOpen:e,onClose:t,customer:n,onNoteAdded:s,onInteractionAdded:a,authFetch:i,initialActivityType:l="note"})=>{const m="http://localhost:8003",[p,f]=h.useState(l),[y,g]=h.useState(""),[x,b]=h.useState(""),[v,w]=h.useState(!1),[N,k]=h.useState(!1),[j,S]=h.useState(""),[_,C]=h.useState(""),[D,A]=h.useState(""),[E,T]=h.useState("");h.useEffect(()=>{e?f(l):(g(""),b(""),w(!1),A(""),T(""),S(""),C(""))},[e,l]),h.useEffect(()=>{if(j||_){const U=setTimeout(()=>{S(""),C("")},3e3);return()=>clearTimeout(U)}},[j,_]),h.useEffect(()=>{const U=I=>{I.key==="Escape"&&!N&&t()};return e&&document.addEventListener("keydown",U),()=>{document.removeEventListener("keydown",U)}},[e,N,t]);const M=()=>{const U=x.trim(),I=y.trim();return U.length===0?"Note content cannot be empty":U.length>2e3?"Note cannot exceed 2000 characters":I.length>200?"Title cannot exceed 200 characters":null},L=()=>{const U=D.trim(),I=E.trim();return U.length===0?"Call summary cannot be empty":U.length>5e3?"Call summary cannot exceed 5000 characters":I.length>50?"Theme cannot exceed 50 characters":null},P=async()=>{if(!(n!=null&&n.id))return;const U=M();if(U){S(U);return}S(""),C(""),k(!0);const I={title:y.trim()||"",body:x.trim(),star:v?"important":null,interaction_id:null};try{const z=await i(`${m}/api/crm/customers/${n.id}/notes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)});if(z.ok)C("Note added successfully!"),s&&s().catch(F=>{console.error("Error refreshing notes after creation:",F)}),setTimeout(()=>{t()},500);else{const F=await z.json();S("Failed to add note: "+(F.detail||"Unknown error"))}}catch(z){console.error("Error adding note:",z),S("Error adding note: "+z.message)}finally{k(!1)}},$=async()=>{if(!(n!=null&&n.id))return;const U=L();if(U){S(U);return}S(""),C(""),k(!0);const I={content:D.trim(),theme:E.trim()||null,source:"manual",duration_minutes:null};try{const z=await i(`${m}/api/crm/customers/${n.id}/call-summaries`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)});if(z.ok)C("Call summary added successfully!"),a&&a().catch(F=>{console.error("Error refreshing interactions after call summary creation:",F)}),setTimeout(()=>{t()},500);else{const F=await z.json();S("Failed to add call summary: "+(F.detail||"Unknown error"))}}catch(z){console.error("Error adding call summary:",z),S("Error adding call summary: "+z.message)}finally{k(!1)}},R=[{key:"note",label:"Add Note",icon:Ut},{key:"meeting",label:"Schedule Meeting",icon:yt},{key:"callSummary",label:"Add Call Summary",icon:si}];return e?r.jsx(ht,{children:e&&r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex justify-center pt-8 px-8",onClick:t,children:r.jsxs(de.div,{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},className:"w-full bg-white rounded-lg shadow-2xl relative h-full flex flex-col",onClick:U=>U.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between pt-5 pb-3 px-6 border-b border-gray-200 flex-shrink-0",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Add Activity"}),r.jsx(H,{variant:"ghost",size:"icon",onClick:t,disabled:N,children:r.jsx(Ze,{className:"w-5 h-5 text-gray-500"})})]}),r.jsx("div",{className:"border-b border-gray-200 flex-shrink-0 px-6",children:r.jsx("div",{className:"flex gap-2",children:R.map(({key:U,label:I,icon:z})=>r.jsxs("button",{onClick:()=>f(U),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors ${p===U?"border-pink-600 text-pink-600":"border-transparent text-gray-500 hover:text-gray-700"}`,disabled:N,children:[r.jsx(z,{className:"w-4 h-4"}),I]},U))})}),r.jsxs("div",{className:"flex-1 overflow-y-auto py-6 px-6 bg-gray-50",children:[_&&r.jsx("div",{className:"mb-4 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg text-sm",children:_}),j&&r.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:j}),p==="note"&&r.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Note Title ",r.jsx("span",{className:"text-gray-400",children:"(Optional)"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:"text",value:y,onChange:U=>g(U.target.value),placeholder:"Enter note title...",className:"w-full px-4 py-3 pr-20 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm",maxLength:200,disabled:N}),r.jsxs("div",{className:"absolute bottom-3 right-3 text-xs text-gray-400",children:[y.length,"/",200]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Note Content ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("textarea",{value:x,onChange:U=>b(U.target.value),placeholder:"Add your note...",className:"w-full h-48 px-4 py-3 pr-20 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm",maxLength:2e3,disabled:N}),r.jsxs("div",{className:"absolute bottom-3 right-3 text-xs text-gray-400",children:[x.length,"/",2e3]})]})]}),r.jsx("div",{className:"flex items-center gap-3",children:r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:v,onChange:U=>w(U.target.checked),disabled:N,className:"sr-only"}),r.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-full text-sm transition-colors ${v?"bg-yellow-100 text-yellow-800 border border-yellow-300":"bg-gray-100 text-gray-600 border border-gray-300 hover:bg-gray-200"}`,children:[r.jsx(on,{className:`w-4 h-4 ${v?"fill-yellow-400 text-yellow-400":""}`}),v?"Important":"Mark as Important"]})]})})]})}),p==="meeting"&&r.jsx(cre,{customer:n,onMeetingCreated:async U=>{C(" Meeting created and synced to Google Calendar!"),a&&a().catch(I=>{console.error("Error refreshing interactions after meeting creation:",I)}),setTimeout(()=>{t()},500)},authFetch:i}),p==="callSummary"&&r.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Call Theme ",r.jsx("span",{className:"text-gray-400",children:"(Optional)"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:"text",value:E,onChange:U=>T(U.target.value),placeholder:"e.g., Product Demo, Follow-up, Support...",className:"w-full px-4 py-3 pr-20 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm",maxLength:50,disabled:N}),r.jsxs("div",{className:"absolute bottom-3 right-3 text-xs text-gray-400",children:[E.length,"/",50]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Call Summary ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("textarea",{value:D,onChange:U=>A(U.target.value),placeholder:"Summarize the key discussion points, outcomes, and any follow-up actions...",className:"w-full h-48 px-4 py-3 pr-20 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm",maxLength:5e3,disabled:N}),r.jsxs("div",{className:"absolute bottom-3 right-3 text-xs text-gray-400",children:[D.length,"/",5e3]})]})]})]})})]}),r.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t border-gray-200 bg-gray-50 flex-shrink-0",children:[r.jsx(H,{variant:"outline",onClick:t,disabled:N,children:"Cancel"}),p==="note"&&r.jsx(H,{className:"bg-pink-600 hover:bg-pink-700 text-white disabled:bg-gray-400",onClick:P,disabled:!x.trim()||N,children:N?r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"w-4 h-4 mr-2 animate-spin"}),"Adding Note..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Wt,{className:"w-4 h-4 mr-2"}),"Add Note"]})}),p==="callSummary"&&r.jsx(H,{className:"bg-pink-600 hover:bg-pink-700 text-white disabled:bg-gray-400",onClick:$,disabled:!D.trim()||N,children:N?r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"w-4 h-4 mr-2 animate-spin"}),"Adding Call Summary..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Wt,{className:"w-4 h-4 mr-2"}),"Add Call Summary"]})})]})]})})}):null},Vm=({isOpen:e,onClose:t,onCancel:n,onConfirm:s,title:a="Confirm Deletion",itemName:i,customer:l,itemType:o="item",warningMessage:c,relatedItems:d=[],isDeleting:u=!1,deleteButtonText:m="Delete"})=>{const p=t||n,f=i||(l==null?void 0:l.company);if(h.useEffect(()=>{const g=x=>{x.key==="Escape"&&e&&!u&&(p==null||p())};return e&&(document.addEventListener("keydown",g),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",g),document.body.style.overflow="unset"}},[e,u,p]),!e)return null;const y=g=>{g.target===g.currentTarget&&!u&&(p==null||p())};return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm animate-in fade-in duration-200",onClick:y,role:"dialog","aria-modal":"true","aria-labelledby":"delete-modal-title",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-md w-full mx-4 animate-in zoom-in-95 duration-200",children:[r.jsxs("div",{className:"flex items-start justify-between p-6 border-b border-gray-200",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-red-100 flex items-center justify-center",children:r.jsx(Cr,{className:"w-5 h-5 text-red-600"})}),r.jsx("h2",{id:"delete-modal-title",className:"text-xl font-semibold text-gray-900",children:a})]}),!u&&r.jsx("button",{type:"button",onClick:p,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close modal",children:r.jsx(Ze,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-6 space-y-5",children:[r.jsxs("div",{className:"space-y-3",children:[f?r.jsx("div",{children:r.jsxs("p",{className:"text-base text-gray-700 leading-relaxed",children:["Are you sure you want to delete"," ",r.jsx("span",{className:"font-semibold text-gray-900 px-1.5 py-0.5 bg-red-50 rounded",children:f}),"?"]})}):r.jsxs("p",{className:"text-base text-gray-700 leading-relaxed",children:["Are you sure you want to delete this ",o,"?"]}),c?r.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:c}):r.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:"This action cannot be undone. All associated data will be permanently deleted."})]}),d&&d.length>0&&r.jsx("div",{className:"bg-amber-50 border-l-4 border-amber-400 p-4 rounded-r",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx(Cr,{className:"h-5 w-5 text-amber-600"})}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-amber-800 mb-2",children:"The following related items will also be affected:"}),r.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-amber-700",children:d.map((g,x)=>r.jsx("li",{children:g},x))})]})]})})]}),r.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 bg-gray-50",children:[r.jsx("button",{type:"button",onClick:p,disabled:u,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Cancel"}),r.jsx("button",{type:"button",onClick:s,disabled:u,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2 min-w-[100px] justify-center",children:u?r.jsxs(r.Fragment,{children:[r.jsx(Ct,{className:"w-4 h-4 animate-spin"}),r.jsx("span",{children:"Deleting..."})]}):r.jsx("span",{children:m})})]})]})})},ure=({customer:e,customerInteractions:t,loadingInteractions:n,timelineFilter:s,setTimelineFilter:a,timelineSearch:i,setTimelineSearch:l,isTimelineExpanded:o,handleTimelineToggle:c,expandedPanel:d,setExpandedPanel:u,handleEventClick:m,getTimelineEvents:p,authFetch:f,onNoteAdded:y,onInteractionAdded:g,notes:x,isLoadingNotes:b,isRefreshingNotes:v,handleDeleteNote:w,handleToggleNoteStar:N,isDeletingNote:k,onCallDeleted:j})=>{const[S,_]=h.useState(!1),[C,D]=h.useState(!1),[A,E]=h.useState("note"),[T,M]=h.useState(!1),L=h.useRef(null),P=h.useRef(null),[$,R]=h.useState(!1),[U,I]=h.useState(null),[z,F]=h.useState(!1);h.useEffect(()=>{const G=q=>{L.current&&!L.current.contains(q.target)&&_(!1)};return S&&document.addEventListener("mousedown",G),()=>{document.removeEventListener("mousedown",G)}},[S]),h.useEffect(()=>{const G=q=>{P.current&&!P.current.contains(q.target)&&M(!1)};return T&&document.addEventListener("mousedown",G),()=>{document.removeEventListener("mousedown",G)}},[T]);const O=G=>{E(G),_(!1),D(!0)},K=async()=>{if(U){F(!0);try{U.type==="note"?await w(U.id):U.type==="call"&&(await f(`http://localhost:8003/api/crm/customers/${e.id}/call-summaries/${U.id}`,{method:"DELETE"})).ok&&j&&await j(U.id),R(!1),I(null)}catch(G){console.error("Error deleting:",G)}finally{F(!1)}}},J=()=>["email","call","meeting"].includes(s),se=G=>{if(!G)return"N/A";const q=new Date(G);return isNaN(q.getTime())?"Invalid Date":new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}).format(q)},Z=G=>{switch(G){case"important":return"Important";case"urgent":return"Urgent";case"starred":return"Starred";default:return""}},oe=(G,q)=>{if(G.originalType==="meeting"||G.originalType==="call")return null;const Q=new Date,ue=Math.floor((Q-q)/(1e3*60*60*24));return G.originalType==="email"&&ue>2?{text:"Awaiting Reply",color:"bg-yellow-100 text-yellow-800"}:q>Q?{text:"Scheduled",color:"bg-blue-100 text-blue-800"}:ue<=1?{text:"Recent",color:"bg-green-100 text-green-800"}:null},W=G=>{switch(G){case"email":return{icon:Dt,bgColor:"bg-blue-100",textColor:"text-blue-600",borderColor:"border-blue-200"};case"call":return{icon:si,bgColor:"bg-green-100",textColor:"text-green-600",borderColor:"border-green-200"};case"meeting":return{icon:yt,bgColor:"bg-purple-100",textColor:"text-purple-600",borderColor:"border-purple-200"};case"note":return{icon:Ut,bgColor:"bg-yellow-100",textColor:"text-yellow-600",borderColor:"border-yellow-200"};default:return{icon:Bn,bgColor:"bg-gray-100",textColor:"text-gray-600",borderColor:"border-gray-200"}}},V=(()=>{const G=p(),q=(x||[]).map(ue=>({type:"note",originalType:"note",title:ue.title||"Note",description:ue.body||ue.content,date:ue.date,employeeName:"You",metadata:{noteId:ue.id,isStarred:ue.isStarred,star:ue.star,interaction_id:ue.interaction_id}}));return[...G,...q].sort((ue,Le)=>new Date(Le.date)-new Date(ue.date))})(),re=s==="all"?V:s==="note"?V.filter(G=>G.originalType==="note"):V.filter(G=>G.originalType===s),Me=3,he=o?re:re.slice(0,Me);return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:`bg-white rounded-lg border border-gray-200 flex flex-col transition-all duration-300 ${d==="activity"?"h-[calc(1000px+1rem-60px-1rem)] p-6":d==="summary"?"h-[60px] overflow-visible px-6 py-3":"h-[500px] p-6"}`,children:[r.jsxs("div",{className:`flex items-center justify-between flex-shrink-0 ${d==="summary"?"mb-0":"mb-4"}`,children:[r.jsxs("h3",{className:"text-lg font-bold text-black font-[Inter] flex items-center gap-2",children:[r.jsx(Ot,{className:"w-5 h-5 text-pink-600"}),"Activity & Notes",(n||b||v)&&r.jsx(Be,{className:"w-4 h-4 animate-spin"})]}),r.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[r.jsxs("div",{className:"relative",ref:L,children:[r.jsxs("button",{onClick:()=>_(!S),className:"flex items-center gap-2 px-4 py-2 bg-pink-600 hover:bg-pink-700 text-white rounded-lg text-sm font-medium transition-colors whitespace-nowrap",children:[r.jsx(Wt,{className:"w-4 h-4"}),"Add Activity",r.jsx(Xt,{className:"w-4 h-4"})]}),S&&r.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[r.jsxs("button",{onClick:()=>O("meeting"),className:"w-full flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors",children:[r.jsx(yt,{className:"w-4 h-4 text-purple-600"}),"Schedule Meeting"]}),r.jsxs("button",{onClick:()=>O("note"),className:"w-full flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors",children:[r.jsx(Ut,{className:"w-4 h-4 text-blue-600"}),"Add Note"]}),r.jsxs("button",{onClick:()=>O("callSummary"),className:"w-full flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors",children:[r.jsx(si,{className:"w-4 h-4 text-green-600"}),"Add Call Summary"]})]})]}),r.jsx("button",{onClick:()=>u(d==="activity"?null:"activity"),className:"text-gray-500 hover:text-gray-700 transition-colors p-1 hover:bg-gray-100 rounded flex-shrink-0",title:d==="activity"?"Collapse":"Expand",children:d==="activity"?r.jsx(La,{className:"w-5 h-5"}):r.jsx(Xt,{className:"w-5 h-5"})})]})]}),d!=="summary"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6 flex-shrink-0",children:[r.jsxs("div",{className:"flex gap-2 items-center",children:[r.jsxs("button",{onClick:()=>a("all"),className:`h-7 px-3 py-1.5 text-xs font-medium rounded-full flex items-center gap-1.5 transition-colors ${s==="all"?"bg-pink-100 text-pink-700 border border-pink-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[r.jsx(da,{className:"w-3 h-3"}),"All"]}),r.jsxs("div",{className:"relative",ref:P,children:[r.jsxs("button",{onClick:()=>M(!T),className:`h-7 px-3 py-1.5 text-xs font-medium rounded-full flex items-center gap-1.5 transition-colors ${J()?"bg-pink-100 text-pink-700 border border-pink-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[r.jsx(Bn,{className:"w-3 h-3"}),"Communication",r.jsx(Xt,{className:"w-3 h-3"})]}),T&&r.jsxs("div",{className:"absolute top-full left-0 mt-1 w-40 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50",children:[r.jsxs("button",{onClick:()=>{a("email"),M(!1)},className:`w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-50 transition-colors ${s==="email"?"bg-blue-50 text-blue-700":"text-gray-700"}`,children:[r.jsx(Dt,{className:"w-4 h-4 text-blue-600"}),"Email"]}),r.jsxs("button",{onClick:()=>{a("call"),M(!1)},className:`w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-50 transition-colors ${s==="call"?"bg-green-50 text-green-700":"text-gray-700"}`,children:[r.jsx(si,{className:"w-4 h-4 text-green-600"}),"Call"]}),r.jsxs("button",{onClick:()=>{a("meeting"),M(!1)},className:`w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-50 transition-colors ${s==="meeting"?"bg-purple-50 text-purple-700":"text-gray-700"}`,children:[r.jsx(yt,{className:"w-4 h-4 text-purple-600"}),"Meeting"]})]})]}),r.jsxs("button",{onClick:()=>a("note"),className:`h-7 px-3 py-1.5 text-xs font-medium rounded-full flex items-center gap-1.5 transition-colors ${s==="note"?"bg-pink-100 text-pink-700 border border-pink-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[r.jsx(Ut,{className:"w-3 h-3"}),"Notes"]})]}),r.jsxs("div",{className:"relative flex-1 max-w-xs",children:[r.jsx(zn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search timeline...",value:i,onChange:G=>l(G.target.value),className:"w-full pl-10 pr-4 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent"})]})]}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:r.jsxs("div",{className:"space-y-4 p-6",children:[re.length>0?r.jsx(ht,{mode:"wait",children:he.map((G,q)=>{var ce,ke,Pe,qe;const Q=new Date(G.date),ue=oe(G,Q),Le=W(G.originalType),ge=Le.icon,Se=G.originalType==="note";return r.jsxs(de.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:`bg-white border rounded-lg p-4 transition-all group relative ${Se&&(ce=G.metadata)!=null&&ce.isStarred?"border-yellow-200 bg-yellow-50 hover:shadow-md":"border-gray-200 hover:shadow-md"}`,children:[(Se||G.originalType==="call")&&r.jsx("button",{onClick:ne=>{var ye,Ee;if(ne.stopPropagation(),Se)I({type:"note",id:(ye=G.metadata)==null?void 0:ye.noteId}),R(!0);else if(G.originalType==="call"){const st=(Ee=G.metadata)==null?void 0:Ee.interactionId;st&&(I({type:"call",id:st}),R(!0))}},disabled:k===((ke=G.metadata)==null?void 0:ke.noteId),className:"absolute top-2 right-2 p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors opacity-0 group-hover:opacity-100",title:"Delete",children:k===((Pe=G.metadata)==null?void 0:Pe.noteId)?r.jsx(Be,{className:"w-4 h-4 animate-spin"}):r.jsx(fr,{className:"w-4 h-4"})}),r.jsxs("div",{className:"flex gap-4",onClick:()=>m(G),children:[r.jsx("div",{className:`flex-shrink-0 w-10 h-10 ${Le.bgColor} rounded-lg flex items-center justify-center`,children:r.jsx(ge,{className:`w-5 h-5 ${Le.textColor}`})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-900 group-hover:text-pink-600 transition-colors",children:G.title}),Se&&((qe=G.metadata)==null?void 0:qe.isStarred)&&r.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 bg-yellow-100 text-yellow-800 rounded-full text-xs flex-shrink-0",children:[r.jsx(on,{className:"w-2.5 h-2.5 fill-yellow-400 text-yellow-400"}),Z(G.metadata.star)]})]}),!Se&&ue&&r.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full flex-shrink-0 ${ue.color}`,children:ue.text})]}),r.jsx("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:G.description}),r.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(_t,{className:"w-3 h-3"}),G.employeeName]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(jt,{className:"w-3 h-3"}),se(G.date)]})]})]})]})]},`${G.type||"event"}-${G.date||q}-${G.id||q}`)})}):r.jsxs("div",{className:"text-center py-12",children:[r.jsx(Bn,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),r.jsx("p",{className:"text-gray-500 font-medium mb-1",children:s!=="all"?`No ${s==="note"?"note":s} activities found`:"No activities yet"}),r.jsx("p",{className:"text-sm text-gray-400",children:i?"Try adjusting your search terms":"Customer interactions will appear here"})]}),re.length>Me&&r.jsx("button",{onClick:c,className:"w-full py-2 text-sm text-pink-600 hover:text-pink-700 font-medium transition-colors",children:o?"Show Less":`Show ${re.length-Me} More`})]})})]})]}),r.jsx(dre,{isOpen:C,onClose:()=>D(!1),customer:e,onNoteAdded:y,onInteractionAdded:g,authFetch:f,initialActivityType:A}),r.jsx(Vm,{isOpen:$,onClose:()=>{R(!1),I(null)},onConfirm:K,title:"Confirm Deletion",itemName:(U==null?void 0:U.type)==="note"?"this note":"this call summary",itemType:(U==null?void 0:U.type)||"item",isDeleting:z,deleteButtonText:"Delete"})]})},PT=({note:e,customer:t,isOpen:n,onClose:s,onDelete:a,onUpdate:i,onToggleStar:l,isDeletingNote:o,authFetch:c})=>{const d="http://localhost:8003",[u,m]=h.useState(!1),[p,f]=h.useState(""),[y,g]=h.useState(""),[x,b]=h.useState(!1),[v,w]=h.useState(""),N=200,k=2e3;if(h.useEffect(()=>{e&&n&&(f(e.title||""),g(e.body||e.content||""),m(!1),w(""))},[e,n]),h.useEffect(()=>{const $=R=>{R.key==="Escape"&&(u?P():s())};return n&&(document.addEventListener("keydown",$),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",$),document.body.style.overflow="unset"}},[n,u,s]),!n||!e)return null;if(!e.id)return console.error("Note object missing required id field:",e),null;const j=$=>{if(!$)return{date:"N/A",time:"N/A"};const R=new Date($);return isNaN(R.getTime())?{date:"Invalid Date",time:""}:{date:R.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),time:R.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}},S=$=>$==="important"||$==="urgent"||$==="starred",_=$=>{switch($){case"important":return"Important";case"urgent":return"Urgent";case"starred":return"Starred";default:return""}},C=j(e.date),D=e.updated_at?j(e.updated_at):null,A=e.author||"You",E=e.title||"Note",T=e.body||e.content||"",M=e.star||null,L=async()=>{if(!y.trim()){w("Note content cannot be empty");return}if(y.length>k){w(`Note cannot exceed ${k} characters`);return}if(p.length>N){w(`Title cannot exceed ${N} characters`);return}b(!0),w("");try{const $=await c(`${d}/api/crm/notes/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:p.trim()||null,body:y.trim()})});if($.ok){const R=await $.json();i&&await i(R),m(!1)}else{const R=await $.json();w("Failed to update note: "+(R.detail||"Unknown error"))}}catch($){console.error("Error updating note:",$),w("Error updating note: "+$.message)}finally{b(!1)}},P=()=>{f(e.title||""),g(e.body||e.content||""),m(!1),w("")};return r.jsx(ht,{children:n&&r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:u?void 0:s,children:r.jsxs(de.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:$=>$.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[r.jsx("div",{className:"w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center flex-shrink-0",children:r.jsx(Ut,{className:"w-6 h-6 text-yellow-600"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900 truncate",children:E}),S(M)&&r.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 bg-yellow-100 text-yellow-800 rounded-full text-xs flex-shrink-0",children:[r.jsx(on,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"}),_(M)]})]}),r.jsx("p",{className:"text-sm text-gray-500",children:"Customer Note"})]})]}),r.jsx(H,{variant:"ghost",size:"icon",onClick:s,disabled:x,className:"text-gray-400 hover:text-gray-600 flex-shrink-0",children:r.jsx(Ze,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-6 space-y-6",children:[v&&r.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:v}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(yt,{className:"w-5 h-5 text-gray-400"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:C.date}),r.jsx("p",{className:"text-xs text-gray-500",children:"Created"})]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(jt,{className:"w-5 h-5 text-gray-400"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:C.time}),r.jsx("p",{className:"text-xs text-gray-500",children:"Time"})]})]})]}),D&&e.updated_at&&new Date(e.updated_at).getTime()!==new Date(e.date).getTime()&&r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:r.jsxs("p",{className:"text-xs text-blue-700",children:["Last updated: ",D.date," at ",D.time]})}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(_t,{className:"w-5 h-5 text-gray-400"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:A}),r.jsx("p",{className:"text-xs text-gray-500",children:"Author"})]})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[r.jsx(Ut,{className:"w-5 h-5 text-gray-600"}),"Note Content"]}),!u&&r.jsxs(H,{variant:"outline",size:"sm",onClick:()=>m(!0),className:"flex items-center gap-2",children:[r.jsx(nl,{className:"w-4 h-4"}),"Edit"]})]}),u?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Title ",r.jsx("span",{className:"text-gray-400",children:"(Optional)"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:"text",value:p,onChange:$=>f($.target.value),placeholder:"Note title...",className:"w-full px-3 py-2 pr-20 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm",maxLength:N,disabled:x}),r.jsxs("div",{className:"absolute bottom-2 right-3 text-xs text-gray-400",children:[p.length,"/",N]})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Content ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("textarea",{value:y,onChange:$=>g($.target.value),placeholder:"Note content...",className:"w-full h-48 px-3 py-2 pr-20 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm",maxLength:k,disabled:x}),r.jsxs("div",{className:"absolute bottom-3 right-3 text-xs text-gray-400",children:[y.length,"/",k]})]})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(H,{onClick:L,disabled:!y.trim()||x,className:"flex items-center gap-2 bg-pink-600 hover:bg-pink-700 text-white",children:x?r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):r.jsxs(r.Fragment,{children:[r.jsx($n,{className:"w-4 h-4"}),"Save Changes"]})}),r.jsxs(H,{variant:"outline",onClick:P,disabled:x,className:"flex items-center gap-2",children:[r.jsx(Ql,{className:"w-4 h-4"}),"Cancel"]})]})]}):r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[E!=="Note"&&r.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:E}),r.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap leading-relaxed",children:T||"No content available"})]})]})]}),r.jsxs("div",{className:"flex justify-between items-center gap-3 p-6 border-t border-gray-200",children:[r.jsx("div",{className:"flex gap-2",children:r.jsxs(H,{variant:"outline",onClick:()=>l&&l(e.id,M),disabled:u||x,className:`flex items-center gap-2 ${S(M)?"border-yellow-300 bg-yellow-50 hover:bg-yellow-100 text-yellow-700":"hover:bg-gray-50"}`,children:[r.jsx(on,{className:`w-4 h-4 ${S(M)?"fill-yellow-400 text-yellow-400":""}`}),S(M)?"Remove Star":"Mark Important"]})}),r.jsx(H,{variant:"outline",onClick:s,disabled:x,children:"Close"})]})]})})})},OT=({customer:e,onClose:t,onEmailSent:n,embedded:s=!1,dealId:a=null})=>{const{authFetch:i}=Qr(),l="http://localhost:8003",[o,c]=h.useState({emailType:null,message:"",generatedEmail:null,editedTo:"",editedSubject:"",editedBody:""}),[d,u]=h.useState(!1),m=x=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x),p=async()=>{var x,b,v,w;u(!0);try{const N=await i(`${l}/api/crm/generate-email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer_id:e.id,email_type:o.emailType,custom_prompt:o.message})});if(N.ok){const k=await N.json();c({...o,generatedEmail:{subject:((x=k.email_data)==null?void 0:x.subject)||`Follow up regarding ${e.company}`,body:((b=k.email_data)==null?void 0:b.body)||`Hi ${e.primaryContact||"there"},

I hope this email finds you well.

Best regards,
[Your Name]`,to:e.email},editedTo:e.email,editedSubject:((v=k.email_data)==null?void 0:v.subject)||`Follow up regarding ${e.company}`,editedBody:((w=k.email_data)==null?void 0:w.body)||`Hi ${e.primaryContact||"there"},

I hope this email finds you well.

Best regards,
[Your Name]`})}else{const k=await N.json();throw new Error(k.detail||"Failed to generate email")}}catch(N){console.error("Email generation error:",N),alert("Failed to generate email: "+N.message)}finally{u(!1)}},f=async()=>{if(!o.generatedEmail){alert("Please generate an email first");return}if(!m(o.editedTo)){alert("Please enter a valid email address");return}if(!o.editedSubject.trim()){alert("Please enter a subject line");return}if(!o.editedBody.trim()){alert("Please enter an email message");return}u(!0);try{console.log("Sending email from CustomerEmailComposer...");const x=localStorage.getItem("auth_provider"),b=x==="google"?localStorage.getItem("google_access_token"):null,v={to_email:o.editedTo,subject:o.editedSubject,body:o.editedBody,customer_id:e.id,...a&&{deal_id:a},provider:x==="google"?"gmail":null,access_token:b};console.log("Sending email with data:",v);const w=await i(`${l}/api/crm/send-email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)}),N=await w.json();console.log("Send email response:",N),w.ok?(alert(`Email sent successfully to ${N.sent_to}`),n&&n(N),t()):alert(`Failed to send email: ${N.detail||"Unknown error"}`)}catch(x){console.error("Error sending email:",x),alert(`Failed to send email: ${x.message}`)}finally{u(!1)}},y=()=>{const x=`Subject: ${o.editedSubject}

${o.editedBody}`;navigator.clipboard.writeText(x),alert("Copied to clipboard!")},g=r.jsx("div",{className:s?"h-full flex flex-col":"",children:r.jsxs("div",{className:"flex flex-col lg:flex-row flex-1 h-full",children:[r.jsx("div",{className:"lg:w-1/3 p-6 border-r border-gray-200 overflow-y-auto bg-gray-50",children:r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Email Purpose (Optional)"}),r.jsxs("div",{className:"space-y-3",children:[[{id:"follow_up",name:"Follow Up",description:"Follow up on previous contact or conversation",icon:Kr},{id:"meeting_request",name:"Meeting Request",description:"Request a meeting or schedule a demo",icon:yt}].map(x=>{const b=x.icon;return r.jsx("button",{onClick:()=>c({...o,emailType:x.id}),className:`w-full text-left p-4 rounded-lg border-2 transition-all ${o.emailType===x.id?"border-pink-600 bg-pink-50 shadow-sm":"border-gray-200 hover:border-gray-300 bg-white"}`,children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:`p-2 rounded-lg ${o.emailType===x.id?"bg-pink-100":"bg-gray-100"}`,children:r.jsx(b,{className:`w-5 h-5 ${o.emailType===x.id?"text-pink-600":"text-gray-600"}`})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:`font-medium mb-1 ${o.emailType===x.id?"text-pink-700":"text-gray-900"}`,children:x.name}),r.jsx("div",{className:"text-xs text-gray-500",children:x.description})]})]})},x.id)}),r.jsx("button",{onClick:()=>c({...o,emailType:null}),className:`w-full text-left p-4 rounded-lg border-2 transition-all ${o.emailType===null?"border-pink-600 bg-pink-50":"border-gray-200 hover:border-gray-300"}`,children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"p-2 rounded-lg bg-pink-100",children:r.jsx(nl,{className:"w-5 h-5 text-pink-600"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium mb-1",children:"Custom Only"}),r.jsx("div",{className:"text-xs text-gray-500",children:"Generate based purely on your context"})]})]})})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Context"}),r.jsx("textarea",{value:o.message,onChange:x=>c({...o,message:x.target.value}),placeholder:"Add specific details, topics to discuss, or any context for the AI to include...",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 resize-none bg-white",rows:5}),r.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"This context will help generate a more personalized email"})]}),r.jsx("button",{onClick:p,disabled:d||!e.email&&!e.primaryContact||o.emailType===null&&!o.message.trim(),className:"w-full bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 disabled:from-gray-400 disabled:to-gray-500 text-white py-3 rounded-lg transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2 font-medium",children:d?r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"w-5 h-5 animate-spin"}),"Generating Email..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Mr,{className:"w-5 h-5"}),"Generate with AI"]})}),!e.email&&!e.primaryContact&&r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:r.jsxs("p",{className:"text-sm text-red-700 flex items-center gap-2",children:[r.jsx(dt,{className:"w-4 h-4"}),"No email address found for this customer"]})})]})}),r.jsxs("div",{className:"lg:w-2/3 flex flex-col flex-1",children:[r.jsx("div",{className:"p-6 flex-1 overflow-y-auto h-full",children:o.generatedEmail?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Email Draft"}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs("button",{onClick:y,className:"px-3 py-1.5 text-sm border border-gray-300 rounded-md hover:bg-gray-50 transition-colors flex items-center gap-1",children:[r.jsx(yc,{className:"w-4 h-4"}),"Copy"]})})]}),r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[r.jsx("div",{className:"p-4 border-b border-gray-200",children:r.jsx("div",{className:"space-y-2",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(_t,{className:"w-4 h-4 text-gray-600"}),r.jsx("input",{type:"email",value:o.editedTo,onChange:x=>c({...o,editedTo:x.target.value}),placeholder:"recipient@example.com",className:"flex-1 p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-pink-500"})]})})}),r.jsx("div",{className:"p-4",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject"}),r.jsx("input",{type:"text",value:o.editedSubject,onChange:x=>c({...o,editedSubject:x.target.value}),placeholder:"Email subject...",className:"w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-pink-600"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Body"}),r.jsx("textarea",{value:o.editedBody,onChange:x=>c({...o,editedBody:x.target.value}),placeholder:"Email content...",className:"w-full p-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-pink-600 resize-none",rows:12})]})]})})]})]}):r.jsxs("div",{className:"text-center py-12",children:[r.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(Dt,{className:"w-8 h-8 text-gray-400"})}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Generate Your Email"}),r.jsx("p",{className:"text-gray-600",children:'Select an email type and click "Generate Email" to create a personalized message.'})]})}),o.generatedEmail&&(e.email||e.primaryContact)&&r.jsx("div",{className:"p-6 border-t bg-gray-50 flex-shrink-0",children:r.jsxs("div",{className:"flex items-center justify-end gap-3",children:[r.jsx("button",{onClick:t,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),r.jsx("button",{onClick:f,disabled:d,className:"bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 disabled:from-gray-400 disabled:to-gray-500 text-white px-4 py-2 rounded-lg transition-all flex items-center gap-2",children:d?r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"w-4 h-4 animate-spin"}),"Sending..."]}):r.jsxs(r.Fragment,{children:[r.jsx(to,{className:"w-4 h-4"}),"Send Email"]})})]})})]})]})});return s?g:r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-5xl w-full mx-4 max-h-[90vh] overflow-hidden",children:g})})},MT=({customer:e,isOpen:t,onClose:n,onCustomerDeleted:s})=>{var Gy,Ky,Xy,Jy,Qy,Zy;const{authFetch:a,deleteCustomer:i,refreshCustomers:l,updateCustomer:o,cachedSummaries:c,refreshCachedSummaries:d}=xc(),{registerCrmSyncCallback:u}=EC(),[m,p]=h.useState("overview"),[f,y]=h.useState(null),[g,x]=h.useState(!1),[b,v]=h.useState(!1),[w,N]=h.useState(null),[k,j]=h.useState(!1),[S,_]=h.useState(""),[C,D]=h.useState(30),[A,E]=h.useState([]),[T,M]=h.useState({}),[L,P]=h.useState(!1),[$,R]=h.useState("all"),[U,I]=h.useState(""),[z,F]=h.useState(null),[O,K]=h.useState(!1),[J,se]=h.useState(null),[Z,oe]=h.useState(!1),[W,B]=h.useState([]),[V,re]=h.useState({}),[Me,he]=h.useState(""),[G,q]=h.useState(""),[Q,ue]=h.useState(!1),[Le,ge]=h.useState(!1),[Se,ce]=h.useState(null),[ke,Pe]=h.useState(!1),[qe,ne]=h.useState(!1),[ye,Ee]=h.useState("all"),[st,Ke]=h.useState(""),[At,lt]=h.useState(""),[Ht,pt]=h.useState(!1),[be,ze]=h.useState(null),[ee,X]=h.useState(null),[te,we]=h.useState(""),[Ne,nt]=h.useState(!1),[ie,xe]=h.useState([]),[Ie,Oe]=h.useState(!1),[Ue,$e]=h.useState(""),ot="http://localhost:8003",fe=2e3,pe=1,je=200,Fe=Ce=>Ce==="important"||Ce==="urgent"||Ce==="starred",Y=()=>e!=null&&e.assignedEmployeeName?e.assignedEmployeeName:"Not Assigned",me=(Ce,Ye)=>{console.log(`[Edit] Starting to edit field: ${Ce}, current value:`,Ye),X(Ce),we(Ye||"")},_e=()=>{console.log(`[Edit] Cancelled editing field: ${ee}`),X(null),we("")},Nt=async Ce=>{if(!(e!=null&&e.id)){console.error("[Edit] No customer ID found, cannot save");return}console.log(`[Edit] Saving field: ${Ce}`),console.log(`[Edit] Customer ID: ${e.id}`),console.log("[Edit] Old value:",e[Ce]),console.log("[Edit] New value:",te),nt(!0);try{const St={company:"company",industry:"industry",location:"location",email:"email",phone:"phone",primaryContact:"primaryContact"}[Ce];if(!St){console.error("[Edit] Unknown field:",Ce);return}console.log(`[Edit] Mapped to backend field: ${St}`);const Zt={[St]:te};console.log("[Edit] Sending payload to API:",Zt);const Ae=await a(`${ot}/api/crm/customers/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Zt)});if(console.log("[Edit] API response status:",Ae.status),!Ae.ok){const It=await Ae.text();throw console.error("[Edit] API error response:",It),new Error("Failed to update customer")}const Pt=await Ae.json();console.log("[Edit] Updated customer data received:",Pt),o(Pt),console.log("[Edit] Customer updated in context"),X(null),we(""),console.log("[Edit] Editing state cleared"),lt("Field updated successfully!"),setTimeout(()=>lt(""),3e3),console.log("[Edit] Success notification displayed")}catch(Ye){console.error("[Edit] Error updating field:",Ye),console.error("[Edit] Error stack:",Ye.stack),Ke("Failed to update field"),setTimeout(()=>Ke(""),3e3)}finally{nt(!1),console.log("[Edit] Save operation completed")}},Ft=(Ce,Ye,St="")=>ee===Ce?r.jsxs("div",{children:[r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:"text",value:te,onChange:Ae=>we(Ae.target.value),onBlur:()=>!Ne&&_e(),onKeyDown:Ae=>{Ae.key==="Enter"?Nt(Ce):Ae.key==="Escape"&&_e()},className:"w-full px-2 py-1 pr-8 border border-blue-500 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",autoFocus:!0,disabled:Ne}),Ne&&r.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:r.jsx(Be,{className:"w-4 h-4 animate-spin text-blue-600"})})]}),r.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Press Enter to save, Esc to cancel"})]}):r.jsx("div",{onClick:()=>me(Ce,Ye),className:"cursor-pointer hover:bg-blue-50 py-1 rounded transition-colors",title:"Click to edit",children:r.jsx("p",{className:"text-gray-900",children:r.jsx("span",{className:Ye?"":"text-gray-400 italic",children:Ye||St})})}),rr=async()=>{if(e!=null&&e.id){Oe(!0),$e("");try{console.log("[Deals] Fetching deals for customer:",e.id);const Ce=await a(`${ot}/api/crm/deals/customer/${e.id}`);if(!Ce.ok)throw new Error("Failed to fetch deals");const Ye=await Ce.json();console.log("[Deals] Customer deals received:",Ye.length),xe(Ye)}catch(Ce){console.error("[Deals] Error fetching deals:",Ce),$e("Failed to load deals")}finally{Oe(!1)}}};h.useEffect(()=>{t&&e&&m==="deals"&&rr()},[t,e,m]);const Yt=async(Ce=!1)=>{if(e!=null&&e.id){if(!Ce&&T[e.id]){console.log("Loading interactions from cache for customer",e.id),E(T[e.id]);return}P(!0);try{const Ye=await a(`${ot}/api/crm/customers/${e.id}/interactions`);if(Ye.ok){const St=await Ye.json();E(St),M(Zt=>({...Zt,[e.id]:St})),console.log("Interactions loaded from API and cached for customer",e.id)}}catch(Ye){console.error("Error fetching interactions:",Ye)}finally{P(!1)}}};h.useEffect(()=>{e!=null&&e.id&&t&&(_(""),Promise.all([Yt(),Ds()]).catch(Ce=>{console.error("Error loading customer data:",Ce)}))},[e==null?void 0:e.id,t]),h.useEffect(()=>{if(!t||!(e!=null&&e.id))return;console.log("[CustomerProfile] Registering CRM sync callback for customer",e.id);const Ce=u(Ye=>{console.log("[CustomerProfile] CRM sync completed, refreshing interactions for customer",e.id),Yt(!0)});return()=>{console.log("[CustomerProfile] Unregistering CRM sync callback"),Ce()}},[t,e==null?void 0:e.id,u]);const ft=()=>e!=null&&e.id&&c[e.id]||null,Ds=async(Ce=!1)=>{if(e!=null&&e.id){if(!Ce&&V[e.id]){console.log("Loading notes from cache for customer",e.id),B(V[e.id]);return}Ce?ne(!0):Pe(!0);try{const Ye=await a(`${ot}/api/crm/customers/${e.id}/notes`);if(Ye.ok){const Zt=(await Ye.json()).map(Ae=>({id:Ae.note_id,content:Ae.title?`${Ae.title}: ${Ae.body}`:Ae.body,date:new Date(Ae.created_at),author:"You",type:"user",title:Ae.title,body:Ae.body,star:Ae.star,employee_id:Ae.employee_id,updated_at:new Date(Ae.updated_at),isStarred:Fe(Ae.star),interaction_id:Ae.interaction_id}));B(Zt),re(Ae=>({...Ae,[e.id]:Zt})),console.log("Notes loaded from API and cached for customer",e.id)}else console.error("Failed to load notes:",Ye.status),B([])}catch(Ye){console.error("Error loading customer notes:",Ye),B([])}finally{Pe(!1),ne(!1)}}},Ni=()=>{e!=null&&e.id&&(re(Ce=>{const Ye={...Ce};return delete Ye[e.id],Ye}),console.log("Notes cache invalidated for customer",e.id))},fo=()=>{e!=null&&e.id&&(M(Ce=>{const Ye={...Ce};return delete Ye[e.id],Ye}),console.log("Interactions cache invalidated for customer",e.id))},ae=async()=>{Ni(),await Ds(!0)},Te=async()=>{fo(),await Yt(!0)},Ve=(Ce,Ye="")=>{const St=Ce.trim(),Zt=Ye.trim();return St.length<pe?"Note cannot be empty":St.length>fe?`Note cannot exceed ${fe} characters`:Zt.length>je?`Title cannot exceed ${je} characters`:null},gt=()=>{setTimeout(()=>{Ke(""),lt("")},3e3)},zt=async(Ce=null)=>{if(!(e!=null&&e.id))return;const Ye=Ce&&be,St=Ye?Ce.title:G,Zt=Ye?Ce.body:Me,Ae=Ye?Ce.star:Q,Pt=Ye?be.id:null,It=Ve(Zt,St);if(It){Ke(It),gt();return}Ke(""),lt("");const Sr={title:St.trim()||"",body:Zt.trim(),star:Ae?"important":null,interaction_id:Pt};ge(!0);try{const Yr=await a(`${ot}/api/crm/customers/${e.id}/notes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Sr)});if(Yr.ok)Ni(),await Ds(!0),Ye?(pt(!1),ze(null)):(he(""),q(""),ue(!1)),lt("Note added successfully!"),gt();else{const Ci=await Yr.json();console.error("Failed to add note:",Ci),Ke("Failed to add note: "+(Ci.detail||"Unknown error")),gt()}}catch(Yr){console.error("Error adding note:",Yr),Ke("Error adding note: "+Yr.message),gt()}finally{ge(!1)}},Mt=Ce=>{var Ye,St,Zt,Ae,Pt;if(console.log("Timeline event clicked:",Ce),Ce.originalType==="note"){const It=W.find(Sr=>{var Yr;return Sr.id===((Yr=Ce.metadata)==null?void 0:Yr.noteId)});It?(se(It),oe(!0)):console.error("Note not found:",(Ye=Ce.metadata)==null?void 0:Ye.noteId)}else if(Ce.originalType==="meeting"){const It=(St=Ce.metadata)==null?void 0:St.interactionId;if(!It){console.error("No interaction ID found for meeting event:",Ce);return}const Sr=(Zt=Ce.metadata)==null?void 0:Zt.parsedMeetingData;let Yr=null;Sr&&(Yr={interaction_id:It,customer_id:e==null?void 0:e.id,title:Sr.title||((Ae=Ce.metadata)==null?void 0:Ae.theme)||Ce.title,description:Sr.description,start_time:Sr.start_time,end_time:Sr.end_time,attendees:Sr.attendees||[],location:Sr.location,meeting_link:Sr.meeting_link,timezone:Sr.timezone||"UTC",created_at:Ce.date,updated_at:(Pt=Ce.metadata)==null?void 0:Pt.updatedAt}),console.log("Opening CRM meeting modal with data:",Yr),F({id:It,data:Yr}),K(!0)}else Nn(Ce)},An=()=>{K(!1),F(null)},De=async Ce=>{console.log("Meeting updated:",Ce),await Yt()},at=async()=>{console.log("Meeting deleted"),K(!1),F(null),await Yt()},wt=()=>{oe(!1),se(null)},Gt=async Ce=>{await Ds(!0)},kr=async Ce=>{await Yt(!0)},Wn=async Ce=>{await Yt(!0)},Nn=Ce=>{y(Ce),x(!0)},Pn=()=>{x(!1),y(null)},Tr=()=>{v(!b)},dr=async Ce=>{if(Ce){ce(Ce);try{const Ye=await a(`${ot}/api/crm/notes/${Ce}`,{method:"DELETE"});if(Ye.ok)B(St=>St.filter(Zt=>Zt.id!==Ce)),e!=null&&e.id&&V[e.id]&&re(St=>({...St,[e.id]:St[e.id].filter(Zt=>Zt.id!==Ce)})),lt("Note deleted successfully!"),gt();else{const St=await Ye.json();console.error("Failed to delete note:",St),Ke("Failed to delete note: "+(St.detail||"Unknown error")),gt()}}catch(Ye){console.error("Error deleting note:",Ye),Ke("Error deleting note: "+Ye.message),gt()}finally{ce(null)}}},tn=async(Ce,Ye)=>{if(!Ce)return;const St=Fe(Ye)?null:"important",Zt=Fe(St),Ae=[...W];B(Pt=>Pt.map(It=>It.id===Ce?{...It,star:St,isStarred:Zt}:It)),e!=null&&e.id&&V[e.id]&&re(Pt=>({...Pt,[e.id]:Pt[e.id].map(It=>It.id===Ce?{...It,star:St,isStarred:Zt}:It)}));try{const Pt=await a(`${ot}/api/crm/notes/${Ce}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({star:St})});if(Pt.ok)lt(`Note ${St?"marked as important":"unmarked as important"} successfully!`),gt(),setTimeout(()=>{Ni(),Ds(!0)},1e3);else{console.error("Failed to toggle note star - reverting optimistic update"),B(Ae),e!=null&&e.id&&re(Sr=>({...Sr,[e.id]:Ae}));const It=await Pt.json();Ke("Failed to update note importance: "+(It.detail||"Unknown error")),gt()}}catch(Pt){console.error("Error toggling note star - reverting optimistic update:",Pt),B(Ae),e!=null&&e.id&&re(It=>({...It,[e.id]:Ae})),Ke("Error updating note importance: "+Pt.message),gt()}};h.useEffect(()=>{t||(p("overview"),_(""),E([]),R("all"),I(""),v(!1),F(null),K(!1),B([]),re({}),M({}),he(""),q(""),ue(!1),ce(null),Pe(!1),ne(!1),Ee("all"),Ke(""),lt(""),pt(!1),ze(null))},[t]);const zs=async()=>{if(e!=null&&e.id){j(!0),_("");try{const Ce=await a(`${ot}/api/crm/interaction-summary/${e.id}?days_back=${C}&force_refresh=true`),Ye=await Ce.json();Ce.ok?(console.log("Summary generated successfully:",Ye),await d()):_("Failed to generate interaction summary")}catch(Ce){console.error("Error:",Ce),_("Error connecting to server")}finally{j(!1)}}},Jm=()=>{const Ce=[];e.timeline&&Array.isArray(e.timeline)&&e.timeline.forEach((Ae,Pt)=>{if(Ae.date&&!isNaN(new Date(Ae.date).getTime())){let It=Ae.type?Ae.type.toLowerCase().trim():"activity";const Yr={meet:"meeting",call:"call",email:"email"}[It]||It;Ce.push({type:Yr,originalType:Yr,title:Ae.title||Ae.type||"Customer Activity",description:Ae.description||Ae.content||"",date:Ae.date,employeeName:Ae.employeeName||"System",metadata:Ae.metadata||{}})}}),e.recentActivities&&Array.isArray(e.recentActivities)&&e.recentActivities.forEach((Ae,Pt)=>{const It=Ae.date||Ae.createdAt||new Date().toISOString();isNaN(new Date(It).getTime())||Ce.push({type:"activity",originalType:"activity",title:Ae.title||Ae.type||"Customer Activity",description:Ae.description||Ae.content||"",date:It,employeeName:Ae.employeeName||"System",metadata:Ae.metadata||{}})}),A.forEach(Ae=>{if(Ae.createdAt&&!isNaN(new Date(Ae.createdAt).getTime())){let Pt=Ae.type?Ae.type.toLowerCase().trim():"activity";const Sr={meet:"meeting",call:"call",email:"email"}[Pt]||Pt;let Yr=Ae.content,Ci,ki=null;if(Sr==="email"?(Ci=Ae.theme||Ae.subject||"No subject",Yr=Ae.content||""):Ci=Ae.theme||`${Sr.toUpperCase()}: ${Ae.employeeName}`,Sr==="meeting"&&Ae.content)try{ki=JSON.parse(Ae.content),Ci=`MEETING: ${Ae.theme||ki.title||"Meeting"}`;const sA=ki.start_time?new Date(ki.start_time).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Time not specified",tb=ki.description,Uc=ki.attendees;let Qm=[sA];if(tb&&Qm.push(tb),Uc&&Array.isArray(Uc)&&Uc.length>0){const aA=Uc.join(", ");Qm.push(`Attendees: ${aA}`)}Yr=Qm.join("  ")}catch(eb){console.warn("Failed to parse meeting content JSON:",eb)}const nA={type:Sr,originalType:Sr,title:Ci,description:Yr,date:Ae.createdAt,employeeName:Ae.employeeName,metadata:{interactionId:Ae.id,employeeRole:Ae.employeeRole,employeeDepartment:Ae.employeeDepartment,duration:Ae.duration,outcome:Ae.outcome,subject:Ae.subject,gmailMessageId:Ae.gmailMessageId,updatedAt:Ae.updatedAt,theme:Ae.theme,source:Ae.source,sourceName:Ae.sourceName,sourceType:Ae.sourceType,parsedMeetingData:ki}};Ce.push(nA)}});let Ye=Ce.filter(Ae=>Ae.date&&!isNaN(new Date(Ae.date).getTime()));if($!=="all"&&(Ye=Ye.filter(Ae=>{const Pt=Ae.originalType?Ae.originalType.toLowerCase().trim():"",It=$.toLowerCase().trim();return Pt===It})),U.trim()){const Ae=U.toLowerCase();Ye=Ye.filter(Pt=>Pt.title.toLowerCase().includes(Ae)||Pt.description.toLowerCase().includes(Ae)||Pt.employeeName.toLowerCase().includes(Ae))}const St=Ye.sort((Ae,Pt)=>new Date(Pt.date)-new Date(Ae.date)),Zt=St.reduce((Ae,Pt)=>(Ae[Pt.originalType]=(Ae[Pt.originalType]||0)+1,Ae),{});return console.log(" DEBUG: Final filtered events:",St.map(Ae=>({type:Ae.type,originalType:Ae.originalType,title:Ae.title}))),console.log(" DEBUG: Event type distribution:",Zt),console.log(" DEBUG: Total events returned:",St.length),St},rA=`customer-profile-${(e==null?void 0:e.id)||(e==null?void 0:e.client_id)||(e==null?void 0:e.name)||"unknown"}-${t?"open":"closed"}`;return r.jsx(h.Fragment,{children:r.jsxs(ht,{children:[t&&e?r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex justify-center pt-8 px-8",onClick:n,children:r.jsxs(de.div,{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},className:"w-full bg-white rounded-lg shadow-2xl relative h-full flex flex-col",onClick:Ce=>Ce.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between pt-5 pb-3 px-6 border-b border-gray-200 flex-shrink-0",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-10 h-10 bg-pink-600 rounded-lg flex items-center justify-center",children:r.jsx(qt,{className:"w-5 h-5 text-white"})}),r.jsx("h1",{className:"text-2xl font-bold text-gray-900 leading-none self-center -mb-1",children:e.company})]}),r.jsx(H,{variant:"ghost",size:"icon",onClick:n,children:r.jsx(Ze,{className:"w-5 h-5 text-gray-500"})})]}),r.jsx("div",{className:"border-b border-gray-200 flex-shrink-0 px-6",children:r.jsxs("div",{className:"flex",children:[r.jsxs(H,{variant:"ghost",onClick:()=>p("overview"),className:`flex items-center gap-2 p-4 text-sm font-medium border-b-2 rounded-none ${m==="overview"?"border-pink-600 text-pink-600 hover:text-pink-700":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(sx,{className:"w-4 h-4"}),"Overview"]}),r.jsxs(H,{variant:"ghost",onClick:()=>p("email"),className:`flex items-center gap-2 p-4 text-sm font-medium border-b-2 rounded-none ${m==="email"?"border-pink-600 text-pink-600 hover:text-pink-700":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(Dt,{className:"w-4 h-4"}),"Send Email"]}),r.jsxs(H,{variant:"ghost",onClick:()=>p("deals"),className:`flex items-center gap-2 p-4 text-sm font-medium border-b-2 rounded-none ${m==="deals"?"border-pink-600 text-pink-600 hover:text-pink-700":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(Ur,{className:"w-4 h-4"}),"Deals"]})]})}),r.jsxs("div",{className:"flex-1 overflow-y-auto py-4 px-5 bg-gray-50",children:[m==="overview"&&r.jsx(r.Fragment,{children:r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-4",children:[r.jsx("div",{className:"lg:col-span-3 lg:order-2 space-y-4",children:r.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 flex flex-col",style:{height:"calc(1000px + 1rem)"},children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center gap-2 flex-shrink-0",children:[r.jsx(qt,{className:"w-4 h-4 text-pink-600"}),"Customer Information"]}),r.jsxs("div",{className:"space-y-4 flex-1 overflow-y-auto",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Company"}),Ft("company",e.company,"Company name")]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Industry"}),Ft("industry",e.industry,"Industry")]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Location"}),Ft("location",e.location,"Location")]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Primary Contact"}),Ft("primaryContact",e.primaryContact,"Contact name")]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Email"}),Ft("email",e.email,"Email address")]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Phone"}),Ft("phone",e.phone,"Phone number")]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Website"}),r.jsx("p",{className:"text-gray-900",children:e.website?r.jsx("a",{href:e.website.startsWith("http")?e.website:`https://${e.website}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 hover:underline transition-colors",children:e.website}):r.jsx("span",{className:"text-gray-400 italic",children:"No website"})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Assigned Employee"}),r.jsx("p",{className:"text-gray-900",children:Y()})]}),r.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[r.jsxs("h4",{className:"text-md font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[r.jsx(Bn,{className:"w-4 h-4 text-pink-600"}),"Quick Stats"]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Status"}),r.jsx("div",{className:"text-gray-900 font-medium",children:(()=>{var Ae,Pt,It;const Ce=e.churnRisk||((Ae=ft())==null?void 0:Ae.churn_risk)||((It=(Pt=ft())==null?void 0:Pt.summary_data)==null?void 0:It.churn_risk);if(!Ce)return"Unknown";const Ye=Ce.toLowerCase();let St="Unknown",Zt="text-gray-600";return Ye==="low"||Ye==="medium"?(St="Active",Zt="text-green-600"):Ye==="high"?(St="Inactive",Zt="text-yellow-600"):Ye==="declining"&&(St="Declining",Zt="text-red-600"),r.jsx("span",{className:`font-semibold ${Zt}`,children:St})})()})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Annual Recurring Revenue"}),r.jsxs("p",{className:"text-gray-900 font-medium",children:["$",e.revenue||e.contractValue||"0"]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Interactions (Last 2 weeks)"}),r.jsx("div",{className:"text-gray-900 font-medium",children:((Ky=(Gy=ft())==null?void 0:Gy.summary_data)==null?void 0:Ky.interaction_count)||0})]})]})]})]})]})}),r.jsxs("div",{className:"lg:col-span-7 lg:order-1 space-y-4",children:[r.jsx(ure,{customer:e,customerInteractions:A,loadingInteractions:L,timelineFilter:$,setTimelineFilter:R,timelineSearch:U,setTimelineSearch:I,isTimelineExpanded:b,handleTimelineToggle:Tr,expandedPanel:w,setExpandedPanel:N,handleEventClick:Mt,getTimelineEvents:Jm,authFetch:a,onNoteAdded:ae,onInteractionAdded:Te,notes:W,isLoadingNotes:ke,isRefreshingNotes:qe,handleDeleteNote:dr,handleToggleNoteStar:tn,isDeletingNote:Se,onCallDeleted:kr}),r.jsxs("div",{className:`bg-white rounded-lg border border-gray-200 flex flex-col transition-all duration-300 ${w==="summary"?"h-[calc(1000px+1rem-60px-1rem)] p-6":w==="activity"?"h-[60px] overflow-visible px-6 py-3":"h-[500px] p-6"}`,children:[r.jsxs("div",{className:`flex items-center justify-between flex-shrink-0 ${w==="activity"?"mb-0":"mb-6"}`,children:[r.jsxs("h3",{className:"text-lg font-bold text-black font-[Inter] flex items-center gap-2",children:[r.jsx(Ot,{className:"w-5 h-5 text-pink-600"}),"Interaction Summary"]}),r.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[r.jsxs(H,{id:"refresh-summary-button",variant:"outline",className:"border-gray-300 text-gray-600 hover:bg-gray-50 gap-x-2 whitespace-nowrap",onClick:zs,disabled:k||!(e!=null&&e.id),children:[r.jsx(Br,{className:"w-4 h-4 flex-shrink-0"}),k?"Analyzing...":ft()?"Refresh Summary":"Generate Summary"]}),r.jsx("button",{onClick:()=>N(w==="summary"?null:"summary"),className:"text-gray-500 hover:text-gray-700 transition-colors p-1 hover:bg-gray-100 rounded flex-shrink-0",title:w==="summary"?"Collapse":"Expand",children:w==="summary"?r.jsx(Xt,{className:"w-5 h-5"}):r.jsx(La,{className:"w-5 h-5"})})]})]}),w!=="activity"&&r.jsx("div",{className:"flex-1 overflow-y-auto",children:k?r.jsx("div",{className:"flex items-center justify-center h-full",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Be,{className:"w-8 h-8 text-purple-600 mx-auto mb-3 animate-spin"}),r.jsx("p",{className:"text-gray-600",children:"Analyzing customer interactions..."})]})}):ft()?r.jsxs("div",{className:"space-y-4",children:[((Jy=(Xy=ft())==null?void 0:Xy.summary_data)==null?void 0:Jy.recent_activities)&&ft().summary_data.recent_activities.length>0&&r.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-5",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-gray-100",children:[r.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center",children:r.jsx(Mr,{className:"w-4 h-4 text-blue-600"})}),r.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"AI Insights"})]}),r.jsx("div",{className:"space-y-4",children:ft().summary_data.recent_activities.map((Ce,Ye)=>r.jsxs("div",{className:"flex gap-3",children:[r.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-blue-700 text-xs font-semibold mt-0.5",children:Ye+1}),r.jsx("p",{className:"text-sm text-gray-700 leading-relaxed flex-1",children:Ce})]},Ye))})]}),((Zy=(Qy=ft())==null?void 0:Qy.summary_data)==null?void 0:Zy.next_steps)&&ft().summary_data.next_steps.length>0&&r.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-5",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-gray-100",children:[r.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center",children:r.jsx(bt,{className:"w-4 h-4 text-blue-600"})}),r.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Next Steps"})]}),r.jsx("div",{className:"space-y-4",children:ft().summary_data.next_steps.map((Ce,Ye)=>r.jsxs("div",{className:"flex gap-3",children:[r.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-blue-700 text-xs font-semibold mt-0.5",children:Ye+1}),r.jsx("p",{className:"text-sm text-gray-700 leading-relaxed flex-1",children:Ce})]},Ye))})]})]}):S?r.jsx("div",{className:"flex items-center justify-center h-full",children:r.jsxs("div",{className:"text-center text-red-600",children:[r.jsx(dt,{className:"w-8 h-8 mx-auto mb-2"}),r.jsx("p",{className:"text-sm",children:"Error generating summary"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:S})]})}):r.jsx("div",{className:"flex items-center justify-center h-full",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Br,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),r.jsx("p",{className:"text-gray-500 text-sm",children:"No interaction summary available"}),r.jsx("p",{className:"text-gray-400 text-xs mt-1",children:'Click "Generate Summary" to create AI-powered insights'})]})})})]})]})]})}),m==="email"&&r.jsx("div",{className:"p-6 h-full",children:e&&r.jsx(OT,{customer:e,onClose:()=>p("overview"),onEmailSent:async Ce=>{console.log("Email sent:",Ce),await new Promise(Ye=>setTimeout(Ye,300)),await Yt(!0),p("overview")},embedded:!0})}),m==="deals"&&r.jsx("div",{className:"space-y-6",children:r.jsxs("div",{className:"w-4/5 mx-auto",children:[r.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Ur,{className:"w-6 h-6 text-pink-600"}),r.jsxs("h3",{className:"text-xl font-semibold text-gray-900",children:["Deals with ",e.company]})]}),r.jsxs("button",{onClick:rr,disabled:Ie,className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors disabled:opacity-50",title:"Refresh deals",children:[r.jsx(Be,{className:`w-4 h-4 ${Ie?"animate-spin":""}`}),"Refresh"]})]}),!Ie&&!Ue&&ie.length>0&&r.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t border-gray-200",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-xs text-gray-600",children:"Total Deals"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ie.length})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-xs text-gray-600",children:"Total Value"}),r.jsxs("p",{className:"text-2xl font-bold text-pink-600",children:["$",ie.reduce((Ce,Ye)=>Ce+(Ye.value_usd||0),0).toLocaleString()]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-xs text-gray-600",children:"Active Deals"}),r.jsx("p",{className:"text-2xl font-bold text-blue-600",children:ie.filter(Ce=>!["won","lost"].includes(Ce.stage)).length})]})]})]}),Ie?r.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-8 text-center",children:r.jsxs("div",{className:"flex items-center justify-center gap-3",children:[r.jsx(Be,{className:"w-5 h-5 text-gray-400 animate-spin"}),r.jsx("span",{className:"text-gray-600",children:"Loading deals..."})]})}):Ue?r.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[r.jsx(dt,{className:"w-6 h-6 text-red-600 mx-auto mb-2"}),r.jsx("span",{className:"text-red-700",children:Ue})]}):ie.length===0?r.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[r.jsx(Ur,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-500 text-lg mb-2",children:"No deals found"}),r.jsx("p",{className:"text-gray-400 text-sm",children:"There are currently no deals associated with this customer."})]}):r.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:r.jsxs("table",{className:"w-full bg-white",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ut,{className:"w-4 h-4"}),r.jsx("span",{children:"Deal Name"})]})}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ur,{className:"w-4 h-4"}),r.jsx("span",{children:"Value"})]})}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ot,{className:"w-4 h-4"}),r.jsx("span",{children:"Stage"})]})}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(sn,{className:"w-4 h-4"}),r.jsx("span",{children:"Last Contact"})]})}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(yt,{className:"w-4 h-4"}),r.jsx("span",{children:"Expected Close"})]})}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(jt,{className:"w-4 h-4"}),r.jsx("span",{children:"Created"})]})})]})}),r.jsx("tbody",{className:"divide-y divide-gray-200",children:ie.map((Ce,Ye)=>r.jsxs("tr",{className:`hover:bg-blue-50 transition-colors ${Ye%2===0?"bg-white":"bg-gray-50"}`,children:[r.jsx("td",{className:"px-4 py-3",children:r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:Ce.deal_name}),Ce.description&&r.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-1",children:Ce.description})]})}),r.jsx("td",{className:"px-4 py-3",children:r.jsxs("span",{className:"text-sm font-semibold text-pink-600",children:["$",Ce.value_usd?Ce.value_usd.toLocaleString():"0"]})}),r.jsx("td",{className:"px-4 py-3",children:r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Ce.stage==="won"?"bg-green-100 text-green-800":Ce.stage==="lost"?"bg-red-100 text-red-800":Ce.stage==="negotiation"?"bg-blue-100 text-blue-800":Ce.stage==="proposal"?"bg-purple-100 text-purple-800":"bg-yellow-100 text-yellow-800"}`,children:Ce.stage.charAt(0).toUpperCase()+Ce.stage.slice(1)})}),r.jsx("td",{className:"px-4 py-3",children:r.jsx("span",{className:"text-sm text-gray-700",children:Ce.last_contact_date?new Date(Ce.last_contact_date).toLocaleDateString():"-"})}),r.jsx("td",{className:"px-4 py-3",children:r.jsx("span",{className:"text-sm text-gray-700",children:Ce.expected_close_date?new Date(Ce.expected_close_date).toLocaleDateString():"-"})}),r.jsx("td",{className:"px-4 py-3",children:r.jsx("span",{className:"text-sm text-gray-500",children:new Date(Ce.created_at).toLocaleDateString()})})]},Ce.deal_id))})]})})]})})]})]})},rA):null,r.jsx(DT,{isOpen:O,onClose:An,meetingId:z==null?void 0:z.id,authFetch:a,meeting:z==null?void 0:z.data,onUpdate:De,onDelete:at},"meeting-modal"),r.jsx(TT,{event:f,customer:e,isOpen:g,onClose:Pn,notes:W,customerInteractions:A,onDelete:kr,onUpdate:Wn,authFetch:a},"interaction-modal"),r.jsx(PT,{note:J,customer:e,isOpen:Z,onClose:wt,onDelete:dr,onUpdate:Gt,onToggleStar:tn,isDeletingNote:Se,authFetch:a},"note-details-modal"),r.jsx(ire,{isOpen:Ht,onClose:()=>{pt(!1),ze(null)},onAddNote:zt,interaction:be,isAdding:Le},"add-note-modal")]})})},mre=({isOpen:e,onClose:t})=>{const{authFetch:n}=Qr(),s="http://localhost:8003",[a,i]=h.useState(null),[l,o]=h.useState([]),[c]=h.useState([]),[d,u]=h.useState(!0),[m,p]=h.useState(null),[f,y]=h.useState("overview"),[g,x]=h.useState(!1),[b,v]=h.useState(""),[w,N]=h.useState("all"),[k,j]=h.useState(null),[S,_]=h.useState(!1),[C,D]=h.useState("");h.useEffect(()=>{e&&A()},[e]);const A=async()=>{u(!0),p(null);try{const R=await fetch(`${s}/api/crm/database/stats`);if(R.ok){const I=await R.json();i(I)}const U=await fetch(`${s}/api/crm/customers`);if(U.ok){const I=await U.json();o(I)}}catch(R){p("Failed to fetch database data"),console.error("Database fetch error:",R)}finally{u(!1)}},E=R=>R?new Date(R).toLocaleDateString():"N/A",T=R=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(R||0),M=R=>({healthy:"bg-green-100 text-green-800","at-risk":"bg-yellow-100 text-yellow-800",churned:"bg-red-100 text-red-800"})[R]||"bg-gray-100 text-gray-800",L=async()=>{_(!0),D("");try{const R=await n(`${s}/api/crm/generate-analytics-insights`,{method:"POST",headers:{"Content-Type":"application/json"}}),U=await R.json();R.ok?j(U.insights):D("Failed to generate analytics insights")}catch(R){console.error("Error generating insights:",R),D("Error connecting to server")}finally{_(!1)}},P=l.filter(R=>{const U=R.name.toLowerCase().includes(b.toLowerCase())||R.email.toLowerCase().includes(b.toLowerCase())||R.company.toLowerCase().includes(b.toLowerCase()),I=w==="all"||R.status===w;return U&&I}),$=[{id:"overview",label:"Overview",icon:Da},{id:"customers",label:"Customers",icon:kt},{id:"emails",label:"Emails",icon:Dt},{id:"analytics",label:"Analytics",icon:Ot}];return e?r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:t,children:r.jsxs(de.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-lg shadow-xl w-full max-w-6xl h-[90vh] flex flex-col",onClick:R=>R.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(qn,{className:"w-6 h-6 text-purple-600"}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Database Visualization"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Real-time CRM database insights"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(H,{onClick:A,disabled:d,className:"bg-purple-600 hover:bg-purple-700",size:"sm",children:[r.jsx(Be,{className:`w-4 h-4 ${d?"animate-spin":""}`}),"Refresh"]}),r.jsx(H,{onClick:t,variant:"ghost",size:"sm",children:r.jsx(Ze,{className:"w-4 h-4"})})]})]}),r.jsx("div",{className:"flex border-b",children:$.map(R=>{const U=R.icon;return r.jsxs("button",{onClick:()=>y(R.id),className:`flex items-center gap-2 px-6 py-3 border-b-2 transition-colors ${f===R.id?"border-purple-600 text-purple-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[r.jsx(U,{className:"w-4 h-4"}),R.label]},R.id)})}),r.jsx("div",{className:"flex-1 overflow-hidden",children:d?r.jsx("div",{className:"flex items-center justify-center h-full",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):m?r.jsx("div",{className:"flex items-center justify-center h-full",children:r.jsxs("div",{className:"text-center",children:[r.jsx(dt,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),r.jsx("p",{className:"text-red-600",children:m})]})}):r.jsx("div",{className:"h-full overflow-y-auto p-6",children:r.jsxs(ht,{mode:"wait",children:[f==="overview"&&r.jsxs(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[a&&r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[r.jsx(We,{children:r.jsxs(it,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(kt,{className:"w-5 h-5 text-blue-600"}),r.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Customers"})]}),r.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:a.customer_count})]})}),r.jsx(We,{children:r.jsxs(it,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Dt,{className:"w-5 h-5 text-green-600"}),r.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Emails"})]}),r.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:a.email_count})]})}),r.jsx(We,{children:r.jsxs(it,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(IC,{className:"w-5 h-5 text-purple-600"}),r.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Linked Emails"})]}),r.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:a.linked_email_count})]})}),r.jsx(We,{children:r.jsxs(it,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Bn,{className:"w-5 h-5 text-orange-600"}),r.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Link Rate"})]}),r.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:[a.email_count>0?Math.round(a.linked_email_count/a.email_count*100):0,"%"]})]})})]}),(a==null?void 0:a.status_distribution)&&r.jsxs(We,{children:[r.jsx(ir,{children:r.jsxs(cr,{className:"flex items-center gap-2",children:[r.jsx(PC,{className:"w-5 h-5"}),"Customer Status Distribution"]})}),r.jsx(it,{children:r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(a.status_distribution).map(([R,U])=>r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${M(R)}`,children:R.charAt(0).toUpperCase()+R.slice(1)}),r.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:U})]},R))})})]}),r.jsxs(We,{children:[r.jsx(ir,{children:r.jsxs(cr,{className:"flex items-center gap-2",children:[r.jsx(qn,{className:"w-5 h-5"}),"Database Information"]})}),r.jsx(it,{children:r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Database Path:"}),r.jsx("span",{className:"font-mono text-sm",children:a==null?void 0:a.database_path})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Last Updated:"}),r.jsx("span",{children:E(new Date)})]})]})})]})]},"overview"),f==="customers"&&r.jsxs(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-4",children:[r.jsxs("div",{className:"flex gap-4",children:[r.jsx("div",{className:"flex-1",children:r.jsxs("div",{className:"relative",children:[r.jsx(zn,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search customers...",value:b,onChange:R=>v(R.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg"})]})}),r.jsxs("select",{value:w,onChange:R=>N(R.target.value),className:"border rounded-lg px-3 py-2",children:[r.jsx("option",{value:"all",children:"All Status"}),r.jsx("option",{value:"healthy",children:"Healthy"}),r.jsx("option",{value:"at-risk",children:"At Risk"}),r.jsx("option",{value:"churned",children:"Churned"})]})]}),r.jsx("div",{className:"grid gap-4",children:P.map(R=>r.jsx(We,{className:"hover:shadow-md transition-shadow",children:r.jsx(it,{className:"p-4",children:r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[r.jsx(_t,{className:"w-5 h-5 text-gray-400"}),r.jsx("h3",{className:"font-semibold text-gray-900",children:R.name}),r.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${M(R.status)}`,children:R.status})]}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Email:"}),r.jsx("p",{className:"font-medium",children:R.email})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Company:"}),r.jsx("p",{className:"font-medium",children:R.company})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-600",children:"ARR:"}),r.jsx("p",{className:"font-medium",children:T(R.arr)})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Created:"}),r.jsx("p",{className:"font-medium",children:E(R.created_at)})]})]})]})})})},R.id))})]},"customers"),f==="emails"&&r.jsxs(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Recent Emails"}),r.jsxs(H,{onClick:()=>x(!g),variant:"ghost",size:"sm",children:[g?r.jsx(Ku,{className:"w-4 h-4"}):r.jsx(bs,{className:"w-4 h-4"}),g?"Hide Content":"Show Content"]})]}),r.jsx("div",{className:"space-y-4",children:c.map(R=>r.jsx(We,{className:"hover:shadow-md transition-shadow",children:r.jsx(it,{className:"p-4",children:r.jsx("div",{className:"flex items-start justify-between",children:r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Dt,{className:"w-4 h-4 text-gray-400"}),r.jsx("h4",{className:"font-semibold text-gray-900",children:R.subject}),r.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${R.direction==="inbound"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:R.direction})]}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-3",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-600",children:"From:"}),r.jsx("p",{className:"font-medium",children:R.sender})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-600",children:"To:"}),r.jsx("p",{className:"font-medium",children:R.recipient})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Date:"}),r.jsx("p",{className:"font-medium",children:E(R.date)})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Linked:"}),r.jsx("p",{className:"font-medium",children:R.customer_id?r.jsx(bt,{className:"w-4 h-4 text-green-600 inline"}):r.jsx(oP,{className:"w-4 h-4 text-gray-400 inline"})})]})]}),g&&r.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:r.jsx("p",{className:"text-sm text-gray-700",children:R.body})})]})})})},R.id))})]},"emails"),f==="analytics"&&r.jsxs(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[r.jsxs(We,{children:[r.jsx(ir,{children:r.jsxs(cr,{className:"flex items-center gap-2",children:[r.jsx(Br,{className:"w-5 h-5 text-purple-600"}),"AI-Powered Analytics Insights"]})}),r.jsxs(it,{children:[C&&r.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:r.jsx("p",{className:"text-red-700",children:C})}),k?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[r.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200",children:[r.jsx("div",{className:"text-2xl font-bold text-blue-800",children:k.data_summary.total_customers}),r.jsx("div",{className:"text-sm text-blue-600",children:"Total Customers"})]}),r.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-lg border border-green-200",children:[r.jsxs("div",{className:"text-2xl font-bold text-green-800",children:["$",(k.data_summary.total_arr/1e6).toFixed(1),"M"]}),r.jsx("div",{className:"text-sm text-green-600",children:"Total ARR"})]}),r.jsxs("div",{className:"bg-gradient-to-r from-yellow-50 to-orange-50 p-4 rounded-lg border border-yellow-200",children:[r.jsx("div",{className:"text-2xl font-bold text-orange-800",children:k.data_summary.at_risk_count}),r.jsx("div",{className:"text-sm text-orange-600",children:"At Risk"})]}),r.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-lg border border-purple-200",children:[r.jsx("div",{className:"text-2xl font-bold text-purple-800",children:k.data_summary.expansion_opportunities_count}),r.jsx("div",{className:"text-sm text-purple-600",children:"Expansion Opps"})]})]}),r.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-blue-50 p-6 rounded-lg border border-gray-200",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Er,{className:"w-5 h-5 text-blue-600"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"AI Analysis"}),r.jsxs("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:["Generated by ",k.generated_by]})]}),r.jsx("button",{onClick:()=>j(null),className:"p-1 hover:bg-gray-200 rounded-full transition-colors duration-200",title:"Close analysis",children:r.jsx(Ze,{className:"w-5 h-5 text-gray-500 hover:text-gray-700"})})]}),r.jsx("div",{className:"prose prose-sm max-w-none",children:r.jsx("div",{className:"text-gray-700 text-sm leading-relaxed space-y-4",children:r.jsx(Sk,{rehypePlugins:[Tk],components:{h3:({children:R})=>r.jsx("h3",{className:"text-lg font-bold text-gray-900 mt-6 mb-3 border-b border-gray-200 pb-2",children:R}),ul:({children:R})=>r.jsx("ul",{className:"list-none space-y-1 mb-4",children:R}),li:({children:R})=>r.jsxs("li",{className:"ml-4 mb-2",children:[" ",R]}),p:({children:R})=>r.jsx("p",{className:"mb-4",children:R}),strong:({children:R})=>r.jsx("strong",{className:"font-semibold text-gray-900",children:R})},children:k.analysis_text})})}),r.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:["Analysis by: ",k.analyst]})]})]}):r.jsxs("div",{className:"text-center py-12",children:[r.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-purple-100 to-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(Br,{className:"w-8 h-8 text-purple-600"})}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"AI-Powered Analytics"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Generate intelligent insights about your customer portfolio using AI analysis"}),r.jsxs(H,{onClick:L,disabled:S,className:"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",children:[r.jsx(Mr,{className:"w-4 h-4 mr-2"}),"Generate AI Insights"]})]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs(We,{children:[r.jsx(ir,{children:r.jsxs(cr,{className:"flex items-center gap-2",children:[r.jsx(Ot,{className:"w-5 h-5"}),"Customer Growth"]})}),r.jsx(it,{children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-3xl font-bold text-gray-900",children:l.length}),r.jsx("p",{className:"text-sm text-gray-600",children:"Total Customers"})]})})]}),r.jsxs(We,{children:[r.jsx(ir,{children:r.jsxs(cr,{className:"flex items-center gap-2",children:[r.jsx(Kr,{className:"w-5 h-5"}),"Email Activity"]})}),r.jsx(it,{children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-3xl font-bold text-gray-900",children:c.length}),r.jsx("p",{className:"text-sm text-gray-600",children:"Recent Emails"})]})})]})]}),r.jsxs(We,{children:[r.jsx(ir,{children:r.jsxs(cr,{className:"flex items-center gap-2",children:[r.jsx(Da,{className:"w-5 h-5"}),"Customer Status Analytics"]})}),r.jsx(it,{children:r.jsx("div",{className:"space-y-4",children:(a==null?void 0:a.status_distribution)&&Object.entries(a.status_distribution).map(([R,U])=>r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:`w-3 h-3 rounded-full ${R==="customer"?"bg-green-500":R==="lead"?"bg-yellow-500":R==="prospect"?"bg-blue-500":"bg-red-500"}`}),r.jsx("span",{className:"capitalize",children:R})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-32 bg-gray-200 rounded-full h-2",children:r.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${a.customer_count>0?U/a.customer_count*100:0}%`}})}),r.jsx("span",{className:"text-sm font-medium",children:U})]})]},R))})})]})]},"analytics")]})})})]})}):null},hre=({searchTerm:e,setSearchTerm:t,searchColumns:n,isAddingCustomer:s,setIsAddingCustomer:a,showFilters:i,setShowFilters:l,columnFilters:o,setColumnFilters:c,visibleColumns:d,onColumnToggle:u})=>{var ot;const{customers:m,customersLoading:p,customersError:f,updateCustomer:y,deleteCustomer:g,setCustomers:x,loadCustomers:b,employees:v,loadEmployees:w,CRM_API_BASE_URL:N,authFetch:k}=xc(),{isAuthenticated:j,user:S}=Qr(),[_,C]=h.useState(new Set),[D,A]=h.useState({}),[E,T]=h.useState(new Set),[M,L]=h.useState({}),[P,$]=h.useState(!1),[R,U]=h.useState(null),[I,z]=h.useState(null),[F,O]=h.useState({churnRisk:"",industry:"",status:"",expansionPotential:""}),[K,J]=h.useState(!1),[se,Z]=h.useState([]),[oe,W]=h.useState(!1),[B,V]=h.useState({key:null,direction:"asc"}),[re,Me]=h.useState(""),[he,G]=h.useState(!1),[q,Q]=h.useState({}),[ue,Le]=h.useState({}),[ge,Se]=h.useState(!1),[ce,ke]=h.useState(null),[Pe,qe]=h.useState(!0),[ne,ye]=h.useState({isOpen:!1,customer:null,isDeleting:!1}),Ee=e!==void 0?e:re,st=t||Me,Ke=s!==void 0?s:he,At=a||G,lt=o!==void 0?o:ue;h.useEffect(()=>{if(I){const fe=setTimeout(()=>{z(null)},3e3);return()=>clearTimeout(fe)}},[I]),h.useEffect(()=>{w()},[w]),h.useEffect(()=>{(async()=>{if(!j||!(S!=null&&S.email)){qe(!1);return}try{qe(!0);const pe=await k(`${N}/api/crm/employees`);if(pe.ok){const Fe=(await pe.json()).find(Y=>Y.email===S.email);Fe?(ke(Fe.employee_id),console.log(" Current user employee_id:",Fe.employee_id)):(console.warn(" Current user not found in employee_info table"),ke(null))}}catch(pe){console.error(" Error fetching current user employee ID:",pe),ke(null)}finally{qe(!1)}})()},[j,S==null?void 0:S.email,N,k]),h.useEffect(()=>{Ke&&ce&&!q.assignedSalesman&&Q(fe=>({...fe,assignedSalesman:ce}))},[Ke,ce]),h.useEffect(()=>{const fe=m.filter(pe=>pe.churnRisk==="high"&&pe.id);fe.length>0?Z(fe.map(pe=>({id:pe.id,company:pe.company,message:`${pe.company} has high churn risk! Consider immediate engagement.`}))):Z([])},[m]);const Ht=fe=>{try{if(!fe)return;let pe="asc";B.key===fe&&B.direction==="asc"&&(pe="desc"),V({key:fe,direction:pe})}catch(pe){console.error("Error in handleSort:",pe)}},pt={company:{type:"text",label:"Company",icon:qt,required:!0,sortable:!0,validation:fe=>(fe==null?void 0:fe.length)>=2?null:"Company name must be at least 2 characters"},primaryContact:{type:"text",label:"Contact",icon:_t,sortable:!0,validation:fe=>(fe==null?void 0:fe.length)>=1?null:"Contact name is required"},email:{type:"email",label:"Email",icon:Dt,validation:fe=>fe?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(fe)?null:"Invalid email format":"Email is required"},phone:{type:"tel",label:"Phone",icon:sn,validation:fe=>!fe||fe.length>=10?null:"Phone number must be at least 10 digits"},industry:{type:"text",label:"Industry",icon:_n,sortable:!0},churnRisk:{type:"select",label:"Churn Risk",icon:Ot,sortable:!0,readOnly:!0,options:[{value:"low",label:"Active",color:"bg-green-100 text-green-800"},{value:"medium",label:"Active",color:"bg-green-100 text-green-800"},{value:"high",label:"Inactive",color:"bg-yellow-100 text-yellow-800"},{value:"declining",label:"Declining",color:"bg-red-100 text-red-800"}]},lifetimeValue:{type:"currency",label:"Lifetime Value",icon:Ur,validation:fe=>{const pe=parseFloat(fe);return isNaN(pe)||pe<0?"Must be a valid positive number":null}},expansionPotential:{type:"select",label:"Upsell Potential",icon:Ot,sortable:!0,options:[{value:"very low",label:"Very Low",color:"bg-gray-100 text-gray-800"},{value:"low",label:"Low",color:"bg-gray-100 text-gray-800"},{value:"medium",label:"Medium",color:"bg-yellow-100 text-yellow-800"},{value:"high",label:"High",color:"bg-green-100 text-green-800"},{value:"very high",label:"Very High",color:"bg-emerald-100 text-emerald-800"}]},lastContact:{type:"date",label:"Last Contacted",icon:yt,sortable:!0},assignedSalesman:{type:"select",label:"Assigned Salesman",icon:_t,required:!1,get options(){return(v==null?void 0:v.map(pe=>({value:pe.employee_id,label:pe.name||`${pe.first_name||""} ${pe.last_name||""}`.trim()||`Employee ${pe.employee_id}`})))||[]}}},be=(fe,pe)=>{if(!pe||!pe.condition)return!0;const{condition:je,value:Fe}=pe,Y=String(fe||"").toLowerCase(),me=String(Fe||"").toLowerCase();switch(je){case"contains":return Y.includes(me);case"not_contains":return!Y.includes(me);case"equals":return Y===me;case"not_equals":return Y!==me;case"starts_with":return Y.startsWith(me);case"ends_with":return Y.endsWith(me);case"is_empty":return!fe||fe==="";case"not_empty":return fe&&fe!=="";case"greater_than":return parseFloat(fe)>parseFloat(Fe);case"less_than":return parseFloat(fe)<parseFloat(Fe);case"greater_equal":return parseFloat(fe)>=parseFloat(Fe);case"less_equal":return parseFloat(fe)<=parseFloat(Fe);case"between":{const[_e,Nt]=Fe.split(",").map(rr=>parseFloat(rr)),Ft=parseFloat(fe);return Ft>=_e&&Ft<=Nt}case"in":return Fe.split(",").includes(String(fe));case"not_in":return!Fe.split(",").includes(String(fe));default:return!0}},ze=le.useMemo(()=>{let fe=m.filter(pe=>{var je;if(Ee){const Fe=Ee.toLowerCase(),Y=[],me=n||{company:!0,primaryContact:!0,email:!0,industry:!0};if(me.company&&Y.push(pe.company),me.primaryContact&&Y.push(pe.primaryContact),me.email&&Y.push(pe.email),me.industry&&Y.push(pe.industry),me.phone&&Y.push(pe.phone),me.status&&Y.push(pe.status),me.notes&&Y.push(pe.notes),!Y.some(_e=>_e==null?void 0:_e.toLowerCase().includes(Fe)))return!1}for(const[Fe,Y]of Object.entries(lt))if(!(Array.isArray(Y)?Y:[Y]).every(Nt=>be(pe[Fe],Nt)))return!1;return!(F.churnRisk&&pe.churnRisk!==F.churnRisk||F.status&&pe.status!==F.status||F.industry&&!((je=pe.industry)!=null&&je.toLowerCase().includes(F.industry.toLowerCase()))||F.expansionPotential&&pe.expansionPotential!==F.expansionPotential)});if(B.key&&fe.length>0)try{fe.sort((pe,je)=>{let Fe=pe&&pe[B.key]!==void 0?pe[B.key]:"",Y=je&&je[B.key]!==void 0?je[B.key]:"";const me=pt[B.key];(me==null?void 0:me.type)==="currency"||B.key==="lifetimeValue"?(Fe=parseFloat(Fe)||0,Y=parseFloat(Y)||0):(me==null?void 0:me.type)==="date"||B.key==="lastContact"?(Fe=new Date(Fe||"1900-01-01"),Y=new Date(Y||"1900-01-01")):(me==null||me.type,Fe=String(Fe||"").toLowerCase(),Y=String(Y||"").toLowerCase());try{return Fe<Y?B.direction==="asc"?-1:1:Fe>Y?B.direction==="asc"?1:-1:0}catch(_e){return console.error("Error comparing values:",_e),0}})}catch(pe){console.error("Error sorting customers:",pe)}return fe},[m,B,lt,Ee,n,F]),ee=(fe,pe)=>`${fe}-${pe}`,X=(fe,pe)=>{pe.target.closest(".editable-cell")||pe.target.closest("button")||pe.target.closest("select")||pe.target.closest("input")||(U(fe),$(!0))};h.useEffect(()=>{if(R&&P){const fe=m.find(pe=>pe.id===R.id);fe&&U(fe)}},[m,R==null?void 0:R.id,P]);const te=(fe,pe,je)=>{const Fe=ee(fe,pe);C(Y=>new Set([...Y,Fe])),A(Y=>({...Y,[Fe]:je||""})),L(Y=>({...Y,[Fe]:null}))},we=(fe,pe)=>{const je=ee(fe,pe);C(Fe=>{const Y=new Set(Fe);return Y.delete(je),Y}),A(Fe=>{const Y={...Fe};return delete Y[je],Y}),L(Fe=>{const Y={...Fe};return delete Y[je],Y})},Ne=async(fe,pe)=>{if(pe.stopPropagation(),!j){z({type:"error",message:"You must be logged in to delete customers"});return}const je=m.find(Fe=>Fe.id===fe);je&&ye({isOpen:!0,customer:je,isDeleting:!1})},nt=async()=>{const fe=ne.customer;if(fe){ye(pe=>({...pe,isDeleting:!0}));try{const pe=await g(fe.id);if(pe.success)z({type:"success",message:`Customer "${fe.company}" deleted successfully`}),ye({isOpen:!1,customer:null,isDeleting:!1});else throw new Error(pe.error||"Failed to delete customer")}catch(pe){console.error("Error deleting customer:",pe),z({type:"error",message:`Failed to delete customer: ${pe.message}`}),ye({isOpen:!1,customer:null,isDeleting:!1})}}},ie=()=>{ye({isOpen:!1,customer:null,isDeleting:!1})},xe=async(fe,pe)=>{var me;const je=ee(fe,pe),Fe=D[je],Y=pt[pe];if(!j){L(_e=>({..._e,[je]:"You must be logged in to edit data"}));return}if(Y!=null&&Y.validation){const _e=Y.validation(Fe);if(_e){L(Nt=>({...Nt,[je]:_e}));return}}T(_e=>new Set([..._e,je]));try{let _e=Fe,Nt=pe;pe==="assignedSalesman"?(Nt="assignedEmployeeId",_e=parseInt(Fe)||null):(Y==null?void 0:Y.type)==="currency"||(Y==null?void 0:Y.type)==="number"?_e=parseFloat(Fe)||0:(Y==null?void 0:Y.type)==="date"&&(_e=Fe||null),console.log(`Updating customer ${fe}, field: ${Nt}, value:`,_e);const Ft=await k(`${N}/api/crm/customers/${fe}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({[Nt]:_e})});if(!Ft.ok){const Yt=await Ft.json().catch(()=>({}));throw new Error(Yt.detail||`HTTP ${Ft.status}: Failed to update customer`)}const rr=await Ft.json();if(y(rr),C(Yt=>{const ft=new Set(Yt);return ft.delete(je),ft}),A(Yt=>{const ft={...Yt};return delete ft[je],ft}),pe==="assignedSalesman"){const Yt=((me=v==null?void 0:v.find(ft=>ft.employee_id===parseInt(Fe)))==null?void 0:me.name)||"employee";z({type:"success",message:`Assigned salesman updated to ${Yt}`})}}catch(_e){console.error("Error updating customer:",_e),L(Nt=>({...Nt,[je]:"Failed to save changes"})),z({type:"error",message:`Failed to update: ${_e.message}`})}finally{T(_e=>{const Nt=new Set(_e);return Nt.delete(je),Nt})}},Ie=(fe,pe,je)=>{var Y;const Fe=pt[pe];if(pe==="assignedSalesman"){if(je!=null&&je.assignedEmployeeName)return je.assignedEmployeeName;if(je!=null&&je.assignedEmployeeId){const me=v==null?void 0:v.find(_e=>_e.employee_id===je.assignedEmployeeId);return me?me.name||`Employee ${je.assignedEmployeeId}`:`Employee ${je.assignedEmployeeId}`}return"-"}if(!fe&&fe!==0)return"-";switch(Fe==null?void 0:Fe.type){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(fe);case"date":return fe?new Date(fe).toLocaleDateString():"-";case"select":const me=(Y=Fe.options)==null?void 0:Y.find(_e=>_e.value===fe);return me?me.label:fe;default:return fe}},Oe=fe=>{const pe=fe.toLowerCase(),je={low:{color:"bg-green-500",textColor:"text-green-700",bgColor:"bg-green-50"},medium:{color:"bg-green-500",textColor:"text-green-700",bgColor:"bg-green-50"},high:{color:"bg-yellow-500",textColor:"text-yellow-700",bgColor:"bg-yellow-50"},declining:{color:"bg-red-500",textColor:"text-red-700",bgColor:"bg-red-50"}},Fe=je[pe]||je.low;return r.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded-lg ${Fe.bgColor}`,children:[r.jsx("div",{className:"flex gap-1",children:["low","medium","high"].map((Y,me)=>r.jsx("div",{className:`h-3 w-1 rounded-sm ${["low","medium","high"].indexOf(pe)>=me?Fe.color:"bg-gray-300"}`},Y))}),r.jsx("span",{className:`text-xs font-medium ${Fe.textColor}`,children:pe==="low"||pe==="medium"?"Active":pe==="high"?"Inactive":pe==="declining"?"Declining":"Active"})]})},Ue=(fe,pe)=>{var Fe;const je=pt[pe];if((je==null?void 0:je.type)==="select"){const Y=(Fe=je.options)==null?void 0:Fe.find(me=>me.value===fe);return(Y==null?void 0:Y.color)||"bg-gray-100 text-gray-800"}return""},$e=(fe,pe)=>{var Ft;const je=ee(fe.id,pe),Fe=_.has(je);E.has(je);const Y=M[je],me=pt[pe];let _e=fe[pe];pe==="assignedSalesman"&&(_e=fe.assignedEmployeeId);const Nt=D[je];return Fe?r.jsxs("div",{className:"relative",children:[(me==null?void 0:me.type)==="select"?r.jsx("select",{value:Nt,onChange:rr=>A(Yt=>({...Yt,[je]:rr.target.value})),onBlur:()=>xe(fe.id,pe),onKeyDown:rr=>{rr.key==="Enter"?xe(fe.id,pe):rr.key==="Escape"&&we(fe.id,pe)},className:`px-2 py-1 border rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 w-full ${Y?"border-red-300":"border-gray-300"}`,autoFocus:!0,children:(Ft=me.options)==null?void 0:Ft.map(rr=>r.jsx("option",{value:rr.value,children:rr.label},rr.value))}):r.jsx("input",{type:(me==null?void 0:me.type)||"text",value:Nt,onChange:rr=>A(Yt=>({...Yt,[je]:rr.target.value})),onBlur:()=>xe(fe.id,pe),className:`px-2 py-1 border rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 w-full ${Y?"border-red-300":"border-gray-300"}`,min:me==null?void 0:me.min,max:me==null?void 0:me.max,step:(me==null?void 0:me.type)==="currency"?"0.01":void 0,autoFocus:!0,onKeyDown:rr=>{rr.key==="Enter"?xe(fe.id,pe):rr.key==="Escape"&&we(fe.id,pe)}}),Y&&r.jsx("div",{className:"absolute top-full left-0 mt-1 text-xs text-red-600 bg-red-50 px-2 py-1 rounded border border-red-200 shadow-sm z-10",children:Y})]}):pe==="churnRisk"?r.jsx("div",{className:"px-2 py-1 rounded flex items-center justify-between min-h-[32px]",title:"Status (read-only)",children:Oe(_e||"low")}):r.jsxs("div",{className:"group cursor-pointer hover:bg-blue-50 px-2 py-1 rounded flex items-center justify-between min-h-[32px] editable-cell",onClick:()=>te(fe.id,pe,_e),title:"Click to edit",children:[(me==null?void 0:me.type)==="select"?r.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${Ue(_e,pe)}`,children:Ie(_e,pe,fe)}):r.jsx("span",{className:_e?"text-gray-900":"text-gray-400 italic",children:Ie(_e,pe,fe)}),r.jsx(nl,{className:"w-3 h-3 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity"})]})};return p?r.jsxs("div",{className:"flex items-center justify-center h-64",children:[r.jsx(Ct,{className:"w-8 h-8 animate-spin text-blue-600"}),r.jsx("span",{className:"ml-2 text-gray-600",children:"Loading customers..."})]}):r.jsxs("div",{className:"h-full flex flex-col min-h-0",children:[I&&r.jsxs("div",{className:`mb-4 p-3 rounded-lg flex items-center justify-between animate-fade-in ${I.type==="success"?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800"}`,children:[r.jsxs("div",{className:"flex items-center gap-2",children:[I.type==="success"?r.jsx(Xr,{className:"w-4 h-4"}):r.jsx(dt,{className:"w-4 h-4"}),r.jsx("span",{className:"text-sm font-medium",children:I.message})]}),r.jsx("button",{onClick:()=>z(null),className:"text-gray-500 hover:text-gray-700",children:r.jsx(Ze,{className:"w-4 h-4"})})]}),p&&r.jsxs("div",{className:"flex items-center justify-center h-64",children:[r.jsx(Ct,{className:"w-8 h-8 animate-spin text-blue-600"}),r.jsx("span",{className:"ml-2 text-gray-600",children:"Loading customers..."})]}),f&&!p&&r.jsx("div",{className:"p-3",children:r.jsx("div",{className:"border-red-200 bg-red-50 rounded-lg p-6",children:r.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[r.jsx(dt,{className:"w-6 h-6"}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold",children:"Cannot load database"}),r.jsx("p",{className:"text-sm mt-1",children:f})]})]})})}),!p&&!f&&r.jsxs(r.Fragment,{children:[se.length>0&&r.jsx("div",{className:"mb-4",children:r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 cursor-pointer hover:bg-red-100 transition-colors",onClick:()=>W(!0),children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Yi,{className:"w-5 h-5 text-red-600 animate-pulse"}),r.jsxs("span",{className:"text-red-800 font-semibold",children:[se.length," ",se.length===1?"customer has":"customers have"," high churn risk"]}),r.jsx("span",{className:"text-red-600 text-sm",children:"- Click to view details"})]}),r.jsx(dt,{className:"w-5 h-5 text-red-600"})]})})}),r.jsx("div",{className:"flex-1 min-h-0 overflow-auto border border-gray-200 rounded-lg",children:r.jsx("div",{className:"h-full min-w-max",children:r.jsxs("table",{className:"w-full bg-white table-auto min-w-max",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[(!d||d.company!==!1)&&r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-gray-700",onClick:()=>Ht("company"),children:[r.jsx(qt,{className:"w-4 h-4"}),r.jsx("span",{children:"Company"}),B.key==="company"?B.direction==="asc"?r.jsx(Ar,{className:"w-3 h-3 text-blue-600"}):r.jsx(Gr,{className:"w-3 h-3 text-blue-600"}):r.jsx(rn,{className:"w-3 h-3 text-gray-400"})]})}),(!d||d.primaryContact!==!1)&&r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-gray-700",onClick:()=>Ht("primaryContact"),children:[r.jsx(_t,{className:"w-4 h-4"}),r.jsx("span",{children:"Contact"}),B.key==="primaryContact"?B.direction==="asc"?r.jsx(Ar,{className:"w-3 h-3 text-blue-600"}):r.jsx(Gr,{className:"w-3 h-3 text-blue-600"}):r.jsx(rn,{className:"w-3 h-3 text-gray-400"})]})}),Object.entries(pt).filter(([fe])=>fe!=="company"&&fe!=="primaryContact").filter(([fe])=>!d||d[fe]!==!1).map(([fe,pe])=>r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-gray-700",onClick:()=>Ht(fe),children:[pe.icon&&r.jsx(pe.icon,{className:"w-4 h-4"}),r.jsx("span",{children:pe.label}),B.key===fe?B.direction==="asc"?r.jsx(Ar,{className:"w-3 h-3 text-blue-600"}):r.jsx(Gr,{className:"w-3 h-3 text-blue-600"}):r.jsx(rn,{className:"w-3 h-3 text-gray-400"})]})},fe)),r.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),r.jsxs("tbody",{className:"divide-y divide-gray-200",children:[Ke&&r.jsxs("tr",{className:"bg-blue-50 border-2 border-blue-200",children:[(!d||d.company!==!1)&&r.jsx("td",{className:"px-4 py-3",children:r.jsx("input",{type:"text",placeholder:"Company name",className:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:q.company||"",onChange:fe=>Q(pe=>({...pe,company:fe.target.value})),autoFocus:!0})}),(!d||d.primaryContact!==!1)&&r.jsx("td",{className:"px-4 py-3",children:r.jsx("input",{type:"text",placeholder:"Contact name",className:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:q.primaryContact||"",onChange:fe=>Q(pe=>({...pe,primaryContact:fe.target.value}))})}),Object.keys(pt).filter(fe=>!["company","primaryContact"].includes(fe)).filter(fe=>!d||d[fe]!==!1).map(fe=>{var je,Fe,Y;const pe=pt[fe];return r.jsx("td",{className:"px-4 py-3",children:pe.type==="select"?r.jsxs("select",{className:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:q[fe]||(fe==="assignedSalesman"?ce:((Fe=(je=pe.options)==null?void 0:je[0])==null?void 0:Fe.value)||""),onChange:me=>Q(_e=>({..._e,[fe]:me.target.value})),children:[fe==="assignedSalesman"&&r.jsx("option",{value:"",children:"Select salesman..."}),(Y=pe.options)==null?void 0:Y.map(me=>r.jsx("option",{value:me.value,children:me.label},me.value))]}):pe.type==="currency"?r.jsx("input",{type:"number",step:"0.01",placeholder:"0.00",className:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:q[fe]||"",onChange:me=>Q(_e=>({..._e,[fe]:me.target.value}))}):pe.type==="date"?r.jsx("span",{className:"text-gray-400 text-sm",children:"-"}):r.jsx("input",{type:pe.type||"text",placeholder:pe.label,className:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:q[fe]||"",onChange:me=>Q(_e=>({..._e,[fe]:me.target.value}))})},fe)}),r.jsx("td",{className:"px-4 py-3 text-right",children:r.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[r.jsx("button",{onClick:async()=>{if(!ge)try{if(Se(!0),!q.company){z({type:"error",message:"Company name is required"});return}const fe=q.email||`${q.company.toLowerCase().replace(/\s+/g,"")}@placeholder.com`,pe=await k(`${N}/api/crm/customers`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:q.company,primary_contact:q.primaryContact||"",email:fe,phone:q.phone||"",industry:q.industry||"Business",status:q.status||"active",churn_risk:q.churnRisk||"low",contract_value:parseFloat(q.lifetimeValue)||0})});if(!pe.ok)throw new Error("Failed to create customer");const je=await pe.json();console.log("Customer created successfully:",je),x(Fe=>[je,...Fe]),z({type:"success",message:"Customer added successfully"}),At(!1),Q({})}catch(fe){console.error("Error creating customer:",fe),z({type:"error",message:"Failed to create customer"})}finally{Se(!1)}},disabled:ge,className:`p-1 ${ge?"text-gray-400 cursor-not-allowed":"text-green-600 hover:text-green-800"}`,title:ge?"Saving...":"Save customer",children:ge?r.jsx(Ct,{className:"w-4 h-4 animate-spin"}):r.jsx(Xr,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>{At(!1),Q({})},disabled:ge,className:`p-1 ${ge?"text-gray-400 cursor-not-allowed":"text-red-600 hover:text-red-800"}`,title:"Cancel",children:r.jsx(Ze,{className:"w-4 h-4"})})]})})]}),ze.map((fe,pe)=>r.jsxs("tr",{className:`cursor-pointer hover:bg-blue-50 transition-colors ${pe%2===0?"bg-white":"bg-gray-50"}`,onClick:je=>X(fe,je),title:"Click to view customer details",children:[(!d||d.company!==!1)&&r.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:r.jsx("div",{className:"flex items-center",children:r.jsx("div",{children:$e(fe,"company")})})}),(!d||d.primaryContact!==!1)&&r.jsx("td",{className:"px-4 py-2 relative",children:$e(fe,"primaryContact")}),Object.keys(pt).filter(je=>je!=="company"&&je!=="primaryContact").filter(je=>!d||d[je]!==!1).map(je=>r.jsx("td",{className:"px-4 py-2 relative",children:$e(fe,je)},je)),r.jsx("td",{className:"px-4 py-3 text-right",children:r.jsx("button",{onClick:je=>{je.stopPropagation(),Ne(fe.id,je)},className:"text-red-500 hover:text-red-700 hover:bg-red-50 p-1 rounded transition-colors",title:`Delete ${fe.company||"Customer"}`,children:r.jsx(fr,{className:"w-4 h-4"})})})]},fe.id))]})]})})}),ze.length===0&&m.length>0&&r.jsxs("div",{className:"text-center py-12 text-gray-500",children:[r.jsx(da,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),r.jsx("p",{children:"No customers match the current search and filters"}),r.jsx("button",{onClick:()=>{st(""),O({churnRisk:"",industry:"",status:"",expansionPotential:""})},className:"mt-2 text-blue-600 hover:text-blue-800 text-sm",children:"Clear search and filters"})]}),m.length===0&&r.jsxs("div",{className:"text-center py-12 text-gray-500",children:[r.jsx(qt,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),r.jsx("p",{children:"No customers found"})]})]}),r.jsx(MT,{customer:R,isOpen:P,onClose:()=>$(!1),onCustomerDeleted:fe=>{$(!1),U(null)}}),r.jsx(Vm,{isOpen:ne.isOpen,customer:ne.customer,itemName:(ot=ne.customer)==null?void 0:ot.company,itemType:"customer",isDeleting:ne.isDeleting,onConfirm:nt,onClose:ie}),oe&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[80vh] flex flex-col",children:[r.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between bg-red-50",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Yi,{className:"w-6 h-6 text-red-600"}),r.jsxs("h2",{className:"text-xl font-semibold text-red-800",children:["High Churn Risk Alerts (",se.length,")"]})]}),r.jsx("button",{onClick:()=>W(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:r.jsx(Ze,{className:"w-6 h-6"})})]}),r.jsxs("div",{className:"px-6 py-4 overflow-y-auto flex-1",children:[r.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"The following customers require immediate engagement to prevent churn:"}),r.jsx("div",{className:"space-y-3",children:se.map(fe=>{const pe=m.find(je=>je.id===fe.id);return r.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 flex items-center justify-between hover:bg-red-100 transition-colors cursor-pointer group",onClick:()=>{U(pe),$(!0),W(!1)},children:[r.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[r.jsx(dt,{className:"w-4 h-4 text-red-600 flex-shrink-0"}),r.jsx("span",{className:"text-red-900 font-medium",children:fe.company})]}),r.jsx("button",{onClick:je=>{je.stopPropagation(),Z(Fe=>Fe.filter(Y=>Y.id!==fe.id)),se.length===1&&W(!1)},className:"text-red-400 hover:text-red-700 ml-3 flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity",title:"Dismiss alert",children:r.jsx(Ze,{className:"w-4 h-4"})})]},fe.id)})})]}),r.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end gap-3",children:[r.jsx("button",{onClick:()=>Z([]),className:"px-4 py-2 text-sm font-medium text-red-700 bg-white border border-red-300 rounded-lg hover:bg-red-50 transition-colors",children:"Dismiss All"}),r.jsx("button",{onClick:()=>W(!1),className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors",children:"Close"})]})]})})]})},pre=({analysisResult:e,onMappingComplete:t,onBack:n})=>{const[s,a]=h.useState({}),[i,l]=h.useState(!1),o={company:"Company or organization name (Required)",primaryContact:"Primary contact person name (Required)",email:"Email address (Required)",phone:"Phone number",industry:"Industry or business sector",location:"Physical location or address",status:"Customer status (active, inactive, etc.)",clientType:"Type of client (lead, customer, etc.)",arr:"Annual Recurring Revenue",contractValue:"Total contract value",monthlyValue:"Monthly recurring revenue",renewalDate:"Contract renewal date",healthScore:"Customer health score (0-100)",churnRisk:"Risk of customer churn (low, medium, high)",satisfactionScore:"Customer satisfaction score",expansionPotential:"Potential for account expansion"},c=["company","primaryContact","email"];h.useEffect(()=>{a(e.suggested_mappings||{})},[e]),h.useEffect(()=>{const y=Object.values(s),g=c.every(x=>y.includes(x));l(g)},[s]);const d=(y,g)=>{a(x=>{const b={...x};return Object.keys(b).forEach(v=>{b[v]===g&&delete b[v]}),g?b[y]=g:delete b[y],b})},u=()=>{t(s)},m=y=>Object.keys(s).find(g=>s[g]===y),p=()=>e.source_columns.filter(y=>!s[y]),f=()=>{const y=Object.values(s);return c.filter(g=>!y.includes(g))};return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx(ys,{className:"h-12 w-12 text-blue-500 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Map Your Columns"}),r.jsx("p",{className:"text-gray-600",children:"Match your file columns to CRM fields. Required fields must be mapped to continue."})]}),r.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:r.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"font-medium text-gray-900",children:e.source_columns.length}),r.jsx("div",{className:"text-gray-600",children:"Source Columns"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"font-medium text-gray-900",children:Object.keys(s).length}),r.jsx("div",{className:"text-gray-600",children:"Mapped Columns"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:`font-medium ${i?"text-green-600":"text-orange-600"}`,children:f().length===0?"Ready":"Missing Required"}),r.jsx("div",{className:"text-gray-600",children:"Status"})]})]})}),f().length>0&&r.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Cr,{className:"h-5 w-5 text-orange-500 mt-0.5 mr-3"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-orange-800",children:"Required Fields Missing"}),r.jsxs("p",{className:"text-orange-700 text-sm mt-1",children:["Please map the following required fields: ",f().join(", ")]})]})]})}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Your File Columns"}),r.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:e.source_columns.map((y,g)=>{const x=s[y];return r.jsxs("div",{className:`p-3 border rounded-lg ${x?"border-blue-200 bg-blue-50":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"font-medium text-gray-900",children:y}),x&&r.jsxs("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:[" ",x]})]}),r.jsxs("select",{value:x||"",onChange:b=>d(y,b.target.value),className:"mt-2 w-full p-2 border border-gray-300 rounded text-sm",children:[r.jsx("option",{value:"",children:"Select CRM field..."}),e.crm_fields.map(b=>r.jsxs("option",{value:b,disabled:m(b)&&m(b)!==y,children:[b," ",c.includes(b)?"(Required)":""]},b))]})]},g)})})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"CRM Fields"}),r.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:e.crm_fields.map((y,g)=>{const x=m(y),b=c.includes(y);return r.jsxs("div",{className:`p-3 border rounded-lg ${x?"border-green-200 bg-green-50":b?"border-orange-200 bg-orange-50":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"font-medium text-gray-900",children:y}),b&&r.jsx("span",{className:"ml-2 text-xs bg-red-100 text-red-800 px-2 py-1 rounded",children:"Required"})]}),x?r.jsxs("div",{className:"flex items-center",children:[r.jsx(bt,{className:"h-4 w-4 text-green-500 mr-1"}),r.jsx("span",{className:"text-xs text-green-700",children:x})]}):b?r.jsx(Cr,{className:"h-4 w-4 text-orange-500"}):null]}),o[y]&&r.jsx("p",{className:"text-xs text-gray-600 mt-1",children:o[y]})]},g)})})]})]}),Object.keys(e.suggested_mappings||{}).length>0&&r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Za,{className:"h-5 w-5 text-blue-500 mt-0.5 mr-3"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-blue-800",children:"Auto-Detected Mappings"}),r.jsxs("p",{className:"text-blue-700 text-sm mt-1",children:["We've automatically suggested ",Object.keys(e.suggested_mappings).length," column mappings based on your field names. You can modify these mappings above if needed."]})]})]})}),p().length>0&&r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Cr,{className:"h-5 w-5 text-yellow-500 mt-0.5 mr-3"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-yellow-800",children:"Unmapped Columns"}),r.jsxs("p",{className:"text-yellow-700 text-sm mt-1",children:["The following columns won't be imported: ",p().join(", ")]})]})]})}),r.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[r.jsxs(H,{variant:"outline",onClick:n,children:[r.jsx(Wi,{className:"h-4 w-4 mr-2"}),"Back"]}),r.jsxs(H,{onClick:u,disabled:!i,className:i?"":"opacity-50 cursor-not-allowed",children:["Continue to Preview",r.jsx(Dn,{className:"h-4 w-4 ml-2"})]})]})]})},fre=({file:e,columnMapping:t,onPreviewComplete:n,onBack:s})=>{const{authFetch:a}=Qr(),[i,l]=h.useState(null),[o,c]=h.useState(!1),[d,u]=h.useState(null),m="http://localhost:8003";h.useEffect(()=>{p()},[]);const p=async()=>{c(!0),u(null);try{const x=new FormData;x.append("file",e),x.append("column_mapping",JSON.stringify(t)),x.append("sample_size","10");const b=await a(`${m}/api/crm/upload/preview-import`,{method:"POST",body:x});if(!b.ok){const w=await b.json();throw new Error(w.detail||"Failed to generate preview")}const v=await b.json();l(v)}catch(x){u(x.message)}finally{c(!1)}},f=()=>{i&&n(i)},y=()=>{if(!i||!i.preview_data.length)return r.jsx("div",{className:"text-center py-8 text-gray-500",children:"No preview data available"});const x=Object.keys(i.preview_data[0]),b=["company","primaryContact","email"];return r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full border border-gray-200 rounded-lg",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsx("tr",{children:x.map((v,w)=>{const N=b.includes(v);return r.jsx("th",{className:`px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b ${N?"bg-blue-50":""}`,children:r.jsxs("div",{className:"flex items-center",children:[v,N&&r.jsx("span",{className:"ml-1 text-xs bg-blue-100 text-blue-800 px-1 py-0.5 rounded",children:"Required"})]})},w)})})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.preview_data.map((v,w)=>r.jsx("tr",{className:"hover:bg-gray-50",children:x.map((N,k)=>{const j=v[N],S=!j||j.trim()==="",_=b.includes(N);return r.jsx("td",{className:`px-4 py-3 text-sm border-b ${S&&_?"bg-red-50 text-red-700":"text-gray-900"}`,children:S?r.jsx("span",{className:"text-gray-400 italic",children:_?"Missing required data":"Empty"}):r.jsx("span",{className:"truncate block max-w-xs",title:j,children:j})},k)})},w))})]})})},g=()=>{if(!i)return null;const x=i.ready_for_import,b=["company","primaryContact","email"];let v=0;return i.preview_data.forEach(w=>{b.some(k=>!w[k]||w[k].trim()==="")&&v++}),r.jsx("div",{className:`rounded-lg p-4 ${x?"bg-green-50 border border-green-200":"bg-orange-50 border border-orange-200"}`,children:r.jsxs("div",{className:"flex items-start",children:[x?r.jsx(bt,{className:"h-5 w-5 text-green-500 mt-0.5 mr-3"}):r.jsx(dt,{className:"h-5 w-5 text-orange-500 mt-0.5 mr-3"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:`font-medium ${x?"text-green-800":"text-orange-800"}`,children:x?"Data Validation Passed":"Data Validation Issues"}),r.jsx("div",{className:`text-sm mt-1 ${x?"text-green-700":"text-orange-700"}`,children:x?r.jsx("p",{children:"All required fields are properly mapped and your data looks good for import."}):r.jsxs("div",{children:[r.jsx("p",{children:"Some issues were found with your data:"}),v>0&&r.jsxs("p",{className:"mt-1",children:[" ",v," rows have missing required data"]}),r.jsx("p",{className:"mt-1",children:"These rows will be skipped during import."})]})})]})]})})};return o?r.jsxs("div",{className:"text-center space-y-6",children:[r.jsx("div",{className:"flex justify-center",children:r.jsx(Be,{className:"h-12 w-12 text-blue-500 animate-spin"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Generating Preview..."}),r.jsx("p",{className:"text-gray-600",children:"Please wait while we process your data and generate a preview."})]})]}):d?r.jsxs("div",{className:"text-center space-y-6",children:[r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(dt,{className:"h-5 w-5 text-red-500 mt-0.5 mr-3"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-red-800",children:"Preview Error"}),r.jsx("p",{className:"text-red-700 text-sm mt-1",children:d})]})]})}),r.jsxs("div",{className:"flex justify-between",children:[r.jsxs(H,{variant:"outline",onClick:s,children:[r.jsx(Wi,{className:"h-4 w-4 mr-2"}),"Back to Mapping"]}),r.jsxs(H,{onClick:p,children:[r.jsx(Be,{className:"h-4 w-4 mr-2"}),"Retry Preview"]})]})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx(bs,{className:"h-12 w-12 text-blue-500 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Preview Your Data"}),r.jsx("p",{className:"text-gray-600",children:"Review how your data will be imported. Check that everything looks correct before proceeding."})]}),i&&r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[r.jsx(Ut,{className:"h-6 w-6 text-gray-400 mx-auto mb-2"}),r.jsx("div",{className:"text-sm text-gray-600",children:"File"}),r.jsx("div",{className:"font-medium text-gray-900",children:e.name})]}),r.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:[r.jsx(kt,{className:"h-6 w-6 text-blue-400 mx-auto mb-2"}),r.jsx("div",{className:"text-sm text-blue-600",children:"Total Rows"}),r.jsx("div",{className:"font-medium text-blue-900",children:i.total_rows})]}),r.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[r.jsx(bt,{className:"h-6 w-6 text-green-400 mx-auto mb-2"}),r.jsx("div",{className:"text-sm text-green-600",children:"Preview Rows"}),r.jsx("div",{className:"font-medium text-green-900",children:i.preview_data.length})]}),r.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 text-center",children:[r.jsx(bs,{className:"h-6 w-6 text-purple-400 mx-auto mb-2"}),r.jsx("div",{className:"text-sm text-purple-600",children:"Mapped Fields"}),r.jsx("div",{className:"font-medium text-purple-900",children:Object.keys(t).length})]})]}),g(),Object.keys(t).length>0&&r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Column Mappings"}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:Object.entries(t).map(([x,b])=>r.jsxs("div",{className:"flex items-center justify-between bg-white rounded px-3 py-2",children:[r.jsx("span",{className:"text-gray-600",children:x}),r.jsx(Dn,{className:"h-4 w-4 text-gray-400 mx-2"}),r.jsx("span",{className:"font-medium text-gray-900",children:b})]},x))})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Data Preview (First 10 Rows)"}),r.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:y()})]}),r.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[r.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Import Settings"}),r.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[r.jsx("div",{children:" Duplicate emails will be skipped"}),r.jsx("div",{children:" Rows with missing required data will be skipped"}),r.jsx("div",{children:" Invalid data will be cleaned or set to defaults"})]})]}),r.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[r.jsxs(H,{variant:"outline",onClick:s,children:[r.jsx(Wi,{className:"h-4 w-4 mr-2"}),"Back to Mapping"]}),r.jsxs(H,{onClick:f,disabled:!i,className:"bg-green-600 hover:bg-green-700",children:["Start Import",r.jsx(Dn,{className:"h-4 w-4 ml-2"})]})]})]})},gre=({onImportComplete:e,onClose:t})=>{const{authFetch:n}=Qr(),[s,a]=h.useState("upload"),[i,l]=h.useState(null),[o,c]=h.useState(null),[d,u]=h.useState({}),[m,p]=h.useState(null),[f,y]=h.useState(null),[g,x]=h.useState(!1),[b,v]=h.useState(null),[w,N]=h.useState(!1),k="http://localhost:8003",j=()=>[{"Company Name":"Example Corp","Primary Contact":"John Smith","Email Address":"john.smith@example.com","Phone Number":"+1 (555) 123-4567",Industry:"Technology",Location:"San Francisco, CA",Status:"active","Client Type":"enterprise","Annual Recurring Revenue":"50000","Contract Value":"100000","Monthly Value":"4167","Renewal Date":"2024-12-31","Health Score":"85","Churn Risk":"low","Satisfaction Score":"9.0","Expansion Potential":"high"},{"Company Name":"Sample Inc","Primary Contact":"Jane Doe","Email Address":"jane.doe@sample.com","Phone Number":"+1 (555) 987-6543",Industry:"Finance",Location:"New York, NY",Status:"active","Client Type":"mid-market","Annual Recurring Revenue":"25000","Contract Value":"50000","Monthly Value":"2083","Renewal Date":"2024-06-30","Health Score":"75","Churn Risk":"medium","Satisfaction Score":"8.0","Expansion Potential":"medium"}],S=()=>{const z=j(),F=Object.keys(z[0]),O=[F.join(","),...z.map(Z=>F.map(oe=>{const W=Z[oe]||"";return W.includes(",")||W.includes('"')?`"${W.replace(/"/g,'""')}"`:W}).join(","))].join(`
`),K=new Blob([O],{type:"text/csv;charset=utf-8;"}),J=document.createElement("a"),se=URL.createObjectURL(K);J.setAttribute("href",se),J.setAttribute("download","customer_import_template.csv"),J.style.visibility="hidden",document.body.appendChild(J),J.click(),document.body.removeChild(J)},_=async z=>{if(!z)return;if(!["text/csv","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(z.type)){v("Please upload a CSV or Excel file (.csv, .xlsx, .xls)");return}x(!0),v(null);try{const O=new FormData;O.append("file",z);const K=await n(`${k}/api/crm/upload/analyze-csv`,{method:"POST",body:O});if(!K.ok){const se=await K.json();throw new Error(se.detail||"Failed to analyze file")}const J=await K.json();l(z),c(J),u(J.suggested_mappings||{}),a("mapping")}catch(O){v(O.message)}finally{x(!1)}},C=z=>{const F=z.target.files[0];_(F)},D=h.useCallback(z=>{z.preventDefault(),N(!1);const F=z.dataTransfer.files[0];_(F)},[]),A=h.useCallback(z=>{z.preventDefault(),N(!0)},[]),E=h.useCallback(z=>{z.preventDefault(),N(!1)},[]),T=z=>{u(z),a("preview")},M=z=>{p(z),L()},L=async()=>{a("importing"),x(!0),v(null);try{const z=new FormData;z.append("file",i),z.append("column_mapping",JSON.stringify(d)),z.append("skip_duplicates","true");const F=await n(`${k}/api/crm/upload/import-customers`,{method:"POST",body:z});if(!F.ok){const K=await F.json();throw new Error(K.detail||"Failed to import customers")}const O=await F.json();y(O),a("complete"),e&&e(O)}catch(z){v(z.message),a("preview")}finally{x(!1)}},P=()=>{a("upload"),l(null),c(null),u({}),p(null),y(null),v(null)},$=()=>r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx(kt,{className:"h-12 w-12 text-blue-500 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Import Customers from CSV/Excel"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Upload a CSV or Excel file to bulk import customer data into your CRM"}),r.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:[r.jsxs("div",{className:"flex items-center justify-center gap-3 mb-2",children:[r.jsx(ra,{className:"h-5 w-5 text-green-600"}),r.jsx("span",{className:"font-medium text-green-800",children:"Need a template?"})]}),r.jsx("p",{className:"text-sm text-green-700 mb-3",children:"Download our template with sample data and proper column headers"}),r.jsxs(H,{onClick:S,variant:"outline",size:"sm",className:"bg-white border-green-300 text-green-700 hover:bg-green-50",children:[r.jsx(ra,{className:"h-4 w-4 mr-2"}),"Download Template"]})]})]}),r.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${w?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDrop:D,onDragOver:A,onDragLeave:E,children:[r.jsx(vs,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("p",{className:"text-lg font-medium text-gray-900",children:["Drop your file here, or"," ",r.jsxs("label",{className:"text-blue-600 hover:text-blue-700 cursor-pointer",children:["browse",r.jsx("input",{type:"file",className:"hidden",accept:".csv,.xlsx,.xls",onChange:C,disabled:g})]})]}),r.jsx("p",{className:"text-sm text-gray-500",children:"Supports CSV, XLSX, and XLS files up to 10MB"})]})]}),r.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[r.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"File Requirements:"}),r.jsxs("div",{className:"text-sm text-blue-800 space-y-2",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Required Fields:"}),r.jsxs("ul",{className:"mt-1 space-y-1 ml-4",children:[r.jsx("li",{children:" Company Name"}),r.jsx("li",{children:" Primary Contact"}),r.jsx("li",{children:" Email Address"})]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Optional Fields:"}),r.jsx("p",{className:"mt-1",children:"Phone, Industry, Location, Financial data (ARR, Contract Value, etc.)"})]})]}),r.jsxs("p",{className:"text-sm text-blue-700 mt-3",children:[" ",r.jsx("strong",{children:"Tip:"})," Download the template above to see all available fields with proper formatting examples."]})]})]}),R=()=>{const z=[{id:"upload",label:"Upload File",icon:vs},{id:"mapping",label:"Map Columns",icon:ys},{id:"preview",label:"Preview Data",icon:bs},{id:"importing",label:"Import",icon:Be},{id:"complete",label:"Complete",icon:bt}],F=z.findIndex(O=>O.id===s);return r.jsx("div",{className:"flex items-center justify-center space-x-4 mb-6",children:z.map((O,K)=>{const J=O.icon,se=K===F,Z=K<F;return r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full border-2 ${se?"border-blue-500 bg-blue-500 text-white":Z?"border-green-500 bg-green-500 text-white":"border-gray-300 text-gray-400"}`,children:r.jsx(J,{className:"h-5 w-5"})}),r.jsx("span",{className:`ml-2 text-sm font-medium ${se||Z?"text-gray-900":"text-gray-400"}`,children:O.label}),K<z.length-1&&r.jsx(Dn,{className:"h-4 w-4 text-gray-300 ml-4"})]},O.id)})})},U=()=>r.jsxs("div",{className:"text-center space-y-6",children:[r.jsx("div",{className:"flex justify-center",children:r.jsx(Be,{className:"h-16 w-16 text-blue-500 animate-spin"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Importing Customers..."}),r.jsx("p",{className:"text-gray-600",children:"Please wait while we process your data and import customers into your CRM."})]})]}),I=()=>r.jsxs("div",{className:"text-center space-y-6",children:[r.jsx("div",{className:"flex justify-center",children:r.jsx(bt,{className:"h-16 w-16 text-green-500"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Import Completed Successfully!"}),f&&r.jsxs("div",{className:"bg-green-50 rounded-lg p-4 mb-4",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-green-800",children:"Total Rows:"}),r.jsx("span",{className:"text-green-700 ml-2",children:f.total_rows})]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-green-800",children:"Imported:"}),r.jsx("span",{className:"text-green-700 ml-2",children:f.inserted_rows})]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-green-800",children:"Skipped:"}),r.jsx("span",{className:"text-green-700 ml-2",children:f.skipped_rows})]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-green-800",children:"Failed:"}),r.jsx("span",{className:"text-green-700 ml-2",children:f.failed_rows})]})]}),r.jsxs("div",{className:"mt-3 text-sm text-green-800",children:["Processing Time: ",Math.round(f.processing_time_ms),"ms"]})]})]}),r.jsxs("div",{className:"space-x-3",children:[r.jsx(H,{onClick:P,variant:"outline",children:"Import Another File"}),r.jsx(H,{onClick:t,children:"Close"})]})]});return r.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black bg-opacity-50",children:r.jsxs(de.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[95vh] flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsx("div",{className:"flex items-center gap-4",children:r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Import Customers"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Upload CSV or Excel files to bulk import customer data"})]})}),r.jsx(H,{variant:"ghost",size:"sm",onClick:t,children:r.jsx(Ze,{className:"h-4 w-4"})})]}),s!=="upload"&&r.jsx("div",{className:"px-6 py-3 border-b border-gray-100 bg-gray-50",children:R()}),r.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[r.jsx(ht,{mode:"wait",children:b&&r.jsx(de.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(dt,{className:"h-5 w-5 text-red-500 mt-0.5 mr-3"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-red-800",children:"Error"}),r.jsx("p",{className:"text-red-700 text-sm mt-1",children:b})]})]})},"error")}),r.jsxs(ht,{mode:"wait",children:[s==="upload"&&r.jsx(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:$()},"upload"),s==="mapping"&&o&&r.jsx(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:r.jsx(pre,{analysisResult:o,onMappingComplete:T,onBack:()=>a("upload")})},"mapping"),s==="preview"&&r.jsx(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:r.jsx(fre,{file:i,columnMapping:d,onPreviewComplete:M,onBack:()=>a("mapping")})},"preview"),s==="importing"&&r.jsx(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:U()},"importing"),s==="complete"&&r.jsx(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:I()},"complete")]}),g&&s!=="importing"&&r.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center",children:r.jsx(Be,{className:"h-8 w-8 text-blue-500 animate-spin"})})]})]})})},xre=({wsConnection:e})=>{const{authFetch:t,isAuthenticated:n}=Qr(),{customers:s,customersLoading:a,customersError:i,refreshCustomers:l,addCustomer:o,deleteCustomer:c,employees:d,employeesLoading:u,analyticsInsights:m,insightsLoading:p,insightsError:f,refreshAnalytics:y,CRM_API_BASE_URL:g,loadCustomers:x,loadEmployees:b,isInitialized:v,hasInitialLoad:w}=xc(),{addNotification:N}=Vu(),[k,j]=xs("crm_active_tab","customer-management"),{searchTerm:S,searchColumns:_,setSearchTerm:C,setSearchColumns:D}=Rk("crm",{term:"",columns:{company:!0,primaryContact:!0,email:!0,industry:!0,phone:!1,status:!1,notes:!1}}),[A,E]=l3("crm",{status:"all",healthScore:"all",columnFilters:{}}),T=A.status,M=A.healthScore,L=A.columnFilters,P=De=>E(at=>({...at,columnFilters:De})),[$,R]=i3("crm",{company:!0,primaryContact:!0,email:!0,phone:!1,industry:!1,status:!0,churnRisk:!0,lifetimeValue:!1,expansionPotential:!1,lastContact:!1,assignedSalesman:!1}),[U,I]=xs("crm_ui_preferences",{showARR:!0,showFilters:!1,showSearch:!1});U.showARR;const z=U.showFilters;U.showSearch;const F=De=>I(at=>({...at,showFilters:De})),[O,K]=h.useState(null),[J,se]=h.useState(!1),[Z,oe]=h.useState(!1),[W,B]=h.useState(!1),[V,re]=h.useState(!1),[Me,he]=h.useState(!1),[G,q]=h.useState(!1),[Q,ue]=h.useState(!1),[Le,ge]=h.useState(!1),[Se,ce]=h.useState(!1),[ke,Pe]=h.useState(null),[qe,ne]=h.useState("overview"),[ye,Ee]=xs("crm_sort",{sortBy:"company",sortOrder:"asc"}),st=ye.sortBy,Ke=ye.sortOrder,[At,lt]=h.useState([]),[Ht,pt]=h.useState(!1),[be,ze]=h.useState(!1),[ee,X]=h.useState(""),[te,we]=h.useState({}),[Ne,nt]=h.useState(30),ie=le.useRef(null),xe=le.useRef(null),[Ie,Oe]=h.useState({to:"",subject:"",message:"",emailType:"cold_outreach",generatedEmail:null,editMode:!1,editedSubject:"",editedBody:""}),[Ue,$e]=h.useState(!1),[ot,fe]=h.useState(!1),[pe,je]=h.useState(null),[Fe,Y]=h.useState(null),[me,_e]=h.useState(!1),[Nt,Ft]=h.useState(!1);h.useEffect(()=>{const De=at=>{ie.current&&!ie.current.contains(at.target)&&ue(!1),xe.current&&!xe.current.contains(at.target)&&ge(!1)};return document.addEventListener("mousedown",De),()=>document.removeEventListener("mousedown",De)},[]),h.useEffect(()=>{!Nt&&v&&(console.log("Checking if CRM data needs initialization..."),Promise.all([x(!1),b(!1)]).then(()=>{Ft(!0),console.log("CRM data ready (from cache or fresh load)")}).catch(De=>{console.error("Error ensuring CRM data:",De),Ft(!0)}))},[Nt,v,x,b]);const rr=[{id:"customer-management",label:"Customer Management",icon:kt}],Yt=De=>d.find(at=>at.id===De),ft=(De,at)=>{R(wt=>({...wt,[De]:at}))},Ds=async()=>{m&&!f||y()},Ni=()=>{l()},fo=async De=>{re(!0);try{const at=await o(De);at.success?B(!1):console.error("Failed to add customer:",at.error)}catch(at){console.error("Error adding customer:",at)}finally{re(!1)}},ae=De=>{he(!1),l(),console.log("CSV import completed:",De)};h.useEffect(()=>{Z&&Ds()},[Z]);const Te=(De,at,wt)=>{if(De==null)return["is_empty"].includes(at);const Gt=String(De).toLowerCase(),kr=String(wt||"").toLowerCase();switch(at){case"contains":return Gt.includes(kr);case"equals":return Gt===kr;case"starts_with":return Gt.startsWith(kr);case"ends_with":return Gt.endsWith(kr);case"not_contains":return!Gt.includes(kr);case"not_equals":return Gt!==kr;case"is_empty":return!Gt||Gt.trim()==="";case"not_empty":return Gt&&Gt.trim()!=="";case"greater_than":return Number(De)>Number(wt);case"less_than":return Number(De)<Number(wt);case"greater_equal":return Number(De)>=Number(wt);case"less_equal":return Number(De)<=Number(wt);case"between":const[Wn,Nn]=wt.split(",").map(zs=>Number(zs.trim()));return Number(De)>=Wn&&Number(De)<=Nn;case"before":return new Date(De)<new Date(wt);case"after":return new Date(De)>new Date(wt);case"last_days":const Pn=new Date;return Pn.setDate(Pn.getDate()-Number(wt)),new Date(De)>=Pn;case"next_days":const Tr=new Date;return Tr.setDate(Tr.getDate()+Number(wt)),new Date(De)<=Tr;case"in":return wt.split(",").map(zs=>zs.trim().toLowerCase()).includes(Gt);case"not_in":return!wt.split(",").map(zs=>zs.trim().toLowerCase()).includes(Gt);default:return!0}},Ve=s.filter(De=>{const at=T==="all"||De.status===T,wt=M==="all"||M==="high"&&De.healthScore>=80||M==="medium"&&De.healthScore>=50&&De.healthScore<80||M==="low"&&De.healthScore<50;Yt(De.assignedEmployeeId);const Gt=(S||"").toLowerCase();let kr=!S;if(S){const Nn=[];_.company&&Nn.push(De.company||""),_.primaryContact&&Nn.push(De.primaryContact||""),_.email&&Nn.push(De.email||""),_.industry&&Nn.push(De.industry||""),_.phone&&Nn.push(De.phone||""),_.status&&Nn.push(De.status||""),_.notes&&Nn.push(De.notes||""),kr=Nn.some(Pn=>Pn.toLowerCase().includes(Gt))}let Wn=!0;return Object.keys(L).length>0&&(Wn=Object.entries(L).every(([Nn,Pn])=>{const Tr=De[Nn];return Pn.condition?Te(Tr,Pn.condition,Pn.value):!0})),at&&wt&&kr&&Wn});h.useMemo(()=>k!=="customer-management"||!Ve||Ve.length===0?[]:[...Ve].sort((De,at)=>{let wt="",Gt="";switch(st){case"company":wt=De.company||"",Gt=at.company||"";break;case"contact":wt=De.primaryContact||"",Gt=at.primaryContact||"";break;case"email":wt=De.email||"",Gt=at.email||"";break;case"lastInteraction":wt=De.lastContact||"",Gt=at.lastContact||"";break;case"healthScore":wt=De.healthScore||0,Gt=at.healthScore||0;break;case"dateAdded":wt=De.createdAt||"",Gt=at.createdAt||"";break;default:wt=De.company||"",Gt=at.company||""}if(typeof wt=="number"&&typeof Gt=="number")return Ke==="asc"?wt-Gt:Gt-wt;const kr=String(wt).localeCompare(String(Gt));return Ke==="asc"?kr:-kr}),[k,Ve,st,Ke]);const gt=async()=>{console.log(" [FRONTEND] handleEmailSync() called"),fe(!0),Y(null),je({status:"Starting sync...",percentage:0});try{console.log(" [FRONTEND] Step 1: Getting auth provider from localStorage...");const De=localStorage.getItem("auth_provider");if(console.log(" [FRONTEND] Auth provider:",De),!De)throw console.error(" [FRONTEND] No auth provider found"),new Error("Please log in with Google or Microsoft to enable email sync.");console.log(" [FRONTEND] Step 2: Getting access token from localStorage...");const at=De==="google"?"google":"microsoft",wt=localStorage.getItem(`${at}_access_token`),Gt=localStorage.getItem(`${at}_user_email`);if(console.log(" [FRONTEND] Token check:",{authProvider:De,providerKey:at,hasToken:!!wt,userEmail:Gt,tokenPreview:wt?`${wt.substring(0,10)}...`:null}),!wt||wt==="undefined"||wt==="null")throw console.error(" [FRONTEND] No valid access token found"),new Error(`Please log in with ${De==="google"?"Google":"Microsoft"} to enable email sync.`);if(!Gt)throw console.error(" [FRONTEND] No user email found"),new Error("Email address not available. Please log in again.");console.log(" [FRONTEND] Step 3: Determining provider and endpoint...");const kr=De==="google"?"gmail":"outlook";console.log(" [FRONTEND] Provider:",kr),je({status:`Connecting to ${kr==="gmail"?"Gmail":"Outlook"}...`,percentage:25}),console.log(" [FRONTEND] Step 4: Getting ID token for authentication...");const Wn=localStorage.getItem("id_token");if(console.log(" [FRONTEND] Authentication check:",{hasIdToken:!!Wn,idTokenValue:(Wn==null?void 0:Wn.substring(0,20))+"...",provider:kr,endpoint:`${g}/api/crm/${kr==="gmail"?"gmail/sync":"outlook/sync"}`}),!Wn){console.error(" [FRONTEND] No ID token found");const dr=!!localStorage.getItem("google_access_token"),tn=!!localStorage.getItem("outlook_access_token");throw dr||tn?new Error("You are connected to email but not logged into the main app. Please log in to Prelude first, then try syncing emails."):new Error("Not authenticated. Please log in to Prelude first.")}console.log(" [FRONTEND] Step 5: Preparing to call backend API..."),je({status:"Syncing emails...",percentage:50});const Pn=`${g}/api/crm/${kr==="gmail"?"gmail/sync":"outlook/sync"}`;console.log(" [FRONTEND] Making POST request to:",Pn),console.log(" [FRONTEND] Request body:",{access_token:wt?`${wt.substring(0,10)}...`:null,include_body:!0,include_sent:!0,include_received:!0});const Tr=await fetch(Pn,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Wn}`},body:JSON.stringify({access_token:wt,include_body:!0,include_sent:!0,include_received:!0})});if(console.log(" [FRONTEND] Response received:",{status:Tr.status,statusText:Tr.statusText,ok:Tr.ok}),Tr.ok){console.log(" [FRONTEND] Step 6: Parsing response JSON...");const dr=await Tr.json();if(console.log(" [FRONTEND] Response data:",dr),je({status:`Successfully synced ${dr.emails_synced||0} emails!`,percentage:100,complete:!0,emailsSynced:dr.emails_synced||0,totalEmails:dr.total_emails_synced||0}),_e(!0),console.log(" [FRONTEND] Email sync completed successfully!"),dr.emails_synced>0){const tn=kr==="gmail"?"Gmail":"Outlook";N("crm-sync",`Synced ${dr.emails_synced} new customer ${dr.emails_synced===1?"email":"emails"} from ${tn}`,{emailsSynced:dr.emails_synced,totalEmails:dr.total_emails_synced,provider:tn})}setTimeout(()=>{_e(!1),je(null)},5e3)}else{console.error(" [FRONTEND] Response not OK");let dr="Failed to sync emails";if(console.error("Email sync failed:",{status:Tr.status,statusText:Tr.statusText,headers:Object.fromEntries(Tr.headers.entries())}),Tr.status===404)dr="Gmail sync service not available. Please restart the CRM service.";else if(Tr.status===401)try{const tn=await Tr.json();if(console.error("401 Error details:",tn),tn.detail&&tn.detail.includes("Gmail access token expired"))dr=" Your Gmail access has expired. Please log out and log back in with Google to refresh your access.";else if(tn.detail&&tn.detail!=="Not authenticated")dr=tn.detail;else{const zs=!!localStorage.getItem("id_token"),Jm=!!localStorage.getItem("google_access_token")||!!localStorage.getItem("outlook_access_token");!zs&&Jm?dr="You need to log in to the main Prelude app first. After logging in, you can sync your emails.":zs?dr=" Your email access has expired. Please log out and log back in to refresh your access.":dr="Session expired. Please log in to Prelude again."}}catch(tn){console.error("Could not parse error response:",tn),dr=" Your email access has expired. Please log out and log back in to refresh your access."}else if(Tr.status===500)dr="Server error. Please try again later.";else try{dr=(await Tr.json()).detail||dr}catch{}throw new Error(dr)}}catch(De){console.error(" [FRONTEND] Error in handleEmailSync:",De),console.error(" [FRONTEND] Error message:",De.message),console.error(" [FRONTEND] Error stack:",De.stack),Y(De.message||"Error syncing emails"),je(null)}finally{console.log(" [FRONTEND] handleEmailSync() finished"),fe(!1),Fe&&setTimeout(()=>je(null),3e3)}},zt=()=>r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("div",{className:"flex items-center gap-3",children:r.jsxs("div",{className:"relative",ref:ie,children:[r.jsxs("button",{onClick:()=>ue(!Q),disabled:!n,className:"inline-flex items-center justify-center focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none active:scale-95 font-manrope h-10 bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Add Customers",tabIndex:"0",children:[r.jsx(Wt,{className:"w-4 h-4 mr-2"}),"Add Customers",r.jsx(Xt,{className:`w-4 h-4 ml-1 transition-transform ${Q?"rotate-180":""}`})]}),Q&&r.jsx("div",{className:"absolute top-full left-0 mt-2 w-56 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:r.jsxs("div",{className:"py-1",children:[r.jsxs("button",{onClick:()=>{re(!0),ue(!1)},disabled:V,className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-pink-50 hover:text-pink-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(Wt,{className:"w-4 h-4"}),r.jsx("span",{className:"font-medium",children:"Add Customer"})]}),r.jsxs("button",{onClick:()=>{he(!0),ue(!1)},className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-pink-50 hover:text-pink-700 transition-colors",children:[r.jsx(vs,{className:"w-4 h-4"}),r.jsx("span",{className:"font-medium",children:"Upload CSV"})]})]})})]})}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(jx,{value:S,onChange:C,onClear:()=>C(""),searchColumns:_,onColumnChange:D,availableColumns:[{key:"company",label:"Company",icon:qt},{key:"primaryContact",label:"Contact",icon:_t},{key:"email",label:"Email",icon:Dt},{key:"phone",label:"Phone",icon:sn},{key:"industry",label:"Industry",icon:_n},{key:"status",label:"Status",icon:Ot},{key:"notes",label:"Notes",icon:Ut}],placeholder:"Search customers..."}),r.jsx(wx,{columns:[{id:"company",label:"Company",type:"text"},{id:"primaryContact",label:"Contact",type:"text"},{id:"email",label:"Email",type:"email"},{id:"phone",label:"Phone",type:"tel"},{id:"industry",label:"Industry",type:"text"},{id:"churnRisk",label:"Churn Risk",type:"select",options:[{value:"low",label:"Active (Low Risk)"},{value:"medium",label:"Active (Medium Risk)"},{value:"high",label:"Inactive (High Risk)"},{value:"declining",label:"Declining"}]},{id:"lifetimeValue",label:"Lifetime Value",type:"currency"},{id:"expansionPotential",label:"Upsell Potential",type:"select",options:[{value:"very low",label:"Very Low"},{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"},{value:"very high",label:"Very High"}]},{id:"lastContact",label:"Last Contacted",type:"date"}],onApplyFilters:P,activeFilters:L}),r.jsxs("div",{className:"relative",ref:xe,children:[r.jsx("button",{onClick:()=>ge(!Le),className:"inline-flex items-center justify-center font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none active:scale-95 font-inter text-xs h-8 w-8 p-0 rounded-lg transition-all duration-200 text-gray-500 hover:bg-pink-50 hover:text-pink-600 active:bg-pink-100",title:"More options","aria-label":"More Options",tabIndex:"0",children:r.jsx(nx,{className:"w-5 h-5"})}),Le&&r.jsx("div",{className:"absolute top-full right-0 mt-2 w-64 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-[500px] overflow-y-auto",children:r.jsxs("div",{className:"py-1",children:[r.jsxs("button",{onClick:()=>{gt(),ge(!1)},disabled:ot,className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-pink-50 hover:text-pink-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(Dt,{className:"w-4 h-4"}),r.jsx("span",{className:"font-medium",children:ot?"Syncing Emails...":"Sync Emails"})]}),r.jsxs("button",{onClick:()=>{Ni(),ge(!1)},disabled:a,className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-pink-50 hover:text-pink-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(Be,{className:`w-4 h-4 ${a?"animate-spin":""}`}),r.jsx("span",{className:"font-medium",children:a?"Refreshing...":"Refresh Data"})]}),r.jsx("div",{className:"border-t border-gray-200 my-1"}),r.jsxs("div",{className:"px-4 py-2",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-xs font-semibold text-gray-500 uppercase",children:"Select Columns"}),r.jsxs("span",{className:"text-xs text-gray-500",children:[Object.values($).filter(Boolean).length,"/",[{id:"company",label:"Company",icon:qt,disabled:!0},{id:"primaryContact",label:"Contact",icon:_t},{id:"email",label:"Email",icon:Dt},{id:"phone",label:"Phone",icon:sn},{id:"industry",label:"Industry",icon:_n},{id:"churnRisk",label:"Churn Risk",icon:Ot},{id:"lifetimeValue",label:"Lifetime Value",icon:Ur},{id:"expansionPotential",label:"Upsell Potential",icon:Ot},{id:"lastContact",label:"Last Contacted",icon:jt},{id:"assignedSalesman",label:"Assigned Salesman",icon:_t}].length]})]}),r.jsx("div",{className:"space-y-1",children:[{id:"company",label:"Company",icon:qt,disabled:!0},{id:"primaryContact",label:"Contact",icon:_t},{id:"email",label:"Email",icon:Dt},{id:"phone",label:"Phone",icon:sn},{id:"industry",label:"Industry",icon:_n},{id:"churnRisk",label:"Churn Risk",icon:Ot},{id:"lifetimeValue",label:"Lifetime Value",icon:Ur},{id:"expansionPotential",label:"Upsell Potential",icon:Ot},{id:"lastContact",label:"Last Contacted",icon:jt},{id:"assignedSalesman",label:"Assigned Salesman",icon:_t}].map(De=>{const at=De.icon;return r.jsxs("label",{className:`flex items-center gap-2 px-2 py-1.5 rounded transition-colors ${De.disabled?"cursor-not-allowed opacity-60":"hover:bg-pink-50 cursor-pointer"}`,children:[r.jsx("input",{type:"checkbox",checked:$[De.id]!==!1,onChange:()=>{De.disabled||ft(De.id,!$[De.id])},disabled:De.disabled,className:"w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500"}),r.jsx(at,{className:"w-4 h-4 text-gray-500"}),r.jsxs("span",{className:"text-sm text-gray-700 flex-1",children:[De.label,De.disabled&&r.jsx("span",{className:"text-xs text-gray-400 ml-1",children:"(Required)"})]})]},De.id)})})]})]})})]})]})]}),pe&&r.jsxs("div",{className:`mb-4 rounded-lg p-4 ${pe.complete?"bg-green-50 border border-green-200":"bg-blue-50 border border-blue-200"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[pe.complete?r.jsx(bt,{className:"w-5 h-5 text-green-600"}):r.jsx(Be,{className:"w-5 h-5 text-blue-600 animate-spin"}),r.jsx("span",{className:`text-sm font-medium ${pe.complete?"text-green-700":"text-blue-700"}`,children:pe.status})]}),!pe.complete&&r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:r.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-500",style:{width:`${pe.percentage}%`}})}),pe.complete&&pe.emailsSynced!==void 0&&r.jsxs("div",{className:"text-sm text-green-600 mt-2",children:[pe.emailsSynced," new emails synced  Total: ",pe.totalEmails," emails"]})]}),Fe&&r.jsxs("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-700 p-3 rounded-lg flex items-center gap-2",children:[r.jsx(AlertCircle,{className:"w-4 h-4"}),r.jsx("span",{className:"text-sm",children:Fe}),r.jsx("button",{onClick:()=>Y(null),className:"ml-auto text-red-500 hover:text-red-700",children:r.jsx(Ze,{className:"w-4 h-4"})})]}),r.jsx("div",{className:"flex-1 min-h-[600px] overflow-hidden",children:r.jsx("div",{className:"h-full flex flex-col",children:r.jsx(hre,{searchTerm:S,setSearchTerm:C,searchColumns:_,isAddingCustomer:V,setIsAddingCustomer:re,showFilters:z,setShowFilters:F,columnFilters:L,setColumnFilters:P,visibleColumns:$,onColumnToggle:ft})})}),r.jsx(MT,{customer:ke,isOpen:Se,onClose:()=>ce(!1),onCustomerDeleted:De=>{console.log("Customer deleted:",De)}})]}),Mt=()=>{switch(k){case"customer-management":return zt();default:return zt()}};return a&&!w?r.jsx("div",{className:"p-6",children:r.jsxs("div",{className:"animate-pulse space-y-4",children:[r.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),r.jsx("div",{className:"grid grid-cols-4 gap-4",children:[1,2,3,4].map(De=>r.jsx("div",{className:"h-24 bg-gray-200 rounded"},De))}),r.jsx("div",{className:"grid grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(De=>r.jsx("div",{className:"h-80 bg-gray-200 rounded"},De))})]})}):(s.reduce((De,at)=>De+at.contractValue,0),s.length>0&&Math.round(s.reduce((De,at)=>De+at.healthScore,0)/s.length),s.filter(De=>De.churnRisk==="high").length,s.filter(De=>De.status==="expansion-opportunity").length,r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx(ri,{title:"Customer Relations",themeColor:"pink",tabs:rr.map(De=>({id:De.id,label:De.label,icon:De.icon,isActive:k===De.id,onClick:()=>j(De.id)}))}),r.jsx("div",{className:"flex-1 overflow-hidden",children:r.jsx("div",{className:"h-full p-4 overflow-y-auto",style:{minHeight:"700px"},children:r.jsx(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:Mt()})})}),W&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6",children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("h2",{className:"text-xl font-bold",children:"Add New Customer"}),r.jsx("button",{onClick:()=>B(!1),className:"text-gray-400 hover:text-gray-600",children:r.jsx(Ze,{className:"w-6 h-6"})})]}),r.jsxs("form",{onSubmit:De=>{De.preventDefault();const at=new FormData(De.target),wt={name:at.get("name"),primary_contact:at.get("primary_contact"),email:at.get("email"),phone:at.get("phone"),industry:at.get("industry"),location:at.get("location"),status:at.get("status"),client_type:at.get("client_type"),notes:at.get("notes"),contract_value:parseFloat(at.get("contract_value"))||0,monthly_value:parseFloat(at.get("monthly_value"))||0,health_score:parseFloat(at.get("health_score"))||75,satisfaction_score:parseFloat(at.get("satisfaction_score"))||80,churn_risk:at.get("churn_risk"),expansion_potential:at.get("expansion_potential"),current_stage:at.get("current_stage"),renewal_date:at.get("renewal_date")||null,contact_birthday:at.get("contact_birthday")||null};fo(wt)},className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name *"}),r.jsx("input",{type:"text",name:"name",required:!0,className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Enter company name"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Primary Contact *"}),r.jsx("input",{type:"text",name:"primary_contact",required:!0,className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Enter contact name"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),r.jsx("input",{type:"email",name:"email",required:!0,className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Enter email address"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),r.jsx("input",{type:"tel",name:"phone",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Enter phone number"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Industry"}),r.jsxs("select",{name:"industry",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500",children:[r.jsx("option",{value:"Business",children:"Business"}),r.jsx("option",{value:"Technology",children:"Technology"}),r.jsx("option",{value:"Healthcare",children:"Healthcare"}),r.jsx("option",{value:"Finance",children:"Finance"}),r.jsx("option",{value:"Education",children:"Education"}),r.jsx("option",{value:"Manufacturing",children:"Manufacturing"}),r.jsx("option",{value:"Retail",children:"Retail"}),r.jsx("option",{value:"Other",children:"Other"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Location"}),r.jsx("input",{type:"text",name:"location",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Enter location"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),r.jsxs("select",{name:"status",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500",children:[r.jsx("option",{value:"active",children:"Active"}),r.jsx("option",{value:"prospect",children:"Prospect"}),r.jsx("option",{value:"at-risk",children:"At Risk"}),r.jsx("option",{value:"inactive",children:"Inactive"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Client Type"}),r.jsxs("select",{name:"client_type",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500",children:[r.jsx("option",{value:"lead",children:"Lead"}),r.jsx("option",{value:"customer",children:"Customer"})]})]})]}),r.jsxs("div",{className:"border-t pt-4",children:[r.jsx("h3",{className:"text-lg font-medium mb-3",children:"Financial Information"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contract Value ($)"}),r.jsx("input",{type:"number",name:"contract_value",min:"0",step:"0.01",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"0.00"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Monthly Value ($)"}),r.jsx("input",{type:"number",name:"monthly_value",min:"0",step:"0.01",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"0.00"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Renewal Date"}),r.jsx("input",{type:"date",name:"renewal_date",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]})]}),r.jsxs("div",{className:"border-t pt-4",children:[r.jsx("h3",{className:"text-lg font-medium mb-3",children:"Customer Metrics"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Health Score (0-100)"}),r.jsx("input",{type:"number",name:"health_score",min:"0",max:"100",defaultValue:"75",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Satisfaction Score (0-100)"}),r.jsx("input",{type:"number",name:"satisfaction_score",min:"0",max:"100",step:"1",defaultValue:"80",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Churn Risk"}),r.jsxs("select",{name:"churn_risk",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500",children:[r.jsx("option",{value:"low",children:"Low"}),r.jsx("option",{value:"medium",children:"Medium"}),r.jsx("option",{value:"high",children:"High"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expansion Potential"}),r.jsxs("select",{name:"expansion_potential",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500",children:[r.jsx("option",{value:"very low",children:"Very Low"}),r.jsx("option",{value:"low",children:"Low"}),r.jsx("option",{value:"medium",children:"Medium"}),r.jsx("option",{value:"high",children:"High"}),r.jsx("option",{value:"very high",children:"Very High"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Current Stage"}),r.jsxs("select",{name:"current_stage",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500",children:[r.jsx("option",{value:"prospect",children:"Prospect"}),r.jsx("option",{value:"qualified",children:"Qualified"}),r.jsx("option",{value:"proposal",children:"Proposal"}),r.jsx("option",{value:"negotiation",children:"Negotiation"}),r.jsx("option",{value:"closed-won",children:"Closed Won"}),r.jsx("option",{value:"closed-lost",children:"Closed Lost"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contact Birthday"}),r.jsx("input",{type:"date",name:"contact_birthday",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]})]}),r.jsxs("div",{className:"border-t pt-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),r.jsx("textarea",{name:"notes",rows:"3",className:"w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Enter any additional notes about the customer"})]}),r.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[r.jsx(H,{type:"button",onClick:()=>B(!1),className:"bg-gray-300 hover:bg-gray-400 text-gray-700",children:"Cancel"}),r.jsx(H,{type:"submit",disabled:V,className:"bg-purple-600 hover:bg-purple-700 text-white",children:V?r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"w-4 h-4 mr-2 animate-spin"}),"Adding..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Wt,{className:"w-4 h-4 mr-2"}),"Add Customer"]})})]})]})]})}),r.jsx(mre,{isOpen:Z,onClose:()=>oe(!1)}),Me&&r.jsx(gre,{onImportComplete:ae,onClose:()=>he(!1)}),me&&(pe==null?void 0:pe.complete)&&r.jsx("div",{className:"fixed top-4 right-4 z-50",children:r.jsxs(de.div,{initial:{opacity:0,x:100,scale:.9},animate:{opacity:1,x:0,scale:1},exit:{opacity:0,x:100,scale:.9},className:"bg-green-500 text-white p-4 rounded-lg shadow-lg flex items-center gap-3 max-w-md",children:[r.jsx(bt,{className:"w-6 h-6 text-green-100"}),r.jsxs("div",{children:[r.jsx("div",{className:"font-medium",children:"Email Sync Complete!"}),r.jsxs("div",{className:"text-sm text-green-100",children:["Successfully synced ",pe.emailsSynced," new emails"]})]}),r.jsx("button",{onClick:()=>_e(!1),className:"ml-auto text-green-100 hover:text-white",children:r.jsx(Ze,{className:"w-4 h-4"})})]})})]}))},yre=({wsConnection:e})=>r.jsx(xre,{wsConnection:e}),bre=({isOpen:e,onClose:t,deal:n,onActivityAdded:s,authFetch:a,initialActivityType:i="note"})=>{const u="http://localhost:8003",[m,p]=h.useState(i),[f,y]=h.useState(""),[g,x]=h.useState(""),[b,v]=h.useState(!1),[w,N]=h.useState(!1),[k,j]=h.useState(""),[S,_]=h.useState(""),[C,D]=h.useState(""),[A,E]=h.useState(""),[T,M]=h.useState(""),[L,P]=h.useState(""),[$,R]=h.useState(""),[U,I]=h.useState(""),[z,F]=h.useState(""),[O,K]=h.useState(""),[J,se]=h.useState([]),[Z,oe]=h.useState([]),[W,B]=h.useState(null),[V,re]=h.useState(0);h.useEffect(()=>{const Q=localStorage.getItem("google_calendar_access_token")||localStorage.getItem("google_access_token");B(Q)},[]),h.useEffect(()=>{if(n&&J.length>0){const Q=J.filter(ue=>ue.customer_id===n.client_id);console.log(`[Add Activity Calendar] Filtered ${Q.length} meetings for client ${n.client_id}`),oe(Q)}else oe([])},[J,n]),h.useEffect(()=>{e?p(i):(y(""),x(""),v(!1),D(""),E(""),M(""),P(""),R(""),I(""),F(""),K(""),j(""),_(""))},[e,i]),h.useEffect(()=>{if(k||S){const Q=setTimeout(()=>{j(""),_("")},3e3);return()=>clearTimeout(Q)}},[k,S]),h.useEffect(()=>{const Q=ue=>{ue.key==="Escape"&&!w&&t()};return e&&document.addEventListener("keydown",Q),()=>{document.removeEventListener("keydown",Q)}},[e,w,t]);const Me=async()=>{if(!g.trim()){j("Note content cannot be empty");return}N(!0),j("");try{const Q=await a(`${u}/api/crm/deals/${n.deal_id}/notes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:f.trim(),body:g.trim(),star:b?"important":null})});if(Q.ok)_("Note added successfully!"),setTimeout(()=>{t(),s&&s()},1e3);else{const ue=await Q.json();j(ue.detail||"Failed to add note")}}catch{j("Network error. Please try again.")}finally{N(!1)}},he=async()=>{if(!C.trim()){j("Call summary cannot be empty");return}N(!0),j("");try{const Q=await a(`${u}/api/crm/deals/${n.deal_id}/call-summaries`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:C.trim(),theme:A.trim()||null})});if(Q.ok)_("Call summary added successfully!"),setTimeout(()=>{t(),s&&s()},1e3);else{const ue=await Q.json();j(ue.detail||"Failed to add call summary")}}catch{j("Network error. Please try again.")}finally{N(!1)}},G=async()=>{if(!T.trim()||!$||!U||!z){j("Please fill in all required meeting fields");return}N(!0),j("");try{const Q=`${$}T${U}:00`,ue=`${$}T${z}:00`,Le=await a(`${u}/api/crm/deals/${n.deal_id}/meetings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:T.trim(),description:L.trim()||null,start_time:Q,end_time:ue,location:O.trim()||null,attendees:[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone})});if(Le.ok)_("Meeting added successfully!"),setTimeout(()=>{t(),s&&s()},1e3);else{const ge=await Le.json();j(ge.detail||"Failed to add meeting")}}catch{j("Network error. Please try again.")}finally{N(!1)}};if(!e)return null;const q=[{key:"note",label:"Add Note",icon:Ut},{key:"meeting",label:"Schedule Meeting",icon:yt},{key:"callSummary",label:"Add Call Summary",icon:si}];return e?r.jsx(ht,{children:e&&r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex justify-center p-8",onClick:t,children:r.jsxs(de.div,{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},className:"w-full bg-white rounded-lg shadow-2xl relative max-h-full flex flex-col",onClick:Q=>Q.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between pt-5 pb-3 px-6 border-b border-gray-200 flex-shrink-0",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Add Activity"}),r.jsx(H,{variant:"ghost",size:"icon",onClick:t,disabled:w,children:r.jsx(Ze,{className:"w-5 h-5 text-gray-500"})})]}),r.jsx("div",{className:"border-b border-gray-200 flex-shrink-0 px-6",children:r.jsx("div",{className:"flex gap-2",children:q.map(({key:Q,label:ue,icon:Le})=>r.jsxs("button",{onClick:()=>p(Q),className:`flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors ${m===Q?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700"}`,disabled:w,children:[r.jsx(Le,{className:"w-4 h-4"}),ue]},Q))})}),r.jsxs("div",{className:"flex-1 overflow-y-auto py-6 px-6 bg-gray-50",children:[S&&r.jsx("div",{className:"mb-4 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg text-sm",children:S}),k&&r.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:k}),m==="note"&&r.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Note Title ",r.jsx("span",{className:"text-gray-400",children:"(Optional)"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:"text",value:f,onChange:Q=>y(Q.target.value),placeholder:"Enter note title...",className:"w-full px-4 py-3 pr-20 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm",maxLength:200,disabled:w}),r.jsxs("div",{className:"absolute bottom-3 right-3 text-xs text-gray-400",children:[f.length,"/",200]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Note Content ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("textarea",{value:g,onChange:Q=>x(Q.target.value),placeholder:"Add your note...",className:"w-full h-48 px-4 py-3 pr-20 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm",maxLength:2e3,disabled:w}),r.jsxs("div",{className:"absolute bottom-3 right-3 text-xs text-gray-400",children:[g.length,"/",2e3]})]})]}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs("button",{type:"button",onClick:()=>v(!b),className:`flex items-center gap-2 px-3 py-2 rounded-lg border transition-colors ${b?"bg-yellow-50 border-yellow-300 text-yellow-700":"bg-gray-50 border-gray-300 text-gray-600 hover:bg-gray-100"}`,disabled:w,children:[r.jsx(on,{className:`w-4 h-4 ${b?"fill-yellow-500 text-yellow-500":""}`}),b?"Important":"Mark as Important"]})}),r.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[r.jsx(H,{onClick:t,variant:"outline",disabled:w,children:"Cancel"}),r.jsx(H,{onClick:Me,disabled:w||!g.trim(),className:"bg-indigo-600 hover:bg-indigo-700 text-white",children:w?r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Xr,{className:"w-4 h-4 mr-2"}),"Save Note"]})})]})]})}),m==="callSummary"&&r.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Call Theme ",r.jsx("span",{className:"text-gray-400",children:"(Optional)"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:"text",value:A,onChange:Q=>E(Q.target.value),placeholder:"e.g., Product Demo, Follow-up, Negotiation...",className:"w-full px-4 py-3 pr-20 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm",maxLength:50,disabled:w}),r.jsxs("div",{className:"absolute bottom-3 right-3 text-xs text-gray-400",children:[A.length,"/",50]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Call Summary ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx("textarea",{value:C,onChange:Q=>D(Q.target.value),placeholder:"Summarize the call discussion, key points, and outcomes...",className:"w-full h-64 px-4 py-3 pr-20 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm",maxLength:5e3,disabled:w}),r.jsxs("div",{className:"absolute bottom-3 right-3 text-xs text-gray-400",children:[C.length,"/",5e3]})]})]}),r.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[r.jsx(H,{onClick:t,variant:"outline",disabled:w,children:"Cancel"}),r.jsx(H,{onClick:he,disabled:w||!C.trim(),className:"bg-indigo-600 hover:bg-indigo-700 text-white",children:w?r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Xr,{className:"w-4 h-4 mr-2"}),"Save Call Summary"]})})]})]})}),m==="meeting"&&r.jsxs("div",{className:"flex h-full gap-4 bg-gray-50",children:[r.jsx("div",{className:"w-[30%] bg-white rounded-lg border border-gray-200 p-6 overflow-y-auto",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Meeting Title ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",value:T,onChange:Q=>M(Q.target.value),placeholder:"Enter meeting title...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm",disabled:w})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Description ",r.jsx("span",{className:"text-gray-400",children:"(Optional)"})]}),r.jsx("textarea",{value:L,onChange:Q=>P(Q.target.value),placeholder:"Add meeting description...",className:"w-full h-24 px-4 py-3 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm",disabled:w})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Date ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx(yt,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),r.jsx("input",{type:"date",value:$,onChange:Q=>R(Q.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",disabled:w})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Start Time ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx(jt,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),r.jsx("input",{type:"time",value:U,onChange:Q=>I(Q.target.value),placeholder:"HH:MM",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",disabled:w,title:"Enter time in HH:MM format or use picker"})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["End Time ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"relative",children:[r.jsx(jt,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),r.jsx("input",{type:"time",value:z,onChange:Q=>F(Q.target.value),placeholder:"HH:MM",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",disabled:w,title:"Enter time in HH:MM format or use picker"})]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Location ",r.jsx("span",{className:"text-gray-400",children:"(Optional)"})]}),r.jsx("input",{type:"text",value:O,onChange:Q=>K(Q.target.value),placeholder:"e.g., Conference Room A, Zoom, Google Meet...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm",disabled:w})]}),r.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[r.jsx(H,{onClick:t,variant:"outline",disabled:w,children:"Cancel"}),r.jsx(H,{onClick:G,disabled:w||!T.trim()||!$||!U||!z,className:"bg-indigo-600 hover:bg-indigo-700 text-white",children:w?r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Xr,{className:"w-4 h-4 mr-2"}),"Schedule Meeting"]})})]})]})}),r.jsxs("div",{className:"w-[70%] bg-white rounded-lg border border-gray-200 p-6 overflow-y-auto",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2 mb-4",children:[r.jsx(yt,{className:"w-4 h-4 text-indigo-600"}),"Meeting Calendar",n&&r.jsxs("span",{className:"text-xs text-gray-500 font-normal",children:["(",Z.length," ",Z.length===1?"meeting":"meetings",")"]})]}),r.jsx("div",{className:"flex-1 overflow-hidden",children:r.jsx(AT,{customer:n?{customer_id:n.client_id,name:n.client_name,email:n.client_email}:null,authFetch:a,googleAccessToken:W,onDateSelect:Q=>{Q&&R(Q)},onTimeSlotSelect:Q=>{Q!=null&&Q.start&&(Q!=null&&Q.end)&&(I(Q.start),F(Q.end))},refreshTrigger:V,events:Z,setEvents:se})})]})]})]})]})})}):null},vre=({deal:e,authFetch:t,onActivityAdded:n,expandedPanel:s,setExpandedPanel:a,handleEventClick:i,notes:l=[],isDeletingNote:o,handleDeleteNote:c,onCallDeleted:d})=>{const u="http://localhost:8003",[m,p]=h.useState({notes:[],interactions:[],timeline:[]}),[f,y]=h.useState(!1),[g,x]=h.useState(!1),[b,v]=h.useState(!1),[w,N]=h.useState("note"),[k,j]=h.useState("all"),[S,_]=h.useState(""),[C,D]=h.useState(!1),A=h.useRef(null),E=h.useRef(null);h.useEffect(()=>{const B=V=>{A.current&&!A.current.contains(V.target)&&v(!1)};return b&&document.addEventListener("mousedown",B),()=>{document.removeEventListener("mousedown",B)}},[b]),h.useEffect(()=>{const B=V=>{E.current&&!E.current.contains(V.target)&&D(!1)};return C&&document.addEventListener("mousedown",B),()=>{document.removeEventListener("mousedown",B)}},[C]),h.useEffect(()=>{e!=null&&e.deal_id&&T()},[e==null?void 0:e.deal_id]);const T=async()=>{if(e!=null&&e.deal_id){y(!0);try{const B=await t(`${u}/api/crm/deals/${e.deal_id}/activities`);if(B.ok){const V=await B.json();p(V)}}catch(B){console.error("Error loading deal activities:",B)}finally{y(!1)}}},M=async()=>{await T(),n&&n()},L=B=>{N(B),v(!1),x(!0)},P=()=>["email","call","meeting"].includes(k),$=()=>{let B=m.timeline||[];if(k!=="all"&&(B=B.filter(V=>k==="notes"?V.activity_type==="note":k==="email"?V.activity_type==="email":k==="calls"?V.activity_type==="call":k==="meetings"?V.activity_type==="meet":!0)),S.trim()){const V=S.toLowerCase();B=B.filter(re=>{var Q,ue,Le,ge;const Me=((Q=re.title)==null?void 0:Q.toLowerCase())||"",he=((ue=re.body)==null?void 0:ue.toLowerCase())||"",G=((Le=re.content)==null?void 0:Le.toLowerCase())||"",q=((ge=re.theme)==null?void 0:ge.toLowerCase())||"";return Me.includes(V)||he.includes(V)||G.includes(V)||q.includes(V)})}return B},R=B=>{if(!B)return"N/A";const V=new Date(B);return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(V)},U=B=>{switch(B){case"note":return{icon:Ut,bgColor:"bg-blue-100",textColor:"text-blue-600"};case"call":return{icon:si,bgColor:"bg-green-100",textColor:"text-green-600"};case"meeting":case"meet":return{icon:yt,bgColor:"bg-purple-100",textColor:"text-purple-600"};case"email":return{icon:Dt,bgColor:"bg-blue-100",textColor:"text-blue-600"};default:return{icon:Ut,bgColor:"bg-gray-100",textColor:"text-gray-600"}}},I=(B,V)=>{if(B.activity_type==="meeting"||B.activity_type==="meet")return null;const Me=Math.floor((new Date-V)/(1e3*60*60*24));return Me<0?{text:"Upcoming",color:"bg-blue-100 text-blue-800"}:Me===0?{text:"Today",color:"bg-green-100 text-green-800"}:Me<=7?{text:"Recent",color:"bg-green-100 text-green-800"}:null},z=B=>B==="important"?"Important":"",[F,O]=h.useState(!1),[K,J]=h.useState(null),[se,Z]=h.useState(!1),oe=async()=>{if(K){Z(!0);try{K.type==="note"?c&&await c(K.id):K.type==="call"&&(await t(`${u}/api/crm/deals/${e.deal_id}/call-summaries/${K.id}`,{method:"DELETE"})).ok&&d&&await d(K.id),O(!1),J(null),await T()}catch(B){console.error("Error deleting:",B)}finally{Z(!1)}}},W=$();return r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 h-full flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6 flex-shrink-0",children:[r.jsxs("h3",{className:"text-lg font-bold text-black font-[Inter] flex items-center gap-2",children:[r.jsx(Ot,{className:"w-5 h-5 text-indigo-600"}),"Activity & Notes",f&&r.jsx(Be,{className:"w-4 h-4 animate-spin"})]}),r.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[r.jsxs("div",{className:"relative",ref:A,children:[r.jsxs("button",{onClick:()=>v(!b),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-medium transition-colors whitespace-nowrap",children:[r.jsx(Wt,{className:"w-4 h-4"}),"Add Activity",r.jsx(Xt,{className:"w-4 h-4"})]}),b&&r.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[r.jsxs("button",{onClick:()=>L("meeting"),className:"w-full flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors",children:[r.jsx(yt,{className:"w-4 h-4 text-purple-600"}),"Schedule Meeting"]}),r.jsxs("button",{onClick:()=>L("note"),className:"w-full flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors",children:[r.jsx(Ut,{className:"w-4 h-4 text-blue-600"}),"Add Note"]}),r.jsxs("button",{onClick:()=>L("callSummary"),className:"w-full flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors",children:[r.jsx(si,{className:"w-4 h-4 text-green-600"}),"Add Call Summary"]})]})]}),a&&r.jsx("button",{onClick:()=>a(s==="activity"?null:"activity"),className:"text-gray-500 hover:text-gray-700 transition-colors p-1 hover:bg-gray-100 rounded flex-shrink-0",title:s==="activity"?"Collapse":"Expand",children:s==="activity"?r.jsx(La,{className:"w-5 h-5"}):r.jsx(Xt,{className:"w-5 h-5"})})]})]}),(!s||s!=="summary")&&r.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6 flex-shrink-0",children:[r.jsxs("div",{className:"flex gap-2 items-center flex-wrap",children:[r.jsxs("button",{onClick:()=>j("all"),className:`h-7 px-3 py-1.5 text-xs font-medium rounded-full flex items-center gap-1.5 transition-colors ${k==="all"?"bg-indigo-100 text-indigo-700 border border-indigo-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[r.jsx(da,{className:"w-3 h-3"}),"All"]}),r.jsxs("div",{className:"relative",ref:E,children:[r.jsxs("button",{onClick:()=>D(!C),className:`h-7 px-3 py-1.5 text-xs font-medium rounded-full flex items-center gap-1.5 transition-colors ${P()?"bg-indigo-100 text-indigo-700 border border-indigo-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[r.jsx(Bn,{className:"w-3 h-3"}),"Communication",r.jsx(Xt,{className:"w-3 h-3"})]}),C&&r.jsxs("div",{className:"absolute top-full left-0 mt-1 w-40 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50",children:[r.jsxs("button",{onClick:()=>{j("email"),D(!1)},className:`w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-50 transition-colors ${k==="email"?"bg-blue-50 text-blue-700":"text-gray-700"}`,children:[r.jsx(Dt,{className:"w-4 h-4 text-blue-600"}),"Email"]}),r.jsxs("button",{onClick:()=>{j("calls"),D(!1)},className:`w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-50 transition-colors ${k==="calls"?"bg-green-50 text-green-700":"text-gray-700"}`,children:[r.jsx(si,{className:"w-4 h-4 text-green-600"}),"Call"]}),r.jsxs("button",{onClick:()=>{j("meetings"),D(!1)},className:`w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-50 transition-colors ${k==="meetings"?"bg-purple-50 text-purple-700":"text-gray-700"}`,children:[r.jsx(yt,{className:"w-4 h-4 text-purple-600"}),"Meeting"]})]})]}),r.jsxs("button",{onClick:()=>j("notes"),className:`h-7 px-3 py-1.5 text-xs font-medium rounded-full flex items-center gap-1.5 transition-colors ${k==="notes"?"bg-indigo-100 text-indigo-700 border border-indigo-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[r.jsx(Ut,{className:"w-3 h-3"}),"Notes"]})]}),r.jsxs("div",{className:"flex-1 relative min-w-[200px]",children:[r.jsx(zn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search activities...",value:S,onChange:B=>_(B.target.value),className:"w-full pl-10 pr-4 py-1.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),r.jsx("div",{className:"space-y-3 flex-1 overflow-y-auto",children:f?r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx(Be,{className:"w-6 h-6 animate-spin mx-auto mb-2"}),"Loading activities..."]}):W.length===0?r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx(Ut,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),r.jsx("p",{className:"text-sm",children:"No activities found for this deal"}),r.jsx("p",{className:"text-xs text-gray-400 mt-1",children:'Click "Add Activity" to create one'})]}):W.map((B,V)=>{const re=new Date(B.created_at),Me=I(B,re),he=U(B.activity_type),G=he.icon,q=B.activity_type==="note",Q=B.activity_type==="call";return r.jsxs(de.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:`bg-white border rounded-lg p-4 transition-all group relative ${q&&B.star==="important"?"border-yellow-200 bg-yellow-50 hover:shadow-md":"border-gray-200 hover:shadow-md"}`,children:[(q||Q)&&r.jsx("button",{onClick:ue=>{if(ue.stopPropagation(),q)J({type:"note",id:B.note_id}),O(!0);else if(Q){const Le=B.interaction_id;Le&&(J({type:"call",id:Le}),O(!0))}},disabled:o===B.note_id,className:"absolute top-2 right-2 p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors opacity-0 group-hover:opacity-100",title:"Delete",children:o===B.note_id?r.jsx(Be,{className:"w-4 h-4 animate-spin"}):r.jsx(fr,{className:"w-4 h-4"})}),r.jsxs("div",{className:"flex gap-4",onClick:()=>i&&i(B),children:[r.jsx("div",{className:`flex-shrink-0 w-10 h-10 ${he.bgColor} rounded-lg flex items-center justify-center`,children:r.jsx(G,{className:`w-5 h-5 ${he.textColor}`})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-900 group-hover:text-indigo-600 transition-colors",children:B.activity_type==="email"?B.theme||B.subject||(B.content?B.content.substring(0,50)+(B.content.length>50?"...":""):"No subject"):B.title||B.theme||`${B.activity_type==="note"?"Note":B.activity_type==="call"?"Call":"Meeting"}`}),q&&B.star==="important"&&r.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 bg-yellow-100 text-yellow-800 rounded-full text-xs flex-shrink-0",children:[r.jsx(on,{className:"w-2.5 h-2.5 fill-yellow-400 text-yellow-400"}),z(B.star)]})]}),!q&&Me&&r.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full flex-shrink-0 ${Me.color}`,children:Me.text})]}),r.jsxs("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:[B.activity_type==="note"&&B.body,B.activity_type==="call"&&B.content,B.activity_type==="email"&&(B.content||""),(B.activity_type==="meet"||B.activity_type==="meeting")&&B.description]}),r.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(_t,{className:"w-3 h-3"}),B.employee_name||"Unknown"]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(jt,{className:"w-3 h-3"}),R(B.created_at)]})]})]})]})]},`${B.activity_type}-${B.note_id||B.interaction_id}-${V}`)})}),r.jsx(bre,{isOpen:g,onClose:()=>x(!1),deal:e,onActivityAdded:M,authFetch:t,initialActivityType:w}),r.jsx(Vm,{isOpen:F,onClose:()=>{O(!1),J(null)},onConfirm:oe,title:"Confirm Deletion",itemName:(K==null?void 0:K.type)==="note"?"this note":"this call summary",itemType:(K==null?void 0:K.type)||"item",isDeleting:se,deleteButtonText:"Delete"})]})},wre=({currentStage:e,dealId:t,authFetch:n,onStageUpdate:s})=>{const a="http://localhost:8003",[i,l]=h.useState(!1),o=[{id:"Opportunity",label:"Opportunity",order:1,type:"normal"},{id:"Discovery",label:"Discovery",order:2,type:"normal"},{id:"Negotiation",label:"Negotiation",order:3,type:"normal"},{id:"Closed-Won",label:"Closed Won",order:4,type:"success"},{id:"Closed-Lost",label:"Closed Lost",order:5,type:"failure"}],d=(()=>{const f=o.find(y=>y.id===e);return f?f.order:0})();o.find(f=>f.id===e);const u=async f=>{if(!(f===e||i)){l(!0);try{console.log(`Updating deal ${t} stage to ${f}...`);const y=`${a}/api/crm/deals/${t}`;console.log("Request URL:",y);const g=await n(y,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({stage:f})});if(console.log("Response status:",g.status),g.ok){const x=await g.json();console.log("Stage updated successfully:",x),s&&s(f)}else{const x=await g.json().catch(()=>({detail:"Unknown error"}));throw console.error("Update failed:",x),new Error(x.detail||`Failed to update stage (Status: ${g.status})`)}}catch(y){console.error("Stage update error:",y);let g="Failed to update deal stage";y.message.includes("Failed to fetch")?g="Cannot connect to CRM service. Please ensure the CRM backend is running on port 8003.":g=y.message,alert(g)}finally{l(!1)}}},m=f=>f.id===e?"current":f.order<d?"completed":"upcoming",p=(f,y="normal")=>{if(y==="success"&&f==="current")return{circle:"bg-green-600 border-green-600 text-white ring-4 ring-green-100",label:"text-green-700 font-semibold",connector:"bg-green-600"};if(y==="failure"&&f==="current")return{circle:"bg-red-600 border-red-600 text-white ring-4 ring-red-100",label:"text-red-700 font-semibold",connector:"bg-red-600"};switch(f){case"completed":return{circle:"bg-indigo-600 border-indigo-600 text-white",label:"text-indigo-700",connector:"bg-indigo-600"};case"current":return{circle:"bg-indigo-600 border-indigo-600 text-white ring-4 ring-indigo-100",label:"text-indigo-700 font-semibold",connector:"bg-gray-300"};case"upcoming":return{circle:"bg-white border-gray-300 text-gray-400 hover:border-indigo-300 hover:bg-indigo-50",label:"text-gray-500",connector:"bg-gray-300"};default:return{circle:"bg-gray-200 border-gray-300 text-gray-400",label:"text-gray-500",connector:"bg-gray-300"}}};return r.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 px-6 py-4",children:[r.jsxs("h3",{className:"text-lg font-bold text-black font-[Inter] flex items-center gap-2 mb-3",children:[r.jsx(r4,{className:"w-5 h-5 text-indigo-600"}),"Deal Stage"]}),r.jsx("div",{className:"relative",children:r.jsx("div",{className:"flex items-center justify-between",children:o.map((f,y)=>{const g=m(f),x=p(g,f.type),b=!i&&g!=="current";return r.jsxs(le.Fragment,{children:[r.jsxs("div",{className:"flex flex-col items-center flex-1",children:[r.jsx("button",{onClick:()=>b&&u(f.id),disabled:i||g==="current",className:`w-7 h-7 rounded-full border-2 flex items-center justify-center transition-all duration-200 ${x.circle} ${b?"cursor-pointer transform hover:scale-110":"cursor-default"} ${i?"opacity-50":""}`,children:g==="completed"?r.jsx(Xr,{className:"w-3.5 h-3.5"}):g==="current"?r.jsx(Gi,{className:"w-3.5 h-3.5 fill-current"}):r.jsx("span",{className:"text-xs font-medium",children:f.order})}),r.jsx("span",{className:`mt-1 text-xs text-center ${x.label} transition-colors`,children:f.label})]}),y<o.length-1&&r.jsx("div",{className:"flex-1 mx-1 mb-4",children:r.jsx("div",{className:`h-0.5 ${x.connector} transition-colors`})})]},f.id)})})})]})},jre=({isOpen:e,onClose:t,deal:n,authFetch:s})=>{const a="http://localhost:8003",{employees:i,updateDeal:l}=xc(),[o,c]=h.useState(n||null),[d,u]=h.useState("overview"),[m,p]=h.useState(null),[f,y]=h.useState(""),[g,x]=h.useState(!1),[b,v]=h.useState(""),[w,N]=h.useState(""),[k,j]=h.useState(null),[S,_]=h.useState(!1),[C,D]=h.useState(null),[A,E]=h.useState(!1),[T,M]=h.useState(null),[L,P]=h.useState(!1),[$,R]=h.useState([]),[U,I]=h.useState(!1),[z,F]=h.useState(null);h.useEffect(()=>{n&&c(n)},[n]),h.useEffect(()=>{e?n&&(console.log("DealDetailModal - Deal data:",n),console.log("DealDetailModal - Client name:",n.client_name),console.log("DealDetailModal - Client email:",n.client_email)):(u("overview"),p(null),y(""))},[e,n]);const O=ce=>!ce&&ce!==0?"-":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(ce),K=ce=>ce?new Date(ce).toLocaleDateString():"-",J=ce=>{console.log("Deal activity clicked:",ce);const ke={type:ce.activity_type,originalType:ce.activity_type,title:ce.title||ce.theme||`${ce.activity_type==="note"?"Note":ce.activity_type==="call"?"Call":ce.activity_type==="email"?"Email":"Meeting"}`,description:ce.body||ce.content||"",date:ce.created_at,employeeName:ce.employee_name||"Unknown",metadata:{interactionId:ce.interaction_id,interaction_id:ce.interaction_id,noteId:ce.note_id,theme:ce.theme,source:ce.source,sourceName:ce.source_name,sourceType:ce.source_type,gmailMessageId:ce.gmail_message_id}};if(ce.activity_type==="note"){const Pe=$.find(qe=>qe.id===ce.note_id);Pe?(j(Pe),_(!0)):console.error("Note not found:",ce.note_id)}else if(ce.activity_type==="meeting"||ce.activity_type==="meet"){const Pe=ce.interaction_id;if(!Pe){console.error("No interaction ID found for meeting activity:",ce);return}const qe={title:ce.title,description:ce.description,start_time:ce.start_time,end_time:ce.end_time,location:ce.location,employee_name:ce.employee_name};D({id:Pe,data:qe}),E(!0)}else se(ke)},se=ce=>{M(ce),P(!0)},Z=()=>{_(!1),j(null)},oe=()=>{E(!1),D(null)},W=async ce=>{console.log("Meeting updated:",ce)},B=async()=>{console.log("Meeting deleted"),E(!1),D(null)},V=()=>{P(!1),M(null)},re=async ce=>{if(ce){F(ce);try{(await s(`${a}/api/crm/deals/${o.deal_id}/notes/${ce}`,{method:"DELETE"})).ok&&R($.filter(Pe=>Pe.id!==ce))}catch(ke){console.error("Error deleting note:",ke)}finally{F(null)}}},Me=async(ce,ke)=>{try{const Pe=ke==="important"?null:"important";(await s(`${a}/api/crm/deals/${o.deal_id}/notes/${ce}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({star:Pe})})).ok&&R($.map(ne=>ne.id===ce?{...ne,star:Pe}:ne))}catch(Pe){console.error("Error toggling note star:",Pe)}},he=async()=>{},G=async ce=>{},q=(ce,ke)=>{console.log(`[Deal Edit] Starting to edit field: ${ce}, current value:`,ke),p(ce),y(ke||"")},Q=()=>{console.log(`[Deal Edit] Cancelled editing field: ${m}`),p(null),y("")},ue=async ce=>{if(!(o!=null&&o.deal_id)){console.error("[Deal Edit] No deal ID found, cannot save");return}let ke=o[ce],Pe=f;if(ce==="employee_id"&&(ke=ke||"",Pe=Pe||"",String(ke)===String(Pe))){console.log("[Deal Edit] No change detected, canceling edit"),Q();return}console.log(`[Deal Edit] Saving field: ${ce}, old value:`,ke,"new value:",Pe),x(!0);try{const qe={};ce==="value_usd"?qe[ce]=parseFloat(f)||0:ce==="employee_id"?qe[ce]=f===""?null:parseInt(f):qe[ce]=f,console.log("[Deal Edit] Sending update request:",qe);const ne=await s(`${a}/api/crm/deals/${o.deal_id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(qe)});if(ne.ok){const ye=await ne.json();console.log("[Deal Edit] Deal updated successfully:",ye),c(ye),l(ye),console.log("[Deal Edit] CRM context updated with new deal data"),p(null),y(""),console.log("[Deal Edit] Editing state cleared")}else{const ye=await ne.json();throw new Error(ye.detail||"Failed to update deal")}}catch(qe){console.error("[Deal Edit] Error updating deal:",qe),alert("Failed to update deal: "+qe.message)}finally{x(!1)}},Le=(ce,ke,Pe="",qe="text")=>m===ce?r.jsxs("div",{children:[r.jsxs("div",{className:"relative",children:[r.jsx("input",{type:qe,value:f,onChange:ye=>y(ye.target.value),onBlur:()=>{g||ue(ce)},onKeyDown:ye=>{ye.key==="Enter"?ue(ce):ye.key==="Escape"&&Q()},className:"w-full px-2 py-1 pr-8 border border-blue-500 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",autoFocus:!0,disabled:g,step:qe==="number"?"0.01":void 0}),g&&r.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:r.jsx(Be,{className:"w-4 h-4 animate-spin text-blue-600"})})]}),r.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Press Enter or click away to save, Esc to cancel"})]}):r.jsx("div",{onClick:()=>q(ce,ke),className:"cursor-pointer hover:bg-blue-50 py-1 rounded transition-colors",title:"Click to edit",children:r.jsx("p",{className:"text-gray-900",children:r.jsx("span",{className:ke?"":"text-gray-400 italic",children:ke||Pe})})}),ge=(ce,ke,Pe="")=>m===ce?r.jsxs("div",{children:[r.jsxs("div",{className:"relative",children:[r.jsx("textarea",{value:f,onChange:ne=>y(ne.target.value),onBlur:()=>{g||ue(ce)},onKeyDown:ne=>{ne.key==="Enter"&&ne.ctrlKey?ue(ce):ne.key==="Escape"&&Q()},className:"w-full px-2 py-1 border border-blue-500 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white resize-none",rows:4,autoFocus:!0,disabled:g}),g&&r.jsx("div",{className:"absolute right-2 top-2",children:r.jsx(Be,{className:"w-4 h-4 animate-spin text-blue-600"})})]}),r.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Press Ctrl+Enter or click away to save, Esc to cancel"})]}):r.jsx("div",{onClick:()=>q(ce,ke),className:"cursor-pointer hover:bg-blue-50 py-1 rounded transition-colors",title:"Click to edit",children:r.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:r.jsx("span",{className:ke?"":"text-gray-400 italic",children:ke||Pe})})}),Se=(ce,ke,Pe)=>m===ce?r.jsxs("div",{children:[r.jsxs("div",{className:"relative",children:[r.jsxs("select",{value:f,onChange:ne=>{y(ne.target.value)},onBlur:()=>{g||ue(ce)},onKeyDown:ne=>{ne.key==="Enter"?ue(ce):ne.key==="Escape"&&Q()},className:"w-full px-2 py-1 pr-8 border border-blue-500 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",autoFocus:!0,disabled:g,children:[r.jsx("option",{value:"",children:"Unassigned"}),i==null?void 0:i.map(ne=>r.jsx("option",{value:ne.employee_id,children:ne.name},ne.employee_id))]}),g&&r.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:r.jsx(Be,{className:"w-4 h-4 animate-spin text-blue-600"})})]}),r.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Select an employee and click away to save, or press Esc to cancel"})]}):r.jsx("div",{onClick:()=>q(ce,ke||""),className:"cursor-pointer hover:bg-blue-50 py-1 rounded transition-colors",title:"Click to edit",children:r.jsx("p",{className:"text-gray-900",children:r.jsx("span",{className:Pe?"":"text-gray-400 italic",children:Pe||"Unassigned"})})});return o?r.jsxs(h.Fragment,{children:[r.jsx(ht,{children:e&&o?r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex justify-center p-8",onClick:t,children:r.jsxs(de.div,{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},className:"w-full bg-white rounded-lg shadow-2xl relative max-h-full flex flex-col",onClick:ce=>ce.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between pt-5 pb-3 px-6 border-b border-gray-200 flex-shrink-0",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center",children:r.jsx(qt,{className:"w-5 h-5 text-white"})}),r.jsx("h1",{className:"text-2xl font-bold text-gray-900 leading-none self-center -mb-1",children:o.deal_name||"Untitled Deal"})]}),r.jsx(H,{variant:"ghost",size:"icon",onClick:t,children:r.jsx(Ze,{className:"w-5 h-5 text-gray-500"})})]}),r.jsx("div",{className:"border-b border-gray-200 flex-shrink-0 px-6",children:r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(H,{variant:"ghost",onClick:()=>u("overview"),className:`flex items-center gap-2 p-4 text-sm font-medium border-b-2 rounded-none ${d==="overview"?"border-indigo-600 text-indigo-600 hover:text-indigo-700":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(sx,{className:"w-4 h-4"}),"Overview"]}),r.jsxs(H,{variant:"ghost",onClick:()=>u("email"),className:`flex items-center gap-2 p-4 text-sm font-medium border-b-2 rounded-none ${d==="email"?"border-indigo-600 text-indigo-600 hover:text-indigo-700":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(Dt,{className:"w-4 h-4"}),"Send Email"]})]})}),r.jsxs("div",{className:"flex-1 overflow-y-auto py-4 px-5 bg-gray-50",children:[d==="overview"&&r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-4",children:[r.jsx("div",{className:"lg:col-span-3 lg:order-2 space-y-4",children:r.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 flex flex-col",style:{height:"calc(1000px + 1rem)"},children:[r.jsx("div",{className:"flex items-center justify-between mb-6 flex-shrink-0",children:r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[r.jsx(qt,{className:"w-4 h-4 text-indigo-600"}),"Deal Information"]})}),r.jsxs("div",{className:"space-y-4 flex-1 overflow-y-auto",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Deal Name"}),Le("deal_name",o.deal_name,"Click to add deal name")]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Client"}),r.jsx("p",{className:"text-gray-900",children:o.client_name||"-"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Value (USD)"}),m==="value_usd"?Le("value_usd",o.value_usd,"0","number"):r.jsx("div",{onClick:()=>q("value_usd",o.value_usd),className:"cursor-pointer hover:bg-blue-50 py-1 rounded transition-colors",title:"Click to edit",children:r.jsx("p",{className:"text-gray-900 font-semibold text-lg",children:O(o.value_usd)})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Assigned Salesperson"}),Se("employee_id",o.employee_id,o.salesman_name)]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Expected Close Date"}),Le("expected_close_date",o.expected_close_date,"Click to add date","date")]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Last Contact Date"}),r.jsx("p",{className:"text-gray-900",children:K(o.last_contact_date)})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Created Date"}),r.jsx("p",{className:"text-gray-900",children:K(o.created_at)})]}),r.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[r.jsx("label",{className:"text-sm font-medium text-gray-600 block mb-1",children:"Description"}),ge("description",o.description,"Click to add description...")]})]})]})}),r.jsxs("div",{className:"lg:col-span-7 lg:order-1 flex flex-col gap-4",style:{height:"calc(1000px + 1rem)"},children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx(wre,{currentStage:o.stage,dealId:o.deal_id,authFetch:s,onStageUpdate:ce=>{console.log("Stage updated to:",ce);const ke={...o,stage:ce,updated_at:new Date().toISOString()};c(ke),l(ke),console.log("[Deal Stage] CRM context updated with new stage:",ce)}})}),r.jsx("div",{className:"flex-1 min-h-0",children:r.jsx(vre,{deal:o,authFetch:s,onActivityAdded:()=>{},handleEventClick:J,notes:$,isDeletingNote:z,handleDeleteNote:re,onCallDeleted:G})})]})]}),d==="email"&&r.jsx(OT,{customer:{id:o.client_id,email:o.client_email,company:o.deal_name,primaryContact:o.client_name},dealId:o.deal_id,onClose:()=>u("overview"),onEmailSent:()=>u("overview"),embedded:!0})]})]})}):null}),r.jsx(PT,{note:k,customer:o,isOpen:S,onClose:Z,onDelete:re,onUpdate:he,onToggleStar:Me,isDeletingNote:z,authFetch:s}),r.jsx(DT,{isOpen:A,onClose:oe,meetingId:C==null?void 0:C.id,authFetch:s,meeting:C==null?void 0:C.data,onUpdate:W,onDelete:B}),r.jsx(TT,{event:T,customer:null,deal:o,isOpen:L,onClose:V,notes:$,customerInteractions:[],onDelete:G,onUpdate:()=>{},authFetch:s})]}):null},Nre=()=>{var nt;const{deals:e,dealsLoading:t,dealsError:n,loadDeals:s,updateDeal:a,deleteDeal:i,setDeals:l,customers:o,employees:c,employeesLoading:d,loadEmployees:u,CRM_API_BASE_URL:m,authFetch:p,hasInitialLoad:f}=xc(),{isAuthenticated:y,user:g}=Qr(),[x,b]=h.useState(new Set),[v,w]=h.useState({}),[N,k]=h.useState(new Set),[j,S]=h.useState({}),[_,C]=h.useState(null),[D,A]=h.useState({key:null,direction:"asc"}),[E,T]=h.useState(""),[M,L]=h.useState(!1),[P,$]=h.useState({}),[R,U]=h.useState({}),[I,z]=h.useState(null),[F,O]=h.useState(!0),[K,J]=h.useState(!1),[se,Z]=h.useState(!1),[oe,W]=h.useState(!1),[B,V]=h.useState(!1),[re,Me]=h.useState(null),he=le.useRef(null),G=le.useRef(null),[q,Q]=h.useState({deal_name:!0,description:!0,value_usd:!0,stage:!0,expected_close_date:!0,salesman_name:!0,client_name:!0,actions:!0}),[ue,Le]=h.useState({deal_name:!0,description:!0,client_name:!0,salesman_name:!0}),ge=[{id:"deal_name",label:"Deal Name",icon:qt,disabled:!0},{id:"description",label:"Description",icon:Ut},{id:"value_usd",label:"Value (USD)",icon:Ur},{id:"stage",label:"Stage",icon:null},{id:"expected_close_date",label:"Expected Close Date",icon:yt},{id:"salesman_name",label:"Assigned Salesman",icon:_t},{id:"client_name",label:"Client",icon:_n},{id:"actions",label:"Actions",icon:null,disabled:!0}],Se=(ie,xe)=>{Q(Ie=>({...Ie,[ie]:xe}))},[ce,ke]=h.useState({isOpen:!1,deal:null,isDeleting:!1}),Pe=(ie,xe)=>{xe.target.closest(".editable-cell")||xe.target.closest("button")||xe.target.closest("select")||xe.target.closest("input")||(Me(ie),V(!0))};h.useEffect(()=>{const ie=xe=>{he.current&&!he.current.contains(xe.target)&&Z(!1),G.current&&!G.current.contains(xe.target)&&W(!1)};return document.addEventListener("mousedown",ie),()=>document.removeEventListener("mousedown",ie)},[]),h.useEffect(()=>{u()},[u]),h.useEffect(()=>{if(_){const ie=setTimeout(()=>{C(null)},3e3);return()=>clearTimeout(ie)}},[_]);const qe=(ie,xe)=>{if(!xe||!xe.condition)return!0;const{condition:Ie,value:Oe}=xe,Ue=String(ie||"").toLowerCase(),$e=String(Oe||"").toLowerCase();switch(Ie){case"contains":return Ue.includes($e);case"not_contains":return!Ue.includes($e);case"equals":return Ue===$e;case"not_equals":return Ue!==$e;case"starts_with":return Ue.startsWith($e);case"ends_with":return Ue.endsWith($e);case"is_empty":return!ie||ie==="";case"not_empty":return ie&&ie!=="";case"greater_than":return parseFloat(ie)>parseFloat(Oe);case"less_than":return parseFloat(ie)<parseFloat(Oe);case"greater_equal":return parseFloat(ie)>=parseFloat(Oe);case"less_equal":return parseFloat(ie)<=parseFloat(Oe);case"between":{const[ot,fe]=Oe.split(",").map(je=>parseFloat(je)),pe=parseFloat(ie);return pe>=ot&&pe<=fe}case"in":return Oe.split(",").includes(String(ie));case"not_in":return!Oe.split(",").includes(String(ie));default:return!0}},ne=h.useMemo(()=>{let ie=e;if(E){const xe=E.toLowerCase();ie=e.filter(Ie=>{const Oe=[];return ue.deal_name&&Oe.push(Ie.deal_name),ue.description&&Oe.push(Ie.description),ue.client_name&&Oe.push(Ie.client_name),ue.salesman_name&&Oe.push(Ie.salesman_name),Oe.some(Ue=>Ue&&Ue.toString().toLowerCase().includes(xe))})}return ie=ie.filter(xe=>{for(const[Ie,Oe]of Object.entries(R))if(!(Array.isArray(Oe)?Oe:[Oe]).every(ot=>qe(xe[Ie],ot)))return!1;return!0}),D.key&&(ie=[...ie].sort((xe,Ie)=>{const Oe=xe[D.key],Ue=Ie[D.key];if(Oe==null)return 1;if(Ue==null)return-1;const $e=Oe.toString().toLowerCase(),ot=Ue.toString().toLowerCase();return D.direction==="asc"?$e<ot?-1:$e>ot?1:0:$e>ot?-1:$e<ot?1:0})),ie},[e,E,ue,D,R]),ye=ie=>{A(xe=>({key:ie,direction:xe.key===ie&&xe.direction==="asc"?"desc":"asc"}))},Ee=()=>{L(!0),$({deal_name:"",description:"",value_usd:0,stage:"Opportunity",expected_close_date:"",salesman_name:I||"",client_name:""})},st=()=>{L(!1),$({})},Ke=async()=>{if(!K)try{if(J(!0),console.log("newDeal state:",P),console.log("client_name field value:",P.client_name,"type:",typeof P.client_name),console.log("salesman_name field value:",P.salesman_name,"type:",typeof P.salesman_name),!P.deal_name||!P.client_name){C({type:"error",message:"Deal name and client are required"});return}let ie=null;if(P.salesman_name&&P.salesman_name!==""){if(ie=parseInt(P.salesman_name),isNaN(ie)){C({type:"error",message:"Please select a valid salesman from dropdown"});return}console.log(" Manual assignment: employee_id",ie)}else console.log(" Auto-assignment: employee_id will be set by backend");const xe=parseInt(P.client_name);if(console.log("Parsed IDs - employee:",ie,"client:",xe),isNaN(xe)){C({type:"error",message:"Please select a valid client from dropdown"});return}const Ie={deal_name:P.deal_name,description:P.description||null,value_usd:parseFloat(P.value_usd)||0,stage:P.stage||"Opportunity",employee_id:ie,client_id:xe,expected_close_date:P.expected_close_date||null};console.log("Creating deal with payload:",Ie);const Oe=await p(`${m}/api/crm/deals`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ie)});if(!Oe.ok){const $e=await Oe.json().catch(()=>({}));console.error("Deal creation failed:",Oe.status,$e);let ot="Failed to create deal";throw $e.detail&&($e.detail.includes("not registered as an employee")?ot="You are not registered as an employee. Please contact your administrator.":$e.detail.includes("Invalid employee_id")?ot="Selected salesperson is invalid. Please choose another.":ot=$e.detail),new Error(ot)}const Ue=await Oe.json();console.log("Deal created successfully:",Ue),l($e=>[Ue,...$e]),C({type:"success",message:"Deal added successfully"}),L(!1),$({})}catch(ie){console.error("Error creating deal:",ie),C({type:"error",message:ie.message||"Failed to create deal"})}finally{J(!1)}},At=async(ie,xe)=>{if(xe.stopPropagation(),!y){C({type:"error",message:"You must be logged in to delete deals"});return}const Ie=e.find(Oe=>Oe.deal_id===ie);Ie&&ke({isOpen:!0,deal:Ie,isDeleting:!1})},lt=async()=>{const ie=ce.deal;if(ie){ke(xe=>({...xe,isDeleting:!0}));try{const xe=await i(ie.deal_id);if(xe.success)C({type:"success",message:`Deal "${ie.deal_name}" deleted successfully`}),ke({isOpen:!1,deal:null,isDeleting:!1});else throw new Error(xe.error||"Failed to delete deal")}catch(xe){console.error("Error deleting deal:",xe),C({type:"error",message:`Failed to delete deal: ${xe.message}`}),ke(Ie=>({...Ie,isDeleting:!1}))}}},Ht=()=>{ke({isOpen:!1,deal:null,isDeleting:!1})},pt={deal_name:{type:"text",label:"Deal Name",icon:qt,required:!0,validation:ie=>(ie==null?void 0:ie.length)>=2?null:"Deal name must be at least 2 characters"},description:{type:"textarea",label:"Description",icon:Ut,validation:ie=>(ie==null?void 0:ie.length)>=5?null:"Description must be at least 5 characters"},value_usd:{type:"currency",label:"Value (USD)",icon:Ur,validation:ie=>{const xe=parseFloat(ie);return isNaN(xe)||xe<0?"Must be a valid positive number":null}},stage:{type:"select",label:"Stage",options:[{value:"Opportunity",label:"Opportunity",color:"bg-blue-100 text-blue-800"},{value:"Discovery",label:"Discovery",color:"bg-purple-100 text-purple-800"},{value:"Negotiation",label:"Negotiation",color:"bg-orange-100 text-orange-800"},{value:"Closed-Won",label:"Closed Won",color:"bg-green-100 text-green-800"},{value:"Closed-Lost",label:"Closed Lost",color:"bg-red-100 text-red-800"}]},expected_close_date:{type:"date",label:"Expected Close Date",icon:yt},created_at:{type:"datetime-display",label:"Started Time",icon:jt,readonly:!0},salesman_name:{type:"select",label:"Assigned Salesman",icon:_t,required:!1,options:(()=>{const ie=(c==null?void 0:c.map(xe=>({value:xe.employee_id,label:xe.name||`${xe.first_name||""} ${xe.last_name||""}`.trim()||`Employee ${xe.employee_id}`})))||[];return console.log("Salesman dropdown options from employee_info:",ie),ie})()},client_name:{type:"select",label:"Client",icon:_n,required:!0,options:(()=>{const ie=(o==null?void 0:o.map(xe=>({value:xe.id||xe.client_id,label:xe.company||xe.name})))||[];return console.log("Client dropdown options (fixed):",ie),ie})()}};h.useEffect(()=>{(async()=>{if(!y||!(g!=null&&g.email)){O(!1);return}try{O(!0);const xe=await p(`${m}/api/crm/employees`);if(xe.ok){const Oe=(await xe.json()).find(Ue=>Ue.email===g.email);Oe?(z(Oe.employee_id),console.log(" Current user employee_id:",Oe.employee_id)):(console.warn(" Current user not found in employee_info table"),z(null))}}catch(xe){console.error(" Error fetching current user employee ID:",xe),z(null)}finally{O(!1)}})()},[y,g==null?void 0:g.email,m,p]),h.useEffect(()=>{y&&!t&&e.length===0&&!n&&s()},[y]);const be=(ie,xe)=>`${ie}-${xe}`,ze=(ie,xe)=>{var Oe;const Ie=pt[xe];if(!ie&&ie!==0)return"-";switch(Ie==null?void 0:Ie.type){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(ie);case"date":return ie?new Date(ie).toLocaleDateString():"-";case"datetime-display":return ie?new Date(ie).toLocaleString():"-";case"select":if(xe==="salesman_name")return ie;const Ue=(Oe=Ie.options)==null?void 0:Oe.find($e=>$e.value===ie);return Ue?Ue.label:ie;default:return ie}},ee=(ie,xe)=>{var Oe;const Ie=pt[xe];if((Ie==null?void 0:Ie.type)==="select"&&xe==="stage"){const Ue=(Oe=Ie.options)==null?void 0:Oe.find($e=>$e.value===ie);return(Ue==null?void 0:Ue.color)||"bg-gray-100 text-gray-800"}return""},X=(ie,xe,Ie)=>{const Oe=pt[xe];if(Oe!=null&&Oe.readonly)return;const Ue=be(ie,xe);b($e=>new Set([...$e,Ue])),w($e=>({...$e,[Ue]:Ie||""})),S($e=>({...$e,[Ue]:null}))},te=(ie,xe)=>{const Ie=be(ie,xe);b(Oe=>{const Ue=new Set(Oe);return Ue.delete(Ie),Ue}),w(Oe=>{const Ue={...Oe};return delete Ue[Ie],Ue}),S(Oe=>{const Ue={...Oe};return delete Ue[Ie],Ue})},we=async(ie,xe)=>{const Ie=be(ie,xe),Oe=v[Ie],Ue=pt[xe];if(!y){S($e=>({...$e,[Ie]:"You must be logged in to edit data"}));return}if(Ue!=null&&Ue.validation){const $e=Ue.validation(Oe);if($e){S(ot=>({...ot,[Ie]:$e}));return}}k($e=>new Set([...$e,Ie]));try{let $e=Oe;(Ue==null?void 0:Ue.type)==="currency"?$e=parseFloat(Oe)||0:(Ue==null?void 0:Ue.type)==="date"?$e=Oe||null:xe==="salesman_name"&&($e=parseInt(Oe)||null,xe="employee_id"),console.log(`Updating deal ${ie}, field: ${xe}, value:`,$e);const ot=await p(`${m}/api/crm/deals/${ie}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({[xe]:$e})});if(!ot.ok){const pe=await ot.json().catch(()=>({}));throw new Error(pe.detail||`HTTP ${ot.status}: Failed to update deal`)}const fe=await ot.json();a(fe),b(pe=>{const je=new Set(pe);return je.delete(Ie),je}),w(pe=>{const je={...pe};return delete je[Ie],je}),C({type:"success",message:`Successfully updated ${Ue.label}`})}catch($e){console.error("Error updating deal:",$e),S(ot=>({...ot,[Ie]:$e.message})),C({type:"error",message:`Failed to update: ${$e.message}`})}finally{k($e=>{const ot=new Set($e);return ot.delete(Ie),ot})}},Ne=(ie,xe)=>{var pe;const Ie=be(ie.deal_id,xe),Oe=x.has(Ie);N.has(Ie);const Ue=j[Ie],$e=pt[xe],ot=ie[xe],fe=v[Ie];return $e!=null&&$e.readonly?r.jsx("div",{className:"px-2 py-1 min-h-[32px]",children:r.jsx("span",{className:"text-gray-900",children:ze(ot,xe)})}):Oe?r.jsxs("div",{className:"relative",children:[($e==null?void 0:$e.type)==="select"?r.jsx("select",{value:fe,onChange:je=>w(Fe=>({...Fe,[Ie]:je.target.value})),onBlur:()=>we(ie.deal_id,xe),onKeyDown:je=>{je.key==="Enter"?we(ie.deal_id,xe):je.key==="Escape"&&te(ie.deal_id,xe)},className:`px-2 py-1 border rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 w-full ${Ue?"border-red-300":"border-gray-300"}`,autoFocus:!0,children:(pe=$e.options)==null?void 0:pe.map(je=>r.jsx("option",{value:je.value,children:je.label},je.value))}):($e==null?void 0:$e.type)==="textarea"?r.jsx("textarea",{value:fe,onChange:je=>w(Fe=>({...Fe,[Ie]:je.target.value})),onBlur:()=>we(ie.deal_id,xe),onKeyDown:je=>{je.key==="Enter"&&!je.shiftKey?(je.preventDefault(),we(ie.deal_id,xe)):je.key==="Escape"&&te(ie.deal_id,xe)},className:`px-2 py-1 border rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 w-full resize-none ${Ue?"border-red-300":"border-gray-300"}`,rows:2,autoFocus:!0}):r.jsx("input",{type:($e==null?void 0:$e.type)==="currency"?"text":($e==null?void 0:$e.type)||"text",value:fe,onChange:je=>w(Fe=>({...Fe,[Ie]:je.target.value})),onBlur:()=>we(ie.deal_id,xe),className:`px-2 py-1 border rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 w-full ${Ue?"border-red-300":"border-gray-300"}`,placeholder:($e==null?void 0:$e.type)==="currency"?"Enter amount":void 0,autoFocus:!0,onKeyDown:je=>{je.key==="Enter"?we(ie.deal_id,xe):je.key==="Escape"&&te(ie.deal_id,xe)}}),Ue&&r.jsx("div",{className:"absolute top-full left-0 mt-1 text-xs text-red-600 bg-red-50 px-2 py-1 rounded border border-red-200 shadow-sm z-10",children:Ue})]}):r.jsxs("div",{className:"group cursor-pointer hover:bg-indigo-50 px-2 py-1 rounded flex items-center justify-between min-h-[32px] editable-cell",onClick:je=>{je.stopPropagation(),X(ie.deal_id,xe,ot)},title:"Click to edit",children:[($e==null?void 0:$e.type)==="select"&&xe==="stage"?r.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${ee(ot,xe)}`,children:ze(ot,xe)}):r.jsx("span",{className:ot?"text-gray-900":"text-gray-400 italic",children:ze(ot,xe)}),r.jsx(Ms,{className:"w-3 h-3 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity"})]})};return t&&!f?r.jsxs("div",{className:"flex items-center justify-center h-64",children:[r.jsx(Ct,{className:"w-8 h-8 animate-spin text-indigo-600"}),r.jsx("span",{className:"ml-2 text-gray-600",children:"Loading deals..."})]}):r.jsxs("div",{className:"h-full flex flex-col",children:[_&&r.jsxs("div",{className:`mb-4 p-3 rounded-lg flex items-center justify-between animate-fade-in ${_.type==="success"?"bg-green-50 border border-green-200 text-green-800":"bg-red-50 border border-red-200 text-red-800"}`,children:[r.jsxs("div",{className:"flex items-center gap-2",children:[_.type==="success"?r.jsx(Xr,{className:"w-4 h-4"}):r.jsx(dt,{className:"w-4 h-4"}),r.jsx("span",{className:"text-sm font-medium",children:_.message})]}),r.jsx("button",{onClick:()=>C(null),className:"text-gray-500 hover:text-gray-700",children:r.jsx(Ze,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("div",{className:"flex items-center gap-3",children:r.jsxs("div",{className:"relative",ref:he,children:[r.jsxs("button",{onClick:()=>Z(!se),disabled:!y,className:"inline-flex items-center justify-center focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none active:scale-95 font-manrope h-10 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Add Deals",tabIndex:"0",children:[r.jsx(Wt,{className:"w-4 h-4 mr-2"}),"Add Deals",r.jsx(Xt,{className:`w-4 h-4 ml-1 transition-transform ${se?"rotate-180":""}`})]}),se&&r.jsx("div",{className:"absolute top-full left-0 mt-2 w-56 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:r.jsx("div",{className:"py-1",children:r.jsxs("button",{onClick:()=>{Ee(),Z(!1)},disabled:M,className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-indigo-50 hover:text-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(Wt,{className:"w-4 h-4"}),r.jsx("span",{className:"font-medium",children:"Add Deal"})]})})})]})}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(jx,{value:E,onChange:T,onClear:()=>T(""),searchColumns:ue,onColumnChange:Le,availableColumns:[{key:"deal_name",label:"Deal Name",icon:qt},{key:"description",label:"Description",icon:Ut},{key:"client_name",label:"Client",icon:_n},{key:"salesman_name",label:"Salesman",icon:_t}],placeholder:"Search deals..."}),r.jsx(wx,{columns:[{id:"deal_name",label:"Deal Name",type:"text"},{id:"description",label:"Description",type:"text"},{id:"value_usd",label:"Value (USD)",type:"currency"},{id:"stage",label:"Stage",type:"select",options:pt.stage.options},{id:"expected_close_date",label:"Expected Close Date",type:"date"},{id:"created_at",label:"Started Time",type:"datetime"},{id:"salesman_name",label:"Assigned Salesman",type:"text"},{id:"client_name",label:"Client",type:"text"}],onApplyFilters:U,activeFilters:R}),r.jsxs("div",{className:"relative",ref:G,children:[r.jsx("button",{onClick:()=>W(!oe),className:"inline-flex items-center justify-center font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none active:scale-95 font-inter text-xs h-8 w-8 p-0 rounded-lg transition-all duration-200 text-gray-500 hover:bg-indigo-50 hover:text-indigo-600 active:bg-indigo-100",title:"More options","aria-label":"More Options",tabIndex:"0",children:r.jsx(nx,{className:"w-5 h-5"})}),oe&&r.jsx("div",{className:"absolute top-full right-0 mt-2 w-64 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-[500px] overflow-y-auto",children:r.jsxs("div",{className:"py-1",children:[r.jsxs("button",{onClick:()=>{s(!0),W(!1)},disabled:t,className:"w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 hover:bg-indigo-50 hover:text-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(Be,{className:`w-4 h-4 ${t?"animate-spin":""}`}),r.jsx("span",{className:"font-medium",children:t?"Refreshing...":"Refresh Data"})]}),r.jsx("div",{className:"border-t border-gray-200 my-1"}),r.jsxs("div",{className:"px-4 py-2",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-xs font-semibold text-gray-500 uppercase",children:"Select Columns"}),r.jsxs("span",{className:"text-xs text-gray-500",children:[Object.values(q).filter(Boolean).length,"/",ge.length]})]}),r.jsx("div",{className:"space-y-1",children:ge.map(ie=>{const xe=ie.icon;return r.jsxs("label",{className:`flex items-center gap-2 px-2 py-1.5 rounded transition-colors ${ie.disabled?"cursor-not-allowed opacity-60":"hover:bg-indigo-50 cursor-pointer"}`,children:[r.jsx("input",{type:"checkbox",checked:q[ie.id]!==!1,onChange:()=>{ie.disabled||Se(ie.id,!q[ie.id])},disabled:ie.disabled,className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),xe&&r.jsx(xe,{className:"w-4 h-4 text-gray-500"}),r.jsxs("span",{className:"text-sm text-gray-700 flex-1",children:[ie.label,ie.disabled&&r.jsx("span",{className:"text-xs text-gray-400 ml-1",children:"(Required)"})]})]},ie.id)})})]})]})})]})]})]}),r.jsx("div",{className:"mt-6 overflow-auto border border-gray-200 rounded-lg",children:r.jsx("div",{className:"min-w-max",children:r.jsxs("table",{className:"w-full bg-white min-w-max",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[Object.entries(pt).map(([ie,xe])=>q[ie]?r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-gray-700",onClick:()=>ye(ie),children:[xe.icon&&r.jsx(xe.icon,{className:"w-4 h-4"}),r.jsx("span",{children:xe.label}),D.key===ie?D.direction==="asc"?r.jsx(Ar,{className:"w-3 h-3 text-indigo-600"}):r.jsx(Gr,{className:"w-3 h-3 text-indigo-600"}):r.jsx(rn,{className:"w-3 h-3 text-gray-400"})]})},ie):null),q.actions&&r.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),r.jsxs("tbody",{className:"divide-y divide-gray-200",children:[M&&r.jsxs("tr",{className:"bg-indigo-50 border-2 border-indigo-200",children:[Object.keys(pt).map(ie=>{var Ie;if(!q[ie])return null;const xe=pt[ie];return xe.readonly?r.jsx("td",{className:"px-4 py-3 align-middle",children:r.jsx("div",{className:"text-gray-400 italic text-sm",children:"Auto-generated"})},ie):r.jsx("td",{className:"px-4 py-3 align-middle",children:xe.type==="select"?r.jsxs("select",{value:P[ie]||"",onChange:Oe=>$(Ue=>({...Ue,[ie]:Oe.target.value})),className:"w-full px-2 py-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 h-[38px]",children:[r.jsx("option",{value:"",children:"Select..."}),(Ie=xe.options)==null?void 0:Ie.map(Oe=>r.jsx("option",{value:Oe.value,children:Oe.label},Oe.value))]}):xe.type==="textarea"?r.jsx("textarea",{value:P[ie]||"",onChange:Oe=>$(Ue=>({...Ue,[ie]:Oe.target.value})),className:"w-full px-2 py-[9px] border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 resize-none h-[38px] leading-tight overflow-hidden align-top",rows:1}):r.jsx("input",{type:xe.type==="currency"?"text":xe.type||"text",value:P[ie]||"",onChange:Oe=>$(Ue=>({...Ue,[ie]:Oe.target.value})),className:"w-full px-2 py-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 h-[38px]",placeholder:xe.type==="currency"?"Enter amount":void 0})},ie)}),q.actions&&r.jsx("td",{className:"px-4 py-3 text-right align-middle",children:r.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[r.jsx("button",{onClick:Ke,disabled:K,className:"text-green-600 hover:text-green-800 p-1 disabled:opacity-50 disabled:cursor-not-allowed",title:"Save deal",children:K?r.jsx(Ct,{className:"w-4 h-4 animate-spin"}):r.jsx(Xr,{className:"w-4 h-4"})}),r.jsx("button",{onClick:st,disabled:K,className:"text-red-600 hover:text-red-800 p-1 disabled:opacity-50 disabled:cursor-not-allowed",title:"Cancel",children:r.jsx(Ze,{className:"w-4 h-4"})})]})})]}),ne.map((ie,xe)=>r.jsxs("tr",{className:`cursor-pointer hover:bg-indigo-50 transition-colors ${xe%2===0?"bg-white":"bg-gray-50"}`,onClick:Ie=>Pe(ie,Ie),title:"Click to view deal details",children:[Object.keys(pt).map(Ie=>q[Ie]?r.jsx("td",{className:"px-4 py-2 relative",children:Ne(ie,Ie)},Ie):null),q.actions&&r.jsx("td",{className:"px-4 py-2 text-right",children:r.jsx("button",{onClick:Ie=>At(ie.deal_id,Ie),className:"text-red-500 hover:text-red-700 hover:bg-red-50 p-1 rounded transition-colors",title:`Delete ${ie.deal_name||"deal"}`,children:r.jsx(fr,{className:"w-4 h-4"})})})]},ie.deal_id))]})]})})}),ne.length===0&&!t&&!M&&r.jsxs("div",{className:"text-center py-12 text-gray-500",children:[r.jsx(Ur,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),r.jsx("p",{children:n?`Error: ${n}`:E?`No deals found matching "${E}"`:"No deals found"}),n&&r.jsx("button",{onClick:()=>s(!0),className:"mt-2 text-sm text-indigo-600 hover:text-indigo-800",children:"Try again"}),E&&r.jsx("button",{onClick:()=>T(""),className:"mt-2 ml-2 text-sm text-indigo-600 hover:text-indigo-800",children:"Clear search"})]}),r.jsx("div",{className:"h-96"}),r.jsx(Vm,{isOpen:ce.isOpen,itemName:(nt=ce.deal)==null?void 0:nt.deal_name,itemType:"deal",isDeleting:ce.isDeleting,onConfirm:lt,onClose:Ht}),r.jsx(jre,{isOpen:B,onClose:()=>{V(!1),Me(null)},deal:re,authFetch:p})]})},Cre=({wsConnection:e})=>r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx(ri,{title:"Deals",themeColor:"indigo",tabs:[]}),r.jsx("div",{className:"flex-1 overflow-hidden",children:r.jsx("div",{className:"h-full p-4 overflow-y-auto",children:r.jsx(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:r.jsx(Nre,{})})})})]}),Io="http://localhost:8007/api/analytics";class kre{async getUserActivities(t,n=7,s=100,a=null){try{const i=new URLSearchParams({days:n.toString(),limit:s.toString()});a&&i.append("action_type",a);const l=await fetch(`${Io}/user/${encodeURIComponent(t)}/activities?${i}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!l.ok)throw new Error(`Failed to fetch user activities: ${l.status} ${l.statusText}`);return await l.json()}catch(i){throw console.error("Error fetching user activities:",i),i}}async getUserSessions(t,n=7,s=20){try{const a=new URLSearchParams({days:n.toString(),limit:s.toString()}),i=await fetch(`${Io}/user/${encodeURIComponent(t)}/sessions?${a}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!i.ok)throw new Error(`Failed to fetch user sessions: ${i.status} ${i.statusText}`);return await i.json()}catch(a){throw console.error("Error fetching user sessions:",a),a}}async getUserActivitySummary(t,n=7){try{const s=new URLSearchParams({days:n.toString()}),a=await fetch(`${Io}/user/${encodeURIComponent(t)}/summary?${s}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error(`Failed to fetch activity summary: ${a.status} ${a.statusText}`);return await a.json()}catch(s){throw console.error("Error fetching activity summary:",s),s}}async getActionTypes(){try{const t=await fetch(`${Io}/action-types`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to fetch action types: ${t.status} ${t.statusText}`);return(await t.json()).action_types}catch(t){throw console.error("Error fetching action types:",t),t}}async checkHealth(){try{const t=await fetch(`${Io}/health`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Analytics service health check failed: ${t.status} ${t.statusText}`);return await t.json()}catch(t){throw console.error("Analytics service health check failed:",t),t}}formatActivitiesForDisplay(t){return t.map(n=>({...n,timestamp:new Date(n.timestamp),durationFormatted:n.duration_ms?this.formatDuration(n.duration_ms):null,actionLabel:this.formatActionLabel(n.action_type,n.action_name),pageName:n.page_url?this.extractPageName(n.page_url):null}))}formatSessionsForDisplay(t){return t.map(n=>({...n,session_start:new Date(n.session_start),session_end:n.session_end?new Date(n.session_end):null,durationMs:n.session_end?new Date(n.session_end)-new Date(n.session_start):null,durationFormatted:n.session_end?this.formatDuration(new Date(n.session_end)-new Date(n.session_start)):"Active"}))}formatDuration(t){if(!t||t<0)return"0s";const n=Math.floor(t/1e3),s=Math.floor(n/60),a=Math.floor(s/60);return a>0?`${a}h ${s%60}m`:s>0?`${s}m ${n%60}s`:`${n}s`}formatActionLabel(t,n){const s={authentication:"Auth",navigation:"Navigate",chat:"Chat",crm:"CRM",lead_generation:"Leads",analytics:"Analytics",task_management:"Tasks",calendar:"Calendar",settings:"Settings",upload:"Upload",export:"Export"},a={page_change:"Page Change",send_message:"Send Message",create_customer:"Create Customer",update_customer:"Update Customer",delete_customer:"Delete Customer",search_leads:"Search Leads",generate_leads:"Generate Leads",login:"Login",logout:"Logout"},i=s[t]||t,l=a[n]||n.replace(/_/g," ").replace(/\b\w/g,o=>o.toUpperCase());return`${i}: ${l}`}extractPageName(t){if(!t)return null;const s=t.replace(/^https?:\/\/[^\/]+/,"").split("/").filter(Boolean);return s.length===0?"Home":{dashboard:"Dashboard",crm:"CRM",leads:"Lead Generation",employees:"Team Management",calendar:"Calendar",deals:"Deals","sales-center":"Sales Center","usage-analytics":"Usage Analytics","user-onboarding":"User Onboarding",settings:"Settings"}[s[0]]||s[0].replace(/-/g," ").replace(/\b\w/g,i=>i.toUpperCase())}getCurrentUserEmail(){try{const t=JSON.parse(localStorage.getItem("user")||"{}");return t.email?t.email:"test_user@preludeos.com"}catch{return"test_user@preludeos.com"}}groupActivitiesByDate(t){const n={};return t.forEach(s=>{const a=new Date(s.timestamp).toDateString();n[a]||(n[a]=[]),n[a].push(s)}),n}calculateActivityStats(t){const n={total:t.length,byType:{},byStatus:{},totalDuration:0,averageDuration:0,errorsCount:0};t.forEach(a=>{n.byType[a.action_type]=(n.byType[a.action_type]||0)+1,n.byStatus[a.result_status]=(n.byStatus[a.result_status]||0)+1,a.duration_ms&&(n.totalDuration+=a.duration_ms),a.result_status==="error"&&n.errorsCount++});const s=t.filter(a=>a.duration_ms);return s.length>0&&(n.averageDuration=n.totalDuration/s.length),n}}const Bs=new kre,Sre=()=>{var C,D,A;_3();const{user:e}=Qr(),[t,n]=h.useState("7"),[s,a]=h.useState(!0),[i,l]=h.useState(null),[o,c]=h.useState(null),[d,u]=h.useState([]),[m,p]=h.useState([]),[f,y]=h.useState(null),[g,x]=h.useState([]);h.useEffect(()=>{b(),v()},[t,e==null?void 0:e.email]);const b=async()=>{if(e!=null&&e.email){a(!0),l(null);try{const E=e.email,T=parseInt(t),[M,L,P]=await Promise.all([Bs.getUserActivitySummary(E,T),Bs.getUserActivities(E,T,50,f),Bs.getUserSessions(E,T,10)]);c(M),u(Bs.formatActivitiesForDisplay(L)),p(Bs.formatSessionsForDisplay(P))}catch(E){console.error("Error loading analytics data:",E),l("Failed to load analytics data. Please try again.")}finally{a(!1)}}},v=async()=>{try{const E=await Bs.getActionTypes();x(E)}catch(E){console.error("Error loading action types:",E)}},w=()=>{b()},N=()=>{if(!o)return;const E={summary:o,activities:d,sessions:m,exported_at:new Date().toISOString(),time_range_days:t},T=new Blob([JSON.stringify(E,null,2)],{type:"application/json"}),M=URL.createObjectURL(T),L=document.createElement("a");L.href=M,L.download=`usage-analytics-${t}d-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(M)},k=E=>({authentication:kt,navigation:Sf,chat:Kr,crm:kt,lead_generation:Er,analytics:bl,task_management:bt,calendar:yt,settings:ys,upload:vs,export:qn})[E]||Bn,j=E=>({authentication:"text-blue-600",navigation:"text-green-600",chat:"text-purple-600",crm:"text-pink-600",lead_generation:"text-orange-600",analytics:"text-indigo-600",task_management:"text-teal-600",calendar:"text-red-600",settings:"text-gray-600",upload:"text-yellow-600",export:"text-emerald-600"})[E]||"text-gray-600",S=E=>{switch(E){case"success":return r.jsx(bt,{className:"w-4 h-4 text-green-600"});case"error":return r.jsx(Ql,{className:"w-4 h-4 text-red-600"});case"pending":return r.jsx(R4,{className:"w-4 h-4 text-yellow-600"});default:return r.jsx(bt,{className:"w-4 h-4 text-gray-400"})}},_=E=>new Date(E).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0});return s&&!o?r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx(ri,{title:"Usage Analytics",description:"Loading your activity data...",icon:bl,themeColor:"indigo"}),r.jsx("div",{className:"flex-1 flex items-center justify-center",children:r.jsxs("div",{className:"animate-pulse space-y-4 w-full max-w-4xl mx-auto p-6",children:[r.jsx("div",{className:"grid grid-cols-4 gap-4",children:[1,2,3,4].map(E=>r.jsx("div",{className:"h-24 bg-gray-200 rounded"},E))}),r.jsx("div",{className:"h-80 bg-gray-200 rounded"})]})})]}):i?r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx(ri,{title:"Usage Analytics",description:"Error loading analytics data",icon:bl,themeColor:"indigo"}),r.jsx("div",{className:"flex-1 flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Cr,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Failed to Load Analytics"}),r.jsx("p",{className:"text-gray-600 mb-4",children:i}),r.jsxs(H,{onClick:w,className:"bg-indigo-600 hover:bg-indigo-700",children:[r.jsx(Be,{className:"w-4 h-4 mr-2"}),"Try Again"]})]})})]}):r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx(ri,{title:"Usage Analytics",description:"Track and analyze your platform usage patterns",icon:bl,themeColor:"indigo",tabs:[{id:"1",label:"Today",isActive:t==="1",onClick:()=>n("1")},{id:"7",label:"Week",isActive:t==="7",onClick:()=>n("7")},{id:"30",label:"Month",isActive:t==="30",onClick:()=>n("30")},{id:"90",label:"3 Months",isActive:t==="90",onClick:()=>n("90")}]}),r.jsx("div",{className:"bg-white border-b",children:r.jsx(TC,{config:{primaryAction:{primaryLabel:"Export Data",onPrimaryAction:N,loading:!1},overflowActions:[{label:"Refresh Data",onClick:w,icon:r.jsx(Be,{className:"w-4 h-4"})},{label:"Clear Filter",onClick:()=>y(null),icon:r.jsx(da,{className:"w-4 h-4"}),disabled:!f}],themeColor:"indigo"}})}),r.jsx("div",{className:"flex-1 p-6 overflow-y-auto bg-gray-50",children:r.jsxs("div",{className:"space-y-6 max-w-7xl mx-auto",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[r.jsx(We,{children:r.jsx(it,{className:"p-6",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Activities"}),r.jsx("p",{className:"text-3xl font-bold text-indigo-600",children:(o==null?void 0:o.total_activities)||0})]}),r.jsx(Bn,{className:"w-8 h-8 text-indigo-600"})]})})}),r.jsx(We,{children:r.jsx(it,{className:"p-6",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Sessions"}),r.jsx("p",{className:"text-3xl font-bold text-green-600",children:(o==null?void 0:o.total_sessions)||0})]}),r.jsx(kt,{className:"w-8 h-8 text-green-600"})]})})}),r.jsx(We,{children:r.jsx(it,{className:"p-6",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Session"}),r.jsx("p",{className:"text-3xl font-bold text-purple-600",children:Bs.formatDuration((o==null?void 0:o.average_session_duration_ms)||0)})]}),r.jsx(sP,{className:"w-8 h-8 text-purple-600"})]})})}),r.jsx(We,{children:r.jsx(it,{className:"p-6",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Error Rate"}),r.jsxs("p",{className:"text-3xl font-bold text-red-600",children:[((C=o==null?void 0:o.error_rate)==null?void 0:C.toFixed(1))||0,"%"]})]}),r.jsx(Cr,{className:"w-8 h-8 text-red-600"})]})})})]}),r.jsxs(We,{children:[r.jsx(ir,{children:r.jsxs(cr,{className:"flex items-center gap-2",children:[r.jsx(bl,{className:"w-5 h-5 text-indigo-600"}),"Activity by Type",f&&r.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(Filtered by ",f,")"]})]})}),r.jsx(it,{children:r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(D=o==null?void 0:o.activity_by_type)==null?void 0:D.map(E=>{const T=k(E.action_type),M=j(E.action_type);return r.jsxs("div",{onClick:()=>y(f===E.action_type?null:E.action_type),className:`p-4 rounded-lg border-2 cursor-pointer transition-all ${f===E.action_type?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx(T,{className:`w-6 h-6 ${M}`}),r.jsx("span",{className:"text-2xl font-bold text-gray-900",children:E.count})]}),r.jsx("div",{className:"text-sm font-medium text-gray-900 capitalize",children:E.action_type.replace(/_/g," ")}),r.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[E.errors>0&&r.jsxs("span",{className:"text-red-600",children:[E.errors," errors"]}),E.avg_duration_ms&&r.jsxs("span",{className:"ml-2",children:["Avg: ",Bs.formatDuration(E.avg_duration_ms)]})]})]},E.action_type)})})})]}),r.jsxs(We,{children:[r.jsx(ir,{children:r.jsxs(cr,{className:"flex items-center gap-2",children:[r.jsx(jt,{className:"w-5 h-5 text-blue-600"}),"Recent Activities",r.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(Last ",d.length," actions)"]})]})}),r.jsx(it,{children:r.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[d.map(E=>{const T=k(E.action_type),M=j(E.action_type);return r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(T,{className:`w-5 h-5 ${M}`}),r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-gray-900",children:Bs.formatActionLabel(E.action_type,E.action_name)}),r.jsxs("div",{className:"text-sm text-gray-500",children:[_(E.timestamp),E.pageName&&`  ${E.pageName}`,E.service_name&&`  ${E.service_name}`]})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[S(E.result_status),E.durationFormatted&&r.jsx("span",{className:"text-xs text-gray-500",children:E.durationFormatted})]})]},E.id)}),d.length===0&&r.jsx("div",{className:"text-center py-8 text-gray-500",children:"No activities found for the selected time period."})]})})]}),((A=o==null?void 0:o.top_pages)==null?void 0:A.length)>0&&r.jsxs(We,{children:[r.jsx(ir,{children:r.jsxs(cr,{className:"flex items-center gap-2",children:[r.jsx(Sf,{className:"w-5 h-5 text-green-600"}),"Most Visited Pages"]})}),r.jsx(it,{children:r.jsx("div",{className:"space-y-3",children:o.top_pages.map((E,T)=>r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:"w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center text-sm font-medium",children:T+1}),r.jsx("span",{className:"font-medium",children:Bs.extractPageName(E.page_url)||E.page_url})]}),r.jsxs("span",{className:"text-gray-600",children:[E.visits," visits"]})]},E.page_url))})})]}),r.jsxs(We,{children:[r.jsx(ir,{children:r.jsxs(cr,{className:"flex items-center gap-2",children:[r.jsx(CA,{className:"w-5 h-5 text-purple-600"}),"Recent Sessions"]})}),r.jsx(it,{children:r.jsxs("div",{className:"space-y-3",children:[m.map(E=>{var T;return r.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("div",{className:"font-medium text-gray-900",children:["Session ",E.session_id.substring(0,8),"..."]}),r.jsx("div",{className:"text-sm text-gray-600",children:E.durationFormatted})]}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-500",children:"Started: "}),r.jsx("span",{className:"font-medium",children:_(E.session_start)})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-500",children:"Actions: "}),r.jsx("span",{className:"font-medium",children:E.total_actions})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-500",children:"Chat: "}),r.jsx("span",{className:"font-medium",children:E.chat_messages_sent})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-500",children:"CRM: "}),r.jsx("span",{className:"font-medium",children:E.crm_interactions})]})]}),((T=E.key_accomplishments)==null?void 0:T.length)>0&&r.jsxs("div",{className:"mt-2",children:[r.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Key Accomplishments:"}),r.jsx("div",{className:"flex flex-wrap gap-1",children:E.key_accomplishments.map((M,L)=>r.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded",children:M},L))})]})]},E.id)}),m.length===0&&r.jsx("div",{className:"text-center py-8 text-gray-500",children:"No sessions found for the selected time period."})]})})]})]})})]})},Nl=({children:e,value:t,onValueChange:n,className:s,size:a="default",...i})=>{const l={sm:"h-8 px-2 py-1 text-xs pr-6",default:"h-9 px-3 py-2 text-sm pr-8",lg:"h-10 px-4 py-2 text-base pr-10"};return r.jsxs("div",{className:"relative",children:[r.jsx("select",{value:t,onChange:o=>n==null?void 0:n(o.target.value),className:tr("flex w-full items-center justify-between rounded-lg border border-slate-200 bg-white text-slate-900 shadow-sm transition-all duration-200","hover:border-slate-300 hover:bg-slate-50","focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500","disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-slate-50","appearance-none cursor-pointer",l[a],s),...i,children:e}),r.jsx(Xt,{className:tr("absolute right-2 top-1/2 transform -translate-y-1/2 opacity-50 pointer-events-none transition-transform duration-200",a==="sm"?"h-3 w-3":a==="lg"?"h-5 w-5":"h-4 w-4")})]})},wr=({children:e,value:t,...n})=>r.jsx("option",{value:t,...n,children:e}),uC="http://localhost:8004";function _re(){const e=localStorage.getItem("id_token");if(!e||e==="null"||e==="undefined")throw new Ea("No authentication token found");return e}async function Gm(e,t={}){try{const s={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${_re()}`}},a={...s,...t,headers:{...s.headers,...t.headers}};console.log(` Making HTTP request to: ${uC}${e}`);const i=await fetch(`${uC}${e}`,a);if(!i.ok)throw new Ea(`HTTP request failed: ${i.status} ${i.statusText}`,i.status);const l=await i.json();return console.log(" HTTP request completed successfully"),l}catch(n){throw console.error(" HTTP request error:",n),n instanceof Ea?n:new Ea(`Request failed: ${n.message}`)}}class Ea extends Error{constructor(t,n=null,s=null){super(t),this.name="NewsApiError",this.status=n,this.data=s}}const mC=new Map;async function Ere(e){try{console.log(" Fetching full article content via HTTP from:",e);const t=await Gm("/api/agents/news/full-article",{method:"POST",body:JSON.stringify({url:e})});if(console.log(" Full article response via HTTP:",t),t.success&&t.result)return console.log(" Full article content extracted successfully via HTTP"),console.log(` Word count: ${t.result.word_count} words`),{success:!0,url:t.result.url||e,title:t.result.title||"Article Title",full_content:t.result.full_content||t.result.content||"Content not available",author:t.result.author||"Unknown",publish_date:t.result.publish_date||"",image_url:t.result.image_url||"",word_count:t.result.word_count||0,read_time:t.result.read_time||"5 min read",meta_description:t.result.meta_description||"",extracted_at:t.result.extracted_at||new Date().toISOString(),extraction_error:t.result.extraction_error||null};throw console.error(" Failed to fetch article via HTTP:",t),new Ea("Failed to fetch full article content via HTTP",null,t)}catch(t){return console.error(" Error fetching full article:",t),{success:!1,url:e,title:"Unable to Extract Article",full_content:`Unable to extract the full content from this article. This may be due to:

 The website blocking automated content extraction
 The article being behind a paywall
 Technical issues with the content scraper

Please try clicking "Read Full Article" to view the original article on the publisher's website.`,author:"Unknown",publish_date:"",image_url:"",word_count:0,read_time:"Unknown",meta_description:"",extracted_at:new Date().toISOString(),extraction_error:t.message||"Content extraction failed"}}}async function Dre(e){try{console.log(" Requesting AI analysis via HTTP for:",e.title);const t={title:e.title||"",summary:e.summary||e.description||"",url:e.url||"",source:e.source||"",full_content:e.full_content||""},n=await Gm("/api/agents/news/analyze",{method:"POST",body:JSON.stringify(t)});if(n.success&&n.result)return console.log(" AI analysis completed successfully via HTTP"),n.result;throw new Ea("Failed to analyze article via HTTP",null,n)}catch(t){return console.error(" Error analyzing article via HTTP:",t),{success:!1,error:t.message,article_title:e.title||"",article_url:e.url||"",analysis:{facts:["Analysis service temporarily unavailable"],impact:"Unable to provide analysis at this time",actions:["Please try again later"]},analyzed_at:new Date().toISOString()}}}async function Tre(e){try{console.log(" Fetching user industries via HTTP for:",e);const t=await Gm("/api/agents/news/user-industries",{method:"POST",body:JSON.stringify({user_email:e})});if(t.success&&t.result){const n=t.result;if(n.success)return console.log(" Retrieved industries via HTTP:",n.industries),{success:!0,industries:n.industries||[],count:n.count||0,source:n.source||"unknown",fetched_at:n.fetched_at,user_email:n.user_email};throw new Ea("Failed to get user industries via HTTP",null,n)}else throw new Ea("Failed to call industries API via HTTP",null,t)}catch(t){return console.error(" Error getting user industries via HTTP:",t),{success:!1,error:t.message,industries:["Technology","Finance","Healthcare","Manufacturing","Retail","Real Estate","Education","Energy","Automotive","Media"],count:10,fallback:!0}}}async function hC(e,t="business",n=10){try{console.log(` Searching news for keywords via HTTP: "${e}" in ${t}`);for(const i of mC.keys())(i.includes("daily_news")||i.includes("search"))&&mC.delete(i);const a=await Gm("/api/agents/news/search",{method:"POST",body:JSON.stringify({keywords:e,category:t,limit:n})});if(a.success&&a.result){const i={success:!0,articles:a.result.articles||[],category:a.result.category||t,keywords:a.result.keywords||e,source:a.result.source||"Google News Search",total:a.result.total||(a.result.articles?a.result.articles.length:0),timestamp:new Date().toISOString()};return console.log(` Search completed: ${i.articles.length} articles found`),i}else throw new Ea("Failed to search news by keywords via HTTP",null,a)}catch(s){throw console.error(" Error searching news by keywords via HTTP:",s),s}}const Are=({userEmail:e,onIndustriesChange:t,selectedIndustries:n=[]})=>{const[s,a]=h.useState([]),[i,l]=h.useState(!1),[o,c]=h.useState(null),[d,u]=h.useState(!1),m=async()=>{if(!e){c("User email not provided");return}l(!0),c(null);try{const g=await Tre(e);g.success?(a(g.industries),u(!1)):(a(g.industries),u(!0),c("Using default industry list"))}catch(g){c(g.message),a(["Technology","Finance","Healthcare","Manufacturing","Retail","Real Estate","Education","Energy","Automotive","Media"]),u(!0)}finally{l(!1)}};h.useEffect(()=>{m()},[e]);const p=g=>{const x=n.includes(g)?n.filter(b=>b!==g):[...n,g];t(x)},f=()=>{n.length===s.length?t([]):t([...s])},y=()=>{t([])};return r.jsxs(We,{className:"border-0 shadow-sm bg-gradient-to-r from-blue-50 to-indigo-50",children:[r.jsxs(ir,{className:"pb-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(kf,{className:"w-5 h-5 text-blue-600"}),r.jsx(cr,{className:"text-base font-semibold text-gray-800",children:"Select Industries"}),d&&r.jsx(an,{variant:"outline",className:"text-xs text-amber-600 border-amber-300",children:"Default List"})]}),r.jsx(H,{onClick:m,disabled:i,variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:i?r.jsx(Ct,{className:"w-3 h-3 animate-spin"}):r.jsx(Be,{className:"w-3 h-3"})})]}),o&&r.jsxs("div",{className:"text-sm text-amber-700 bg-amber-50 border border-amber-200 rounded-md p-2 mt-2",children:[" ",o]})]}),r.jsx(it,{children:i?r.jsxs("div",{className:"flex items-center justify-center py-6",children:[r.jsx(Ct,{className:"w-5 h-5 animate-spin text-blue-600"}),r.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Loading industries..."})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx(H,{onClick:f,variant:"outline",size:"sm",className:"text-xs h-7 px-3",children:n.length===s.length?"Deselect All":"Select All"}),r.jsx(H,{onClick:y,variant:"outline",size:"sm",className:"text-xs h-7 px-3",disabled:n.length===0,children:"Clear"}),r.jsxs("div",{className:"text-xs text-gray-500 ml-auto",children:[n.length," of ",s.length," selected"]})]}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:r.jsx(ht,{children:s.map((g,x)=>{const b=n.includes(g);return r.jsx(de.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{delay:x*.02},children:r.jsx("div",{className:`
                          relative p-2.5 rounded-md border cursor-pointer transition-all duration-150 hover:scale-[1.02]
                          ${b?"border-blue-400 bg-blue-100 shadow-sm ring-1 ring-blue-200":"border-gray-200 bg-white hover:border-blue-200 hover:bg-blue-50"}
                        `,onClick:()=>p(g),children:r.jsxs("div",{className:"flex items-center gap-2",children:[b?r.jsx(na,{className:"w-3.5 h-3.5 text-blue-600 flex-shrink-0"}):r.jsx(Gi,{className:"w-3.5 h-3.5 text-gray-400 flex-shrink-0"}),r.jsx("span",{className:`text-xs font-medium truncate ${b?"text-blue-800":"text-gray-700"}`,children:g})]})})},g)})})}),s.length===0&&!i&&r.jsxs("div",{className:"text-center py-6 text-gray-500",children:[r.jsx(kf,{className:"w-10 h-10 mx-auto mb-2 text-gray-300"}),r.jsx("p",{className:"text-sm",children:"No industries available"}),r.jsx(H,{onClick:m,variant:"outline",size:"sm",className:"mt-2 h-7 text-xs",children:"Reload"})]}),n.length>0&&r.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[r.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Selected industries:"}),r.jsx("div",{className:"flex flex-wrap gap-1",children:n.map(g=>r.jsxs(an,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-red-100 transition-colors",onClick:()=>p(g),children:[g," "]},g))})]})]})})]})},Pre=({isOpen:e,onClose:t,article:n,onGetAISummary:s})=>{var S,_,C,D;const[a,i]=h.useState(null),[l,o]=h.useState(!1),[c,d]=h.useState(null),[u,m]=h.useState(null),[p,f]=h.useState(!1),[y,g]=h.useState(null),[x,b]=h.useState(null),[v,w]=h.useState(!1),[N,k]=h.useState(null);h.useEffect(()=>{e&&n&&(i(null),d(null),o(!1),m(null),g(null),f(!1),b(null),k(null),w(!1))},[e,n]);const j=async()=>{if(!(!n||v)){w(!0),k(null);try{console.log(" Requesting analysis for:",n.title);let A=n;if(!n.full_content&&n.url){console.log(" Fetching full article content first...");try{const T=await Ere(n.url);T.success&&T.result&&(A={...n,full_content:T.result.content||T.result.full_content},console.log(" Full article content fetched successfully"))}catch(T){console.warn(" Could not fetch full content, proceeding with available content:",T)}}const E=await Dre(A);b(E)}catch(A){console.error(" Error getting analysis:",A),k(A.message||"Failed to analyze article")}finally{w(!1)}}};return!e||!n?null:r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-lg flex items-center justify-center",children:r.jsx(FC,{className:"w-5 h-5 text-white"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"News Article Details"}),r.jsx("p",{className:"text-sm text-gray-500",children:"AI-powered news analysis"})]})]}),r.jsx(H,{variant:"ghost",size:"sm",onClick:t,className:"text-gray-400 hover:text-gray-600",children:r.jsx(Ze,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:[r.jsxs("div",{className:"mb-6",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx(an,{variant:"outline",className:"font-medium",children:((S=n.category)==null?void 0:S.charAt(0).toUpperCase())+((_=n.category)==null?void 0:_.slice(1))||"News"}),n.trending&&r.jsx(an,{variant:"default",className:"bg-orange-100 text-orange-800 border-orange-200",children:" Trending"})]}),r.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4 leading-tight",children:n.title}),r.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-4",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(_t,{className:"w-4 h-4"}),r.jsx("span",{children:n.source})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(jt,{className:"w-4 h-4"}),r.jsx("span",{children:n.time})]}),r.jsx("div",{className:"flex items-center gap-1",children:r.jsx("span",{children:n.readTime})})]})]}),n.imageUrl&&r.jsx("div",{className:"mb-6",children:r.jsx("img",{src:n.imageUrl,alt:n.title,className:"w-full h-64 object-cover rounded-lg",onError:A=>{A.target.style.display="none"}})}),r.jsx(We,{className:"mb-6",children:r.jsxs(it,{className:"p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Mr,{className:"w-5 h-5 text-indigo-600"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"AI Business Analysis"})]}),r.jsx(H,{onClick:j,disabled:v,variant:"outline",size:"sm",children:v?r.jsxs(r.Fragment,{children:[r.jsx(Ct,{className:"w-4 h-4 mr-2 animate-spin"}),"Analyzing..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Mr,{className:"w-4 h-4 mr-2"}),x?"Refresh Analysis":"Show Analysis"]})})]}),N&&r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:r.jsxs("p",{className:"text-red-700 text-sm",children:[" ",N]})}),x&&x.analysis&&r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-3 flex items-center gap-2",children:" Key Facts"}),r.jsx("ul",{className:"space-y-2",children:(C=x.analysis.facts)==null?void 0:C.map((A,E)=>r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),r.jsx("span",{className:"text-sm text-gray-700",children:A})]},E))})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-3 flex items-center gap-2",children:" Business Impact"}),r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsx("p",{className:"text-sm text-gray-700",children:x.analysis.impact})})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-3 flex items-center gap-2",children:" Recommended Actions"}),r.jsx("ul",{className:"space-y-2",children:(D=x.analysis.actions)==null?void 0:D.map((A,E)=>r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full mt-2 flex-shrink-0"}),r.jsx("span",{className:"text-sm text-gray-700",children:A})]},E))})]}),x.analyzed_at&&r.jsxs("div",{className:"text-xs text-gray-500 pt-4 border-t border-gray-200",children:["Analysis generated at: ",new Date(x.analyzed_at).toLocaleString()]})]}),!x&&!v&&!N&&r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx(Mr,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),r.jsx("p",{className:"text-sm",children:'Click "Show Analysis" to get AI-powered business insights'})]})]})}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs(H,{onClick:()=>window.open(n.url,"_blank","noopener,noreferrer"),className:"flex-1",children:[r.jsx(sa,{className:"w-4 h-4 mr-2"}),"Read Full Article"]}),r.jsx(H,{variant:"outline",onClick:t,children:"Close"})]})]})]})})},fc=new Map,IT=5*60*1e3,Ore=()=>{const e=Date.now();for(const[t,n]of fc.entries())e-n.timestamp>IT&&fc.delete(t)},Mre=()=>{fc.clear(),console.log(" All meeting cache cleared")};typeof window<"u"&&(window.clearMeetingCache=Mre);const Ire=({isOpen:e,onClose:t,meetingId:n,meeting:s})=>{var x,b;const[a,i]=h.useState(null),[l,o]=h.useState(!1),[c,d]=h.useState(null),[u,m]=h.useState("summary"),p=()=>"https://meeting-agent-prelude-platform-uc.a.run.app",f=h.useCallback(async(v=!1)=>{if(!n){s&&i({id:s.id,title:s.meetingTitle||s.title,date:s.date,duration:s.duration||s.durationMin,host:s.host||"Unknown",participants:s.attendees||[],summary:s.summary||"No summary available",recordings:[],transcript:{available:!1,content:"No transcript available"}});return}if(Ore(),!v){const w=fc.get(n);if(w&&Date.now()-w.timestamp<IT){console.log(" Using cached meeting data for:",n),i(w.data);return}}o(!0),d(null);try{console.log(" Fetching fresh meeting data for:",n);const w=await fetch(`${p()}/meetings/${n}/details`);if(w.ok){const k=(await w.json()).meeting;fc.set(n,{data:k,timestamp:Date.now()}),i(k),console.log(" Meeting data cached for:",n)}else d("Failed to load meeting details")}catch(w){console.error("Error fetching meeting details:",w),d("Failed to load meeting details")}finally{o(!1)}},[n,s]);h.useEffect(()=>{e&&f()},[e,n,f]);const y=v=>{if(!v)return"Unknown date";try{return new Date(v).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return v}},g=v=>v?typeof v=="string"&&v.includes("MB")?v:`${(v/(1024*1024)).toFixed(1)} MB`:"Unknown size";return r.jsx(ht,{mode:"wait",children:e&&r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black/50 z-50 flex justify-center pt-8 px-8",onClick:t,children:r.jsxs(de.div,{initial:{scale:.9,y:20,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.9,y:20,opacity:0},transition:{duration:.2,ease:"easeOut"},className:"w-full bg-white rounded-t-lg shadow-2xl relative h-full flex flex-col overflow-hidden",onClick:v=>v.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gray-50",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:l?"Loading...":(a==null?void 0:a.title)||"Meeting Details"}),r.jsx(H,{variant:"ghost",size:"sm",onClick:t,className:"text-gray-500 hover:text-gray-700",children:r.jsx(Ze,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"flex flex-col flex-1 overflow-hidden",children:l?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"flex border-b border-gray-200",children:[1,2,3].map(v=>r.jsxs("div",{className:"px-6 py-3 flex items-center gap-2",children:[r.jsx("div",{className:"w-4 h-4 bg-gray-200 rounded animate-pulse"}),r.jsx("div",{className:"w-20 h-4 bg-gray-200 rounded animate-pulse"})]},v))}),r.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"space-y-2",children:r.jsx("div",{className:"w-3/4 h-8 bg-gray-200 rounded animate-pulse"})}),r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:r.jsx("div",{className:"w-48 h-6 bg-gray-200 rounded animate-pulse"})}),r.jsx("div",{className:"px-6 py-4",children:r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[1,2,3,4].map(v=>r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded animate-pulse"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"w-16 h-3 bg-gray-200 rounded animate-pulse mb-1"}),r.jsx("div",{className:"w-24 h-4 bg-gray-200 rounded animate-pulse"})]})]},v))})})]}),r.jsx("div",{className:"space-y-4",children:[1,2,3].map(v=>r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:r.jsx("div",{className:"w-32 h-6 bg-gray-200 rounded animate-pulse"})}),r.jsx("div",{className:"px-6 py-4 space-y-3",children:[1,2,3].map(w=>r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"w-2 h-2 bg-gray-200 rounded-full animate-pulse mt-2"}),r.jsxs("div",{className:"flex-1 space-y-1",children:[r.jsx("div",{className:"w-full h-4 bg-gray-200 rounded animate-pulse"}),r.jsx("div",{className:"w-3/4 h-4 bg-gray-200 rounded animate-pulse"})]})]},w))})]},v))}),r.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(v=>r.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse",style:{width:`${Math.random()*40+60}%`}},v))})]})})]}):c?r.jsx("div",{className:"flex items-center justify-center p-12",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-500 mb-4",children:c}),r.jsx(H,{onClick:f,variant:"outline",children:"Try Again"})]})}):a?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex border-b border-gray-200",children:[r.jsxs("button",{onClick:()=>m("summary"),className:`px-6 py-3 text-sm font-medium border-b-2 transition-colors ${u==="summary"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(Ut,{className:"w-4 h-4 inline-block mr-2"}),"Overview"]}),r.jsxs("button",{onClick:()=>m("recordings"),className:`px-6 py-3 text-sm font-medium border-b-2 transition-colors ${u==="recordings"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(sb,{className:"w-4 h-4 inline-block mr-2"}),"Recordings (",((x=a.recordings)==null?void 0:x.length)||0,")"]}),r.jsxs("button",{onClick:()=>m("transcript"),className:`px-6 py-3 text-sm font-medium border-b-2 transition-colors ${u==="transcript"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(db,{className:"w-4 h-4 inline-block mr-2"}),"Transcript"]})]}),r.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[u==="summary"&&r.jsxs("div",{className:"space-y-6",children:[typeof a.summary=="object"&&a.summary.type==="structured_overview"?r.jsxs(r.Fragment,{children:[r.jsx("div",{children:r.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[" ",a.summary.title]})}),r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:r.jsx("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:" Meeting Information"})}),r.jsx("div",{className:"px-6 py-4",children:r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(yt,{className:"w-5 h-5 text-blue-500"}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm text-gray-500",children:"Date"}),r.jsx("div",{className:"font-medium",children:a.summary.meeting_info.date})]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(jt,{className:"w-5 h-5 text-green-500"}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm text-gray-500",children:"Time"}),r.jsx("div",{className:"font-medium",children:a.summary.meeting_info.time})]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(jt,{className:"w-5 h-5 text-orange-500"}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm text-gray-500",children:"Duration"}),r.jsx("div",{className:"font-medium",children:a.summary.meeting_info.duration})]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(_t,{className:"w-5 h-5 text-purple-500"}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm text-gray-500",children:"Host"}),r.jsx("div",{className:"font-medium",children:a.summary.meeting_info.host})]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(kt,{className:"w-5 h-5 text-indigo-500"}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm text-gray-500",children:"Participants"}),r.jsx("div",{className:"font-medium",children:a.summary.meeting_info.participants||a.summary.meeting_info.attendees||(Array.isArray(a.participants)?`${a.participants.length}`:a.attendees||"Unknown")})]})]}),a.summary.meeting_info.meeting_id&&r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Ut,{className:"w-5 h-5 text-gray-500"}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm text-gray-500",children:"Meeting ID"}),r.jsx("div",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:a.summary.meeting_info.meeting_id})]})]})]})})]}),r.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),r.jsx("h3",{className:"text-lg font-semibold text-green-800 flex items-center gap-2",children:" Meeting Status"})]}),r.jsx("div",{className:"mt-2",children:r.jsxs("div",{className:"text-green-700 font-medium",children:[" ",a.summary.status.status_text]})})]})]}):r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Meeting Overview"}),r.jsx("div",{className:"bg-gray-50 rounded-lg p-4 max-h-96 overflow-y-auto",children:r.jsx("div",{className:"text-gray-700 leading-relaxed whitespace-pre-line",children:typeof a.summary=="string"?a.summary:JSON.stringify(a.summary,null,2)})})]}),Array.isArray(a.participants)&&a.participants.length>0&&r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Participants"}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:a.participants.map((v,w)=>r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[r.jsx(_t,{className:"w-4 h-4"}),r.jsx("span",{children:v.name||v.email||`Participant ${w+1}`})]},w))})]})]}),u==="recordings"&&r.jsx("div",{className:"space-y-4",children:a.recordings&&a.recordings.length>0?a.recordings.map((v,w)=>{var N;return r.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:((N=v.recording_type)==null?void 0:N.replace(/_/g," ").toUpperCase())||"Recording"}),r.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[r.jsxs("p",{children:["Size: ",g(v.file_size)]}),v.recording_start&&r.jsxs("p",{children:["Duration: ",y(v.recording_start)," - ",y(v.recording_end)]})]})]}),r.jsxs("div",{className:"flex gap-2 ml-4",children:[v.play_url&&r.jsxs(H,{size:"sm",onClick:()=>window.open(v.play_url,"_blank"),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[r.jsx(ax,{className:"w-4 h-4 mr-2 text-white"}),"Play"]}),v.download_url&&r.jsxs(H,{size:"sm",variant:"outline",onClick:()=>window.open(v.download_url,"_blank"),className:"border border-gray-300 hover:bg-gray-100",children:[r.jsx(ra,{className:"w-4 h-4 mr-2"}),"Download"]})]})]})},v.id||w)}):r.jsxs("div",{className:"text-center py-8",children:[r.jsx(sb,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-500",children:"No recordings available for this meeting"})]})}),u==="transcript"&&r.jsx("div",{className:"space-y-4",children:(b=a.transcript)!=null&&b.available?r.jsxs("div",{children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("h3",{className:"font-semibold text-gray-900",children:"Meeting Transcript"}),r.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Full transcript of the meeting conversation"})]}),r.jsx("div",{className:"bg-gray-50 rounded-lg p-4 max-h-[500px] overflow-y-auto",children:r.jsx("div",{className:"prose prose-sm max-w-none",children:r.jsx("div",{className:"whitespace-pre-wrap text-sm text-gray-800 leading-relaxed",children:a.transcript.content})})})]}):r.jsxs("div",{className:"text-center py-8",children:[r.jsx(db,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-500",children:"No transcript available for this meeting"}),r.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Transcripts are only available if recording was enabled with transcription"})]})})]})]}):r.jsx("div",{className:"flex items-center justify-center p-12",children:r.jsx("p",{className:"text-gray-500",children:"No meeting details available"})})})]})})})},jd=3,yl=5,Lre=()=>{const e=[{id:"n1",source:"gmail",title:"Project Budget Approval Needed",content:"Finance team requires your approval for Q4 marketing budget. Please review and respond by EOD.",sender:"Sarah Chen",senderEmail:"sarah.chen@company.com",time:"2 minutes ago",priority:"high",unread:!0,category:"work",favorite:!1},{id:"n2",source:"slack",title:"Engineering Team",content:"@james The deployment is ready for review. Can you check the staging environment when you have a moment?",sender:"Mike Johnson",channel:"#engineering",time:"5 minutes ago",priority:"medium",unread:!0,category:"work",favorite:!0},{id:"n3",source:"phone",title:"Missed Call",content:"Missed call from client about project timeline. Left voicemail requesting callback.",sender:"Alex Rivera",phoneNumber:"+1 (555) 123-4567",time:"15 minutes ago",priority:"high",unread:!0,category:"client",favorite:!1},{id:"n4",source:"sms",title:"Meeting Reminder",content:"Reminder: Product demo with TechCorp at 3:00 PM today. Conference room A.",sender:"Calendar Assistant",time:"30 minutes ago",priority:"medium",unread:!1,category:"meeting",favorite:!1},{id:"n5",source:"slack",title:"Marketing Team",content:"Great job on the campaign launch! Engagement is up 40% already ",sender:"Lisa Park",channel:"#marketing",time:"45 minutes ago",priority:"low",unread:!1,category:"achievement",favorite:!0}],[t,n]=h.useState("notifications"),[s,a]=h.useState(""),[i,l]=h.useState(1),[o,c]=h.useState("all"),[d,u]=h.useState(e),[m,p]=h.useState(!1),[f,y]=h.useState([]),[g,x]=h.useState([]),[b,v]=h.useState(!1),[w,N]=h.useState("Please select industries to view relevant news"),[k,j]=h.useState(null),[S,_]=h.useState(""),[C,D]=h.useState(!1),[A,E]=h.useState("all"),[T,M]=h.useState(!1),[L,P]=h.useState([]),[$,R]=h.useState(!0),[U,I]=h.useState(1),[z,F]=h.useState([]),[O,K]=h.useState(null),[J,se]=h.useState(!1),[Z,oe]=h.useState(!1),[W,B]=h.useState(null),[V,re]=h.useState(!1),[Me,he]=h.useState(!1),[G,q]=h.useState(!1),[Q,ue]=h.useState([]),[Le,ge]=h.useState(!1),[Se,ce]=h.useState(null),[ke,Pe]=h.useState(!1),qe=[{value:"all",label:"All News",icon:""},{value:"trending",label:"Trending",icon:""},{value:"mainstream",label:"Mainstream Sources",icon:""},{value:"business",label:"Business",icon:""},{value:"technology",label:"Technology",icon:""},{value:"recent",label:"Recent (24h)",icon:""},{value:"international",label:"International",icon:""}],ne=(Y,me)=>{if(!Y||Y.length===0)return[];switch(me){case"all":return Y;case"trending":return Y.filter(_e=>_e.trending);case"mainstream":return Y.filter(_e=>{const Nt=_e.source.toLowerCase();return["cnn","bbc","reuters","techcrunch","cnbc","wired","guardian"].some(Ft=>Nt.includes(Ft))});case"business":return Y.filter(_e=>_e.category==="business"||_e.title.toLowerCase().includes("business")||_e.summary.toLowerCase().includes("business"));case"technology":return Y.filter(_e=>_e.category==="technology"||_e.title.toLowerCase().includes("tech")||_e.title.toLowerCase().includes("ai")||_e.summary.toLowerCase().includes("technology"));case"recent":return Y.filter(_e=>{const Nt=_e.time.toLowerCase();return Nt.includes("hour")||Nt.includes("minute")||Nt.includes("just now")});case"international":return Y.filter(_e=>{const Nt=_e.source.toLowerCase(),Ft=_e.title.toLowerCase(),rr=_e.summary.toLowerCase();return["bbc","reuters","guardian","international","global","world"].some(Yt=>Nt.includes(Yt)||Ft.includes(Yt)||rr.includes(Yt))});default:return Y}},ye=async(Y="business",me=!1)=>{if(!(b&&!me)){v(!0),N(null);try{if(L.length>0){console.log(" Searching news by industries via Google News:",{industries:L,category:Y,forceRefresh:me});const _e=L.map(Ft=>`${Ft} news OR ${Ft} industry OR ${Ft} market OR ${Ft} business`).join(" OR ");console.log(" Search keywords:",_e);const Nt=await hC(_e,"general",20);if(Nt.success&&Nt.articles&&Nt.articles.length>0){x(Nt.articles);const Ft=ne(Nt.articles,A);y(Ft),j(new Date().toISOString()),console.log(" Industry-based Google News search completed:",Nt.articles.length,"articles")}else throw new Error(Nt.error||`No news articles found for industries: ${L.join(", ")}`)}else console.log(" No industries selected, prompting user to select industries"),y([]),x([]),N("Please select industries to view relevant news")}catch(_e){console.error(" Error fetching news:",_e),N(_e.message||"Failed to fetch news"),y([]),x([])}finally{v(!1)}}},Ee=Y=>{P(Y),Y.length>0?ye("general",!0):(y([]),x([]),N("Please select industries to view relevant news"))},st=async Y=>{if(Y.trim()){v(!0),N(null),D(!0);try{console.log(" Searching news for:",Y);const me=await hC(Y,"business",20);if(me.success&&me.articles&&me.articles.length>0){x(me.articles);const _e=ne(me.articles,A);y(_e),j(new Date().toISOString()),N(null),console.log(" Search completed:",me.articles.length,"articles found")}else x([]),y([]),N(`No articles found for "${Y}"`),console.warn(" No articles found for keywords:",Y)}catch(me){console.error(" Error searching news:",me),N(me.message||"Failed to search news"),y([]),x([])}finally{v(!1)}}},Ke=Y=>{E(Y),M(!1);const me=ne(g,Y);y(me)},At=Y=>{K(Y),se(!0)},lt=async Y=>`AI Summary for "${Y.title}": This is a placeholder AI summary. The actual implementation would call an AI service to generate a summary of the article content.`;h.useEffect(()=>{const Y=(U-1)*yl,me=Y+yl;F(f.slice(Y,me))},[f,U]),h.useEffect(()=>{I(1)},[A,C]),h.useEffect(()=>{const Y=me=>{T&&!me.target.closest(".filter-dropdown")&&M(!1)};return document.addEventListener("mousedown",Y),()=>{document.removeEventListener("mousedown",Y)}},[T]);const Ht=[{id:"meetings",label:"Meeting Agent",icon:kt},{id:"notifications",label:"Notification Digest",icon:Yi},{id:"news",label:"Daily News",icon:Zm}],pt=h.useCallback(async()=>{ge(!0);try{const Y=await fetch(`${Oe()}/meetings/recent-summaries?limit=10`);if(Y.ok){const me=await Y.json();me.success&&me.summaries?(ue(me.summaries),console.log(" Fetched meeting summaries:",me.summaries.length,"meetings")):(console.warn(" No meeting summaries returned"),ue([]))}else console.error(" Failed to fetch meeting summaries:",Y.status),ue([])}catch(Y){console.error(" Error fetching meeting summaries:",Y),ue([])}finally{ge(!1)}},[]);h.useEffect(()=>{Z?pt():ue([])},[Z,pt]);const be=Q.filter(Y=>Y.meetingTitle.toLowerCase().includes(s.toLowerCase())||Y.date.toLowerCase().includes(s.toLowerCase())||Y.time&&Y.time.toLowerCase().includes(s.toLowerCase())),ze=Y=>{ce(Y),Pe(!0)},ee=Math.ceil(be.length/jd),X=(i-1)*jd,te=be.slice(X,X+jd),we=o==="all"?d:d.filter(Y=>Y.source===o),Ne={gmail:Dt,slack:Kr,phone:sn,sms:Kr},nt={gmail:"bg-red-50 text-red-600 border-red-200",slack:"bg-purple-50 text-purple-600 border-purple-200",phone:"bg-green-50 text-green-600 border-green-200",sms:"bg-blue-50 text-blue-600 border-blue-200"},ie=Y=>{u(me=>me.map(_e=>_e.id===Y?{..._e,unread:!1}:_e))},xe=Y=>{u(me=>me.map(_e=>_e.id===Y?{..._e,favorite:!_e.favorite}:_e))},Ie=()=>{u(Y=>Y.map(me=>({...me,unread:!1})))},Oe=()=>"https://meeting-agent-prelude-platform-uc.a.run.app",Ue=()=>{window.clearMeetingCache&&(window.clearMeetingCache(),console.log(" Meeting cache cleared"))},$e=h.useCallback(async()=>{console.log(" Refreshing Zoom connection status..."),he(!0),Ue();try{const Y=await fetch(`${Oe()}/oauth/connection-status`);if(Y.ok){const me=await Y.json();console.log(" Connection status response:",me),oe(me.connected),me.connected&&me.user?(B(me.user),console.log(" User connected:",me.user.name),pt()):(B(null),q(!1),console.log(" No user connected"))}else console.log(" Connection status check failed with status:",Y.status),oe(!1),B(null),q(!1)}catch(Y){console.error("Failed to check Zoom connection:",Y),oe(!1),B(null),q(!1)}finally{he(!1),console.log(" Connection status check complete")}},[pt]);h.useEffect(()=>{$e()},[$e]);const ot=()=>{re(!0),q(!0);const Y=Oe();window.open(`${Y}/oauth/authorize`,"_blank"),setTimeout(()=>{re(!1)},2e3)},fe=async()=>{try{(await fetch(`${Oe()}/oauth/disconnect`,{method:"POST"})).ok?(oe(!1),B(null)):console.error("Failed to disconnect from Zoom")}catch(Y){console.error("Failed to disconnect from Zoom:",Y),oe(!1),B(null)}},pe=()=>r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h4",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Meeting Agent"}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsx(H,{variant:"ghost",size:"sm",onClick:$e,disabled:Me,className:"p-2 h-8 w-8 bg-blue-50 border border-blue-200 rounded-full shadow-sm hover:shadow-md",title:"Refresh connection status",children:Me?r.jsx(Ct,{className:"w-4 h-4 animate-spin"}):r.jsx(_d,{className:"w-4 h-4"})})})]}),Z?r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-4 h-4 bg-green-600 rounded-full flex items-center justify-center",children:r.jsx("span",{className:"text-white text-xs",children:""})}),r.jsxs("span",{className:"text-sm font-medium text-green-700",children:["Connected to Zoom as ",(W==null?void 0:W.name)||"User"]}),r.jsx(H,{variant:"ghost",size:"sm",className:"text-green-600 hover:text-green-700 ml-auto text-xs",onClick:fe,children:"Disconnect"})]})}),r.jsxs("div",{className:"relative",children:[r.jsx(zn,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground"}),r.jsx(gs,{placeholder:"Search meetings by name, date, or time...",value:s,onChange:Y=>{a(Y.target.value),l(1)},className:"pl-10 bg-gray-50 border border-slate-200 focus:border-primary focus:ring-2 focus:ring-primary/20"})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Recent Meeting Summaries"}),Le?r.jsxs("div",{className:"text-center py-8",children:[r.jsx(Ct,{className:"w-8 h-8 animate-spin text-primary mx-auto mb-2"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading meetings..."})]}):te.length>0?r.jsxs(r.Fragment,{children:[te.map(Y=>r.jsx(We,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>ze(Y),children:r.jsxs(it,{className:"p-4 space-y-3",children:[r.jsx("div",{className:"flex items-start justify-between",children:r.jsxs("div",{children:[r.jsx("h5",{className:"font-semibold text-foreground",children:Y.meetingTitle}),r.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mt-1",children:[r.jsx("span",{children:Y.date}),r.jsx("span",{children:""}),r.jsx("span",{children:Y.time}),r.jsx("span",{children:""}),r.jsx("span",{children:Y.duration}),r.jsx("span",{children:""}),r.jsx("span",{children:Y.attendees})]})]})}),r.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:Y.summary}),r.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[r.jsx("span",{children:"Click to view full summary and recording"}),r.jsx("span",{className:"text-primary",children:"View Details "})]})]})},Y.id)),ee>1&&r.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[r.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",X+1,"-",Math.min(X+jd,be.length)," of ",be.length," meetings"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(H,{variant:"outline",size:"sm",onClick:()=>l(Y=>Math.max(1,Y-1)),disabled:i===1,children:r.jsx(di,{className:"w-4 h-4"})}),r.jsxs("span",{className:"text-sm text-muted-foreground px-3",children:["Page ",i," of ",ee]}),r.jsx(H,{variant:"outline",size:"sm",onClick:()=>l(Y=>Math.min(ee,Y+1)),disabled:i===ee,children:r.jsx(Ta,{className:"w-4 h-4"})})]})]})]}):r.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[s?`No meetings found matching "${s}"`:"No recent meetings found",Z&&!Le&&r.jsx("div",{className:"mt-4",children:r.jsxs(H,{variant:"outline",size:"sm",onClick:pt,className:"text-blue-600 border-blue-600 hover:bg-blue-50",children:[r.jsx(_d,{className:"w-4 h-4 mr-2"}),"Refresh Meetings"]})})]})]})]}):r.jsxs("div",{className:"text-center py-8 space-y-6",children:[r.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[r.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg",children:r.jsx(kt,{className:"w-8 h-8 text-white"})}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Connect to Zoom"}),r.jsx("p",{className:"text-sm text-muted-foreground max-w-md",children:"Connect your Zoom account to manage meetings, view recordings, access transcripts, and get AI-powered meeting summaries directly from your dashboard."})]})]}),r.jsx("div",{className:"space-y-3",children:G?r.jsx(H,{onClick:$e,disabled:Me,className:"bg-gray-600 hover:bg-gray-700 text-white px-6 py-2.5 rounded-lg shadow-sm",children:Me?r.jsxs(r.Fragment,{children:[r.jsx(Ct,{className:"w-4 h-4 mr-2 animate-spin"}),"Checking..."]}):r.jsxs(r.Fragment,{children:[r.jsx(_d,{className:"w-4 h-4 mr-2"}),"Refresh Status"]})}):r.jsx(H,{onClick:ot,disabled:V,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-lg shadow-sm",children:V?r.jsxs(r.Fragment,{children:[r.jsx(Ct,{className:"w-4 h-4 mr-2 animate-spin"}),"Connecting..."]}):r.jsxs(r.Fragment,{children:[r.jsx(sa,{className:"w-4 h-4 mr-2"}),"Connect to Zoom"]})})})]})]}),je=()=>r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h4",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Multi-Channel Notifications"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(Nl,{value:o,onValueChange:c,className:"w-32",size:"sm",children:[r.jsx(wr,{value:"all",children:"All Sources"}),r.jsx(wr,{value:"gmail",children:"Gmail"}),r.jsx(wr,{value:"slack",children:"Slack"}),r.jsx(wr,{value:"phone",children:"Phone"}),r.jsx(wr,{value:"sms",children:"SMS"})]}),r.jsx("button",{className:"text-sm text-primary hover:text-primary/80",onClick:Ie,children:"Mark All Read"})]})]}),r.jsx(We,{className:"bg-indigo-50 border-indigo-200",children:r.jsxs(it,{className:"p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Ol,{className:"w-4 h-4 text-slate-600"}),r.jsx("span",{className:"text-sm font-medium text-slate-800",children:"AI Summary"})]}),r.jsxs("p",{className:"text-sm text-slate-700",children:["You have ",r.jsxs("strong",{children:[we.filter(Y=>Y.unread).length," unread"]})," notifications across ",o==="all"?"all channels":o,".",we.filter(Y=>Y.priority==="high").length>0&&r.jsxs(r.Fragment,{children:[" ",r.jsxs("strong",{children:[we.filter(Y=>Y.priority==="high").length," high-priority"]})," items need immediate attention."]})]})]})}),r.jsx("div",{className:"space-y-3",children:we.length>0?we.map(Y=>{const me=Ne[Y.source];return r.jsx(We,{className:`transition-all hover:shadow-sm ${Y.unread?"border-l-4 border-l-primary":""}`,children:r.jsx(it,{className:"p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 border ${nt[Y.source]}`,children:r.jsx(me,{className:"w-4 h-4"})}),r.jsx("div",{className:"flex-1 min-w-0",children:r.jsx("div",{className:"flex items-start justify-between",children:r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("h5",{className:"font-semibold text-foreground text-sm",children:Y.title}),r.jsx("button",{onClick:()=>xe(Y.id),className:"hover:scale-110 transition-transform",children:r.jsx(on,{className:`w-4 h-4 ${Y.favorite?"fill-yellow-400 text-yellow-400":"text-muted-foreground hover:text-yellow-400"}`})}),r.jsx(an,{variant:Y.priority==="high"?"destructive":Y.priority==="medium"?"default":"secondary",className:"text-xs px-1.5 py-0.5 h-5",children:Y.priority==="high"?"High":Y.priority==="medium"?"Medium":"Low"}),Y.unread&&r.jsx("div",{className:"w-2 h-2 bg-primary rounded-full"})]}),r.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mb-2",children:[r.jsx("span",{className:"capitalize font-medium",children:Y.source}),r.jsx("span",{children:""}),r.jsx("span",{children:Y.sender}),Y.channel&&r.jsxs(r.Fragment,{children:[r.jsx("span",{children:""}),r.jsx("span",{children:Y.channel})]}),Y.senderEmail&&r.jsxs(r.Fragment,{children:[r.jsx("span",{children:""}),r.jsx("span",{children:Y.senderEmail})]}),Y.phoneNumber&&r.jsxs(r.Fragment,{children:[r.jsx("span",{children:""}),r.jsx("span",{children:Y.phoneNumber})]})]}),r.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:Y.content}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-xs text-muted-foreground",children:Y.time}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(an,{variant:"outline",className:"text-xs",children:Y.category}),Y.unread&&r.jsx("button",{className:"text-xs text-primary hover:text-primary/80",onClick:()=>ie(Y.id),children:"Mark as Read"})]})]})]})})})]})})},Y.id)}):r.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["No notifications found for ",o==="all"?"any source":o]})}),r.jsx(We,{className:"border-t",children:r.jsxs(it,{className:"p-4",children:[r.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[r.jsxs("div",{children:[r.jsx("div",{className:"text-lg font-semibold text-foreground",children:d.filter(Y=>Y.source==="gmail").length}),r.jsx("div",{className:"text-xs text-muted-foreground",children:"Gmail"})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-lg font-semibold text-foreground",children:d.filter(Y=>Y.source==="slack").length}),r.jsx("div",{className:"text-xs text-muted-foreground",children:"Slack"})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-lg font-semibold text-foreground",children:d.filter(Y=>Y.source==="phone").length}),r.jsx("div",{className:"text-xs text-muted-foreground",children:"Phone"})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-lg font-semibold text-foreground",children:d.filter(Y=>Y.source==="sms").length}),r.jsx("div",{className:"text-xs text-muted-foreground",children:"SMS"})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center mt-4 pt-4 border-t border-border",children:[r.jsxs("div",{children:[r.jsx("div",{className:"text-lg font-semibold text-yellow-600",children:d.filter(Y=>Y.favorite).length}),r.jsxs("div",{className:"text-xs text-muted-foreground flex items-center justify-center gap-1",children:[r.jsx(on,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"}),"Favorites"]})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-lg font-semibold text-red-600",children:d.filter(Y=>Y.priority==="high").length}),r.jsx("div",{className:"text-xs text-muted-foreground",children:"High Priority"})]})]})]})})]}),Fe=()=>{var rr,Yt;const Y=Math.ceil(f.length/yl),me=(U-1)*yl+1,_e=Math.min(U*yl,f.length),Nt=()=>{U>1&&I(U-1)},Ft=()=>{U<Y&&I(U+1)};return r.jsxs("div",{className:"space-y-4",children:[r.jsx("h4",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Daily News"}),$&&r.jsx("div",{className:"mb-4",children:r.jsx(Are,{userEmail:"logan@preludeos.com",selectedIndustries:L,onIndustriesChange:Ee})}),L.length>0&&r.jsxs("div",{className:"flex items-center justify-between text-xs text-blue-700 bg-blue-50 px-3 py-2 rounded-md border border-blue-200",children:[r.jsxs("span",{className:"flex items-center gap-2",children:[r.jsx(kf,{className:"w-3 h-3"}),"Industry search: ",L.slice(0,3).join(", "),L.length>3&&` +${L.length-3} more`]}),r.jsx("button",{onClick:()=>P([]),className:"text-blue-600 hover:text-blue-800 underline text-xs",children:"Clear filter"})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("div",{className:"relative flex-1",children:[r.jsx(zn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),r.jsx("input",{type:"text",placeholder:"Search Google News & RSS feeds...",value:S,onChange:ft=>_(ft.target.value),onKeyDown:ft=>{ft.key==="Enter"&&st(S)},className:"w-full pl-10 pr-4 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"})]}),r.jsxs(H,{size:"sm",className:"px-4",onClick:()=>st(S),disabled:b||!S.trim(),children:[r.jsx(zn,{className:"w-4 h-4 mr-2"}),"Search"]}),r.jsxs("div",{className:"relative filter-dropdown",children:[r.jsxs(H,{variant:"outline",size:"sm",className:"px-3",onClick:()=>M(!T),children:[r.jsx(da,{className:"w-4 h-4 mr-2"}),((rr=qe.find(ft=>ft.value===A))==null?void 0:rr.label)||"Filter",r.jsx(Xt,{className:"w-4 h-4 ml-2"})]}),T&&r.jsx("div",{className:"absolute top-full right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-10 min-w-[180px]",children:qe.map(ft=>r.jsxs("button",{onClick:()=>Ke(ft.value),className:`w-full text-left px-3 py-2 text-sm hover:bg-gray-50 flex items-center gap-2 ${A===ft.value?"bg-primary/10 text-primary":"text-gray-700"}`,children:[r.jsx("span",{children:ft.icon}),r.jsx("span",{children:ft.label}),A===ft.value&&r.jsx("span",{className:"ml-auto text-primary",children:""})]},ft.value))})]}),r.jsx(H,{variant:"outline",size:"sm",className:"px-3",onClick:()=>{C&&(D(!1),_(""),E("all")),L.length>0?ye("general",!0):N("Please select industries to view relevant news")},disabled:b,children:b?r.jsx(Ct,{className:"w-4 h-4 animate-spin"}):r.jsx(sa,{className:"w-4 h-4"})})]}),A!=="all"&&f.length>0&&r.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 bg-gray-50 px-3 py-2 rounded",children:[r.jsxs("span",{children:["Showing ",f.length," of ",g.length," articles  Filter: ",(Yt=qe.find(ft=>ft.value===A))==null?void 0:Yt.label]}),r.jsx("button",{onClick:()=>Ke("all"),className:"text-primary hover:text-primary/80 underline",children:"Clear filter"})]}),b&&f.length===0&&r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Ct,{className:"w-8 h-8 animate-spin text-primary mx-auto mb-2"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Fetching latest news..."})]})}),w&&f.length===0&&r.jsxs("div",{className:"text-center py-8",children:[r.jsxs("div",{className:"text-red-500 mb-4",children:[r.jsx(Zm,{className:"w-8 h-8 mx-auto mb-2"}),r.jsx("p",{className:"text-sm",children:"Failed to load news"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:w})]}),r.jsx(H,{variant:"outline",size:"sm",onClick:()=>{L.length>0?ye("general",!0):N("Please select industries to view relevant news")},disabled:b,children:"Try Again"})]}),z.length>0&&r.jsx("div",{className:"space-y-3",children:z.map((ft,Ds)=>r.jsx(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:Ds*.1},children:r.jsx(We,{className:`hover:shadow-md transition-all cursor-pointer ${ft.trending?"border-l-4 border-l-primary bg-primary/5":""}`,onClick:()=>At(ft),children:r.jsx(it,{className:"p-4",children:r.jsxs("div",{className:"flex items-start gap-3",children:[ft.imageUrl?r.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden flex-shrink-0",children:r.jsx("img",{src:ft.imageUrl,alt:ft.title,className:"w-full h-full object-cover"})}):r.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0",children:r.jsx(Zm,{className:"w-6 h-6 text-gray-400"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"flex items-start justify-between gap-2 mb-2",children:r.jsxs("h4",{className:"font-medium text-sm leading-tight line-clamp-2",children:[ft.title,ft.trending&&r.jsx("span",{className:"ml-2 text-xs bg-red-100 text-red-600 px-1.5 py-0.5 rounded",children:" Trending"})]})}),r.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mb-2",children:ft.summary}),r.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"font-medium",children:ft.source}),r.jsx("span",{children:""}),r.jsx("span",{children:ft.time}),r.jsx("span",{children:""}),r.jsx("span",{children:ft.readTime})]}),r.jsx("span",{className:"text-primary hover:text-primary/80",children:"Read More "})]})]})]})})})},ft.id))}),f.length>yl&&r.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[r.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",me,"-",_e," of ",f.length," articles"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(H,{variant:"outline",size:"sm",onClick:Nt,disabled:U===1,className:"px-3",children:[r.jsx(di,{className:"w-4 h-4 mr-1"}),"Previous"]}),r.jsxs("span",{className:"text-sm text-muted-foreground px-3",children:["Page ",U," of ",Y]}),r.jsxs(H,{variant:"outline",size:"sm",onClick:Ft,disabled:U===Y,className:"px-3",children:["Next",r.jsx(Ta,{className:"w-4 h-4 ml-1"})]})]})]})]})};return r.jsxs(de.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.35},children:[r.jsx(We,{className:"hover:shadow-md transition-shadow bg-white",children:r.jsxs(it,{className:"p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-8 h-8 bg-slate-600 rounded-lg flex items-center justify-center shadow-sm",children:r.jsx(Ol,{className:"w-5 h-5 text-white"})}),r.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"AI Agents Panel"})]}),r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>p(!m),className:"p-1 h-6 w-6 bg-white border border-gray-200 rounded-full shadow-sm hover:shadow-md",children:m?r.jsx(Xt,{className:"w-3 h-3"}):r.jsx(La,{className:"w-3 h-3"})})]}),m&&r.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[r.jsx("span",{children:"AI Agents: Meeting Agent, Notifications & Daily News"}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs("span",{className:"text-blue-600",children:[d.filter(Y=>Y.unread).length," unread notifications"]})})]}),!m&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"flex border-b border-slate-300 mb-6",children:Ht.map(Y=>{const me=Y.icon;return r.jsxs("button",{onClick:()=>n(Y.id),className:`flex items-center gap-2 px-4 py-2 font-medium text-sm border-b-2 transition-colors ${t===Y.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"}`,children:[r.jsx(me,{className:"w-4 h-4"}),Y.label]},Y.id)})}),r.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:t==="meetings"?pe():t==="notifications"?je():Fe()})]})]})}),r.jsx(Pre,{isOpen:J,onClose:()=>se(!1),article:O,onGetAISummary:lt}),r.jsx(Ire,{isOpen:ke,onClose:()=>Pe(!1),meetingId:Se==null?void 0:Se.id,meeting:Se})]})},Rre="http://localhost:8004";class yf extends Error{constructor(t,n=null,s=null){super(t),this.name="DashboardDataApiError",this.status=n,this.response=s}}async function $re(e,t={}){const n=`${Rre}${e}`,s={method:"GET",headers:{"Content-Type":"application/json"}};try{const a=await fetch(n,{...s,...t});if(!a.ok)throw new yf(`HTTP ${a.status}: ${a.statusText}`,a.status,a);return await a.json()}catch(a){throw a instanceof yf?a:new yf(`Network error: ${a.message}`,null,a)}}async function LT(){try{console.log(" Fetching dashboard events from task data...");const e=await $re("/api/tasks/public?limit=50"),t=[];return e&&Array.isArray(e)&&e.forEach(n=>{n.due_date&&t.push({id:`task-${n.task_id}`,title:n.title||`Task ${n.task_id}`,start:n.due_date,type:"task-due",category:"task",description:n.description||`Task: ${n.title}`,metadata:{taskId:n.task_id,priority:n.priority,status:n.status,employeeId:n.employee_id}}),n.created_at&&t.push({id:`task-created-${n.task_id}`,title:`Created: ${n.title||`Task ${n.task_id}`}`,start:n.created_at,type:"task-created",category:"task",description:`Task created: ${n.description||n.title}`,metadata:{taskId:n.task_id,priority:n.priority,status:n.status,employeeId:n.employee_id}})}),console.log(` Generated ${t.length} events from ${(e==null?void 0:e.length)||0} tasks`),{success:!0,events:t.slice(0,50),total:t.length}}catch(e){return console.error(" Error fetching dashboard events:",e),{success:!1,error:e.message,events:[]}}}async function Fre(e=7){try{const t=await LT();if(!t.success)throw new Error(t.error);const n=new Date,s=new Date;s.setDate(s.getDate()+e);const a=t.events.filter(i=>{const l=new Date(i.start);return l>=n&&l<=s}).sort((i,l)=>new Date(i.start)-new Date(l.start)).slice(0,10);return{success:!0,events:a,total:a.length}}catch(t){return console.error(" Error fetching upcoming events:",t),{success:!1,error:t.message,events:[]}}}const zre="http://localhost:8004";class bf extends Error{constructor(t,n=null,s=null){super(t),this.name="TaskGenerationApiError",this.status=n,this.response=s}}async function Bc(e,t={}){const n=`${zre}${e}`,a={...{method:"GET",headers:{"Content-Type":"application/json"}},...t};try{const i=await fetch(n,a);if(!i.ok){const o=await i.text();throw new bf(`HTTP ${i.status}: ${o}`,i.status,i)}return await i.json()}catch(i){throw i instanceof bf?i:(console.error("Task Generation API request failed:",i),new bf(`Network error: ${i.message}`,null,null))}}async function Bre(e=null,t="both"){try{if(console.log(` Generating tasks from client data using AI (source: ${t})...`),!e)throw new Error("Employee email is required. Please pass user email from auth context.");const n=await Bc("/api/db-agent/task-feedback-clients",{method:"POST",body:JSON.stringify({action:"generate",employee_email:e,source_type:t})});if(n.success&&n.tasks){console.log(` Generated ${n.tasks.length} tasks from client data`);const s=n.tasks.map(a=>{var i,l,o,c,d,u;return{id:`suggested-client-${a.id}`,title:a.title,description:a.description,type:((i=a.metadata)==null?void 0:i.task_type)==="email"?"email-task":"client-task",status:"pending",priority:a.priority,due:a.due_date,assignedTo:"You",source:"Client Data (AI)",estimatedHours:a.estimated_hours,goalAlignment:a.goal_alignment,metadata:{originalId:a.id,originalType:"client",sessionId:n.session_id,employeeId:n.employee_id,goalAlignment:a.goal_alignment,customer_name:(l=a.metadata)==null?void 0:l.customer_name,customer_email:(o=a.metadata)==null?void 0:o.customer_email,task_type:(c=a.metadata)==null?void 0:c.task_type,email_type:(d=a.metadata)==null?void 0:d.email_type,communication_method:(u=a.metadata)==null?void 0:u.communication_method,originalMetadata:a.metadata}}});return{success:!0,tasks:s,total:s.length,sessionData:{sessionId:n.session_id,employeeId:n.employee_id,generatedAt:n.generated_at}}}else throw new Error(n.error||"Failed to generate tasks from client data")}catch(n){return console.error(" Error generating tasks from client data:",n),{success:!1,error:n.message,tasks:[]}}}async function Ure(){try{console.log(" Generating tasks from meetings...");const e=[];return console.log(" Meeting integration not yet implemented - no tasks generated"),{success:!0,tasks:e,total:e.length}}catch(e){return console.error(" Error generating tasks from meetings:",e),{success:!1,error:e.message,tasks:[]}}}async function qre(e=null){try{if(console.log(" Generating tasks from goals..."),!e)throw new Error("Employee email is required. Please pass user email from auth context.");const t=await Bc("/api/db-agent/task-feedback",{method:"POST",body:JSON.stringify({action:"generate",employee_email:e})});if(t.success&&t.tasks){console.log(` Generated ${t.tasks.length} tasks from goals`);const n=t.tasks.map(s=>({id:`suggested-goal-${s.id}`,title:s.title,description:s.description,type:"goal-task",status:"pending",priority:s.priority,due:s.due_date,assignedTo:"You",source:"Goals",estimatedHours:s.estimated_hours,goalAlignment:s.goal_alignment,metadata:{originalId:s.id,originalType:"goal",sessionId:t.session_id,employeeId:t.employee_id,goalAlignment:s.goal_alignment}}));return{success:!0,tasks:n,total:n.length,sessionData:{sessionId:t.session_id,employeeId:t.employee_id,goalsUsed:t.goals_used}}}else throw new Error(t.error||"Failed to generate tasks from goals")}catch(t){return console.error(" Error generating tasks from goals:",t),{success:!1,error:t.message,tasks:[]}}}async function pC(e,t,n,s=null){try{if(console.log(" Refining tasks based on feedback..."),!e||!e.trim())throw new Error("Feedback is required for task refinement");if(!n||!n.sessionId)throw new Error("Session data is required for task refinement");if(!s)throw new Error("Employee email is required for task refinement.");const a=t.map(l=>{var o,c;return{id:((o=l.metadata)==null?void 0:o.originalId)||l.id,title:l.title,description:l.description,priority:l.priority,due_date:l.due,estimated_hours:l.estimatedHours||2,goal_alignment:l.goalAlignment||((c=l.metadata)==null?void 0:c.goalAlignment)||"",dependencies:[]}}),i=await Bc("/api/db-agent/task-feedback",{method:"POST",body:JSON.stringify({action:"refine",employee_email:s,feedback:e,current_tasks:a,session_data:n})});if(i.success&&i.tasks){console.log(` Refined ${i.tasks.length} tasks based on feedback`);const l=i.tasks.map(o=>({id:`refined-goal-${o.id}`,title:o.title,description:o.description,type:"goal-task",status:"pending",priority:o.priority,due:o.due_date,assignedTo:"You",source:"Goals (Refined)",estimatedHours:o.estimated_hours,goalAlignment:o.goal_alignment,metadata:{originalId:o.id,originalType:"goal",sessionId:i.session_id,employeeId:i.employee_id,goalAlignment:o.goal_alignment,feedbackApplied:i.feedback_applied}}));return{success:!0,tasks:l,total:l.length,sessionData:{sessionId:i.session_id,employeeId:i.employee_id,feedbackApplied:i.feedback_applied}}}else throw new Error(i.error||"Failed to refine tasks based on feedback")}catch(a){return console.error(" Error refining tasks:",a),{success:!1,error:a.message,tasks:[]}}}async function fC(e,t,n,s=null){try{if(console.log(" Refining client tasks based on feedback..."),!t||t.trim()==="")throw new Error("Feedback is required for task refinement");if(!n||!n.sessionId)throw new Error("Session data is required for task refinement");if(!s)throw new Error("Employee email is required for task refinement.");const a=e.map(l=>{var o,c,d,u;return{id:((o=l.metadata)==null?void 0:o.originalId)||l.id,title:l.title,description:l.description,priority:l.priority,due_date:l.due,estimated_hours:l.estimatedHours||2,client_alignment:l.clientAlignment||((c=l.metadata)==null?void 0:c.clientAlignment)||"",customer_id:(d=l.metadata)==null?void 0:d.customer_id,lead_id:(u=l.metadata)==null?void 0:u.lead_id,dependencies:[]}}),i=await Bc("/api/db-agent/task-feedback-clients",{method:"POST",body:JSON.stringify({action:"refine",employee_email:s,feedback:t,current_tasks:a,session_data:n})});if(i.success&&i.tasks){console.log(` Refined ${i.tasks.length} client tasks based on feedback`);const l=i.tasks.map(o=>({id:`refined-client-${o.id}`,title:o.title,description:o.description,type:"client-task",status:"pending",priority:o.priority,due:o.due_date,assignedTo:"You",source:"Clients (Refined)",estimatedHours:o.estimated_hours,clientAlignment:o.client_alignment,metadata:{originalId:o.id,originalType:"client",customer_id:o.customer_id,lead_id:o.lead_id,refinedFromFeedback:!0}}));return{success:!0,tasks:l,total:l.length,sessionData:{sessionId:i.session_id,employeeId:i.employee_id,feedbackApplied:i.feedback_applied}}}else throw new Error(i.error||"Failed to refine client tasks based on feedback")}catch(a){return console.error(" Error refining client tasks:",a),{success:!1,error:a.message,tasks:[]}}}async function Hre(e,t,n=null){try{if(console.log(" Saving modified tasks to backend..."),!n)throw new Error("Employee email is required for saving modified tasks.");const s=await Bc("/api/db-agent/save-modified-tasks",{method:"POST",body:JSON.stringify({employee_email:n,modified_tasks:e,session_data:t||{}})});if(s.success)return console.log(` Successfully saved ${s.tasks_saved} modified tasks`),{success:!0,message:s.message,tasks_saved:s.tasks_saved,saved_at:s.saved_at};throw new Error(s.error||"Failed to save modified tasks")}catch(s){return console.error(" Error saving modified tasks:",s),{success:!1,error:s.message,tasks:[]}}}function Wre(e){var c,d,u,m;const t=["low","medium","high","urgent"];let n=((c=e.priority)==null?void 0:c.toLowerCase())||"medium";t.includes(n)||(n="medium");const s=["not-started","in-progress","completed","on-hold","overdue"];let a=e.status==="pending"?"not-started":e.status;s.includes(a)||(a="not-started");let i=null;if(e.due){const p=new Date(e.due),f=new Date;if(f.setHours(0,0,0,0),p>=f)i=p.toISOString().split("T")[0];else{const y=new Date;y.setDate(y.getDate()+1),i=y.toISOString().split("T")[0]}}let l=null;(d=e.metadata)!=null&&d.originalId?l=String(e.metadata.originalId):e.id&&(l=e.id.replace("suggested-goal-",""));const o={title:String(((u=e.title)==null?void 0:u.trim())||"Untitled Task"),description:(m=e.description)!=null&&m.trim()?String(e.description.trim()):null,priority:String(n),status:String(a),due_date:i,source:"Goal",source_id:l?String(l):null};return console.log("Transformed goal task:",o),o}function Yre(e){var c,d,u,m,p,f;const t=["low","medium","high","urgent"];let n=((c=e.priority)==null?void 0:c.toLowerCase())||"medium";t.includes(n)||(n="medium");const s=["not-started","in-progress","completed","on-hold"];let a=e.status==="pending"?"not-started":e.status;s.includes(a)||(a="not-started");let i=null;if(e.due){const y=new Date(e.due),g=new Date;if(g.setHours(0,0,0,0),y>=g)i=y.toISOString().split("T")[0];else{const x=new Date;x.setDate(x.getDate()+1),i=x.toISOString().split("T")[0]}}let l=null;(d=e.metadata)!=null&&d.customer_id?l=String(e.metadata.customer_id):(u=e.metadata)!=null&&u.lead_id?l=String(e.metadata.lead_id):(m=e.metadata)!=null&&m.originalId?l=String(e.metadata.originalId):e.id&&(l=e.id.replace("suggested-client-","").replace("client_task_",""));const o={title:String(((p=e.title)==null?void 0:p.trim())||"Untitled Task"),description:(f=e.description)!=null&&f.trim()?String(e.description.trim()):null,priority:String(n),status:String(a),due_date:i,source:"Client",source_id:l?String(l):null};return console.log("Transformed client task:",o),o}async function Vre(e,t){const n=[],s=[];for(const a of e)try{const i=Wre(a);console.log("Sending goal task to API:",i);const l=await fetch("http://localhost:8004/api/tasks",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(i)});if(!l.ok){let c=`Failed to create task: ${a.title}`;try{const d=await l.json();console.error("API Error Response:",d),c=d.detail||JSON.stringify(d)||c}catch(d){console.error("Failed to parse error response:",d),c=`HTTP ${l.status}: ${l.statusText}`}throw new Error(c)}const o=await l.json();n.push({originalTask:a,savedTask:o,success:!0})}catch(i){console.error(`Error saving task "${a.title}":`,i),s.push({originalTask:a,error:i.message,success:!1})}return{success:s.length===0,results:n,errors:s,totalTasks:e.length,successCount:n.length,errorCount:s.length}}async function Gre(e,t){const n=[],s=[];for(const a of e)try{const i=Yre(a);console.log("Sending client task to API:",i);const l=await fetch("http://localhost:8004/api/tasks",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(i)});if(!l.ok){let c=`Failed to create task: ${a.title}`;try{const d=await l.json();console.error("API Error Response:",d),c=d.detail||JSON.stringify(d)||c}catch(d){console.error("Failed to parse error response:",d),c=`HTTP ${l.status}: ${l.statusText}`}throw new Error(c)}const o=await l.json();n.push({originalTask:a,savedTask:o,success:!0})}catch(i){console.error(`Error saving client task "${a.title}":`,i),s.push({originalTask:a,error:i.message,success:!1})}return{success:s.length===0,results:n,errors:s,totalTasks:e.length,successCount:n.length,errorCount:s.length}}async function Kre(e,t,n){try{const s=await fetch(`http://localhost:8004/api/tasks/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)});if(!s.ok){const i=await s.json();throw new Error(i.detail||"Failed to update task")}return{success:!0,task:await s.json()}}catch(s){return console.error(`Error updating task ${e}:`,s),{success:!1,error:s.message}}}async function RT(e,t,n){try{const s=await fetch(`http://localhost:8004/api/tasks/${e}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({status:t})});if(!s.ok){const i=await s.json();throw new Error(i.detail||"Failed to update task status")}return{success:!0,task:await s.json()}}catch(s){return console.error(`Error updating task ${e} status:`,s),{success:!1,error:s.message}}}async function Xre(e,t,n){const s=[],a=[];for(const i of e){const l=await RT(i,t,n);l.success?s.push(l.task):a.push({taskId:i,error:l.error})}return{success:a.length===0,results:s,errors:a,totalTasks:e.length,successCount:s.length,errorCount:a.length}}async function $T(e,t){try{const n=await fetch(`http://localhost:8004/api/tasks/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!n.ok){const s=await n.json().catch(()=>({}));throw new Error(s.detail||"Failed to delete task")}return{success:!0,taskId:e}}catch(n){return console.error(`Error deleting task ${e}:`,n),{success:!1,taskId:e,error:n.message}}}async function Jre(e,t){const n=[],s=[];for(const a of e){const i=await $T(a,t);i.success?n.push(i.taskId):s.push({taskId:a,error:i.error})}return{success:s.length===0,results:n,errors:s,totalTasks:e.length,successCount:n.length,errorCount:s.length}}function Qre(e){return e.map(t=>{var n,s,a;return{...t,id:((n=t.metadata)==null?void 0:n.originalType)==="lead"?`lead-${t.metadata.leadId}`:((s=t.metadata)==null?void 0:s.originalType)==="interaction"?`interaction-${t.metadata.interactionId}`:((a=t.metadata)==null?void 0:a.originalType)==="goal"?`goal-${t.metadata.originalId||t.id}`:`manual-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString(),metadata:{...t.metadata,generatedFrom:t.source,acceptedAt:new Date().toISOString()}}})}const Nd={"not-started":{icon:Gi,color:"text-slate-400",bgColor:"bg-slate-50 border-slate-200",label:"Not Started",hoverColor:"hover:bg-slate-100"},"in-progress":{icon:jt,color:"text-indigo-600",bgColor:"bg-indigo-50 border-indigo-200",label:"In Progress",hoverColor:"hover:bg-indigo-100"},completed:{icon:na,color:"text-emerald-600",bgColor:"bg-emerald-50 border-emerald-200",label:"Completed",hoverColor:"hover:bg-emerald-100"},overdue:{icon:dt,color:"text-rose-600",bgColor:"bg-rose-50 border-rose-200",label:"Overdue",hoverColor:"hover:bg-rose-100"}},FT=({currentStatus:e,taskId:t,onStatusChange:n,disabled:s=!1,size:a="default",showLabel:i=!1,variant:l="dropdown"})=>{const[o,c]=h.useState(!1),[d,u]=h.useState(!1),m=Nd[e]||Nd["not-started"],p=m.icon,f=async y=>{if(!(y===e||s||d)){u(!0);try{await n(t,y),c(!1)}catch(g){console.error("Failed to update task status:",g)}finally{u(!1)}}};return l==="simple"?r.jsxs("div",{className:`flex items-center gap-2 px-2 py-1 rounded-md border ${m.bgColor}`,children:[r.jsx(p,{className:`w-4 h-4 ${m.color}`}),i&&r.jsx("span",{className:`text-sm font-medium ${m.color}`,children:m.label})]}):l==="buttons"?r.jsx("div",{className:"flex gap-1",children:Object.entries(Nd).map(([y,g])=>{if(y==="overdue")return null;const x=g.icon,b=y===e;return r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>f(y),disabled:s||d,className:`
                w-8 h-8 p-0 rounded-full border-2 transition-all
                ${b?`${g.bgColor} ${g.color} border-current`:`border-slate-200 text-slate-400 hover:border-slate-300 ${g.hoverColor}`}
              `,title:g.label,children:d&&b?r.jsx(Ct,{className:"w-3 h-3 animate-spin"}):r.jsx(x,{className:"w-3 h-3"})},y)})}):r.jsxs("div",{className:"relative",children:[r.jsxs(H,{variant:"ghost",size:a==="sm"?"sm":"default",onClick:()=>c(!o),disabled:s||d,className:`
          flex items-center gap-2 px-3 py-2 rounded-md border transition-all
          ${m.bgColor} ${m.color} ${m.hoverColor}
          ${o?"ring-2 ring-blue-500 ring-opacity-20":""}
        `,children:[d?r.jsx(Ct,{className:"w-4 h-4 animate-spin"}):r.jsx(p,{className:"w-4 h-4"}),i&&r.jsx("span",{className:"text-sm font-medium",children:m.label}),r.jsx(Xt,{className:`w-3 h-3 transition-transform ${o?"rotate-180":""}`})]}),r.jsx(ht,{children:o&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>c(!1)}),r.jsx(de.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.15},className:"absolute top-full left-0 mt-1 w-48 bg-white rounded-lg shadow-lg border border-slate-200 py-1 z-20",children:Object.entries(Nd).map(([y,g])=>{if(y==="overdue")return null;const x=g.icon,b=y===e;return r.jsxs("button",{onClick:()=>f(y),disabled:b,className:`
                      w-full flex items-center gap-3 px-3 py-2 text-left transition-colors
                      ${b?"bg-slate-50 text-slate-400 cursor-not-allowed":`hover:bg-slate-50 ${g.color}`}
                    `,children:[r.jsx(x,{className:"w-4 h-4"}),r.jsx("span",{className:"text-sm font-medium",children:g.label}),b&&r.jsx("span",{className:"ml-auto text-xs text-slate-400",children:"Current"})]},y)})})]})})]})},Zre=[{value:"not-started",label:"Not Started",icon:Gi,color:"text-slate-600"},{value:"in-progress",label:"In Progress",icon:jt,color:"text-indigo-600"},{value:"completed",label:"Completed",icon:na,color:"text-emerald-600"},{value:"overdue",label:"Overdue",icon:dt,color:"text-rose-600"}],ene=({selectedTasks:e,onSelectAll:t,onDeselectAll:n,onBulkStatusUpdate:s,onBulkDelete:a,totalTasks:i,isAllSelected:l,disabled:o=!1})=>{const[c,d]=h.useState(!1),[u,m]=h.useState(!1),[p,f]=h.useState(null),y=e.size,g=y>0,x=async v=>{if(!(!g||o||u)){m(!0),f("status");try{await s(Array.from(e),v),d(!1)}catch(w){console.error("Bulk status update failed:",w)}finally{m(!1),f(null)}}},b=async()=>{if(!(!g||o||u||!window.confirm(`Are you sure you want to delete ${y} task${y>1?"s":""}? This action cannot be undone.`))){m(!0),f("delete");try{await a(Array.from(e)),d(!1)}catch(w){console.error("Bulk delete failed:",w)}finally{m(!1),f(null)}}};return g?r.jsxs(de.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-200",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs(H,{variant:"ghost",size:"sm",onClick:l?n:t,disabled:o||u,className:"flex items-center gap-2 text-blue-700 hover:text-blue-800",children:[r.jsx(Hd,{className:"w-4 h-4"}),l?"Deselect All":`Select All (${i})`]}),r.jsx("div",{className:"h-4 w-px bg-blue-300"}),r.jsxs("span",{className:"text-sm font-medium text-blue-800",children:[y," task",y>1?"s":""," selected"]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[u&&r.jsxs("div",{className:"flex items-center gap-2 text-blue-700",children:[r.jsx(Ct,{className:"w-4 h-4 animate-spin"}),r.jsx("span",{className:"text-sm",children:p==="delete"?"Deleting...":"Updating..."})]}),r.jsxs("div",{className:"relative",children:[r.jsxs(H,{variant:"outline",size:"sm",onClick:()=>d(!c),disabled:o||u,className:"flex items-center gap-2 bg-white border-blue-300 text-blue-700 hover:bg-blue-50",children:[r.jsx(rx,{className:"w-4 h-4"}),"Actions"]}),r.jsx(ht,{children:c&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>d(!1)}),r.jsxs(de.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.15},className:"absolute top-full right-0 mt-1 w-56 bg-white rounded-lg shadow-lg border border-slate-200 py-2 z-20",children:[r.jsx("div",{className:"px-3 py-2 border-b border-slate-100",children:r.jsx("h4",{className:"text-sm font-medium text-slate-700",children:"Change Status"})}),Zre.map(v=>{const w=v.icon;return r.jsxs("button",{onClick:()=>x(v.value),disabled:u,className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-slate-50 transition-colors",children:[r.jsx(w,{className:`w-4 h-4 ${v.color}`}),r.jsx("span",{className:"text-sm",children:v.label})]},v.value)}),r.jsx("div",{className:"border-t border-slate-100 mt-2 pt-2",children:r.jsxs("button",{onClick:b,disabled:u,className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-red-50 text-red-600 transition-colors",children:[r.jsx(fr,{className:"w-4 h-4"}),r.jsx("span",{className:"text-sm",children:"Delete Selected"})]})})]})]})})]}),r.jsx(H,{variant:"ghost",size:"sm",onClick:n,disabled:o||u,className:"text-slate-500 hover:text-slate-700",children:r.jsx(Ze,{className:"w-4 h-4"})})]})]}):r.jsx("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-lg border border-slate-200",children:r.jsxs(H,{variant:"ghost",size:"sm",onClick:t,disabled:o,className:"flex items-center gap-2 text-slate-600 hover:text-slate-800",children:[r.jsx($C,{className:"w-4 h-4"}),"Select All (",i,")"]})})},zT=({isOpen:e,onClose:t,type:n="info",title:s,message:a,autoClose:i=!0,autoCloseDelay:l=3e3})=>{const[o,c]=le.useState(e);le.useEffect(()=>{if(c(e),e&&i){const f=setTimeout(()=>{d()},l);return()=>clearTimeout(f)}},[e,i,l]);const d=()=>{c(!1),setTimeout(()=>{t()},200)},m=(()=>{switch(n){case"success":return{icon:na,bgColor:"bg-green-50",borderColor:"border-green-200",iconColor:"text-green-600",titleColor:"text-green-800",messageColor:"text-green-700"};case"error":return{icon:dt,bgColor:"bg-red-50",borderColor:"border-red-200",iconColor:"text-red-600",titleColor:"text-red-800",messageColor:"text-red-700"};case"warning":return{icon:dt,bgColor:"bg-orange-50",borderColor:"border-orange-200",iconColor:"text-orange-600",titleColor:"text-orange-800",messageColor:"text-orange-700"};default:return{icon:Za,bgColor:"bg-blue-50",borderColor:"border-blue-200",iconColor:"text-blue-600",titleColor:"text-blue-800",messageColor:"text-blue-700"}}})(),p=m.icon;return r.jsx(ht,{children:o&&r.jsxs(r.Fragment,{children:[r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-25 z-50",onClick:d}),r.jsx(de.div,{initial:{opacity:0,scale:.9,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-20},transition:{duration:.2},className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50",children:r.jsxs("div",{className:`
              max-w-md w-full mx-4 rounded-lg shadow-lg border-2 
              ${m.bgColor} ${m.borderColor}
            `,children:[r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full ${m.bgColor} flex items-center justify-center`,children:r.jsx(p,{className:`w-5 h-5 ${m.iconColor}`})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[s&&r.jsx("h3",{className:`text-lg font-semibold mb-2 ${m.titleColor}`,children:s}),r.jsx("p",{className:`text-sm ${m.messageColor}`,children:a})]}),r.jsx("button",{onClick:d,className:`flex-shrink-0 p-1 rounded-full hover:bg-white hover:bg-opacity-50 transition-colors ${m.iconColor}`,children:r.jsx(Ze,{className:"w-4 h-4"})})]}),!i&&r.jsx("div",{className:"mt-4 flex justify-end",children:r.jsx(H,{onClick:d,size:"sm",variant:"outline",className:"text-sm",children:"Close"})})]}),i&&r.jsx(de.div,{initial:{width:"100%"},animate:{width:"0%"},transition:{duration:l/1e3,ease:"linear"},className:`h-1 ${m.iconColor.replace("text-","bg-")} opacity-30`})]})})]})})},tne="http://localhost:8001";async function rne(e,t={}){const n=`${tne}${e}`,a={...{method:"GET",headers:{"Content-Type":"application/json"}},...t};try{const i=await fetch(n,a);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);return await i.json()}catch(i){throw console.error("API request failed:",i),i}}async function nne(e,t=null,n=""){try{if(console.log(" Generating communication tips..."),!e)throw new Error("Employee email is required for communication tips generation.");const s=await rne("/api/db-agent/communication-tips",{method:"POST",body:JSON.stringify({employee_email:e,customer_id:t,context:n})});if(s.success&&s.tips){console.log(` Generated ${s.tips.length} communication tips`);const a=s.tips.map(i=>({id:i.id,title:i.title,description:i.description,category:i.category,priority:i.priority,applicableCustomers:i.applicable_customers||[],bestTime:i.best_time,expectedOutcome:i.expected_outcome,example:i.example,metadata:{employeeId:s.employee_id,customersAnalyzed:s.customers_analyzed,generatedAt:s.generated_at}}));return{success:!0,tips:a,total:a.length,metadata:{employeeId:s.employee_id,customersAnalyzed:s.customers_analyzed,generatedAt:s.generated_at}}}else throw new Error(s.error||"Failed to generate communication tips")}catch(s){return console.error(" Error generating communication tips:",s),{success:!1,error:s.message,tips:[]}}}function BT(){return[{id:"conversation",name:"Conversation Starters",description:"Personalized ways to begin conversations",icon:""},{id:"timing",name:"Optimal Timing",description:"Best times and methods to contact",icon:""},{id:"topics",name:"Discussion Topics",description:"Key topics based on customer status",icon:""},{id:"relationship",name:"Relationship Building",description:"Strategies to strengthen relationships",icon:""},{id:"upsell",name:"Growth Opportunities",description:"Upselling and cross-selling approaches",icon:""},{id:"health-check",name:"Health Monitoring",description:"Customer satisfaction and health checks",icon:""}]}function sne(e,t){return!t||t==="all"?e:e.filter(n=>n.category===t)}function ane(e,t){return!t||t==="all"?e:e.filter(n=>n.priority===t)}function ine(e){const t={high:3,medium:2,low:1};return[...e].sort((n,s)=>(t[s.priority]||0)-(t[n.priority]||0))}function lne(e){switch(e){case"high":return"text-red-600 bg-red-50 border-red-200";case"medium":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"low":return"text-green-600 bg-green-50 border-green-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}}function one(e){const n=BT().find(s=>s.id===e);return n?n.icon:""}const cne=({isOpen:e,onClose:t,user:n,customerId:s=null,context:a=""})=>{const[i,l]=h.useState([]),[o,c]=h.useState(!1),[d,u]=h.useState(null),[m,p]=h.useState("all"),[f,y]=h.useState("all"),[g,x]=h.useState(""),[b,v]=h.useState(null),w=BT();h.useEffect(()=>{e&&(n!=null&&n.email)&&N()},[e,n==null?void 0:n.email,s,a]);const N=async()=>{c(!0),u(null);try{const j=await nne(n.email,s,a);j.success?(l(ine(j.tips)),v(j.metadata)):u(j.error||"Failed to generate communication tips")}catch(j){u("An error occurred while generating tips"),console.error("Communication tips error:",j)}finally{c(!1)}},k=i.filter(j=>sne([j],m).length>0).filter(j=>ane([j],f).length>0).filter(j=>g===""||j.title.toLowerCase().includes(g.toLowerCase())||j.description.toLowerCase().includes(g.toLowerCase()));return e?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(Gu,{className:"h-6 w-6 text-blue-600"}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Communication Tips"}),r.jsxs("p",{className:"text-sm text-gray-500",children:["AI-generated tips for client interactions",b&&`  ${b.customersAnalyzed} customers analyzed`]})]})]}),r.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:r.jsx(Ze,{className:"h-6 w-6"})})]}),r.jsx("div",{className:"p-6 border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[r.jsx("div",{className:"flex-1 min-w-64",children:r.jsxs("div",{className:"relative",children:[r.jsx(zn,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search tips...",value:g,onChange:j=>x(j.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(da,{className:"h-4 w-4 text-gray-500"}),r.jsxs("select",{value:m,onChange:j=>p(j.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:"all",children:"All Categories"}),w.map(j=>r.jsxs("option",{value:j.id,children:[j.icon," ",j.name]},j.id))]})]}),r.jsxs("select",{value:f,onChange:j=>y(j.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:"all",children:"All Priorities"}),r.jsx("option",{value:"high",children:"High Priority"}),r.jsx("option",{value:"medium",children:"Medium Priority"}),r.jsx("option",{value:"low",children:"Low Priority"})]}),r.jsx("button",{onClick:N,disabled:o,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:o?"Generating...":"Refresh Tips"})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:o?r.jsxs("div",{className:"flex items-center justify-center py-12",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),r.jsx("span",{className:"ml-3 text-gray-600",children:"Generating communication tips..."})]}):d?r.jsxs("div",{className:"text-center py-12",children:[r.jsx("div",{className:"text-red-600 mb-2",children:" Error"}),r.jsx("p",{className:"text-gray-600",children:d}),r.jsx("button",{onClick:N,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Try Again"})]}):k.length===0?r.jsxs("div",{className:"text-center py-12",children:[r.jsx(bc,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600",children:i.length===0?"No communication tips available":"No tips match your filters"})]}):r.jsx("div",{className:"space-y-4",children:k.map(j=>r.jsx(dne,{tip:j},j.id))})}),r.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",k.length," of ",i.length," tips",b&&r.jsxs("span",{className:"ml-2",children:[" Generated ",new Date(b.generatedAt).toLocaleString()]})]}),r.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Close"})]})})]})}):null},dne=({tip:e})=>{const[t,n]=h.useState(!1);return r.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[r.jsx("span",{className:"text-lg",children:one(e.category)}),r.jsx("h3",{className:"font-semibold text-gray-900",children:e.title}),r.jsx("span",{className:`px-2 py-1 text-xs rounded-full border ${lne(e.priority)}`,children:e.priority})]}),r.jsx("p",{className:"text-gray-600 mb-3",children:e.description}),t&&r.jsxs("div",{className:"space-y-3 mt-4 pt-4 border-t border-gray-100",children:[e.bestTime&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-700",children:"Best Time:"}),r.jsx("span",{className:"ml-2 text-gray-600",children:e.bestTime})]}),e.expectedOutcome&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-700",children:"Expected Outcome:"}),r.jsx("span",{className:"ml-2 text-gray-600",children:e.expectedOutcome})]}),e.example&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-700",children:"Example:"}),r.jsxs("div",{className:"mt-1 p-3 bg-blue-50 rounded-lg text-gray-700 italic",children:['"',e.example,'"']})]}),e.applicableCustomers&&e.applicableCustomers.length>0&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-700",children:"Applicable to:"}),r.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:e.applicableCustomers.map((s,a)=>r.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded",children:s},a))})]})]})]}),r.jsx("button",{onClick:()=>n(!t),className:"ml-4 text-blue-600 hover:text-blue-800 text-sm font-medium",children:t?"Show Less":"Show More"})]})})};class une{constructor(){this.geminiApiKey=void 0,this.geminiApiUrl=`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${this.geminiApiKey}`}isAvailable(){return!!this.geminiApiKey}async generateEmailContent(t,n={}){if(!this.isAvailable())throw new Error("Gemini AI service is not available. Please check VITE_GOOGLE_API_KEY.");try{console.log(" Generating AI email content for:",t.customer_name);const s=this._buildEmailPrompt(t,n),a=await fetch(this.geminiApiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:s}]}],generationConfig:{response_mime_type:"application/json",temperature:.7,maxOutputTokens:1e3}})});if(!a.ok)throw new Error(`Gemini API error: ${a.status}`);const i=await a.json(),l=JSON.parse(i.candidates[0].content.parts[0].text);return console.log(" AI email content generated successfully"),{success:!0,data:l}}catch(s){return console.error(" Error generating AI email content:",s),{success:!1,error:s.message,data:this._getFallbackEmailContent(t)}}}_buildEmailPrompt(t,n){const s=t.customer_name||"Valued Customer",a=t.type||"email",i=t.priority||"medium",l=t.reason||"Regular check-in",o=t.best_time||"Business hours",c=t.estimated_response_rate||"70%";return`GENERATE PERSONALIZED EMAIL CONTENT

CONTEXT:
- Customer: ${s}
- Communication Type: ${a}
- Priority: ${i}
- Reason: ${l}
- Best Contact Time: ${o}
- Expected Response Rate: ${c}
- Original Suggestion: ${t.suggestion}

CUSTOMER DATA:
${JSON.stringify(n,null,2)}

REQUIREMENTS:
1. Generate a professional, personalized email
2. Match the tone to the communication type and priority
3. Include specific value propositions
4. Make it actionable with clear next steps
5. Keep it concise but engaging
6. Use the customer's name naturally
7. Reference relevant business context when available

EMAIL STRUCTURE NEEDED:
- Subject line (compelling and specific)
- Greeting (personalized)
- Opening (context and purpose)
- Body (value proposition and details)
- Call to action (clear next steps)
- Closing (professional and warm)

TONE GUIDELINES:
- High priority: Urgent but respectful
- Medium priority: Professional and helpful
- Low priority: Friendly and informative
- Email type: Direct and business-focused
- Call type: Conversational and relationship-building
- LinkedIn type: Professional networking tone

OUTPUT FORMAT (JSON):
{
  "subject": "Compelling email subject line",
  "greeting": "Personalized greeting",
  "opening": "Context and purpose paragraph",
  "body": "Main content with value proposition",
  "call_to_action": "Clear next steps",
  "closing": "Professional closing",
  "full_email": "Complete email text",
  "tone": "professional|friendly|urgent",
  "key_points": ["point1", "point2", "point3"],
  "personalization_notes": "How this email is personalized for the customer"
}

Generate the email content now:`}_getFallbackEmailContent(t){const n=t.customer_name||"Valued Customer",s=t.template||"Thank you for your business. We wanted to reach out and see how things are going.";return{subject:`Following up - ${n}`,greeting:"Hi there,",opening:"I hope this email finds you well.",body:s,call_to_action:"Please let me know if you have any questions or if there's anything I can help you with.",closing:`Best regards,
Your Account Manager`,full_email:`Hi there,

I hope this email finds you well.

${s}

Please let me know if you have any questions or if there's anything I can help you with.

Best regards,
Your Account Manager`,tone:"professional",key_points:["Check-in","Support offer","Relationship building"],personalization_notes:"Basic template with customer name"}}async regenerateEmailContent(t,n={}){const s={...t,tone_preference:n.tone||"professional",length_preference:n.length||"medium",focus_area:n.focus||"relationship"};return this.generateEmailContent(s,n.customerData)}getEmailScenarios(){return[{id:"check_in",name:"Regular Check-in",description:"Friendly customer check-in",tone:"friendly"},{id:"renewal",name:"Contract Renewal",description:"Discuss contract renewal",tone:"professional"},{id:"upsell",name:"Upsell Opportunity",description:"Present additional services",tone:"consultative"},{id:"support",name:"Support Follow-up",description:"Follow up on support issues",tone:"helpful"},{id:"onboarding",name:"Onboarding Check",description:"Check onboarding progress",tone:"supportive"}]}}const gC=new une,mne=({isOpen:e,onClose:t,task:n,onSend:s})=>{var N,k,j,S;const[a,i]=h.useState({to:"",subject:"",body:"",customerName:""}),[l,o]=h.useState(!1),[c,d]=h.useState(!1),[u,m]=h.useState(!1),[p,f]=h.useState(null);h.useEffect(()=>{var _,C;if(n&&e){const D=((_=n.metadata)==null?void 0:_.customer_name)||"Customer",A=((C=n.metadata)==null?void 0:C.customer_email)||`contact@${D.toLowerCase().replace(/\s+/g,"")}.com`;i({to:A,subject:y(n),body:g(n),customerName:D}),m(!1),f(null)}},[n,e]);const y=_=>{var A,E,T;const C=((A=_.metadata)==null?void 0:A.customer_name)||"Customer";(E=_.metadata)==null||E.task_type;const D=(T=_.metadata)==null?void 0:T.email_type;if(D)switch(D){case"check-in":return`Checking in - ${C}`;case"renewal":return`Contract Renewal Discussion - ${C}`;case"upsell":return`Growth Opportunities for ${C}`;case"support":return`Support Follow-up - ${C}`;case"onboarding":return`Welcome to the team, ${C}!`;default:return`Following up - ${C}`}return _.title||`Following up - ${C}`},g=_=>{var D;return`Hi ${((D=_.metadata)==null?void 0:D.customer_name)||"Customer"},

${_.description||"I wanted to follow up with you regarding our recent conversation."}

Best regards,
[Your Name]`},x=async()=>{var _,C,D,A,E;if(!gC.isAvailable()){f("AI email generation is not available. Please check your API configuration.");return}o(!0),f(null);try{const T={customer_name:((_=n.metadata)==null?void 0:_.customer_name)||"Customer",customer_email:a.to,type:((C=n.metadata)==null?void 0:C.email_type)||"follow-up",message:n.description,priority:n.priority,context:`Task: ${n.title}`},M={industry:(D=n.metadata)==null?void 0:D.industry,status:(A=n.metadata)==null?void 0:A.status,last_interaction:(E=n.metadata)==null?void 0:E.last_interaction},L=await gC.generateEmailContent(T,M);L.success?(i(P=>({...P,subject:L.subject||P.subject,body:L.body||P.body})),m(!0)):f(L.error||"Failed to generate AI content")}catch(T){console.error("AI generation error:",T),f("Failed to generate AI content. Please try again.")}finally{o(!1)}},b=async()=>{d(!0),f(null);try{if(!a.to||!a.subject||!a.body)throw new Error("Please fill in all required fields");s&&await s({...a,taskId:n.id,taskTitle:n.title}),t()}catch(_){console.error("Send error:",_),f(_.message||"Failed to send email")}finally{d(!1)}},v=async()=>{try{const _=`To: ${a.to}
Subject: ${a.subject}

${a.body}`;await navigator.clipboard.writeText(_)}catch(_){console.error("Copy failed:",_)}},w=()=>{const _=`https://mail.google.com/mail/?view=cm&fs=1&to=${encodeURIComponent(a.to)}&subject=${encodeURIComponent(a.subject)}&body=${encodeURIComponent(a.body)}`;window.open(_,"_blank")};return!e||!n?null:(((N=n.metadata)==null?void 0:N.task_type)==="email"||((k=n.metadata)==null?void 0:k.communication_method)==="email"||((j=n.title)==null||j.toLowerCase().includes("email")),r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(Dt,{className:"h-6 w-6 text-blue-600"}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Email Task"}),r.jsx("p",{className:"text-sm text-gray-500",children:n.title})]})]}),r.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:r.jsx(Ze,{className:"h-6 w-6"})})]}),r.jsxs("div",{className:"p-6 space-y-4 max-h-[calc(90vh-200px)] overflow-y-auto",children:[r.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[r.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[r.jsx(qt,{className:"h-4 w-4 text-blue-600"}),r.jsx("span",{className:"font-medium text-blue-900",children:"Task Details"})]}),r.jsx("p",{className:"text-blue-800 text-sm",children:n.description}),((S=n.metadata)==null?void 0:S.customer_name)&&r.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[r.jsx(_t,{className:"h-4 w-4 text-blue-600"}),r.jsxs("span",{className:"text-blue-800 text-sm",children:["Customer: ",n.metadata.customer_name]})]})]}),p&&r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:r.jsx("p",{className:"text-red-600 text-sm",children:p})}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx(ps,{htmlFor:"to",children:"To"}),r.jsx(gs,{id:"to",type:"email",value:a.to,onChange:_=>i(C=>({...C,to:_.target.value})),placeholder:"customer@example.com",className:"mt-1"})]}),r.jsxs("div",{children:[r.jsx(ps,{htmlFor:"subject",children:"Subject"}),r.jsx(gs,{id:"subject",value:a.subject,onChange:_=>i(C=>({...C,subject:_.target.value})),placeholder:"Email subject",className:"mt-1"})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx(ps,{htmlFor:"body",children:"Message"}),u&&r.jsxs(an,{variant:"secondary",className:"text-xs",children:[r.jsx(Mr,{className:"h-3 w-3 mr-1"}),"AI Generated"]})]}),r.jsx(Ki,{id:"body",value:a.body,onChange:_=>i(C=>({...C,body:_.target.value})),placeholder:"Email content",rows:8,className:"mt-1"})]})]})]}),r.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsxs(H,{variant:"outline",size:"sm",onClick:x,disabled:l,className:"text-purple-600 border-purple-200 hover:bg-purple-50",children:[l?r.jsx(Ct,{className:"h-4 w-4 mr-2 animate-spin"}):r.jsx(Mr,{className:"h-4 w-4 mr-2"}),l?"Generating...":"AI Generate"]}),r.jsxs(H,{variant:"outline",size:"sm",onClick:v,className:"text-gray-600 border-gray-200 hover:bg-gray-50",children:[r.jsx(yc,{className:"h-4 w-4 mr-2"}),"Copy"]}),r.jsxs(H,{variant:"outline",size:"sm",onClick:w,className:"text-red-600 border-red-200 hover:bg-red-50",children:[r.jsx(sa,{className:"h-4 w-4 mr-2"}),"Open in Gmail"]})]}),r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(H,{variant:"outline",onClick:t,children:"Cancel"}),r.jsxs(H,{onClick:b,disabled:c||!a.to||!a.subject||!a.body,className:"bg-blue-600 hover:bg-blue-700",children:[c?r.jsx(Ct,{className:"h-4 w-4 mr-2 animate-spin"}):r.jsx(to,{className:"h-4 w-4 mr-2"}),c?"Sending...":"Send Email"]})]})]})})]})}))},hne=({isOpen:e,onClose:t,onAcceptTasks:n,generationType:s})=>{var ee;const{user:a,idToken:i}=Qr(),[l,o]=h.useState([]),[c,d]=h.useState(new Set),[u,m]=h.useState(!1),[p,f]=h.useState(null),[y,g]=h.useState(null),[x,b]=h.useState("both"),[v,w]=h.useState(""),[N,k]=h.useState(!1),[j,S]=h.useState([]),[_,C]=h.useState(!1),[D,A]=h.useState(new Set),[E,T]=h.useState({}),[M,L]=h.useState({}),[P,$]=h.useState(!1),[R,U]=h.useState(!1),[I,z]=h.useState(null),[F,O]=h.useState(new Set),[K,J]=h.useState(!1),[se,Z]=h.useState(!1),[oe,W]=h.useState(null),[B,V]=h.useState({}),[re,Me]=h.useState(new Set);h.useEffect(()=>{e&&s?he():e||(z(null),f(null))},[e,s]);const he=async()=>{var X;m(!0),f(null),o([]),d(new Set),A(new Set),T({}),L({}),O(new Set),V({}),Me(new Set),z(null);try{let te;switch(s){case"clients":if(!(a!=null&&a.email))throw new Error("User email not available. Please ensure you are logged in.");te=await Bre(a.email,x);break;case"meetings":te=await Ure();break;case"goals":if(!(a!=null&&a.email))throw new Error("User email not available. Please ensure you are logged in.");te=await qre(a.email);break;default:throw new Error("Invalid generation type")}if(te.success)o(te.tasks||[]),g(te.sessionData||null),d(new Set(((X=te.tasks)==null?void 0:X.map(we=>we.id))||[]));else throw new Error(te.error||"Failed to generate tasks")}catch(te){console.error("Error generating tasks:",te),f(te.message)}finally{m(!1)}},G=async()=>{var X;if(!v.trim()){f("Please provide feedback to refine the tasks");return}if(ke||Pe){f("Please save or cancel your current edits and task feedback before refining all tasks");return}if(!y){f("Session data not available for refinement");return}m(!0),f(null),z(null);try{if(!(a!=null&&a.email))throw new Error("User email not available. Please ensure you are logged in.");const te=s==="clients"?await fC(l,v,y,a.email):await pC(v,l,y,a.email);if(te.success)S(we=>{var Ne;return[...we,{feedback:v,timestamp:new Date().toISOString(),tasksCount:((Ne=te.tasks)==null?void 0:Ne.length)||0}]}),o(te.tasks||[]),g(te.sessionData),d(new Set(((X=te.tasks)==null?void 0:X.map(we=>we.id))||[])),w(""),k(!1);else throw new Error(te.error||"Failed to refine tasks")}catch(te){console.error("Error refining tasks:",te),f(te.message)}finally{m(!1)}},q=X=>{const te=new Set(c);te.has(X)?te.delete(X):te.add(X),d(te)},Q=()=>{c.size===l.length?d(new Set):d(new Set(l.map(X=>X.id)))},ue=async()=>{const X=l.filter(te=>c.has(te.id));if(s==="goals"||s==="clients"){U(!0),f(null),z(null);try{if(!i)throw new Error("Authentication token not found. Please log in again.");const te=s==="goals"?await Vre(X,i):await Gre(X,i);if(z(te),te.success)n(X),t();else{const we=te.errors.length===X.length?`Failed to save all ${X.length} tasks`:`Saved ${te.successCount} of ${X.length} tasks. ${te.errorCount} failed.`;f(we)}}catch(te){console.error("Error saving tasks to database:",te),f(te.message||"Failed to save tasks to database")}finally{U(!1)}}else n(X),t()},Le=X=>{const te=l.find(we=>we.id===X);te&&(A(we=>new Set(we).add(X)),L(we=>({...we,[X]:{...te}})),T(we=>({...we,[X]:{title:te.title,description:te.description,priority:te.priority,due:te.due,estimatedHours:te.estimatedHours||2}})))},ge=X=>{A(te=>{const we=new Set(te);return we.delete(X),we}),T(te=>{const we={...te};return delete we[X],we})},Se=async X=>{try{$(!0);const te=E[X],we=await Hre([{id:X,...te}],y,a==null?void 0:a.email);if(we.success)o(Ne=>Ne.map(nt=>nt.id===X?{...nt,title:te.title,description:te.description,priority:te.priority,due:te.due,estimatedHours:te.estimatedHours}:nt)),A(Ne=>{const nt=new Set(Ne);return nt.delete(X),nt}),T(Ne=>{const nt={...Ne};return delete nt[X],nt}),f(null);else throw new Error(we.error||"Failed to save task")}catch(te){console.error("Error saving task:",te),f("Failed to save task changes: "+te.message)}finally{$(!1)}},ce=(X,te,we)=>{T(Ne=>({...Ne,[X]:{...Ne[X],[te]:we}}))},ke=D.size>0,Pe=F.size>0||re.size>0,qe=X=>{O(te=>{const we=new Set(te);return we.has(X)?(we.delete(X),V(Ne=>{const nt={...Ne};return delete nt[X],nt})):(we.add(X),z(null)),we})},ne=(X,te)=>{V(we=>({...we,[X]:te}))},ye=async X=>{const te=B[X];if(!te||!te.trim()){f("Please provide feedback for this task");return}const we=l.find(Ne=>Ne.id===X);if(!we){f("Task not found");return}Me(Ne=>new Set(Ne).add(X)),f(null),z(null);try{const Ne=s==="clients"?await fC([we],te,y,a==null?void 0:a.email):await pC(te,[we],y,a==null?void 0:a.email);if(Ne.success&&Ne.tasks&&Ne.tasks.length>0){if(console.log(`Individual refinement returned ${Ne.tasks.length} tasks`),Ne.tasks.length===1){const nt=Ne.tasks[0];o(ie=>ie.map(xe=>xe.id===X?{...nt,id:X}:xe)),S(ie=>[...ie,{feedback:`Task-specific: ${te}`,timestamp:new Date().toISOString(),tasksCount:1,taskId:X,taskTitle:we.title}])}else o(nt=>{const ie=nt.filter(Ie=>Ie.id!==X),xe=Ne.tasks.map((Ie,Oe)=>({...Ie,id:`${X}-split-${Oe+1}`}));return[...ie,...xe]}),c.has(X)&&d(nt=>{const ie=new Set(nt);return ie.delete(X),Ne.tasks.forEach((xe,Ie)=>{ie.add(`${X}-split-${Ie+1}`)}),ie}),S(nt=>[...nt,{feedback:`Task-specific: ${te}`,timestamp:new Date().toISOString(),tasksCount:Ne.tasks.length,taskId:X,taskTitle:we.title,splitInto:Ne.tasks.length}]);V(nt=>{const ie={...nt};return delete ie[X],ie}),O(nt=>{const ie=new Set(nt);return ie.delete(X),ie})}else throw new Error(Ne.error||"Failed to refine individual task")}catch(Ne){console.error("Error refining individual task:",Ne),f(`Failed to refine task: ${Ne.message}`)}finally{Me(Ne=>{const nt=new Set(Ne);return nt.delete(X),nt})}},Ee=X=>{W(X),Z(!0)},st=async X=>{try{console.log(" Sending email:",X),console.log(" Email sent successfully"),oe&&o(te=>te.map(we=>we.id===oe.id?{...we,status:"completed",emailSent:!0}:we))}catch(te){throw console.error(" Failed to send email:",te),te}},Ke=X=>{var te,we,Ne;return X.type==="email-task"||((te=X.metadata)==null?void 0:te.task_type)==="email"||((we=X.metadata)==null?void 0:we.communication_method)==="email"||((Ne=X.title)==null?void 0:Ne.toLowerCase().includes("email"))},At=()=>{switch(s){case"clients":return{title:"Tasks from Client Data",description:"AI-generated follow-up tasks based on your client interactions and lead status",icon:qt,color:"text-blue-600",bgColor:"bg-blue-50"};case"meetings":return{title:"Tasks from Meetings",description:"Action items and follow-ups generated from your recent meetings",icon:Kr,color:"text-purple-600",bgColor:"bg-purple-50"};case"goals":return{title:"Tasks from Goals",description:"Strategic tasks generated to help you achieve your business objectives",icon:Er,color:"text-green-600",bgColor:"bg-green-50"};default:return{title:"Generate Tasks",description:"AI-generated tasks",icon:Wt,color:"text-gray-600",bgColor:"bg-gray-50"}}},lt=X=>{switch(X){case"completed":return r.jsx(na,{className:"w-4 h-4 text-emerald-600"});case"in-progress":return r.jsx(jt,{className:"w-4 h-4 text-indigo-600"});case"overdue":return r.jsx(dt,{className:"w-4 h-4 text-rose-600"});default:return r.jsx(jt,{className:"w-4 h-4 text-slate-400"})}},Ht=X=>{switch(X){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},pt=X=>{switch(X){case"lead-followup":return r.jsx(Er,{className:"w-4 h-4"});case"interaction-followup":return r.jsx(kt,{className:"w-4 h-4"});case"meeting-followup":return r.jsx(Kr,{className:"w-4 h-4"});case"email-task":return r.jsx(Mail,{className:"w-4 h-4 text-blue-600"});default:return r.jsx(_n,{className:"w-4 h-4"})}};if(!e)return null;const be=At(),ze=be.icon;return r.jsxs(ht,{children:[r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:t,children:r.jsxs(de.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",onClick:X=>X.stopPropagation(),children:[r.jsx("div",{className:`px-6 py-4 border-b border-slate-200 ${be.bgColor}`,children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`w-10 h-10 ${be.bgColor} rounded-lg flex items-center justify-center`,children:r.jsx(ze,{className:`w-5 h-5 ${be.color}`})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:be.title}),r.jsx("p",{className:"text-sm text-slate-600",children:be.description}),s==="clients"&&r.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[r.jsx("span",{className:"text-xs font-medium text-slate-500",children:"Source:"}),r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsxs("label",{className:"flex items-center space-x-1 cursor-pointer",children:[r.jsx("input",{type:"radio",name:"sourceType",value:"both",checked:x==="both",onChange:X=>b(X.target.value),className:"text-blue-600 focus:ring-blue-500 w-3 h-3"}),r.jsx("span",{className:"text-xs text-slate-600",children:"Both"})]}),r.jsxs("label",{className:"flex items-center space-x-1 cursor-pointer",children:[r.jsx("input",{type:"radio",name:"sourceType",value:"crm",checked:x==="crm",onChange:X=>b(X.target.value),className:"text-blue-600 focus:ring-blue-500 w-3 h-3"}),r.jsx("span",{className:"text-xs text-slate-600",children:"CRM"})]}),r.jsxs("label",{className:"flex items-center space-x-1 cursor-pointer",children:[r.jsx("input",{type:"radio",name:"sourceType",value:"leads",checked:x==="leads",onChange:X=>b(X.target.value),className:"text-blue-600 focus:ring-blue-500 w-3 h-3"}),r.jsx("span",{className:"text-xs text-slate-600",children:"Leads"})]}),r.jsxs(H,{variant:"outline",size:"sm",onClick:he,disabled:u,className:"text-xs px-2 py-1 h-6",children:[r.jsx(Be,{className:"w-3 h-3 mr-1"}),"Regenerate"]})]})]})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[s==="clients"&&r.jsxs(H,{variant:"outline",size:"sm",onClick:()=>J(!0),className:"text-blue-600 border-blue-200 hover:bg-blue-50",children:[r.jsx(Kr,{className:"w-4 h-4 mr-2"}),"Communication Tips"]}),r.jsx(H,{variant:"ghost",size:"sm",onClick:t,className:"rounded-full w-8 h-8 p-0",children:r.jsx(Ze,{className:"w-4 h-4"})})]})]})}),r.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[u&&r.jsxs("div",{className:"flex items-center justify-center py-12",children:[r.jsx(Be,{className:"w-6 h-6 text-gray-400 animate-spin mr-3"}),r.jsx("span",{className:"text-gray-500",children:"Generating tasks..."})]}),p&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(dt,{className:"w-8 h-8 text-red-400 mx-auto mb-3"}),r.jsx("p",{className:"text-red-600 mb-4",children:p}),I&&I.errors.length>0&&r.jsxs("div",{className:"mb-4 text-left max-w-md mx-auto",children:[r.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Failed tasks:"}),r.jsx("ul",{className:"text-sm text-red-600 space-y-1",children:I.errors.map((X,te)=>r.jsxs("li",{children:[" ",X.originalTask.title,": ",X.error]},te))})]}),r.jsxs(H,{onClick:he,variant:"outline",children:[r.jsx(Be,{className:"w-4 h-4 mr-2"}),"Try Again"]})]}),I&&I.success&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(na,{className:"w-8 h-8 text-green-400 mx-auto mb-3"}),r.jsx("p",{className:"text-green-600 mb-2",children:"Tasks saved successfully!"}),r.jsxs("p",{className:"text-sm text-gray-500",children:[I.successCount," task",I.successCount!==1?"s":""," added to your dashboard"]})]}),!u&&!p&&l.length===0&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(ze,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),r.jsx("p",{className:"text-gray-500 mb-2",children:"No tasks to generate"}),r.jsxs("p",{className:"text-sm text-gray-400",children:[s==="clients"&&"No active leads or client interactions found.",s==="meetings"&&"No recent meetings found.",s==="goals"&&"No active goals found."]})]}),!u&&!p&&l.length>0&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Vd,{checked:c.size===l.length,onCheckedChange:Q}),r.jsxs("span",{className:"font-medium text-slate-700",children:["Select All (",l.length," tasks)"]})]}),r.jsxs("span",{className:"text-sm text-slate-500",children:[c.size," of ",l.length," selected"]})]}),r.jsx("div",{className:"space-y-3",children:l.map((X,te)=>{var Ie;const we=D.has(X.id),Ne=E[X.id],nt=s==="goals",ie=s==="clients",xe=nt||ie;return r.jsx(de.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`p-4 border rounded-lg transition-all ${we?"border-blue-300 bg-blue-50/50":c.has(X.id)?"border-blue-200 bg-blue-50/50":"border-slate-200 bg-white hover:border-slate-300"}`,children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(Vd,{checked:c.has(X.id),onCheckedChange:()=>q(X.id),disabled:we,className:`mt-1 ${we?"opacity-50":""}`}),r.jsx("div",{className:"flex-1 min-w-0",children:we&&xe?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-1",children:"Task Title"}),r.jsx(gs,{value:(Ne==null?void 0:Ne.title)||"",onChange:Oe=>ce(X.id,"title",Oe.target.value),className:"w-full",placeholder:"Enter task title..."})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-1",children:"Description"}),r.jsx(Ki,{value:(Ne==null?void 0:Ne.description)||"",onChange:Oe=>ce(X.id,"description",Oe.target.value),className:"w-full",rows:3,placeholder:"Enter task description..."})]}),r.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-1",children:"Priority"}),r.jsxs(Nl,{value:(Ne==null?void 0:Ne.priority)||"medium",onValueChange:Oe=>ce(X.id,"priority",Oe),className:"w-full",children:[r.jsx(wr,{value:"low",children:"Low"}),r.jsx(wr,{value:"medium",children:"Medium"}),r.jsx(wr,{value:"high",children:"High"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-1",children:"Estimated Hours"}),r.jsx(gs,{type:"number",min:"0.5",max:"40",step:"0.5",value:(Ne==null?void 0:Ne.estimatedHours)||2,onChange:Oe=>ce(X.id,"estimatedHours",parseFloat(Oe.target.value)||2),className:"w-full"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-slate-700 mb-1",children:"Due Date"}),r.jsx(gs,{type:"date",value:(Ne==null?void 0:Ne.due)||"",onChange:Oe=>ce(X.id,"due",Oe.target.value),className:"w-full"})]})]}),X.goalAlignment&&r.jsx("div",{className:"text-xs text-slate-600 bg-green-50 border border-green-200 p-3 rounded-lg",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Er,{className:"w-4 h-4 text-green-600"}),r.jsx("strong",{children:"Goal Alignment:"})," ",X.goalAlignment]})}),r.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-slate-200",children:[r.jsxs(H,{variant:"outline",size:"sm",onClick:()=>ge(X.id),className:"flex items-center gap-1",children:[r.jsx(Ze,{className:"w-3 h-3"}),"Cancel"]}),r.jsxs(H,{size:"sm",onClick:()=>Se(X.id),disabled:P,className:"flex items-center gap-1 bg-green-600 hover:bg-green-700",children:[P?r.jsx(Be,{className:"w-3 h-3 animate-spin"}):r.jsx($n,{className:"w-3 h-3"}),"Save Changes"]})]})]}):r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-start justify-between mb-2 gap-3",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[pt(X.type),r.jsx("h4",{className:"font-medium text-slate-800 truncate",children:X.title})]}),r.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[xe&&r.jsxs(r.Fragment,{children:[r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>qe(X.id),className:`h-6 px-2 text-slate-500 hover:text-slate-700 hover:bg-slate-100 ${F.has(X.id)?"bg-blue-100 text-blue-700":""}`,title:"Refine this task with AI feedback",children:r.jsx(Kr,{className:"w-3 h-3"})}),r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>Le(X.id),className:"h-6 px-2 text-slate-500 hover:text-slate-700 hover:bg-slate-100",title:"Edit task manually",children:r.jsx(nl,{className:"w-3 h-3"})}),Ke(X)&&r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>Ee(X),className:"h-6 px-2 text-blue-500 hover:text-blue-700 hover:bg-blue-100",title:"Edit email content",children:r.jsx(Mail,{className:"w-3 h-3"})})]}),r.jsxs(an,{className:Ht(X.priority),variant:"outline",children:[r.jsx(MC,{className:"w-3 h-3 mr-1"}),X.priority]}),lt(X.status)]})]}),X.description&&r.jsx("p",{className:"text-sm text-slate-600 mb-2",children:X.description}),r.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-500",children:[X.due&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(yt,{className:"w-3 h-3"}),r.jsxs("span",{children:["Due: ",X.due]})]}),X.estimatedHours&&xe&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(jt,{className:"w-3 h-3"}),r.jsxs("span",{children:[X.estimatedHours,"h"]})]}),X.assignedTo&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(kt,{className:"w-3 h-3"}),r.jsx("span",{children:X.assignedTo})]}),X.source&&r.jsx(an,{variant:"outline",className:"text-xs",children:X.source}),X.goalAlignment&&nt&&r.jsxs(an,{variant:"outline",className:"text-xs bg-green-50 text-green-700 border-green-200",children:[r.jsx(Er,{className:"w-3 h-3 mr-1"}),"Goal-aligned"]}),X.clientAlignment&&ie&&r.jsxs(an,{variant:"outline",className:"text-xs bg-blue-50 text-blue-700 border-blue-200",children:[r.jsx(_n,{className:"w-3 h-3 mr-1"}),"Client-focused"]})]}),F.has(X.id)&&nt&&r.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Kr,{className:"w-4 h-4 text-blue-600"}),r.jsx("span",{className:"text-sm font-medium text-blue-700",children:"Refine This Task"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(Ki,{value:B[X.id]||"",onChange:Oe=>ne(X.id,Oe.target.value),placeholder:`How would you like to improve "${X.title}"? Examples: "Make this more specific", "Add technical details", "Split into 3 subtasks", "Include timeline"`,className:"w-full text-sm",rows:2}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(H,{size:"sm",onClick:()=>ye(X.id),disabled:!((Ie=B[X.id])!=null&&Ie.trim())||re.has(X.id),className:"bg-blue-600 hover:bg-blue-700 text-white",children:re.has(X.id)?r.jsxs(r.Fragment,{children:[r.jsx(Ct,{className:"w-3 h-3 mr-1 animate-spin"}),"Refining..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Be,{className:"w-3 h-3 mr-1"}),"Refine Task"]})}),r.jsxs(H,{variant:"outline",size:"sm",onClick:()=>qe(X.id),children:[r.jsx(Ze,{className:"w-3 h-3 mr-1"}),"Cancel"]})]})]})]})]})})]})},X.id||`task-${te}`)})})]})]}),!u&&!p&&l.length>0&&s!=="goals"&&r.jsxs("div",{className:"px-6 py-4 border-t border-slate-200",children:[j.length>0&&r.jsxs("div",{className:"mb-4",children:[r.jsx("h4",{className:"text-sm font-medium text-slate-700 mb-2",children:"Refinement History"}),r.jsx("div",{className:"space-y-2",children:j.map((X,te)=>r.jsxs("div",{className:`text-xs p-2 rounded border ${X.taskId?"bg-blue-50 border-blue-200":"bg-slate-50 border-slate-200"}`,children:[r.jsx("div",{className:"font-medium text-slate-600",children:X.taskId?r.jsxs(r.Fragment,{children:[r.jsx(Kr,{className:"w-3 h-3 inline mr-1"}),'Task "',X.taskTitle,'": "',X.feedback.replace("Task-specific: ",""),'"']}):r.jsxs(r.Fragment,{children:["Feedback ",te+1,': "',X.feedback,'"']})}),r.jsxs("div",{className:"text-slate-500 mt-1",children:[X.taskId?X.splitInto?`Task split into ${X.splitInto} subtasks`:"Individual task refined":`Generated ${X.tasksCount} tasks`,"  ",new Date(X.timestamp).toLocaleTimeString()]})]},te))})]}),r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs(H,{variant:"outline",onClick:()=>{k(!N),N||z(null)},className:"flex items-center gap-2",children:[r.jsx(Kr,{className:"w-4 h-4"}),N?"Hide Feedback":"Provide Feedback"]}),y&&r.jsxs("span",{className:"text-xs text-slate-500",children:["Session: ",(ee=y.sessionId)==null?void 0:ee.slice(-8)]})]}),r.jsx(ht,{children:N&&r.jsxs(de.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-3",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"How would you like to adjust these tasks?"}),r.jsx("textarea",{value:v,onChange:X=>w(X.target.value),placeholder:"e.g., 'Make tasks more specific', 'Add more technical tasks', 'Reduce the timeline', etc.",className:"w-full p-3 border border-slate-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(H,{onClick:G,disabled:!v.trim()||u||ke||Pe,className:"flex items-center gap-2",children:[u?r.jsx(Be,{className:"w-4 h-4 animate-spin"}):r.jsx(Be,{className:"w-4 h-4"}),"Refine Tasks"]}),r.jsx(H,{variant:"outline",onClick:()=>{k(!1),w("")},children:"Cancel"})]})]})})]}),!u&&!p&&l.length>0&&r.jsxs("div",{className:"px-6 py-4 border-t border-slate-200 bg-slate-50",children:[(ke||Pe)&&r.jsxs("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx(dt,{className:"w-4 h-4 text-amber-600"}),r.jsx("span",{className:"text-sm font-medium text-amber-700",children:"Active Changes"})]}),r.jsxs("p",{className:"text-sm text-amber-700",children:[ke&&`You have ${D.size} task(s) with unsaved edits. `,Pe&&`You have ${F.size} task(s) in feedback mode. `,"Please complete or cancel your changes before continuing."]})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("span",{className:"text-sm text-slate-600",children:[c.size," task",c.size!==1?"s":""," selected"]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx(H,{variant:"outline",onClick:t,children:"Cancel"}),r.jsx(H,{onClick:ue,disabled:c.size===0||ke||Pe||R,className:"bg-blue-600 hover:bg-blue-700",children:R?r.jsxs(r.Fragment,{children:[r.jsx(Ct,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving Tasks..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Xr,{className:"w-4 h-4 mr-2"}),"Accept Selected (",c.size,")"]})})]})]})]})]})},"main-modal"),r.jsx(cne,{isOpen:K,onClose:()=>J(!1),user:a,context:`Task generation context for ${s}`},"communication-tips-modal"),r.jsx(mne,{isOpen:se,onClose:()=>{Z(!1),W(null)},task:oe,onSend:st},"task-email-modal")]})},pne=({isOpen:e,onClose:t,task:n,onTaskUpdate:s,onTaskDelete:a})=>{const{idToken:i}=Qr(),[l,o]=h.useState({title:"",description:"",priority:"medium",status:"not-started",due_date:""}),[c,d]=h.useState(!1),[u,m]=h.useState(!1),[p,f]=h.useState(null),[y,g]=h.useState(!1);h.useEffect(()=>{n&&(o({title:n.title||"",description:n.description||"",priority:n.priority||"medium",status:n.status||"not-started",due_date:n.due?n.due.split("T")[0]:""}),g(!1))},[n]),h.useEffect(()=>{if(n){const C={title:n.title||"",description:n.description||"",priority:n.priority||"medium",status:n.status||"not-started",due_date:n.due?n.due.split("T")[0]:""},D=Object.keys(l).some(A=>l[A]!==C[A]);g(D)}},[l,n]);const x=(C,D,A)=>{f({isOpen:!0,type:C,title:D,message:A})},b=()=>{f(null)},v=(C,D)=>{o(A=>({...A,[C]:D}))},w=async(C,D)=>{o(A=>({...A,status:D}))},N=()=>{if(!l.title.trim())return x("error","Validation Error","Task title is required."),!1;if(l.due_date&&l.status!=="overdue"){const C=new Date(l.due_date),D=new Date;if(D.setHours(0,0,0,0),C<D)return x("error","Invalid Date","Due date cannot be in the past."),!1}return!0},k=async()=>{if(N()){if(!i){x("error","Authentication Required","Please log in to update tasks.");return}d(!0);try{const C={title:l.title.trim(),description:l.description.trim()||null,priority:l.priority,status:l.status,due_date:l.due_date||null},D=await Kre(n.id,C,i);if(D.success){const A={id:D.task.task_id,title:D.task.title,description:D.task.description,status:D.task.status,priority:D.task.priority,source:D.task.source,due:D.task.due_date,type:"dashboard",createdAt:D.task.created_at,isOverdue:D.task.is_overdue,daysUntilDue:D.task.days_until_due};s(A),g(!1),x("success","Task Updated","Task has been successfully updated.")}else x("error","Update Failed",D.error||"Failed to update task.")}catch(C){console.error("Error updating task:",C),x("error","Update Failed","An unexpected error occurred while updating the task.")}finally{d(!1)}}},j=async()=>{if(!i){x("error","Authentication Required","Please log in to delete tasks.");return}d(!0);try{const C=await $T(n.id,i);C.success?(a(n.id),t(),x("success","Task Deleted","Task has been successfully deleted.")):x("error","Delete Failed",C.error||"Failed to delete task.")}catch(C){console.error("Error deleting task:",C),x("error","Delete Failed","An unexpected error occurred while deleting the task.")}finally{d(!1),m(!1)}},S=()=>{y?window.confirm("You have unsaved changes. Are you sure you want to close?")&&t():t()},_=C=>{switch(C){case"urgent":return"bg-red-100 text-red-800 border-red-200";case"high":return"bg-orange-100 text-orange-800 border-orange-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return n?r.jsxs(r.Fragment,{children:[r.jsx(ht,{children:e&&r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:S,children:r.jsxs(de.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col",onClick:C=>C.stopPropagation(),children:[r.jsx("div",{className:"px-6 py-4 border-b border-slate-200 bg-slate-50",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:r.jsx(MC,{className:"w-5 h-5 text-blue-600"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Task Details"}),r.jsx("p",{className:"text-sm text-slate-600",children:"Edit task information"})]})]}),r.jsx(H,{variant:"ghost",size:"sm",onClick:S,className:"text-slate-400 hover:text-slate-600",children:r.jsx(Ze,{className:"w-5 h-5"})})]})}),r.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Task Title *"}),r.jsx(gs,{value:l.title,onChange:C=>v("title",C.target.value),placeholder:"Enter task title...",className:"w-full"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Description"}),r.jsx(Ki,{value:l.description,onChange:C=>v("description",C.target.value),placeholder:"Enter task description...",rows:4,className:"w-full"})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Priority"}),r.jsxs("select",{value:l.priority,onChange:C=>v("priority",C.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:"low",children:"Low"}),r.jsx("option",{value:"medium",children:"Medium"}),r.jsx("option",{value:"high",children:"High"}),r.jsx("option",{value:"urgent",children:"Urgent"})]}),r.jsx("div",{className:"mt-2",children:r.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs border ${_(l.priority)}`,children:l.priority.charAt(0).toUpperCase()+l.priority.slice(1)})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Status"}),r.jsx(FT,{currentStatus:l.status,taskId:n.id,onStatusChange:w,disabled:c,variant:"dropdown",showLabel:!0})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Due Date"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:"relative flex-1",children:[r.jsx(yt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),r.jsx(gs,{type:"date",value:l.due_date,onChange:C=>v("due_date",C.target.value),className:"pl-10"})]}),l.due_date&&r.jsx(H,{variant:"outline",size:"sm",onClick:()=>v("due_date",""),className:"text-slate-500 hover:text-slate-700",children:"Clear"})]})]})]}),r.jsx("div",{className:"px-6 py-4 border-t border-slate-200 bg-slate-50",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs(H,{variant:"outline",onClick:()=>m(!0),disabled:c,className:"text-red-600 border-red-300 hover:bg-red-50",children:[r.jsx(fr,{className:"w-4 h-4 mr-2"}),"Delete Task"]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(H,{variant:"outline",onClick:S,disabled:c,children:"Cancel"}),r.jsx(H,{onClick:k,disabled:c||!y,className:"bg-blue-600 hover:bg-blue-700",children:c?r.jsxs(r.Fragment,{children:[r.jsx(Ct,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):r.jsxs(r.Fragment,{children:[r.jsx($n,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]})]})})]})})}),r.jsx(ht,{children:u&&r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",onClick:()=>m(!1),children:r.jsxs(de.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6",onClick:C=>C.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:r.jsx(Cr,{className:"w-5 h-5 text-red-600"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-slate-800",children:"Delete Task"}),r.jsx("p",{className:"text-sm text-slate-600",children:"This action cannot be undone"})]})]}),r.jsxs("p",{className:"text-slate-700 mb-6",children:['Are you sure you want to delete "',r.jsx("strong",{children:n.title}),'"?']}),r.jsxs("div",{className:"flex items-center justify-end gap-3",children:[r.jsx(H,{variant:"outline",onClick:()=>m(!1),disabled:c,children:"Cancel"}),r.jsx(H,{onClick:j,disabled:c,className:"bg-red-600 hover:bg-red-700 text-white",children:c?r.jsxs(r.Fragment,{children:[r.jsx(Ct,{className:"w-4 h-4 mr-2 animate-spin"}),"Deleting..."]}):r.jsxs(r.Fragment,{children:[r.jsx(fr,{className:"w-4 h-4 mr-2"}),"Delete Task"]})})]})]})})}),p&&r.jsx(zT,{isOpen:p.isOpen,type:p.type,title:p.title,message:p.message,onClose:b,autoClose:!0,autoCloseDelay:4e3})]}):null},xC={"not-started":{icon:Gi,color:"text-slate-400",bgColor:"bg-slate-50 border-slate-200",label:"Not Started"},pending:{icon:Gi,color:"text-slate-400",bgColor:"bg-slate-50 border-slate-200",label:"Not Started"},"in-progress":{icon:jt,color:"text-indigo-600",bgColor:"bg-indigo-50 border-indigo-200",label:"In Progress"},overdue:{icon:dt,color:"text-rose-600",bgColor:"bg-rose-50 border-rose-200",label:"Overdue"},completed:{icon:na,color:"text-emerald-600",bgColor:"bg-emerald-50 border-emerald-200",label:"Completed"}},Cd=5,fne=()=>{const{idToken:e,isAuthenticated:t}=Qr(),[n,s]=h.useState([]),[a,i]=h.useState(!0),[l,o]=h.useState(null),[c]=h.useState("all"),[d,u]=h.useState(1),[m,p]=h.useState("all"),[f,y]=h.useState("all"),[g,x]=h.useState(!1),[b,v]=h.useState({title:"",description:"",status:"not-started",priority:"medium",dueDate:""}),[w,N]=h.useState({}),[k,j]=h.useState(!1),[S,_]=h.useState(!1),[C,D]=h.useState(null),[A,E]=h.useState(new Set),[T,M]=h.useState(!1),[L,P]=h.useState(null),[$,R]=h.useState(null),[U,I]=h.useState(null),[z,F]=h.useState(!1),[O,K]=h.useState(null);h.useEffect(()=>{V()},[]);const J=(be,ze,ee)=>{I({type:be,title:ze,message:ee,isOpen:!0})},se=()=>{I(null)},Z=be=>{K(be),F(!0)},oe=()=>{F(!1),K(null)},W=be=>{s(ze=>ze.map(ee=>ee.id===be.id?be:ee))},B=be=>{s(ze=>ze.filter(ee=>ee.id!==be)),E(ze=>{const ee=new Set(ze);return ee.delete(be),ee})},V=async()=>{if(i(!0),o(null),!t||!e){o("Please log in to view tasks"),i(!1);return}try{const be=await fetch("http://localhost:8004/api/tasks",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!be.ok)throw new Error("Failed to load tasks");const ee=(await be.json()).map(X=>({id:X.task_id,title:X.title,description:X.description,status:X.status,priority:X.priority,source:X.source,due:X.due_date,type:"dashboard",createdAt:X.created_at,isOverdue:X.is_overdue,daysUntilDue:X.days_until_due}));s(ee)}catch(be){console.error("Error loading dashboard data:",be),o(be.message)}finally{i(!1)}};h.useEffect(()=>{u(1)},[m,f,c]);const re=be=>{p(be)},Me=be=>{y(be)},he=async be=>{be.preventDefault();const ze={};if(b.title.trim()||(ze.title="Title is required"),b.dueDate||(ze.dueDate="Due date is required"),Object.keys(ze).length>0){N(ze);return}if(!t||!e){o("Please log in to create tasks");return}try{const ee={title:b.title.trim(),description:b.description.trim()||null,status:b.status,priority:b.priority,due_date:b.dueDate,source:"Manual"};console.log("Creating task with data:",ee),console.log("Using token:",e?"Token present":"No token");const X=await fetch("http://localhost:8004/api/tasks",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(ee)});if(!X.ok){let Ne="Failed to create task";try{const nt=await X.json();Ne=nt.detail||nt.message||JSON.stringify(nt)}catch{Ne=`HTTP ${X.status}: ${X.statusText}`}throw new Error(Ne)}const te=await X.json(),we={id:te.task_id,title:te.title,description:te.description,status:te.status,priority:te.priority,source:te.source,due:te.due_date,type:"dashboard",createdAt:te.created_at,isOverdue:te.is_overdue,daysUntilDue:te.days_until_due};s([...n,we]),v({title:"",description:"",status:"not-started",priority:"medium",dueDate:""}),N({}),x(!1)}catch(ee){console.error("Error creating task:",ee),o(`Failed to create task: ${ee.message}`)}},G=(be,ze)=>{v(ee=>({...ee,[be]:ze})),w[be]&&N(ee=>({...ee,[be]:""}))},q=()=>{v({title:"",description:"",status:"not-started",priority:"medium",dueDate:""}),N({}),x(!1)},Q=async(be,ze)=>{if(!e){J("error","Authentication Required","Please log in to update task status.");return}M(!0);try{const ee=await RT(be,ze,e);if(ee.success){const X=n.map(te=>te.id===be?{...te,status:ze}:te);s(X),J("success","Task Updated",`Task status changed to ${ze}.`)}else J("error","Update Failed",ee.error||"Failed to update task status.")}catch(ee){console.error("Error updating task status:",ee),J("error","Update Failed","An unexpected error occurred while updating the task.")}finally{M(!1)}},ue=be=>{E(ze=>{const ee=new Set(ze);return ee.has(be)?ee.delete(be):ee.add(be),ee})},Le=()=>{const be=ye.map(ze=>ze.id);E(new Set(be))},ge=()=>{E(new Set)},Se=async(be,ze)=>{if(!e){J("error","Authentication Required","Please log in to update task statuses.");return}M(!0);try{const ee=await Xre(be,ze,e);if(ee.success){const X=n.map(we=>be.includes(we.id)?{...we,status:ze}:we);s(X),E(new Set);const te=`Successfully updated ${ee.successCount} task${ee.successCount>1?"s":""} to ${ze}.`;J("success","Tasks Updated",te)}else{const X=ee.errors.length>0?`Failed to update ${ee.errorCount} of ${ee.totalTasks} tasks. Some tasks may have been updated successfully.`:"Failed to update task statuses.";J("error","Update Failed",X)}}catch(ee){console.error("Error updating multiple task statuses:",ee),J("error","Update Failed","An unexpected error occurred while updating tasks.")}finally{M(!1)}},ce=async be=>{if(!e){J("error","Authentication Required","Please log in to delete tasks.");return}if(window.confirm(`Are you sure you want to delete ${be.length} task${be.length>1?"s":""}? This action cannot be undone.`)){M(!0);try{const ee=await Jre(be,e);if(ee.success){const X=n.filter(we=>!be.includes(we.id));s(X),E(new Set);const te=`Successfully deleted ${ee.successCount} task${ee.successCount>1?"s":""}.`;J("success","Tasks Deleted",te)}else{const X=ee.errors.length>0?`Failed to delete ${ee.errorCount} of ${ee.totalTasks} tasks. Some tasks may have been deleted successfully.`:"Failed to delete tasks.";J("error","Delete Failed",X)}}catch(ee){console.error("Error deleting multiple tasks:",ee),J("error","Delete Failed","An unexpected error occurred while deleting tasks.")}finally{M(!1)}}},ke=()=>{D("meetings"),_(!0),j(!1)},Pe=()=>{D("goals"),_(!0),j(!1)},qe=()=>{D("clients"),_(!0),j(!1)},ne=be=>{const ze=Qre(be);s(ee=>[...ee,...ze]),_(!1),D(null)},ye=n.filter(be=>{if(c==="all"){let ze=!0;if(f!=="all"&&(ze=ze&&(be.status===f||f==="overdue"&&new Date(be.due)<new Date)),m!=="all")if(m==="today"){const ee=new Date().toISOString().split("T")[0];ze=ze&&be.due===ee}else if(m==="tomorrow"){const ee=new Date;ee.setDate(ee.getDate()+1),ze=ze&&be.due===ee.toISOString().split("T")[0]}else m==="overdue"&&(ze=ze&&new Date(be.due)<new Date);return ze}if(c==="overdue")return new Date(be.due)<new Date;if(c==="today"){const ze=new Date().toISOString().split("T")[0];return be.due===ze}return be.status===c}),Ee=be=>{switch(be){case"Goal":return{className:"bg-blue-100 text-blue-800 border-blue-200",icon:Er};case"Meeting":return{className:"bg-purple-100 text-purple-800 border-purple-200",icon:kt};case"Manual":default:return{className:"bg-gray-100 text-gray-800 border-gray-200",icon:null}}},st=be=>{switch(be){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},Ke=Math.ceil(ye.length/Cd),At=(d-1)*Cd,lt=ye.slice(At,At+Cd),Ht=()=>{u(be=>Math.max(1,be-1))},pt=()=>{u(be=>Math.min(Ke,be+1))};return a?r.jsx(de.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.35},children:r.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200/60 p-6 hover:shadow-md transition-shadow shadow-[0px_20px_92px_0px_rgba(0,0,0,0.03)] h-[650px] flex items-center justify-center",children:r.jsxs("div",{className:"flex items-center justify-center py-8",children:[r.jsx(Be,{className:"w-6 h-6 text-gray-400 animate-spin mr-2"}),r.jsx("span",{className:"text-gray-500",children:"Loading tasks..."})]})})}):l?r.jsx(de.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.35},children:r.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200/60 p-6 hover:shadow-md transition-shadow shadow-[0px_20px_92px_0px_rgba(0,0,0,0.03)] h-[650px] flex items-center justify-center",children:r.jsxs("div",{className:"text-center py-8",children:[r.jsx(dt,{className:"w-8 h-8 text-red-400 mx-auto mb-2"}),r.jsx("p",{className:"text-red-600 mb-4",children:"Failed to load tasks"}),r.jsx("button",{onClick:V,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Try Again"})]})})}):r.jsxs(de.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.35},children:[r.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 flex flex-col transition-shadow shadow-[0px_20px_92px_0px_rgba(0,0,0,0.03)] h-[750px]",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-slate-800",children:"Action Items"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:"relative",children:[r.jsxs(H,{onClick:()=>j(!k),size:"sm",children:[r.jsx(Mr,{className:"w-4 h-4 mr-2"}),"Generate Task",r.jsx(Xt,{className:"w-4 h-4 ml-2"})]}),k&&r.jsx("div",{className:"absolute right-0 top-full mt-2 w-48 bg-white rounded-md border border-slate-200 shadow-lg z-50",children:r.jsxs("div",{className:"py-1",children:[r.jsxs("button",{onClick:ke,className:"w-full px-4 py-2 text-left text-sm hover:bg-slate-50 flex items-center gap-2 text-slate-700",children:[r.jsx(Kr,{className:"w-4 h-4"}),"From Meeting"]}),r.jsxs("button",{onClick:Pe,className:"w-full px-4 py-2 text-left text-sm hover:bg-slate-50 flex items-center gap-2 text-slate-700",children:[r.jsx(Er,{className:"w-4 h-4"}),"From Goal"]}),r.jsxs("button",{onClick:qe,className:"w-full px-4 py-2 text-left text-sm hover:bg-slate-50 flex items-center gap-2 text-slate-700",children:[r.jsx(qt,{className:"w-4 h-4"}),"From Clients"]})]})})]}),r.jsxs(H,{onClick:()=>x(!0),size:"sm",className:"bg-slate-600 hover:bg-slate-700 text-white",children:[r.jsx(Wt,{className:"w-4 h-4 mr-2"}),"Add Task"]})]})]}),r.jsx("div",{className:"flex items-center gap-4 mb-6",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[r.jsx(da,{className:"w-4 h-4"}),r.jsx("span",{children:"Filter by:"})]}),r.jsxs(Nl,{value:m,onValueChange:re,className:"w-32",size:"sm",children:[r.jsx(wr,{value:"all",children:"All Time"}),r.jsx(wr,{value:"today",children:"Today"}),r.jsx(wr,{value:"tomorrow",children:"Tomorrow"}),r.jsx(wr,{value:"overdue",children:"Overdue"})]}),r.jsxs(Nl,{value:f,onValueChange:Me,className:"w-36",size:"sm",children:[r.jsx(wr,{value:"all",children:"All Status"}),r.jsx(wr,{value:"not-started",children:"Not Started"}),r.jsx(wr,{value:"in-progress",children:"In Progress"}),r.jsx(wr,{value:"completed",children:"Completed"}),r.jsx(wr,{value:"overdue",children:"Overdue"})]})]})}),g&&r.jsx(de.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-6 p-4 bg-slate-50 border border-slate-200 rounded-lg",children:r.jsxs("form",{onSubmit:he,className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h4",{className:"font-medium text-slate-800",children:"Create New Task"}),r.jsx(H,{type:"button",variant:"ghost",size:"sm",onClick:q,className:"text-slate-500 hover:text-slate-700",children:r.jsx(Ze,{className:"w-4 h-4"})})]}),r.jsxs("div",{children:[r.jsx(ps,{htmlFor:"task-title",className:"text-sm font-medium text-slate-700 mb-1 block",children:"Title *"}),r.jsx(gs,{id:"task-title",value:b.title,onChange:be=>G("title",be.target.value),placeholder:"Enter task title...",className:`bg-white border-slate-200 focus:border-slate-400 focus:ring-2 focus:ring-slate-200 ${w.title?"border-red-300 focus:border-red-500 focus:ring-red-200":""}`,required:!0}),w.title&&r.jsx("p",{className:"text-red-600 text-sm mt-1",children:w.title})]}),r.jsxs("div",{children:[r.jsx(ps,{htmlFor:"task-description",className:"text-sm font-medium text-slate-700 mb-1 block",children:"Description"}),r.jsx(Ki,{id:"task-description",value:b.description,onChange:be=>G("description",be.target.value),placeholder:"Enter task description...",rows:2,className:"resize-none bg-white  border-slate-200 focus:border-slate-400 focus:ring-2 focus:ring-slate-200"})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx(ps,{htmlFor:"task-status",className:"text-sm font-medium text-slate-700 mb-1 block",children:"Status"}),r.jsxs(Nl,{value:b.status,onValueChange:be=>G("status",be),className:"border-slate-200 focus:border-slate-400 focus:ring-2 focus:ring-slate-200",children:[r.jsx(wr,{value:"not-started",children:"Not Started"}),r.jsx(wr,{value:"in-progress",children:"In Progress"}),r.jsx(wr,{value:"completed",children:"Completed"}),r.jsx(wr,{value:"overdue",children:"Overdue"})]})]}),r.jsxs("div",{children:[r.jsx(ps,{htmlFor:"task-priority",className:"text-sm font-medium text-slate-700 mb-1 block",children:"Priority"}),r.jsxs(Nl,{value:b.priority,onValueChange:be=>G("priority",be),className:"border-slate-200 focus:border-slate-400 focus:ring-2 focus:ring-slate-200",children:[r.jsx(wr,{value:"low",children:"Low"}),r.jsx(wr,{value:"medium",children:"Medium"}),r.jsx(wr,{value:"high",children:"High"})]})]})]}),r.jsxs("div",{children:[r.jsx(ps,{htmlFor:"task-due-date",className:"text-sm font-medium text-slate-700 mb-1 block",children:"Due Date *"}),r.jsx(gs,{id:"task-due-date",type:"date",value:b.dueDate,onChange:be=>G("dueDate",be.target.value),className:`bg-white border-slate-200 focus:border-slate-400 focus:ring-2 focus:ring-slate-200 ${w.dueDate?"border-red-300 focus:border-red-500 focus:ring-red-200":""}`,required:!0}),w.dueDate&&r.jsx("p",{className:"text-red-600 text-sm mt-1",children:w.dueDate})]}),r.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[r.jsx(H,{type:"button",variant:"outline",onClick:q,size:"sm",children:"Cancel"}),r.jsx(H,{type:"submit",disabled:!b.title.trim()||!b.dueDate,className:"bg-slate-600 hover:bg-slate-700 text-white",size:"sm",children:"Create Task"})]})]})}),ye.length>0&&r.jsx("div",{className:"mb-4",children:r.jsx(ene,{selectedTasks:A,onSelectAll:Le,onDeselectAll:ge,onBulkStatusUpdate:Se,onBulkDelete:ce,totalTasks:ye.length,isAllSelected:A.size===ye.length,disabled:T})}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:ye.length===0?r.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[r.jsx(Gi,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),r.jsx("p",{className:"text-lg font-medium mb-2",children:"No tasks found"}),r.jsx("p",{className:"text-sm",children:"Add a new task to get started"})]}):r.jsx("div",{className:"space-y-3 mb-6",children:lt.map(be=>{const ze=xC[be.status]||xC["not-started"];ze.icon;const ee=A.has(be.id);return r.jsxs("div",{className:`flex items-center gap-3 p-4 rounded-lg transition-colors border ${ee?"bg-blue-50 border-blue-200":"border-transparent hover:border-slate-200/50 hover:bg-slate-50/50"}`,children:[r.jsx("button",{onClick:()=>ue(be.id),className:"flex items-center justify-center w-5 h-5 rounded border-2 border-slate-300 hover:border-blue-500 transition-colors",children:ee?r.jsx(Hd,{className:"w-4 h-4 text-blue-600"}):r.jsx($C,{className:"w-4 h-4 text-slate-400"})}),r.jsx(FT,{currentStatus:be.status,taskId:be.id,onStatusChange:Q,disabled:T,size:"sm",variant:"simple"}),r.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:()=>Z(be),children:[r.jsx("div",{className:"flex items-center justify-between mb-1",children:r.jsx("h4",{className:`font-medium text-sm ${be.status==="completed"?"line-through text-muted-foreground":"text-slate-800"} hover:text-blue-600 transition-colors`,children:be.title})}),r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsx("span",{className:`text-xs px-2 py-1 rounded-full border ${ze.bgColor} ${ze.color}`,children:ze.label}),be.source&&(()=>{const X=Ee(be.source),te=X.icon;return r.jsxs(an,{variant:"outline",className:`text-xs ${X.className}`,children:[te&&r.jsx(te,{className:"w-3 h-3 mr-1"}),be.source]})})(),r.jsx("span",{className:`text-xs px-2 py-1 rounded-full border ${st(be.priority)}`,children:be.priority}),r.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[r.jsx(yt,{className:"w-3 h-3"}),new Date(be.due).toLocaleDateString()]})]})]})]},be.id)})})}),Ke>1&&r.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[r.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",At+1,"-",Math.min(At+Cd,ye.length)," of ",ye.length," tasks"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(H,{variant:"outline",size:"sm",onClick:Ht,disabled:d===1,children:[r.jsx(di,{className:"w-4 h-4 mr-1"}),"Previous"]}),r.jsxs("span",{className:"text-sm text-muted-foreground px-3",children:["Page ",d," of ",Ke]}),r.jsxs(H,{variant:"outline",size:"sm",onClick:pt,disabled:d===Ke,children:["Next",r.jsx(Ta,{className:"w-4 h-4 ml-1"})]})]})]})]}),r.jsx(hne,{isOpen:S,onClose:()=>{_(!1),D(null)},onAcceptTasks:ne,generationType:C}),r.jsx(pne,{isOpen:z,onClose:oe,task:O,onTaskUpdate:W,onTaskDelete:B}),U&&r.jsx(zT,{isOpen:U.isOpen,type:U.type,title:U.title,message:U.message,onClose:se,autoClose:!0,autoCloseDelay:4e3})]})},gne=({isOpen:e,onClose:t,date:n,events:s})=>{if(!e||!n)return null;const a=c=>c.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),i=s.filter(c=>c.itemType==="task"),l=s.filter(c=>c.itemType==="event"),o=c=>{switch(c){case"completed":return{color:"bg-emerald-100 text-emerald-700 border-emerald-200",label:"Completed"};case"in-progress":return{color:"bg-indigo-100 text-indigo-700 border-indigo-200",label:"In Progress"};case"overdue":return{color:"bg-rose-100 text-rose-700 border-rose-200",label:"Overdue"};default:return{color:"bg-slate-100 text-slate-700 border-slate-200",label:"Not Started"}}};return r.jsx(ht,{children:r.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:t,children:r.jsxs(de.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-xl shadow-xl max-w-lg w-full max-h-[80vh] overflow-hidden flex flex-col",onClick:c=>c.stopPropagation(),children:[r.jsx("div",{className:"p-6 border-b border-slate-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(yt,{className:"w-5 h-5 text-indigo-600"}),r.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:a(n)})]}),r.jsx(H,{variant:"ghost",size:"sm",onClick:t,children:r.jsx(Ze,{className:"w-4 h-4"})})]})}),r.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{className:"bg-indigo-50 rounded-lg p-4 border border-indigo-100",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(Hd,{className:"w-4 h-4 text-indigo-600"}),r.jsx("span",{className:"text-sm font-medium text-indigo-900",children:"Tasks"})]}),r.jsx("div",{className:"text-2xl font-semibold text-indigo-600",children:i.length})]}),r.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 border border-purple-100",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx(yt,{className:"w-4 h-4 text-purple-600"}),r.jsx("span",{className:"text-sm font-medium text-purple-900",children:"Events"})]}),r.jsx("div",{className:"text-2xl font-semibold text-purple-600",children:l.length})]})]}),i.length>0&&r.jsxs("div",{children:[r.jsxs("h4",{className:"font-medium text-slate-800 mb-3 flex items-center gap-2",children:[r.jsx(Hd,{className:"w-4 h-4"}),"Tasks (",i.length,")"]}),r.jsx("div",{className:"space-y-3",children:i.map((c,d)=>{var m,p;const u=o(c.status);return r.jsxs("div",{className:"bg-slate-50 rounded-lg p-3 border border-slate-200",children:[r.jsxs("div",{className:"flex items-start justify-between mb-2",children:[r.jsx("h5",{className:"font-medium text-slate-800",children:c.title}),r.jsxs("div",{className:"flex items-center gap-2",children:[c.priority&&r.jsx(an,{className:`text-xs ${c.priority==="high"||c.priority==="urgent"?"bg-red-100 text-red-700 border-red-200":c.priority==="medium"?"bg-yellow-100 text-yellow-700 border-yellow-200":"bg-green-100 text-green-700 border-green-200"}`,children:c.priority}),r.jsx(an,{className:u.color,children:u.label})]})]}),((m=c.data)==null?void 0:m.description)&&r.jsx("p",{className:"text-sm text-slate-600 mb-2",children:c.data.description}),((p=c.data)==null?void 0:p.source)&&r.jsx("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:r.jsxs("span",{children:["Source: ",c.data.source]})})]},d)})})]}),l.length>0&&r.jsxs("div",{children:[r.jsxs("h4",{className:"font-medium text-slate-800 mb-3 flex items-center gap-2",children:[r.jsx(yt,{className:"w-4 h-4"}),"Events (",l.length,")"]}),r.jsx("div",{className:"space-y-3",children:l.map((c,d)=>{var u;return r.jsxs("div",{className:"bg-indigo-50/50 rounded-lg p-3 border border-indigo-100",children:[r.jsxs("div",{className:"flex items-start justify-between mb-2",children:[r.jsx("h5",{className:"font-medium text-slate-800",children:c.title}),r.jsx(an,{className:"bg-indigo-100 text-indigo-700",children:"Event"})]}),((u=c.data)==null?void 0:u.start)&&r.jsxs("div",{className:"flex items-center gap-1 text-sm text-slate-600",children:[r.jsx(jt,{className:"w-3 h-3"}),r.jsx("span",{children:new Date(c.data.start).toLocaleTimeString()})]})]},d)})})]}),s.length===0&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-slate-100 rounded-full flex items-center justify-center",children:r.jsx(yt,{className:"w-8 h-8 text-slate-400"})}),r.jsx("h4",{className:"font-medium text-slate-800 mb-2",children:"No events scheduled"}),r.jsx("p",{className:"text-sm text-slate-500",children:"This day is free for new tasks or meetings"})]})]})]})})})},vf=e=>e.toISOString().slice(0,10),yC=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),xne=e=>new Date(e.getFullYear(),e.getMonth(),e.getDate()),yne=xne(new Date),bne=e=>{const t=new Date(e.getFullYear(),e.getMonth(),1),n=new Date(t);n.setDate(t.getDate()-t.getDay());const s=[];for(let a=0;a<6;a++){const i=[];for(let l=0;l<7;l++){const o=new Date(n);o.setDate(n.getDate()+a*7+l),i.push(o)}s.push(i)}return s},vne=()=>{const{idToken:e,isAuthenticated:t}=Qr(),[n,s]=h.useState([]),[a,i]=h.useState([]),[l,o]=h.useState([]),[c,d]=h.useState(!0),[u,m]=h.useState(null),[p,f]=h.useState(new Date),[y,g]=h.useState(null),[x,b]=h.useState(!1),[v,w]=h.useState(null),[N,k]=h.useState([]),j=h.useMemo(()=>bne(p),[p]),S=p.getMonth(),_=h.useMemo(()=>{const T=new Map;for(const M of n){const L=new Date(M.start).toISOString().slice(0,10),P=T.get(L)??[];P.push({id:`event-${M.id}`,title:M.title,date:L,type:"event",itemType:"event",data:M}),T.set(L,P)}for(const M of a)if(M.due){const L=new Date(M.due).toISOString().slice(0,10),P=T.get(L)??[];P.push({id:`task-${M.id}`,title:M.title,date:L,type:"task",itemType:"task",status:M.status,priority:M.priority,isOverdue:M.isOverdue,data:M}),T.set(L,P)}return T},[n,a]);h.useEffect(()=>{D()},[]);const C=async()=>{if(!(!t||!e))try{const T=await fetch("http://localhost:8004/api/tasks",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(T.ok){const L=(await T.json()).map(P=>({id:P.task_id,title:P.title,description:P.description,status:P.status,priority:P.priority,source:P.source,due:P.due_date,type:"dashboard",createdAt:P.created_at,isOverdue:P.is_overdue,daysUntilDue:P.days_until_due}));i(L)}}catch(T){console.error("Error loading tasks:",T)}},D=async()=>{d(!0),m(null);try{const[T,M]=await Promise.all([Fre(7),LT(),C()]);if(T.success&&o(T.events),M.success&&s(M.events),!T.success&&!M.success)throw new Error("Failed to load calendar data")}catch(T){console.error("Error loading calendar data:",T),m(T.message)}finally{d(!1)}},A=T=>{f(M=>{const L=new Date(M);return L.setMonth(L.getMonth()+T),L})},E=T=>{g(T);const M=_.get(vf(T))||[];M.length>0&&(w(T),k(M),b(!0))};return c?r.jsx(de.div,{className:"font-sans",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.35},children:r.jsx(We,{className:"h-[500px] flex flex-col bg-white",children:r.jsx(it,{className:"p-6",children:r.jsxs("div",{className:"flex items-center justify-center py-8",children:[r.jsx(Be,{className:"w-6 h-6 text-gray-400 animate-spin mr-2"}),r.jsx("span",{className:"text-gray-500",children:"Loading calendar..."})]})})})}):u?r.jsx(de.div,{className:"font-sans",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.35},children:r.jsx(We,{className:"h-[500px] flex flex-col bg-white",children:r.jsx(it,{className:"p-6",children:r.jsxs("div",{className:"text-center py-8",children:[r.jsx(dt,{className:"w-8 h-8 text-red-400 mx-auto mb-2"}),r.jsx("p",{className:"text-red-600 mb-4",children:"Failed to load calendar"}),r.jsx("button",{onClick:D,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Try Again"})]})})})}):r.jsxs(de.div,{className:"font-sans",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.35},children:[r.jsxs(We,{className:"h-[450px] flex flex-col bg-white",children:[r.jsxs(ir,{className:"pb-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx(cr,{className:"text-base font-semibold",children:"Calendar"}),r.jsx("div",{className:"flex items-center gap-2"})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"text-lg font-semibold",children:[p.toLocaleString("en-US",{month:"long"})," ",p.getFullYear()]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>A(-1),className:"w-8 h-8 p-0 hover:bg-slate-100",children:r.jsx(di,{className:"h-4 w-4"})}),r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>A(1),className:"w-8 h-8 p-0 hover:bg-slate-100",children:r.jsx(Ta,{className:"h-4 w-4"})})]})]})]}),r.jsxs(it,{className:"px-6 pb-6 flex-1 flex flex-col overflow-hidden",children:[r.jsx("div",{className:"grid grid-cols-7 gap-x-1 mb-2",children:["SUN","MON","TUE","WED","THU","FRI","SAT"].map(T=>r.jsx("div",{className:"text-center text-xs font-medium text-slate-500 p-2",children:T},T))}),r.jsx("div",{className:"space-y-1",children:j.map((T,M)=>r.jsx("div",{className:"grid grid-cols-7 gap-x-1",children:T.map((L,P)=>{const $=L?vf(L):`empty-${M}-${P}`,R=L?_.get(vf(L))||[]:[],U=L?L.getMonth()!==S:!0,I=L?yC(L,yne):!1,z=L&&y?yC(L,y):!1,F=R.length>0;return r.jsx("div",{className:"h-9 flex items-center justify-center relative",children:L&&r.jsxs(de.button,{onClick:()=>E(L),className:["w-9 h-9 rounded-lg flex items-center justify-center text-sm font-medium transition-colors relative border",z?"bg-slate-600 text-white hover:bg-slate-700 border-slate-600":"border-transparent",I&&!z?"bg-indigo-50 border-indigo-200 text-indigo-700":"",U?"text-slate-300 opacity-40 hover:opacity-60":"text-slate-700 hover:bg-slate-100 hover:border-slate-200"].join(" "),whileHover:{scale:1.05},children:[L.getDate(),F&&r.jsx("div",{className:"absolute -bottom-1 left-1/2 transform -translate-x-1/2 flex gap-0.5",children:R.slice(0,3).map((O,K)=>{let J="bg-gray-500";return O.itemType==="task"?O.isOverdue?J="bg-red-500":O.status==="completed"?J="bg-green-500":O.status==="in-progress"?J="bg-blue-500":J="bg-yellow-500":J="bg-indigo-500",r.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${z?"bg-white":J}`},K)})})]})},$)})},M))})]})]}),r.jsx(gne,{isOpen:x,onClose:()=>b(!1),date:v,events:N})]})},wne=()=>{const[e,t]=h.useState(null),[n,s]=h.useState(!0),[a,i]=h.useState(null),{idToken:l,isAuthenticated:o}=Qr();h.useEffect(()=>{o&&l&&c()},[o,l]);const c=async()=>{if(s(!0),i(null),!o||!l){i("Please log in to view task statistics"),s(!1);return}try{let u="http://localhost:8004/api/tasks/summary",m={"Content-Type":"application/json",Authorization:`Bearer ${l}`},p=await fetch(u,{headers:m});if(!p.ok&&p.status===403&&(console.log("Authentication failed, trying public endpoint..."),u="http://localhost:8004/api/tasks/summary/public",m={"Content-Type":"application/json"},p=await fetch(u,{headers:m})),!p.ok){const g=await p.json().catch(()=>({}));console.error("API Error Response:",p.status,g);let x="Failed to load task statistics";throw g.detail&&(Array.isArray(g.detail)?x+=": "+g.detail.map(b=>{var v;return`${(v=b.loc)==null?void 0:v.join(".")} - ${b.msg}`}).join(", "):x+=": "+g.detail),new Error(x)}const f=await p.json();console.log("Task summary response:",f);const y={completed:f.completed||0,pending:f.not_started||0,inProgress:f.in_progress||0,overdue:f.overdue||0};t(y)}catch(u){console.error("Error loading task stats:",u),i(u.message)}finally{s(!1)}},d=[{title:"Completed Tasks",value:(e==null?void 0:e.completed)||0,icon:na,color:"text-emerald-600",bgColor:"bg-emerald-50",borderColor:"border-emerald-200"},{title:"Not Started",value:(e==null?void 0:e.pending)||0,icon:jt,color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200"},{title:"In Progress",value:(e==null?void 0:e.inProgress)||0,icon:Be,color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200"},{title:"Overdue",value:(e==null?void 0:e.overdue)||0,icon:dt,color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200"}];return n&&!e?r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(u=>r.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4 animate-pulse",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"}),r.jsx("div",{className:"h-4 w-6 bg-gray-200 rounded"})]}),r.jsx("div",{className:"h-8 bg-gray-200 rounded w-16 mb-2"}),r.jsx("div",{className:"h-3 bg-gray-200 rounded w-12"})]},u))}):a?r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:r.jsxs("div",{className:"col-span-full bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:[r.jsx(dt,{className:"w-8 h-8 text-red-400 mx-auto mb-2"}),r.jsx("p",{className:"text-red-600 text-sm",children:"Failed to load task statistics"}),r.jsx("button",{onClick:c,className:"mt-2 px-3 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700 transition-colors",children:"Try Again"})]})}):r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:d.map((u,m)=>(u.icon,r.jsxs(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:m*.1},className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4 hover:shadow-md transition-shadow",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h4",{className:"text-sm font-medium text-slate-600",children:u.title}),r.jsx("div",{className:"w-6 h-4 bg-white rounded flex items-center justify-center transition-colors",children:r.jsx(rx,{className:"w-3 h-3 text-slate-600"})})]}),r.jsx("div",{className:"flex items-baseline gap-2",children:r.jsx("span",{className:"text-3xl font-bold text-slate-900",children:u.value})})]},u.title)))})},jne=()=>r.jsx(de.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.35},children:r.jsxs(We,{className:"h-[300px] flex flex-col bg-white",children:[r.jsx(ir,{className:"pb-4",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs(cr,{className:"text-base font-semibold flex items-center gap-2",children:[r.jsx(kt,{className:"w-4 h-4 text-slate-600"}),"Upcoming Meetings"]}),r.jsxs(H,{variant:"ghost",size:"sm",className:"text-slate-600 hover:text-slate-700 hover:bg-slate-50 text-sm",disabled:!0,children:[r.jsx(sa,{className:"w-4 h-4 mr-1"}),"View All"]})]})}),r.jsx(it,{className:"flex-1 flex flex-col items-center justify-center px-6 pb-6",children:r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"w-12 h-12 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(yt,{className:"w-6 h-6 text-slate-400"})}),r.jsx("h3",{className:"text-lg font-medium text-slate-800 mb-2",children:"No upcoming meetings"})]})})]})}),bC=()=>{const{user:e}=Qr(),[t,n]=le.useState(0),s=le.useCallback(()=>{n(i=>i+1)},[]),a=()=>e!=null&&e.name?e.name.split(" ")[0]:"User";return r.jsxs("div",{className:"h-full flex flex-col",children:[r.jsx(de.header,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.4,ease:"easeOut"},className:"px-6 py-4 bg-white",role:"banner",children:r.jsx("div",{className:"flex items-center justify-between gap-6",children:r.jsxs("div",{className:"min-w-0 flex-1",children:[r.jsxs(de.h1,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.2,duration:.3},className:"text-2xl font-bold text-gray-900",children:["Welcome ",a(),"!"]}),r.jsx(de.p,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.3,duration:.3},className:"text-sm text-gray-500 mt-1",children:"Here's what's happening with your work today."})]})})}),r.jsxs(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex-1 py-4 px-5 space-y-4 bg-gray-50 overflow-auto",children:[r.jsx(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.2},className:"",children:r.jsx(wne,{})}),r.jsxs(de.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"grid grid-cols-1 lg:grid-cols-10 gap-4",children:[r.jsx(de.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.6},className:"lg:col-span-7 space-y-8",children:r.jsx(fne,{onTasksUpdated:s})}),r.jsxs(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.7},className:"lg:col-span-3 space-y-4",children:[r.jsx(vne,{refreshTrigger:t}),r.jsx(jne,{})]})]}),r.jsx(de.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.5,delay:.9},className:"mt-8",children:r.jsx(Lre,{})}),r.jsx("div",{className:"h-8"})]})]})},Nne=({currentView:e,wsConnection:t,className:n=""})=>{const{hasPermission:s,userRole:a,isAuthenticated:i,isLoading:l}=qd(),o=()=>{if(l||i===null)return null;if(!i)return r.jsx("div",{className:"flex items-center justify-center h-full",children:r.jsxs("div",{className:"text-center",children:[r.jsx("h2",{className:"text-2xl font-semibold text-gray-600 mb-2",children:"Access Denied"}),r.jsx("p",{className:"text-gray-500",children:"Please log in to access this content."})]})});if(!s(e))return r.jsx("div",{className:"flex items-center justify-center h-full",children:r.jsxs("div",{className:"text-center",children:[r.jsx("h2",{className:"text-2xl font-semibold text-gray-600 mb-2",children:"Access Restricted"}),r.jsxs("p",{className:"text-gray-500 mb-1",children:[`You don't have permission to access the "`,e,'" section.']}),r.jsxs("p",{className:"text-sm text-gray-400",children:["Current role: ",r.jsx("span",{className:"font-medium",children:a})]})]})});switch(e){case"dashboard":return r.jsx(bC,{wsConnection:t});case"calendar":return r.jsx(a3,{});case"leads":return r.jsx(D3,{wsConnection:t},"leads");case"employees":return r.jsx(c6,{wsConnection:t});case"crm":return r.jsx(yre,{wsConnection:t});case"deals":return r.jsx(Cre,{wsConnection:t});case"sales-center":return r.jsx(nre,{wsConnection:t});case"usage-analytics":return r.jsx(Sre,{wsConnection:t});case"user-onboarding":return r.jsx(_A,{wsConnection:t});default:return r.jsx(bC,{wsConnection:t})}};return r.jsx("div",{className:`h-full main-content overflow-hidden ${n}`,children:o()})},UT=le.memo(({currentView:e,isTabLoading:t,targetView:n,isContentReady:s,onLoadingComplete:a,isWsConnected:i,isInitialLoading:l=!1,onInitialLoadComplete:o=null,loadingEnabled:c=!0})=>r.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden main-content transition-all duration-200 ease-in-out bg-white relative",children:[c&&r.jsx(VI,{isLoading:l||t,targetView:l?"dashboard":n,isContentReady:s,onComplete:l?o:a}),(!l||!c)&&r.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden",children:r.jsx("div",{className:"min-h-full",children:r.jsx(Nne,{currentView:e,wsConnection:{isConnected:i,onRetry:()=>window.location.reload()}})})})]}));UT.displayName="MainContentArea";const Cne=()=>{const{currentSessionId:e,sessionStatus:t,isRunning:n,isCompleted:s,isFailed:a,isCancelled:i,progress:l,companiesFound:o,personnelFound:c,leadsCreated:d,cancelWorkflow:u,resetWorkflow:m}=bA();if(!e||!t)return null;const p={pending:{icon:jt,color:"bg-gray-500",textColor:"text-gray-600",bgColor:"bg-gray-50",borderColor:"border-gray-200",label:"Pending"},running:{icon:Ct,color:"bg-blue-500",textColor:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",label:"Running",animate:!0},completed:{icon:bt,color:"bg-green-500",textColor:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",label:"Completed"},failed:{icon:Ql,color:"bg-red-500",textColor:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200",label:"Failed"},cancelled:{icon:dt,color:"bg-yellow-500",textColor:"text-yellow-600",bgColor:"bg-yellow-50",borderColor:"border-yellow-200",label:"Cancelled"}},f=p[t.status]||p.pending,y=f.icon;return r.jsx(ht,{children:r.jsx(de.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:`fixed top-16 right-4 z-40 ${f.bgColor} ${f.borderColor} border rounded-lg shadow-lg max-w-sm`,children:r.jsxs("div",{className:"p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:`p-1 rounded-full ${f.color}`,children:r.jsx(y,{className:`w-4 h-4 text-white ${f.animate?"animate-spin":""}`})}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:"Lead Workflow"}),r.jsx("p",{className:`text-xs ${f.textColor}`,children:f.label})]})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(H,{variant:"ghost",size:"sm",onClick:()=>{window.dispatchEvent(new CustomEvent("navigate-to-leads"))},className:"p-1 h-auto",title:"View in Leads section",children:r.jsx(bs,{className:"w-3 h-3"})}),r.jsx(H,{variant:"ghost",size:"sm",onClick:m,className:"p-1 h-auto",title:"Close",children:r.jsx(Ze,{className:"w-3 h-3"})})]})]}),n&&r.jsxs("div",{className:"mb-3",children:[r.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 mb-1",children:[r.jsx("span",{children:"Progress"}),r.jsxs("span",{children:[l,"%"]})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:r.jsx(de.div,{className:"bg-blue-500 h-1.5 rounded-full",initial:{width:0},animate:{width:`${Math.min(l,100)}%`},transition:{duration:.5}})})]}),r.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"font-medium text-gray-900",children:o}),r.jsx("div",{className:"text-gray-500",children:"Companies"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"font-medium text-gray-900",children:c}),r.jsx("div",{className:"text-gray-500",children:"Personnel"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"font-medium text-gray-900",children:d}),r.jsx("div",{className:"text-gray-500",children:"Leads"})]})]}),n&&r.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:r.jsx(H,{variant:"outline",size:"sm",onClick:u,className:"w-full text-xs h-7",children:"Cancel Workflow"})}),(s||a||i)&&r.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:r.jsx(H,{variant:"outline",size:"sm",onClick:m,className:"w-full text-xs h-7",children:"Clear Status"})})]})})})},ca=Object.create(null);ca.open="0";ca.close="1";ca.ping="2";ca.pong="3";ca.message="4";ca.upgrade="5";ca.noop="6";const Fd=Object.create(null);Object.keys(ca).forEach(e=>{Fd[ca[e]]=e});const Kg={type:"error",data:"parser error"},qT=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",HT=typeof ArrayBuffer=="function",WT=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,qy=({type:e,data:t},n,s)=>qT&&t instanceof Blob?n?s(t):vC(t,s):HT&&(t instanceof ArrayBuffer||WT(t))?n?s(t):vC(new Blob([t]),s):s(ca[e]+(t||"")),vC=(e,t)=>{const n=new FileReader;return n.onload=function(){const s=n.result.split(",")[1];t("b"+(s||""))},n.readAsDataURL(e)};function wC(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let wf;function kne(e,t){if(qT&&e.data instanceof Blob)return e.data.arrayBuffer().then(wC).then(t);if(HT&&(e.data instanceof ArrayBuffer||WT(e.data)))return t(wC(e.data));qy(e,!1,n=>{wf||(wf=new TextEncoder),t(wf.encode(n))})}const jC="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",qo=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<jC.length;e++)qo[jC.charCodeAt(e)]=e;const Sne=e=>{let t=e.length*.75,n=e.length,s,a=0,i,l,o,c;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const d=new ArrayBuffer(t),u=new Uint8Array(d);for(s=0;s<n;s+=4)i=qo[e.charCodeAt(s)],l=qo[e.charCodeAt(s+1)],o=qo[e.charCodeAt(s+2)],c=qo[e.charCodeAt(s+3)],u[a++]=i<<2|l>>4,u[a++]=(l&15)<<4|o>>2,u[a++]=(o&3)<<6|c&63;return d},_ne=typeof ArrayBuffer=="function",Hy=(e,t)=>{if(typeof e!="string")return{type:"message",data:YT(e,t)};const n=e.charAt(0);return n==="b"?{type:"message",data:Ene(e.substring(1),t)}:Fd[n]?e.length>1?{type:Fd[n],data:e.substring(1)}:{type:Fd[n]}:Kg},Ene=(e,t)=>{if(_ne){const n=Sne(e);return YT(n,t)}else return{base64:!0,data:e}},YT=(e,t)=>{switch(t){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}},VT="",Dne=(e,t)=>{const n=e.length,s=new Array(n);let a=0;e.forEach((i,l)=>{qy(i,!1,o=>{s[l]=o,++a===n&&t(s.join(VT))})})},Tne=(e,t)=>{const n=e.split(VT),s=[];for(let a=0;a<n.length;a++){const i=Hy(n[a],t);if(s.push(i),i.type==="error")break}return s};function Ane(){return new TransformStream({transform(e,t){kne(e,n=>{const s=n.length;let a;if(s<126)a=new Uint8Array(1),new DataView(a.buffer).setUint8(0,s);else if(s<65536){a=new Uint8Array(3);const i=new DataView(a.buffer);i.setUint8(0,126),i.setUint16(1,s)}else{a=new Uint8Array(9);const i=new DataView(a.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(s))}e.data&&typeof e.data!="string"&&(a[0]|=128),t.enqueue(a),t.enqueue(n)})}})}let jf;function kd(e){return e.reduce((t,n)=>t+n.length,0)}function Sd(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let s=0;for(let a=0;a<t;a++)n[a]=e[0][s++],s===e[0].length&&(e.shift(),s=0);return e.length&&s<e[0].length&&(e[0]=e[0].slice(s)),n}function Pne(e,t){jf||(jf=new TextDecoder);const n=[];let s=0,a=-1,i=!1;return new TransformStream({transform(l,o){for(n.push(l);;){if(s===0){if(kd(n)<1)break;const c=Sd(n,1);i=(c[0]&128)===128,a=c[0]&127,a<126?s=3:a===126?s=1:s=2}else if(s===1){if(kd(n)<2)break;const c=Sd(n,2);a=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),s=3}else if(s===2){if(kd(n)<8)break;const c=Sd(n,8),d=new DataView(c.buffer,c.byteOffset,c.length),u=d.getUint32(0);if(u>Math.pow(2,21)-1){o.enqueue(Kg);break}a=u*Math.pow(2,32)+d.getUint32(4),s=3}else{if(kd(n)<a)break;const c=Sd(n,a);o.enqueue(Hy(i?c:jf.decode(c),t)),s=0}if(a===0||a>e){o.enqueue(Kg);break}}}})}const GT=4;function Hr(e){if(e)return One(e)}function One(e){for(var t in Hr.prototype)e[t]=Hr.prototype[t];return e}Hr.prototype.on=Hr.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};Hr.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this};Hr.prototype.off=Hr.prototype.removeListener=Hr.prototype.removeAllListeners=Hr.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var s,a=0;a<n.length;a++)if(s=n[a],s===t||s.fn===t){n.splice(a,1);break}return n.length===0&&delete this._callbacks["$"+e],this};Hr.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],s=1;s<arguments.length;s++)t[s-1]=arguments[s];if(n){n=n.slice(0);for(var s=0,a=n.length;s<a;++s)n[s].apply(this,t)}return this};Hr.prototype.emitReserved=Hr.prototype.emit;Hr.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};Hr.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Km=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0),hs=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Mne="arraybuffer";function KT(e,...t){return t.reduce((n,s)=>(e.hasOwnProperty(s)&&(n[s]=e[s]),n),{})}const Ine=hs.setTimeout,Lne=hs.clearTimeout;function Xm(e,t){t.useNativeTimers?(e.setTimeoutFn=Ine.bind(hs),e.clearTimeoutFn=Lne.bind(hs)):(e.setTimeoutFn=hs.setTimeout.bind(hs),e.clearTimeoutFn=hs.clearTimeout.bind(hs))}const Rne=1.33;function $ne(e){return typeof e=="string"?Fne(e):Math.ceil((e.byteLength||e.size)*Rne)}function Fne(e){let t=0,n=0;for(let s=0,a=e.length;s<a;s++)t=e.charCodeAt(s),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(s++,n+=4);return n}function XT(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function zne(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function Bne(e){let t={},n=e.split("&");for(let s=0,a=n.length;s<a;s++){let i=n[s].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}class Une extends Error{constructor(t,n,s){super(t),this.description=n,this.context=s,this.type="TransportError"}}class Wy extends Hr{constructor(t){super(),this.writable=!1,Xm(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,n,s){return super.emitReserved("error",new Une(t,n,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=Hy(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,n={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const n=zne(t);return n.length?"?"+n:""}}class qne extends Wy{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||n()})),this.writable||(s++,this.once("drain",function(){--s||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};Tne(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,Dne(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=XT()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(t,n)}}let JT=!1;try{JT=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Hne=JT;function Wne(){}class Yne extends qne{constructor(t){if(super(t),typeof location<"u"){const n=location.protocol==="https:";let s=location.port;s||(s=n?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||s!==t.port}}doWrite(t,n){const s=this.request({method:"POST",data:t});s.on("success",n),s.on("error",(a,i)=>{this.onError("xhr post error",a,i)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,s)=>{this.onError("xhr poll error",n,s)}),this.pollXhr=t}}class ta extends Hr{constructor(t,n,s){super(),this.createRequest=t,Xm(this,s),this._opts=s,this._method=s.method||"GET",this._uri=n,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var t;const n=KT(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(n);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let a in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(a)&&s.setRequestHeader(a,this._opts.extraHeaders[a])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var a;s.readyState===3&&((a=this._opts.cookieJar)===null||a===void 0||a.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(a){this.setTimeoutFn(()=>{this._onError(a)},0);return}typeof document<"u"&&(this._index=ta.requestsCount++,ta.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Wne,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete ta.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}ta.requestsCount=0;ta.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",NC);else if(typeof addEventListener=="function"){const e="onpagehide"in hs?"pagehide":"unload";addEventListener(e,NC,!1)}}function NC(){for(let e in ta.requests)ta.requests.hasOwnProperty(e)&&ta.requests[e].abort()}const Vne=function(){const e=QT({xdomain:!1});return e&&e.responseType!==null}();class Gne extends Yne{constructor(t){super(t);const n=t&&t.forceBase64;this.supportsBinary=Vne&&!n}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new ta(QT,this.uri(),t)}}function QT(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||Hne))return new XMLHttpRequest}catch{}if(!t)try{return new hs[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const ZT=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Kne extends Wy{get name(){return"websocket"}doOpen(){const t=this.uri(),n=this.opts.protocols,s=ZT?{}:KT(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,n,s)}catch(a){return this.emitReserved("error",a)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const s=t[n],a=n===t.length-1;qy(s,this.supportsBinary,i=>{try{this.doWrite(s,i)}catch{}a&&Km(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=XT()),this.supportsBinary||(n.b64=1),this.createUri(t,n)}}const Nf=hs.WebSocket||hs.MozWebSocket;class Xne extends Kne{createSocket(t,n,s){return ZT?new Nf(t,n,s):n?new Nf(t,n):new Nf(t)}doWrite(t,n){this.ws.send(n)}}class Jne extends Wy{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const n=Pne(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=t.readable.pipeThrough(n).getReader(),a=Ane();a.readable.pipeTo(t.writable),this._writer=a.writable.getWriter();const i=()=>{s.read().then(({done:o,value:c})=>{o||(this.onPacket(c),i())}).catch(o=>{})};i();const l={type:"open"};this.query.sid&&(l.data=`{"sid":"${this.query.sid}"}`),this._writer.write(l).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const s=t[n],a=n===t.length-1;this._writer.write(s).then(()=>{a&&Km(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const Qne={websocket:Xne,webtransport:Jne,polling:Gne},Zne=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ese=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Xg(e){if(e.length>8e3)throw"URI too long";const t=e,n=e.indexOf("["),s=e.indexOf("]");n!=-1&&s!=-1&&(e=e.substring(0,n)+e.substring(n,s).replace(/:/g,";")+e.substring(s,e.length));let a=Zne.exec(e||""),i={},l=14;for(;l--;)i[ese[l]]=a[l]||"";return n!=-1&&s!=-1&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=tse(i,i.path),i.queryKey=rse(i,i.query),i}function tse(e,t){const n=/\/{2,9}/g,s=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&s.splice(0,1),t.slice(-1)=="/"&&s.splice(s.length-1,1),s}function rse(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,a,i){a&&(n[a]=i)}),n}const Jg=typeof addEventListener=="function"&&typeof removeEventListener=="function",zd=[];Jg&&addEventListener("offline",()=>{zd.forEach(e=>e())},!1);class ci extends Hr{constructor(t,n){if(super(),this.binaryType=Mne,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(n=t,t=null),t){const s=Xg(t);n.hostname=s.host,n.secure=s.protocol==="https"||s.protocol==="wss",n.port=s.port,s.query&&(n.query=s.query)}else n.host&&(n.hostname=Xg(n.host).host);Xm(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(s=>{const a=s.prototype.name;this.transports.push(a),this._transportsByName[a]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Bne(this.opts.query)),Jg&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},zd.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=GT,n.transport=t,this.id&&(n.sid=this.id);const s=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&ci.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(t);n.open(),this.setTransport(n)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",ci.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=t.data,this._onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let s=0;s<this.writeBuffer.length;s++){const a=this.writeBuffer[s].data;if(a&&(n+=$ne(a)),s>0&&n>this._maxPayload)return this.writeBuffer.slice(0,s);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,Km(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,n,s){return this._sendPacket("message",t,n,s),this}send(t,n,s){return this._sendPacket("message",t,n,s),this}_sendPacket(t,n,s,a){if(typeof n=="function"&&(a=n,n=void 0),typeof s=="function"&&(a=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const i={type:t,data:n,options:s};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),a&&this.once("flush",a),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},s=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():t()}):this.upgrading?s():t()),this}_onError(t){if(ci.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Jg&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=zd.indexOf(this._offlineEventListener);s!==-1&&zd.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this._prevBufferLen=0}}}ci.protocol=GT;class nse extends ci{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let n=this.createTransport(t),s=!1;ci.priorWebsocketSuccess=!1;const a=()=>{s||(n.send([{type:"ping",data:"probe"}]),n.once("packet",m=>{if(!s)if(m.type==="pong"&&m.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;ci.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(u(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=n.name,this.emitReserved("upgradeError",p)}}))};function i(){s||(s=!0,u(),n.close(),n=null)}const l=m=>{const p=new Error("probe error: "+m);p.transport=n.name,i(),this.emitReserved("upgradeError",p)};function o(){l("transport closed")}function c(){l("socket closed")}function d(m){n&&m.name!==n.name&&i()}const u=()=>{n.removeListener("open",a),n.removeListener("error",l),n.removeListener("close",o),this.off("close",c),this.off("upgrading",d)};n.once("open",a),n.once("error",l),n.once("close",o),this.once("close",c),this.once("upgrading",d),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{s||n.open()},200):n.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const n=[];for(let s=0;s<t.length;s++)~this.transports.indexOf(t[s])&&n.push(t[s]);return n}}let sse=class extends nse{constructor(t,n={}){const s=typeof t=="object"?t:n;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(a=>Qne[a]).filter(a=>!!a)),super(t,s)}};function ase(e,t="",n){let s=e;n=n||typeof location<"u"&&location,e==null&&(e=n.protocol+"//"+n.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=n.protocol+e:e=n.host+e),/^(https?|wss?):\/\//.test(e)||(typeof n<"u"?e=n.protocol+"//"+e:e="https://"+e),s=Xg(e)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const i=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+i+":"+s.port+t,s.href=s.protocol+"://"+i+(n&&n.port===s.port?"":":"+s.port),s}const ise=typeof ArrayBuffer=="function",lse=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,eA=Object.prototype.toString,ose=typeof Blob=="function"||typeof Blob<"u"&&eA.call(Blob)==="[object BlobConstructor]",cse=typeof File=="function"||typeof File<"u"&&eA.call(File)==="[object FileConstructor]";function Yy(e){return ise&&(e instanceof ArrayBuffer||lse(e))||ose&&e instanceof Blob||cse&&e instanceof File}function Bd(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let n=0,s=e.length;n<s;n++)if(Bd(e[n]))return!0;return!1}if(Yy(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return Bd(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&Bd(e[n]))return!0;return!1}function dse(e){const t=[],n=e.data,s=e;return s.data=Qg(n,t),s.attachments=t.length,{packet:s,buffers:t}}function Qg(e,t){if(!e)return e;if(Yy(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){const n=new Array(e.length);for(let s=0;s<e.length;s++)n[s]=Qg(e[s],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){const n={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=Qg(e[s],t));return n}return e}function use(e,t){return e.data=Zg(e.data,t),delete e.attachments,e}function Zg(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=Zg(e[n],t);else if(typeof e=="object")for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=Zg(e[n],t));return e}const mse=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],hse=5;var Bt;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(Bt||(Bt={}));class pse{constructor(t){this.replacer=t}encode(t){return(t.type===Bt.EVENT||t.type===Bt.ACK)&&Bd(t)?this.encodeAsBinary({type:t.type===Bt.EVENT?Bt.BINARY_EVENT:Bt.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===Bt.BINARY_EVENT||t.type===Bt.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=dse(t),s=this.encodeAsString(n.packet),a=n.buffers;return a.unshift(s),a}}function CC(e){return Object.prototype.toString.call(e)==="[object Object]"}class Vy extends Hr{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t);const s=n.type===Bt.BINARY_EVENT;s||n.type===Bt.BINARY_ACK?(n.type=s?Bt.EVENT:Bt.ACK,this.reconstructor=new fse(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(Yy(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const s={type:Number(t.charAt(0))};if(Bt[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===Bt.BINARY_EVENT||s.type===Bt.BINARY_ACK){const i=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const l=t.substring(i,n);if(l!=Number(l)||t.charAt(n)!=="-")throw new Error("Illegal attachments");s.attachments=Number(l)}if(t.charAt(n+1)==="/"){const i=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););s.nsp=t.substring(i,n)}else s.nsp="/";const a=t.charAt(n+1);if(a!==""&&Number(a)==a){const i=n+1;for(;++n;){const l=t.charAt(n);if(l==null||Number(l)!=l){--n;break}if(n===t.length)break}s.id=Number(t.substring(i,n+1))}if(t.charAt(++n)){const i=this.tryParse(t.substr(n));if(Vy.isPayloadValid(s.type,i))s.data=i;else throw new Error("invalid payload")}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case Bt.CONNECT:return CC(n);case Bt.DISCONNECT:return n===void 0;case Bt.CONNECT_ERROR:return typeof n=="string"||CC(n);case Bt.EVENT:case Bt.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&mse.indexOf(n[0])===-1);case Bt.ACK:case Bt.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class fse{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=use(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const gse=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Vy,Encoder:pse,get PacketType(){return Bt},protocol:hse},Symbol.toStringTag,{value:"Module"}));function Ps(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const xse=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class tA extends Hr{constructor(t,n,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[Ps(t,"open",this.onopen.bind(this)),Ps(t,"packet",this.onpacket.bind(this)),Ps(t,"error",this.onerror.bind(this)),Ps(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){var s,a,i;if(xse.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const l={type:Bt.EVENT,data:n};if(l.options={},l.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const u=this.ids++,m=n.pop();this._registerAckCallback(u,m),l.id=u}const o=(a=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||a===void 0?void 0:a.writable,c=this.connected&&!(!((i=this.io.engine)===null||i===void 0)&&i._hasPingExpired());return this.flags.volatile&&!o||(c?(this.notifyOutgoingListeners(l),this.packet(l)):this.sendBuffer.push(l)),this.flags={},this}_registerAckCallback(t,n){var s;const a=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(a===void 0){this.acks[t]=n;return}const i=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===t&&this.sendBuffer.splice(o,1);n.call(this,new Error("operation has timed out"))},a),l=(...o)=>{this.io.clearTimeoutFn(i),n.apply(this,o)};l.withError=!0,this.acks[t]=l}emitWithAck(t,...n){return new Promise((s,a)=>{const i=(l,o)=>l?a(l):s(o);i.withError=!0,n.push(i),this.emit(t,...n)})}_addToQueue(t){let n;typeof t[t.length-1]=="function"&&(n=t.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((a,...i)=>s!==this._queue[0]?void 0:(a!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(a)):(this._queue.shift(),n&&n(null,...i)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!t||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:Bt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(s=>String(s.id)===t)){const s=this.acks[t];delete this.acks[t],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case Bt.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Bt.EVENT:case Bt.BINARY_EVENT:this.onevent(t);break;case Bt.ACK:case Bt.BINARY_ACK:this.onack(t);break;case Bt.DISCONNECT:this.ondisconnect();break;case Bt.CONNECT_ERROR:this.destroy();const s=new Error(t.data.message);s.data=t.data.data,this.emitReserved("connect_error",s);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const s of n)s.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const n=this;let s=!1;return function(...a){s||(s=!0,n.packet({type:Bt.ACK,id:t,data:a}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(delete this.acks[t.id],n.withError&&t.data.unshift(null),n.apply(this,t.data))}onconnect(t,n){this.id=t,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Bt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let s=0;s<n.length;s++)if(t===n[s])return n.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let s=0;s<n.length;s++)if(t===n[s])return n.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const s of n)s.apply(this,t.data)}}}function po(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}po.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=(Math.floor(t*10)&1)==0?e-n:e+n}return Math.min(e,this.max)|0};po.prototype.reset=function(){this.attempts=0};po.prototype.setMin=function(e){this.ms=e};po.prototype.setMax=function(e){this.max=e};po.prototype.setJitter=function(e){this.jitter=e};class ex extends Hr{constructor(t,n){var s;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,Xm(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((s=n.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new po({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const a=n.parser||gse;this.encoder=new a.Encoder,this.decoder=new a.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new sse(this.uri,this.opts);const n=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const a=Ps(n,"open",function(){s.onopen(),t&&t()}),i=o=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",o),t?t(o):this.maybeReconnectOnOpen()},l=Ps(n,"error",i);if(this._timeout!==!1){const o=this._timeout,c=this.setTimeoutFn(()=>{a(),i(new Error("timeout")),n.close()},o);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(a),this.subs.push(l),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(Ps(t,"ping",this.onping.bind(this)),Ps(t,"data",this.ondata.bind(this)),Ps(t,"error",this.onerror.bind(this)),Ps(t,"close",this.onclose.bind(this)),Ps(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){Km(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let s=this.nsps[t];return s?this._autoConnect&&!s.active&&s.connect():(s=new tA(this,t,n),this.nsps[t]=s),s}_destroy(t){const n=Object.keys(this.nsps);for(const s of n)if(this.nsps[s].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let s=0;s<n.length;s++)this.engine.write(n[s],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,n){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(a=>{a?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",a)):t.onreconnect()}))},n);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const Lo={};function Ud(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const n=ase(e,t.path||"/socket.io"),s=n.source,a=n.id,i=n.path,l=Lo[a]&&i in Lo[a].nsps,o=t.forceNew||t["force new connection"]||t.multiplex===!1||l;let c;return o?c=new ex(s,t):(Lo[a]||(Lo[a]=new ex(s,t)),c=Lo[a]),n.query&&!t.query&&(t.query=n.queryKey),c.socket(n.path,t)}Object.assign(Ud,{Manager:ex,Socket:tA,io:Ud,connect:Ud});function yse(e,t={}){const{idToken:n,isAuthenticated:s,isLoading:a}=Qr(),i=h.useRef(null),[l,o]=h.useState(!1),[c,d]=h.useState(null),u=h.useRef([]),m=h.useRef(t);h.useEffect(()=>{m.current=t},[t]);const p=h.useCallback((x,...b)=>{var N;console.log(`Socket.IO Send Called: ${x}`,{args:b});const v=b.length>0&&typeof b[b.length-1]=="function"?b[b.length-1]:void 0,w=v?b.slice(0,-1):b;if(console.log(`Socket.IO Send: Preparing to emit event: "${x}"`),console.log("Socket.IO Send: Data arguments:",w),console.log("Socket.IO Send: Callback provided (for built-in ACK):",typeof v=="function"?"Yes":"No",v),console.log("Socket.IO Send: Current socketRef.current:",i.current),console.log("Socket.IO Send: Is socketRef.current truthy?:",!!i.current),console.log("Socket.IO Send: socketRef.current?.connected:",(N=i.current)==null?void 0:N.connected),i.current&&i.current.connected){console.log("Socket.IO Send: Connection check passed. Proceeding to emit.");try{console.log("Socket.IO Send: Calling socketRef.current.emit..."),v?(i.current.emit(x,...w,v),console.log(`Socket.IO Send: Emitted event "${x}" with built-in ACK.`)):(i.current.emit(x,...w),console.log(`Socket.IO Send: Emitted event "${x}" without built-in ACK.`)),console.log("Socket.IO Send: Emit call executed.")}catch(k){if(console.error(`Socket.IO Send: Error emitting event "${x}":`,k),typeof v=="function")try{v({error:`Client send failed: ${k.message}`})}catch(j){console.error("Socket.IO Send: Error calling provided callback after emit failure:",j)}}}else console.warn(`Socket.IO: Attempted to send event '${x}' while disconnected. Queuing.`),u.current.push({eventName:x,args:b})},[]),f=h.useCallback(()=>{if(console.log("Socket.IO Hook: Connected!"),o(!0),d(null),i.current&&i.current.connected)for(;u.current.length>0;){const x=u.current.shift();try{if(x.args.length>0&&typeof x.args[x.args.length-1]=="function"){const b=x.args[x.args.length-1],v=x.args.slice(0,-1);i.current.emit(x.eventName,...v,b)}else i.current.emit(x.eventName,...x.args)}catch(b){console.error("Socket.IO Hook: Error sending queued message:",b)}}},[o,d]),y=h.useCallback(x=>{console.log(`Socket.IO Hook: ENTERING handleDisconnect. Reason: ${x}.`),console.log(`Socket.IO Hook: Event: disconnect. Reason: ${x}. socketRef.current before nulling:`,i.current),o(!1),console.log("Socket.IO Hook: isConnected state set to false."),i.current=null,console.log("Socket.IO Hook: socketRef.current set to null on disconnect."),u.current=[],console.log(`Socket.IO Hook: Disconnected. Reason: ${x}`),o(!1),i.current=null,u.current=[]},[o,i,u]),g=h.useCallback(x=>{console.error("Socket.IO Hook: Connection Error:",x.message),x.message&&x.message.includes("Token verification failed")?(console.log("Socket.IO: Token verification failed - clearing auth state"),localStorage.removeItem("id_token"),localStorage.removeItem("refresh_token"),d(new Error(`Authentication failed: ${x.message}. Please log in again.`))):d(new Error(`Socket.IO connection failed: ${x.message}`)),o(!1),i.current=null,u.current=[]},[d,o,i,u]);return h.useEffect(()=>{if(console.log("useAuthenticatedSocketIO useEffect: Running connection logic."),!s||!n||a){console.log("useAuthenticatedSocketIO useEffect: Not authenticated, missing token, or loading. Disconnecting if connected."),i.current&&i.current.disconnect(),o(!1),d(null),u.current=[];return}i.current&&(console.log("useAuthenticatedSocketIO useEffect: Existing socket found. Disconnecting."),i.current.disconnect()),i.current=null,o(!1),d(null),u.current=[],console.log(`useAuthenticatedSocketIO useEffect: Authenticated. Attempting to connect to ${e}.`);let x=null;try{x=Ud(e,{auth:{token:n},transports:["websocket","polling"],timeout:6e4,reconnection:!0,reconnectionAttempts:10,reconnectionDelay:1e3,reconnectionDelayMax:3e4,randomizationFactor:.5}),i.current=x,x.on("connect",f),x.on("disconnect",y),x.on("connect_error",g);for(const b in m.current)if(Object.hasOwnProperty.call(m.current,b)){const v=m.current[b];typeof v=="function"?(x.on(b,v),console.log(`Socket.IO Hook: Attached prop handler for event: ${b}`)):console.warn(`Socket.IO Hook: Prop handler for event '${b}' is not a function.`,v)}}catch(b){console.error("Socket.IO: Error instantiating client:",b),d(new Error(`Socket.IO client instantiation error: ${b.message}`)),o(!1),i.current=null,u.current=[]}return()=>{if(console.log("useAuthenticatedSocketIO useEffect cleanup: Disconnecting socket and removing handlers."),x){x.off("connect",f),x.off("disconnect",y),x.off("connect_error",g);for(const b in m.current)if(Object.hasOwnProperty.call(m.current,b)){const v=m.current[b];typeof v=="function"&&(x.off(b,v),console.log(`Socket.IO Hook: Removed prop handler for event: ${b}`))}(x.connected||x.connecting)&&x.disconnect()}}},[e,n,s,a,f,y,g]),h.useMemo(()=>({isConnected:l,error:c,send:p}),[l,c,p])}const bse="ws://localhost:8001",vse="http://localhost:8001/api",wse=()=>{const{isAuthenticated:e,logout:t,authFetch:n,isLoading:s,authError:a}=Qr(),i=SC(),[l,o]=xs("dashboard_current_view","leads"),[c,d]=xs("dashboard_sidebar",{collapsed:!1,chatViewHidden:!1}),u=c.collapsed,m=c.chatViewHidden,p=ge=>d(Se=>({...Se,collapsed:ge})),f=ge=>d(Se=>({...Se,chatViewHidden:ge})),[y,g]=h.useState(!1),[x,b]=h.useState(!1),[v,w]=h.useState(null),[N,k]=h.useState(null),[j,S]=h.useState(!0),[_,C]=h.useState(()=>{try{const ge=localStorage.getItem("chat_sessions");return ge?JSON.parse(ge):{}}catch(ge){return console.warn("Failed to restore sessions from localStorage:",ge),{}}}),[D,A]=h.useState(()=>{try{return localStorage.getItem("selected_session_id")||null}catch(ge){return console.warn("Failed to restore selected session from localStorage:",ge),null}}),E=h.useRef(new Set),T=h.useRef(new Map),[M,L]=h.useState(null),[P,$]=h.useState(!1),[R,U]=h.useState(null);h.useEffect(()=>{try{localStorage.setItem("chat_sessions",JSON.stringify(_))}catch(ge){console.warn("Failed to save sessions to localStorage:",ge)}},[_]),h.useEffect(()=>{try{D?localStorage.setItem("selected_session_id",D):localStorage.removeItem("selected_session_id")}catch(ge){console.warn("Failed to save selected session to localStorage:",ge)}},[D]),h.useEffect(()=>{const ge=setInterval(()=>{const Se=Object.keys(_),ce=[...E.current],ke=ce.filter(Pe=>Se.includes(Pe));ke.length!==ce.length&&(E.current=new Set(ke),console.log("Dashboard: Cleaned up loadedSessionsRef, removed stale sessions"))},6e4);return()=>clearInterval(ge)},[_]),h.useEffect(()=>{const ge=()=>{g(window.innerWidth<768)};return ge(),window.addEventListener("resize",ge),()=>window.removeEventListener("resize",ge)},[]);const I=h.useCallback(ge=>ge.includes("?")||ge.toLowerCase().includes("would you like")||ge.toLowerCase().includes("do you want")||ge.toLowerCase().includes("should i")||ge.toLowerCase().includes("which one")||ge.toLowerCase().includes("please specify")||ge.toLowerCase().includes("please provide")||ge.toLowerCase().includes("need more information")||ge.toLowerCase().includes("clarify"),[]),z=h.useCallback(ge=>{console.log("Dashboard: Received event_response:",ge);const{sessionId:Se,event:ce}=ge;if(!Se){console.warn("Dashboard: Received event_response without sessionId");return}if(!ce){console.warn("Dashboard: Received event_response without event");return}C(ke=>{const Pe=ke[Se];if(!Pe)return console.warn(`Dashboard: Session ${Se} not found for event_response`),ke;if(!ke[Se])return ke;if(ce.event_type==="agent_message"){if(!ce.text||!ce.text.trim())if(ce.partial){const ne=T.current.get(Se);return ne&&(clearTimeout(ne),T.current.delete(Se)),{...ke,[Se]:{...Pe,isAgentThinking:!0,error:null}}}else return ke;const qe=T.current.get(Se);if(qe&&(clearTimeout(qe),T.current.delete(Se)),ce.partial){const ne=Pe.messages[Pe.messages.length-1];if(ne&&ne.from==="agent"&&ne.partial){const ye=[...Pe.messages];return ye[ye.length-1]={...ne,text:ne.text+ce.text.trim()},{...ke,[Se]:{...Pe,messages:ye,isAgentThinking:!0,error:null}}}else{const ye={text:ce.text.trim(),from:"agent",partial:!0,timestamp:new Date,id:Date.now().toString(),status:"received"};return{...ke,[Se]:{...Pe,messages:[...Pe.messages,ye],isAgentThinking:!0,error:null}}}}else{const ne=Pe.messages[Pe.messages.length-1];if(ne&&ne.from==="agent"&&ne.partial){const ye=[...Pe.messages];ye[ye.length-1]={...ne,text:ce.text.trim(),partial:!1};const Ee=I(ce.text),st=!Ee&&ce.text.length>100&&!ce.text.includes("Calling")&&!ce.text.includes("...");return{...ke,[Se]:{...Pe,messages:ye,isAgentThinking:Ee||st?!1:Pe.isAgentThinking,error:null}}}else{const ye={text:ce.text.trim(),from:"agent",partial:!1,timestamp:new Date,id:Date.now().toString(),status:"received"},Ee=I(ce.text),st=!Ee&&ce.text.length>100&&!ce.text.includes("Calling")&&!ce.text.includes("...");return{...ke,[Se]:{...Pe,messages:[...Pe.messages,ye],isAgentThinking:Ee||st?!1:Pe.isAgentThinking,error:null}}}}}else return ce.event_type==="function_call"?(console.log(`Dashboard: Function call event: ${ce.function_name} (hidden from user)`),{...ke,[Se]:{...Pe,isAgentThinking:!0,error:null}}):ce.event_type==="function_response"?(console.log(`Dashboard: Function response event: ${ce.function_name} (hidden from user)`),{...ke,[Se]:{...Pe,isAgentThinking:!0,error:null}}):(console.log(`Dashboard: Unhandled event type: ${ce.event_type}`),ke)})},[]),F=h.useCallback(ge=>{console.log("Dashboard: Received session_deleted:",ge);const{sessionId:Se}=ge;if(!Se){console.error("Dashboard: No session ID in session_deleted event");return}C(ce=>{const ke={...ce};if(delete ke[Se],D===Se){const Pe=Object.keys(ke),qe=Pe.length>0?Pe[0]:null;qe&&(ke[qe]={...ke[qe],isAgentThinking:!1,isLoading:!1,error:null},setTimeout(()=>{C(ne=>ne[qe]?{...ne,[qe]:{...ne[qe],isLoading:!1}}:ne)},2e3)),A(qe)}return ke})},[D,_]),O=h.useCallback(ge=>{console.log("Dashboard: Received session_created:",ge);const{sessionId:Se}=ge;if(!Se){console.error("Dashboard: No session ID in session_created event");return}console.log("Dashboard: New session created:",Se),C(ce=>({...ce,[Se]:{id:Se,name:`Session ${Se.slice(-8)}`,messages:[],isLoading:!0,error:null,isAgentThinking:!1}})),A(Se),R&&R("session_history_request",{sessionId:Se},ce=>{if(console.log("Dashboard: Session history response:",ce),ce.error){console.error("Dashboard: Failed to load session history:",ce.error);return}C(ke=>({...ke,[Se]:{...ke[Se],messages:ce.sessionHistory||[],isLoading:!1,error:null}}))})},[R]),K=h.useCallback(ge=>{console.log("Dashboard: Received session_history_response:",ge);const{sessionHistory:Se,error:ce}=ge;if(ce){console.error("Dashboard: Error loading session history:",ce);return}const ke=D;if(!ke){console.warn("Dashboard: No session ID available for session history");return}C(Pe=>({...Pe,[ke]:{...Pe[ke],messages:(Se||[]).filter(qe=>qe.text&&qe.text.trim()).map(qe=>({text:qe.text.trim(),from:qe.event_type==="user_message"?"user":"agent"})),isLoading:!1,error:null}})),E.current.add(ke)},[D]),J=h.useCallback(ge=>{console.log("Dashboard: Received list_sessions_response:",ge);const{sessionIds:Se,error:ce}=ge;if(ce){console.error("Dashboard: Error listing sessions:",ce);return}if(Se&&Se.length>0){const ke={};if(Se.forEach(Pe=>{var ne;const qe=_[Pe];ke[Pe]={id:Pe,name:(qe==null?void 0:qe.name)||`Session ${Pe.slice(-8)}`,messages:(qe==null?void 0:qe.messages)||[],isLoading:!(((ne=qe==null?void 0:qe.messages)==null?void 0:ne.length)>0),error:null,isAgentThinking:!1}}),C(ke),!D&&Se.length>0){const Pe=localStorage.getItem("selected_session_id");Pe&&Se.includes(Pe)?A(Pe):A(Se[0])}}else R&&(console.log("Dashboard: No sessions found, creating a new one..."),R("create_session_request",{},ke=>{if(console.log("Dashboard: Create session response:",ke),ke.error){console.error("Dashboard: Failed to create session:",ke.error);return}const Pe=ke.sessionId;if(!Pe){console.error("Dashboard: No session ID returned from create_session_request");return}console.log("Dashboard: New session created:",Pe),C(qe=>({...qe,[Pe]:{id:Pe,name:`Session ${Pe.slice(-8)}`,messages:[],isLoading:!0,error:null,isAgentThinking:!1}})),A(Pe),R("session_history_request",{sessionId:Pe},qe=>{if(console.log("Dashboard: Session history response:",qe),qe.error){console.error("Dashboard: Failed to load session history:",qe.error);return}C(ne=>({...ne,[Pe]:{...ne[Pe],messages:qe.sessionHistory||[],isLoading:!1,error:null}}))})}))},[D,R]),se=h.useCallback((ge,Se)=>{console.log("Dashboard: Received function_call_request:",ge);const ce={granted:!0};console.log("Dashboard: Responding to function_call_request with:",ce),typeof Se=="function"&&Se(ce)},[]),Z=h.useRef({});Z.current={event_response:z,session_created:O,session_deleted:F,session_history_response:K,list_sessions_response:J,function_call_request:se};const oe=h.useMemo(()=>{const ge={};return Object.keys(Z.current).forEach(Se=>{ge[Se]=(...ce)=>Z.current[Se](...ce)}),ge},[]),{isConnected:W,error:B,send:V}=yse(bse,oe);h.useEffect(()=>{$(W),U(()=>V),B?(console.warn("WebSocket connection issue (non-critical):",B),L(B)):L(null)},[W,B,V]),h.useEffect(()=>{W&&V&&e&&(console.log("Dashboard: WebSocket connected, requesting session list"),V("list_sessions_request",{},J))},[W,V,e,J]);const re=h.useCallback(async()=>{if(e)try{S(!0),k(null);const ge=await n(`${vse}/protected`);w(ge)}catch(ge){console.warn("Failed to fetch protected data (non-critical):",ge),k(ge)}finally{S(!1)}},[e,n]);h.useEffect(()=>{e&&!s&&re()},[e,s,re]);const Me=h.useCallback(()=>{if(!V||!W){console.warn("Cannot create session: WebSocket not connected");return}V("create_session_request",{},ge=>{console.log("Dashboard: Create session response:",ge)})},[V,W]),he=h.useCallback(ge=>new Promise((Se,ce)=>{if(!V||!W){console.warn("Cannot delete session: WebSocket not connected"),ce(new Error("WebSocket not connected"));return}V("delete_session_request",{sessionId:ge},ke=>{console.log("Dashboard: Delete session response:",ke),ke&&ke.error?ce(new Error(ke.error)):Se(ke)})}),[V,W]),G=h.useCallback(ge=>{A(ge),b(!1)},[]);h.useEffect(()=>{D&&W&&V&&_[D]&&!E.current.has(D)&&(console.log("Dashboard: Loading history for selected session:",D),E.current.add(D),V("session_history_request",{sessionId:D},ge=>{console.log("Dashboard: Session history response:",ge),ge.error?(console.error("Dashboard: Failed to load session history:",ge.error),C(Se=>({...Se,[D]:{...Se[D],isLoading:!1,error:ge.error}}))):C(Se=>({...Se,[D]:{...Se[D],messages:(ge.sessionHistory||[]).filter(ce=>ce.text&&ce.text.trim()).map(ce=>({text:ce.text.trim(),from:ce.event_type==="user_message"?"user":"agent"})),isLoading:!1,error:null}}))}))},[D,W,V,_]);const q=h.useCallback(()=>{y?b(ge=>!ge):p(ge=>!ge)},[y]),Q=h.useCallback(async()=>{try{localStorage.removeItem("chat_sessions"),localStorage.removeItem("selected_session_id"),await t(),i("/login")}catch(ge){console.error("Logout failed:",ge)}},[t,i]),ue=h.useMemo(()=>a||N,[a,N]),Le=h.useMemo(()=>s&&!e,[s,e]);return{currentView:l,setCurrentView:o,isMobile:y,isSidebarCollapsed:u,setIsSidebarCollapsed:p,isMobileSidebarOpen:x,setIsMobileSidebarOpen:b,isChatViewHidden:m,setIsChatViewHidden:f,toggleSidebar:q,protectedData:v,fetchError:N,isFetching:j,sessions:_,setSessions:C,selectedSessionId:D,setSelectedSessionId:A,handleSelectSessionMobile:G,isWsConnected:P,wsError:M,wsSend:R,isAuthenticated:e,isLoading:s,authError:a,handleLogout:Q,navigate:i,handleCreateSession:Me,handleDeleteSession:he,handleRenameSession:h.useCallback((ge,Se)=>new Promise(ce=>{C(ke=>({...ke,[ge]:{...ke[ge],name:Se,title:Se}})),ce()}),[]),registerThinkingTimeout:h.useCallback((ge,Se)=>{T.current.set(ge,Se)},[]),clearThinkingTimeout:h.useCallback(ge=>{const Se=T.current.get(ge);Se&&(clearTimeout(Se),T.current.delete(ge))},[]),combinedError:ue,showInitialLoading:Le}},As={title:"Prelude Platform User Guide",description:"Learn how to navigate and use all the features of the Prelude Platform",sections:[{id:"getting-started",title:"Getting Started",icon:"Play",description:"Learn the basics of navigating the platform",steps:[{title:"Dashboard Overview",content:"Welcome to Prelude Platform! The dashboard is your central hub for accessing all features. Use the sidebar on the left to navigate between different sections.",image:null,tips:["The sidebar can be collapsed by clicking the hamburger menu","Your current role and email are displayed at the bottom of the sidebar","Different users see different tabs based on their role permissions"]},{title:"User Roles & Permissions",content:"Your access level determines which features you can use. There are three main roles: Employee (basic access), Manager (advanced access), and Admin (full access).",image:null,tips:["Different roles have access to different features","Your available tabs depend on your assigned role","Contact your administrator if you need access to additional features"]}]},{id:"navigation",title:"Navigation & Interface",icon:"Navigation",description:"Master the platform's navigation and interface elements",steps:[{title:"Sidebar Navigation",content:"The left sidebar contains all main navigation options. Click on any section to switch views. The active section is highlighted in color.",image:null,tips:["Business Operations: Core business functions like leads and sales","Team & Resources: Employee management and calendar","Analytics & Insights: Data and usage analytics (admin only)"]},{title:"Mobile Navigation",content:"On mobile devices, navigation switches to a horizontal scrollable bar at the top for easier thumb navigation.",image:null,tips:["Swipe horizontally to see all available tabs","Tap any tab to switch to that section","The current section is highlighted with a colored background"]}]},{id:"lead-generation",title:"Lead Generation",icon:"Target",description:"Generate and manage leads effectively",steps:[{title:"Creating New Leads",content:"Use the Lead Generation hub to find and create new business opportunities. You can search by location, industry, or company size.",image:null,tips:["Use specific geographic filters for targeted local searches","Set industry filters to find relevant businesses","Save successful search parameters for future use"]},{title:"Lead Management",content:"Track and manage your leads through different stages of the sales funnel. Update lead status and add notes as you progress.",image:null,tips:["Regularly update lead status to track progress","Add detailed notes for better follow-up","Set reminders for important follow-up dates"]}]},{id:"sales-center",title:"Sales Center",icon:"BarChart3",description:"Analyze sales performance and manage your pipeline",steps:[{title:"Sales Analytics",content:"View comprehensive sales metrics, performance trends, and pipeline analysis. Upload data and generate custom reports.",image:null,tips:["Upload CSV files for bulk data analysis","Use the natural language query feature to ask questions about your data","Export reports for presentations and meetings"]},{title:"Performance Tracking",content:"Monitor individual and team performance metrics. Track conversion rates, deal sizes, and sales velocity.",image:null,tips:["Set performance goals and track progress","Compare performance across different time periods","Identify top performers and areas for improvement"]}]},{id:"crm",title:"Customer Relationship Management",icon:"Heart",description:"Manage customer relationships and interactions",steps:[{title:"Customer Profiles",content:"Create and maintain detailed customer profiles with contact information, interaction history, and preferences.",image:null,tips:["Keep customer information up to date","Log all interactions for complete history","Set follow-up reminders for important customers"]},{title:"Interaction Tracking",content:"Record all customer interactions including calls, emails, meetings, and notes. Build a comprehensive relationship timeline.",image:null,tips:["Log interactions immediately after they occur","Include relevant details and outcomes","Tag interactions for easy searching and filtering"]}]},{id:"employee-management",title:"Employee Management",icon:"Users",description:"Manage team members and their profiles",steps:[{title:"Employee Profiles",content:"View and manage employee information, performance metrics, and assignment details. Access levels may vary based on your role.",image:null,tips:["Regular performance reviews help track progress","Update employee information as roles change","Use the matching system to assign optimal roles"]},{title:"Team Performance",content:"Monitor team performance metrics and identify areas for improvement or recognition.",image:null,tips:["Set clear performance expectations","Provide regular feedback and coaching","Recognize high performers publicly"]}]},{id:"calendar",title:"Calendar & Scheduling",icon:"Calendar",description:"Manage appointments and integrate with Google Calendar",steps:[{title:"Calendar Integration",content:"Connect your Google Calendar to sync appointments and meetings. View and manage your schedule directly from the platform.",image:null,tips:["Authorize Google Calendar access for full sync","Set meeting preferences and availability","Use calendar blocking for focused work time"]},{title:"Meeting Management",content:"Schedule meetings with customers and team members. Track meeting outcomes and follow-up actions.",image:null,tips:["Always include agenda items in meeting descriptions","Set automatic reminders for important meetings","Log meeting outcomes for future reference"]}]},{id:"analytics",title:"Usage Analytics",icon:"BarChart2",description:"Monitor platform usage and performance",steps:[{title:"Usage Tracking",content:"Monitor how the platform is being used across your organization. Track user activity, feature adoption, and performance metrics. Access may be limited based on your role.",image:null,tips:["Monitor user adoption of new features","Identify underutilized platform capabilities","Track system performance and response times"]},{title:"Insights & Optimization",content:"Use analytics data to optimize platform usage and identify training needs across your organization. Available features depend on your access level.",image:null,tips:["Regular analytics reviews help identify trends","Use data to inform training and onboarding","Share insights with team leaders for better adoption"]}]},{id:"ai-assistant",title:"AI Assistant",icon:"MessageCircle",description:"Interact with the AI-powered chat assistant",steps:[{title:"Chat Interface",content:"Use the AI Assistant to get help, ask questions, and automate tasks. The chat panel can be toggled on/off as needed.",image:null,tips:["Ask specific questions for better responses","Use the chat for data analysis and insights","Save important conversations for future reference"]},{title:"Session Management",content:"Create multiple chat sessions for different topics or projects. Rename and organize sessions for easy access.",image:null,tips:["Create separate sessions for different projects","Use descriptive names for easy identification","Delete old sessions to keep the interface clean"]}]}],shortcuts:[{keys:["Ctrl","+"],description:"Zoom in"},{keys:["Ctrl","-"],description:"Zoom out"},{keys:["Ctrl","Shift","C"],description:"Toggle chat panel"},{keys:["Esc"],description:"Close modal or panel"}],troubleshooting:[{problem:"Can't see certain tabs or features",solution:"Check your user role at the bottom of the sidebar. Some features are only available to managers or administrators."},{problem:"Calendar integration not working",solution:"Ensure you've authorized Google Calendar access and that your browser allows pop-ups from this domain."},{problem:"Data not loading or displaying",solution:"Try refreshing the page. If the problem persists, check your internet connection and contact support."},{problem:"Chat assistant not responding",solution:"Check your internet connection and ensure the backend services are running. Try creating a new chat session."}]},kC={Play:ax,Navigation:Sf,Target:Er,BarChart3:Da,Heart:Xo,Users:kt,Calendar:yt,BarChart2:bl,MessageCircle:Gu},jse=({isOpen:e,onClose:t})=>{const[n,s]=h.useState(0),[a,i]=h.useState(0),[l,o]=h.useState("tutorial"),c=As.sections[n],d=c==null?void 0:c.steps[a],u=(c==null?void 0:c.steps.length)||0,m=()=>{a<u-1?i(a+1):n<As.sections.length-1&&(s(n+1),i(0))},p=()=>{if(a>0)i(a-1);else if(n>0){s(n-1);const x=As.sections[n-1];i(x.steps.length-1)}},f=n===0&&a===0,y=n===As.sections.length-1&&a===u-1,g=(n*100+(a+1)/u*100)/As.sections.length;return e?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs(de.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col shadow-2xl",children:[r.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(ab,{className:"h-8 w-8"}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold",children:As.title}),r.jsx("p",{className:"text-blue-100 mt-1",children:As.description})]})]}),r.jsx(H,{variant:"ghost",size:"sm",onClick:t,className:"text-white hover:bg-white/20",children:r.jsx(Ze,{className:"h-5 w-5"})})]}),r.jsxs("div",{className:"mt-4",children:[r.jsxs("div",{className:"flex justify-between text-sm text-blue-100 mb-2",children:[r.jsx("span",{children:"Progress"}),r.jsxs("span",{children:[Math.round(g),"%"]})]}),r.jsx("div",{className:"w-full bg-blue-800/30 rounded-full h-2",children:r.jsx(de.div,{className:"bg-white rounded-full h-2",style:{width:`${g}%`},transition:{duration:.3}})})]})]}),r.jsx("div",{className:"border-b border-gray-200 bg-gray-50",children:r.jsxs("div",{className:"flex",children:[r.jsxs("button",{onClick:()=>o("tutorial"),className:`px-6 py-3 text-sm font-medium border-b-2 ${l==="tutorial"?"border-blue-500 text-blue-600 bg-white":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(ab,{className:"inline h-4 w-4 mr-2"}),"Tutorial"]}),r.jsxs("button",{onClick:()=>o("shortcuts"),className:`px-6 py-3 text-sm font-medium border-b-2 ${l==="shortcuts"?"border-blue-500 text-blue-600 bg-white":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(f4,{className:"inline h-4 w-4 mr-2"}),"Shortcuts"]}),r.jsxs("button",{onClick:()=>o("troubleshooting"),className:`px-6 py-3 text-sm font-medium border-b-2 ${l==="troubleshooting"?"border-blue-500 text-blue-600 bg-white":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[r.jsx(Cf,{className:"inline h-4 w-4 mr-2"}),"Troubleshooting"]})]})}),r.jsxs("div",{className:"flex-1 overflow-hidden flex",children:[l==="tutorial"&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"w-80 bg-gray-50 border-r border-gray-200 overflow-y-auto",children:r.jsxs("div",{className:"p-4",children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wide mb-3",children:"Sections"}),r.jsx("div",{className:"space-y-2",children:As.sections.map((x,b)=>{const v=kC[x.icon],w=b===n,N=b<n;return r.jsx("button",{onClick:()=>{s(b),i(0)},className:`w-full text-left p-3 rounded-lg transition-colors ${w?"bg-blue-100 border-2 border-blue-300 text-blue-700":N?"bg-green-50 border-2 border-green-200 text-green-700":"bg-white border-2 border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(v,{className:"h-5 w-5"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium text-sm",children:x.title}),r.jsx("div",{className:"text-xs mt-1 opacity-75",children:x.description})]})]})},x.id)})})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:r.jsx(ht,{mode:"wait",children:r.jsx(de.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"p-8",children:c&&d&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"mb-6",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[le.createElement(kC[c.icon],{className:"h-6 w-6 text-blue-600"}),r.jsx("span",{className:"text-sm text-blue-600 font-medium",children:c.title})]}),r.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:d.title}),r.jsxs("div",{className:"text-sm text-gray-500",children:["Step ",a+1," of ",u]})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"text-lg text-gray-700 leading-relaxed",children:d.content}),d.image&&r.jsx("div",{className:"bg-gray-100 rounded-lg p-4 text-center",children:r.jsxs("div",{className:"text-gray-500",children:["[Tutorial Image: ",d.image,"]"]})}),d.tips&&d.tips.length>0&&r.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx(bc,{className:"h-5 w-5 text-yellow-600"}),r.jsx("h4",{className:"font-semibold text-yellow-800",children:"Tips"})]}),r.jsx("ul",{className:"space-y-2",children:d.tips.map((x,b)=>r.jsxs("li",{className:"text-yellow-700 text-sm flex items-start gap-2",children:[r.jsx("span",{className:"text-yellow-500 mt-1",children:""}),r.jsx("span",{children:x})]},b))})]})]})]})},`${n}-${a}`)})})]}),l==="shortcuts"&&r.jsxs("div",{className:"flex-1 overflow-y-auto p-8",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Keyboard Shortcuts"}),r.jsx("div",{className:"grid gap-4",children:As.shortcuts.map((x,b)=>r.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[r.jsx("span",{className:"text-gray-700",children:x.description}),r.jsx("div",{className:"flex gap-1",children:x.keys.map((v,w)=>r.jsxs(le.Fragment,{children:[w>0&&r.jsx("span",{className:"text-gray-400 mx-1",children:"+"}),r.jsx("kbd",{className:"px-2 py-1 bg-gray-200 border border-gray-300 rounded text-sm font-mono",children:v})]},w))})]},b))})]}),l==="troubleshooting"&&r.jsxs("div",{className:"flex-1 overflow-y-auto p-8",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Troubleshooting"}),r.jsx("div",{className:"space-y-6",children:As.troubleshooting.map((x,b)=>r.jsxs("div",{className:"border border-gray-200 rounded-lg p-6",children:[r.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[r.jsx(Cf,{className:"h-5 w-5 text-red-500"}),x.problem]}),r.jsx("p",{className:"text-gray-700 pl-7",children:x.solution})]},b))})]})]}),l==="tutorial"&&r.jsx("div",{className:"border-t border-gray-200 p-6 bg-gray-50",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs(H,{variant:"outline",onClick:p,disabled:f,className:"flex items-center gap-2",children:[r.jsx(di,{className:"h-4 w-4"}),"Previous"]}),r.jsxs("div",{className:"text-sm text-gray-500",children:["Section ",n+1," of ",As.sections.length]}),r.jsxs(H,{onClick:m,disabled:y,className:"flex items-center gap-2",children:["Next",r.jsx(Ta,{className:"h-4 w-4"})]})]})})]})}):null};function Yse(){const{isTutorialOpen:e,closeTutorial:t}=vA(),{currentView:n,setCurrentView:s,sessions:a,selectedSessionId:i,setSelectedSessionId:l,setSessions:o,isWsConnected:c,wsSend:d,isAuthenticated:u,navigate:m,registerThinkingTimeout:p,clearThinkingTimeout:f,combinedError:y,showInitialLoading:g}=wse(),[x,b]=h.useState(!1),[v,w]=h.useState(!1),[N,k]=h.useState(null),[j,S]=h.useState(!1),[_,C]=h.useState(!1),D=!1;h.useEffect(()=>{g?(S(!1),C(!1)):_||setTimeout(()=>{S(!0),C(!0)},100)},[g,_]),h.useEffect(()=>{if(u&&Object.keys(a).length===0&&!i){const z="default-session";o({[z]:{id:z,name:"Default Session",messages:[],isLoading:!1,error:null,isAgentThinking:!1}}),l(z)}},[u,a,i,o,l]),h.useEffect(()=>{const z=()=>{s("leads")};return window.addEventListener("navigate-to-leads",z),()=>{window.removeEventListener("navigate-to-leads",z)}},[]);const A=i?a[i]:null,E=(A==null?void 0:A.isLoading)||!1,T=(A==null?void 0:A.messages)||[],M=(A==null?void 0:A.error)||null,L=(A==null?void 0:A.isAgentThinking)||!1,P=z=>{if(!i){console.warn("DashboardPage: Cannot send message: No session selected.");return}if(!d||!c){console.warn("DashboardPage: Cannot send message: WebSocket not connected.");const K={text:z,from:"user"},J={text:"Chat service is not available. Please check your connection.",from:"system"};o(se=>{var Z;return{...se,[i]:{...se[i],messages:[...((Z=se[i])==null?void 0:Z.messages)||[],K,J],isAgentThinking:!1,error:"Chat service unavailable"}}});return}console.log(`DashboardPage: Sending message for session ${i}:`,z);const F={text:z,from:"user",timestamp:new Date,id:Date.now().toString(),status:"sent"};o(K=>{var J;return{...K,[i]:{...K[i],messages:[...((J=K[i])==null?void 0:J.messages)||[],F],isAgentThinking:!0}}});const O=setTimeout(()=>{console.warn(`DashboardPage: Timeout clearing thinking state for session ${i}`),o(K=>({...K,[i]:{...K[i],isAgentThinking:!1}}))},2e4);p(i,O),d("user_input_request",{sessionId:i,text:z},K=>{console.log(`DashboardPage: Received user_input_request ACK for session ${i}:`,K),f(i),K&&K.error&&(console.error(`DashboardPage: Error sending message for session ${i}:`,K.error),o(J=>({...J,[i]:{...J[i],isAgentThinking:!1,error:K.error}})))})},$=g||!_;if(!c&&Object.keys(a).length===0&&y)return r.jsxs("div",{className:"bg-white",children:[r.jsx(jA,{}),r.jsx(NA,{className:"min-h-screen",children:r.jsx("div",{className:"flex items-center justify-center min-h-screen p-4 pt-32",children:r.jsx(de.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.6},children:r.jsxs(We,{className:"w-full max-w-md bg-white/90 backdrop-blur-md shadow-lg border-0",children:[r.jsx(ir,{children:r.jsx(cr,{className:"text-center text-red-700 font-display",children:"Connection Error"})}),r.jsxs(it,{className:"space-y-4",children:[r.jsx("p",{className:"text-center text-sm text-gray-600 font-inter",children:"Could not connect to chat service or load sessions."}),y&&r.jsx("p",{className:"text-sm text-red-700 bg-red-50 p-3 rounded-md font-inter",children:y.message||String(y)}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[r.jsx(H,{onClick:()=>window.location.reload(),className:"flex-1 bg-prelude-800 hover:bg-prelude-900 text-white font-manrope",children:"Retry Connection"}),r.jsx(H,{variant:"outline",onClick:()=>m("/login"),className:"flex-1 border-gray-300 text-gray-700 hover:bg-gray-50 font-inter",children:"Go to Login"})]})]})]})})})})]});const R=()=>{b(!x)},U=z=>{z!==n&&!v&&(k(z),w(!0),S(!1),setTimeout(()=>{S(!0)},1500+Math.random()*2e3))},I=()=>{w(!1),k(null),S(!1)};return r.jsxs("div",{className:"dashboard-container min-h-screen flex",style:{height:"100vh"},children:[r.jsx(Cne,{}),r.jsx("div",{className:"border-r border-gray-200 transition-all duration-300",style:{background:"linear-gradient(to bottom, rgb(255, 255, 255) 0%, rgb(250, 252, 253) 40%, rgb(232, 243, 245) 100%)"},children:r.jsx(qC,{currentView:n,setCurrentView:s,onTabClick:U})}),r.jsx(UT,{currentView:n,isTabLoading:v,targetView:N,isContentReady:j,onLoadingComplete:I,isWsConnected:c,isInitialLoading:$,onInitialLoadComplete:()=>C(!0),loadingEnabled:D}),r.jsx(ht,{children:r.jsx(YI,{isVisible:x,onToggleVisibility:R,sessionId:i,isConnected:c,messages:T,error:M,send:P,isAgentThinking:L,isLoading:E,context:n})}),r.jsx(jse,{isOpen:e,onClose:t})]})}export{Yse as default};
